/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
jQuery.sap.declare("sap.apf.core.path");
sap.apf.core.Path=function(I){this.type="path";var m=I.messageHandler;var c=I.coreApi;var t=this;var s=[];var a=[];var n=0;this.getSteps=function(){return jQuery.extend(true,[],s)};this.addStep=function(S,f){s.push(S);var o;if(S.isInitialStep()===true){o=c.getContext();S.setFilter(o)}t.update(f)};this.makeStepActive=function(S){var f=this.stepIsInPath(S);m.check(f,"An unknown step can't be an active step.",sap.apf.core.constants.message.code.errorCheckWarning);if(f){if(this.stepIsActive(S)===false){a.push(S)}}};this.makeStepInactive=function(S){var f=this.stepIsActive(S);m.check(f,"Only an active step can be removed from the active steps.",sap.apf.core.constants.message.code.errorCheckWarning);if(f){var i=jQuery.inArray(S,a);a.splice(i,1)}};this.stepIsActive=function(S){var i=jQuery.inArray(S,a);if(i>=0){return true}else{return false}};this.stepIsInPath=function(S){var i=jQuery.inArray(S,s);if(i>=0){return true}else{return false}};this.getActiveSteps=function(){return jQuery.extend(true,[],a)};this.getInitialStep=function(){var S;if(s.length>0){var f=s[0];if(f.isInitialStep()===true){S=f}}return S};this.moveStepToPosition=function(S,f,h){var i=jQuery.inArray(S,s);var j=f;var M;m.check(typeof f==="number"&&f>=0&&f<s.length,"Path: moveStepToPosition invalid argument for nPosition");m.check(i>=0&&i<s.length,"Path: moveStepToPosition invalid step");if(i===f){return}if(S.isInitialStep()){M=m.createMessageObject({code:"5008",aParameters:[],callingObject:S});m.putMessage(M)}s.splice(i,1);if(j===0&&this.getInitialStep()!==undefined){j=1}s.splice(j,0,S);this.update(h)};this.removeStep=function(S,f){var h=this.stepIsInPath(S);var i=this.stepIsActive(S);var j=jQuery.inArray(S,s);var M;if(S.isInitialStep()){M=m.createMessageObject({code:"5007",aParameters:[],callingObject:S});m.putMessage(M);return}m.check(h,"Path: remove step - invalid step");s.splice(j,1);if(i){this.makeStepInactive(S)}this.update(f)};this.update=function(S,C){if(!s[0]){return}var f;var o=s[0];var h=c.getContext();var i=h.getInternalFilter().copy();if(C===true){if(s[0].isInitialStep!==undefined&&s[0].isInitialStep()===true){s[0].setFilter(h)}return}n++;f=n;o.update(i,j);function j(r,l){var p=jQuery.inArray(o,s);var M;if(f===n){if(r instanceof Error){var q=p+1;M=m.createMessageObject({code:"5002",aParameters:[q],callingObject:o});M.setPrevious(r);m.putMessage(M);o.setData({data:[],metadata:undefined},i);S(o,true);p++;o=s[p];while(o){o.setData({data:[],metadata:undefined},i);S(o,true);p++;o=s[p]}return}if(!l){o.setData(r,i)}S(o,!l);o.determineFilter(i.copy(),k)}}function k(F){var l=jQuery.inArray(o,s);if(o.isInitialStep()===true){i=i.overwriteWith(F)}else{i.addAnd(F)}o=s[l+1];if(o){o.update(i,j)}}};this.serialize=function(){var f=c.getContext();return{path:{steps:b(),indicesOfActiveSteps:g()},context:f.serialize()}};this.deserialize=function(S){var C=new sap.apf.utils.Filter(m);C.deserialize(S.context);c.setContext(C);d(S.path.steps,this);e(S.path.indicesOfActiveSteps,this)};function g(){var f=[];for(var i=0;i<s.length;i++){for(var j=0;j<a.length;j++){if(s[i]===a[j]){f.push(i)}}}return f}function b(){var S=[];for(var i=0;i<s.length;i++){S.push(s[i].serialize())}return S}function d(S,C){var f=C.update;C.update=function(){};var i=0;for(i=0;i<S.length;i++){c.createStep(S[i].stepId)}for(i=0;i<s.length;i++){s[i].deserialize(S[i])}C.update=f}function e(f,C){for(var i=0;i<f.length;i++){var h=f[i];C.makeStepActive(s[h])}}};
