/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
jQuery.sap.declare("sap.apf.core.sessionHandler");jQuery.sap.require("sap.apf.core.ajax");jQuery.sap.require("sap.apf.utils.filter");
sap.apf.core.SessionHandler=function(i){var t=this;var x="";var s="";var h=new sap.apf.utils.Hashtable(i.messageHandler);var n=0;var l="";var c=i.coreApi;var m=i.messageHandler;var C=new sap.apf.utils.Filter(m);var S="";this.type="sessionHandler";this.ajax=function(d){sap.apf.core.ajax(d)};this.odata=function(r,O,e){c.odataRequest(r,O,e)};this.getXsrfToken=function(d){s=d;if(h.hasItem(s)){return h.getItem(s)}else{t.fetchXcsrfToken();h.setItem(s,x);return x}};this.getLogicalSystem=function(){return l};this.setContext=function(f){C=f;var T=C.getInternalFilter().getFilterTermsForProperty('SAPClient');if(T&&T.length===1){b()}c.updatePath(function(){},true)};this.getContext=function(){return C};this.fetchXcsrfToken=function(){t.ajax({url:c.getUriGenerator().getAbsolutePath(s),type:"GET",beforeSend:function(d){d.setRequestHeader("x-csrf-token","Fetch")},success:a,error:o,async:false});n=n+1};var o=function(j,d,e){if((x.length===0||x==="unsafe")&&n<2){setTimeout(t.fetchXcsrfToken,500+Math.random()*1500)}else{m.check(false,"No XSRF Token available!")}};var a=function(d,e,X){x=X.getResponseHeader("x-csrf-token");if((x.length===0||x==="unsafe")&&n<2){setTimeout(t.fetchXcsrfToken,500+Math.random()*1500)}};var g=function(){var T=C.getInternalFilter().getFilterTermsForProperty('SAPClient');if(T===undefined||T.length!==1){m.putMessage(m.createMessageObject({code:"5025"}))}return T[0].getValue()};var b=function(){var d=c.getPersistenceConfiguration().logicalSystem.service;var e=c.getPersistenceConfiguration().logicalSystem.entityType;var f=g();if(S===f){return}S=f;var F=new sap.apf.core.utils.Filter(m,"SAPClient",'eq',S);var u=c.getUriGenerator().getAbsolutePath(d);u=u+c.getUriGenerator().buildUri(m,e,['LogicalSystem'],F,undefined,undefined,undefined,undefined,undefined,'Results');var r={requestUri:u,method:"GET",headers:{"x-csrf-token":x},async:false};var O=function(D){if(D&&D.results&&D.results instanceof Array&&D.results.length===1&&D.results[0].LogicalSystem){l=D.results[0].LogicalSystem}else{m.putMessage(m.createMessageObject({code:"5026",aParameters:[S]}))}};var E=function(j){var M=m.createMessageObject({code:"5026",aParameters:[S]});if(j.messageObject!==undefined&&j.messageObject.type==="messageObject"){M.setPrevious(j.messageObject)}m.putMessage(M)};t.odata(r,O,E)}};
