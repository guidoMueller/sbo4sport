/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
jQuery.sap.declare("sap.apf.core.configurationFactory");jQuery.sap.require("sap.apf.core.step");jQuery.sap.require("sap.apf.core.request");jQuery.sap.require("sap.apf.utils.hashtable");jQuery.sap.require("sap.apf.core.binding");jQuery.sap.require("sap.apf.core.representationTypes");jQuery.sap.require("sap.apf.core.constants");
sap.apf.core.ConfigurationFactory=function(I){var a=new sap.apf.utils.Hashtable(I.messageHandler);var s=function(i){I.messageHandler.check(i!==undefined&&i.hasOwnProperty("id")!==false,"oItem is undefined or property 'id' is missing",sap.apf.core.constants.message.code.errorCheckConfiguration);if(!a){a=new sap.apf.utils.Hashtable(I.messageHandler)}var r=a.setItem(i.id,i);I.messageHandler.check((r===undefined),"Configuration includes duplicated identifiers (IDs)",sap.apf.core.constants.message.code.errorCheckConfigurationWarning)};var g=function(t){var r=[];if(a.getNumberOfItems()!=0){a.each(function(i,q){if(q.type===t){r.push(q)}});return r}else{I.messageHandler.putMessage(I.messageHandler.createMessageObject({code:"5020"}));return r}};var l=function(q){I.messageHandler.check(q!==undefined&&q instanceof Array!==false,"aSteps is missing or not an Array",sap.apf.core.constants.message.code.errorCheckConfiguration);for(var i=0;i<q.length;i++){b(q[i])}};var b=function(i){if(i.type===undefined){i.type="step"}s(i)};var c=function(r){I.messageHandler.check(r!==undefined&&r instanceof Array!==false,"aRequests is missing or not an Array",sap.apf.core.constants.message.code.errorCheckConfiguration);for(var i=0;i<r.length;i++){d(r[i])}};var d=function(r){if(r.type===undefined){r.type="request"}s(r)};var e=function(B){I.messageHandler.check(B!==undefined&&B instanceof Array!==false,"aBindings is missing or not an Array",sap.apf.core.constants.message.code.errorCheckConfiguration);for(var i=0;i<B.length;i++){f(B[i])}};var f=function(B){var r=new sap.apf.utils.Hashtable(I.messageHandler);if(B.type===undefined){B.type="binding"}I.messageHandler.check(B.id!==undefined,"binding has no id");I.messageHandler.check(B.representations!==undefined&&B.representations instanceof Array!==false,"representations for binding "+B.id+" not defined",sap.apf.core.constants.message.code.errorCheckConfiguration);q();t();s(B);function q(){for(var i=0;i<B.representations.length;i++){if(!(B.representations[i].id&&typeof B.representations[i].id==="string")){I.messageHandler.putMessage(I.messageHandler.createMessageObject({code:"5028",aParameters:[B.id]}))}if(r.setItem(B.representations[i].id,B.representations[i].id)){I.messageHandler.putMessage(I.messageHandler.createMessageObject({code:"5029",aParameters:[B.id]}))}}}function t(){if(B.representations.length>1){var u=g('step');for(var i=0;i<u.length;i++){if(u[i].categories[0].id==='initial'&&u[i].binding===B.id){var M=I.messageHandler.createMessageObject({code:"5003",aParameters:[u[i].id]});I.messageHandler.putMessage(M)}}}}};var h=function(q){I.messageHandler.check(q!==undefined&&q instanceof Array!==false,"aCategories is missing or not an Array",sap.apf.core.constants.message.code.errorCheckConfiguration);for(var i=0;i<q.length;i++){o(q[i])}};var j=function(r){I.messageHandler.check(r!==undefined&&r instanceof Array!==false,"aRepresentationInfo is missing or not an Array",sap.apf.core.constants.message.code.errorCheckConfiguration);for(var i in r){k(r[i])}};var k=function(r){var i;if(r.type===undefined){r.type="representationType"}i=sap.apf.utils.extractFunctionFromModulePathString(r.constructor);if(!jQuery.isFunction(i)){I.messageHandler.putMessage(I.messageHandler.createMessageObject({code:'5030',parameters:[r.id]}))}s(r)};var m=function(F){I.messageHandler.check(F!==undefined&&F instanceof Array!==false,"Facet filter configuration is missing or not an Array",sap.apf.core.constants.message.code.errorCheckConfiguration);for(var i in F){n.call(this,F[i])}};var n=function(F){if(F.type===undefined){F.type="facetFilter"}this.addObject(F)};var o=function(i){if(i.type===undefined){i.type="category"}s(i)};var p=function(r){j(r)};var S=function(q,F){var r=jQuery.extend(true,{},q);var R=t(q,F);delete r.request;delete r.binding;delete r.thumbnail;delete r.longTitle;r.type="stepTemplate";r.isForInitialStep=function(){return(r.categories[0].id==='initial')};r.getRepresentationInfo=function(){var v=jQuery.extend(true,[],R);for(var i=0;i<v.length;i++){delete v[i].id;delete v[i].type;delete v[i].constructor}return v};function t(q,v){var w;var R=[];if(q.binding){w=u(q,v);for(var i=0;i<w.length;i++){var x=jQuery.extend(true,{},v.getConfigurationById(w[i].representationTypeId));x.representationId=w[i].id;x.representationLabel=w[i].label;R.push(x)}return R}else{I.messageHandler.check(false,'Step with ID "'+q.id+'" does not contain any binding references.',sap.apf.core.constants.message.code.errorCheckConfigurationWarning)}}function u(q,i){var v=i.getConfigurationById(q.binding).representations;if(v){return v}else{I.messageHandler.check(false,'Binding of step with ID "'+q.id+'" does not contain any representations.',sap.apf.core.constants.message.code.errorCheckConfigurationWarning)}}return r};var C=function(i){this.type=i.type;this.id=i.id;this.label=i.label;return this};var T=function(t,F){this.type="thumbnail";if(t===undefined){return this}this.leftUpper=F.createLabel(t.leftUpper);this.rightUpper=F.createLabel(t.rightUpper);this.leftLower=F.createLabel(t.leftLower);this.rightLower=F.createLabel(t.rightLower);this.altTitle=F.createLabel(t.altTitle);return this};this.createThumbnail=function(t){return new T(t,this)};var L=function(i,F){if(i===undefined){return undefined}this.type="label";this.kind=i.kind;if(this.kind==="text"){this.file=i.file;this.key=i.key}else if(this.kind==="property"){this.property=i.property}else if(this.kind==="sapLabel"){this.labelOf=i.labelOf}else{return undefined}return this};this.createLabel=function(i){return new L(i,this)};this.loadConfig=function(i){a=new sap.apf.utils.Hashtable(I.messageHandler);var r=sap.apf.core.representationTypes();p(r);l(i.steps);c(i.requests);e(i.bindings);h(i.categories);if(i.representationTypes){j(i.representationTypes)}if(i.facetFilters){m.call(this,i.facetFilters)}};this.addObject=function(i){if(!(i.type in sap.apf.core.constants.configurationObjectTypes)){I.messageHandler.putMessage(I.messageHandler.createMessageObject({code:"5033",aParams:[i.type]}))}if(!(i.property)){I.messageHandler.putMessage(I.messageHandler.createMessageObject({code:"5034"}))}a.setItem(i.id,i)};this.getConfigurationById=function(i){return a.getItem(i)};this.existsConfiguration=function(i){return a.hasItem(i)};this.getServiceDocuments=function(){var r=g("request");var i=[];for(var R in r){i.push(r[R].service)}i=sap.apf.utils.eliminateDuplicatesInArray(I.messageHandler,i);return i};this.getStepTemplates=function(){var i=g("step");var q=[];for(var r in i){q[r]=new S(i[r],this)}return q};this.getFacetFilterConfigurations=function(){var q=g("facetFilter");var r;q=jQuery.extend(true,[],q);for(var i=0,t=q.length;i<t;i++){if(q[i].preselectionFunction){r=sap.apf.utils.extractFunctionFromModulePathString(q[i].preselectionFunction);if(!jQuery.isFunction(r)){I.messageHandler.putMessage(I.messageHandler.createMessageObject({code:'5035',parameters:[q[i].id]}));q[i].preselectionFunction=undefined}else{q[i].preselectionFunction=r}}}return q};this.getCategories=function(){var i=g("category");var q=[];for(var r in i){q[r]=new C(i[r])}return q};this.createStep=function(i){var q=this.getConfigurationById(i);I.messageHandler.check((q!==undefined&&q.type==="step"),"Error - referenced object is undefined or has not type step",sap.apf.core.constants.message.code.errorCheckConfiguration);I.messageHandler.check(sap.apf.core.Step!==undefined,"Step must be defined ",sap.apf.core.constants.message.code.errorCheckConfiguration);I.messageHandler.check(typeof sap.apf.core.Step==="function","Step must be Ctor function");return new sap.apf.core.Step(I.messageHandler,q,this)};this.createBinding=function(B,t,i){var q=this.getConfigurationById(B);I.messageHandler.check((q!==undefined&&q.type==="binding"),"Error - oBindingConfig is undefined or has not type binding",sap.apf.core.constants.message.code.errorCheckConfiguration);q.oTitle=t;q.oLongTitle=i;return new sap.apf.core.Binding(I,q,this)};this.createRequest=function(r){var M;var R;if(typeof r==="string"){R=this.getConfigurationById(r);if(!(R!==undefined&&R.type==="request")){M=I.messageHandler.createMessageObject({code:"5004",aParameters:[r]});I.messageHandler.putMessage(M);return undefined}}else{R=r;I.messageHandler.check(R.type&&R.type==="request"&&R.service&&R.entityType,'Wrong request configuration when creating a new request');if(!R.id){R.id=i();s(R)}}return new sap.apf.core.Request(I,R);function i(){var q=new Date();var u=Math.random()*q.getTime();return u}}};
