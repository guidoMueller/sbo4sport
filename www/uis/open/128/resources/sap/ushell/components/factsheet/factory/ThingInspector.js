//Copyright (c) 2013 SAP AG, All Rights Reserved
(function(){"use strict";jQuery.sap.declare("sap.ushell.components.factsheet.factory.ThingInspector");sap.ushell.components.factsheet.factory=(function(){jQuery.sap.require("sap.suite.ui.commons.UnifiedThingInspector");jQuery.sap.require("sap.ushell.components.factsheet.annotation.Mapping");jQuery.sap.require("sap.ui.vbm.library");var t,M={},g,c,d,f,h,l,n,q,r,s={},u,v,w,x,y,z,A,B,S,C,D,E,F,G,H,L,I,J,K,N,O,P,Q="displayFactSheet";jQuery.sap.require("sap.ui.base.Object");jQuery.sap.require("sap.ui.core.format.NumberFormat");L=sap.ui.getCore().getConfiguration().getFormatSettings().getFormatLocale();if(sap.ui.getCore().getConfiguration().getLanguage()==="ZH"){L=new sap.ui.core.Locale("zh_CN")}S=sap.ui.core.LocaleData.getInstance(L)._get("decimalFormat-short");function R(a){return a<0?true:false}function T(a){var b=Number(a).toFixed(0);if(R(a)){b=Number(b)*-1}return b}function U(a){return Number(a)*-1}function V(a){var b="",e="",j="",k=0,m="",o,p,Y,Z,_,i;p=T(a);o=Math.pow(10,p.toString().length-1);if(S===null){return sap.ui.core.format.NumberFormat.getIntegerInstance().format(a)}if(S[o+"-one"]===null||S[o+"-one"]===undefined||S[o+"-one"]==="0"){return sap.ui.core.format.NumberFormat.getIntegerInstance().format(a)}b=S[o+"-one"];Y=b.match(/0/g).length;Z=b.substring(0,b.lastIndexOf("0")+1);_=b.substring(b.lastIndexOf("0")+1,b.length);_=_.replace(/'.'/g,".");e=Z;j=p.toString();for(i=0;i<Y;i+=1){k=e.indexOf("0",k);if(k===-1){break}e=e.substring(0,k)+j[i]+e.substring(k+1);k+=1}if(R(a)){e=U(e)}m=sap.ui.core.format.NumberFormat.getFloatInstance().format(e);m=m+_;return m}function W(a,b){var e,o,i,j;if(!a){return""}o=new RegExp(sap.ui.core.format.NumberFormat.oDefaultFloatFormat.groupingSeparator,"g");if(b>=0){j=sap.ui.core.format.NumberFormat.getFloatInstance({minFractionDigits:b,maxFractionDigits:b},L);e=j.format(a)}else{j=sap.ui.core.format.NumberFormat.getFloatInstance({minFractionDigits:0,maxFractionDigits:99},L);e=j.format(a)}i=e.replace(/[\D]/g,"");if(i&&i.length>6){a=a.replace(o,"");return(V(a))}else{return e}}function X(){var p,a,o="",b,m,e,k,i,j,Y,Z,_;b=this.getElementBinding().sPath.split("/")[1];m=this.getModel();e=this.mBindingInfos.value.parameters;k=this.mBindingInfos.value.parts;for(i=0;i<e.length;i+=1){o=o+e[i].string}for(j=0;j<k.length;j+=1){p=k[j].path;Z="{"+p+"}";a=m.oData[b][p];o=o.replace(Z,a)}Y=u(o);if($.isNumeric(Y)){_=this.mBindingInfos.value.parts.filter(function(a1){return(a1.path===p)});Y=W(Y,_[0].type.oFormatOptions.maxFractionDigits);this.setDoubleFontSize(true)}this.setValue(Y);this.getElementBinding().detachChange(X)}O=function(){var a="";if(t.getName()&&t.getDescription()){a=t.getName()+", "+t.getDescription()}else if(t.getName()&&!t.getDescription()){a=t.getName()}else if(!t.getName()&&t.getDescription()){a=t.getDescription()}return a};g=function(a){var b,e,i;b=a.slice(1).split("/");e="/";for(i=0;i<b.length;i+=1){if((b[i].indexOf("(")>0)&&(b[i].indexOf("sid(")<0)){break}else{e+=b[i]+"/"}}return e};c=function(a,m){var e,b,i,j;b=a.slice(m.sServiceUrl.length+1);if(b.indexOf("/")>=0){i=b.split("/");j=i[i.length];e=i[i.length-1];if(e.indexOf("(")>=0){e=e.slice(e.indexOf("("))}e=this.getNavEntitySet(e,j,m.getMetadata())}else{if(b.indexOf("(")>=0){e=b.slice(0,b.indexOf("("))}else{if(b.indexOf("?")>=0){e=b.slice(0,b.indexOf("?"))}else{e=b}}}return e};x=function(a,m){var e,k="",o,b;e=a.slice(m.sServiceUrl.length+1);if(e.indexOf("(")>=0){k=e.slice(e.indexOf("(")+1,e.indexOf(")"));if(k.indexOf("=")<=0){o=m.getServiceMetadata();b=f(c(a,m),o);k=y(b,o)+"="+k}}return k};y=function(e,m){var i,a,j;for(i=m.dataServices.schema.length-1;i>=0;i-=1){a=m.dataServices.schema[i];if(a.namespace===e.slice(0,e.lastIndexOf("."))){for(j=0;j<a.entityType.length;j+=1){if(a.entityType[j].name===e.slice(e.lastIndexOf(".")+1)){return a.entityType[j].key.propertyRef[0].name}}}}};d=function(e,m){var i,a,b,j;for(i=m.dataServices.schema.length-1;i>=0;i-=1){a=m.dataServices.schema[i];if(a.entityContainer){b=a.entityContainer[0].entitySet;for(j=b.length-1;j>=0;j-=1){if(b[j].entityType===e){return b[j].name}}}}};f=function(e,m,b){var i,a,k,j,o;for(i=m.dataServices.schema.length-1;i>=0;i-=1){a=m.dataServices.schema[i];if(a.entityContainer){k=a.entityContainer[0].entitySet;for(j=k.length-1;j>=0;j-=1){if(k[j].name===e){if(b){o=k[j].entityType.slice(a.namespace.length+1)}else{o=k[j].entityType}return o}}}}};h=function(e,a,m){var b,i,o,p,k,j,Y;b=e.split(".");for(i=m.dataServices.schema.length-1;i>=0;i-=1){o=m.dataServices.schema[i];p=b[0];if(b.length>2){for(k=1;k<b.length-1;k+=1){p+="."+b[k]}}if(o.namespace===p){for(j=0;j<o.entityType.length;j+=1){if(o.entityType[j].name===b[b.length-1]){if(o.entityType[j].navigationProperty){for(k=0;k<o.entityType[j].navigationProperty.length;k+=1){if(o.entityType[j].navigationProperty[k].name===a){Y=o.entityType[j].navigationProperty[k];return{name:Y.relationship,toRole:Y.toRole}}}}}}}}};l=function(e,a,m){var b,o,p,i,Y,j,Z,k;b=f(e,m);if(a.charAt(0)==="@"){if(M.termDefinitions&&M.termDefinitions[a]){o=M.termDefinitions[a];if(o.indexOf("Collection")>=0){o=o.slice(o.indexOf("(")+1,o.indexOf(")"))}return d(o,m)}}else{p=h(b,a,m);if(p){for(i=m.dataServices.schema.length-1;i>=0;i-=1){Y=m.dataServices.schema[i];if(Y.entityContainer&&Y.entityContainer[0].associationSet){for(j=Y.entityContainer[0].associationSet.length-1;j>=0;j-=1){Z=Y.entityContainer[0].associationSet[j];if(Z.association===p.name){for(k=0;k<Z.end.length;k+=1){if(Z.end[k].role===p.toRole){return Z.end[k].entitySet}}}}}}}}};n=function(e,a,m){var b,o,i,p,j,Y,k;b=f(e,m);o=h(b,a,m);if(o){for(i=m.dataServices.schema.length-1;i>=0;i-=1){p=m.dataServices.schema[i];for(j=p.association.length-1;j>=0;j-=1){Y=p.association[j];if(p.namespace+"."+Y.name===o.name){for(k=0;k<Y.end.length;k+=1){if(Y.end[k].role.substr(0,7)==="ToRole_"){return Y.end[k].multiplicity}}}}}}else{jQuery.sap.log.error("\""+a+"\" wasn't found in the metadata document. Check whether the corresponding search connector is active.");return 0}};q=function(e,m){var o,a,b,i;o={};if(M.expand){if(M.expand[f(e,m)]){a=M.expand[f(e,m)];b=[];for(i in a){if(a.hasOwnProperty(i)){b.push(a[i])}}o.expand=b.join(", ")}}return o};r=function(p,o){var b={},j;b.parts=[];b.parameters=[];for(j=p.length-1;j>=0;j-=1){if(p[j].Type==="Path"){if(p[j].EdmType){switch(p[j].EdmType){case"Edm.DateTimeOffset":case"Edm.DateTime":b.parts.push({path:p[j].Value,type:new sap.ui.model.type.DateTime()});break;case"Edm.Time":b.parts.push({path:p[j].Value+"/ms",type:new sap.ui.model.type.Time({source:{pattern:"timestamp"}})});break;case"Edm.Date":b.parts.push({path:p[j].Value,type:new sap.ui.model.type.Date()});break;case"Edm.Decimal":case"Edm.Double":case"Edm.Single":b.parts.push({path:p[j].Value,type:new sap.ui.model.type.Float()});break;case"Edm.Int16":case"Edm.Int32":case"Edm.Int64":b.parts.push({path:p[j].Value,type:new sap.ui.model.type.Integer()});break;default:b.parts.push({path:p[j].Value});break}}else{b.parts.push({path:p[j].Value})}}else if(p[j].Type==="String"){b.parameters.unshift({string:p[j].Value})}}b.formatter=function(){var a="",e,k,i,m,Y="",Z=false,_=0,a1=0;if(arguments&&arguments.length>=1){e=arguments.length-1;i="";m=0;if(p&&p[0]&&(p[0].Type==="String")&&(p[0].Value.substr(0,1)==="#")){Z=true}for(k=0;k<p.length;k+=1){if(p[k].Type==="Path"){i=arguments[e];if(!i||(i.length===0)){if(a.length>m){if(a.indexOf("(")>m){a=a.substr(0,m)}else{a=a.substr(0,m);i=a}}}else{if(Z){i=encodeURIComponent(i)}a+=i;_+=1}e-=1;m=a.length}else{m=a.length;Y=p[k].Value;if(Y.indexOf("(")!==-1){a1+=1}if((i&&i.length>0)||(Y.indexOf("(")!==-1)||(Y&&(Y.substr(0,1)==="#"))){a+=p[k].Value}else{Y=""}}}if(o){a=o(a)}a=a.trim();if((_===1)&&(a1>0)&&(a.substr(0,1)==="(")&&(a.substr(-1)===")")){a=a.substr(1,a.length-2)}return a.trim()}};return b};D=function(o,p){var k;for(k in o){if(o.hasOwnProperty(k)){if(k==="__metadata"){continue}else if(k===p){return o[k]}else if(typeof o[k]==="object"){return D(o[k],p)}}}};u=function(a){var i,b,e,j={},k;i=a.lastIndexOf("/");b=a.slice(0,i);e=a.slice(i+1);if(!s[a]){j=new sap.ui.model.json.JSONModel();j.loadData(b,null,false);s[a]=j.getData()}else{j=s[a]}if(s[a]&&s[a].d){if(!s[a].d[e]){k=D(s[a].d,e)}else{k=s[a].d[e]}}return k};v=function(o,e,m){var a,b,i,j;a=new sap.ui.core.Control();b=E(o.Value,o.EdmType,e);if(o.Value&&o.Value["com.sap.vocabularies.UI.v1.IsImageURL"]){a=new sap.m.Image({height:"50px"});if(b.BindingInfo){a.bindProperty("src",b.BindingInfo)}else{a.setProperty("src",b.String)}}else{if(o.UrlRef||o.Url||(o.Target&&o.Target.Path)){a=new sap.m.Link({wrapping:true})}else{a=new sap.m.Text();if(o.EdmType==="Edm.Decimal"||o.EdmType==="Edm.Double"||o.EdmType==="Edm.Single"||o.EdmType==="Edm.Int16"||o.EdmType==="Edm.Int32"||o.EdmType==="Edm.Int64"){a.setTextAlign(sap.ui.core.TextAlign.End)}}a.addStyleClass("sapFactsheetUtiDataField");if(b.BindingInfo){a.bindProperty("text",b.BindingInfo)}else{a.setProperty("text",b.String)}}if((o.RecordType==="com.sap.vocabularies.UI.v1.DataFieldWithNavigation")&&m){i=o.Target.Path;if(M[e][i.slice(1)]){if(i.charAt(0)==="@"){if(i.indexOf("/")<0){j=M[e][i.slice(1)].UrlRef}else{j=M[e][i.slice(1,i.indexOf("/"))].UrlRef}a.bindProperty("href",z(j))}}a.attachPress(function(k){return false})}if(o.RecordType==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"){if(o.Url.String){a.setHref(o.Url.String)}else{a.bindProperty("href",z(o.Url))}}return a};w=function(o,a,p,b){var e,i="",m="",Y,j,k,Z;e=new sap.m.Label(a);e.addStyleClass("sapFactsheetUtiLabel");if(b){i=":"}if(o.Label){if(o.Label.String){e.setText(o.Label.String.trim()+i);e.setTooltip(o.Label.String.trim())}else{if(o.Label.Path){e.bindProperty("text",o.Label.Path);e.bindProperty("tooltip",o.Label.Path)}}}else{if(o.Value){if(o.Value.Path&&p){Y=p[o.Value.Path];for(j in Y){if(Y.hasOwnProperty(j)){if(j==="http://www.sap.com/Protocols/SAPData"){if(Y[j].label){m=Y[j].label;break}}}}}else if(o.Value.Apply&&(o.Value.Apply.Name==="odata.concat")){for(k in o.Value.Apply.Parameters){if(o.Value.Apply.Parameters.hasOwnProperty(k)){Z=o.Value.Apply.Parameters[k];if(Z.Type==="Path"){Y=p[Z.Value];for(j in Y){if(Y.hasOwnProperty(j)){if(j==="http://www.sap.com/Protocols/SAPData"){if(Y[j].label){m=Y[j].label;break}}}}break}}}}e.setText(m+i);e.setTooltip(m)}}return e};E=function(o,e,a){var b={},p,k,m=[],j,Y,Z,_=[],a1,b1,i,c1,d1,e1,f1,g1=[];if(!o){return false}if(o.Apply){if(o.Apply.Name==="odata.concat"){if(a&&M.propertyAnnotations&&M.propertyAnnotations[a]){p=M.propertyAnnotations[a];k=o.Apply.Parameters;for(j=0;j<k.length;j+=1){if(k[j].Type==="Path"){m.push(k[j]);if(p&&p[k[j].Value]&&p[k[j].Value]["Org.OData.Measures.V1.ISOCurrency"]){m.push({Type:"String",Value:" "});if(p[k[j].Value]["Org.OData.Measures.V1.ISOCurrency"].Path){m.push({Type:"Path",Value:p[k[j].Value]["Org.OData.Measures.V1.ISOCurrency"].Path})}else{m.push({Type:"String",Value:p[k[j].Value]["Org.OData.Measures.V1.ISOCurrency"].String})}}else{if(p&&p[k[j].Value]&&p[k[j].Value]["Org.OData.Measures.V1.Unit"]){m.push({Type:"String",Value:" "});if(p[k[j].Value]["Org.OData.Measures.V1.Unit"].Path){m.push({Type:"Path",Value:p[k[j].Value]["Org.OData.Measures.V1.Unit"].Path})}else{m.push({Type:"String",Value:p[k[j].Value]["Org.OData.Measures.V1.Unit"].String})}}}}else{m.push(k[j])}}b.BindingInfo=r(m)}else{b.BindingInfo=r(o.Apply.Parameters)}}}else{if(o.Path){if(o.Path.charAt(0)==="@"){Y=M[a][o.Path.slice(1,o.Path.indexOf("/"))].UrlRef;Z=o.Path.slice(o.Path.indexOf("/")+1);if(Y&&Y.Apply){a1=Y.Apply.Parameters;switch(Y.Apply.Name){case"odata.concat":_=a1;_.push({Type:"String",Value:"/"+Z});break;case"odata.fillUriTemplate":b1=a1[0].Value.split("{");for(i in b1){if(b1.hasOwnProperty(i)){if(b1[i].indexOf("}")<0){_.push({Type:"String",Value:b1[i]})}else{c1=b1[i].split("}");for(j=1;j<a1.length;j+=1){if(a1[j].Name===c1[0]){d1=a1[j].Value;if(d1.Path){_.push({Type:"Path",Value:d1.Path})}else{if(d1.Apply&&(d1.Apply.Name==="odata.UriEncode")){e1=d1.Apply.Parameters[0];_.push({Type:e1.Type,Value:encodeURIComponent(e1.Value)});_.push({Type:"String",Value:"{"+encodeURIComponent(e1.Value)+"}"})}}}}_.push({Type:"String",Value:c1[1]})}}}_.push({Type:"String",Value:"/"+Z});b.fnChange=X;break;default:break}b.BindingInfo=r(_,u)}else{if(Y&&Y.Path){_.push({Type:"Path",Value:Y.Path},{Type:"String",Value:"/"+Z});b.BindingInfo=r(_,u)}else{if(Y&&Y.String){b.String=u(Y.String+"/"+Z)}}}}else{b.BindingInfo={};switch(e){case"Edm.DateTimeOffset":case"Edm.DateTime":b.BindingInfo={path:o.Path,type:new sap.ui.model.type.DateTime()};break;case"Edm.Time":b.BindingInfo={path:o.Path+"/ms",type:new sap.ui.model.type.Time({source:{pattern:"timestamp"}})};break;case"Edm.Date":b.BindingInfo={path:o.Path,type:new sap.ui.model.type.Date()};break;case"Edm.Decimal":case"Edm.Double":case"Edm.Single":case"Edm.Int16":case"Edm.Int32":case"Edm.Int64":if((e==="Edm.Decimal")||(e==="Edm.Double")||(e==="Edm.Single")){f1=new sap.ui.model.type.Float()}else if((e==="Edm.Int16")||(e==="Edm.Int32")||(e==="Edm.Int64")){f1=new sap.ui.model.type.Integer()}if(M.propertyAnnotations){p=M.propertyAnnotations[a];g1.push({Type:"Path",Value:o.Path,EdmType:e},{Type:"String",Value:" "});if(p&&p[o.Path]&&p[o.Path]["Org.OData.Measures.V1.ISOCurrency"]){if(p[o.Path]["Org.OData.Measures.V1.ISOCurrency"].Path){g1.push({Type:"Path",Value:p[o.Path]["Org.OData.Measures.V1.ISOCurrency"].Path})}else{g1.push({Type:"String",Value:p[o.Path]["Org.OData.Measures.V1.ISOCurrency"].String})}}else{if(p&&p[o.Path]&&p[o.Path]["Org.OData.Measures.V1.Unit"]){if(p[o.Path]["Org.OData.Measures.V1.Unit"].Path){g1.push({Type:"Path",Value:p[o.Path]["Org.OData.Measures.V1.Unit"].Path})}else{g1.push({Type:"String",Value:p[o.Path]["Org.OData.Measures.V1.Unit"].String})}}}b.BindingInfo=r(g1)}else{b.BindingInfo={path:o.Path,type:f1}}break;default:b.BindingInfo={path:o.Path};break}}}else{if(o.String){b.String=o.String}}}return b};z=function(o){var a=[],p,b,j,e,i={},k,m,Y;if(o&&o.Apply){p=o.Apply.Parameters;switch(o.Apply.Name){case"odata.fillUriTemplate":p[0].Value=p[0].Value.trim();b=p[0].Value.split("{");for(j=0;j<b.length;j+=1){if(b[j].indexOf("}")<0){a.push({"Value":b[j],"Type":"String"})}else{e=b[j].split("}");i={};i.Value=e[0];i.Type="Path";for(j=1;j<p.length;j+=1){if(p[j].Name===i.Value){k=p[j].Value;if(k.Path){i.Value=k.Path}else{if(k.Apply&&k.Apply.Name==="odata.UriEncode"){i.Value=k.Apply.Parameters[0].Value}}break}}a.push(i);a.push({"Value":e[1],"Type":"String"})}}m=sap.ushell.Container.getService("NavTargetResolution").getCurrentResolution();if(m&&m.url){Y=jQuery.sap.getUriParameters(m.url).get("sap-system");if(Y){a.push({Type:"String",Value:"&sap-system="+Y})}}break;default:break}}return r(a)};A=function(o){var a=sap.ui.core.TextAlign.Begin;if(o.EdmType==="Edm.Decimal"||o.EdmType==="Edm.Double"||o.EdmType==="Edm.Single"||o.EdmType==="Edm.Int16"||o.EdmType==="Edm.Int32"||o.EdmType==="Edm.Int64"){a=sap.ui.core.TextAlign.End}return a};F=function(m,e,a,o,b){var k,p,j=0,Y=0,Z=0,_=0,a1,i,b1,c1,d1;if(!b){b=m.getServiceMetadata()}if(!a){a=[]}k=f(e,b);d1=new sap.ui.layout.form.SimpleForm({labelMinWidth:150,maxContainerCols:2});p=(M.propertyExtensions)?M.propertyExtensions[k]:[];if(o&&o.High){Y=o.High}if(o&&o.Medium){Z=o.Medium}if(o&&o.Low){_=o.Low}for(i=0;i<a.length;i+=1){a1=P(a[i]);if(o&&(a1==="High")){if(Y){Y-=1}else{continue}}else if(o&&(a1==="Medium")){if(Z){Z-=1}else{continue}}else if(o&&(a1==="Low")){if(_){_-=1}else{continue}}if(o&&o.Total&&(j>=o.Total)){break}j+=1;b1=new sap.ui.core.Control().setModel(m);c1=w(a[i],{textAlign:sap.ui.core.TextAlign.End},p,false);c1.addStyleClass("sapFactsheetUtiFormPadding");b1=v(a[i],k,b);b1.addStyleClass("sapFactsheetUtiFormPadding");if(b1.setTextAlign){b1.setTextAlign(sap.ui.core.TextAlign.Begin)}d1.addContent(c1);d1.addContent(b1)}d1.addStyleClass("sapFactsheetUtiFormLayout");return d1};G=function(m,e,o,b){var a,j="",k,p,Y,Z,_,a1,b1,c1,d1,e1,f1=[],i,g1,h1,i1;a=m.getServiceMetadata();switch(o.RecordType){case"com.sap.vocabularies.UI.v1.ReferenceFacet":k=new sap.suite.ui.commons.UnifiedThingGroup();if(o.Label&&o.Label.String){k.setTitle(o.Label.String)}p=o.Target.AnnotationPath;Y=p.substring(p.lastIndexOf("@")+1);p=p.substring(0,p.lastIndexOf("@")-1);if(p){j=n(e,p,a)}Z=Y.split("#");switch(Z[0]){case"com.sap.vocabularies.UI.v1.LineItem":case"com.sap.vocabularies.UI.v1.Chart":case"com.sap.vocabularies.UI.v1.Badge":case"com.sap.vocabularies.UI.v1.Identification":if(p){_=l(e,p,a);g1=f(_,a)}else{g1=f(e,a)}if(Z[0]==="com.sap.vocabularies.UI.v1.Chart"){Y="com.sap.vocabularies.UI.v1.LineItem"}h1=M[g1][Y];i1=M.propertyExtensions[g1];if(j==="*"&&Z[0]!=="com.sap.vocabularies.UI.v1.Identification"){a1=H(m,h1,g1,a,b+"/"+p,o,i1);k.setContent(a1)}if(Z[0]==="com.sap.vocabularies.UI.v1.Identification"){b1=M[g1]["com.sap.vocabularies.UI.v1.Identification"];c1=new sap.ui.layout.VerticalLayout({width:"100%"}).setModel(m);if(p){c1.addContent(F(m,_,b1)).addStyleClass("sapFactsheetUtiPanel").bindElement(b+"/"+p)}else{c1.addContent(F(m,e,b1).addStyleClass("sapFactsheetUtiPanel"))}k.setContent(c1)}break;case"com.sap.vocabularies.UI.v1.StatusInfo":if(p){_=l(e,p,a);d1=M[f(_,a)]["com.sap.vocabularies.UI.v1.StatusInfo"];k.setContent(F(m,_,d1).addStyleClass("sapFactsheetUtiPanel").bindElement(b+"/"+p))}else{d1=M[f(e,a)]["com.sap.vocabularies.UI.v1.StatusInfo"];k.setContent(F(m,e,d1).addStyleClass("sapFactsheetUtiPanel"))}break;case"com.sap.vocabularies.UI.v1.FieldGroup":e1=M[f(e,a)][Y];if(e1){if(!k.getTitle()||(k.getTitle()==="")){if(e1.Label){if(e1.Label.String){k.setTitle(e1.Label.String)}else{if(e1.Label.Path){k.bindProperty("title",e1.Label.Path)}}}}if(p){_=l(e,p,a);k.setContent(F(m,_,e1.Data).addStyleClass("sapFactsheetUtiPanel").bindElement(b+"/"+p))}else{k.setContent(F(m,e,e1.Data).addStyleClass("sapFactsheetUtiPanel"))}}break;default:break}return k;case"com.sap.vocabularies.UI.v1.ReferenceURLFacet":k=new sap.ui.ux3.ThingGroup({title:o.Label.String});k.setContent(B(o));return k;case"com.sap.vocabularies.UI.v1.CollectionFacet":for(i=0;i<o.Facets.length;i+=1){f1.push(G(m,e,o.Facets[i],b))}return f1;default:break}};B=function(o){var i,a,b;switch(o.UrlContentType.String){case"image/png":case"image/jpeg":case"image/gif":i=new sap.m.Image({width:"100%"});if(o.Url.String){i.setSrc(o.Url.String)}return i;default:a=new sap.ui.core.HTML();if(o.Url.String){a.setContent("<iframe src = '"+o.Url.String+"' width='100%' height='250px' frameborder='0'></iframe>")}else{if(o.Url.Path){a.bindProperty("content",{path:o.Url.Path,formatter:function(e){b="<iframe src = '"+o.Url.Path+"' width='100%' height='250px' frameborder='0'></iframe>";return b}})}}return a}};H=function(m,a,e,o,b,Y,Z){var _,a1,b1,c1,d1,i,k,e1=[],f1=[],g1=[],h1=[],i1,j1,k1,l1,m1,n1,o1,p1=[],q1,r1,s1,t1=[],u1,v1,w1,x1,y1,z1,A1,B1,C1,D1=false,E1,F1;C1=sap.ui.getCore().getLibraryResourceBundle("sap.suite.ui.commons");if(!o){o=m.getServiceMetadata()}_=(M.propertyExtensions)?M.propertyExtensions[e]:[];a1=6;if(jQuery.device.is.tablet&&jQuery.device.is.landscape){a1=5}else if(jQuery.device.is.tablet&&jQuery.device.is.portrait){a1=4}else if(jQuery.device.is.phone&&jQuery.device.is.landscape){a1=3}else if(jQuery.device.is.phone&&jQuery.device.is.portrait){a1=2}b1=0;c1=0;for(i=0;i<a.length;i+=1){d1=P(a[i]);if(d1==="High"){b1+=1}}if(a1>b1){c1=a1-b1}else if(a1<b1){b1=a1}f1.push(new sap.m.Column({visible:false}));e1.push(new sap.m.Text().bindText("__metadata/uri"));for(i=0;i<a.length;i+=1){F1="";k1=new sap.ui.core.Control();d1=P(a[i]);k1=v(a[i],e,o);i1=w(a[i],null,_);if(a[i].Value.Path){s1=a[i].Value.Path;if(Z[s1]&&Z[s1]["http://www.sap.com/Protocols/SAPData"]&&Z[s1]["http://www.sap.com/Protocols/SAPData"].sortable){i1.data("IsSortable",Z[s1]["http://www.sap.com/Protocols/SAPData"].sortable);if(Z[s1]["http://www.sap.com/Protocols/SAPData"].sortable==="true"){D1=true}}else{i1.data("IsSortable","true");D1=true}if(Z[s1]&&Z[s1]["http://www.sap.com/Protocols/SAPData"]&&Z[s1]["http://www.sap.com/Protocols/SAPData"].filterable){i1.data("IsFilterable",Z[s1]["http://www.sap.com/Protocols/SAPData"].filterable);if(Z[s1]["http://www.sap.com/Protocols/SAPData"].filterable==="true"){D1=true}}else{i1.data("IsFilterable","true");D1=true}}else{E1=true;for(k=0;k<a[i].Value.Apply.Parameters.length;k+=1){if(a[i].Value.Apply.Parameters[k].Type==="Path"){s1=a[i].Value.Apply.Parameters[k].Value;if(Z[s1]&&Z[s1]["http://www.sap.com/Protocols/SAPData"]&&Z[s1]["http://www.sap.com/Protocols/SAPData"].sortable){if(Z[s1]["http://www.sap.com/Protocols/SAPData"].sortable==="false"){E1=false;F1="";break}}if(F1){F1+=";"}F1+=s1}}s1=F1;if(E1===false){i1.data("IsSortable","false")}else{i1.data("IsSortable","true");D1=true}i1.data("IsFilterable","false")}if(a[i].EdmType){i1.data("EdmType",a[i].EdmType)}i1.data("ColumnName",s1);g1.push(i1);h1.push(k1);if(d1==="High"){if(b1>0){j1=true;b1-=1}else{j1=false}}else if(d1==="Medium"){if(c1>0){j1=true;c1-=1}else{j1=false}}else{j1=false}f1.push(new sap.m.Column({header:i1,hAlign:A(a[i]),visible:j1}));e1.push(k1)}l1=new sap.m.ColumnListItem({type:sap.m.ListType.Navigation,unread:false,cells:e1});if(Y){m1=Y.Label.String}l1.attachPress({aColumns:a,aLabels:g1,aControls:h1,sTitle:m1},function(j,p){var G1={},H1,I1,i1,i,J1,K1;G1.items={};H1=j.getSource().getCells()[0].getText().substr(j.getSource().getCells()[0].getText().lastIndexOf("/"));I1=new sap.m.Table({backgroundDesign:sap.m.BackgroundDesign.Transparent,showSeparators:sap.m.ListSeparators.None,columns:[new sap.m.Column({hAlign:sap.ui.core.TextAlign.End}),new sap.m.Column()]});I1.addStyleClass("sapFactsheetUtiPanel");I1.addStyleClass("sapFactsheetUtiTilePadding");I1.addStyleClass("sapFactsheetUtiTableNoTopBorder");I1.bindElement(H1);for(i=0;i<a.length;i+=1){i1=g1[i].clone();i1.setText(i1.getText()+":");I1.addItem(new sap.m.ColumnListItem({cells:[i1,h1[i].clone()]}))}J1=new sap.suite.ui.commons.UnifiedThingGroup({content:I1,title:m1,description:O()});K1=new sap.m.Page({title:t.getTitle(),showNavButton:true,content:[J1]});t.navigateToPage(K1,true)});n1=new sap.m.Table({growing:true,columns:f1});n1.setModel(m);n1.bindItems({path:b,template:l1});v1=new sap.m.VBox({items:[new sap.m.Input({placeholder:C1.getText("USHELL_FACTSHEET_ENTER_YOUR_FILTER"),change:function(j){var p,G1,H1,I1,i;p=j.getSource().getParent().getParent().getId();G1=sap.ui.getCore().byId(p.substr(0,p.indexOf("-")));H1=G1.getFilterItems();for(i=0;i<H1.length;i+=1){if(H1[i]instanceof sap.m.ViewSettingsCustomItem&&H1[i].getKey()===this.oParent.data("ColumnName")){I1=H1[i];break}}if(I1){if((j.getParameter("newValue")===undefined)||(j.getParameter("newValue")==="")){I1.setSelected(false);I1.setFilterCount(0)}else{I1.setSelected(true);I1.setFilterCount(1)}}}}).addStyleClass("sapFactsheetUtiFilterInput")]});w1=new sap.m.VBox({items:[new sap.m.List({mode:sap.m.ListMode.SingleSelectLeft,includeItemInSelection:true,items:[new sap.m.StandardListItem({title:C1.getText("USHELL_FACTSHEET_GREATER_THEN")}).data("FilterOperator",sap.ui.model.FilterOperator.GT),new sap.m.StandardListItem({title:C1.getText("USHELL_FACTSHEET_EQUALS")}).data("FilterOperator",sap.ui.model.FilterOperator.EQ),new sap.m.StandardListItem({title:C1.getText("USHELL_FACTSHEET_LESS_THEN")}).data("FilterOperator",sap.ui.model.FilterOperator.LT)]}),new sap.m.Input({placeholder:C1.getText("USHELL_FACTSHEET_ENTER_YOUR_FILTER"),change:function(j){var p,G1,H1,I1,i;p=j.getSource().getParent().getParent().getId();G1=sap.ui.getCore().byId(p.substr(0,p.indexOf("-")));H1=G1.getFilterItems();for(i=0;i<H1.length;i+=1){if((H1[i]instanceof sap.m.ViewSettingsCustomItem)&&(H1[i].getKey()===this.oParent.data("ColumnName"))){I1=H1[i];break}}if(I1){if((j.getParameter("newValue")===undefined)||(j.getParameter("newValue")==="")){I1.setSelected(false);I1.setFilterCount(0)}else{I1.setSelected(true);I1.setFilterCount(1)}}}}).addStyleClass("sapFactsheetUtiFilterInput")]});x1=new sap.m.VBox({items:[new sap.m.List({mode:sap.m.ListMode.SingleSelectLeft,includeItemInSelection:true,items:[new sap.m.StandardListItem({title:C1.getText("USHELL_FACTSHEET_AFTER")}).data("FilterOperator",sap.ui.model.FilterOperator.GT),new sap.m.StandardListItem({title:C1.getText("USHELL_FACTSHEET_AT")}).data("FilterOperator",sap.ui.model.FilterOperator.EQ),new sap.m.StandardListItem({title:C1.getText("USHELL_FACTSHEET_BEFORE")}).data("FilterOperator",sap.ui.model.FilterOperator.LT)]}),new sap.m.DateTimeInput({type:sap.m.DateTimeInputType.Date,valueFormat:new sap.ui.model.type.DateTime({pattern:"yyyy/MM/dd HH:mm:ss UTC+00:00"}).getOutputPattern(),placeholder:C1.getText("USHELL_FACTSHEET_ENTER_YOUR_FILTER"),change:function(j){var p,G1,H1,I1,i;p=j.getSource().getParent().getParent().getId();G1=sap.ui.getCore().byId(p.substr(0,p.indexOf("-")));H1=G1.getFilterItems();for(i=0;i<H1.length;i+=1){if((H1[i]instanceof sap.m.ViewSettingsCustomItem)&&(H1[i].getKey()===this.oParent.data("ColumnName"))){I1=H1[i];break}}if((j.getParameter("newValue")===undefined)||(j.getParameter("newValue")==="")){I1.setSelected(false);I1.setFilterCount(0)}else{I1.setSelected(true);I1.setFilterCount(1)}}}).addStyleClass("sapFactsheetUtiFilterInput")]});y1=function(k1){var j=[],i,p,G1=k1.getItems(),H1;if(G1[0].getParent().data("EdmType")==="Edm.String"&&G1[0].getValue()){j.push(new sap.ui.model.Filter(G1[0].getParent().data("ColumnName"),sap.ui.model.FilterOperator.Contains,G1[0].getValue()))}else if(G1[0].getParent().data("EdmType")==="Edm.Decimal"&&G1[1].getValue()){for(i=0;i<G1[0].getItems().length;i+=1){if(G1[0].getItems()[i].getSelected()===true){p=G1[0].getItems()[i].data("FilterOperator");break}}H1=G1[1].getValue();for(i=H1.length-1;i>0;i-=1){if(H1[i]===","){H1=H1.replace(H1[i],".");break}}j.push(new sap.ui.model.Filter(G1[1].getParent().data("ColumnName"),p,H1))}else if(G1[0].getParent().data("EdmType")==="Edm.Date"&&G1[1].getValue()){for(i=0;i<G1[0].getItems().length;i+=1){if(G1[0].getItems()[i].getSelected()===true){p=G1[0].getItems()[i].data("FilterOperator");break}}j.push(new sap.ui.model.Filter(G1[1].getParent().data("ColumnName"),p,G1[1].getValue()))}else{j.push(new sap.ui.model.Filter(G1[0].getParent().data("ColumnName"),sap.ui.model.FilterOperator.EQ,G1[0].getValue()))}return j};z1=function(p){var G1=p.getSource(),H1=G1.getFilterItems(),I1,i,j;for(i=0;i<H1.length;i+=1){if(H1[i]&&H1[i]instanceof sap.m.ViewSettingsCustomItem){H1[i].setSelected(false);H1[i].setFilterCount(0);I1=H1[i].getCustomControl().getItems();for(j=0;j<I1.length;j+=1){if((I1[j]instanceof sap.m.Input)||(I1[j]instanceof sap.m.DateTimeInput)){I1[j].setValue("")}if((I1[j]instanceof sap.m.List)&&(I1[j].getSelectedItem()!==null)){I1[j].removeSelections()}}}}};A1=z1;for(i=0;i<f1.length;i+=1){if(f1[i+1]){i1=g1[i].clone();if(i1.getText()&&(i1.data("IsSortable")==="true")&&f1[i+1].getVisible()){q1=new sap.m.ViewSettingsItem({text:i1.getText(),key:i1.data("ColumnName")});if(i===0){q1.setSelected(true)}q1.Sort=i1.Sort;p1.push(q1)}if(i1.getText()&&(i1.data("IsFilterable")==="true")){if(i1.data("EdmType")==="Edm.String"){B1=v1.clone().data("ColumnName",i1.data("ColumnName")).data("EdmType",i1.data("EdmType"))}else if(i1.data("EdmType")==="Edm.Decimal"){B1=w1.clone().data("ColumnName",i1.data("ColumnName")).data("EdmType",i1.data("EdmType"))}if((i1.data("EdmType")==="Edm.String")||(i1.data("EdmType")==="Edm.Decimal")){u1=new sap.m.ViewSettingsCustomItem({key:i1.data("ColumnName"),text:i1.getText(),customControl:B1,customData:new sap.ui.core.CustomData({key:"callback",value:y1})});t1.push(u1)}}}}r1=new sap.m.ViewSettingsDialog({sortItems:p1,filterItems:t1,cancel:A1,resetFilters:z1,confirm:function(j){var G1,H1,I1=[],J1,K1=[],L1,M1=[],N1=[],p,i,O1;G1=j.getParameters();H1=n1.getBinding("items");if(G1.sortItem){J1=G1.sortItem.getKey();L1=G1.sortDescending;if(J1.indexOf(";")>0){K1=J1.split(";");for(i=0;i<K1.length;i+=1){I1.push(new sap.ui.model.Sorter(K1[i],L1))}}else if(J1){I1.push(new sap.ui.model.Sorter(J1,L1))}H1.sort(I1)}p=G1;for(i=0;i<p.filterItems.length;i+=1){if(p.filterItems[i]instanceof sap.m.ViewSettingsCustomItem){O1=p.filterItems[i].getCustomData()[0].getValue();M1=O1.apply(this,[p.filterItems[i].getCustomControl()]);if(M1){if(!Array.isArray(M1)){M1=[M1]}N1=N1.concat(M1)}}else if(p.filterItems[i]instanceof sap.m.ViewSettingsItem){M1=p.filterItems[i].getCustomData()[0].getValue();if(M1){if(!Array.isArray(M1)){M1=[M1]}N1=N1.concat(M1)}}}H1.filter(N1)}});if(D1===true&&(p1.length>0||t1.length>0)){n1.setHeaderToolbar(new sap.m.Toolbar({content:[new sap.m.Label(),new sap.m.ToolbarSpacer(),new sap.m.Button({icon:"sap-icon://drop-down-list",press:function(j){r1.open()}})]}))}n1.setNoDataText(sap.ui.getCore().getLibraryResourceBundle("sap.m").getText("PULL2REFRESH_LOADING_LONG"));o1=function(){if(this.getItems().length===0){this.setNoDataText(C1.getText("FACETOVERVIEW_NO_CONTENT_TEXT"))}else{this.setNoDataText(sap.ui.getCore().getLibraryResourceBundle("sap.m").getText("PULL2REFRESH_LOADING_LONG"))}};n1.attachUpdateFinished(o1);return n1};I=function(a,o,b,e){var i;switch(a){case"com.sap.vocabularies.UI.v1.ChartType/Area":i=new sap.viz.ui5.Area({});break;case"com.sap.vocabularies.UI.v1.ChartType/Bar":i=new sap.viz.ui5.Bar({});break;case"com.sap.vocabularies.UI.v1.ChartType/Bubble":i=new sap.viz.ui5.Bubble({});break;case"com.sap.vocabularies.UI.v1.ChartType/Column":i=new sap.viz.ui5.Column({});break;case"com.sap.vocabularies.UI.v1.ChartType/ColumnStacked":i=new sap.viz.ui5.StackedColumn({});break;case"com.sap.vocabularies.UI.v1.ChartType/ColumnStacked100":i=new sap.viz.ui5.StackedColumn100({});break;case"com.sap.vocabularies.UI.v1.ChartType/Donut":i=new sap.viz.ui5.Donut({});break;case"com.sap.vocabularies.UI.v1.ChartType/HeatMap":i=new sap.viz.ui5.Heatmap({});break;case"com.sap.vocabularies.UI.v1.ChartType/HorizontalArea":i=new sap.viz.ui5.HorizontalArea({});break;case"com.sap.vocabularies.UI.v1.ChartType/Line":i=new sap.viz.ui5.Line({});break;case"com.sap.vocabularies.UI.v1.ChartType/Pie":i=new sap.viz.ui5.Pie({});break;case"com.sap.vocabularies.UI.v1.ChartType/Scatter":i=new sap.viz.ui5.Scatter({});break;case"com.sap.vocabularies.UI.v1.ChartType/TreeMap":i=new sap.viz.ui5.Treemap({});break;case"com.sap.vocabularies.UI.v1.ChartType/AreaStacked":case"com.sap.vocabularies.UI.v1.ChartType/AreaStacked100":case"com.sap.vocabularies.UI.v1.ChartType/BarStacked":case"com.sap.vocabularies.UI.v1.ChartType/BarStacked100":case"com.sap.vocabularies.UI.v1.ChartType/HorizontalAreaStacked":case"com.sap.vocabularies.UI.v1.ChartType/HorizontalAreaStacked100":case"com.sap.vocabularies.UI.v1.ChartType/Radar":case"com.sap.vocabularies.UI.v1.ChartType/Waterfall":break}if(i){if(o&&o.String){i.setTitle(new sap.viz.ui5.types.Title({visible:true,text:o.String}))}if(b&&b.String){i.setTooltip(b.String)}i.setWidth("100%");i.setHeight("17rem");i.setDataset(e)}else{i=new sap.m.Text({})}return i};J=function(i){var a;i=i||1;if(jQuery.device.is.phone){a=(7*i)+"rem"}else{a=(11*i-1)+"rem"}return a};K=function(a){var i,b=0,e=0,j=0,o;for(i=0;i<a.length;i+=1){o=P(a[i]);if(o){switch(o){case"High":b+=1;break;case"Medium":e+=1;break;case"Low":j+=1;break}}}return{High:b,Medium:e,Low:j}};P=function(o){var e="";if(o.Importance){e=o.Importance.EnumMember}else if(o["com.sap.vocabularies.UI.v1.Importance"]){e=o["com.sap.vocabularies.UI.v1.Importance"].EnumMember}return e.substr(e.indexOf("/")+1)};N=function(m,a,e,b){var i=false,o,j,k,p;o=new sap.suite.ui.commons.KpiTile({doubleFontSize:false});if(a.ValueFormat){j=a.ValueFormat.NumberOfFractionalDigits.Int}if(a.Title&&a.Title.String){o.setDescription(a.Title.String)}else{if(a.Title&&a.Title.Path){o.bindProperty("description",{path:a.Title.Path})}}if(a.Value&&a.Value.String){o.setValue(a.Value.String)}else{if(a.Value&&a.Value.Path){k=E(a.Value,a.Value.EdmType,e);if(k.fnChange){o.setModel(m);o.bindElement(b);o.getElementBinding().attachChange(k.fnChange,o)}if(k.String){if($.isNumeric(k.String)){i=true;o.setValue(W(k.String,j))}else{o.setValue(k.String)}}else if(k.BindingInfo){p=k.BindingInfo;if(p.parts&&p.parts.length===2){o.bindProperty("valueUnit",p.parts[0]);p.parts[1].type=undefined;p.parts[1].formatter=(function(){return function(Y){return W(Y,j)}}(j));o.bindProperty("value",p.parts[1])}else if(p.parts&&p.parts.length===1){p.parts[0].type=undefined;p.parts[0].formatter=(function(){return function(Y){return W(Y,j)}}(j));o.bindProperty("value",p)}else{o.bindProperty("value",p)}}}}if(a.Value.EdmType==="Edm.Decimal"||a.Value.EdmType==="Edm.Double"||a.Value.EdmType==="Edm.Single"||a.Value.EdmType==="Edm.Int16"||a.Value.EdmType==="Edm.Int32"||a.Value.EdmType==="Edm.Int64"||i===true){o.setDoubleFontSize(true)}return o};C=function(e,p,t){var Y,Z,_,a1,b1,c1,d1,e1,i,f1={},g1,h1,i1,j1,j,k,k1,l1,m1,n1,o1,p1,q1,r1,s1,t1=0,u1=0,v1,w1,x1,y1,z1,A1,B1,C1=[],D1,E1,F1,G1,H1,I1,J1,K1,L1,M1,N1,O1,P1,Q1,m,R1,S1,T1,U1,V1,W1,X1=0,Y1,Z1,$1,_1,a2,b2,c2,d2;Y=g(e);p1=p.substring(0,p.substring(0,p.lastIndexOf("/")).lastIndexOf("/"));q1=p.substring(p.substring(0,p.lastIndexOf("/")).lastIndexOf("/"));if(window.location.search.indexOf("cbn_keep_anno_case%3Dtrue")===-1){q1=q1.toLowerCase()}Z=new sap.ui.model.odata.ODataModel(Y,{annotationURI:p1+q1,loadAnnotationsJoined:true,loadMetadataAsync:false,json:true});Z.setCountSupported(false);t.setModel(Z);_=c(e,Z);a1="/"+e.slice(Y.length);b1=Z.getServiceMetadata();M=Z.getServiceAnnotations();c1=f(_,b1);d1=M[c1]["com.sap.vocabularies.UI.v1.HeaderInfo"];e1=M[c1]["com.sap.vocabularies.UI.v1.Facets"];t.bindElement(a1,q(_,b1));r1=sap.ui.getCore().getLibraryResourceBundle("sap.suite.ui.commons");t.addStyleClass("sapFactsheetUtiThingType"+_.replace(/\s/g,""));if(d1.TypeName.String){t.setTitle(d1.TypeName.String)}else{if(d1.TypeName.Path){t.bindProperty("title",{path:d1.TypeName.Path})}}if(d1.ImageUrl&&d1.ImageUrl.String){t.setIcon(d1.ImageUrl.String)}else if(d1.ImageUrl&&d1.ImageUrl.Path){t.bindProperty("icon",{path:d1.ImageUrl.Path})}else if(d1.TypeImageUrl&&d1.TypeImageUrl.String){t.setIcon(d1.TypeImageUrl.String)}else if(d1.TypeImageUrl&&d1.TypeImageUrl.Path){t.bindProperty("icon",{path:d1.TypeImageUrl.Path})}if(d1.Title.Value.String){t.setName(d1.Title.Value.String)}else{t.bindProperty("name",E(d1.Title.Value,d1.Title.EdmType,c1).BindingInfo)}if(d1.Description&&d1.Description.Value){if(d1.Description.Value.String){t.setDescription(d1.Description.Value.String)}else{t.bindProperty("description",E(d1.Description.Value,d1.Description.EdmType,c1).BindingInfo)}}for(Y1 in M[c1]){if(M[c1].hasOwnProperty(Y1)){if(Y1.search("com.sap.vocabularies.UI.v1.DataPoint")!==-1){Z1=M[c1][Y1];if(Z1){t.addKpi(N(Z,Z1,c1,a1));X1+=1}}if(X1>=3){break}}}for(i=0;i<e1.length;i+=1){if(e1[i]["com.sap.vocabularies.UI.v1.IsSummary"]){l1=e1[i];break}}if(l1){s1=15;for(j=0;j<l1.Facets.length;j+=1){v1=l1.Facets[j].Target.AnnotationPath.substring(l1.Facets[j].Target.AnnotationPath.lastIndexOf("@")+1);g1=l1.Facets[j].Target.AnnotationPath;g1=g1.substring(0,g1.lastIndexOf("@")-1);l1.Facets[j].NavPath=g1;w1=l(_,g1,b1);l1.Facets[j].NavEntitySet=w1;if(w1){x1=w1}else{x1=_}l1.Facets[j].EntitySet=x1;y1=f(w1,b1);if(y1){z1=y1}else{z1=c1}l1.Facets[j].EntityType=z1;A1=[];if(M[z1][v1].length){A1=M[z1][v1]}else if(M[z1][v1].Data.length){A1=M[z1][v1].Data}l1.Facets[j].Content=A1;for(i=0;i<A1.length;i+=1){B1=P(A1[i]);if(B1==="High"){t1+=1}else if(B1==="Medium"){u1+=1}}}if((t1+u1)>s1){u1=s1-t1;if(u1<0){u1=0}}if(jQuery.device.is.phone){u1=0}F1=s1-t1-u1;G1=[];I1=u1+t1;for(j=0;j<l1.Facets.length;j+=1){J1=F(Z,l1.Facets[j].EntitySet,l1.Facets[j].Content,{High:t1,Medium:u1,Low:0},null).addStyleClass("sapFactsheetUtiTilePadding").addStyleClass("sapFactsheetUtiTable");if(j>0){J1.addStyleClass("sapFactsheetUtiPaddingTop")}if(l1.Facets[j].NavPath){J1.bindElement(a1+"/"+l1.Facets[j].NavPath)}H1=K(l1.Facets[j].Content);t1-=H1.High;u1-=H1.Medium;if(((H1.High>0)&&((t1+H1.High)>0))||((H1.Medium>0)&&((u1+H1.Medium)>0))){G1.push(J1);if(j>0){if(F1>0){F1-=1}else if(u1>0){u1-=1}else if(t1>0){t1-=1}}}if((t1<1)&&(u1<1)){break}}if(t1<0){t1=0}if(u1<0){u1=0}f1=new sap.ui.layout.VerticalLayout({content:G1,width:"100%"});K1=J();M1=1;if((I1>3)&&(I1<=9)){K1=J(2);M1=2}else if(I1>9){K1=J(3);M1=3}N1=new sap.suite.ui.commons.FacetOverview({title:r1.getText("UNIFIEDTHINGINSPECTOR_GENERAL_INFORMATION_HEADER_TEXT"),rowSpan:M1,content:f1});if(jQuery.device.is.phone){N1.setHeightType(sap.suite.ui.commons.FacetOverviewHeight.Auto)}else{N1.setHeight(K1)}N1.addStyleClass("sapFactsheetUtiGeneralInformationOverviewFacet");N1.attachPress({facets:l1},function(o,a){var b,e2,f2,g2,f1;t.removeAllFacetContent();f2=new sap.suite.ui.commons.UnifiedThingGroup();f2.setDescription(O());f2.setTitle(r1.getText("UNIFIEDTHINGINSPECTOR_GENERAL_INFORMATION_HEADER_TEXT"));f2.addStyleClass("sapFactsheetUtiGeneralInformationUtg");if(a.facets.Facets.length>1){b="L6 M12 S12"}else{b="L12 M12 S12"}g2=new sap.ui.layout.VerticalLayout({width:"100%"});for(i=0;i<a.facets.Facets.length;i+=1){if(i%2===0){e2=new sap.ui.layout.Grid({hSpacing:1,vSpacing:1,defaultSpan:b})}f1=G(Z,_,a.facets.Facets[i],a1);f1.addStyleClass("sapFactsheetUtiGeneralInformationUtgContent");if((i===0)&&(a.facets.Facets.length>1)&&(f1.getTitle().trim()==="")){f1.setTitle(r1.getText("UNIFIEDTHINGINSPECTOR_GENERAL_INFORMATION_HEADER_TEXT"))}e2.addContent(f1);if(i%2!==0){g2.addContent(e2)}}if(i%2!==0){g2.addContent(e2)}f2.setContent(g2);t.addFacetContent(f2);t.navigateToDetail()});t.addFacet(N1)}i1=function(j1){return function(a){var o,b,e2,f2,g2,h2,i2,j2,k2,l2,a1,m2,n2,o2,p2,q2,r2,s2,t2,i;if((j1.cardinality==="*"&&a.results&&a.results.length&&a.results.length!==0)||(j1.cardinality==="1"&&a)){l2=new sap.ui.model.json.JSONModel();if(j1.cardinality==="*"){if(a.results&&a.results.length){l2.setData(a)}}else{l2.setData({result:a});a1="/result"}o=new sap.ui.model.odata.ODataModel("/sap/opu/odata/sap/VBI_APPL_DEF_SRV",false);b=M[j1.navigationType]["com.sap.vocabularies.UI.v1.GeoLocation"];n2=M[j1.navigationType]["com.sap.vocabularies.UI.v1.HeaderInfo"];o2=M[j1.navigationType]["com.sap.vocabularies.UI.v1.Identification"];if(b.Longitude&&b.Latitude){f2={"Data":{"Set":{"N":[{"name":"Spots","E":[]}]}}};if(j1.cardinality==="1"){if(b.Longitude.Path&&b.Latitude.Path){e2=a[b.Longitude.Path]+";"+a[b.Latitude.Path]+";0"}f2.Data.Set.N[0].E.push({"A":e2,"I":"pin_blue.png"})}else{for(i=0;i<a.results.length;i+=1){if(b.Longitude.Path&&b.Latitude.Path){e2=a.results[i][b.Longitude.Path]+";"+a.results[i][b.Latitude.Path]+";0"}f2.Data.Set.N[0].E.push({"A":e2,"I":"pin_blue.png"})}if(a.results.length!==0){e2=a.results[0][b.Longitude.Path]+";"+a.results[0][b.Latitude.Path]+";0"}}}t2=parseInt(a.__count,10);if(Number(t2)){j1.facet.setQuantity(t2)}i2=function(u2){var v2,w2,x2,y2,z2;v2=$.parseJSON(u2.getParameters().data);if(v2.Action.name==="DETAIL_REQUEST"&&v2.Action.instance){w2=v2.Action.instance;if(l2.oData.results){a1="/results/"+w2.split(".")[1]}s2=n2.TypeName.String.substring(0,17);y2=parseFloat(J(0.7))*16;z2=parseFloat(J(1.5))*16;x2={"SAPVB":{"version":"2.0","xmlns:VB":"VB","Windows":{"Remove":{"name":"Detail1"},"Set":{"name":"Detail1","Window":{"id":"Detail1","type":"callout","refParent":"Main","refScene":"","offsetX":"16","offsetY":"-27","modal":"false","width":z2,"height":y2,"caption":s2,"pos.bind":w2+".GeoPosition"}}},"Scenes":{"Set":{"name":"Details","Scene":{"id":"Details","navControlVisible":"false"}}}}};this.load(x2)}};j2=function(u2){var Y1,v2,w1,w2;if(!p2){p2=v(n2.Title,j1.navigationType,b1);p2.setModel(l2);p2.bindElement(a1);q2=v(n2.Description,j1.navigationType,b1);q2.setModel(l2);q2.bindElement(a1);for(Y1 in b.Address){if(Y1==="label"){m2=v({Value:b.Address[Y1]},j1.navigationType,b1);m2.setModel(l2);m2.bindElement(a1);break}}w2=7;if(jQuery.device.is.tablet&&jQuery.device.is.landscape){w2=4}else if(jQuery.device.is.tablet&&jQuery.device.is.portrait){w2=5}else if(jQuery.device.is.phone&&jQuery.device.is.landscape){w2=2}else if(jQuery.device.is.phone&&jQuery.device.is.portrait){w2=3}r2=new sap.ui.layout.VerticalLayout({width:"100%"}).setModel(Z);if(j1.navigationPath){w1=l(j1.entitySet,j1.navigationPath,b1);r2.addContent(F(Z,w1,o2,{High:w2})).setModel(l2).bindElement(a1)}else{r2.addContent(F(Z,j1.entitySet,o2,{High:w2})).setModel(l2).bindElement(a1)}}else{p2.bindElement(a1);if(q2){q2.bindElement(a1)}if(m2){m2.bindElement(a1)}if(r2){r2.bindElement(a1)}}v2=parseFloat(J(1.5))*16*0.95+"px";if(p2){p2.placeAt(u2.getParameter("contentarea").id);p2.addStyleClass("sapFactsheetUtiGeoPopupHead");if(jQuery.device.is.phone){p2.addStyleClass("sapFactsheetUtiGeoPopupHeadFontPhone")}p2.setWidth(v2)}if(q2){q2.placeAt(u2.getParameter("contentarea").id);q2.addStyleClass("sapFactsheetUtiGeoPopupDescr");if(jQuery.device.is.phone){q2.addStyleClass("sapFactsheetUtiGeoPopupDescrFontPhone")}q2.setWidth(v2)}if(m2){m2.placeAt(u2.getParameter("contentarea").id);m2.addStyleClass("sapFactsheetUtiGeoPopupText");m2.setWidth(v2)}if(r2&&r2.getContent()[0]&&r2.getContent()[0].getContent&&r2.getContent()[0].getContent().length>0){r2.placeAt(u2.getParameter("contentarea").id);r2.addStyleClass("sapFactsheetUtiGeoPopupText");r2.setWidth(v2)}};k2=function(u2){if(p2){p2.destroy();p2=undefined}if(q2){q2.destroy();q2=undefined}if(m2){m2.destroy();m2=undefined}if(r2){r2.destroy();r2=undefined}$(u2.getParameter("contentarea").id).empty()};g2=function(j1){return function(a){var u2,v2,w2,x2,i;x2=a.ProjectJSON;x2=x2.indexOf("{")?x2.substr(x2.indexOf("{")):x2;u2=$.parseJSON(x2);u2.SAPVB.Scenes.Set.SceneGeo.initialStartPosition=e2;u2.SAPVB.Scenes.Set.SceneGeo.initialZoom=12;u2.SAPVB.Actions.Set.Action.push({id:"200",name:"TAP_ON_MAP",refEvent:"Click",refScene:"MainScene",refVO:"Map"});if(f2){u2.SAPVB.Data=f2.Data}for(i=0;i<u2.SAPVB.Scenes.Set.SceneGeo.VO.length;i+=1){if(u2.SAPVB.Scenes.Set.SceneGeo.VO[i].datasource==="Spots"){if(u2.SAPVB.Scenes.Set.SceneGeo.VO[i].scale&&u2.SAPVB.Scenes.Set.SceneGeo.VO[i].scale.split(";").length!==3){u2.SAPVB.Scenes.Set.SceneGeo.VO[i].scale="1.0;1.0;1.0";break}}}j1.facet.getContent().attachSubmit(function(y2){if(jQuery.device.is.tablet||jQuery.device.is.phone){j1.facet.firePress()}});j1.facet.getContent().load(u2);j1.facet.attachPress("",function(y2,z2){var A2=[],B2=[],i,C2;if(!v2){v2=new sap.ui.vbm.VBI({width:"100%",height:"100%",plugin:false,config:null});v2.addStyleClass("sapFactsheetUtiGeoPopup")}u2.SAPVB.Scenes.Set.SceneGeo.NavigationDisablement.move="false";u2.SAPVB.Scenes.Set.SceneGeo.NavigationDisablement.zoom="false";u2.SAPVB.Scenes.Set.SceneGeo.NavigationDisablement.pitch="false";u2.SAPVB.Scenes.Set.SceneGeo.NavigationDisablement.yaw="false";u2.SAPVB.Scenes.Set.SceneGeo.SuppressedNavControlVisibility="false";v2.load(u2);if(j1.cardinality==="*"){for(i=0;i<l2.oData.results.length;i+=1){A2.push(l2.oData.results[i][b.Longitude.Path]);B2.push(l2.oData.results[i][b.Latitude.Path])}}v2.attachSubmit(i2);v2.attachOpenWindow(j2);v2.attachCloseWindow(k2);w2=new sap.suite.ui.commons.UnifiedThingGroup({content:v2,title:j1.facetContent.Label.String,description:O()});t.removeAllFacetContent();t.addFacetContent(w2);t.navigateToDetail();t.attachAfterNavigate(A2,function(y2){if(y2.getParameters().getParameters().toId.indexOf("-detail-page")!==-1){if(jQuery.device.is.phone){C2="300px"}else{C2=Math.floor($("#"+y2.getParameters().getParameters().toId+"-cont").height()-128)+"px"}v2.setHeight(C2);if(A2.length>1){v2.zoomToGeoPosition(A2,B2)}}})})}};h2=function(u2){return function(v2){t.removeFacet(u2)}};o.read("VBIApplicationSet('ZFACTSHEETS')","","",false,g2(j1),h2(j1.facet))}else{j1.facet.setQuantity(undefined);j1.facet.addStyleClass("sapFactsheetUtiEmptyTile");j1.facet.setHeightType(jQuery.device.is.phone?sap.suite.ui.commons.FacetOverviewHeight.Auto:sap.suite.ui.commons.FacetOverviewHeight.S);j1.facet.setContent(undefined);j1.facet.setTitle(undefined)}}};c2=function(o){var a,b;a=o.srcControl.getParent().getDomRef().clientWidth;b=a;if(o.srcControl.getParent().getContent()[0]){b-=o.srcControl.getParent().getContent()[0].getDomRef().clientWidth;if(a<o.srcControl.getParent().getContent()[0].getDomRef().clientWidth){o.srcControl.getParent().getContent()[0].getDomRef().setAttribute("style","width:"+a+"px");return}}if(o.srcControl.getParent().getContent()[1]){b-=o.srcControl.getParent().getContent()[1].getDomRef().clientWidth}if(b<10){b=0}if(o.srcControl.getParent().getContent()[2]){o.srcControl.getParent().getContent()[2].getDomRef().setAttribute("style","width:"+b+"px")}};h1=function(j1){return function(a){var o,b,e2,f2,g2,h2,i2,j2,i,f1,k2,l2,m2,n2,o2,p2,q2,r2,s2,t2,u2,v2,w2,x2,y2,z2,A2="",B2,C2,D2,E2,F2,G2;o=new sap.ui.model.json.JSONModel();if(j1.facetContent.Target&&j1.facetContent.Target.AnnotationPath&&j1.facetContent.Target.AnnotationPath.split("#")[1]&&M[j1.navigationType]["com.sap.vocabularies.UI.v1.Badge#"+j1.facetContent.Target.AnnotationPath.split("#")[1]]){b=M[j1.navigationType]["com.sap.vocabularies.UI.v1.Badge#"+j1.facetContent.Target.AnnotationPath.split("#")[1]]}else{b=M[j1.navigationType]["com.sap.vocabularies.UI.v1.Badge"]}if(j1.cardinality==="*"){if(a.results&&a.results.length){o.setData(a);B2=j1.facetContent.Target.AnnotationPath;$1=B2.substring(B2.lastIndexOf("@")+1);if($1==="com.sap.vocabularies.UI.v1.Chart"){jQuery.sap.require("sap.viz.ui5.data.FlattenedDataset");C2=M[j1.navigationType]["com.sap.vocabularies.UI.v1.Chart"];D2=M.propertyExtensions[j1.navigationType];E2=[];for(i=0;i<C2.Dimensions.length;i+=1){E2.push({axis:1,name:D2[C2.Dimensions[i].PropertyPath]["http://www.sap.com/Protocols/SAPData"].label,value:"{"+C2.Dimensions[i].PropertyPath+"}"})}F2=[];for(i=0;i<C2.Measures.length;i+=1){F2.push({name:D2[C2.Measures[i].PropertyPath]["http://www.sap.com/Protocols/SAPData"].label,value:"{"+C2.Measures[i].PropertyPath+"}"})}G2=new sap.viz.ui5.data.FlattenedDataset({dimensions:E2,measures:F2,data:{path:"/results"}});f1=I(C2.ChartType.EnumMember,C2.Title,C2.Description,G2);f1.setModel(o);j1.facet.setHeightType(jQuery.device.is.phone?sap.suite.ui.commons.FacetOverviewHeight.Auto:sap.suite.ui.commons.FacetOverviewHeight.XL)}else{e2=function(H2,I2){f2=v(b.Title,j1.navigationType,b1);g2=I2.oModel.oData.results[I2.sPath.substring(I2.sPath.lastIndexOf("/")+1)];if(b.Title.RecordType&&(b.Title.RecordType==="com.sap.vocabularies.UI.v1.DataField")){f2.addStyleClass("sapFactsheetUtiLabel")}if(b.MainInfo){h2=v(b.MainInfo,j1.navigationType,b1)}else{h2=new sap.m.Text({text:""})}f2.setWrapping(false);f2.addDelegate({onAfterRendering:function(J2){c2(J2)}});i2=new sap.ui.layout.HorizontalLayout().addStyleClass("sapFactsheetUtiHorizontalLayout");j2=false;if(g2[b.Title.Value.Path]){j2=true}if(b.Title.Value.Apply){for(i=0;i<b.Title.Value.Apply.Parameters.length;i+=1){if(b.Title.Value.Apply.Parameters[i].Type==="Path"){if(g2[b.Title.Value.Apply.Parameters[i].Value]){j2=true;break}}}}A2="";if(j2){i2.addContent(f2);if(b.MainInfo&&((b.MainInfo.EdmType&&b.MainInfo.EdmType==="Edm.Decimal")||(b.MainInfo.Value&&b.MainInfo.Value.Apply&&b.MainInfo.Value.Apply.Parameters[0]&&b.MainInfo.Value.Apply.Parameters[0].EdmType&&b.MainInfo.Value.Apply.Parameters[0].EdmType==="Edm.Decimal"))){A2="comma"}else if(b.MainInfo&&b.MainInfo.Value.Path&&g2[b.MainInfo.Value.Path]){A2="dash"}else if(b.MainInfo&&b.MainInfo.Value.Apply){for(i=0;i<b.MainInfo.Value.Apply.Parameters.length;i+=1){if(b.MainInfo.Value.Apply.Parameters[i].Type==="Path"){if(g2[b.MainInfo.Value.Apply.Parameters[i].Value]){A2="dash";break}}}}if(A2==="dash"){i2.addContent(new sap.ui.core.HTML({content:"<span class=\"sapFactsheetUtiSeparatorPadding sapMText\"> &ndash; </span>"}))}if(A2==="comma"){i2.addContent(new sap.m.Text({text:", "}).addStyleClass("sapFactsheetUtiSeparatorPaddingForDecimal"))}}if(b.MainInfo){h2.setWrapping(false);h2.addDelegate({onAfterRendering:function(J2){c2(J2)}});i2.addContent(h2)}return new sap.m.ColumnListItem({cells:[i2]})};f1=new sap.m.Table({backgroundDesign:sap.m.BackgroundDesign.Transparent,showSeparators:sap.m.ListSeparators.None,columns:[new sap.m.Column({width:"100%"})],items:{path:"/results",factory:e2}});f1.setModel(o);f1.addStyleClass("sapFactsheetUtiTilePadding");f1.addStyleClass("sapFactsheetUtiTable");f1.addStyleClass("sapFactsheetUtiTableNoHorizontalPadding");f1.addStyleClass("sapFactsheetUtiTableNoTopBorder")}k2=parseInt(a.__count,10);if(Number(k2)){j1.facet.setQuantity(k2)}j1.facet.setContent(f1);j1.facet.attachPress({facet:j1.facetContent},function(H2,g2){var f1;t.removeAllFacetContent();f1=G(Z,j1.entitySet,g2.facet,j1.bindingPath);f1.setDescription(O());t.addFacetContent(f1);t.navigateToDetail()})}else{j1.facet.setQuantity(0);j1.facet.addStyleClass("sapFactsheetUtiEmptyTile");j1.facet.setHeightType(jQuery.device.is.phone?sap.suite.ui.commons.FacetOverviewHeight.Auto:sap.suite.ui.commons.FacetOverviewHeight.S)}}else{o.setData({result:a});for(y2 in a){if(a.hasOwnProperty(y2)){if(y2!=="__metadata"){if(typeof a[y2]==="string"&&a[y2]){if(parseInt(a[y2],10)!==0){z2=true;break}}else if(typeof a[y2]==="number"&&parseInt(a[y2],10)!==0){z2=true;break}}}}if(z2){l2=new sap.ui.layout.VerticalLayout();m2=(M.propertyExtensions)?M.propertyExtensions[j1.navigationType]:[];n2=new sap.ui.layout.HorizontalLayout().addStyleClass("sapFactsheetUtiHLayoutLabelValue");o2=w(b.Title,{},m2,true).addStyleClass("sapFactsheetUtiLabelMargin");f2=v(b.Title,j1.navigationType,b1);f2.setModel(o);f2.bindElement("/result");n2.addContent(o2);n2.addContent(f2);l2.addContent(n2);if(b.MainInfo){p2=new sap.ui.layout.HorizontalLayout().addStyleClass("sapFactsheetUtiHLayoutLabelValue");q2=w(b.MainInfo,{},m2,true).addStyleClass("sapFactsheetUtiLabelMargin");h2=v(b.MainInfo,j1.navigationType,b1);h2.setModel(o);h2.bindElement("/result");p2.addContent(q2);p2.addContent(h2);l2.addContent(p2)}if(b.SecondaryInfo){r2=new sap.ui.layout.HorizontalLayout().addStyleClass("sapFactsheetUtiHLayoutLabelValue");s2=w(b.SecondaryInfo,{},m2,true).addStyleClass("sapFactsheetUtiLabelMargin");t2=v(b.SecondaryInfo,j1.navigationType,b1);t2.setModel(o);t2.bindElement("/result");r2.addContent(s2);r2.addContent(t2);l2.addContent(r2)}if(b.TypeImageUrl||b.ImageUrl){if(b.ImageUrl){u2=b.ImageUrl}else{u2=b.TypeImageUrl}v2=new sap.ui.layout.HorizontalLayout();w2="64px";if(jQuery.device.is.phone){w2="48px"}if(u2.String&&(u2.String.substr(0,11)==="sap-icon://")){x2=new sap.ui.core.Icon({size:w2,width:w2})}else{x2=new sap.m.Image({width:w2})}x2.addStyleClass("sapFactsheetUtiRelIcon");if(u2&&u2.String){x2.setSrc(u2.String)}else{if(u2&&u2.Path){x2.bindProperty("src",u2.Path)}}v2.addContent(x2);v2.addContent(l2);j1.facet.setContent(v2)}else{j1.facet.setContent(l2)}j1.facet.attachPress({facet:j1.facetContent},function(H2,g2){var f1;t.removeAllFacetContent();f1=G(Z,j1.entitySet,g2.facet,j1.bindingPath);f1.setDescription(O());t.addFacetContent(f1);t.navigateToDetail()})}else{j1.facet.addStyleClass("sapFactsheetUtiEmptyTile");j1.facet.setHeightType(jQuery.device.is.phone?sap.suite.ui.commons.FacetOverviewHeight.Auto:sap.suite.ui.commons.FacetOverviewHeight.S)}}}};b2=function(j1){return function(a){t.removeFacet(j1.facet)}};_1=function(j1){return function(a){var o,b,i,e2,f2;b=M[j1.navigationType]["com.sap.vocabularies.UI.v1.MediaResource"];if(j1.cardinality==="*"){if(a.results&&a.results.length){o=new sap.ui.layout.HorizontalLayout().addStyleClass("sapFactsheetUtiPictureViewerOverview");for(i=0;i<a.results.length;i+=1){o.addContent(new sap.m.Image({src:a.results[i][b.Thumbnail.Url.Path],height:"85px"}));if(i===3){break}}e2=parseInt(a.__count,10);if(Number(e2)){j1.facet.setQuantity(e2)}j1.facet.setContent(o);j1.facet.attachPress({facet:j1.facetContent,data:a},function(g2,h2){var i2,a2,j2;t.removeAllFacetContent();f2=new sap.suite.ui.commons.UnifiedThingGroup();if(h2.facet.Label&&h2.facet.Label.String){f2.setTitle(h2.facet.Label.String)}f2.setDescription(O());if(jQuery.device.is.phone){a2="350px"}else{a2="550px"}i2=new sap.m.Carousel({height:a2});for(i=0;i<h2.data.results.length;i+=1){j2=new sap.m.Image({src:h2.data.results[i][b.Url.Path]});if(jQuery.device.is.phone){j2.addStyleClass("sapFactsheetUtiCarouselMaxImageHeightPhone")}else{j2.addStyleClass("sapFactsheetUtiCarouselMaxImageHeight")}i2.addPage(j2)}f2.setContent(i2);t.addFacetContent(f2);t.navigateToDetail()})}else{j1.facet.setQuantity(0);j1.facet.addStyleClass("sapFactsheetUtiEmptyTile");j1.facet.setHeightType(jQuery.device.is.phone?sap.suite.ui.commons.FacetOverviewHeight.Auto:sap.suite.ui.commons.FacetOverviewHeight.S)}}}};d2=function(o,e2){var i,j,f2=[],g2={},h2,i2,j2,k2,l2,m2;i2=function(b1,a){var i,b="";if(b1){if(b1.Path){return a[b1.Path]}else if(b1.String){return b1.String}else if(b1.Apply.Name==="odata.concat"){for(i=0;i<b1.Apply.Parameters.length;i+=1){if(b1.Apply.Parameters[i].Type==="Path"){b=b+a[b1.Apply.Parameters[i].Value]}else if(b1.Apply.Parameters[i].Type==="String"){b=b+b1.Apply.Parameters[i].Value}}return b}}};g2.iCount=0;g2.aContacts=[];for(i=0;i<o.__batchResponses.length;i+=1){if(!o.__batchResponses[i].data){continue}if(o.__batchResponses[i].data.__count){g2.iCount=g2.iCount+parseInt(o.__batchResponses[i].data.__count)}else{g2.iCount=o.__batchResponses[i].data.results?g2.iCount:g2.iCount+=1}f2=o.__batchResponses[i].data.results;if(!f2){f2=[];f2.push(o.__batchResponses[i].data)}if(f2.length>0){h2=M[f2[0].__metadata.type]["com.sap.vocabularies.Communication.v1.Contact"];if(h2){for(j=0;j<f2.length;j+=1){l2=h2.phone&&h2.phone.uri?h2.phone.uri:"";m2=h2.email&&h2.email.address?h2.email.address:"";j2=i2(l2,f2[j]);j2=j2?j2.replace("tel:",""):"";k2=i2(h2.photo,f2[j]);g2.aContacts.push({fn:i2(h2.fn,f2[j]),title:i2(h2.title,f2[j]),phone:j2,photo:k2,email:i2(m2,f2[j]),sEntity:f2[0].__metadata.type,bExistsPhoto:k2?true:false,bUseIcon:k2?false:true,sOrder:j})}}}}if(e2){g2.aContacts.sort(function(a,b){return a[e2]>b[e2]?1:-1})}return g2};E1=function(j1){return function(o){var i,a,b,e2,f2,g2,h2,i2;a=d2(o,"sOrder");b=new sap.ui.layout.Grid({defaultSpan:"L6 M6 S12",hSpacing:0,vSpacing:0}).addStyleClass("sapFactsheetUtiContactsGrid");for(i=0;i<a.aContacts.length&&i<4;i+=1){g2=new sap.ui.layout.VerticalLayout();if(a.aContacts[i].photo){h2=new sap.m.Image({height:"55px",src:a.aContacts[i].photo})}else{h2=new sap.ui.core.Icon({size:"50px",src:sap.ui.core.IconPool.getIconURI("person-placeholder")}).addStyleClass("sapFactsheetUtiRelIcon")}g2.addContent(h2);g2.addStyleClass("sapFactsheetUtiContactsImage");f2=new sap.ui.layout.VerticalLayout({content:[new sap.m.Text({text:a.aContacts[i].fn}).addStyleClass("sapFactsheetUtiTextName"),new sap.m.Text({text:a.aContacts[i].title}).addStyleClass("sapFactsheetUtiTextValue")]});e2=new sap.ui.layout.HorizontalLayout({content:[g2,f2]}).addStyleClass("sapFactsheetUtiContactsBox");b.addContent(e2)}N1=sap.ui.getCore().byId(t.data("contactFacetId"));N1.setQuantity(a.iCount);if(i>0){N1.setContent(b);if(i<=2){i2=sap.suite.ui.commons.FacetOverviewHeight.M}else{i2=sap.suite.ui.commons.FacetOverviewHeight.L}N1.attachPress(function(){var i,C1=[],D1;Z.clearBatch();for(i=0;i<M[c1]["com.sap.vocabularies.UI.v1.Contacts"].length;i+=1){g1=M[c1]["com.sap.vocabularies.UI.v1.Contacts"][i].AnnotationPath;g1=g1.substring(0,g1.lastIndexOf("@")-1);if(g1!==""){D1=a1+"/"+g1}else{D1=a1}C1.push(Z.createBatchOperation(D1,"GET"))}Z.addBatchReadOperations(C1);Z.submitBatch(function(o){var a,j2,k2,l2,m2,n2,o2;o2=jQuery.sap.resources({url:jQuery.sap.getModulePath("sap.ushell.components.container.")+"/resources/resources.properties",language:sap.ui.getCore().getConfiguration().getLanguage()});a=d2(o,"sEntity");j2=new sap.ui.model.json.JSONModel();j2.setData(a);k2=new sap.m.ColumnListItem({type:sap.m.Inactive,unread:false,cells:[new sap.ui.layout.VerticalLayout({content:[new sap.m.Image({src:"{photo}",width:"74px",visible:"{bExistsPhoto}"}),new sap.ui.core.Icon({size:"76px",src:sap.ui.core.IconPool.getIconURI("person-placeholder"),visible:"{bUseIcon}"}).addStyleClass("sapFactsheetUtiRelIcon")]}),new sap.m.Text({text:"{fn}"}),new sap.m.Text({text:"{title}"}),new sap.m.Link({text:"{phone}",href:"tel:{phone}"}),new sap.m.Link({text:"{email}",href:"mailto:{email}"})]});l2=new sap.m.Table({threshold:2,inset:false,showUnread:true,scrollToLoad:true,columns:[new sap.m.Column({hAlign:sap.ui.core.TextAlign.Center,header:new sap.m.Text({text:""})}),new sap.m.Column({hAlign:sap.ui.core.TextAlign.Begin,header:new sap.m.Text({text:o2.getText("USHELL_FACTSHEET_NAME")})}),new sap.m.Column({hAlign:sap.ui.core.TextAlign.Begin,header:new sap.m.Text({text:o2.getText("USHELL_FACTSHEET_JOBTITLE")}),minScreenWidth:"Tablet",demandPopin:true}),new sap.m.Column({hAlign:sap.ui.core.TextAlign.Begin,width:"30%",header:new sap.m.Text({text:o2.getText("USHELL_FACTSHEET_PHONE")}),minScreenWidth:"Tablet",demandPopin:true}),new sap.m.Column({hAlign:sap.ui.core.TextAlign.Begin,width:"30%",header:new sap.m.Text({text:o2.getText("USHELL_FACTSHEET_EMAIL")}),minScreenWidth:"Tablet",demandPopin:true})],items:{path:"/aContacts",template:k2}});m2=new sap.m.ViewSettingsDialog({sortItems:[new sap.m.ViewSettingsItem({key:"fn",text:o2.getText("USHELL_FACTSHEET_NAME")}),new sap.m.ViewSettingsItem({key:"title",text:o2.getText("USHELL_FACTSHEET_JOBTITLE")}),new sap.m.ViewSettingsItem({key:"phone",text:o2.getText("USHELL_FACTSHEET_PHONE")}),new sap.m.ViewSettingsItem({key:"email",text:o2.getText("USHELL_FACTSHEET_EMAIL")})],confirm:function(p2){var q2,r2,s2=[];q2=p2.getParameters();r2=l2.getBinding("items");if(q2.sortItem){s2.push(new sap.ui.model.Sorter(q2.sortItem.getKey(),q2.sortDescending));r2.sort(s2)}}});l2.setHeaderToolbar(new sap.m.Toolbar({content:[new sap.m.Label(),new sap.m.ToolbarSpacer(),new sap.m.Button({icon:"sap-icon://drop-down-list",press:function(p2){m2.open()}})]}));l2.setModel(j2);n2=new sap.suite.ui.commons.UnifiedThingGroup({title:N1.getTitle(),description:O(),content:l2});t.removeAllFacetContent();t.addFacetContent(n2);t.navigateToDetail()})})}else{i2=sap.suite.ui.commons.FacetOverviewHeight.S;N1.addStyleClass("sapFactsheetUtiEmptyTile");N1.setQuantity(0)}N1.setHeightType(jQuery.device.is.phone?sap.suite.ui.commons.FacetOverviewHeight.Auto:i2)}};for(i=0;i<e1.length;i+=1){if(e1[i]["com.sap.vocabularies.UI.v1.Map"]){g1=e1[i].Target.AnnotationPath;g1=g1.substring(0,g1.lastIndexOf("@")-1);T1="1";P1=c1;if(g1){Q1=c1.split(".");for(m=b1.dataServices.schema.length-1;m>=0;m-=1){R1=b1.dataServices.schema[m];S1=Q1[0];if(Q1.length>2){for(k=1;k<Q1.length-1;k+=1){S1+="."+Q1[k]}}if(R1.namespace===S1&&R1.association){for(j=0;j<R1.association.length;j+=1){if(R1.association[j].name===g1){P1=R1.association[j].end[1].type}}}}T1=n(_,g1,b1)}a2="100%";if(jQuery.device.is.phone){a2="150px"}O1=new sap.ui.vbm.VBI({width:"100%",height:a2,plugin:false,config:null});N1=new sap.suite.ui.commons.FacetOverview({title:e1[i].Label.String,heightType:jQuery.device.is.phone?sap.suite.ui.commons.FacetOverviewHeight.Auto:sap.suite.ui.commons.FacetOverviewHeight.L,content:O1});j1={cardinality:T1,navigationPath:g1,facet:N1,facetContent:e1[i],navigationType:P1,metadata:b1,bindingPath:a1,entitySet:_};if(T1==="*"){U1=["$inlinecount=allpages","$top=1000"]}else{U1=[]}Z.read(a1+"/"+g1,"",U1,true,i1(j1));t.addFacet(N1)}else{if(e1[i].Target){g1=e1[i].Target.AnnotationPath;g1=g1.substring(0,g1.lastIndexOf("@")-1);$1=e1[i].Target.AnnotationPath.substring(e1[i].Target.AnnotationPath.lastIndexOf("@")+1);if(g1){Q1=c1.split(".");for(m=b1.dataServices.schema.length-1;m>=0;m-=1){R1=b1.dataServices.schema[m];S1=Q1[0];if(Q1.length>2){for(k=1;k<Q1.length-1;k+=1){S1+="."+Q1[k]}}if(R1.namespace===S1&&R1.association){for(j=0;j<R1.association.length;j+=1){if(R1.association[j].name===g1){P1=R1.association[j].end[1].type}}}}N1=new sap.suite.ui.commons.FacetOverview({title:e1[i].Label.String,heightType:jQuery.device.is.phone?sap.suite.ui.commons.FacetOverviewHeight.Auto:sap.suite.ui.commons.FacetOverviewHeight.M});T1=n(_,g1,b1);if(T1!==0){j1={cardinality:T1,navigationPath:g1,facet:N1,facetContent:e1[i],navigationType:P1,metadata:b1,bindingPath:a1,entitySet:_};if(e1[i]["com.sap.vocabularies.UI.v1.Gallery"]){if(T1==="*"){U1=["$inlinecount=allpages"]}else{U1=[]}Z.read(a1+"/"+g1,"",U1,true,_1(j1))}else{if(T1==="*"){U1=["$inlinecount=allpages","$top=3"]}else{U1=[]}Z.read(a1+"/"+g1,"",U1,true,h1(j1),b2(j1))}t.addFacet(N1)}}else{if($1==="com.sap.vocabularies.UI.v1.Contacts"){N1=new sap.suite.ui.commons.FacetOverview({title:e1[i].Label.String,heightType:jQuery.device.is.phone?sap.suite.ui.commons.FacetOverviewHeight.Auto:sap.suite.ui.commons.FacetOverviewHeight.M});t.data("contactFacetId",N1.sId);j1={facet:N1};Z.clearBatch();for(j=0;j<M[c1][$1].length;j+=1){g1=M[c1][$1][j].AnnotationPath;g1=g1.substring(0,g1.lastIndexOf("@")-1);if(g1!==""){T1=n(_,g1,b1);if(T1==="*"){D1=a1+"/"+g1+"?$top=4"+"&$inlinecount=allpages"}else{D1=a1+"/"+g1}}else{D1=a1}C1.push(Z.createBatchOperation(D1,"GET"))}Z.addBatchReadOperations(C1);Z.submitBatch(E1(j1));t.addFacet(N1)}}}}}L1=new sap.ushell.ui.footerbar.AddBookmarkButton();W1=function(){var b,i,$1,a,e2,f2={},Y1,g2,h2,i2,o;L1.setAppData({title:t.getTitle(),subtitle:t.getName()+" - "+t.getDescription()});L1.setEnabled(true);h2=f(_,b1,true);n1=new sap.suite.ui.commons.LinkActionSheet({showCancelButton:true,placement:sap.m.PlacementType.Top});k1=x(e,Z);b=k1.split(",");for(i=0;i<b.length;i+=1){b[i]=b[i].replace("='","=","g");if(b[i].lastIndexOf("'")===b[i].length-1){b[i]=b[i].slice(0,-1)}}for($1 in M[c1]){if(M[c1].hasOwnProperty($1)){if($1.indexOf("com.sap.vocabularies.Common.v1.SecondaryKey")===0){a=M[c1][$1];for(i=0;i<a.length;i+=1){e2=this.getBoundContext().getProperty(a[i].PropertyPath);if(e2){b.push(a[i].PropertyPath+"="+e2)}}}}}for(i=0;i<b.length;i+=1){Y1=b[i].substr(0,b[i].indexOf("="));g2=b[i].substr(b[i].indexOf("=")+1,b[i].length);f2[Y1]=g2}m1=sap.ushell.Container.getService("CrossApplicationNavigation").getSemanticObjectLinks(h2,f2);m1.done(jQuery.proxy(function(j2){var i,k2;for(i=0;i<j2.length;i+=1){if(j2[i].intent.indexOf(Q)<0){k2=sap.ushell.Container.getService("CrossApplicationNavigation").hrefForExternal({target:{shellHash:j2[i].intent}});n1.addItem(new sap.m.Link({text:j2[i].text,href:k2}));t.setTransactionsVisible(true)}}}));t.attachTransactionsButtonPress(function(j2){n1.openBy(j2.getParameter("caller"))});this.detachChange(W1);sap.ushell.services.AppConfiguration.setWindowTitle(t.getTitle().trim()+": "+t.getName().trim()+" ("+t.getDescription().trim()+")");t.setActionsVisible(true);V1=new sap.m.Button({text:r1.getText("UNIFIEDTHINGINSPECTOR_FOOTER_BUTTON_EMAIL_LINK"),icon:"sap-icon://email",press:function(oE){sap.m.URLHelper.triggerEmail("",t.getName(),window.location.href)}});o1=new sap.m.ActionSheet({placement:sap.m.PlacementType.Top});i2=e.substr(0,e.lastIndexOf("/")+1);for(var o in Z.oData){if(Z.oData.hasOwnProperty(o)){i2=i2+o;break}}o1.addButton(new sap.ushell.ui.footerbar.JamDiscussButton({jamData:{object:{id:i2,type:e.substr(0,e.lastIndexOf("/"))+"/$metadata#"+_,name:t.getTitle(),ui_url:window.location.href}}}));o1.addButton(new sap.ushell.ui.footerbar.JamShareButton({jamData:{object:{id:window.location.href,display:new sap.m.Text({text:t.getTitle()}),share:""}}}));o1.addButton(L1);o1.addButton(V1);t.attachActionsButtonPress(function(j2){o1.openBy(j2.getParameter("caller"))})};t.getElementBinding().attachChange(W1);t.attachBackAction(function(o){history.back()});t.addDelegate({onAfterRendering:function(){t._adjustFacetLayout()}});return t};return{ThingInspector:function(a,b){try{t=C(a,b,new sap.suite.ui.commons.UnifiedThingInspector({configurationVisible:false}))}catch(e){throw e}return t}}}())}());
