(function(){"use strict";sap.ui.controller("tiles.indicatorArea.AreaChartTile",{onInit:function(){var t=this;this.firstTimeVisible=false;this.oKpiTileView=this.getView();this.oViewData=this.oKpiTileView.getViewData(),this.oTileApi=this.oViewData.chip;if(this.oTileApi.visible){this.oTileApi.visible.attachVisible(this.visibleHandler.bind(this))}this.system=this.oTileApi.url.getApplicationSystem();this.oKpiTileView.oGenericTile.setState(sap.suite.ui.commons.LoadState.Loading);try{sap.ushell.components.tiles.indicatorTileUtils.util.getParsedChip(this.oTileApi.configuration.getParameterValueAsString("tileConfiguration"),function(c){t.oConfig=c;t.setTextInTile();if(t.oTileApi.preview){t.oTileApi.preview.setTargetUrl(sap.ushell.components.tiles.indicatorTileUtils.util.getNavigationTarget(t.oConfig,t.system))}if(t.oTileApi.preview.isEnabled()){t._updateTileModel({footer:"",description:"",width:"100%",height:"100%",chart:{color:"Good",data:[{day:0,balance:0},{day:30,balance:20},{day:60,balance:20},{day:100,balance:80}]},target:{color:"Error",data:[{day:0,balance:0},{day:30,balance:30},{day:60,balance:40},{day:100,balance:90}]},maxThreshold:{color:"Good",data:[{day:0,balance:0},{day:30,balance:40},{day:60,balance:50},{day:100,balance:100}]},innerMaxThreshold:{color:"Error",data:[]},innerMinThreshold:{color:"Neutral",data:[]},minThreshold:{color:"Error",data:[{day:0,balance:0},{day:30,balance:20},{day:60,balance:30},{day:100,balance:70},]},minXValue:0,maxXValue:100,minYValue:0,maxYValue:100,firstXLabel:{label:"June 123",color:"Error"},lastXLabel:{label:"June 30",color:"Error"},firstYLabel:{label:"0M",color:"Good"},lastYLabel:{label:"80M",color:"Critical"},minLabel:{},maxLabel:{}});t.oKpiTileView.oGenericTile.setState(sap.suite.ui.commons.LoadState.Loaded)}else{t.oKpiTileView.oGenericTile.attachPress(function(){sap.ushell.components.tiles.indicatorTileUtils.util.abortPendingODataCalls(t.trendChartODataReadRef);sap.ushell.components.tiles.indicatorTileUtils.cache.setKpivalueById(t.oConfig.TILE_PROPERTIES.id,null);window.location.hash=sap.ushell.components.tiles.indicatorTileUtils.util.getNavigationTarget(t.oConfig,t.system)});if(Number(t.oTileApi.configuration.getParameterValueAsString("isSufficient"))){sap.ushell.components.tiles.indicatorTileUtils.cache.setEvaluationById(t.oConfig.TILE_PROPERTIES.id,t.oConfig);t.flowWithoutDesignTimeCall()}else{t.flowWithDesignTimeCall()}}})}catch(e){this.logError(e)}},getTile:function(){return this.oKpiTileView.oGenericTile},_setLocalModelToTile:function(){if(this.getTile().getModel()){}else{this.getTile().setModel(new sap.ui.model.json.JSONModel({}))}},_updateTileModel:function(n){var m=this.getTile().getModel().getData();jQuery.extend(m,n);this.getTile().getModel().setData(m)},onAfterFinalEvaluation:function(){var t=this;var u=this.DEFINITION_DATA.EVALUATION.ODATA_URL;var E=this.DEFINITION_DATA.EVALUATION.ODATA_ENTITYSET;var m=this.DEFINITION_DATA.EVALUATION.COLUMN_NAME;var v=sap.ushell.components.tiles.indicatorTileUtils.util.prepareFilterStructure(this.DEFINITION_DATA.EVALUATION_FILTERS,this.DEFINITION_DATA.ADDITIONAL_FILTERS);var d=this.DEFINITION_DATA.TILE_PROPERTIES.dimension;if(d==undefined){this.logError();return}var s=this.DEFINITION_DATA.EVALUATION.SCALING;var g=this.DEFINITION_DATA.EVALUATION.GOAL_TYPE;var c=this.DEFINITION_DATA.EVALUATION_VALUES;var n=null;if(this.DEFINITION_DATA.EVALUATION.VALUES_SOURCE=="MEASURE"){var f=m;switch(g){case"MI":t.sWarningHigh=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"WH","MEASURE");t.sCriticalHigh=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"CH","MEASURE");t.sTarget=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"TA","MEASURE");t.sTrend=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"TC","MEASURE");if(t.sWarningHigh&&t.sCriticalHigh&&t.sTarget)f+=","+t.sWarningHigh+","+t.sCriticalHigh+","+t.sTarget;break;case"MA":t.sWarningLow=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"WL","MEASURE");t.sCriticalLow=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"CL","MEASURE");t.sTarget=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"TA","MEASURE");t.sTrend=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"TC","MEASURE");if(t.sWarningLow&&t.sCriticalLow&&t.sTarget)f+=","+t.sWarningLow+","+t.sCriticalLow+","+t.sTarget;break;case"RA":t.sWarningHigh=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"WH","MEASURE");t.sCriticalHigh=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"CH","MEASURE");t.sTarget=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"TA","MEASURE");t.sTrend=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"TC","MEASURE");t.sWarningLow=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"WL","MEASURE");t.sCriticalLow=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"CL","MEASURE");if(t.sWarningLow&&t.sCriticalLow&&t.sTarget&&t.sWarningHigh&&t.sCriticalHigh)f+=","+t.sWarningLow+","+t.sCriticalLow+","+t.sTarget+","+t.sWarningHigh+","+t.sCriticalHigh;break}var q=sap.ushell.components.tiles.indicatorTileUtils.util.prepareQueryServiceUri(t.oTileApi.url.addSystemToServiceUrl(u),E,f,d,v)}else{var q=sap.ushell.components.tiles.indicatorTileUtils.util.prepareQueryServiceUri(t.oTileApi.url.addSystemToServiceUrl(u),E,m,d,v)}var h=sap.ushell.components.tiles.indicatorTileUtils.cache.getKpivalueById(t.oConfig.TILE_PROPERTIES.id);if(!h){if(q){this.queryUriForTrendChart=q.uri;var w={};try{this.trendChartODataReadRef=q.model.read(q.uri,null,null,true,function(a){if(a&&a.results&&a.results.length){if(q.unit){t.unit=a.results[0][q.unit.name];w.unit=q.unit;w.unit.name=q.unit.name}t.queryUriResponseForTrendChart=a;d=sap.ushell.components.tiles.indicatorTileUtils.util.findTextPropertyForDimension(t.oTileApi.url.addSystemToServiceUrl(u),E,d);a.firstXlabel=a.results[0][d];a.lastXlabel=a.results[a.results.length-1][d];w.data=a;w.dimensionName=d;sap.ushell.components.tiles.indicatorTileUtils.cache.setKpivalueById(t.oConfig.TILE_PROPERTIES.id,w);var b=sap.ushell.components.tiles.indicatorTileUtils.util.getNavigationTarget(t.oConfig,t.system);t.oKpiTileView.oGenericTile.$().wrap("<a href ='"+b+"'/>");t.oKpiTileView.oGenericTile.setState(sap.suite.ui.commons.LoadState.Loaded);_(a,t.DEFINITION_DATA.EVALUATION.VALUES_SOURCE)}else{t.logError("no Response from QueryServiceUri")}},function(a){if(a&&a.response){t.logError("Data call failed")}})}catch(e){t.logError(e)}}else{t.logError()}}else{try{if(h.unit){t.unit=h.data.results[0][h.unit.name]}t.queryUriResponseForTrendChart=h.data;d=h.dimensionName;t.oKpiTileView.oGenericTile.setState(sap.suite.ui.commons.LoadState.Loaded);_(h.data,t.DEFINITION_DATA.EVALUATION.VALUES_SOURCE)}catch(e){t.logError(e)}}function _(j,k){var l=[];var o=[];var p=[];var r=[];var x=[];var y=[];var z=j.results.length;var A=j.firstXlabel;var B,C,D,F,G;var H=j.lastXlabel;var I=Number(j.results[0][m]);var J=Number(j.results[j.results.length-1][m]);for(i in j.results){j.results[i][d]=Number(i);j.results[i][m]=Number(j.results[i][m]);t.sWarningHigh?j.results[i][t.sWarningHigh]=Number(j.results[i][t.sWarningHigh]):"";t.sCriticalHigh?j.results[i][t.sCriticalHigh]=Number(j.results[i][t.sCriticalHigh]):"";t.sCriticalLow?j.results[i][t.sCriticalLow]=Number(j.results[i][t.sCriticalLow]):"";t.sWarningLow?j.results[i][t.sWarningLow]=Number(j.results[i][t.sWarningLow]):"";t.sTarget?j.results[i][t.sTarget]=Number(j.results[i][t.sTarget]):"";t.sWarningHigh?p.push(j.results[i][t.sWarningHigh]):"";t.sCriticalHigh?r.push(j.results[i][t.sCriticalHigh]):"";t.sCriticalLow?x.push(j.results[i][t.sCriticalLow]):"";t.sWarningLow?y.push(j.results[i][t.sWarningLow]):"";l.push(j.results[i][d]);o.push(j.results[i][m])}try{A=sap.ushell.components.tiles.indicatorTileUtils.util.formatOdataObjectToString(A);H=sap.ushell.components.tiles.indicatorTileUtils.util.formatOdataObjectToString(H)}catch(e){t.logError(e)}var K=Number(I);if(t.oConfig.EVALUATION.SCALING==-2)K*=100;var L=Math.min.apply(Math,o);var M=sap.ushell.components.tiles.indicatorTileUtils.util.getLocaleFormattedValue(K,t.oConfig.EVALUATION.SCALING);if(t.oConfig.EVALUATION.SCALING==-2)M+=" %";var N=M.toString();var O=Number(J);if(t.oConfig.EVALUATION.SCALING==-2)O*=100;var P=Math.max.apply(Math,o);var Q=sap.ushell.components.tiles.indicatorTileUtils.util.getLocaleFormattedValue(O,t.oConfig.EVALUATION.SCALING);if(t.oConfig.EVALUATION.SCALING==-2)Q+=" %";var R=Q.toString();try{var S=sap.ushell.components.tiles.indicatorTileUtils.util.formatOdataObjectToString(Math.min.apply(Math,l));var T=sap.ushell.components.tiles.indicatorTileUtils.util.formatOdataObjectToString(Math.max.apply(Math,l))}catch(e){t.logError(e)}if(k=="MEASURE"){(p.length!=0)?(t.firstwH=p[S])&&(t.lastwH=p[T]):"";(r.length!=0)?(t.firstcH=r[S])&&(t.lastcH=r[T]):"";(x.length!=0)?(t.firstcL=x[S])&&(t.lastcL=x[T]):"";(y.length!=0)?(t.firstwL=y[S])&&(t.lastwL=y[T]):""}var U={width:"100%",height:"100%",unit:t.unit||"",chart:{color:"Neutral",data:j.results},size:"Auto",minXValue:S,maxXValue:T,minYValue:L,maxYValue:P,firstXLabel:{label:A+"",color:"Neutral"},lastXLabel:{label:H+"",color:"Neutral"},firstYLabel:{label:N+"",color:"Neutral"},lastYLabel:{label:R+"",color:"Neutral"},minLabel:{},maxLabel:{}};switch(g){case"MA":for(i in c){if(c[i].TYPE=="CL"){U.minThreshold={color:"Error",};var V=new Object();V[d]="";V[m]=Number(c[i].FIXED);t.cl=Number(c[i].FIXED);U.minThreshold.data=(k=="MEASURE")?j.results:[V];B=(k=="MEASURE")?t.sCriticalLow:m}else if(c[i].TYPE=="WL"){U.maxThreshold={color:"Good"};var V=new Object();V[d]="";V[m]=Number(c[i].FIXED);U.maxThreshold.data=(k=="MEASURE")?j.results:[V];C=(k=="MEASURE")?t.sWarningLow:m;t.wl=Number(c[i].FIXED)}else if(c[i].TYPE=="TA"){var V=new Object();V[d]="";V[m]=Number(c[i].FIXED);U.target={color:"Neutral",};U.target.data=(k=="MEASURE")?j.results:[V];G=(k=="MEASURE")?t.sTarget:m}}U.innerMinThreshold={data:[]};U.innerMaxThreshold={data:[]};if(k=="FIXED"){U.firstYLabel.color=I<t.cl?"Error":((t.cl<=I)&&(I<=t.wl))?"Critical":(I>t.wl)?"Good":"Neutral";U.lastYLabel.color=J<t.cl?"Error":((t.cl<=J)&&(J<=t.wl))?"Critical":(J>t.wl)?"Good":"Neutral"}else if(k=="MEASURE"&&t.firstwL&&t.lastwL&&t.firstcL&&t.lastcL){U.firstYLabel.color=I<t.firstcL?"Error":((t.firstcL<=I)&&(I<=t.firstwL))?"Critical":(I>t.firstwL)?"Good":"Neutral";U.lastYLabel.color=J<t.lastcL?"Error":((t.lastcL<=J)&&(J<=t.lastwL))?"Critical":(J>t.lastwL)?"Good":"Neutral"}break;case"MI":for(i in c){if(c[i].TYPE=="CH"){var V=new Object();V[d]="";V[m]=Number(c[i].FIXED);t.ch=Number(c[i].FIXED);U.maxThreshold={color:"Error",};U.maxThreshold.data=(k=="MEASURE")?j.results:[V];C=(k=="MEASURE")?t.sCriticalHigh:m}else if(c[i].TYPE=="WH"){var V=new Object();V[d]="";V[m]=Number(c[i].FIXED);t.wh=Number(c[i].FIXED);U.minThreshold={color:"Good",};U.minThreshold.data=(k=="MEASURE")?j.results:[V];B=(k=="MEASURE")?t.sWarningHigh:m}else if(c[i].TYPE=="TA"){var V=new Object();V[d]="";V[m]=Number(c[i].FIXED);U.target={color:"Neutral",};U.target.data=(k=="MEASURE")?j.results:[V];G=(k=="MEASURE")?t.sTarget:m}}if(k=="FIXED"){U.firstYLabel.color=I>t.ch?"Error":((t.wh<=I)&&(I<=t.ch))?"Critical":(I<t.wh)?"Good":"Neutral";U.lastYLabel.color=J>t.ch?"Error":((t.wh<=J)&&(J<=t.ch))?"Critical":(J<t.wh)?"Good":"Neutral"}else if(k=="MEASURE"&&t.firstwH&&t.lastwH&&t.firstcH&&t.lastcH){U.firstYLabel.color=I>t.firstcH?"Error":((t.firstwH<=I)&&(I<=t.firstcH))?"Critical":(I<t.firstwH)?"Good":"Neutral";U.lastYLabel.color=J>t.lastcH?"Error":((t.lastwH<=J)&&(J<=t.lastcH))?"Critical":(J<t.lastwH)?"Good":"Neutral"}U.innerMaxThreshold={data:[]};U.innerMinThreshold={data:[]};break;case"RA":for(i in c){if(c[i].TYPE=="CH"){var V=new Object();V[d]="";V[m]=Number(c[i].FIXED);t.ch=Number(c[i].FIXED);U.maxThreshold={color:"Error",};U.maxThreshold.data=(k=="MEASURE")?j.results:[V];C=(k=="MEASURE")?t.sCriticalHigh:m}else if(c[i].TYPE=="WH"){var V=new Object();V[d]="";V[m]=Number(c[i].FIXED);t.wh=Number(c[i].FIXED);U.innerMaxThreshold={color:"Good",};U.innerMaxThreshold.data=(k=="MEASURE")?j.results:[V];F=(k=="MEASURE")?t.sWarningHigh:m}else if(c[i].TYPE=="WL"){var V=new Object();V[d]="";V[m]=Number(c[i].FIXED);t.wl=Number(c[i].FIXED);U.innerMinThreshold={color:"Good",};U.innerMinThreshold.data=(k=="MEASURE")?j.results:[V];D=(k=="MEASURE")?t.sWarningLow:m}else if(c[i].TYPE=="CL"){var V=new Object();V[d]="";V[m]=Number(c[i].FIXED);t.cl=Number(c[i].FIXED);U.minThreshold={color:"Error",};U.minThreshold.data=(k=="MEASURE")?j.results:[V];B=(k=="MEASURE")?t.sCriticalLow:m}else if(c[i].TYPE=="TA"){var V=new Object();V[d]="";V[m]=Number(c[i].FIXED);U.target={color:"Neutral",};U.target.data=(k=="MEASURE")?j.results:[V];G=(k=="MEASURE")?t.sTarget:m}}if(k=="FIXED"){U.firstYLabel.color=(I>t.ch||I<t.cl)?"Error":((t.wh<=I)&&(I<=t.ch))||((t.cl<=I)&&(I<=t.wl))?"Critical":((I>=t.wl)&&(I<=t.wh))?"Good":"Neutral";U.lastYLabel.color=(J>t.ch||J<t.cl)?"Error":((t.wh<=J)&&(J<=t.ch))||((t.cl<=J)&&(J<=t.wl))?"Critical":((J>=t.wl)&&(J<=t.wh))?"Good":"Neutral"}else if(k=="MEASURE"&&t.firstwL&&t.lastwL&&t.firstcL&&t.lastcL&&t.firstwH&&t.lastwH&&t.firstcH&&t.lastcH){U.firstYLabel.color=(I>t.firstcH||I<t.firstcL)?"Error":((t.firstwH<=I)&&(I<=t.firstcH))||((t.firstcL<=I)&&(I<=t.firstwL))?"Critical":((I>=t.firstwL)&&(I<=t.firstwH))?"Good":"Neutral";U.lastYLabel.color=(J>t.lastcH||J<t.lastcL)?"Error":((t.lastwH<=J)&&(J<=t.lastcH))||((t.lastcL<=J)&&(J<=t.lastwL))?"Critical":((J>=t.lastwL)&&(J<=t.lastwH))?"Good":"Neutral"}break}var W=function(X,a,b,k){return new sap.suite.ui.commons.MicroAreaChartItem({color:"{/"+X+"/color}",points:{path:"/"+X+"/data",template:new sap.suite.ui.commons.MicroAreaChartPoint({x:"{"+a+"}",y:"{"+b+"}"})}})};t.getTile().getTileContent()[0].getContent().setTarget(W("target",d,G));t.getTile().getTileContent()[0].getContent().setInnerMinThreshold(W("innerMinThreshold",d,D));t.getTile().getTileContent()[0].getContent().setInnerMaxThreshold(W("innerMaxThreshold",d,F));t.getTile().getTileContent()[0].getContent().setMinThreshold(W("minThreshold",d,B));t.getTile().getTileContent()[0].getContent().setMaxThreshold(W("maxThreshold",d,C));t.getTile().getTileContent()[0].getContent().setChart(W("chart",d,m));t._updateTileModel(U)}},flowWithoutDesignTimeCall:function(){var t=this;this.DEFINITION_DATA=this.oConfig;this._updateTileModel(this.DEFINITION_DATA);if(this.oTileApi.visible.isVisible()&&!this.firstTimeVisible)this.firstTimeVisible=true;this.onAfterFinalEvaluation()},flowWithDesignTimeCall:function(){var t=this;try{var a=sap.ushell.components.tiles.indicatorTileUtils.cache.getEvaluationById(this.oConfig.EVALUATION.ID);if(a){t.oConfig.EVALUATION_FILTERS=a.EVALUATION_FILTERS;t.flowWithoutDesignTimeCall()}else{sap.ushell.components.tiles.indicatorTileUtils.util.getFilterFromRunTimeService(this.oConfig,function(f){t.oConfig.EVALUATION_FILTERS=f;sap.ushell.components.tiles.indicatorTileUtils.cache.setEvaluationById(t.oConfig.TILE_PROPERTIES.id,t.oConfig);t.flowWithoutDesignTimeCall()})}}catch(e){this.logError(e)}},setTextInTile:function(){var t=this;this._updateTileModel({header:t.oTileApi.preview.getTitle()||sap.ushell.components.tiles.indicatorTileUtils.util.getChipTitle(t.oConfig),subheader:t.oTileApi.preview.getDescription()||sap.ushell.components.tiles.indicatorTileUtils.util.getChipSubTitle(t.oConfig)})},logError:function(e){this.oKpiTileView.oGenericTile.setState(sap.suite.ui.commons.LoadState.Failed);this.oKpiTileView.oGenericTile.setState(sap.suite.ui.commons.LoadState.Failed);sap.ushell.components.tiles.indicatorTileUtils.util.logError(e)},refreshHandler:function(c){if(!c.firstTimeVisible){if(Number(this.oTileApi.configuration.getParameterValueAsString("isSufficient")))c.flowWithoutDesignTimeCall();else c.flowWithDesignTimeCall()}},visibleHandler:function(a){var t=this;if(!a){this.firstTimeVisible=false;sap.ushell.components.tiles.indicatorTileUtils.util.abortPendingODataCalls(this.trendChartODataReadRef)}if(a){this.refreshHandler(this)}},onExit:function(){sap.ushell.components.tiles.indicatorTileUtils.util.abortPendingODataCalls(this.trendChartODataReadRef)}})}());
