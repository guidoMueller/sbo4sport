/*
 * SAP InA UI Toolkit DU - New Wave Search and Analytics
 * version 0.0.0 - 2014-03-27 - commit unknown (inofficial dev version)
 * http://help.sap.com/hana_platform
 * Copyright (c) 2014 SAP AG; All rights reserved
 */
/*
 * @file Simple info access (SINA) API: Filter Interface
 * @namespace sap.bc.ina.api.sina.filter
 * @copyright Copyright (c) 2014 SAP AG. All rights reserved.
 * @ignore
 */
(function(g){"use strict";if(g!==null){g.sap=g.sap||{};g.sap.bc=g.sap.bc||{};g.sap.bc.ina=g.sap.bc.ina||{};g.sap.bc.ina.api=g.sap.bc.ina.api||{};g.sap.bc.ina.api.sina=g.sap.bc.ina.api.sina||{};g.sap.bc.ina.api.sina.expandPackage=function(g,p){var s=p.split('.');var w=g;for(var i=0;i<s.length;i++){if(typeof w[s[i]]==='undefined'){w[s[i]]={}}w=w[s[i]]}}}}(typeof window==='undefined'?null:window));(function(g,a){"use strict";var e=function($){if(!$){$=g.$}if(!a){g.sap.bc.ina.api.sina.expandPackage(g,'sap.bc.ina.api.sina.filter')}var f=g.sap.bc.ina.api.sina.filter;var m=f;m.DataSource=function(){this.init.apply(this,arguments)};m.DataSourceMetaData=function(){this.init.apply(this,arguments)};m.Filter=function(){this.init.apply(this,arguments)};m.Condition=function(){this.init.apply(this,arguments)};m.ConditionGroup=function(){this.init.apply(this,arguments)};m.DataSourceMetaData.prototype={init:function(){}};m.DataSource.prototype={init:function(){},equals:function(o){},getMetaData:function(c){},getMetaDataSync:function(){},getLabel:function(){},setLabel:function(l){}};m.Filter.prototype={init:function(p){p=p||{};this.setDataSource(p.dataSource,false);this.root=null;this.conditionGroupsByAttribute={};this.defaultConditionGroup=new m.ConditionGroup({operator:'And'});this.searchTerms=""},addFilterConditionGroup:function(c){this.defaultConditionGroup.addCondition(c)},addFilterCondition:function(b,o,v){return this},getFilterConditions:function(){return this.defaultConditionGroup},getSearchTerms:function(){return this.searchTerms},hasFilterCondition:function(b,o,v){return this.defaultConditionGroup.hasCondition(new m.Condition(b,o,v))},empty:function(){return this},getDataSource:function(){return this.dataSource},removeFilterCondition:function(b,o,v){return this},setSearchTerms:function(s){this.searchTerms=s},setDataSource:function(d){this.dataSource=d},getJson:function(){}};m.Condition.prototype={init:function(b,o,v){if($.type(b)==='object'){var p=b;b=p.attribute;o=p.operator;v=p.value}this.attribute=b||"";this.operator=o||"=";this.value=v},equals:function(o){return this.attribute.toLowerCase()===o.attribute.toLowerCase()&&this.operator===o.operator&&this.value.toLowerCase()===o.value.toLowerCase()},getJson:function(p){},setJson:function(j){},toString:function(){return this.attribute+this.operator+this.value+''}};m.ConditionGroup.prototype={init:function(p){p=p||{};this.label=p.label||'';this.conditions=p.conditions||[];this.setOperator(p.operator||'And')},addCondition:function(c){this.conditions.push(c);return this},getConditions:function(){return this.conditions},getConditionsAsArray:function(b,c){c=c||[];b=b||this;for(var i=0;i<b.conditions.length;i++){if(b.conditions[i]instanceof m.ConditionGroup){this.getConditionsAsArray(b.conditions[i],c)}else{c.push(b.conditions[i])}}return c},hasCondition:function(c){var b=false;for(var i=0,l=this.conditions.length;i<l;i++){var d=this.conditions[i];if(d instanceof m.ConditionGroup){b=d.hasCondition(c)}else{if(d.equals&&d.equals(c)){b=true}}if(b===true){break}}return b},removeCondition:function(c){this.conditions.splice(this.conditions.indexOf(c),1);return this},setLabel:function(l){this.label=l;return this},setOperator:function(o){switch(o.toLowerCase()){case'or':o='Or';break;case'and':o='And';break;default:throw{message:'unknown operator for condition group: '+o}}this.operator=o;return this},toString:function(){return this.label},getJson:function(p){},setJson:function(j){}}};if(a){e($.sap.bc.ina.api.sina.sinaxsjq.jq)}else if(typeof define==="function"&&define.amd&&!g.sap.ushell){define(["jquery"],function($){e($)})}else{e()}}(typeof window==='undefined'?$:window,typeof window==='undefined'));
/*
 * @file The Simple Information Access (SINA) Interface
 * @namespace sap.bc.ina.api.sina.sinabase
 * @requires jQuery
 * @copyright Copyright (c) 2014 SAP AG. All rights reserved.
 */
(function(g,i){"use strict";var e=function($){if(!$){$=g.$}if(!i){g.sap.bc.ina.api.sina.expandPackage(g,'sap.bc.ina.api.sina.sinabase')}var s=g.sap.bc.ina.api.sina.sinabase;var f=g.sap.bc.ina.api.sina.filter;var m=s;var a=function(){};$.extend(m,{provider:{},registerProvider:function(p){this.provider[p.impl_type]=p}});m.Sina=function(){this.init.apply(this,arguments)};m.Sina.prototype={init:function(){},_initQueryProperties:function(p){p=p||{};p.system=p.system||this.sinaSystem();if(p.dataSource){p.dataSource=new this._provider.DataSource(p.dataSource)}return p},createChartQuery:function(p){p=this._initQueryProperties(p);return new this._provider.chartQuery(p)},createSearchQuery:function(p){p=this._initQueryProperties(p);return new this._provider.searchQuery(p)},createGroupBarChartQuery:function(p){p=this._initQueryProperties(p);return new this._provider.groupBarChartQuery(p)},createLineChartQuery:function(p){p=this._initQueryProperties(p);p.dimensions=[p.dimensionLine,p.dimensionX];p.measures=[{name:p.measureY.name,aggregationFunction:p.measureY.aggregationFunction}];return new this._provider.lineChartQuery(p)},createSuggestionQuery:function(p){p=this._initQueryProperties(p);return new this._provider.suggestionQuery(p)},createPerspectiveQuery:function(p){p=this._initQueryProperties(p);return new this._provider.perspectiveQuery(p)},createPerspectiveSearchQuery:function(p){p=this._initQueryProperties(p);return new this._provider.perspectiveSearchQuery(p)},createPerspectiveGetQuery:function(p){p=this._initQueryProperties(p);return new this._provider.perspectiveGetQuery(p)},sinaSystem:function(b){if(b){this.sys=b}else{return this.sys}return{}},createFacet:function(p){return new this._provider.Facet(p)},FacetType:{ATTRIBUTE:"attribute",DATASOURCE:"datasource",SEARCH:"searchresult"},createFilter:function(p){return new this._provider.Filter(p)},createFilterCondition:function(p){return new this._provider.FilterCondition(p)},createFilterConditionGroup:function(p){return new this._provider.FilterConditionGroup(p)},createDataSource:function(p){return new this._provider.DataSource(p)}};m.Query=function(){this.init.apply(this,arguments)};m.Query.prototype={init:function(p){p=p||{};this.system=p.system;this.onSuccess=p.onSuccess;this.onError=p.onError;this._responseJson=null;this.setTop(p.top||10);this.setSkip(p.skip||0);this.resultSetProperties=p;this.filterConditions=p.filterConditions||null;this.filter=this.filter||p.filter||new f.Filter({dataSource:p.dataSource});this.setSearchTerms(p.searchTerms||'')},dataSource:function(n){if(n){this.setDataSource(n);return this}else{return this.getDataSource()}},getDataSource:function(){return this.filter.getDataSource()},setDataSource:function(d){if(d===undefined){return this}if(this.filter.getDataSource()===undefined){this.filter.setDataSource(d);this._resetResultSet();return this}if(!this.filter.getDataSource().equals(d)){this.filter.setDataSource(d);this._resetResultSet()}return this},getFilter:function(){return this.filter},setFilter:function(b){this.filter=b;this._resetResultSet();return this},setSearchTerms:function(t){if(this.filter.getSearchTerms()!==t){this.filter.setSearchTerms(t);this._resetResultSet()}return this},getSearchTerms:function(){return this.filter.getSearchTerms()},skip:function(n){if(n!==undefined){this.setSkip(n)}else{return this._skip}return this},getSkip:function(){return this._skip},setSkip:function(b){if(typeof b!=="number"){return false}this._skip=this._skip||undefined;if(this._skip!==b){this._skip=b;this._resetResultSet()}return this},top:function(n){if(n!==undefined){this.setTop(n)}else{return this._top}return this},getTop:function(){return this._top},setTop:function(t){if(typeof t!=="number"){return false}this._top=this._top||undefined;if(this._top!==t){this._top=t;this._resetResultSet()}return this},addFilterCondition:function(b,o,v){if(this.filter.hasFilterCondition(b,o,v)===false){this.filter.addFilterCondition(b,o,v);this._resetResultSet()}return this},removeFilterCondition:function(b,o,v){this.filter.removeFilterCondition(b,o,v);this._resetResultSet();return this},resetFilterConditions:function(){this.filter.resetFilterConditions();this._resetResultSet();return this},getResultSetSync:function(){this.resultSet=this.executeSync();return this.resultSet},getResultSet:function(o,b){var c=this;o=o||this.onSuccess||a;b=b||this.onError||a;var r=this.execute();r.done(function(d){c.resultSet=d;o(d)});r.fail(function(d){b(d)});return r.promise()},_resetResultSet:function(){},execute:function(){},executeSync:function(){},};m.ChartQuery=function(){this.init.apply(this,arguments)};m.ChartQuery.prototype=$.extend({},m.Query.prototype,{init:function(){m.Query.prototype.init.apply(this,arguments)}});m.FacetType=m.Sina.prototype.FacetType;m.Facet=function(){this.init.apply(this,arguments)};m.Facet.prototype={init:function(p){p=p||{};this.title=p.title||"";this.query=p.query||null;p.facetType=p.facetType||"";this.facetType=p.facetType.toLowerCase();if(p.query){this.setQuery(p.query)}},getChartType:function(){},getTitle:function(){return this.title},getDimension:function(){return this.dimension},getQuery:function(){return this.query},getLayout:function(){},getLayoutBinding:function(){},getColorPalette:function(){},setQuery:function(q){this.query=q}};m.PerspectiveQuery=function(){this.init.apply(this,arguments)};m.PerspectiveQuery.prototype=$.extend({},m.Query.prototype,{init:function(){m.Query.prototype.init.apply(this,arguments);this.facets=[]},addFacet:function(b){this.facets.push(b);return this},getFacets:function(){return this.facets},setOrderBy:function(o){this._resetResultSet();this.orderBy=o||{orderBy:'$$score$$',sortOrder:'DESC'};return this}});m.SearchQuery=function(){this.init.apply(this,arguments)};m.SearchQuery.prototype=$.extend({},m.Query.prototype,{init:function(){m.Query.prototype.init.apply(this,arguments)}});m.SuggestionQuery=function(){this.init.apply(this,arguments)};m.SuggestionQuery.prototype=$.extend({},m.Query.prototype,{init:function(){m.Query.prototype.init.apply(this,arguments)}});m.SinaError=function(){this.init.apply(this,arguments)};m.SinaError.SEVERITY_ERROR=3;m.SinaError.SEVERITY_WARNING=2;m.SinaError.SEVERITY_INFO=1;m.SinaError.prototype={init:function(p){this.SEVERITY_ERROR=3;this.SEVERITY_WARNING=2;this.SEVERITY_INFO=1;this.message=p.message||"";this.errorCode=p.errorCode||null;this.severity=p.severity||m.SinaError.ERROR},getErrorCode:function(){return this.errorCode},getMessage:function(){return this.message},getSeverity:function(){return this.severity},setSeverity:function(b){this.severity=b}}};if(i){e($.sap.bc.ina.api.sina.sinaxsjq.jq)}else if(typeof define==="function"&&define.amd&&!g.sap.ushell){define(["jquery"],function($){e($)})}else{e()}}(typeof window==='undefined'?$:window,typeof window==='undefined'));
/*
 * @file Simple info access (SINA) API: System representation
 * @ignore
 * @namespace global.sap.bc.ina.api.sina.system
 * @copyright Copyright (c) 2013 SAP AG. All rights reserved.
 */
(function(g,a){"use strict";var e=function($){if(!$){$=g.$}if(!a){g.sap.bc.ina.api.sina.expandPackage(g,'sap.bc.ina.api.sina.system');g.sap.bc.ina.api.sina.expandPackage(g,'sap.bc.ina.api.sina.proxy')}var m=g.sap.bc.ina.api.sina.system;var p=g.sap.bc.ina.api.sina.proxy;m.System=function(){this.init.apply(this,arguments)};m.Service=function(){this.init.apply(this,arguments)};m.Capability=function(){this.init.apply(this,arguments)};m.Capability.prototype={init:function(b){this.properties=b||{};this.name=this.properties.Capability||"";this.minVersion=this.properties.MinVersion||0;this.maxVersion=this.properties.MaxVersion||0}};m.Service.prototype={init:function(b){this.properties=b||{};this.name=this.properties.Service;this.minVersion=this.properties.MinVersion||0;this.maxVersion=this.properties.MaxVersion||0;this.capabilities={};for(var i=0;i<this.properties.Capabilities.length;i++){this.capabilities[this.properties.Capabilities[i].Capability]=new m.Capability(this.properties.Capabilities[i])}},getCapability:function(n){return this.capabilities[n]},getCapabilities:function(){return this.capabilities}};m.System.prototype={init:function(b){this.properties=b||{};this.services={};this.proxy=b.proxy||new p.Proxy()},getService:function(n){return this.services[n]},getServices:function(){return this.services},getSystemType:function(){return this.systemType},_deleteServerInfo:function(){this.jqXHR=jQuery.Deferred()},_getServerInfo:function(i){var s=this;if(s.jqXHR){return s.jqXHR.promise()}s.jqXHR=$.Deferred();var r={async:i,type:"GET",url:s.infoUrl,getServerInfo:true,processData:false,contentType:'application/json',dataType:'json'};s.proxy.ajax(r).done(function(d){s.setServerInfo(d);s.jqXHR.resolve(s.properties)}).fail(function(b){s.jqXHR.reject(b)});if(i===true){return s.jqXHR.promise()}return s.properties},getServerInfo:function(){return this._getServerInfo(true)},getServerInfoSync:function(){return this._getServerInfo(false)},setServerInfo:function(j){this.properties.rawServerInfo=j}}};if(a){e($.sap.bc.ina.api.sina.sinaxsjq.jq)}else if(typeof define==="function"&&define.amd&&!g.sap.ushell){define(["jquery"],function($){e($)})}else{e()}}(typeof window==='undefined'?$:window,typeof window==='undefined'));
/*
 * @file Proxy which offers some extras for ajax calls.
 * @namespace sap.bc.ina.api.sina.proxy
 * @copyright Copyright (c) 2014 SAP AG. All rights reserved.
 * @ignore
 */
(function(g,a){"use strict";var e=function($){if(!a){g.sap.bc.ina.api.sina.expandPackage(g,'sap.bc.ina.api.sina.proxy')}g.sap.bc.ina.api.sina.proxy.record=g.sap.bc.ina.api.sina.proxy.record||{};g.sap.bc.ina.api.sina.proxy.record.recordings=[];var m=g.sap.bc.ina.api.sina.proxy;m.Proxy=function(){this.init.apply(this,arguments)};m.inaReqResBuffer={};m.Proxy.prototype={init:function(p){var s=this;s.properties=p||{};s.xsrfToken="";s.xsrfService=s.properties.xsrfService;s.xsrfRetries=0;s.properties.cachelifetime=s.properties.cachelifetime||0;s.properties.httpMethod=s.properties.httpMethod||'post';if(a){return}if(s.properties.cachelifetime>0){g.window.setInterval(function(){m.inaReqResBuffer={}},s.properties.cachelifetime)}s._checkRecordingURLValues()},_checkRecordingURLValues:function(){var s=this;function b(n){return decodeURI((new RegExp(n+'='+'(.+?)(&|$)').exec(g.window.location.search)||[null])[1])}function h(n){if(g.window.location.search.toLowerCase().indexOf("&"+n.toLowerCase())!==-1)return true;if(g.window.location.search.toLowerCase().indexOf("?"+n.toLowerCase())!==-1)return true;return false}if(h('record')){var t=b('record');if(!t||t==="undefined"){t='defaultRecord.json'}s.properties.record=t}if(h('demoMode')){var d=b('demoMode');if(!d||d==="undefined"){d='defaultRecord.json'}s.properties.demoMode=d}},_requestHashValue:function(u,d){return JSON.stringify({"requestUrl":u,"requestData":d})},_handleRequestFromCache:function(r){var i=JSON.stringify(r.data);var b=m.inaReqResBuffer[i];if(b){var j=$.Deferred();j.resolve(b);return j.promise()}return{}},_handleRequestFromRecords:function(r){var s=this;var d=$.Deferred();var p=d.promise();var b=s._requestHashValue(r.url,r.data);var f=function(c){for(var i=0;i<c.length;i++){var h=c[i];var j=s._requestHashValue(h.requestUrl,h.requestData);if(b===j){p.responseText=JSON.stringify(h.responseData);d.resolve(h.responseData);return}}d.reject()};if(g.sap.bc.ina.api.sina.impl.inav2.proxy.record.demoData){f(g.sap.bc.ina.api.sina.impl.inav2.proxy.record.demoData)}else{$.ajax({dataType:"json",url:s.properties.demoMode,async:r.async,success:function(c){g.sap.bc.ina.api.sina.impl.inav2.proxy.record.demoData=c;f(c)},error:function(){},})}return p},_processRequestBuffer:function(){var s=this;$.each(s.requestBuffer,function(i,r){s.fireRequest(r).done(function(b){r.jqxhrProxy.resolve(b)})});s.requestBuffer=[]},setXSRFService:function(u){var s=this;s.xsrfService=u},_getXSRFToken:function(){var s=this;if(!s.xsrfDeferred){s.xsrfRetries++;s.xsrfRequest={"headers":{"X-CSRF-Token":"Fetch"},"cache":false,"url":s.xsrfService};s.xsrfDeferred=$.ajax(s.xsrfRequest);s.xsrfDeferred.done(function(d){s.xsrfToken=s.xsrfDeferred.getResponseHeader("X-CSRF-Token")||s.xsrfToken||"";s.xsrfRetries=0})}return s.xsrfDeferred.promise()},_requestWithXSRFToken:function(r){var s=this;if(s.xsrfDeferred&&r.async===false){if(s.xsrfDeferred.state()==="pending"){s.xsrfRequest.async=false;s.xsrfDeferred=$.ajax(s.xsrfRequest);s.xsrfToken=s.xsrfDeferred.getResponseHeader("X-CSRF-Token")||s.xsrfToken||""}r.headers={"X-CSRF-Token":s.xsrfToken};return $.ajax(r)}else{var d=$.Deferred();s._getXSRFToken().done(function(b){r.headers={"X-CSRF-Token":s.xsrfToken};$.ajax(r).done(function(b){d.resolve(b)}).fail(function(c){if(c.status===400){if(c.responseJSON&&c.responseJSON.Error&&c.responseJSON.Error.Code&&c.responseJSON.Error.Code===403){if(s.xsrfRetries<5){s.xsrfDeferred=null;return s._requestWithXSRFToken(r)}}}d.reject(c);return d.promise()})});return d.promise()}},ajax:function(r){var s=this;var i=r.data===undefined?undefined:JSON.stringify(r.data);var b;if(a){var d=$.Deferred();if(r.getServerInfo){b=$.xs.db.ina.getServiceInfo("");d.resolve(JSON.parse(b))}else{b=$.xs.db.ina.getResponse(i);d.resolve(JSON.parse(b))}return d}if(s.properties.cachelifetime>0){return s._handleRequestFromCache(r)}if(s.properties.demoMode){return s._handleRequestFromRecords(r)}var c;if(s.properties.record){c=s._requestHashValue(r.url,r.data)}r.processData=r.processData||false;r.type=r.type||s.properties.httpMethod||"POST";if(i){if(r.type.toLowerCase()==='get'){r.data='Request='+i}else{r.data=i}}var j=s._requestWithXSRFToken(r);j.done(function(b){if(s.properties.cachelifetime>0){s._cacheResponse(r,b)}if(s.properties.record){s._recordResponse(JSON.parse(c),b)}});return j},_cacheResponse:function(r,d){var i=JSON.stringify(r.data);m.inaReqResBuffer[i]=d},_recordResponse:function(r,b){var s=this;var c={"requestUrl":r.requestUrl,"requestData":r.requestData,"responseData":b};g.sap.bc.ina.api.sina.impl.inav2.proxy.record.recordings.push(JSON.stringify(c));var u=function(j){var l={};return j.filter(function(c){var k=m.Proxy.prototype._requestHashValue(c.requestUrl,c.requestData);return(l[k]===1)?0:l[k]=1})};var d=g.sap.bc.ina.api.sina.impl.inav2.proxy.record.recordings.slice();for(var i=0;i<d.length;i++){d[i]=JSON.parse(d[i])}var f=d.length;d=u(d);var h=JSON.stringify(d);$.ajax({type:"PUT",url:s.properties.record,data:h,contentType:'application/json',dataType:'json',})}}};if(a){e($.sap.bc.ina.api.sina.sinaxsjq.jq)}else if(typeof define==="function"&&define.amd&&!g.sap.ushell){define(["jquery"],function($){e($)})}else{e($)}}(typeof window==='undefined'?$:window,typeof window==='undefined'));
/*
 * @file Implementation of the filter interface
 * @namespace sap.bc.ina.api.sina.impl.inav2.filter
 * @copyright Copyright (c) 2013 SAP AG. All rights reserved.
 * @ignore
 */
(function(g,a){"use strict";var e=function($){if(!$){$=g.$}if(!a){g.sap.bc.ina.api.sina.expandPackage(g,'sap.bc.ina.api.sina.impl.inav2.filter')}var f=g.sap.bc.ina.api.sina.impl.inav2.filter;var m=f;m.DataSource=function(){this.init.apply(this,arguments)};m.DataSourceMetaData=function(){this.init.apply(this,arguments)};m.Filter=function(){this.init.apply(this,arguments)};m.Condition=function(){this.init.apply(this,arguments)};m.ConditionGroup=function(){this.init.apply(this,arguments)};m.DataSourceMetaData.prototype=$.extend({},g.sap.bc.ina.api.sina.filter.DataSourceMetaData.prototype,{init:function(p){p=p||{};this.datasource=p.datasource||{};this.description=p.description||"";this.dimensions={}},_getMetaDataRequest:function(){var r=g.sap.bc.ina.api.sina.impl.inav2.jsontemplates.dataSourceMetaDataRequest;r.DataSource=this.datasource.toInAJson();return r},_getMetaData:function(i,c){var s=this;var r={async:i,url:g.sap.bc.ina.api.sina.sinaSystem().inaUrl,processData:false,contentType:'application/json',dataType:'json',data:this._getMetaDataRequest()};var j=g.sap.bc.ina.api.sina.sinaSystem().proxy.ajax(r);j.done(function(d){if(!s.rawMetadata){s._parseServerMetaData(d)}if(c){c(s)}});return this},_parseServerMetaData:function(b){this.rawMetadata=b;this.description=this.rawMetadata.Cube.Description;this.datasource.setLabel(this.description);for(var i=0;i<this.rawMetadata.Cube.Dimensions.length;i++){var d={};d.name=this.rawMetadata.Cube.Dimensions[i].Name;d.description=this.rawMetadata.Cube.Dimensions[i].Description;d.attributes={};for(var j=0;j<this.rawMetadata.Cube.Dimensions[i].Attributes.length;j++){d.attributes[this.rawMetadata.Cube.Dimensions[i].Attributes[j].Name]={name:this.rawMetadata.Cube.Dimensions[i].Attributes[j].Name,description:this.rawMetadata.Cube.Dimensions[i].Attributes[j].Description}}this.dimensions[d.name]=d}}});m.DataSource.prototype=$.extend({},g.sap.bc.ina.api.sina.filter.DataSource.prototype,{init:function(p){p=p||{};p.schemaName=p.schemaName||p.SchemaName||{};this.setSchemaName(p.schemaName);p.packageName=p.packageName||p.PackageName||{};this.setPackageName(p.packageName);p.objectName=p.objectName||p.ObjectName||{};this.setObjectName(p.objectName);p.type=p.type||p.Type||{};this.setType(p.type);this.label=p.label||p.Label||p.Description||'';if(p.metaData){this.setMetaData(p.metaData)}},equals:function(o){if(o instanceof m.DataSource){if(this.getSchemaName().label!==o.getSchemaName().label||this.getSchemaName().value!==o.getSchemaName().value){return false}if(this.getPackageName().label!==o.getPackageName().label||this.getPackageName().value!==o.getPackageName().value){return false}if(this.getObjectName().label!==o.getObjectName().label||this.getObjectName().value!==o.getObjectName().value){return false}if(this.getType().label!==o.getType().label||this.getType().value!==o.getType().value){return false}return true}return false},getMetaData:function(c){var s=this;if(!s.metaData){s.metaData=new m.DataSourceMetaData({datasource:this})}s.metaData._getMetaData(true,c)},getMetaDataSync:function(){var s=this;if(!s.metaData){s.metaData=new m.DataSourceMetaData({datasource:this});s.metaData._getMetaData(false)}return s.metaData},setMetaData:function(d){this.metaData=d},getSchemaName:function(){return this.schemaName},setSchemaName:function(s){if(!this.schemaName){this.schemaName={}}if($.type(s)==='object'){this.schemaName.label=s.label||s.value||'';this.schemaName.value=s.value||''}if($.type(s)==='string'){this.schemaName.label=s;this.schemaName.value=s}},getPackageName:function(){return this.packageName},setPackageName:function(p){if(!this.packageName){this.packageName={}}if($.type(p)==='object'){this.packageName.label=p.label||p.value||'';this.packageName.value=p.value||''}if($.type(p)==='string'){this.packageName.label=p;this.packageName.value=p}},getObjectName:function(){return this.objectName},setObjectName:function(o){if(!this.objectName){this.objectName={}}if($.type(o)==='object'){this.objectName.label=o.label||o.value||'';this.objectName.value=o.value||''}if($.type(o)==='string'){this.objectName.label=o;this.objectName.value=o}},setObjectNameValue:function(v){if(!this.objectName){this.objectName={}}this.objectName.value=v||''},setObjectNameLabel:function(l){if(!this.objectName){this.objectName={}}this.objectName.label=l||''},getType:function(){return this.type},setType:function(t){if(!this.type){this.type={}}if($.type(t)==='object'){this.type.label=t.label||t.value||'';this.type.value=t.value||''}if($.type(t)==='string'){this.type.label=t;this.type.value=t}},getLabel:function(){if(typeof this.label!=="undefined"&&this.label!==""){return this.label}if(typeof this.getObjectName().label!=="undefined"&&this.getObjectName().label!==""){return this.getObjectName().label}if(typeof this.getObjectName().value!=="undefined"&&this.getObjectName().value!==""){return this.getObjectName().value}return""},setLabel:function(l){this.label=l||''},fromInAJson:function(i){this.setSchemaName({value:i.SchemaName,label:i.SchemaLabel});this.setPackageName({value:i.PackageName,label:i.PackageLabel});this.setObjectName({value:i.ObjectName,label:i.ObjectLabel});this.setType({value:i.Type,label:''})},toInAJson:function(){var j={"SchemaName":this.getSchemaName().value,"PackageName":this.getPackageName().value,"ObjectName":this.getObjectName().value};if(this.getType().value){j.Type=this.getType().value}return j},toURL:function(){var j={"sn":this.getSchemaName().value,"pn":this.getPackageName().value,"on":this.getObjectName().value};if(this.getType().value){j.tn=this.getType().value}return j},fromURL:function(i){this.setSchemaName(i.sn);this.setPackageName(i.pn);this.setObjectName(i.on);this.setType(i.tn)}});m.Filter.prototype=$.extend({},g.sap.bc.ina.api.sina.filter.Filter.prototype,{init:function(p){g.sap.bc.ina.api.sina.filter.Filter.prototype.init.apply(this,[p]);this.defaultConditionGroup=new m.ConditionGroup({operator:'And'})},addFilterCondition:function(b,o,v){var l=b;var c=o;var d=v;if($.type(b)==='object'){var p=b;l=p.attribute;c=p.operator;d=p.value}if(l===undefined||c===undefined||d===undefined){return this}if(this.conditionGroupsByAttribute[l]===undefined){this.conditionGroupsByAttribute[l]=new m.ConditionGroup({operator:"OR"});this.defaultConditionGroup.addCondition(this.conditionGroupsByAttribute[l])}this.conditionGroupsByAttribute[l].addCondition(new m.Condition(b,o,v));return this},removeFilterCondition:function(b,o,v){this.defaultConditionGroup.removeCondition(new m.Condition(b,o,v));return this},resetFilterConditions:function(){this.root=null;this.conditionGroupsByAttribute={};this.defaultConditionGroup=new m.ConditionGroup({operator:'And'});return this},empty:function(){this.root=null;this.conditionGroupsByAttribute={};this.defaultConditionGroup=new m.ConditionGroup({operator:'And'});this.searchTerms="";return this},getJson:function(){var r=[];this.defaultConditionGroup.getJson(r);var b={Selection:r[0]};return b},setJson:function(j){if(j.Selection===undefined){return}var b=new m.ConditionGroup();b.setJson(j);this.defaultConditionGroup.addCondition(b)}});m.Condition.prototype=$.extend({},g.sap.bc.ina.api.sina.filter.Condition.prototype,{init:function(b,o,v){g.sap.bc.ina.api.sina.filter.Condition.prototype.init.apply(this,[b,o,v]);if($.type(b)==='object'){this.inaV2_extended_properties=b;delete this.inaV2_extended_properties.attribute;delete this.inaV2_extended_properties.operator;delete this.inaV2_extended_properties.value}},getJson:function(p){var o;var j={};if(this.operator.toLowerCase()==='contains'){o='SearchOperand'}else{o='MemberOperand'}j[o]={"AttributeName":this.attribute,"Comparison":this.operator,"Value":this.value};if(o==='SearchOperand'){delete j[o].Comparison}j[o]=$.extend({},j[o],this.inaV2_extended_properties);if(this.operator==='='&&this.value===null){j.MemberOperand.Comparison='IS NULL';j.MemberOperand.Value=''}p.push(j)},setJson:function(j){this.attribute=j.MemberOperand.AttributeName;this.operator=j.MemberOperand.Comparison;this.value=j.MemberOperand.Value;if(j.MemberOperand.Comparison==='IS NULL'&&j.MemberOperand.Value===''){this.operator='=';this.value=null}}});m.ConditionGroup.prototype=$.extend({},g.sap.bc.ina.api.sina.filter.ConditionGroup.prototype,{init:function(p){g.sap.bc.ina.api.sina.filter.ConditionGroup.prototype.init.apply(this,[p])},getJson:function(p){if(this.conditions.length===0){return{}}var c=[];for(var i=0;i<this.conditions.length;++i){this.conditions[i].getJson(c)}var j={"Operator":{"Code":this.operator,"SubSelections":c}};if(p){p.push(j)}else{var r={Selection:j};return r}return{}},setJson:function(j){if(j.Selection===undefined&&j.Operator){j.Selection={};j.Selection.Operator=j.Operator}this.setOperator(j.Selection.Operator.Code);var c=j.Selection.Operator.SubSelections;for(var i=0;i<c.length;i++){var b;if(c[i].Operator){b=new m.ConditionGroup()}else{b=new m.Condition()}b.setJson(c[i]);this.addCondition(b)}}})};if(a){e($.sap.bc.ina.api.sina.sinaxsjq.jq)}else if(typeof define==="function"&&define.amd&&!g.sap.ushell){define(["jquery",'./jsontemplates'],function($){e($)})}else{e()}}(typeof window==='undefined'?$:window,typeof window==='undefined'));
/*
 * Simple info access (SINA) API: JSON Templates
 * Package: sap.bc.ina.api.sina.simple.impl.inav2.jsontemplates
 * Copyright (c) 2013 SAP AG. All rights reserved.
 */
(function(g,i){"use strict";var $=g.$;if(!i){g.sap.bc.ina.api.sina.expandPackage(g,'sap.bc.ina.api.sina.impl.inav2.jsontemplates')}var j=g.sap.bc.ina.api.sina.impl.inav2.jsontemplates;var m=j;m.dataSourceMetaDataRequest={"DataSource":{},"Options":["SynchronousRun"],"Metadata":{"Context":"Search","Expand":["Cube"]},"ServiceVersion":204};m.catalogRequest={"DataSource":{"ObjectName":"$$DataSources$$","PackageName":"ABAP"},"Options":["SynchronousRun"],"Search":{"Top":1000,"Skip":0,"OrderBy":[{"AttributeName":"Description","SortOrder":"ASC"},{"AttributeName":"ObjectName","SortOrder":"ASC"}],"Expand":["Grid","Items"],"Filter":{"Selection":{"Operator":{"Code":"And","SubSelections":[{"MemberOperand":{"AttributeName":"SupportedService","Comparison":"=","Value":"Search"}}]}}},"NamedValues":[{"AttributeName":"ObjectName","Name":"ObjectName"},{"AttributeName":"Description","Name":"Description"},{"AttributeName":"Type","Name":"Type"}]},"SearchTerms":"*","ServiceVersion":204};m.suggestionRequest={"DataSource":{},"Options":["SynchronousRun"],"Suggestions":{"Expand":["Grid","Items"],"Precalculated":false,"SearchTerms":"","AttributeNames":[]},"ServiceVersion":204};m.suggestion2Request={"DataSource":{},"Options":["SynchronousRun"],"Suggestions2":{"Expand":["Grid","Items"],"Precalculated":false,"AttributeNames":[]},"ServiceVersion":204};m.perspectiveRequest={"DataSource":{},"Options":["SynchronousRun"],"Search":{"Expand":["Grid","Items","TotalCount"],"Filter":{"Selection":{"Operator":{"Code":"And","SubSelections":[{"MemberOperand":{"AttributeName":"$$RenderingTemplatePlatform$$","Comparison":"=","Value":"html"}},{"MemberOperand":{"AttributeName":"$$RenderingTemplateTechnology$$","Comparison":"=","Value":"Tempo"}},{"MemberOperand":{"AttributeName":"$$RenderingTemplateType$$","Comparison":"=","Value":"ResultItem"}}]}}},"Top":10,"Skip":0,"SearchTerms":"S*","NamedValues":[{"Function":"WhyFound","Name":"$$WhyFound$$"},{"Function":"RelatedActions","Name":"$$RelatedActions$$"}]},"ServiceVersion":204};m.perspectiveSearchRequest={"DataSource":{"ObjectName":"$$Perspectives$$","Type":"View"},"Options":["SynchronousRun"],"Search":{"Expand":["Grid","Items"],"Filter":{"Selection":{"Operator":{"Code":"Or","SubSelections":[{"MemberOperand":{"AttributeName":"SCHEMA_VERSION_NUMBER","Comparison":"=","Value":"3"}},{"MemberOperand":{"AttributeName":"SCHEMA_VERSION_NUMBER","Comparison":"=","Value":"4"}},{"MemberOperand":{"AttributeName":"SCHEMA_VERSION_NUMBER","Comparison":"=","Value":"5"}}]}}},"SearchTerms":"*","SelectedValues":[{"AttributeName":"PACKAGE_ID","Name":"PACKAGE_ID"},{"AttributeName":"PERSPECTIVE_ID","Name":"PERSPECTIVE_ID"},{"AttributeName":"TITLE_TEXT","Name":"TITLE_TEXT"},{"AttributeName":"SUMMARY_TEXT","Name":"SUMMARY_TEXT"}],"Skip":0,"Top":30}};m.perspectiveRequestFactsheet={"DataSource":{},"Options":["SynchronousRun"],"Search":{"Expand":["Grid","Items","TotalCount"],"Filter":{"Selection":{"Operator":{"Code":"And","SubSelections":[{"MemberOperand":{"AttributeName":"$$RenderingTemplatePlatform$$","Comparison":"=","Value":"html"}},{"MemberOperand":{"AttributeName":"$$RenderingTemplateTechnology$$","Comparison":"=","Value":"Tempo"}},{"MemberOperand":{"AttributeName":"$$RenderingTemplateType$$","Comparison":"=","Value":"ResultItem"}}]}}},"Top":10,"Skip":0,"SearchTerms":"S*","NamedValues":[{"Function":"WhyFound","Name":"$$WhyFound$$"},{"AttributeName":"$$RelatedActions$$"},{"AttributeName":"$$RelatedActions.Proxy$$"}]},"ServiceVersion":204};m.searchRequest={"DataSource":{},"SearchTerms":"DUMMY","Search":{"Expand":["Grid","Items","TotalCount"],"Top":"DUMMY","Skip":"DUMMY","SelectedValues":"DUMMY","NamedValues":[{"AttributeName":"$$ResultItemAttributes$$","Name":"$$ResultItemAttributes$$"},{"AttributeName":"$$RelatedActions$$","Name":"$$RelatedActions$$"}]}};m.chartRequest={"DataSource":{},"Options":["SynchronousRun"],"SearchTerms":"","Analytics":{"Definition":{"Dimensions":[{"Axis":"Rows","Name":"CATEGORY","SortOrder":1,"Top":5},{"Axis":"Columns","Name":"CustomDimension1","Members":[{"Aggregation":"COUNT","AggregationDimension":"CATEGORY","MemberOperand":{"AttributeName":"Measures","Comparison":"=","Value":"COUNT"},"Name":"COUNT","SortOrder":2}]}],"Filter":{}}}}}(typeof window==='undefined'?$:window,typeof window==='undefined'));
/*
 * @file Proxy class to buffer InA JSON requests/responses.
 * @namespace global.sap.bc.ina.api.sina.impl.inav2.proxy
 * @copyright Copyright (c) 2012 SAP AG. All rights reserved.
 * @ignore
 */
(function(g,i){"use strict";var e=function($){if(!i){g.sap.bc.ina.api.sina.expandPackage(g,'sap.bc.ina.api.sina.impl.inav2.proxy')}g.sap.bc.inauitk=g.sap.bc.inauitk||{};g.sap.bc.ina.api.sina.impl.inav2.proxy.record=g.sap.bc.ina.api.sina.impl.inav2.proxy.record||{};g.sap.bc.ina.api.sina.impl.inav2.proxy.record.recordings=[];var m=g.sap.bc.ina.api.sina.impl.inav2.proxy;var p=g.sap.bc.ina.api.sina.proxy;m.Proxy=function(){this.init.apply(this,arguments)};m.inaReqResBuffer={};m.Proxy.prototype=$.extend({},p.Proxy.prototype,{init:function(a){var s=this;s.properties=a||{};p.Proxy.prototype.init.apply(this,[a])}})};if(i){e($.sap.bc.ina.api.sina.sinaxsjq.jq)}else if(typeof define==="function"&&define.amd&&!g.sap.ushell){define(["jquery","../../proxy"],function($){e($)})}else{e($)}}(typeof window==='undefined'?$:window,typeof window==='undefined'));
/*
 * @file Simple info access (SINA) API: Implementation of the SINA interface
 * for the INA V2 service.
 * @namespace sap.bc.ina.api.sina.impl.inav2.sina_impl
 * @requires sap.bc.ina.api.sina
 * @requires sap.bc.ina.api.sina.impl.inav2.filter
 * @requires sap.bc.ina.api.sina.impl.inav2.system
 * @requires sap.bc.ina.api.sina.impl.inav2.proxy
 * @requires jQuery
 * @copyright Copyright (c) 2013 SAP AG. All rights reserved.
 */
(function(g,f){"use strict";var h=function($){if(!$){$=g.$}if(!f){g.sap.bc.ina.api.sina.expandPackage(g,'sap.bc.ina.api.sina.impl.inav2.sina_impl');g.sap.bc.ina.api.sina.expandPackage(g,'sap.bc.ina.api.sina.impl.inav2.proxy')}var p=g.sap.bc.ina.api.sina.impl.inav2.sina_impl;p.Sina=function(){this.init.apply(this,arguments)};p.Facet=function(){this.init.apply(this,arguments)};p.Perspective=function(){this.init.apply(this,arguments)};p.Perspective2=function(){this.init.apply(this,arguments)};p.Query=function(){this.init.apply(this,arguments)};p.CatalogQuery=function(){this.init.apply(this,arguments)};p.CatalogResultSet=function(){this.init.apply(this,arguments)};p.PerspectiveQuery=function(){this.init.apply(this,arguments)};p.PerspectiveGetQuery=function(){this.init.apply(this,arguments)};p.PerspectiveSearchQuery=function(){this.init.apply(this,arguments)};p.PerspectiveSearchResultSet=function(){this.init.apply(this,arguments)};p.Suggestion=function(){this.init.apply(this,arguments)};p.SuggestionQuery=function(){this.init.apply(this,arguments)};p.SuggestionResultSet=function(){this.init.apply(this,arguments)};p.Suggestion2Query=function(){this.init.apply(this,arguments)};p.Suggestion2ResultSet=function(){this.init.apply(this,arguments)};p.ChartQuery=function(){this.init.apply(this,arguments)};p.ChartResultSet=function(){this.init.apply(this,arguments)};p.GroupBarChartQuery=function(){this.init.apply(this,arguments)};p.GroupBarChartResultSet=function(){this.init.apply(this,arguments)};p.LineChartQuery=function(){this.init.apply(this,arguments)};p.LineChartResultSet=function(){this.init.apply(this,arguments)};p.SearchQuery=function(){this.init.apply(this,arguments)};p.SearchResultSet=function(){this.init.apply(this,arguments)};p.SuggestionAutoQuery=function(a){if(a.system instanceof g.sap.bc.ina.api.sina.impl.inav2.system.ABAPSystem){$.extend(this,p.Suggestion2Query.prototype)}if(a.system instanceof g.sap.bc.ina.api.sina.impl.inav2.system.HANASystem){$.extend(this,p.SuggestionQuery.prototype)}this.init.apply(this,arguments)};var q=g.sap.bc.ina.api.sina.impl.inav2.jsontemplates;var r=g.sap.bc.ina.api.sina.impl.inav2.filter;var s=g.sap.bc.ina.api.sina.impl.inav2.proxy.config;var t=g.sap.bc.ina.api.sina.sinabase;p.Condition=r.Condition;p.IMPL_TYPE="inav2";t.registerProvider({impl_type:p.IMPL_TYPE,sina:p.Sina,chartQuery:p.ChartQuery,searchQuery:p.SearchQuery,groupBarChartQuery:p.GroupBarChartQuery,lineChartQuery:p.LineChartQuery,suggestionQuery:p.SuggestionAutoQuery,perspectiveQuery:p.PerspectiveQuery,perspectiveSearchQuery:p.PerspectiveSearchQuery,perspectiveGetQuery:p.PerspectiveGetQuery,Facet:p.Facet,DataSource:r.DataSource,Filter:r.Filter,FilterCondition:r.Condition,FilterConditionGroup:r.ConditionGroup});p.Sina.prototype=$.extend({},t.Sina.prototype,{init:function(a){a=a||{};this.sinaSystem(a.system||new g.sap.bc.ina.api.sina.impl.inav2.system.HANASystem());t.Sina.prototype.init.apply(this,arguments)},sapclient:function(a){var b;if(a){if(a<0){b=new g.sap.bc.ina.api.sina.impl.inav2.system.HANASystem()}else{b=new g.sap.bc.ina.api.sina.impl.inav2.system.ABAPSystem({"sapclient":a})}this.sinaSystem(b)}else{return this.sinaSystem().properties.sapclient()}return{}},_registerPostProcessor:function(a){if(!this.postProcessor){this.postProcessor=[]}this.postProcessor.push(a)},_postprocess:function(a,b){if(this.postProcessor){for(var i=0;i<this.postProcessor.length;i++){this.postProcessor[i](a,b)}}},});p.Query.prototype=$.extend({},{init:function(a){this.filter=a.filter||new r.Filter({dataSource:a.dataSource})},_resetResultSet:function(){this.deferredResultSet=null;this.resultSet=null;this.jqXHR=null},_getSinaError:function(d){var a={};if(d.error){var e=JSON.parse(a.responseText);return new t.SinaError({message:e.error.message,errorCode:e.error.code})}return null},setDataSource:function(d){if(d===undefined){return this}d=new r.DataSource(d);if(this.filter.getDataSource()===undefined){this.filter.setDataSource(d);this._resetResultSet();return this}if(!this.filter.getDataSource().equals(d)){this.filter.setDataSource(d);this._resetResultSet()}return this},execute:function(){var a=this;var j=a.createJsonRequest();a.system.getServerInfo();var b=a._fireRequest(j,true);var d=$.Deferred();b.done(function(c){var e=a._getSinaError(c);if(c&&e){d.reject(e);return}var i=new a.resultSetClass(a.resultSetProperties);i.setJsonData(c);d.resolve(i)}).fail(function(e){d.reject(e)}).always(function(c){a._responseJson=c});return d.promise()},executeSync:function(){var a=this;if(!f&&a.resultSet!==null){return a.resultSet}var j=a.createJsonRequest();a.system.getServerInfo();var d=a._fireRequest(j,false);a._responseJson=d;a.resultSet=new a.resultSetClass(a.resultSetProperties);if(!f&&d&&d.responseText){var b=JSON.parse(d.responseText);a.resultSet.setJsonData(b)}else if(d&&d.arguments){a.resultSet.setJsonData(d.arguments[0])}return a.resultSet},_fireRequest:function(j,a){var b={async:a,url:this.system.inaUrl,contentType:'application/json',dataType:'json',data:j};var c=this.system.proxy.ajax(b);return c},_assembleOrderBy:function(){var o=[];function a(c,d){var i={};if(c.toLowerCase()==='$$score$$'){i.Function='Score'}else{i.AttributeName=c}i.SortOrder=d.toUpperCase();return i}var b;if($.type(this.orderBy)==='array'){for(var j=0;j<this.orderBy.length;j++){b=a(this.orderBy[j].orderBy,this.orderBy[j].sortOrder);o.push(b)}}else if($.type(this.orderBy)==='object'&&this.orderBy.orderBy){b=a(this.orderBy.orderBy,this.orderBy.sortOrder);o.push(b)}return o}});p.CatalogQuery.prototype=$.extend({},p.Query.prototype,{init:function(a){a=a||{};this.resultSetClass=p.SearchResultSet},createJsonRequest:function(){return q.catalogRequest}});p.Facet.prototype=$.extend({},t.Facet.prototype,{init:function(a){a=a||{};t.Facet.prototype.init.apply(this,arguments);if(this.facetType==='$$datasources$$'){this.facetType=t.FacetType.DATASOURCE;this.query=new p.ChartQuery();this.query.resultSet=new p.ChartResultSet({"type":"datasource"})}else if(this.facetType===t.FacetType.ATTRIBUTE){this.query=new p.ChartQuery();this.query.resultSet=new p.ChartResultSet()}else if(this.facetType===t.FacetType.SEARCH){this.query=new p.SearchQuery();this.query.resultSet=new p.SearchResultSet()}},setJsonData:function(d){this.query.resultSet.setJsonData(d);this._parseServerSideFacetMetaData(d.Metadata)},_parseServerSideFacetMetaData:function(d){if(d&&d.Cube){this.title=d.Cube.Description;this.dimension=d.Cube.ObjectName}}});p.PerspectiveQuery.prototype=$.extend({},t.PerspectiveQuery.prototype,p.Query.prototype,{init:function(a){var b=this;b.chartFacets=[];b.searchFacet=null;b.searchresultset=null;b.layout=null;b.templateFactsheet=a.templateFactsheet||false;a=a||{};p.Query.prototype.init.apply(this,arguments);t.PerspectiveQuery.prototype.init.apply(this,arguments);a.orderBy=a.orderBy||{};this.setOrderBy(a.orderBy);this.resultSetClass=p.Perspective},createJsonRequest:function(){if(this.templateFactsheet){q.perspectiveRequest=q.perspectiveRequestFactsheet}q.perspectiveRequest.DataSource=this.filter.dataSource.toInAJson();var a=this.filter.getSearchTerms();q.perspectiveRequest.Search.SearchTerms=a;if(s&&s.startWithSearch!==undefined&&s.startWithSearch==='false'){if(!a&&this.filter.dataSource.getObjectName().value.toLowerCase()==='$$all$$'){var c=new p.CatalogQuery();return c.createJsonRequest()}}q.perspectiveRequest.Search.Top=this._top;q.perspectiveRequest.Search.Skip=this._skip;q.perspectiveRequest.Search.Filter=this.filter.getJson();q.perspectiveRequest.Search.OrderBy=this._assembleOrderBy();return q.perspectiveRequest},getPerspective:function(o,a){this.getResultSet(o,a)},generatePerspectiveSync:function(){return this.getResultSetSync()}});p.Perspective.prototype={init:function(a){var b=this;b.chartFacets=[];b.searchFacet=null;b.searchresultset=null;b.layout=null;a=a||{}},getSearchResultSet:function(){return this.searchresultset},getChartFacets:function(){return this.chartFacets},getSearchFacet:function(){return this.searchFacet},getLayout:function(){return this.layout},setJsonData:function(d){var a=this;a.searchFacet=new p.Facet({"facetType":"searchresult"});a.searchFacet.setJsonData(d);a.searchresultset=a.searchFacet.getQuery().getResultSetSync();if(d.ResultsetFacets&&d.ResultsetFacets.Elements){for(var j=0;j<d.ResultsetFacets.Elements.length;j++){var b=new p.Facet({"facetType":t.FacetType.ATTRIBUTE});b.setJsonData(d.ResultsetFacets.Elements[j]);a.chartFacets.push(b)}}else{}}};p.PerspectiveGetQuery.prototype=$.extend({},p.Query.prototype,{init:function(a){var b=this;a=a||{};this.perspectiveId=a.perspectiveId;p.Query.prototype.init.apply(this,[a]);this.resultSetClass=p.Perspective2},setPerspectiveId:function(a){this.perspectiveId=a},getPerspective:function(o,a){var b=this;var c={async:true,url:"/sap/bc/ina/service/v2/Perspectives('"+this.perspectiveId+"')",type:"GET"};var j=this.system.proxy.ajax(c);j.done(function(d){if(d&&d.error){a(d.error)}b.resultSet=new b.resultSetClass(b.resultSetProperties);b.resultSet.setJsonData(d);if(o){o(b.resultSet)}}).fail(function(e){if(a)a(e)})}});p.Perspective2.prototype={init:function(a){var b=this;a=a||{}},getFacetForID:function(a){var b=this;for(var j=0;j<b.facets.length;j++){if(b.facets[j].facetId===a){return b.facets[j]}}return undefined},getDimensionForID:function(d){var a=this;for(var j=0;j<a.dimensions.length;j++){if(a.dimensions[j].Name===d){return a.dimensions[j]}}return undefined},getPreviewDimension:function(){var a=this;if(this.bindings["WIDGET-4"]&&this.bindings["WIDGET-4"].dimension){return this.bindings["WIDGET-4"].dimension}if(this.bindings["WIDGET-1"]&&this.bindings["WIDGET-1"].dimension){return this.bindings["WIDGET-1"].dimension}if(this.bindings["WIDGET-2"]&&this.bindings["WIDGET-2"].dimension){return this.bindings["WIDGET-2"].dimension}if(this.bindings["WIDGET-3"]&&this.bindings["WIDGET-3"].dimension){return this.bindings["WIDGET-3"].dimension}return undefined},setJsonData:function(d){var a=this;a.rawdata=d;a.ChangedAt=d.ChangedAt;a.ChangedBy=d.ChangedBy;a.content=JSON.parse(d.Content);a.perspectiveId=d.Id;a.name=d.Name;a.packageName=d.Package;a.isActive=d.isActive;a.isGenerated=d.isGenerated;a.datasource=a.content.Model.Queries[0].Datasource;a.measures=[];var m=a.content.Model.Queries[0].CustomDimension1.Members;for(var k=0;k<m.length;k++){a.measures.push(m[k])}a.dimensions=[];var b=a.content.Model.Queries[0].Dimensions;for(var j=0;j<b.length;j++){a.dimensions.push(b[j])}a.facets=[];var c=a.content.Model.Facets;for(var i=0;i<c.length;i++){a.facets.push({isActive:c[i].Active,facetId:c[i].FacetId,dimension:a.getDimensionForID(c[i].SeriesChart.ScaleDimensions[0].DimensionName)})}a.bindings={};var e=a.content.Bindings;for(var l=0;l<e.length;l++){var n=e[l];a.bindings[n.WidgetId]=a.getFacetForID(n.FacetId)}}};p.PerspectiveSearchQuery.prototype=$.extend({},p.Query.prototype,{init:function(a){var b=this;a=a||{};p.Query.prototype.init.apply(this,[a]);this.filter.searchTerms=a.searchTerms||"*";this.resultSetClass=p.PerspectiveSearchResultSet},createJsonRequest:function(){q.perspectiveSearchRequest.Search.SearchTerms=this.filter.searchTerms;q.perspectiveSearchRequest.Search.Top=this._top;q.perspectiveSearchRequest.Search.Skip=this._skip;return q.perspectiveSearchRequest},getPerspectiveResults:function(o,a){this.getResultSet(o,a)}});p.PerspectiveSearchResultSet.prototype={init:function(a){var b=this;b.perspectives=[];a=a||{}},getPerspectiveSearchResultSet:function(){return this.perspectives},setJsonData:function(d){var a=this;var b=d["ItemLists"][0]["Items"];for(var i=0;i<b.length;i++){var n=b[i]["NamedValues"];var c={packageId:n[0].Value,perspectiveId:n[0].Value+"/"+n[1].Value,perspectiveDescription:n[3].Value,title:n[2].Value};a.perspectives.push(c)}}};p.SuggestionQuery.prototype=$.extend({},t.SuggestionQuery.prototype,p.Query.prototype,{init:function(a){a=a||{};this.attributes=a.attributes||[];p.Query.prototype.init.apply(this,arguments);t.SuggestionQuery.prototype.init.apply(this,arguments);this.resultSetClass=p.SuggestionResultSet},addResponseAttribute:function(a){this.attributes.push(a);this._resetResultSet();return this},setResponseAttributes:function(a){this.attributes=a;this._resetResultSet();return this},createJsonRequest:function(){q.suggestionRequest.Suggestions.Precalculated=false;var a=this.filter.getSearchTerms();if(this.attributes.length===0){throw"add at least one response attribute to your query"}if(a.charAt(a.length-1)!=='*'){a+='*'}q.suggestionRequest.Suggestions.SearchTerms=a;q.suggestionRequest.Suggestions.AttributeNames=this.attributes;q.suggestionRequest.DataSource=this.filter.dataSource.toInAJson();q.suggestionRequest.Suggestions.Top=this._top;var r=this.filter.getJson();if(r&&r.Selection){q.suggestionRequest.Suggestions.Filter=this.filter.getJson()}return q.suggestionRequest}});p.SuggestionResultSet.prototype={init:function(){this.suggestions=[]},setJsonData:function(c){this.suggestions=[];var e={};for(var i=0;i<c.ItemLists.length;i++){e[c.ItemLists[i].Name]=c.ItemLists[i]}for(var a=0;a<e.Suggestions.Items.length;a++){var j=e.Suggestions.Items[a],k="",l="",m="";var n={};for(var d=0;d<j.NamedValues.length;++d){var u=j.NamedValues[d];switch(u.Name){case"Term":k=u.Value;n.label=k;break;case"AttributeName":l=u.Value;n.attribute=l;break;case"$$AttributeDescription$$":m=u.Value;n.attributeDescription=m;break;case"Score":var v=u.Value;n.score=parseInt(v,10);break}}this.suggestions.push(n)}this.suggestions.sort(function(a,b){return b.score-a.score});for(var o=this.suggestions.length-1;o>=0;o--){delete this.suggestions[o].score}},getElements:function(){return this.suggestions}};p.Suggestion2Query.prototype=$.extend({},t.SuggestionQuery.prototype,p.Query.prototype,{init:function(a){a=a||{};this.attributes=a.attributes||[];p.Query.prototype.init.apply(this,[a]);t.SuggestionQuery.prototype.init.apply(this,[a]);this.resultSetClass=p.Suggestion2ResultSet;this.searchTerms=a.searchTerms||{};this.suggestionTerm=a.suggestionTerm||''},addResponseAttribute:function(a){this.attributes.push(a);this._resetResultSet();return this},addSearchTerm:function(a){if(a){this.searchTerms[a]=a}this._resetResultSet();return this},setSuggestionTerm:function(a){if(a.charAt(a.length-1)!=='*'){a+='*'}if(this.suggestionTerm!==a){this.suggestionTerm=a;this._resetResultSet()}return this},setResponseAttributes:function(a){this.attributes=a;this._resetResultSet();return this},createJsonRequest:function(){q.suggestion2Request.Suggestions2.Precalculated=false;q.suggestion2Request.Suggestions2.NamedValues=[];for(var i=0;i<this.attributes.length;i++){q.suggestion2Request.Suggestions2.NamedValues.push({AttributeName:this.attributes[i],Name:this.attributes[i]})}q.suggestion2Request.DataSource=this.filter.dataSource.toInAJson();q.suggestion2Request.Suggestions2.Top=this.getTop();q.suggestion2Request.Suggestions2.Skip=this.getSkip();var a=new r.ConditionGroup();var b=new r.ConditionGroup();for(var c in this.searchTerms){var d=new r.Condition('$$SearchTerms$$','contains',c);a.addCondition(d)}var e=new r.Condition('$$SuggestionTerms$$','contains',this.suggestionTerm);a.addCondition(e);a.addCondition(this.getFilter().getFilterConditions());q.suggestion2Request.Suggestions2.Filter=a.getJson();return q.suggestion2Request}});p.Suggestion2ResultSet.prototype={init:function(){this.datasources={};this.suggestions=[]},setJsonData:function(b){this.datasources={};this.suggestions=[];function e(J){switch(J){case"Value1":case"Value2":case"Order":return false;default:return true}}var k={};if(!b.ItemLists){return}for(var i=0;i<b.ItemLists.length;i++){k[b.ItemLists[i].Name]=b.ItemLists[i]}for(var a=0;a<b.Grids.length;a++){var l=b.Grids[a].Axes;var m=b.Grids[a].Cells;if(l===undefined||m===undefined){return}var n={};for(var o=0;o<m.length;++o){var u=m[o],v="",w="",x="",y={};y.dataSource=new r.DataSource();y.attribute={};for(var j=0;j<u.Index.length;j++){var z=u.Index[j];var A=l[j].Tuples[z];if(A===undefined){continue}for(var c=0;c<A.length;c++){var B=l[j].Dimensions[c];var C=A[c];var D=k[B.ItemListName];var E=D.Items[C].NamedValues;for(var d=0;d<E.length;++d){var F=E[d];switch(F.Name){case"$$Term$$":y.valueRaw=u.Value||u.ValueFormatted||null;y.value=u.ValueFormatted||u.Value||null;y.labelRaw=F.Value;y.label=F.ValueFormatted;if(!y.filter){y.filter={}}y.filter.value=y.labelRaw;y.filter.valueLabel=y.labelRaw;break;case"$$DataSource$$":var G=F.Value;y.dataSource.setObjectNameValue(G);break;case"$$DataSourceDescription$$":var H=F.Value;y.dataSource.setObjectNameLabel(H);break;case"$$Attribute$$":var I=F.Value;if(!y.filter){y.filter={}}y.filter.attribute=I;y.attribute.value=I;break;case"$$AttributeDescription$$":w=F.Value;if(!y.filter){y.filter={}}y.filter.attributeLabel=w;y.attribute.label=w;break}}}}this.suggestions.push(y)}}},getElements:function(){return this.suggestions}};p.ChartQuery.prototype=$.extend({},t.ChartQuery.prototype,p.Query.prototype,{init:function(a){a=a||{};p.Query.prototype.init.apply(this,[a]);t.ChartQuery.prototype.init.apply(this,[a]);this.dimensions={};this.dimensions.CustomDimension1={Axis:"Columns",Name:"CustomDimension1",Members:[]};a.dimensions=a.dimensions||{};if($.type(a.dimensions)==='array'){for(var i=0;i<a.dimensions.length;i++){this.addDimension(a.dimensions[i])}}else if($.type(a.dimensions)==='string'||$.type(a.dimensions)==='object'){this.addDimension(a.dimensions)}a.measures=a.measures||{};if($.type(a.measures)==='array'){for(var j=0;j<a.measures.length;j++){this.addMeasure(a.measures[j])}}else if($.type(a.measures)==='object'){this.addMeasure(a.measures)}this.resultSetClass=p.ChartResultSet},createJsonRequest:function(){q.chartRequest.DataSource=this.filter.dataSource.toInAJson();q.chartRequest.SearchTerms=this.filter.getSearchTerms();q.chartRequest.Analytics.Definition.Filter=this.filter.getJson();q.chartRequest.Analytics.Definition.Dimensions=[];for(var d in this.dimensions){q.chartRequest.Analytics.Definition.Dimensions.push(this.dimensions[d])}return q.chartRequest},count:function(d){this.addMeasure({name:d,aggregationFunction:'COUNT'});return this},addMeasure:function(a){if($.isEmptyObject(a)){return{}}var b="Columns";var n="CustomDimension1";var m;if(a.aggregationFunction.toUpperCase()==='COUNT'||a.aggregationFunction.toUpperCase()==='AVG'){m=this._createAggregationDimension(a.aggregationFunction,a.name,a.aggregationFunction,a.sortOrder||undefined,a.top||undefined)}else{m=this._createAggregationDimension(a.aggregationFunction,"",a.name,a.sortOrder,a.top);delete m.AggregationDimension;delete m.Name;delete m.SortOrder}this.dimensions.CustomDimension1.Members.push(m);return this},addDimension:function(d,a,b){if($.type(d)==='object'){if($.isEmptyObject(d)){return{}}this.dimensions[d.name]=this._createDimension(d.name,null,d.sortOrder,d.top)}else if($.type(d)==='string'){if(!d){return{}}this.dimensions[d]=this._createDimension(d,null,a,b)}return this},_createDimension:function(d,a,b,c){return{"Axis":a||"Rows","Name":d,"SortOrder":b||1,"Top":c||5}},_createAggregationDimension:function(a,b,n,c){return{"Aggregation":a,"AggregationDimension":b,"MemberOperand":{"AttributeName":"Measures","Comparison":"=","Value":n},"Name":n,"SortOrder":c||2}}});p.ChartResultSet.prototype={init:function(a){a=a||{};this.type=a.type;this.elements=[]},_parseNamedValues:function(e,n,m){var a=this;for(var i=0;i<n.length;i++){var b=n[i].Name;var v=n[i].Value;e.label=n[i].ValueFormatted;e.labelRaw=n[i].Value;switch(b){case'$$DataSource$$':a._parseNamedValuesForDataSource(e,v);break;case'$$AttributeValue$$':a._parseNamedValuesForRange(e,v,m);break}}},_parseNamedValuesForRange:function(e,v,m){var a,b,c;for(var d=0;d<v.length;++d){var n=v[d];switch(n.Name){case"ValueID":e.label=n.ValueFormatted;a=n.Value;break;case"Value1":if(m.Cube.ObjectName&&(n.Value!==undefined)){b=new r.Condition(m.Cube.ObjectName,">=",n.Value)}break;case"Value2":if(m.Cube.ObjectName&&(n.Value!==undefined)){c=new r.Condition(m.Cube.ObjectName,"<=",n.Value)}break;case"Order":break}}if(a){if(b&&c){var i=new r.ConditionGroup();i.setOperator("AND");i.setLabel(e.label);if(b.value){i.addCondition(b)}if(c.value){i.addCondition(c)}e.labelRaw=i}else if(b&&b.value&&(!c)){b.operator='=';e.labelRaw=b}else if(c&&c.value&&(!b)){c.operator='=';e.labelRaw=c}}},_parseNamedValuesForDataSource:function(e,v){e.dataSource=new r.DataSource();for(var d=0;d<v.length;++d){var n=v[d];switch(n.Name){case"ObjectName":var l=n.ValueFormatted;e.dataSource.setLabel(l);e.dataSource.setObjectName(n.Value,n.ValueFormatted);break;case"PackageName":e.dataSource.setPackageName(n.Value,n.ValueFormatted);break;case"SchemaName":e.dataSource.setSchemaName(n.Value,n.ValueFormatted);break;case"Type":e.dataSource.setType(n.Value,n.ValueFormatted);break;default:e[n.Name]=n.Value;break}}},setJsonData:function(d){this.elements=[];var m;if(d.Metadata){m=d.Metadata}if(d.ResultSet){d=d.ResultSet}var b={};for(var i=0;i<d.ItemLists.length;i++){b[d.ItemLists[i].Name]=d.ItemLists[i]}for(var a=0;a<d.Grids.length;a++){var e=d.Grids[a].Axes;var k=d.Grids[a].Cells;for(var l=0;l<k.length;++l){if(e[0].Dimensions.length===1){var n=k[l];var o={valueRaw:n.Value||n.ValueFormatted||null,value:n.ValueFormatted||n.Value||null};for(var j=0;j<1;j++){var u=n.Index[j];var v=e[j].Tuples[u];if(v===undefined){continue}for(var c=0;c<v.length;c++){var w=e[j].Dimensions[c];var x=v[c];var y=b[w.ItemListName];var z=y.Items[x].NamedValues;this._parseNamedValues(o,z,m)}}this.elements.push(o)}}}},getElements:function(){return this.elements}};var R=function(){this.init.apply(this,arguments)};R.prototype={init:function(o){this.resultSet=o.resultSet;this.parse()},parse:function(){this.enhance(this.resultSet);var a=this.resultSet.Grids[0];var b=a.Axes[0];var c=a.Axes[1];var k=function(w){return w.NamedValues[0].Value};var d=new T({keyFunction:k});for(var i=0;i<a.Cells.length;++i){var e=a.Cells[i];var j=e.Index[0];var l=this.resolve(b,j);var m=l.map(k);var n=e.Index[1];var o=this.resolve(c,n);var u=o.map(k);o=[$.extend({},o[0])];o[0].cell=e;var v=l;v.push.apply(v,o);d.insert(v)}return d},resolve:function(a,b){var c=[];var d=a.Tuples[b];for(var i=0;i<d.length;++i){var e=d[i];var j=a.Dimensions[i].ItemList.Items[e];c.push(j)}return c},enhance:function(a){var b={};for(var i=0;i<a.ItemLists.length;++i){var c=a.ItemLists[i];b[c.Name]=c}for(i=0;i<a.Grids.length;++i){var d=a.Grids[i];for(var j=0;j<d.Axes.length;++j){var e=d.Axes[j];for(var k=0;k<e.Dimensions.length;++k){var l=e.Dimensions[k];l.ItemList=b[l.ItemListName]}}}}};var T=function(){this.init.apply(this,arguments)};T.prototype={init:function(o){this.root={data:"root",subTree:{}};if(o&&o.keyFunction){this.keyFunction=o.keyFunction}else{this.keyFunction=function(a){return a}}},insert:function(a){var b=this.root;for(var i=0;i<a.length;++i){var c=a[i];var k=this.keyFunction(c);if(!b.subTree.hasOwnProperty(k)){b.subTree[k]={subTree:{},data:c}}b=b.subTree[k]}},toString:function(){var a=[];this.toStringHelper(this.root,[],a);return a.join("")},toStringHelper:function(a,b,c){var d=null;if(a===this.root){d=a.data}else{d=this.keyFunction(a.data)}b.push(d);var e=false;for(var i in a.subTree){if(a.subTree.hasOwnProperty(i)){e=true;var j=a.subTree[i];var k=b.slice(0);this.toStringHelper(j,k,c)}}if(!e){c.push(b.toString()+"\n")}}};p.GroupBarChartQuery.prototype=$.extend({},p.ChartQuery.prototype,{init:function(a){a=a||{};p.ChartQuery.prototype.init.apply(this,[a]);this.resultSetClass=p.GroupBarChartResultSet}});p.GroupBarChartResultSet.prototype={init:function(a){a=a||{};this.elements=[]},setJsonData:function(d){var a=this;this.elements=[];var b=new R({resultSet:d});var c=b.parse();function e(i,j){for(var k in i){var l=i[k];var m={label:l.data.NamedValues[0].ValueFormatted,value:[]};if(l.data.cell){m.value={value:l.data.cell.ValueFormatted,valueRaw:l.data.cell.Value}}if(j){j.value.push(m)}else{a.elements.push(m)}if(l.subTree){e(l.subTree,m)}}}e(c.root.subTree)},getElements:function(){return this.elements}};p.LineChartQuery.prototype=$.extend({},p.ChartQuery.prototype,{init:function(a){a=a||{};p.ChartQuery.prototype.init.apply(this,[a]);this.resultSetClass=p.LineChartResultSet}});p.LineChartResultSet.prototype=$.extend({},p.GroupBarChartResultSet.prototype,{init:function(a){a=a||{};this.elements=[]},setJsonData:function(d){var a=this;this.elements=[];var b=new R({resultSet:d});var c=b.parse();function e(i,j){for(var k in i){var l=i[k];var m={label:l.data.NamedValues[0].ValueFormatted,value:[]};for(var n in l.subTree){var o=l.subTree[n];var u={x:o.data.NamedValues[0].ValueFormatted};for(var v in o.subTree){var w=o.subTree[v];u.y=w.data.cell.Value}m.value.push(u)}a.elements.push(m)}}e(c.root.subTree)},getElements:function(){return this.elements}});p.SearchQuery.prototype=$.extend({},t.SearchQuery.prototype,p.Query.prototype,{init:function(a){a=a||{};p.Query.prototype.init.apply(this,[a]);t.SearchQuery.prototype.init.apply(this,[a]);this.sqlSearch=(a.sqlSearch===undefined||a.sqlSearch===true)?true:false;this.attributes=a.attributes||[];a.orderBy=a.orderBy||{};this.setOrderBy(a.orderBy);this.resultSetClass=p.SearchResultSet},addResponseAttribute:function(a){this.attributes.push(a);this._resetResultSet();return this},createJsonRequest:function(){var a=this;q.searchRequest.DataSource=this.filter.dataSource.toInAJson();if(this.system instanceof g.sap.bc.ina.api.sina.impl.inav2.system.HANASystem){if(this.attributes.length===0){throw{message:"Add at least one response attribute to your query"}}if(this.sqlSearch===true){q.searchRequest.Options=["SqlSearch"]}}var b=[];for(var i=0;i<this.attributes.length;++i){var c=this.attributes[i];if($.type(c)==='string'){b.push({Name:c,AttributeName:c})}else if($.type(c)==='object'){var d={Name:c.name||c.attributeName,AttributeName:c.attributeName||c.name};if(c.highlighted===true){d.Function='Highlighted'}if(c.snippet===true){d.Function='Snippet'}if(c.startPosition!==undefined){d.StartPosition=c.startPosition}if(c.maxLength!==undefined){d.MaxLength=c.maxLength}b.push(d)}}q.searchRequest.Search.SelectedValues=b;var e=this.filter.getSearchTerms();if(!e){e='*'}q.searchRequest.SearchTerms=e;q.searchRequest.Search.Top=this._top;q.searchRequest.Search.Skip=this._skip;q.searchRequest.Search.Filter=this.filter.getJson();q.searchRequest.Search.OrderBy=this._assembleOrderBy();return q.searchRequest},setOrderBy:function(o){this._resetResultSet();this.orderBy=o||{orderBy:'$$score$$',sortOrder:'DESC'}}});p.SearchResultSet.prototype={init:function(a){a=a||{};this.elements=[];this.totalcount=0},toString:function(a){var e=this.elements;var b=[];var i;for(i=0;i<e.length;++i){var c=e[i];var d={};for(var j in c){if(j.slice(0,2)==='$$'||j.slice(0,1)==='_'){continue}var k=c[j];if(!k.label||!k.value){continue}var l={label:k.label,value:k.value};d[j]=l}b.push(d)}return JSON.stringify(b)},setJsonData:function(d){this.elements=[];function a(){this.type="";this.platform="";this.technology="";this.width="";this.height="";this.variant="";this.uri=""}a.prototype={_fromInaJson:function(k){this.type=k.Type||"";this.platform=k.Platform||"";this.technology=k.Technology||"";this.width=k.Width||"";this.height=k.Height||"";this.variant=k.Variant||"";this.uri=k.Uri||""}};function b(){this.type="";this.description="";this.uri="";this.request=null;this.encodedJSON=""}b.prototype={_fromInaJson:function(k){var l=this;l.description=k.Description;l.uri=k.Uri;switch(k.Type){case"RelatedRequest":l.type='Search';var m={};m.dataSource=new r.DataSource();m.dataSource.fromInAJson(k.Request.DataSource);m.system=g.sap.bc.ina.api.sina.sinaSystem();m.top=1;l.request=new p.SearchQuery(m);l.request.filter.setJson(k.Request.Filter);if(k.Request.Filter.Selection===undefined){l.request.invalid=true;l.request.invalidMessage="Related request '"+l.description+"' is invalid because of missing filter conditions."}break;case"GeneralUri":l.type='Link';l.url=l.uri;break;case"SAPNavigation":l.type='Navigation';l.url=l.uri;break}l.encodedJSON=encodeURIComponent(l)}};function e(k){this.resultElementAttribute=k;this.correspondingSearchAttributeName="";this.description="";this.isTitle=false;this.presentationUsage=[];this.displayOrder=null}e.prototype={_fromInaJson:function(k){var l=this;l.correspondingSearchAttributeName=k.correspondingSearchAttributeName||"";l.description=k.Description||"";l.presentationUsage=k.presentationUsage||[];if(k.IsTitle!==undefined){l.isTitle=k.IsTitle}if(l.isTitle){if(!l.resultElementAttribute.resultElement.title){l.resultElementAttribute.resultElement.title=l.resultElementAttribute.resultElement.$$DataSourceMetaData$$.getLabel()+":"}l.resultElementAttribute.resultElement._registerPostProcessor(function(){l.resultElementAttribute.resultElement.title=l.resultElementAttribute.resultElement.title+" "+l.resultElementAttribute.value})}}};function u(k){this.resultElement=k;this.$$MetaData$$=new e(this);this.label="";this.labelRaw="";this.value="";this.valueRaw=""}u.prototype={_fromInaJson:function(k){var l=this;l.labelRaw=this.$$MetaData$$.correspondingSearchAttributeName||k.Name||"";l.label=this.$$MetaData$$.description||k.Name||"";l.valueRaw=k.Value||null;l.value=k.ValueFormatted||null},toString:function(){return this.value}};function v(){this.title="";this.$$DataSourceMetaData$$={};this.$$RelatedActions$$={};this.$$RenderingTemplateSpecification$$={};this.$$WhyFound$$=[];this.$$PostProcessors$$=[]}v.prototype={_fromInaJson:function(E){var K=this;for(var k=0;k<E.length;++k){var L=E[k];switch(L.Name){case"$$DataSourceMetaData$$":var M=L.Value[0];var N=new r.DataSource(M);K.$$DataSourceMetaData$$=N;break;case"$$AttributeMetadata$$":for(var m=0;m<L.Value.length;++m){var O=L.Value[m];if(!K[O.Name]){K[O.Name]=new u(K)}K[O.Name].$$MetaData$$._fromInaJson(O);K[O.Name].$$MetaData$$.displayOrder=m}break;case"$$ResultItemAttributes$$":for(var l=0;l<L.Value.length;++l){var P=L.Value[l];if(!K[P.Name]){K[P.Name]=new u(K)}K[P.Name]._fromInaJson(P)}break;case"$$RelatedActions$$":var Q={};for(var n=0;n<L.Value.length;++n){var S=L.Value[n];var U=new b();U._fromInaJson(S);Q[S.ID]=U}K.$$RelatedActions$$=Q;break;case"$$RenderingTemplateSpecification$$":for(var o=0;o<L.Value.length;++o){var V=new a();V._fromInaJson(L.Value[o]);if(V.type==="ItemDetails"){K._detailTemplate=V}else{K.$$RenderingTemplateSpecification$$=V}}break;case"$$WhyFound$$":for(var z=0;z<L.Value.length;++z){var W={};W.label=L.Value[z].Description;W.labelRaw=L.Value[z].Name;W.value=L.Value[z].Value;W.valueHighlighted=W.value;W.valueRaw=L.Value[z].Value;K.$$WhyFound$$.push(W)}break;default:K[L.Name]=new u();K[L.Name].label=L.Name||"";K[L.Name].valueRaw=L.Value||L.ValueFormatted||null;K[L.Name].value=L.ValueFormatted||L.Value||null}}for(var i=0;i<this.$$PostProcessors$$.length;i++){this.$$PostProcessors$$[i]()}},_registerPostProcessor:function(k){this.$$PostProcessors$$.push(k)}};function _(A){if(A._detailTemplate&&!A.$$RelatedActions$$.$$DETAILS$$){A.$$RelatedActions$$.$$DETAILS$$={request:new p.SearchQuery(),description:'',encodedJSON:'',type:'Search',uri:''}}if(A._detailTemplate&&A.$$RelatedActions$$.$$DETAILS$$){var k=new p.SearchResultSet();k.elements[0]=$.extend(true,{},A);k.elements[0].$$RenderingTemplateSpecification$$=A._detailTemplate;k.totalcount=1;delete k.elements[0].$$RelatedActions$$.$$DETAILS$$;A.$$RelatedActions$$.$$DETAILS$$.request.resultSet=k;return k.elements[0]}return{}}var w={};if(!d.ItemLists){return{}}for(var i=0;i<d.ItemLists.length;i++){w[d.ItemLists[i].Name]=d.ItemLists[i];if(d.ItemLists[i].Name.toLowerCase()==="searchresult"){this.totalcount=d.ItemLists[i].TotalCount.Value}}var x;if(d&&d.Grids&&d.Grids[0]&&d.Grids[0].Axes&&d.Grids[0].Axes[0]){x=d.Grids[0].Axes[0]}else{return{}}for(var j=0;j<x.Tuples.length;j++){var y=x.Tuples[j];if(y===undefined){continue}var A=new v();for(var c=y.length-1;c>=0;c--){var B=x.Dimensions[c];var C=y[c];var D=w[B.ItemListName];var E=D.Items[C].NamedValues;A._fromInaJson(E)}if(x&&x.Dimensions[1]){var F=x.Dimensions[1];var G=w[F.ItemListName];var H=y[1];if(G&&G.Items&&G.Items[H]){var I=G.Items[H].NamedValues[2];if(I){A=this._postProcess4WhyFound(A,I.Value)}}}var J=_(A);this._postProcessRelatedAction(A);if(J){this._postProcessRelatedAction(J)}this.elements.push(A)}return{}},getElements:function(){return this.elements},_postProcessRelatedAction:function(e){if(!e.$$RelatedActions$$){return}for(var a in e.$$RelatedActions$$){var b=e.$$RelatedActions$$[a];if(b.type==="Search"){g.sap.bc.ina.api.sina._postprocess(b,e.title)}}},_postProcess4WhyFound:function(e,m){if(e.$$WhyFound$$&&e.$$WhyFound$$.length>0){var i=e.$$WhyFound$$.length;var v;var a;while(i--){a=false;if(e[e.$$WhyFound$$[i].labelRaw]!==undefined&&m!==undefined){var j=m.length;while(j--){if(m[j].Name===e.$$WhyFound$$[i].labelRaw&&m[j].correspondingSearchAttributeName){e.$$WhyFound$$[i].labelRaw=m[j].correspondingSearchAttributeName;a=true}}}}}return e}}};if(f){h($.sap.bc.ina.api.sina.sinaxsjq.jq)}else if(typeof define==="function"&&define.amd&&!g.sap.ushell){define(["jquery","./filter","../../sinabase","./system","./proxy"],function($){h($)})}else{h()}}(typeof window==='undefined'?$:window,typeof window==='undefined'));
/*
 * @file Simple info access (SINA) API: System representation
 * @ignore
 * @namespace global.sap.bc.ina.api.sina.impl.inav2.system
 * @copyright Copyright (c) 2013 SAP AG. All rights reserved.
 */
(function(g,a){"use strict";var e=function($){if(!$){$=g.$}if(!a){g.sap.bc.ina.api.sina.expandPackage(g,'sap.bc.ina.api.sina.impl.inav2.system');g.sap.bc.ina.api.sina.expandPackage(g,'sap.bc.ina.api.sina.impl.inav2.proxy')}var m=g.sap.bc.ina.api.sina.impl.inav2.system;var p=g.sap.bc.ina.api.sina.impl.inav2.proxy;var s=g.sap.bc.ina.api.sina.system;var b=g.sap.bc.ina.api.sinabase;m.ABAPSystem=function(){this.init.apply(this,arguments)};m.HANASystem=function(){this.init.apply(this,arguments)};m.ABAPSystem.prototype=$.extend({},s.System.prototype,{init:function(c){c=c||{};this.systemType='ABAP';this.inaUrl=c.inaUrl||"/sap/es/ina/GetResponse";this.infoUrl=c.infoUrl||"/sap/es/ina/GetServerInfo";c.proxy=c.proxy||new p.Proxy({"xsrfService":this.infoUrl});s.System.prototype.init.apply(this,[c]);this.config=g.sap.bc.inauitk.config;if(c.sapclient){this.sapclient(c.sapclient)}else{var d=this._readSapClientFromUrl();this.sapclient(d)}if(c.saplanguage){this.saplanguage(c.saplanguage)}else{var f=this._getUrlParameter("sap-language");this.saplanguage(f)}},setSinaUrlParameter:function(n,v){v=v+"";if(n.toUpperCase()==="SAP-CLIENT"&&v.length<3){for(var i=0;i<2;i++){v="0"+v}}function c(u){var d=(new RegExp(n+'='+'(.+?)(&|$)','i').exec(u)||[null])[1];if(!d){if(u.indexOf("?")===-1){u+="?"+encodeURIComponent(n)+"="+encodeURIComponent(v)}else{u+="&"+encodeURIComponent(n)+"="+encodeURIComponent(v)}}else{u=u.replace(n+"="+d,encodeURIComponent(n)+"="+encodeURIComponent(v))}return u}this.infoUrl=c(this.infoUrl);this.inaUrl=c(this.inaUrl)},_getUrlParameter:function(n){var c=g.location.href;var v=(new RegExp(n+'='+'(.+?)(&|$)','i').exec(c)||[null])[1];if(!v){return v}v=decodeURIComponent(v.replace(/\+/g," "));return v},_readSapClientFromUrl:function(){if(g.sap.bc.ina.api.sina.properties&&g.sap.bc.ina.api.sina.properties.noSapClientFromUrl&&g.sap.bc.ina.api.sina.properties.noSapClientFromUrl===true){return""}return this._getUrlParameter("sap-client")},sapclient:function(c){if(c){this._sapclient=c;this.setSinaUrlParameter("sap-client",this._sapclient);this._deleteServerInfo();this.getServerInfo();return{}}else{return this._sapclient}},saplanguage:function(l){if(l){this._saplanguage=l;this.setSinaUrlParameter("sap-language",this._saplanguage);return{}}else{return this._saplanguage}},setServerInfo:function(j){this.properties={};this.properties.rawServerInfo=j;if(this instanceof m.ABAPSystem){this.properties.dbms=j.ServerInfo.DataBaseManagementSystem}for(var i=0;i<j.Services.length;i++){this.services[j.Services[i].Service]=new s.Service(j.Services[i])}}});m.HANASystem.prototype=$.extend({},s.System.prototype,{init:function(c){c=c||{};this.systemType='HANA';this.infoUrl=c.infoUrl||"/sap/bc/ina/service/v2/GetServerInfo";this.inaUrl=c.inaUrl||"/sap/bc/ina/service/v2/GetResponse";c.proxy=c.proxy||new p.Proxy({"xsrfService":this.infoUrl});s.System.prototype.init.apply(this,[c]);this._setUpAjaxErrorHandler()},_setUpAjaxErrorHandler:function(){if(!a){$(g.document).ajaxError(function(c,j,d,t){switch(j.status){case 401:g.window.location="/sap/hana/xs/formLogin/login.html?x-sap-origin-location="+encodeURIComponent(g.window.location.pathname)+encodeURIComponent(g.window.location.search);break;case 404:return}})}}})};if(a){e($.sap.bc.ina.api.sina.sinaxsjq.jq)}else if(typeof define==="function"&&define.amd&&!g.sap.ushell){define(["jquery","../../system"],function($){e($)})}else{e()}}(typeof window==='undefined'?$:window,typeof window==='undefined'));
/*
 * @file Simple info access (SINA) API: Factory
 * @namespace sap.bc.ina.api.sina
 * @requires jQuery
 * @copyright Copyright (c) 2013 SAP AG. All rights reserved.
 */
if(typeof window==='undefined'){$.import("sinaxsjq.xsjslib");$.import("filter.xsjslib");$.import("impl/inav2/filter.xsjslib");$.import("sinabase.xsjslib");$.import("impl/inav2/jsontemplates.xsjslib");$.import("proxy.xsjslib");$.import("impl/inav2/proxy.xsjslib");$.import("system.xsjslib");$.import("impl/inav2/system.xsjslib");$.import("impl/inav2/sina_impl.xsjslib")}(function(g,i){"use strict";var e=function($){if(!$){$=g.$}if(!i){g.sap.bc.ina.api.sina.expandPackage(g,'sap.bc.ina.api.sina')}var m=g.sap.bc.ina.api.sina;m.properties=m.properties||{};var a=g.sap.bc.ina.api;var b=g.sap.bc.ina.api.sina.impl.inav2.proxy;var c=g.sap.bc.ina.api.sina.impl.inav2.system;var s=g.sap.bc.ina.api.sina.sinabase;if(g.sap.bc.ina.api.sina.impl&&g.sap.bc.ina.api.sina.impl.inav2&&g.sap.bc.ina.api.sina.impl.inav2.sina_impl&&g.sap.bc.ina.api.sina.impl.inav2.sina_impl.IMPL_TYPE){a.SINA_TYPE_INAV2=g.sap.bc.ina.api.sina.impl.inav2.sina_impl.IMPL_TYPE}g.sap.bc.ina.api.sina.getSina=function(p){p=p||{};p.impl_type=p.impl_type||a.SINA_TYPE_INAV2;if(p.impl_type===a.SINA_TYPE_INAV2){if(!p.system){var d;var n=new b.Proxy(p);if(p.systemType&&p.systemType.toUpperCase()==="ABAP"){d=new c.ABAPSystem({'proxy':n})}else{d=new c.HANASystem({'proxy':n})}n.setXSRFService(d.infoUrl);p.system=d}}if(s.provider[p.impl_type]&&s.provider[p.impl_type].sina){var f=new s.provider[p.impl_type].sina(p);f._provider=s.provider[p.impl_type];return f}return{}};if(!i){m.properties.noDefaultSina=m.properties.noDefaultSina||false;if(m.properties.noDefaultSina!==undefined&&!m.properties.noDefaultSina){g.sap.bc.ina.api.sina=g.jQuery.extend({},m,m.getSina(m.properties));return g.sap.bc.ina.api.sina}return{}}else{g.sap.bc.ina.api.sinaxs=g.sap.bc.ina.api.sinaxs||m.getSina(m.properties);return g.sap.bc.ina.api.sinaxs}};if(i){e($.sap.bc.ina.api.sina.sinaxsjq.jq)}else if(g.sap&&g.sap.ushell){e()}else if(typeof define==="function"&&define.amd){define(["require","./filter","./impl/inav2/sina_impl"],function(){var s=e($);return s})}else{e()}}(typeof window==='undefined'?$:window,typeof window==='undefined'));
