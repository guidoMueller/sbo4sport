//Copyright (c) 2013 SAP AG, All Rights Reserved
(function(){"use strict";jQuery.sap.require("sap.ushell.ui.launchpad.SearchSuggestionList");jQuery.sap.require("sap.ushell.ui.launchpad.SearchSuggestionListItem");jQuery.sap.require("sap.ushell.renderers.fiori2.search.SearchSuggestionControls");sap.ui.jsview("sap.ushell.renderers.fiori2.search.SearchSuggestions",{createContent:function(c){var s=this;var d=new sapUshellSuggestSection();var a=new sapUshellSuggestSection();var b=new sapUshellSuggestSection();s.suggestList=new sapUshellSuggestionList({sections:[d,a,b]});s.suggestList.addStyleClass('sapUshellSearchSuggestionList');var f="sfOverlay";if(s.getViewData().sf!==undefined)f=s.getViewData().sf;sap.ui.getCore().byId(f).addEventDelegate({onsapdown:function(e){s.suggestList.focus();e.preventDefault();e.stopPropagation()},onsapescape:function(e){c.closeSuggestions();e.preventDefault();e.stopPropagation()}});var g=function(){return new sap.m.GroupHeaderListItem({title:"{title}"}).addStyleClass('sapUshellSuggestHeader')};var h=function(){return new sap.m.CustomListItem({type:sap.m.ListType.Inactive,content:[new sap.m.Label({text:"{text}"}).addStyleClass('sapUshellSuggestEnter')]})};var o=function(l,m){var p=l.onAfterRendering;l.onAfterRendering=function(){if(p)p.apply(this,arguments);var q=$(this.getDomRef());q.keypress(function(e){if(e.which===13){m()}})}};var i=function(e,l){e.addEventDelegate({onclick:function(E){l(E);E.stopImmediatePropagation();E.stopPropagation()},ontouch:function(E){l(E);E.stopImmediatePropagation();E.stopPropagation()}})};var n=function(e,l){if(e)s.getModel().setSearchTerm(e,false);if(l)s.getModel().setDataSource(l,false);window.location.href="#Action-search&/searchTerm="+encodeURI(s.getModel().getProperty("/searchBoxTerm"))+"&dataSource="+encodeURI(JSON.stringify(s.getModel().getDataSourceJson()));if(s.viewSwitcher)s.viewSwitcher.switchViewState("searchResults")};var j=function(e,l){return{objectName:{value:e,label:l},packageName:{label:"",value:""},schemaName:{label:"",value:""}}};var k=function(e){s.getModel().setDataSource(e,false);s.getModel().setProperty("/searchBoxTerm","");s.getModel().doSuggestion()};d.bindAggregation("items","/dataSourceSection",function(p,D){if(D.getObject().isTitle)return g();var e=function(){var m=j(D.getObject().labelRaw,D.getObject().label);s.getModel().setDataSource(m,false);s.getModel().setProperty("/searchBoxTerm","");s.searchfield.focus()};var l=new sap.m.CustomListItem({type:sap.m.ListType.Active,content:[new sap.ushell.renderers.fiori2.search.DataSourcePill({dataSourceName:"{dataSourceLabel}",press:function(){e()}}).addStyleClass('sapUshellSuggestDataSource').addStyleClass('sapUshellSearchSuggestionNavItem')],press:function(){e()}}).addStyleClass('sapUshellSuggestListItem');o(l,function(){e()});return l});a.bindAggregation("items","/suggestSection",function(p,D){if(D.getObject().isTitle)return g();if(D.getObject().isFooter)return h();var l=new sap.m.Link({text:"{label}"}).addStyleClass('sapUshellSuggestText').addStyleClass('sapUshellSearchSuggestionNavItem');l.addEventDelegate({onAfterRendering:function(){s.bTagUnescaper(this.getDomRef())}},l);i(l,function(){n(D.getObject().labelRaw)});var e=new sap.ushell.renderers.fiori2.search.DataSourcePill({dataSourceName:"{dataSourceLabel}"}).addStyleClass('sapUshellSuggestDataSourceRight').addStyleClass('sapUshellSuggestDataSource').addStyleClass('sapUshellSearchSuggestionNavItem');var m=[l];if(D.getObject().dataSourceLabel)m.push(e);var q=new sap.m.CustomListItem({type:sap.m.ListType.Active,content:m}).addStyleClass('sapUshellSuggestListItem');i(q,function(){n(D.getObject().labelRaw,D.getObject().dataSource)});o(l,function(){n(D.getObject().labelRaw)});o(e,function(){n(D.getObject().labelRaw,D.getObject().dataSource)});return q});b.bindAggregation("items","/appSection",function(p,D){if(D.getObject().isTitle){return g()}var e=function(){if(D.getObject().targetURL){window.location=D.getObject().targetURL}else{jQuery.sap.require("sap.ca.ui.message.message");sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:sap.ushell.resources.i18n.getText("noappurl"),details:""})}};var l=new sap.m.Link({text:"{label}",press:e}).addStyleClass('sapUshellSuggestText').addStyleClass('sapUshellSearchSuggestionNavItem');var m=new sap.ui.core.Icon({src:D.getObject().icon}).addStyleClass('sapUshellSuggestIcon');var q=new sap.m.CustomListItem({type:sap.m.ListType.Active,content:[m,l],press:e}).addStyleClass('sapUshellSuggestListItem');l.addEventDelegate({onAfterRendering:function(){s.bTagUnescaper(this.getDomRef())}},l);o(q,e);return q});return s.suggestList},bTagUnescaper:function(d){var i=d.innerHTML;while(i.indexOf('&lt;b&gt;')+i.indexOf('&lt;/b&gt;')>=-1){i=i.replace('&lt;b&gt;','<b>');i=i.replace('&lt;/b&gt;','</b>')}d.innerHTML=i},focusSearchfield:function(e){sap.ui.getCore().byId("sfOverlay").focus()},onAfterRendering:function(){},hideSuggestions:function(){},showSuggestions:function(){this.$().slideDown(200);if(this.getParent()&&this.getParent().scrollTo){this.getParent().scrollTo(0)}else{this.$().parent().scrollTop(0)}},getControllerName:function(){return"sap.ushell.renderers.fiori2.search.SearchSuggestions"}})}());
