//Copyright (c) 2013 SAP AG, All Rights Reserved
(function(){"use strict";jQuery.sap.require("sap.ushell.ui.launchpad.TileContainer");jQuery.sap.require("sap.ushell.ui.launchpad.Tile");jQuery.sap.require("sap.ushell.ui.launchpad.SearchResultApps");jQuery.sap.require("sap.ushell.ui.launchpad.SearchResultAppItem");jQuery.sap.require("sap.ushell.renderers.fiori2.search.SearchLayout");jQuery.sap.require("sap.ushell.renderers.fiori2.search.DataSourceList");sap.ui.jsview("sap.ushell.renderers.fiori2.search.HistoryScreen",{createContent:function(c){var s=this;var S,l;if(sap.ui.getCore().getModel("searchModel").isNormalSearchEnable()){this.oRecentDataSources=new sap.ushell.renderers.fiori2.search.DataSourceList({dsPress:function(p){var d=p.getParameters().ds;s.getModel("searchModel").setDataSource(d,false);s.searchfield.focus()},showNoData:false,dataSources:"{/dataSources}"})}l=new sap.m.List({inset:false,showSeparators:sap.m.ListSeparators.Inner,visible:{path:"/searches/length",formatter:function(r){return(r!==0)}}}).addStyleClass("sapUshellHistoryScreenRecentSearches");l.bindAggregation("items","/searches",function(p,d){var S=new sap.m.StandardListItem({title:{parts:["sTerm","oDataSource/objectName/value","oDataSource"],formatter:function(t,o,D){if(o==="$$ALL$$"){return t}if(!D)return t;var b=D.label||D.objectName.label||D.objectName.value;return t+(b?", "+b:"")}},type:"Active"});S.data("sSearchTerm","{sTerm}");S.data("oDataSource","{oDataSource}");S.onAfterRendering=function(){$(this.getDomRef()).click(function(){s.getModel("searchModel").setDataSource(d.getObject().oDataSource,false);s.getModel("searchModel").setSearchTerm(d.getObject().sTerm,false);window.location.href="#Action-search&/searchTerm="+encodeURI(s.getModel("searchModel").getProperty("/searchBoxTerm"))+"&dataSource="+encodeURI(JSON.stringify(s.getModel("searchModel").getDataSourceJson()));if(s.viewSwitcher)s.viewSwitcher.switchViewState("searchResults")});$(this.getDomRef()).keyup(function(e){if(e.keyCode==13){this.click()}})};return S});this.searchLayout=new SearchLayout({bottomHeader:{parts:["/searches/length","i18n>recent_searches"],formatter:function(i,L){return i!==0?L:undefined}},bottomList:l,topHeader:{parts:["/dataSources/length","i18n>searchIn"],formatter:function(d,L){return d!==0?L:undefined}},topList:s.oRecentDataSources,searchBusy:true});var a="sfOverlay";if(s.getViewData()!==undefined&&s.getViewData().sf!==undefined)a=s.getViewData().sf;sap.ui.getCore().byId(a).addEventDelegate({onsapdown:function(e){s.oRecentDataSources.focus();e.preventDefault();e.stopPropagation()}});return this.searchLayout},dsRequestFinished:function(){this.searchLayout.setSearchBusy(false)},getControllerName:function(){return"sap.ushell.renderers.fiori2.search.HistoryScreen"}})}());
