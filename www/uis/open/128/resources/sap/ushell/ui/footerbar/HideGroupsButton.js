/*!
 * SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2013 SAP AG. All rights reserved
 */
jQuery.sap.declare("sap.ushell.ui.footerbar.HideGroupsButton");jQuery.sap.require("sap.ushell.library");jQuery.sap.require("sap.m.Button");sap.m.Button.extend("sap.ushell.ui.footerbar.HideGroupsButton",{metadata:{library:"sap.ushell"}});
// Copyright (c) 2013 SAP AG, All Rights Reserved
(function(){"use strict";jQuery.sap.declare("sap.ushell.ui.footerbar.HideGroupsButton");jQuery.sap.require("sap.ushell.resources");sap.ushell.ui.footerbar.HideGroupsButton.prototype.init=function(){this.setIcon('sap-icon://group-2');this.setTooltip(sap.ushell.resources.i18n.getText("hideGroupsBtn_tooltip"));this.setWidth('100%');this.setText(sap.ushell.resources.i18n.getText("hideGroupsBtn_title"));this.attachPress(this.openHideGroupsDialog);if(sap.m.Button.prototype.init){sap.m.Button.prototype.init.apply(this,arguments)}};sap.ushell.ui.footerbar.HideGroupsButton.prototype.openHideGroupsDialog=function(){jQuery.sap.require("sap.m.Dialog");jQuery.sap.require("sap.m.Button");jQuery.sap.require("sap.m.Table");jQuery.sap.require("sap.m.Switch");var t=this;this.handleChange=function(a){var b=a.oSource.getParent();b.toggleStyleClass('hideGroupsTableItem');b.getCells()[0].toggleStyleClass('hideGroupsDisabledCell')};this.groupsTableTemplate=new sap.m.ColumnListItem({cells:[new sap.m.Text({text:"{title}"}),new sap.m.Switch({state:"{isGroupVisible}",visible:"{isEnabled}",change:t.handleChange,customTextOff:" ",customTextOn:" ",tooltip:sap.ushell.resources.i18n.getText("hideGroups_switchTooltip")})]});this.groupsTable=new sap.m.Table("hideGroupsTable",{backgroundDesign:sap.m.BackgroundDesign.Transparent,showSeparators:sap.m.ListSeparators.Inner,columns:[new sap.m.Column({hAlign:sap.ui.core.TextAlign.Left,vAlign:"Middle"}),new sap.m.Column({hAlign:sap.ui.core.TextAlign.Right,vAlign:"Middle",width:"79px"})]});this.groupsTable.addStyleClass('hideGroupsTable');var o=this.groupsTable.onAfterRendering;this.groupsTable.onAfterRendering=function(a){o.apply(t.groupsTable,arguments);var b=a.srcControl.mAggregations.items;if(b){for(var i=0;i<b.length;i++){if(!b[i].getCells()[1].mProperties.state){b[i].addStyleClass('hideGroupsTableItem');b[i].getCells()[0].addStyleClass('hideGroupsDisabledCell')}}}setTimeout(function(){$('.sapMListTblRow').first().focus()},200)};this.groupsTable.setModel(this.getModel());var p=this.getModel().getProperty("/personalization");var e=[];if(!p){e.push(new sap.ui.model.Filter("tiles/length",sap.ui.model.FilterOperator.GT,0))}this.groupsTable.bindItems({path:"/groups",template:this.groupsTableTemplate,filters:e});this.saveButton=new sap.m.Button("saveBtn",{text:sap.ushell.resources.i18n.getText("okBtn"),press:function(){setTimeout(function(){var m=this.getModel();var g=m.getProperty('/groups');if(g){var l=sap.ushell.Container.getService("LaunchPage");var h=[];for(var i=0;i<g.length;i++){if(!g[i].isGroupVisible){var a=l.getGroupId(g[i].object);h.push(a)}}l.hideGroups(h).done(function(){t.handleToastMessage(h.length)}).fail(function(){var b=new sap.ushell.ui.launchpad.EmbeddedSupportErrorMessage("HideGroupsErrorMessage",{title:sap.ushell.resources.i18n.getText("error"),content:new sap.m.Text({text:sap.ushell.resources.i18n.getText("hideGroups_error")})});b.open()});m.updateBindings('items');m.updateBindings('groups')}}.bind(this),100);this.oDialog.close()}.bind(this)});this.handleToastMessage=function(n){var m="";if(typeof(n)===undefined)return;if(n===0){m=sap.ushell.resources.i18n.getText("hideGroups_none")}else if(n===1){m=sap.ushell.resources.i18n.getText("hideGroups_single")}else{m=sap.ushell.resources.i18n.getText("hideGroups_multiple",n)}sap.ushell.Container.getService("Message").show(sap.ushell.services.Message.Type.INFO,m)};this.cancelButton=new sap.m.Button("CancelBtn",{text:sap.ushell.resources.i18n.getText("cancelBtn"),press:function(){if(t.aGroupsStates){var g=this.getModel().getProperty('/groups');for(var i=0;i<t.aGroupsStates.length;i++){if(g[i].groupId===t.aGroupsStates[i].groupId){g[i].isGroupVisible=t.aGroupsStates[i].isVisible}}}this.oDialog.close()}.bind(this)});this.oDialog=new sap.m.Dialog({id:"groupsVisibilityDialog",title:sap.ushell.resources.i18n.getText("hideGroups_title"),contentWidth:"300px",stretch:jQuery.device.is.phone,content:this.groupsTable,beginButton:this.saveButton,endButton:this.cancelButton,initialFocus:"groupsVisibilityDialog",afterClose:function(){this.oDialog.destroy()}.bind(this)});this.getModelStates=function(g){if(!g)return;var s=[];for(var i=0;i<g.length;i++){s.push({groupId:g[i].groupId,isVisible:g[i].isGroupVisible})}return s};this.aGroupsStates=this.getModelStates(this.getModel().getProperty('/groups'));this.oDialog.open()}}());
