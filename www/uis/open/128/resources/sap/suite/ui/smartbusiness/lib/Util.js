jQuery.sap.declare("sap.suite.ui.smartbusiness.lib.Util");jQuery.sap.require("sap.suite.ui.smartbusiness.lib.oData4Analytics");sap.suite=sap.suite||{};sap.suite.smartbusiness=sap.suite.smartbusiness||{};sap.suite.smartbusiness.odata=(function(){var m={};function g(M){var O=new sap.suite.smartbusiness.odata4analytics.Model(sap.suite.smartbusiness.odata4analytics.Model.ReferenceByModel(M));return O};return{getModelByServiceUri:function(s,u){if(typeof s=='string'){if(!m[s]){var M=new sap.ui.model.odata.ODataModel(s,true);m[s]=M}return m[s]}return s},getUri:function(p){function _(s){return s.replace(/'/g,"''")}try{var O=g(this.getModelByServiceUri(p.oDataModel||p.serviceUri));var q=O.findQueryResultByName(p.entitySet);var Q=new sap.suite.smartbusiness.odata4analytics.QueryResultRequest(q);var a=p.measure;if(a){if(typeof a=='string'){a=a.split(",")}Q.setMeasures(a);if(typeof p.includeMeasureRawFormattedValueUnit=='undefined'){p.includeMeasureRawFormattedValueUnit=true}if(p.includeMeasureRawFormattedValueUnit){Q.includeMeasureRawFormattedValueUnit(null,true,true,true)}}var d=p.dimension;if(d){if(typeof d=='string'){d=d.split(",")}Q.addToAggregationLevel(d);if(typeof p.includeDimensionKeyTextAttribute=='undefined'){p.includeDimensionKeyTextAttribute=true}if(p.includeDimensionKeyTextAttribute){Q.includeDimensionKeyTextAttributes(null,true,true,null)}}if(p.filter&&p.filter.length){var v=p.filter;var f=new Array();var b=new Array();for(var i=0,l=v.length;i<l;i++){var c=v[i];if(c.TYPE==="PA"){b.push(c)}else if(c.TYPE==="FI"){f.push(c)}}function h(r){var s=r.toJSON();var t=s.charAt(s.length-1).toUpperCase();if(t.charCodeAt(0)>=65&&t.charCodeAt(0)<=90){s=s.slice(0,-1)}return s};function j(r){if(r){try{if(r==+r){r=window.parseInt(r)}var s=new Date(r);var t=s.getTime();if(isNaN(t)){return r}else{return h(s)}}catch(e){}}return r};if(f.length){var F=Q.getFilterExpression();for(var i=0,l=f.length;i<l;i++){var c=f[i];if(this.getEdmType(p.serviceUri,c.NAME)=="Edm.DateTime"){c.VALUE_1=j(c.VALUE_1);c.VALUE_2=j(c.VALUE_2)}if(c.OPERATOR==sap.ui.model.FilterOperator.BT){F.addCondition(c.NAME,c.OPERATOR,window.encodeURIComponent(_(c.VALUE_1)),window.encodeURIComponent(c.VALUE_2))}else{F.addCondition(c.NAME,c.OPERATOR,window.encodeURIComponent(_(c.VALUE_1.replace(/\|\^/g,","))),null)}}}if(b.length){if(q.getParameterization()){var P=new sap.suite.smartbusiness.odata4analytics.ParameterizationRequest(q.getParameterization());for(var y=0,z=b.length;y<z;y++){var k=b[y];P.setParameterValue(k.NAME,window.encodeURIComponent(_(k.VALUE_1)))}Q.setParameterizationRequest(P)}}}var n=Q.getURIToQueryResultEntries();if(p.sort&&p.sort.length){var o="&$orderby=";p.sort.forEach(function(s){o+=s.name+" "+s.order+","});o=o.substring(0,o.length-1);n=n+o}if(p.dataLimit){n=n+"&$top="+p.dataLimit}return{uri:n,model:O.getODataModel()}}catch(e){jQuery.sap.log.error("Error Preparing Query Service Uri using OData4Analytics Library : "+e.toString());return null}},getEdmType:function(u,p,d){function _(f){var h="None";var k=f.extensions||[];for(var i=0;i<k.length;i++){if(k[i].name=="display-format"){h=k[i].value.toUpperCase();break}}return h}var D=null;var r=null;if(u instanceof sap.ui.model.odata.ODataModel){D=u}else{D=this.getModelByServiceUri(u)}if(D&&D.getServiceMetadata()){var s=D.getServiceMetadata();var e=s.dataServices.schema[0].entityType;if(e){for(var i=0;i<e.length;i++){var a=e[i];var b=a.property;for(var j=0;j<b.length;j++){var c=b[j];if(c.name==p){if(d){r={type:c.type,format:_(c)}}else{r=c.type}}}}}}return r},getAllEntitySet:function(u){var a=new Array();try{var o=g(this.getModelByServiceUri(u));a=o.getAllQueryResultNames()}catch(e){jQuery.sap.log.error("Error fetching Enity Set : "+e.toString())}return a},measures:function(u,e){var o=g(this.getModelByServiceUri(u));var q=o.findQueryResultByName(e);var a=q.getAllMeasureNames();return{getAsStringArray:function(){return a},getAsObjectArray:function(k){k=k||"name";var b=[];a.forEach(function(M){var c={};c[k]=M;b.push(c)});return b},getAsObjectArrayWithLabel:function(O,l){O=O||"name";l=l||"label";var b=[];a.forEach(function(M){var c=q.findMeasureByName(M);var d={};d[O]=M;d[l]=c.getLabelText()||M;b.push(d)});return b},getUnitProperty:function(b){var M=q.findMeasureByName(b);if(M.getUnitProperty()){return M.getUnitProperty().name}return null}}},properties:function(u,a){var o=g(this.getModelByServiceUri(u));var q=o.findQueryResultByName(a);var d=q.getAllDimensionNames();var b=q.getAllMeasureNames();return{getLabelMappingObject:function(p){var c={};if(p&&p.length){p.forEach(function(f,i,h){try{var D=q.findDimensionByName(f);c[f]=D.getLabelText()||f}catch(e){var M=q.findMeasureByName(f);c[f]=M.getLabelText()||f}});return c}else{d.forEach(function(D){var e=q.findDimensionByName(D);c[D]=e.getLabelText()||D});b.forEach(function(M){var e=q.findMeasureByName(M);c[M]=e.getLabelText()||M});return c}},getTextPropertyMappingObject:function(p){var c={};if(p&&p.length){p.forEach(function(f,i,h){try{var D=q.findDimensionByName(f);if(D.getTextProperty()){c[f]=D.getTextProperty().name||f}else{c[f]=f}}catch(e){jQuery.sap.log.error("Invalid Dimension Name : "+f)}})}else{d.forEach(function(D){var e=q.findDimensionByName(D);if(e.getTextProperty()){c[D]=e.getTextProperty().name||D}else{c[D]=D}});b.forEach(function(M){var e=q.findMeasureByName(M);if(e.getFormattedValueProperty&&e.getFormattedValueProperty()){c[M]=e.getFormattedValueProperty().name}else{c[M]=null}})}return c},getUnitPropertyMappingObject:function(){var c={};b.forEach(function(M){var e=q.findMeasureByName(M);if(e.getUnitProperty()){c[M]=e.getUnitProperty().name}else{c[M]=null}});return c}}},dimensions:function(u,e){var o=g(this.getModelByServiceUri(u));var q=o.findQueryResultByName(e);var d=q.getAllDimensionNames();return{getAsStringArray:function(){var a=q.getEntityType();return d},getAsObjectArray:function(k){k=k||"name";var a=[];d.forEach(function(D){var b={};b[k]=D;a.push(b)});return a},getAsObjectArrayWithLabel:function(O,l){O=O||"name";l=l||"label";var a=[];d.forEach(function(D){var b=q.findDimensionByName(D);var c={};c[O]=D;c[l]=b.getLabelText()||D;a.push(c)});return a},getTextProperty:function(a){var D=q.findDimensionByName(a);if(D.getTextProperty()){return D.getTextProperty().name}return null}}},getAllMeasures:function(u,a){var b=new Array();try{var o=g(this.getModelByServiceUri(u));var q=o.findQueryResultByName(a);b=q.getAllMeasureNames()}catch(e){jQuery.sap.log.error("Error Fetching All Measures : "+e.toString())}return b},getAllMeasuresWithLabelText:function(u,a){var b=new Array();try{var o=g(this.getModelByServiceUri(u));var q=o.findQueryResultByName(a);var c=q.getAllMeasureNames();for(var i=0;i<c.length;i++){var d=c[i];var M=q.findMeasureByName(d);b.push({key:d,value:M.getLabelText()})}}catch(e){jQuery.sap.log.error("Error Fetching All Measures : "+e.toString())}return b},isTimeZoneIndependent:function(u,a){var i=false;try{var o=g(this.getModelByServiceUri(u));var q=o.findQueryResultByName(a);var b=q.getEntityType();var c=b._oPropertySet;for(var d in c){if(d.match(/TimeZone$/gi)){i=true}}}catch(e){jQuery.sap.log.error("TimeZone dependency check failed : "+e.toString())}return i},getAllDimensions:function(u,a){function i(c,h){var j=0,k=0;var r=new Array();while(j<c.length&&k<h.length){if(c[j]<h[k]){j++}else if(c[j]>h[k]){k++}else{r.push(c[j]);j++;k++}}return r}var d=new Array();var f=new Array();try{var o=g(this.getModelByServiceUri(u));var q=o.findQueryResultByName(a);var b=q.getEntityType();f=b.getFilterablePropertyNames();d=q.getAllDimensionNames();if(f&&f.length){d=i(f.sort(),d.sort())}}catch(e){jQuery.sap.log.error("Error Fetching All Dimesions : "+e.toString())}return d},getAllDimensionsWithLabelText:function(u,a){var d=new Array();try{var o=g(this.getModelByServiceUri(u));var q=o.findQueryResultByName(a);var b=q.getAllDimensionNames();for(var i=0;i<b.length;i++){var c=b[i];var D=q.findDimensionByName(c);var t=null;if(D.getTextProperty()!=null)t=D.getTextProperty().name;d.push({key:c,value:D.getLabelText(),textProperty:t})}}catch(e){jQuery.sap.log.error("Error Fetching All Dimesions : "+e.toString())}return d},getAllInputParams:function(u,a){var i=new Array();try{var o=g(this.getModelByServiceUri(u));var q=o.findQueryResultByName(a);if(q.getParameterization()){var p=q.getParameterization();i=p.getAllParameterNames()}}catch(e){jQuery.sap.log.error("Error Fetching Input Params : "+e.toString())}return i},getAllInputParamsWithFlag:function(u,a){var b=new Array();try{var o=g(this.getModelByServiceUri(u));var q=o.findQueryResultByName(a);if(q.getParameterization()){var p=q.getParameterization();var c=p.getAllParameterNames();for(var i=0;i<c.length;i++){var d=c[i];var f=p.findParameterByName(d);b.push({name:d,optional:f.isOptional()})}}}catch(e){jQuery.sap.log.error("Error Fetching Input Params : "+e.toString())}return b},formatOdataEdmTimeToString:function(v){if(v&&v.constructor.name=="Object"){if(v.__edmType=="Edm.Time"){var a=v.ms;var s=Math.floor((a/1000)%60);var b=Math.floor((a/60000)%60);var h=Math.floor((a/3600000)%24);return h+"H"+b+"M"+s+"S"}}return v},formatValue:function(v,s,p,M){M=M||4;var u={3:"K",6:"M",9:"B",12:"T",0:""};var t,a,b;t=Number(v).toPrecision(M);a=Number(t.split("e")[0]);b=Number(t.split("e")[1])||0;if(!v&&v!=0)return{value:"",unitPrefix:""};if(b%3!=0){if(b%3==2){if(b+1==s){b=b+1;a=a/10}else{b=b-2;a=a*100}}else{if(b+2==s){b=b+2;a=a/100}else{b--;a=a*10}}}else if(b==15){a=a*1000;b=12}a+="";if((a).indexOf(".")<M){a=Number(a).toPrecision(M);var c=a.split(".")[1]?a.split(".")[1].length:0;if((p||p==0)&&p<c){a=Number(a).toFixed(p)}}else a=Number(a).toPrecision(M);return{value:Number(a),unitPrefix:u[b]}}}})();sap.suite.smartbusiness.cache=(function(){var B={};var D={};return{getEvaluationById:function(k){if(B[k]){return B[k]}return null},setEvaluationById:function(k,d){B[k]=d},getKpiDetailsById:function(k){if(D[k]){return D[k]}return null},setKpiDetailsById:function(k,d){D[k]=d},invalidateKpiDetailsCache:function(){D={}},current_calls:{}}})();sap.suite.smartbusiness.utils=(function(){return{addSystemToServiceUrl:function(s,S){if(S){if(s.indexOf('/')!==0||s.indexOf('//')===0){throw new Error("addSystemToServiceUrl: Invalid URL: "+s,"sap.suite.smartbusiness.utils")}if(/^[^?]*(;o=([\/;?]|$))/.test(s)){return s.replace(/;o=([\/;?]|$)/,(S?";o="+S:"")+"$1")}if(/^[^?]*;o=/.test(s)){return s}if(S){return s.replace(/(\/[^?]*?)(\/$|$|(\/?\?.*))/,"$1;o="+S+"$2")}}else{jQuery.sap.log.warning("Not adding System to Service URL : "+s)}return s},showErrorMessage:function(e,d){if(d==null||d==''){sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:e})}else{sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:e,details:d})}},getMantissaLength:function(n){var N=n.toString();var i=0;if(n<0){i=1}return(N.indexOf('.')===-1)?(n<0?N.length-1:N.length):N.substring(i,N.indexOf('.')).length},getLocaleFormattedValue:function(n,s){if(s==-2){var N;if(n>9999)N="????";else if(n<0.001)N="0";else if(n.toString().indexOf('.')!=-1)N=Number(n).toFixed(4-n.toString().indexOf('.'));else N=Number(n)}else{var d=2;var m=this.getMantissaLength(n);if(!(m%6))d=1;if(Math.abs(n)%Math.pow(10,m-1)==0){d=0}else if((Math.abs(n)%Math.pow(10,m-1))<6*Math.pow(10,m-4)){d=0}var l=new sap.ui.core.Locale(sap.ui.getCore().getConfiguration().getLanguage());var v=sap.ca.ui.model.format.NumberFormat.getInstance({style:"short",shortDecimals:d},l);var N=v.format(n)}return N},getRandomNumber:function(m){return Math.floor(Math.random()*10000)%m},getObjectOrder:function(o){var d={TAGS:["ID","IS_ACTIVE","TYPE","TAG"],PROPERTIES:["ID","IS_ACTIVE","TYPE","NAME","VALUE"],EVALUATION_TEXTS:["ID","IS_ACTIVE","LANGUAGE","TITLE","DESCRIPTION"],INDICATOR_TEXTS:["ID","IS_ACTIVE","LANGUAGE","TITLE","DESCRIPTION"],CHIP_TEXTS:["id","isActive","language","title","description"],EVALUATION_VALUES:["ID","IS_ACTIVE","TYPE","FIXED","COLUMN_NAME","ODATA_PROPERTY"],EVALUATION_FILTERS:["ID","IS_ACTIVE","TYPE","NAME","VALUE_1","OPERATOR","VALUE_2"],ASSOCIATION_PROPERTIES:["TYPE","SOURCE_INDICATOR","TARGET_INDICATOR","IS_ACTIVE","NAME","VALUE"],APP_PARAMETERS:["NAME","VALUE"],AUTHORIZATION:["NAME","TYPE"]};return d[o]},getFilterArray:function(a,f){var b=[];var c={};for(var i=0,l=a.length;i<l;i++){c[a[i].getParent().getKey()]=c[a[i].getParent().getKey()]||[];c[a[i].getParent().getKey()].push(f[a[i].getKey()])}for(var d in c){b.push(new sap.ui.model.Filter(c[d],false))}return b},dirtyBitCheck:function(a){var b=a.oldPayload;var c=a.newPayload;var t=a.objectType;if((b instanceof Array)&&(c instanceof Array)){var o={};var n={};var u=[];var d=[];o=this.arrayToObject(b,t);n=this.arrayToObject(c,t);for(var a in n){if(!(o[a])){u.push(n[a])}else{delete o[a]}}for(var a in o){d.push(o[a])}return{updates:u,deletes:d}}else if((b instanceof Object)&&(c instanceof Object)){var e={};for(var k in c){if(c.hasOwnProperty(k)){if(c[k]!=b[k]){e=c;if(t=="ASSOCIATIONS"){return{updates:[e],deletes:[b]}}return{updates:[e]}}}}return{updates:[]}}},updateChips:function(o,a){var b=null;var e=null;a=a||new sap.ui.model.odata.ODataModel("/sap/hba/r/sb/core/odata/modeler/SMART_BUSINESS.xsodata",true);if(o.INDICATORS){b=o.INDICATORS}else if(o.EVALUATIONS){e=o.EVALUATIONS}if(b&&b.length){for(var i=0,l=b.length;i<l;i++){}}if(e&&e.length){for(var i=0,l=e.length;i<l;i++){a.read(("/CHIPS?$filter=evaluationId eq '"+e[i].EVALUATIONS.ID+"' and isActive eq 1"),null,null,false,function(d){if(d.results&&d.results.length){var c=d.results;var u=[];var v=[];var f=[];var g=true;var o={};for(var j=0,m=c.length;j<m;j++){var h=JSON.parse(c[j].configuration);var t=JSON.parse(h.tileConfiguration);for(var k=0,n=e[i].EVALUATION_VALUES.length;k<n;k++){o={};o.TYPE=e[i].EVALUATION_VALUES[k].TYPE;o.FIXED=e[i].EVALUATION_VALUES[k].FIXED;o.COLUMN_NAME=e[i].EVALUATION_VALUES[k].COLUMN_NAME;o.ODATA_PROPERTY=e[i].EVALUATION_VALUES[k].ODATA_PROPERTY;v.push(o)}for(var k=0,n=e[i].EVALUATION_FILTERS.length;k<n;k++){o={};o.TYPE=e[i].EVALUATION_FILTERS[k].TYPE;o.NAME=e[i].EVALUATION_FILTERS[k].NAME;o.VALUE_1=e[i].EVALUATION_FILTERS[k].VALUE_1;o.OPERATOR=e[i].EVALUATION_FILTERS[k].OPERATOR;o.VALUE_2=e[i].EVALUATION_FILTERS[k].VALUE_2;f.push(o)}t.EVALUATION=JSON.stringify(e[i].EVALUATIONS);t.EVALUATION_VALUES=JSON.stringify(v);t.EVALUATION_FILTERS=JSON.stringify(f);h.tileConfiguration=JSON.stringify(t);h.timeStamp=Date.now().toString();h=JSON.stringify(h);if(h.length>4096){t.EVALUATION_FILTERS=JSON.stringify([]);h=JSON.stringify({tileConfiguration:JSON.stringify(t),isSufficient:"0"})}for(var p in d.results[j]){if(d.results[j].hasOwnProperty(p)){if((d.results[j][p]instanceof Object)&&!(d.results[j][p]instanceof Array)&&!(d.results[j][p]instanceof Date)){delete d.results[j][p]}}}d.results[j].configuration=h;var q="CHIPS(id='"+d.results[j].id+"',isActive=1)";u.push(a.createBatchOperation(q,"PUT",d.results[j]))}a.addBatchChangeOperations(u);a.submitBatch(function(d,r,s){if(s.length){g=false;return}var w=d.__batchResponses[0].__changeResponses;for(var x in w)if(w[x].statusCode!="201"&&w[x].statusCode!="204"&&w[x].statusCode!="200"){g=false}},function(r){g=false},false);if(!g){}}},function(c){})}}},arrayToObject:function(a,t){var o=this.getObjectOrder(t);var b={};var k="";for(var i=0,l=a.length;i<l;i++){if(!(a[i]instanceof Array)&&(a[i]instanceof Object)){k="";for(var j=0,m=o.length;j<m;j++){k+=(j)?"^|":"";k+=a[i][o[j]]}b[k]=a[i]}}return b},appToAppNavigation:function(o){var h="#";var a=window.hasher.getHashAsArray();var b=a[0].substr(a[0].indexOf("?"));if(b&&(b.charAt(b.length-1)=="&")){b=b.substr(0,b.length-1)}if(o.action){if(o.context||o.route){if(o.context.charAt(0)=="/"){o.context=o.context.substr(1)}o.context="&/"+((o.route+"/")||"")+(o.context||"")}h+=(o.semanticObject||"FioriApplication-")+o.action+b+(o.context||"")}if(!(sap.ui.core.routing)){jQuery.sap.require("sap.ui.core.routing")}var c=new sap.ui.core.routing.HashChanger();sap.suite.smartbusiness.utils.setPrevAppHash();c.setHash(h)},hashChange:function(o){if(!(sap.ui.core.routing)){jQuery.sap.require("sap.ui.core.routing")}var h=new sap.ui.core.routing.HashChanger();h.setHash(o.hash||"#")},replaceHash:function(o,i){if(i){window.location.replace(o.hash)}else{var h="#";var a=window.hasher.getHashAsArray();var b=a[0].substr(a[0].indexOf("?"));if(b&&(b.charAt(b.length-1)=="&")){b=b.substr(0,b.length-1)}if(o.action){if(o.context||o.route){if(o.context.charAt(0)=="/"){o.context=o.context.substr(1)}o.context="&/"+((o.route+"/")||"")+(o.context||"")}h+=(o.semanticObject||"FioriApplication-")+o.action+b+(o.context||"")}window.location.replace(h)}},setPrevAppHash:function(){hasher=hasher||window.hasher;sap.suite.smartbusiness=sap.suite.smartbusiness||{};sap.suite.smartbusiness.modelerAppCache=sap.suite.smartbusiness.modelerAppCache||{};sap.suite.smartbusiness.modelerAppCache.prevApp=sap.suite.smartbusiness.modelerAppCache.prevApp||{};sap.suite.smartbusiness.modelerAppCache.prevApp.prevAppHash=hasher.getHash();sap.suite.smartbusiness.modelerAppCache.prevApp.prevAppHashAsArray=hasher.getHashAsArray()},backToHome:function(){sap.suite.smartbusiness=sap.suite.smartbusiness||{};sap.suite.smartbusiness.modelerAppCache=sap.suite.smartbusiness.modelerAppCache||{};if(sap.suite.smartbusiness.modelerAppCache.prevApp){delete sap.suite.smartbusiness.modelerAppCache.prevApp}sap.suite.smartbusiness.modelerAppCache.SBWorkspace={};sap.suite.smartbusiness.modelerAppCache.createSBKPI={};sap.suite.smartbusiness.modelerAppCache.createSBKPIEvaluation={};sap.suite.smartbusiness.modelerAppCache.configureSBKPITile={};sap.suite.smartbusiness.modelerAppCache.manageSBKPIAssociation={};sap.suite.smartbusiness.modelerAppCache.configureSBKPIDrilldown={};sap.suite.smartbusiness.modelerAppCache.authorizeSBEvaluation={}},isHanaViewValid:function(o){sap.suite.smartbusiness=sap.suite.smartbusiness||{};sap.suite.smartbusiness.modelerAppCache=sap.suite.smartbusiness.modelerAppCache||{};sap.suite.smartbusiness.modelerAppCache[o.app]=sap.suite.smartbusiness.modelerAppCache[o.app]||{};if(!(o.VIEW_NAME)){return false}if(o.cache&&o.app&&(sap.suite.smartbusiness.modelerAppCache[o.app].hanaViewValid!==undefined)){return sap.suite.smartbusiness.modelerAppCache[o.app].hanaViewValid}else{var f=false;var e="/HANA_VIEWS"+"?$filter="+"PACKAGE eq "+"'"+o.VIEW_NAME.substr(0,o.VIEW_NAME.indexOf("/"))+"'"+" and "+"OBJECT eq "+"'"+o.VIEW_NAME.substr(o.VIEW_NAME.indexOf("/")+1)+"'";o.model=o.model||new sap.ui.model.odata.ODataModel("/sap/hba/r/sb/core/odata/modeler/SMART_BUSINESS.xsodata",true);o.model.read(e,null,null,false,function(d){if(d.results.length){f=true}else{f=false}},function(){f=true});if(o.app){sap.suite.smartbusiness.modelerAppCache[o.app].hanaViewValid=f}return f}},isHanaViewFormatValid:function(o){sap.suite.smartbusiness=sap.suite.smartbusiness||{};sap.suite.smartbusiness.modelerAppCache=sap.suite.smartbusiness.modelerAppCache||{};sap.suite.smartbusiness.modelerAppCache[o.app]=sap.suite.smartbusiness.modelerAppCache[o.app]||{};if(!(o.VIEW_NAME)){return false}if(o.cache&&o.app&&(sap.suite.smartbusiness.modelerAppCache[o.app].hanaViewFormatValid!==undefined)){return sap.suite.smartbusiness.modelerAppCache[o.app].hanaViewFormatValid}else{if((o.VIEW_NAME.indexOf("/")==-1)&&(o.VIEW_NAME.indexOf("::")==-1)){if(o.app){sap.suite.smartbusiness.modelerAppCache[o.app].hanaViewFormatValid=false}return false}if(o.app){sap.suite.smartbusiness.modelerAppCache[o.app].hanaViewFormatValid=true}return true}},isODataURLValidForHanaView:function(o){sap.suite.smartbusiness=sap.suite.smartbusiness||{};sap.suite.smartbusiness.modelerAppCache=sap.suite.smartbusiness.modelerAppCache||{};sap.suite.smartbusiness.modelerAppCache[o.app]=sap.suite.smartbusiness.modelerAppCache[o.app]||{};if(o.cache&&o.app&&(sap.suite.smartbusiness.modelerAppCache[o.app].oDataURLValid!==undefined)){return sap.suite.smartbusiness.modelerAppCache[o.app].oDataURLValid}else{var e="/ODATA_FOR_ENTITY"+"("+"P_PACKAGE="+"'"+o.VIEW_NAME.substr(0,o.VIEW_NAME.indexOf("/"))+"'"+","+"P_OBJECT="+"'"+o.VIEW_NAME.substr(o.VIEW_NAME.indexOf("/")+1)+"'"+")/Results";o.model=o.model||new sap.ui.model.odata.ODataModel("/sap/hba/r/sb/core/odata/modeler/SMART_BUSINESS.xsodata",true);o.model.read(e,null,null,false,function(d){if(d.results.length){if(d.results.indexOf(odata)){if(o.app){sap.suite.smartbusiness.modelerAppCache[o.app].oDataURLValid=true;sap.suite.smartbusiness.modelerAppCache[o.app].oDataURLValidForHanaView=true}return true}else{if(o.app){sap.suite.smartbusiness.modelerAppCache[o.app].oDataURLValid=false;sap.suite.smartbusiness.modelerAppCache[o.app].oDataURLValidForHanaView=false}return false}}else{if(o.app){sap.suite.smartbusiness.modelerAppCache[o.app].oDataURLValid=false;sap.suite.smartbusiness.modelerAppCache[o.app].oDataURLValidForHanaView=false}return false}},function(){if(o.app){sap.suite.smartbusiness.modelerAppCache[o.app].oDataURLValid=false;sap.suite.smartbusiness.modelerAppCache[o.app].oDataURLValidForHanaView=false}return false})}},isODataURLValidByExistence:function(o){sap.suite.smartbusiness=sap.suite.smartbusiness||{};sap.suite.smartbusiness.modelerAppCache=sap.suite.smartbusiness.modelerAppCache||{};sap.suite.smartbusiness.modelerAppCache[o.app]=sap.suite.smartbusiness.modelerAppCache[o.app]||{};if(o.cache&&o.app&&(sap.suite.smartbusiness.modelerAppCache[o.app].oDataURLValid!==undefined)){return sap.suite.smartbusiness.modelerAppCache[o.app].oDataURLValid}else{var m=new sap.ui.model.odata.ODataModel(o.ODATA_URL,true);if(m.getServiceMetadata()){odataExists=true}else{odataExists=false}if(o.app){sap.suite.smartbusiness.modelerAppCache[o.app].oDataURLValid=odataExists;sap.suite.smartbusiness.modelerAppCache[o.app].oDataURLValidByExistence=odataExists}return odataExists}},isODataURLValid:function(o){if(o.VIEW_NAME){return sap.suite.smartbusiness.utils.isODataURLValidForHanaView(o)}else{return sap.suite.smartbusiness.utils.isODataURLValidByExistence(o)}},isEntitysetValid:function(o){sap.suite.smartbusiness=sap.suite.smartbusiness||{};sap.suite.smartbusiness.modelerAppCache=sap.suite.smartbusiness.modelerAppCache||{};sap.suite.smartbusiness.modelerAppCache[o.app]=sap.suite.smartbusiness.modelerAppCache[o.app]||{};if(o.cache&&o.app&&(sap.suite.smartbusiness.modelerAppCache[o.app].entitysetValid!==undefined)){return sap.suite.smartbusiness.modelerAppCache[o.app].entitysetValid}else{try{if(o.VIEW_NAME){}else{if(sap.suite.smartbusiness.odata.getAllEntitySet(o.ODATA_URL).indexOf(o.ODATA_ENTITYSET)==-1){if(o.app){sap.suite.smartbusiness.modelerAppCache[o.app].entitysetValid=false}return false}else{if(o.app){sap.suite.smartbusiness.modelerAppCache[o.app].entitysetValid=true}return true}}}catch(e){if(o.app){sap.suite.smartbusiness.modelerAppCache[o.app].entitysetValid=false}return false}}},isMeasureValid:function(o){sap.suite.smartbusiness=sap.suite.smartbusiness||{};sap.suite.smartbusiness.modelerAppCache=sap.suite.smartbusiness.modelerAppCache||{};sap.suite.smartbusiness.modelerAppCache[o.app]=sap.suite.smartbusiness.modelerAppCache[o.app]||{};if(o.cache&&o.app&&(sap.suite.smartbusiness.modelerAppCache[o.app].measureValid!==undefined)){return sap.suite.smartbusiness.modelerAppCache[o.app].measureValid}try{if(sap.suite.smartbusiness.odata.getAllMeasures(o.ODATA_URL,o.ODATA_ENTITYSET).indexOf(o.COLUMN_NAME)==-1){if(o.app){sap.suite.smartbusiness.modelerAppCache[o.app].measureValid=false}return false}else{if(o.app){sap.suite.smartbusiness.modelerAppCache[o.app].validValueMeasure=true}return true}}catch(e){if(o.app){sap.suite.smartbusiness.modelerAppCache[o.app].validValueMeasure=false}return false}},getHanaSystem:function(){var h=hasher||window.hasher;var a=h.getHashAsArray();if(a&&a.length&&a[0]){var b=a[0].substr(a[0].indexOf("?")+1).split("&");for(var i=0,l=b.length;i<l;i++){if(b[i]&&(b[i].indexOf("sap-system")!=-1)){return b[i].split("=")[1]}}}return""},fetchCSRFToken:function(){var t="/sap/hba/r/sb/core/logic/__token.xsjs";if(sap.ushell&&sap.ushell.Container){t=sap.ushell.Container.getService("URLParsing").addSystemToServiceUrl(t,this.getHanaSystem())}return jQuery.ajax({type:"HEAD",async:false,dataType:"json",url:t,headers:{"X-CSRF-Token":"Fetch"},success:function(d,s,x){},error:function(){}})},appendUrlParameters:function(u,a){var b=u.split("?");if(b.length>2){throw new Error("Url not formed properly")}if(sap.ushell&&sap.ushell.Container){b[0]=sap.ushell.Container.getService("URLParsing").addSystemToServiceUrl(b[0],this.getHanaSystem())}u=b[0];if(b.length==2){u+="?"+b[1]}if(a&&Object.keys(a)&&Object.keys(a).length){u=u+"?"+jQuery.param(a)}return u},getLocaleLanguage:function(){return((sap.ui.getCore().getConfiguration().getLanguage())?sap.ui.getCore().getConfiguration().getLanguage().split("-")[0].toUpperCase():"")},create:function(u,p,a,b,e,c,f){var t=this;c=c?true:false;sap.suite.smartbusiness.utils.fetchCSRFToken().done(function(d,s,x){jQuery.ajax({type:"POST",async:c,url:sap.suite.smartbusiness.utils.appendUrlParameters(u,f),data:encodeURIComponent(JSON.stringify(p)),headers:{"X-CSRF-Token":x.getResponseHeader("X-CSRF-Token"),"Accept-Language":t.getLocaleLanguage()},success:b,error:e})})},update:function(u,p,a,b,e,m,c,f,g){var t=this;f=f?true:false;sap.suite.smartbusiness.utils.fetchCSRFToken().done(function(d,s,x){jQuery.ajax({type:"PUT",async:f,url:sap.suite.smartbusiness.utils.appendUrlParameters(u,g),data:encodeURIComponent(JSON.stringify(p)),headers:{"X-CSRF-Token":x.getResponseHeader("X-CSRF-Token"),"Accept-Language":t.getLocaleLanguage(),"If-None-Match":(c||"")},success:b,error:e})})},remove:function(u,p,a,e,b,c,f,g){var t=this;f=f?true:false;sap.suite.smartbusiness.utils.fetchCSRFToken().done(function(d,s,x){jQuery.ajax({type:"DELETE",async:f,url:sap.suite.smartbusiness.utils.appendUrlParameters(u,g),data:encodeURIComponent(JSON.stringify(p)),headers:{"X-CSRF-Token":x.getResponseHeader("X-CSRF-Token"),"Accept-Language":t.getLocaleLanguage(),"If-None-Match":(b||"")},success:a,error:e})})},serviceUrl:function(u){var C={INDICATOR_SERVICE_URI:"/sap/hba/r/sb/core/logic/indicators.xsjs",EVALUATION_SERVICE_URI:"/sap/hba/r/sb/core/logic/evaluations.xsjs",CHIP_SERVICE_URI:"/sap/hba/r/sb/core/logic/chips.xsjs",ACTIVATE_INDICATOR_SERVICE_URI:"/sap/hba/r/sb/core/logic/activateIndicator.xsjs",ACTIVATE_EVALUATION_SERVICE_URI:"/sap/hba/r/sb/core/logic/activateEvaluation.xsjs",INDICATOR_FAVOURITE_SERVICE_URI:"/sap/hba/r/sb/core/logic/favouriteIndicator.xsjs",EVALUATION_FAVOURITE_SERVICE_URI:"/sap/hba/r/sb/core/logic/favouriteEvaluation.xsjs",ASSOCIATIONS_CUD:"/sap/hba/r/sb/core/logic/associations_cud.xsjs",ACTIVATE_ASSOCIATION_SERVICE_URI:"/sap/hba/r/sb/core/logic/activateAssociation.xsjs",ACTIVATE_CHIP_SERVICE_URI:"/sap/hba/r/sb/core/logic/activateChip.xsjs",AUTHORIZATION_SERVICE_URI:"/sap/hba/r/sb/core/logic/authorization.xsjs",COPY_DDA_CONFIGURATION_SERVICE_URI:"/sap/hba/r/sb/core/logic/copyDrilldownConfiguration.xsjs"};return C[u]}}})();sap.suite.smartbusiness.kpi=(function(){var C={KPI_SERVICE_URI:"/sap/hba/r/sb/core/odata/modeler/SMART_BUSINESS.xsodata",KPI_RUNTIME_SERVICE_URI:"/sap/hba/r/sb/core/odata/runtime/SMART_BUSINESS.xsodata",EVALUATIONS_ENTITY_SET:"/EVALUATIONS",EVALUATIONS_DDA_ENTITY_SET:"/EVALUATIONS_DDA",ASSOCIATED_INDICATORS_ENTITY_SET:"ASSOCIATED_INDICATORS",DESIGN_TIME_SERVICE_URI:"/sap/hba/r/sb/core/odata/modeler/SMART_BUSINESS.xsodata"};function g(p,r){var a=r?"_rt":"_dt";var k=p.id;if(p.filters){k+="_FILTERS"}if(p.thresholds){k+="_VALUES"}k+=a;return k};var _=function(u,s){if(sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService){var a=sap.ushell.Container.getService("URLParsing");if(a){u=a.addSystemToServiceUrl(u,s)}}return u};return{getSiblingEvaluations:function(p){if(!p.indicator){throw new Error("Indicator Not Found")}var m=null;if(sap.suite.smartbusiness.odata){m=sap.suite.smartbusiness.odata.getModelByServiceUri(C.KPI_SERVICE_URI)}else{m=new sap.ui.model.odata.ODataModel(C.KPI_SERVICE_URI,true)}var a=!!p.success;var f="INDICATOR eq '#INDICATOR_ID'".replace("#INDICATOR_ID",p.indicator);var s=[];var d={};d["$filter"]=f;var e="";if(p.filters){e+="FILTERS,"}if(p.thresholds){e+="VALUES,"}if(e){d["$expand"]=e.substring(0,e.length-1)}var b=C.EVALUATIONS_ENTITY_SET;if(p.getDDAEvaluation){b=C.EVALUATIONS_DDA_ENTITY_SET}m.read(b,null,d,a,function(c){if(c.results&&c.results.length){var t=c.results||[];s=t}if(a){p.success.call(p.context||null,s)}},function(){jQuery.sap.log.error("Error fetching Evaluation : ",p.id);if(p.error){p.error.apply(p.context||null,arguments)}});return s},getAssociatedEvaluations:function(p){if(!p.id){throw new Error("Evaluation Not Found")}var m=null;if(sap.suite.smartbusiness.odata){m=sap.suite.smartbusiness.odata.getModelByServiceUri(C.DESIGN_TIME_SERVICE_URI)}else{m=new sap.ui.model.odata.ODataModel(C.DESIGN_TIME_SERVICE_URI,true)}var a=!!p.success;var f="SOURCE_EVALS eq '#EVALUATION_ID' or TARGET_EVALS eq '#EVALUATION_ID'".replace("#EVALUATION_ID",p.id);var b=[];var d={};d["$filter"]=f;var e="SOURCE_EVALUATION,TARGET_EVALUATION";if(p.filters){e+="FILTERS,"}if(p.thresholds){e+="VALUES,"}if(e){d["$expand"]=e.substring(0,e.length)}m.read(C.ASSOCIATED_INDICATORS_ENTITY_SET,null,d,a,function(c){c=(c.results&&c.results.length)?c.results:[];c.forEach(function(o){if(o.TARGET_EVALS==p.id){b.push(o.SOURCE_EVALUATION)}else if(o.SOURCE_EVALS==p.id){b.push(o.TARGET_EVALUATION)}});if(a){p.success.call(p.context||null,b)}},function(){jQuery.sap.log.error("Error fetching Evaluation : ",p.id);if(p.error){p.error.apply(p.context||null,arguments)}});return b},getEvaluationById:function(p){if(!p.id){throw new Error("Evaluation Id Not Found")}var u=!!p.useRuntimeService;var c=g(p,u);if(p.cache){var e=sap.suite.smartbusiness.cache.getEvaluationById(c);if(e){if(p.success){p.success.call(p.context||null,e);return null}else{return e}}}var m=null;var a=u?C.KPI_RUNTIME_SERVICE_URI:C.KPI_SERVICE_URI;var a=_(a,p.sapSystem);if(sap.suite.smartbusiness.odata){m=sap.suite.smartbusiness.odata.getModelByServiceUri(a)}else{m=new sap.ui.model.odata.ODataModel(a,true)}var b=!!p.success;var f="ID eq '#EVALUATION_ID'".replace("#EVALUATION_ID",p.id);var d=null;var D={};D["$filter"]=f;var h="";if(p.filters){h+="FILTERS,"}if(p.thresholds){h+="VALUES,"}if(h){D["$expand"]=h.substring(0,h.length-1)}var i=C.EVALUATIONS_ENTITY_SET;if(p.getDDAEvaluation){i=C.EVALUATIONS_DDA_ENTITY_SET}else{}m.read(i,null,D,b,function(j){if(j.results&&j.results.length){d=j.results[0];sap.suite.smartbusiness.cache.setEvaluationById(c,d)}if(b){p.success.call(p.context||null,d)}},function(){jQuery.sap.log.error("Error fetching Evaluation : ",p.id);if(p.error){p.error.apply(p.context||null,arguments)}});return d},parseEvaluation:function(e){return new sap.suite.smartbusiness.kpi.Evaluation(e)}}})();
sap.suite.smartbusiness.kpi.Thresholds=function(t){this.thresholdsData=t;var T={"TA":{prop:'_target',func:"getTarget"},"CL":{prop:'_criticalLow',func:"getCriticalLow"},"CH":{prop:'_criticalHigh',func:"getCriticalHigh"},"WL":{prop:'_warningLow',func:"getWarningLow"},"WH":{prop:'_warningHigh',func:"getWarningHigh"},"TC":{prop:'_trend',func:"getTrend"},"RE":{prop:"_reference",func:"getReference"}};var g=function(o){if(o.FIXED){return'FIXED'}if(o.COLUMN_NAME){return'COLUMN_NAME'}if(o.ODATA_URL){return'ODATA_URL'}return null};this.parse=function(a){a.forEach(function(b){var m=T[b.TYPE];if(m){var c=g(b);this[m.prop+"Type"]=c;this[m.prop+"Value"]=b[c];sap.suite.smartbusiness.kpi.Thresholds.prototype[m.func+"Type"]=function(){return this[m.prop+"Type"]};sap.suite.smartbusiness.kpi.Thresholds.prototype[m.func]=function(){return this[m.prop+"Value"]}}},this);for(var e in T){var o=T[e];if(!sap.suite.smartbusiness.kpi.Thresholds.prototype[o.func]){sap.suite.smartbusiness.kpi.Thresholds.prototype[o.func+"Type"]=function(){return null};sap.suite.smartbusiness.kpi.Thresholds.prototype[o.func]=function(){return null}}}};this.parse(this.thresholdsData.results)};
sap.suite.smartbusiness.kpi.Evaluation=function(e){this.evaluationData=e;this.thresholds=null;if(this.evaluationData&&this.evaluationData.VALUES){this._init();this.thresholds=new sap.suite.smartbusiness.kpi.Thresholds(this.evaluationData.VALUES)}};
sap.suite.smartbusiness.kpi.Evaluation.PropertyMapping={ID:"getId",ODATA_URL:"getODataUrl",ODATA_ENTITYSET:"getEntitySet",GOAL_TYPE:"getGoalType",INDICATOR:"getKpiId",TITLE:"getTitle",DESCRIPTION:"getDescription",SCALING:"getScaling",COLUMN_NAME:"getKpiMeasureName",INDICATOR_TITLE:"getKpiName",SEMANTIC_OBJECT:"getSemanticObject",ACTION:"getAction",OWNER_NAME:"getOwnerName",OWNER_ID:"getOwnerId",VALUES_SOURCE:"getThresholdValueType",FILTERS:"getFilters",VALUES:"getValues",PROPERTIES:"getProperties",TAGS:"getTags",INDICATOR_PROPERTIES:"getKpiDetail"};sap.suite.smartbusiness.kpi.Evaluation.prototype={_init:function(){for(var e in sap.suite.smartbusiness.kpi.Evaluation.PropertyMapping){(function(e){var f=sap.suite.smartbusiness.kpi.Evaluation.PropertyMapping[e];sap.suite.smartbusiness.kpi.Evaluation.prototype[f]=function(){return this.evaluationData[e]}})(e)}},getThresholds:function(){return this.thresholds},isMaximizingKpi:function(){return this.getGoalType()=="MA"},isMinimizingKpi:function(){return this.getGoalType()=="MI"},isTargetKpi:function(){return this.getGoalType()=="RA"}};
