jQuery.sap.require("sap.ca.scfld.md.controller.BaseFullscreenController");jQuery.sap.includeStyleSheet("../../resources/sap/suite/ui/smartbusiness/designtime/evaluation/view/evaluationParameters.css");sap.ca.scfld.md.controller.BaseFullscreenController.extend("sap.suite.ui.smartbusiness.designtime.evaluation.view.S1",{onAfterRendering:function(){var t=this;t.initialModel=t._cloneObj(t.getView().getModel().getData())},navigateBack:function(){var t=this;var a;var b=new sap.m.Dialog({icon:"sap-icon://warning2",title:t.oResourceBundle.getText("WARNING"),state:"Warning",type:"Message",content:[new sap.m.Text({text:t.oResourceBundle.getText("NAVIGATION_DATA_LOSS")})],beginButton:new sap.m.Button({text:t.oResourceBundle.getText("CONTINUE"),press:function(){b.close();if(t.fromHome){window.location.hash=""}else{if(this.editDraft){window.location.hash="FioriApplication-SBWorkspace?sap-system=HANA&/evalDetail/INDICATORS_MODELER(ID='"+t.getView().getModel().getData().INDICATOR+"',IS_ACTIVE=1)/EVALUATIONS_MODELER(ID='"+t.getView().getModel().getData().ID+"',IS_ACTIVE=1)"}else if(t.evalContext){window.location.hash="FioriApplication-SBWorkspace?sap-system=HANA&/evalDetail/INDICATORS_MODELER(ID='"+t.getView().getModel().getData().INDICATOR+"',IS_ACTIVE=1)/EVALUATIONS_MODELER(ID='"+t.getView().getModel().getData().ID+"',IS_ACTIVE="+a+")"}else{window.location.hash="FioriApplication-SBWorkspace?sap-system=HANA&/detail/INDICATORS_MODELER(ID='"+t.getView().getModel().getData().INDICATOR+"',IS_ACTIVE=1)"}}}}),endButton:new sap.m.Button({text:t.oResourceBundle.getText("CANCEL"),press:function(){b.close()}})});var u=false;if(t.getView().getModel().getData().mode==="create"){var c={};c.oldPayload=t.getEvalParamPayload(t.initialModel);c.newPayload=t.getEvalParamPayload(t.getView().getModel().getData());c.objectType="Evaluations";c=sap.suite.smartbusiness.utils.dirtyBitCheck(c);if(c.updates.length>0){u=true}}else{var t=this,i=0;var c={};t.saveFilters(t.getView());t.saveValues(t.getView());t.saveTags(t.getView());t.saveProperties(t.getView());t.saveAdditionalLanguages(t.getView());c.oldPayload=t.getEvalParamPayload(t.evalDetails);c.oldPayload.DATA_SPECIFICATION="";a=c.oldPayload.IS_ACTIVE;c.oldPayload.IS_ACTIVE=0;c.newPayload=t.getEvalParamPayload(t.getView().getModel().getData());c.newPayload.DATA_SPECIFICATION="";c.objectType="Evaluations";c=sap.suite.smartbusiness.utils.dirtyBitCheck(c);if(c.updates.length>0){u=true}c.oldPayload=t.evalDetails.FILTERS.results;for(var k in c.oldPayload){c.oldPayload[k].IS_ACTIVE=0}c.newPayload=t.evalFiltersPayload;c.objectType="EVALUATION_FILTERS";c=sap.suite.smartbusiness.utils.dirtyBitCheck(c);if(c.deletes.length>0){u=true}if(c.updates.length>0){u=true}for(i=0;i<t.evalDetails.VALUES.results.length;i++){if(t.evalDetails.VALUES.results[i].COLUMN_NAME){delete t.evalDetails.VALUES.results[i].FIXED}else{delete t.evalDetails.VALUES.results[i].COLUMN_NAME}}c.oldPayload=t.evalDetails.VALUES.results;for(var k in c.oldPayload){c.oldPayload[k].IS_ACTIVE=0}c.newPayload=t.valuesPayload;c.objectType="EVALUATION_VALUES";c=sap.suite.smartbusiness.utils.dirtyBitCheck(c);if(c.deletes.length>0){u=true}if(c.updates.length>0){u=true}c.oldPayload=t.evalDetails.TAGS.results;for(var k in c.oldPayload){c.oldPayload[k].IS_ACTIVE=0}c.newPayload=t.tagsPayload;c.objectType="TAGS";c=sap.suite.smartbusiness.utils.dirtyBitCheck(c);if(c.deletes.length>0){u=true}if(c.updates.length>0){u=true}c.oldPayload=t.evalDetails.PROPERTIES.results;for(var k in c.oldPayload){c.oldPayload[k].IS_ACTIVE=0}c.newPayload=t.propPayload;c.objectType="PROPERTIES";c=sap.suite.smartbusiness.utils.dirtyBitCheck(c);if(c.deletes.length>0){u=true}if(c.updates.length>0){u=true}c.oldPayload=t.evalDetails.ADDITIONAL_LANGUAGE_ARRAY;for(var k in c.oldPayload){c.oldPayload[k].IS_ACTIVE=0}c.newPayload=t.languagesPayload;c.objectType="EVALUATION_TEXTS";c=sap.suite.smartbusiness.utils.dirtyBitCheck(c);if(c.deletes.length>0){u=true}if(c.updates.length>0){u=true}}if(u){b.open()}else{if(t.fromHome){window.location.hash=""}else{if(this.editDraft){window.location.hash="FioriApplication-SBWorkspace?sap-system=HANA&/evalDetail/INDICATORS_MODELER(ID='"+t.getView().getModel().getData().INDICATOR+"',IS_ACTIVE=1)/EVALUATIONS_MODELER(ID='"+t.getView().getModel().getData().ID+"',IS_ACTIVE=1)"}else if(t.evalContext){window.location.hash="FioriApplication-SBWorkspace?sap-system=HANA&/evalDetail/INDICATORS_MODELER(ID='"+t.getView().getModel().getData().INDICATOR+"',IS_ACTIVE=1)/EVALUATIONS_MODELER(ID='"+t.getView().getModel().getData().ID+"',IS_ACTIVE="+a+")"}else{window.location.hash="FioriApplication-SBWorkspace?sap-system=HANA&/detail/INDICATORS_MODELER(ID='"+t.getView().getModel().getData().INDICATOR+"',IS_ACTIVE=1)"}}}},onInit:function(){var t=this;t.fromHome=false;var o={onBack:function(){t.navigateBack()},bSuppressBookmarkButton:{},oEditBtn:{sI18nBtnTxt:"SAVE",onBtnPressed:function(a){t.saveAndExit()}},buttonList:[{sI18nBtnTxt:"SAVE_CREATE_NEW",onBtnPressed:function(a){t.saveAndCreateNew()}},{sI18nBtnTxt:"SAVE_AND_ACTIVATE",onBtnPressed:function(a){t.saveAndActivate()}},{sI18nBtnTxt:"ACTIVATE_VISUALIZE",onBtnPressed:function(a){t.activateAndAddTiles()}},{sI18nBtnTxt:"CANCEL",onBtnPressed:function(a){t.navigateBack()}}]};this.setHeaderFooterOptions(o);this.busyDialog=new sap.m.BusyDialog();this.oResourceBundle=this.oApplicationFacade.getResourceBundle();var m=new sap.ui.model.json.JSONModel({NO_OF_ADDITIONAL_LANGUAGES:0});this.getView().setModel(m);this.oDataModel=this.oApplicationFacade.getODataModel();this.editDraft=false;this.oModelForInputParameters=new sap.ui.model.json.JSONModel();this.oModelForDimensions=new sap.ui.model.json.JSONModel();var e=this.evalContext||"";t.getView().byId("propertyNameValueBox").bindAggregation("items","/PROPERTIES",function(a,b){return new sap.ui.layout.Grid({content:[new sap.m.Input({value:"{NAME}",layoutData:new sap.ui.layout.GridData({span:"L4 M4 S4"})}),new sap.m.Input({value:"{VALUE}",layoutData:new sap.ui.layout.GridData({span:"L4 M4 S4"})}),new sap.m.Button({icon:"sap-icon://sys-cancel",type:"Transparent",layoutData:new sap.ui.layout.GridData({span:"L2 M2 S2"}),press:function(c){t.removeProperty(c)}})],defaultSpan:"L12 M12 S12"}).addStyleClass("propertyEntryGrid");});this.oDataModel.read("/LANGUAGE?$filter=LAISO eq '"+(sap.ui.getCore().getConfiguration().getLocale().getLanguage()).toUpperCase()+"'",null,null,false,function(d){t.localLanguage=d.results[0].SPRAS});t.getView().getModel().setProperty("/NO_OF_ADDITIONAL_LANGUAGES",0);this.setInputParameterAndFilterLayout();this.decideMode()},decideMode:function(){var t=this;this.oRouter.attachRouteMatched(function(a){this.getView().getModel().setProperty("/SCALING","0");if(a.getParameter("name")==="duplicateEvaluation"){try{if(sap.ushell.services.AppConfiguration&&sap.ushell.services.AppConfiguration.setWindowTitle){sap.ushell.services.AppConfiguration.setWindowTitle(t.oResourceBundle.getText("FULLSCREEN_TITLE_DUPLICATE"))}}catch(e){jQuery.sap.log.error("Error Setting Window Page Title : "+t.oResourceBundle.getText("FULLSCREEN_TITLE_DUPLICATE"))}t.duplicateEval=true;this.evalContext=a.getParameter("arguments").evaluationContext;this.indicatorContext=a.getParameter("arguments").indicatorContext;t.getView().getModel().setProperty("/mode","create");t._oControlStore.oTitle.setText(t.oResourceBundle.getText("FULLSCREEN_DYN_TITLE","Duplicate"));t.byId("evalId").setEditable(true);t.populateEvalDetails();t.fromHome=false}else if(a.getParameter("name")==="editEvaluationDraft"){try{if(sap.ushell.services.AppConfiguration&&sap.ushell.services.AppConfiguration.setWindowTitle){sap.ushell.services.AppConfiguration.setWindowTitle(t.oResourceBundle.getText("FULLSCREEN_TITLE_EDIT"))}}catch(e){jQuery.sap.log.error("Error Setting Window Page Title : "+t.oResourceBundle.getText("FULLSCREEN_TITLE_EDIT"))}t.footerForEditMode();this.evalContext=a.getParameter("arguments").evaluationContext;this.indicatorContext=a.getParameter("arguments").indicatorContext;t.getView().getModel().setProperty("/mode","edit");this.editDraft=true;t.populateEvalDetails();t._oControlStore.oTitle.setText(t.oResourceBundle.getText("FULLSCREEN_DYN_TITLE","Edit"));t.byId("evalId").setEditable(false);t.fromHome=false}else if(a.getParameter("arguments").indicatorContext&&a.getParameter("arguments").evaluationContext){try{if(sap.ushell.services.AppConfiguration&&sap.ushell.services.AppConfiguration.setWindowTitle){sap.ushell.services.AppConfiguration.setWindowTitle(t.oResourceBundle.getText("FULLSCREEN_TITLE_EDIT"))}}catch(e){jQuery.sap.log.error("Error Setting Window Page Title : "+t.oResourceBundle.getText("FULLSCREEN_TITLE_EDIT"))}this.evalContext=a.getParameter("arguments").evaluationContext;this.indicatorContext=a.getParameter("arguments").indicatorContext;t.getView().getModel().setProperty("/mode","edit");t.populateEvalDetails();t._oControlStore.oTitle.setText(t.oResourceBundle.getText("FULLSCREEN_DYN_TITLE","Edit"));t.byId("evalId").setEditable(false);t.fromHome=false}else if(a.getParameter("arguments").indicatorContext){t.getView().getModel().setProperty("/mode","create");t.busyDialog.open();this.indicatorContext=a.getParameter("arguments").indicatorContext;t.getView().getModel().setProperty("/IS_ACTIVE",0);t.getView().getModel().setProperty("/NO_OF_ADDITIONAL_LANGUAGES",0);t.getKpiDetails();t._oControlStore.oTitle.setText(t.oResourceBundle.getText("FULLSCREEN_DYN_TITLE","Add"));t.byId("indicatorId").setEditable(false);t.fromHome=false}else{t.byId("selectKpi").setText(t.oResourceBundle.getText("SELECT_KPI_OPI"));t.getView().getModel().setProperty("/mode","create");t.getView().getModel().setProperty("/IS_ACTIVE",0);t.getView().getModel().setProperty("/NO_OF_ADDITIONAL_LANGUAGES",0);t._oControlStore.oTitle.setText(t.oResourceBundle.getText("FULLSCREEN_DYN_TITLE","Add"));t.fromHome=true}},this)},footerForEditMode:function(){var t=this;var o={bSuppressBookmarkButton:{},onBack:function(){t.navigateBack()},oEditBtn:{sI18nBtnTxt:"SAVE",onBtnPressed:function(e){t.saveAndExit()}},buttonList:[{sI18nBtnTxt:"SAVE_AND_ACTIVATE",onBtnPressed:function(e){t.saveAndActivate()}},{sI18nBtnTxt:"DELETE",onBtnPressed:function(e){t.deleteDraft()}},{sI18nBtnTxt:"CANCEL",onBtnPressed:function(e){t.navigateBack()}}]};this.setHeaderFooterOptions(o)},populateEvalDetails:function(){var t=this;t.busyDialog.open();t.oDataModel.read(t.indicatorContext,null,null,true,function(a){t.getView().getModel().setProperty("/INDICATOR",a.ID);t.byId("indicatorId").setEditable(false);t.getView().getModel().setProperty("/GOAL_TYPE",a.GOAL_TYPE);if(a.DATA_SPECIFICATION!=""){t.getView().getModel().setProperty("/DATA_SPECIFICATION",a.DATA_SPECIFICATION);t.byId("additionalInfo").setVisible(true)}else{t.byId("additionalInfo").setVisible(false)}t.getView().getModel().setProperty("/INDICATOR_TYPE",a.TYPE);t.oDataModel.read(t.evalContext,null,"$expand=FILTERS,VALUES,PROPERTIES,TAGS",true,function(d){t.evalDetails={};t.evalDetails=t._cloneObj(d);t.getView().getModel().setProperty("/ID",d.ID);t.getView().getModel().setProperty("/TITLE",d.TITLE);t.getView().getModel().setProperty("/DESCRIPTION",d.DESCRIPTION);t.oDataModel.read("/EVALUATION_TEXTS?$filter=ID eq '"+d.ID+"' and IS_ACTIVE eq "+d.IS_ACTIVE,null,null,false,function(l){l=l.results;var m=[];for(i=0;i<l.length;i++){var n={};n.TITLE=l[i].TITLE;n.DESCRIPTION=l[i].DESCRIPTION;t.oDataModel.read("/LANGUAGE?$filter=SPRAS eq '"+l[i].LANGUAGE+"'",null,null,false,function(d){n.LANGUAGE_KEY=d.results[0].LAISO;n.LANGUAGE=d.results[0].SPRAS;n.IS_ACTIVE=t.getView().getModel().getData().IS_ACTIVE;n.ID=t.getView().getModel().getData().ID});if(n.LANGUAGE!=t.localLanguage){m.push(n)}}t.getView().getModel().setProperty("/ADDITIONAL_LANGUAGE_ARRAY",m);t.getView().getModel().setProperty("/NO_OF_ADDITIONAL_LANGUAGES",m.length);t.evalDetails.ADDITIONAL_LANGUAGE_ARRAY=m;t.evalDetails.NO_OF_ADDITIONAL_LANGUAGES=m.length});t.getView().getModel().setProperty("/IS_ACTIVE",0);t.getView().getModel().setProperty("/SEMANTIC_OBJECT",d.SEMANTIC_OBJECT);t.getView().getModel().setProperty("/ACTION",d.ACTION);if(d.GOAL_TYPE)t.getView().getModel().setProperty("/GOAL_TYPE",d.GOAL_TYPE);t.getView().getModel().setProperty("/INDICATOR_TYPE",d.INDICATOR_TYPE);t.getView().getModel().setProperty("/OWNER_NAME",d.OWNER_NAME);t.getView().getModel().setProperty("/OWNER_ID",d.OWNER_ID);t.getView().getModel().setProperty("/OWNER_E_MAIL",d.OWNER_E_MAIL);t.getView().getModel().setProperty("/VIEW_NAME",d.VIEW_NAME);t.getView().getModel().setProperty("/ODATA_URL",d.ODATA_URL);t.createTargetThresholdLayout();if(d.ODATA_ENTITYSET){t.getView().getModel().setProperty("/ODATA_ENTITYSET",d.ODATA_ENTITYSET);try{t.oModelForMeasure=t.populateMeasure(t.getView().getModel().getProperty("/ODATA_URL"),t.getView().getModel().getProperty("/ODATA_ENTITYSET"));t.populateDimensionsAndInputParameters(t.getView().getModel().getProperty("/ODATA_URL"),t.getView().getModel().getProperty("/ODATA_ENTITYSET"))}catch(e){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_WRONG_ENTITY_SET"),t.oResourceBundle.getText("ERROR_ODATA_ANALYTICS"));t.resetDimensionsAndInputParameters()}}t.getView().getModel().setProperty("/COLUMN_NAME",d.COLUMN_NAME);t.getView().getModel().setProperty("/SCALING",d.SCALING);t.getView().getModel().updateBindings();if(d.TAGS.results.length>0){var b="";for(var i=0;i<d.TAGS.results.length;i++){b+=d.TAGS.results[i].TAG+","}b=b.substring(0,b.length-1);t.getView().getModel().setProperty("/TAG",b)}if(d.FILTERS.results.length>0){var c=[],f=[],j=0,k=0;for(var i=0;i<d.FILTERS.results.length;i++){if(d.FILTERS.results[i].TYPE==="PA"){c[j]={};c[j++]=d.FILTERS.results[i]}else if(d.FILTERS.results[i].TYPE==="FI"){f[k]={};f[k++]=d.FILTERS.results[i]}}if(c.length>0){var g={};g.inputParameters=[];g.inputParameters=t.formObjectForFilters(c);if(t.oModelForInputParameters.getData().inputParameters&&t.oModelForInputParameters.getData().inputParameters.length){for(var i=0;i<t.oModelForInputParameters.getData().inputParameters.length;i++){for(var j=0;j<g.inputParameters.length;j++){if(t.oModelForInputParameters.getData().inputParameters[i].name===g.inputParameters[j].name){t.oModelForInputParameters.getData().inputParameters[i].value_1=g.inputParameters[j].value_1;t.oModelForInputParameters.getData().inputParameters[i].value_2=g.inputParameters[j].value_2}}}t.oModelForInputParameters.updateBindings()}}if(f.length>0){var h={};h.selectedDimensions=[];h.selectedDimensions=t.formObjectForFilters(f);t.oModelForDimensions.getData().selectedDimensions=h.selectedDimensions;t.oModelForDimensions.updateBindings()}}if(d.PROPERTIES.results.length>0){t.getView().getModel().setProperty("/PROPERTIES",d.PROPERTIES.results);t.getView().getModel().updateBindings()}t.getView().getModel().setProperty("/VALUES_SOURCE",d.VALUES_SOURCE);if(d.VALUES.results.length>0){for(i=0;i<d.VALUES.results.length;i++){if(d.VALUES.results[i].FIXED){t.populateTargetAndTresholds(d.VALUES.results[i].TYPE,d.VALUES.results[i].FIXED)}else{t.populateTargetAndTresholds(d.VALUES.results[i].TYPE,d.VALUES.results[i].COLUMN_NAME)}}}t.busyDialog.close()},function(e){t.busyDialog.close();sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_EVALUATION_DOES_NOT_EXIST"))})},function(e){t.busyDialog.close();sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_KPI_DOES_NOT_EXIST"))})},populateAdditionalMeasures:function(t,v){var a=this;var m=a.getView().byId('targetThresholdPanel').getContent()[0].byId("additionalMeasures");m.addToken(new sap.m.Token({text:v}));a.getView().byId('targetThresholdPanel').getContent()[0].byId("selectAdditionalMeasuresCheckBox").setSelected(true);a.getView().byId('targetThresholdPanel').getContent()[0].byId('additionalMeasures').setVisible(true)},populateTargetAndTresholds:function(t,v){var a=this;switch(t){case"CL":a.getView().getModel().setProperty("/CRITICALLOW",v);break;case"WL":a.getView().getModel().setProperty("/WARNINGLOW",v);break;case"TA":a.getView().getModel().setProperty("/TARGET",v);break;case"CH":a.getView().getModel().setProperty("/CRITICALHIGH",v);break;case"WH":a.getView().getModel().setProperty("/WARNINGHIGH",v);break;case"TC":a.getView().getModel().setProperty("/TREND",v);break;case"RE":a.getView().getModel().setProperty("/REFERENCE_VALUE",v);break;default:a.populateAdditionalMeasures(t,v)}},formObjectForFilters:function(l){var i=0,j=0,k=0,t=[],a;for(i=0;i<l.length;i++){if(l[i].OPERATOR=="BT"){a={};a={"name":l[i].NAME,"operator":l[i].OPERATOR,"value_1":l[i].VALUE_1,"value_2":l[i].VALUE_2};t[j++]=a}else{for(k=0;k<t.length;k++){if((t[k].name==l[i].NAME)&&(t[k].operator==l[i].OPERATOR)){break}}if(k==t.length){a={};a={"name":l[i].NAME,"operator":l[i].OPERATOR,"value_1":l[i].VALUE_1,"value_2":l[i].VALUE_2};t[j++]=a}else{t[k].value_1+=","+l[i].VALUE_1}}}return t},getKpiDetails:function(){var t=this;if(!t.indicatorContext){t.busyDialog.close();t.indicatorContext="INDICATORS_MODELER(ID='"+t.getView().getModel().getData().INDICATOR+"',IS_ACTIVE=1)"}t.oDataModel.read(t.indicatorContext,null,"$expand=TAGS,PROPERTIES",true,function(d){t.getView().getModel().setProperty("/INDICATOR",d.ID);if(d.IS_ACTIVE==0){sap.m.MessageToast.show(t.oResourceBundle.getText("ERROR_INACTIVE_KPI_CANNOT_HAVE_EVALUATION"));window.location.hash="FioriApplication-SBWorkspace?sap-system=HANA&/detail/INDICATORS_MODELER(ID='"+t.getView().getModel().getData().INDICATOR+"',IS_ACTIVE=0)";return}t.getView().byId("indicatorId").setValueState("None");t.getView().getModel().setProperty("/DESCRIPTION",d.DESCRIPTION);if(d.TAGS.results.length>0){var a="";for(var i=0;i<d.TAGS.results.length;i++){a+=d.TAGS.results[i].TAG+","}a=a.substring(0,a.length-1);t.getView().getModel().setProperty("/TAG",a)}t.getView().getModel().setProperty("/OWNER_NAME",d.OWNER_NAME);t.getView().getModel().setProperty("/OWNER_ID",d.OWNER_ID);t.getView().getModel().setProperty("/OWNER_E_MAIL",d.OWNER_E_MAIL);if(d.PROPERTIES.results.length>0){t.getView().getModel().setProperty("/PROPERTIES",d.PROPERTIES.results);t.getView().getModel().updateBindings()}if(d.DATA_SPECIFICATION!=""){t.getView().getModel().setProperty("/DATA_SPECIFICATION",d.DATA_SPECIFICATION);t.byId("additionalInfo").setVisible(true)}else{t.byId("additionalInfo").setVisible(false)}t.getView().getModel().setProperty("/DATA_SPECIFICATION",d.DATA_SPECIFICATION);t.getView().getModel().setProperty("/SEMANTIC_OBJECT",d.SEMANTIC_OBJECT);t.getView().getModel().setProperty("/ACTION",d.ACTION);t.getView().getModel().setProperty("/INDICATOR_TYPE",d.TYPE);t.getView().getModel().setProperty("/VIEW_NAME",d.VIEW_NAME);t.getView().getModel().setProperty("/ODATA_URL",d.ODATA_URL);t.createTargetThresholdLayout();if(d.ODATA_ENTITYSET){t.getView().getModel().setProperty("/ODATA_ENTITYSET",d.ODATA_ENTITYSET);t.resetDimensionsAndInputParameters();try{t.populateDimensionsAndInputParameters(t.getView().getModel().getProperty("/ODATA_URL"),t.getView().getModel().getProperty("/ODATA_ENTITYSET"));t.oModelForMeasure=t.populateMeasure(t.getView().getModel().getProperty("/ODATA_URL"),t.getView().getModel().getProperty("/ODATA_ENTITYSET"))}catch(e){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_WRONG_ENTITY_SET"),t.oResourceBundle.getText("ERROR_ODATA_ANALYTICS"));t.resetDimensionsAndInputParameters()}}t.getView().getModel().setProperty("/COLUMN_NAME",d.COLUMN_NAME);t.getView().getModel().setProperty("/GOAL_TYPE",d.GOAL_TYPE);t.busyDialog.close()},function(e){t.busyDialog.close();t.getView().byId("indicatorId").setValueState("Error");sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_KPI_DOES_NOT_EXIST"))})},getEvalParamPayload:function(f){var e={};e.ID=f.ID;e.DESCRIPTION=f.DESCRIPTION;e.INDICATOR=f.INDICATOR;e.ODATA_URL=f.ODATA_URL;e.VIEW_NAME=f.VIEW_NAME;e.COLUMN_NAME=f.COLUMN_NAME;e.OWNER_NAME=f.OWNER_NAME;e.OWNER_E_MAIL=f.OWNER_E_MAIL;e.OWNER_ID=f.OWNER_ID;e.CREATED_BY="";e.CHANGED_BY="";e.IS_ACTIVE=f.IS_ACTIVE;e.SCALING=parseInt(f.SCALING)||0;e.TITLE=f.TITLE;e.ENTITY_TYPE="";e.ODATA_ENTITYSET=f.ODATA_ENTITYSET;e.ODATA_PROPERTY="";e.SEMANTIC_OBJECT=f.SEMANTIC_OBJECT;e.ACTION=f.ACTION;e.DATA_SPECIFICATION=f.DATA_SPECIFICATION;e.GOAL_TYPE=f.GOAL_TYPE;e.INDICATOR_TYPE=f.INDICATOR_TYPE;e.VALUES_SOURCE=f.VALUES_SOURCE;return e},setFilterPayload:function(i,t,n,o,v,a){var b={};b.ID=i;b.IS_ACTIVE=this.getView().getModel().getData().IS_ACTIVE;b.TYPE=t;b.NAME=n;b.OPERATOR=o;b.VALUE_1=v;if(a)b.VALUE_2=a;else b.VALUE_2="";return b},getInputParamPayload:function(f){var e={},j=0;var a=f.getModel().getData();if(f.getController().oModelForInputParameters){e=f.getController().oModelForInputParameters.getData();if(e.inputParameters){if(e.inputParameters.length>0){var i=0,b=[],c;while(i<e.inputParameters.length){if(e.inputParameters[i].operator==="BT"){if((e[i].value_1!=="")||(e[i].value_2!=="")){b=e.inputParameters[i].value_1.split(",");c=e.inputParameters[i].value_2.split(",");if((c.length===1)&&(!b.length===1)){e.inputParameters[i].value_1=(e.inputParameters[i].propertyType=="Edm.DateTime")?new Date(e.inputParameters[i].value_1).toJSON():e.inputParameters[i].value_1;e.inputParameters[i].value_2=(e.inputParameters[i].propertyType=="Edm.DateTime")?new Date(e.inputParameters[i].value_2).toJSON():e.inputParameters[i].value_2;this.evalFiltersPayload[j]={};this.evalFiltersPayload[j]=this.setFilterPayload(a.ID,"PA",e.inputParameters[i].name,e.inputParameters[i].operator,e.inputParameters[i].value_1,e.inputParameters[i].value_2);j++}}}else{b=e.inputParameters[i].value_1.split(",");if(b.length>0){for(var k=0;k<b.length;k++){if(b[k]!==""){b[k]=(e.inputParameters[i].propertyType=="Edm.DateTime")?new Date(b[k]).toJSON():b[k];this.evalFiltersPayload[j]={};this.evalFiltersPayload[j]=this.setFilterPayload(a.ID,"PA",e.inputParameters[i].name,e.inputParameters[i].operator,b[k]);j++}}}}i++}}}}},getFiltersPayload:function(f){var a=f.getModel().getData();var e={},j=this.evalFiltersPayload.length;if(f.getController().oModelForDimensions){e=f.getController().oModelForDimensions.getData();if(e.selectedDimensions){if(e.selectedDimensions.length>0){var i=0,b=[],c;while(i<e.selectedDimensions.length){if(e.selectedDimensions[i].operator==="BT"){if((e.selectedDimensions[i].value_1!=="")&&(e.selectedDimensions[i].value_2!=="")){b=e.selectedDimensions[i].value_1.split(",");c=e.selectedDimensions[i].value_2.split(",");if((c.length===1)||(!b.length===1)){e.selectedDimensions[i].value_1=(e.selectedDimensions[i].propertyType=="Edm.DateTime")?new Date(e.selectedDimensions[i].value_1).toJSON():e.selectedDimensions[i].value_1;e.selectedDimensions[i].value_2=(e.selectedDimensions[i].propertyType=="Edm.DateTime")?new Date(e.selectedDimensions[i].value_2).toJSON():e.selectedDimensions[i].value_2;this.evalFiltersPayload[j]={};this.evalFiltersPayload[j]=this.setFilterPayload(a.ID,"FI",e.selectedDimensions[i].name,e.selectedDimensions[i].operator,e.selectedDimensions[i].value_1,e.selectedDimensions[i].value_2);j++}}}else{b=e.selectedDimensions[i].value_1.split(",");if(b.length>0){for(var k=0;k<b.length;k++){if(b[k]!=""){b[k]=(e.selectedDimensions[i].propertyType=="Edm.DateTime")?new Date(b[k]).toJSON():b[k];this.evalFiltersPayload[j]={};this.evalFiltersPayload[j]=this.setFilterPayload(a.ID,"FI",e.selectedDimensions[i].name,e.selectedDimensions[i].operator,b[k]);j++}}}}i++}}}}},getThresholdValue:function(i,t,s,v){var o={};o.ID=i;o.TYPE=t;o.IS_ACTIVE=s;var f=this.getView();var a=f.getModel().getData();var b=a.VALUES_SOURCE;if(b==="MEASURE"){o.COLUMN_NAME=v}if(b==="FIXED"){o.FIXED=v}o.ODATA_PROPERTY="";return o},getRangePayload:function(f){var a=f.getModel().getData();var i=0;if(a.CRITICALHIGH&&a.CRITICALHIGH!==""){this.valuesPayload[i]=this.getThresholdValue(a.ID,"CH",a.IS_ACTIVE,a.CRITICALHIGH);i++}if(a.WARNINGHIGH&&a.WARNINGHIGH!==""){this.valuesPayload[i]=this.getThresholdValue(a.ID,"WH",a.IS_ACTIVE,a.WARNINGHIGH);i++}if(a.TARGET&&a.TARGET!==""){this.valuesPayload[i]=this.getThresholdValue(a.ID,"TA",a.IS_ACTIVE,a.TARGET);i++}if(a.CRITICALLOW&&a.CRITICALLOW!==""){this.valuesPayload[i]=this.getThresholdValue(a.ID,"CL",a.IS_ACTIVE,a.CRITICALLOW);i++}if(a.WARNINGLOW&&a.WARNINGLOW!==""){this.valuesPayload[i]=this.getThresholdValue(a.ID,"WL",a.IS_ACTIVE,a.WARNINGLOW);i++}},getMaximizingPayload:function(f){var a=f.getModel().getData();var i=this.valuesPayload.length;if(a.TARGET&&a.TARGET!==""){this.valuesPayload[i]=this.getThresholdValue(a.ID,"TA",a.IS_ACTIVE,a.TARGET);i++}if(a.CRITICALLOW&&a.CRITICALLOW!==""){this.valuesPayload[i]=this.getThresholdValue(a.ID,"CL",a.IS_ACTIVE,a.CRITICALLOW);i++}if(a.WARNINGLOW&&a.WARNINGLOW!==""){this.valuesPayload[i]=this.getThresholdValue(a.ID,"WL",a.IS_ACTIVE,a.WARNINGLOW);i++}},getMinimizingPayload:function(f){var a=f.getModel().getData();var i=this.valuesPayload.length;if(a.CRITICALHIGH&&a.CRITICALHIGH!==""){this.valuesPayload[i]=this.getThresholdValue(a.ID,"CH",a.IS_ACTIVE,a.CRITICALHIGH);i++}if(a.WARNINGHIGH&&a.WARNINGHIGH!==""){this.valuesPayload[i]=this.getThresholdValue(a.ID,"WH",a.IS_ACTIVE,a.WARNINGHIGH);i++}if(a.TARGET&&a.TARGET!==""){this.valuesPayload[i]=this.getThresholdValue(a.ID,"TA",a.IS_ACTIVE,a.TARGET);i++}},saveFilters:function(f){this.evalFiltersPayload=[];this.getInputParamPayload(f);this.getFiltersPayload(f)},saveValues:function(f){var t=this;this.valuesPayload=[];var a=f.getModel().getData();switch(a.GOAL_TYPE){case"RA":t.getRangePayload(f);break;case"MA":t.getMaximizingPayload(f);break;case"MI":t.getMinimizingPayload(f);break}if(a.TREND&&a.TREND!==""){var i=this.valuesPayload.length;this.valuesPayload[i]=this.getThresholdValue(a.ID,"TC",a.IS_ACTIVE,a.TREND);i++}if(a.REFERENCE_VALUE&&a.REFERENCE_VALUE!==""){var i=this.valuesPayload.length;this.valuesPayload[i]=this.getThresholdValue(a.ID,"RE",a.IS_ACTIVE,a.REFERENCE_VALUE);i++}if(t.getView().byId('targetThresholdPanel').getContent()[0].byId("additionalMeasures").getTokens().length){var b=t.getView().byId('targetThresholdPanel').getContent()[0].byId("additionalMeasures").getTokens();for(var i=0,j=this.valuesPayload.length;i<b.length;i++){var c="0";if(i.toString().length===1){c="0"+i}else{c=i.toString()}this.valuesPayload[j++]={ID:a.ID,IS_ACTIVE:a.IS_ACTIVE,TYPE:c,COLUMN_NAME:b[i].getText(),ODATA_PROPERTY:""}}}},saveTags:function(f){var a=f.getModel().getData();this.tagsPayload=[];if(a.TAG){var t=[];t=a.TAG.split(",");for(var i=0;i<t.length;i++){this.tagsPayload[i]={};this.tagsPayload[i].ID=a.ID;this.tagsPayload[i].IS_ACTIVE=a.IS_ACTIVE;this.tagsPayload[i].TYPE="EV";this.tagsPayload[i].TAG=t[i]}}},saveProperties:function(f){var a=f.getModel().getData();this.propPayload=[];if(a.PROPERTIES){for(var i=0;i<a.PROPERTIES.length;i++){this.propPayload[i]={};this.propPayload[i].ID=a.ID;this.propPayload[i].IS_ACTIVE=a.IS_ACTIVE;this.propPayload[i].TYPE="EV";this.propPayload[i].NAME=a.PROPERTIES[i].NAME;this.propPayload[i].VALUE=a.PROPERTIES[i].VALUE}}},saveAdditionalLanguages:function(f){var t=this;var a=f.getModel().getData();this.languagesPayload=[];if(a.NO_OF_ADDITIONAL_LANGUAGES>0){var i=0,j=0,k=0,b;t.oDataModel.read("/LANGUAGE",null,null,false,function(d){while(i<a.ADDITIONAL_LANGUAGE_ARRAY.length){b=a.ADDITIONAL_LANGUAGE_ARRAY[i].LANGUAGE_KEY;for(j=0;j<d.results.length;j++){if(d.results[j].LAISO===b){a.ADDITIONAL_LANGUAGE_ARRAY[i].LANGUAGE=d.results[j].SPRAS;a.ADDITIONAL_LANGUAGE_ARRAY[i].LANGUAGE_KEY=d.results[j].LAISO;break}}i++}});for(i=0;i<a.ADDITIONAL_LANGUAGE_ARRAY.length;i++){this.languagesPayload[i]={};this.languagesPayload[i].ID=a.ID;this.languagesPayload[i].IS_ACTIVE=a.IS_ACTIVE;this.languagesPayload[i].LANGUAGE=a.ADDITIONAL_LANGUAGE_ARRAY[i].LANGUAGE;this.languagesPayload[i].LANGUAGE_KEY=a.ADDITIONAL_LANGUAGE_ARRAY[i].LANGUAGE_KEY;this.languagesPayload[i].TITLE=a.ADDITIONAL_LANGUAGE_ARRAY[i].TITLE;this.languagesPayload[i].DESCRIPTION=a.ADDITIONAL_LANGUAGE_ARRAY[i].DESCRIPTION}}},createBatchForEvalCreateMode:function(e){var t=this;t.evalPayload={};t.evalPayload.ID=t.evalParamPayload.ID;t.evalPayload.IS_ACTIVE=t.evalParamPayload.IS_ACTIVE;t.evalPayload.EVALUATION=t.evalParamPayload;delete t.evalPayload.EVALUATION.ID;delete t.evalPayload.EVALUATION.IS_ACTIVE;t.evalPayload.FILTERS=[];t.evalPayload.FILTERS=t.evalFiltersPayload;for(var i=0;i<t.evalPayload.FILTERS.length;i++){delete t.evalPayload.FILTERS[i].ID;delete t.evalPayload.FILTERS[i].IS_ACTIVE}t.evalPayload.VALUES=[];t.evalPayload.VALUES=t.valuesPayload;for(var i=0;i<t.evalPayload.VALUES.length;i++){delete t.evalPayload.VALUES[i].ID;delete t.evalPayload.VALUES[i].IS_ACTIVE}t.evalPayload.TAGS=[];t.evalPayload.TAGS=t.tagsPayload;for(var i=0;i<t.evalPayload.TAGS.length;i++){delete t.evalPayload.TAGS[i].ID;delete t.evalPayload.TAGS[i].IS_ACTIVE}t.evalPayload.PROPERTIES=[];t.evalPayload.PROPERTIES=t.propPayload;for(var i=0;i<t.evalPayload.PROPERTIES.length;i++){delete t.evalPayload.PROPERTIES[i].ID;delete t.evalPayload.PROPERTIES[i].IS_ACTIVE}t.evalPayload.TEXTS=[];t.evalPayload.TEXTS=t.languagesPayload;for(var i=0;i<t.evalPayload.TEXTS.length;i++){delete t.evalPayload.TEXTS[i].ID;delete t.evalPayload.TEXTS[i].IS_ACTIVE;delete t.evalPayload.TEXTS[i].LANGUAGE_KEY}var u=sap.suite.smartbusiness.utils.serviceUrl("EVALUATION_SERVICE_URI");sap.suite.smartbusiness.utils.create(u,t.evalPayload,null,function(d){t.saveSuccessHandling(e)},function(a){t.saveErrorHandling(a)})},createBatchPayload:function(e){var t=this,i=0;var p,u=false;var a={};var b={};var f=t.getView().getModel().getData();a.ID=f.ID;a.IS_ACTIVE=f.IS_ACTIVE;b.oldPayload=t.getEvalParamPayload(t.evalDetails);b.newPayload=t.evalParamPayload;b.objectType="Evaluations";b=sap.suite.smartbusiness.utils.dirtyBitCheck(b);if(b.updates.length>0){a.EVALUATION={};a.EVALUATION.update={};a.EVALUATION.update=t.evalParamPayload;delete a.EVALUATION.update.ID;delete a.EVALUATION.update.IS_ACTIVE;u=true}b.oldPayload=t.evalDetails.FILTERS.results;b.newPayload=t.evalFiltersPayload;b.objectType="EVALUATION_FILTERS";b=sap.suite.smartbusiness.utils.dirtyBitCheck(b);a.FILTERS={};if(b.deletes.length>0){for(i=0;i<b.deletes.length;i++){delete b.deletes[i].ID;delete b.deletes[i].IS_ACTIVE}a.FILTERS.remove=b.deletes;u=true}if(b.updates.length>0){for(var i=0;i<b.updates.length;i++){delete b.updates[i].ID;delete b.updates[i].IS_ACTIVE}a.FILTERS.create=b.updates;u=true}for(i=0;i<t.evalDetails.VALUES.results.length;i++){if(t.evalDetails.VALUES.results[i].COLUMN_NAME){delete t.evalDetails.VALUES.results[i].FIXED}else{delete t.evalDetails.VALUES.results[i].COLUMN_NAME}}b.oldPayload=t.evalDetails.VALUES.results;b.newPayload=t.valuesPayload;b.objectType="EVALUATION_VALUES";b=sap.suite.smartbusiness.utils.dirtyBitCheck(b);a.VALUES={};if(b.deletes.length>0){for(var i=0;i<b.deletes;i++){delete b.deletes[i].ID;delete b.deletes[i].IS_ACTIVE}a.VALUES.remove=b.deletes;u=true}if(b.updates.length>0){for(var i=0;i<b.updates.length;i++){delete b.updates[i].ID;delete b.updates[i].IS_ACTIVE}a.VALUES.create=b.updates;u=true}b.oldPayload=t.evalDetails.TAGS.results;b.newPayload=t.tagsPayload;b.objectType="TAGS";b=sap.suite.smartbusiness.utils.dirtyBitCheck(b);a.TAGS={};if(b.deletes.length>0){for(i=0;i<b.deletes.length;i++){delete b.deletes[i].ID;delete b.deletes[i].IS_ACTIVE}a.TAGS.remove=b.deletes;u=true}if(b.updates.length>0){for(var i=0;i<b.updates.length;i++){delete b.updates[i].ID;delete b.updates[i].IS_ACTIVE}a.TAGS.create=b.updates;u=true}b.oldPayload=t.evalDetails.PROPERTIES.results;b.newPayload=t.propPayload;b.objectType="PROPERTIES";b=sap.suite.smartbusiness.utils.dirtyBitCheck(b);a.PROPERTIES={};if(b.deletes.length>0){for(i=0;i<b.deletes.length;i++){delete b.deletes[i].ID;delete b.deletes[i].IS_ACTIVE}a.PROPERTIES.remove=b.deletes;u=true}if(b.updates.length>0){for(var i=0;i<b.updates.length;i++){delete b.updates[i].ID;delete b.updates[i].IS_ACTIVE}a.PROPERTIES.create=b.updates;u=true}b.oldPayload=t.evalDetails.ADDITIONAL_LANGUAGE_ARRAY;b.newPayload=t.languagesPayload;b.objectType="EVALUATION_TEXTS";b=sap.suite.smartbusiness.utils.dirtyBitCheck(b);a.TEXTS={};if(b.deletes.length>0){for(i=0;i<b.deletes.length;i++){delete b.deletes[i].ID;delete b.deletes[i].IS_ACTIVE}a.TEXTS.remove=b.deletes;u=true}if(b.updates.length>0){for(var i=0;i<b.updates.length;i++){delete b.updates[i].ID;delete b.updates[i].IS_ACTIVE}a.TEXTS.create=b.updates;u=true}if(!u){t.busyDialog.close();t.saveSuccessHandling(e);return}else{var c=sap.suite.smartbusiness.utils.serviceUrl("EVALUATION_SERVICE_URI");sap.suite.smartbusiness.utils.update(c,a,null,function(d){t.saveSuccessHandling(e)},function(d){t.saveErrorHandling(d)})}},saveErrorHandling:function(e){var t=this;sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_EVAL_SAVE"));t.busyDialog.close()},saveSuccessHandling:function(e){var t=this;sap.m.MessageToast.show(t.oResourceBundle.getText("SUCCESS_EVAL_SAVE"));if(e==="activate"||e==="saveActivate"){var o={};o.ID=t.getView().getModel().getData().ID;var u=sap.suite.smartbusiness.utils.serviceUrl("ACTIVATE_EVALUATION_SERVICE_URI");sap.suite.smartbusiness.utils.create(u,o,null,function(d){t.busyDialog.close();sap.m.MessageToast.show(t.oResourceBundle.getText("SUCCESS_EVAL_ACTIVATE"));if(e==="activate")window.location.hash="FioriApplication-configureSBKPITile?sap-system=HANA&/detail/EVALUATIONS_CHIP(ID='"+t.getView().getModel().getData().ID+"',IS_ACTIVE=1)";else if(e==="saveActivate"&&!t.fromHome)window.location.hash="FioriApplication-SBWorkspace?sap-system=HANA&/evalDetail/INDICATORS_MODELER(ID='"+t.getView().getModel().getData().INDICATOR+"',IS_ACTIVE=1)/EVALUATIONS_MODELER(ID='"+t.getView().getModel().getData().ID+"',IS_ACTIVE=1)";else if(t.fromHome){window.location.hash=""}},function(a){t.busyDialog.close();sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ACTIVATING_EVALUATION"))})}else if(e=="create"){t.busyDialog.close();if(t.fromHome){window.location.hash=""}else{if(this.editDraft){window.location.hash="FioriApplication-SBWorkspace?sap-system=HANA&/evalDetail/INDICATORS_MODELER(ID='"+t.getView().getModel().getData().INDICATOR+"',IS_ACTIVE=1)/EVALUATIONS_MODELER(ID='"+t.getView().getModel().getData().ID+"',IS_ACTIVE=1)"}else if(t.duplicateEval){window.location.hash="FioriApplication-SBWorkspace?sap-system=HANA&/evalDetail/INDICATORS_MODELER(ID='"+t.getView().getModel().getData().INDICATOR+"',IS_ACTIVE=1)/EVALUATIONS_MODELER(ID='"+t.getView().getModel().getData().ID+"',IS_ACTIVE=0)"}else if(t.evalDetails){var i=t.evalDetails.IS_ACTIVE;window.location.hash="FioriApplication-SBWorkspace?sap-system=HANA&/evalDetail/INDICATORS_MODELER(ID='"+t.getView().getModel().getData().INDICATOR+"',IS_ACTIVE=1)/EVALUATIONS_MODELER(ID='"+t.getView().getModel().getData().ID+"',IS_ACTIVE="+i+")"}else{window.location.hash="FioriApplication-SBWorkspace?sap-system=HANA&/evalDetail/INDICATORS_MODELER(ID='"+t.getView().getModel().getData().INDICATOR+"',IS_ACTIVE=1)/EVALUATIONS_MODELER(ID='"+t.getView().getModel().getData().ID+"',IS_ACTIVE=0)"}}}else if(e=="createNew"){t.busyDialog.close();t.byId("evalId").setEditable(true);t.getView().getModel().setData({});t.getView().getModel().setProperty("/NO_OF_ADDITIONAL_LANGUAGES",0);t.getKpiDetails();window.location.hash="FioriApplication-createSBKPIEvaluation&/addEvaluation/"+t.indicatorContext}t.busyDialog.close()},saveAndExit:function(e){var t=this;t.createBatch=[];t.deleteBatch=[];var f=t.getView().getModel().getData();if(!f.INDICATOR){t.byId("indicatorId").setValueState("Error");sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_SELECT_KPI"));return}if(t.byId("indicatorId").getValueState()==="Error"){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_KPI_DOES_NOT_EXIST"));return}if(t.byId("evalOwnerEmail").getValueState()==="Error"){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_VALID_EVAL_E_MAIL"));return}if(f.mode==="edit"){if(!f.ID){t.byId("evalId").setValueState("Error");sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_EVALUATION_ID"));return}if(t.byId("evalId").getValueState()==="Error"){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_VALID_EVAL_ID"));return}}else{if(!t.validateEvalId()){if(!f.ID){t.byId("evalId").setValueState("Error");sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_EVALUATION_ID"));return}if(t.byId("evalId").getValueState()==="Error"){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_VALID_EVAL_ID"));return}}else{return}}if(f.VALUES_SOURCE==="FIXED"){var v=this.validateEvaluationValues(this.getView().getModel().getData());if(v.length){var m=this.oResourceBundle.getText("ERROR_ENTER_VALID_THRESHOLD_VALUES");var i;for(i=0;i<v.length;i++){if(v[i]==="CL"){if(this.getView().getModel().getData().GOAL_TYPE==="RA"){m=m+"\n"+this.oResourceBundle.getText("CRITICAL_LOW")}else{m=m+"\n"+this.oResourceBundle.getText("CRITICAL")}}if(v[i]==="WL"){if(this.getView().getModel().getData().GOAL_TYPE==="RA"){m=m+"\n"+this.oResourceBundle.getText("WARNING_LOW")}else{m=m+"\n"+this.oResourceBundle.getText("WARNING")}}if(v[i]==="TA"){m=m+"\n"+this.oResourceBundle.getText("TARGET")}if(v[i]==="CH"){if(this.getView().getModel().getData().GOAL_TYPE==="RA"){m=m+"\n"+this.oResourceBundle.getText("CRITICAL_HIGH")}else{m=m+"\n"+this.oResourceBundle.getText("CRITICAL")}}if(v[i]==="WH"){if(this.getView().getModel().getData().GOAL_TYPE==="RA"){m=m+"\n"+this.oResourceBundle.getText("WARNING_HIGH")}else{m=m+"\n"+this.oResourceBundle.getText("WARNING")}}}sap.suite.smartbusiness.utils.showErrorMessage(m);return}}if(!t.indicatorContext){t.indicatorContext="INDICATORS_MODELER(ID='"+f.INDICATOR+"',IS_ACTIVE=1)"}t.busyDialog.open();t.evalParamPayload={};t.evalParamPayload=t.getEvalParamPayload(t.getView().getModel().getData());t.saveFilters(t.getView());t.saveValues(t.getView());t.saveTags(t.getView());t.saveProperties(t.getView());t.saveAdditionalLanguages(t.getView());if(!e){e="create"}if(f.mode==="create"){t.createBatch=t.createBatchForEvalCreateMode(e)}else if(f.mode==="edit"){if(t.evalDetails.IS_ACTIVE===0&&f.IS_ACTIVE===0){t.createBatchPayload(e)}else if(t.evalDetails.IS_ACTIVE===1&&f.IS_ACTIVE===0){t.getView().getModel().setProperty("/mode","create");t.createBatch=t.createBatchForEvalCreateMode(e)}}},saveAndCreateNew:function(e){this.saveAndExit("createNew")},saveAndActivate:function(){var t=this;t.checkForActivation("saveActivate")},checkForActivation:function(p){var t=this;var f=t.getView().getModel().getData();if(!f.TITLE||f.TITLE===""){t.byId("evalTitle").setValueState("Error");sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_EVALUATION_TITLE"));return}var e=t.validateDimensionsAndInputParameters();if(e.error){if(e.errorType==="mandatoryFieldEmpty"){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_ALL_INPUT_PARAMETERS"));return}if(e.errorType==="fieldEmpty"){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_ALL_DIMENSION_VALUES"));return}if(e.errorType==="invalidEntry"){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_INVALID_TEXT_FOR",e.errorDimension.name));return}}if(f.ODATA_URL===""){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_ODATA_URL"));return}if(f.ODATA_ENTITYSET===""){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_ENTITY_SET"));return}if(f.COLUMN_NAME===""){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_MEASURE"));return}if(t.getView().byId('targetThresholdPanel').getContent()[0].byId("additionalMeasures").getTokens().length){var a=t.byId('targetThresholdPanel').getContent()[0].byId("additionalMeasures").getTokens();for(var i=0,l=a.length;i<l;i++){if(a[i].getText()==f.COLUMN_NAME){t.byId('targetThresholdPanel').getContent()[0].byId("additionalMeasures").setValueState("Error");sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ADDI_MEASURE_HAS_MAIN_MEASURE"));return}}}if(!f.TARGET||f.TARGET==""){var b=new sap.m.Dialog({icon:"sap-icon://warning2",title:t.oResourceBundle.getText("WARNING"),state:"Warning",type:"Message",content:[new sap.m.Text({text:t.oResourceBundle.getText("ERROR_TARGET_NOT_ENTERED")})],beginButton:new sap.m.Button({text:t.oResourceBundle.getText("CONTINUE"),press:function(){b.close();t.saveAndExit(p)}}),endButton:new sap.m.Button({text:t.oResourceBundle.getText("CANCEL"),press:function(){b.close()}})});b.open()}else{t.saveAndExit(p)}},activateAndAddTiles:function(){var t=this;t.checkForActivation("activate")},cancel:function(){this.navigateBack()},deleteDraft:function(){var t=this;var o={};o.ID=t.getView().getModel().getData().ID;o.IS_ACTIVE=t.getView().getModel().getData().IS_ACTIVE;var u=sap.suite.smartbusiness.utils.serviceUrl("EVALUATION_SERVICE_URI");sap.suite.smartbusiness.utils.remove(u,o,function(d){sap.m.MessageToast.show(t.oResourceBundle.getText("SUCCESS_DELETING_DRAFT"));window.location.hash="FioriApplication-SBWorkspace?sap-system=HANA&/detail/INDICATORS_MODELER(ID='"+t.getView().getModel().getData().INDICATOR+"',IS_ACTIVE=1)"},function(e){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_DELETING_DRAFT"))})},validateEvalId:function(){var t=this;var e=this.getView().byId('evalId');var i=0;var a=e.getValue();if(a){if(!(/^[a-zA-Z0-9.]*$/.test(a))){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_VALID_EVAL_ID"));e.setValueState("Error");return true}else{e.setValueState("None");this.oDataModel.read("/EVALUATIONS",null,"$filter=ID eq '"+a+"'",true,function(d){if(d.results.length>0){if(d.results[0].ID){e.setValueState("Error");sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_EVAL_WITH_ID_EXISTS",a));return true}else{e.setValueState("None")}}else{e.setValueState("None")}},function(){e.setValueState("None")})}}return false},validateEmailAddress:function(){var t=this;var e=this.getView().byId('evalOwnerEmail');var a=e.getValue();if(a){if(!(/^\w+[\w-\.]*\@\w+((-\w+)|(\w*))\.[a-z]/.test(a))){e.setValueState("Error");sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_VALID_EVAL_E_MAIL"))}else{e.setValueState("None")}}else{e.setValueState("None")}},listAllKpis:function(){var t=this;var h=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_KPI"),noDataText:t.oResourceBundle.getText("NO_DATA_FOUND"),items:{path:"/INDICATORS_MODELER",template:new sap.m.ObjectListItem({title:"{TITLE}",number:"{EVALUATION_COUNT}",firstStatus:new sap.m.ObjectStatus({text:"Evaluations",}),attributes:[new sap.m.ObjectAttribute({text:"{ID}"})]})},confirm:function(e){t.busyDialog.open();t.indicatorContext="INDICATORS_MODELER(ID='"+e.getParameter("selectedItem").getBindingContext().getProperty("ID")+"',IS_ACTIVE=1)";t.getKpiDetails()},liveChange:function(e){var s="'"+e.getParameter("value").toLowerCase()+"'";var F=new sap.ui.model.Filter("tolower(ID)",sap.ui.model.FilterOperator.Contains,s);var o=new sap.ui.model.Filter("tolower(TITLE)",sap.ui.model.FilterOperator.Contains,s);var a=new sap.ui.model.Filter("IS_ACTIVE",sap.ui.model.FilterOperator.EQ,1);var b=e.getSource().getBinding("items");var c=new sap.ui.model.Filter([F,o],false);var d=new sap.ui.model.Filter([a],true);b.filter(new sap.ui.model.Filter([c,d],true))}});h.setModel(t.oDataModel);var f=[];f.push(new sap.ui.model.Filter("IS_ACTIVE",sap.ui.model.FilterOperator.EQ,1));h.getBinding("items").filter(new sap.ui.model.Filter(f,true));h.open()},handleHanaViewValueHelp:function(){var t=this;var h=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_VIEW"),noDataText:t.oResourceBundle.getText("NO_DATA_FOUND"),items:{path:"/HANA_VIEWS",template:new sap.m.StandardListItem({title:{parts:[{path:"OBJECT",type:new sap.ui.model.type.String()},{path:"PACKAGE",type:new sap.ui.model.type.String()},{path:"SUFFIX",type:new sap.ui.model.type.String()}],formatter:function(o,p,s){if(s.indexOf("view")!=-1)return p+"/"+o;else return p+"::"+o}},description:"{SUFFIX}"})},confirm:function(e){t.getView().getModel().setProperty("/VIEW_NAME",e.getParameter("selectedItem").getProperty("title"));t.getView().getModel().setProperty("/ODATA_URL","");t.getView().getModel().setProperty("/ODATA_ENTITYSET","");t.getView().getModel().setProperty("/COLUMN_NAME","");t.resetAdditionalMeasures();t.currentSelectedHanaViewObject=e.getParameter("selectedItem").getBindingContext().getObject()},liveChange:function(e){var s="'"+e.getParameter("value").toLowerCase()+"'";var f=new sap.ui.model.Filter("tolower(PACKAGE)",sap.ui.model.FilterOperator.Contains,s);var F=new sap.ui.model.Filter("tolower(OBJECT)",sap.ui.model.FilterOperator.Contains,s);var b=e.getSource().getBinding("items");b.filter(new sap.ui.model.Filter([f,F],false))}});h.setModel(this.oDataModel);h.open()},hanaViewChange:function(v){var t=this;t.getView().getModel().setProperty("/ODATA_URL","");t.getView().getModel().setProperty("/ODATA_ENTITYSET","");t.getView().getModel().setProperty("/COLUMN_NAME","");t.resetAdditionalMeasures();t.resetDimensionsAndInputParameters()},handleOdataServiceValueHelp:function(){var t=this;if(!t.byId("viewInput").getValue()){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_A_HANA_VIEW"))}else{var a=t.getView().getModel().getProperty("/VIEW_NAME");a=(a.indexOf("/")!=-1?a.split("/"):a.split("::"));var h=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_ODATA_SERVICE"),noDataText:t.oResourceBundle.getText("NO_DATA_FOUND"),items:{path:"/ODATA_FOR_ENTITY(P_PACKAGE='"+a[0]+"',P_OBJECT='"+a[1]+"')/Results",template:new sap.m.StandardListItem({title:{parts:[{path:"PACKAGE",type:new sap.ui.model.type.String()},{path:"OBJECT",type:new sap.ui.model.type.String()}],formatter:function(o,p,s){o=o.replace(/\./g,'/');return"/"+o+"/"+p+".xsodata"}},})},confirm:function(e){t.getView().getModel().setProperty("/ODATA_URL",e.getParameter("selectedItem").getProperty("title"));t.getView().getModel().setProperty("/ODATA_ENTITYSET","");t.getView().getModel().setProperty("/COLUMN_NAME","");t.resetAdditionalMeasures();t.currentSelectedODataUrlObject=e.getParameter("selectedItem").getBindingContext().getObject()},liveChange:function(e){var s="'"+e.getParameter("value").toLowerCase()+"'";var f=new sap.ui.model.Filter("tolower(PACKAGE)",sap.ui.model.FilterOperator.Contains,s);var F=new sap.ui.model.Filter("tolower(OBJECT)",sap.ui.model.FilterOperator.Contains,s);var b=e.getSource().getBinding("items");b.filter(new sap.ui.model.Filter([f,F],false))}});h.setModel(t.oDataModel);h.open()}},oDataUrlChange:function(v){var t=this;t.getView().getModel().setProperty("/ODATA_ENTITYSET","");t.getView().getModel().setProperty("/COLUMN_NAME","");t.resetAdditionalMeasures();t.resetDimensionsAndInputParameters()},handleEntitySetValueHelp:function(){var t=this;if(!t.byId("odataServiceInput").getValue()){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_ODATA_URL"))}else{var t=this;t.oModelForEntity;var h=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_ENTITY_SET"),noDataText:t.oResourceBundle.getText("NO_DATA_FOUND"),items:{path:"/entitySet",template:new sap.m.StandardListItem({title:{parts:[{path:"entityName",type:new sap.ui.model.type.String()}],formatter:function(o,s){return o}},})},confirm:function(E){t.getView().getModel().setProperty("/ODATA_ENTITYSET",E.getParameter("selectedItem").getProperty("title"));t.resetDimensionsAndInputParameters();t.resetAdditionalMeasures();try{t.populateDimensionsAndInputParameters(t.getView().getModel().getProperty("/ODATA_URL"),t.getView().getModel().getProperty("/ODATA_ENTITYSET"))}catch(e){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_WRONG_ENTITY_SET"),t.oResourceBundle.getText("ERROR_ODATA_ANALYTICS"));t.resetDimensionsAndInputParameters()}},liveChange:function(e){var s="'"+e.getParameter("value").toLowerCase()+"'";var f=new sap.ui.model.Filter("tolower(entityName)",sap.ui.model.FilterOperator.Contains,s);var b=e.getSource().getBinding("items");b.filter(new sap.ui.model.Filter([f],false))}});try{if(t.getView().getModel().getData().VIEW_NAME){t.populateRelevantEntitySet(h)}else{t.oModelForEntity=t.populateEntitySet(t.getView().byId("odataServiceInput").getValue());h.setModel(t.oModelForEntity);h.open()}}catch(a){}}},entitySetChange:function(v){var t=this;t.resetAdditionalMeasures();if(t.getView().getModel().getProperty("/ODATA_URL")&&t.getView().getModel().getProperty("/ODATA_ENTITYSET")){try{t.populateDimensionsAndInputParameters(t.getView().getModel().getProperty("/ODATA_URL"),t.getView().getModel().getProperty("/ODATA_ENTITYSET"))}catch(e){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_WRONG_ENTITY_SET"),t.oResourceBundle.getText("ERROR_ODATA_ANALYTICS"));t.resetDimensionsAndInputParameters()}}else{t.resetDimensionsAndInputParameters();t.getView().getModel().setProperty("/COLUMN_NAME","")}},handleMeasureValueHelp:function(){var t=this;var t=this;if(!t.byId("entitySetInput").getValue()){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_ENTITY_SET"))}else{try{t.oModelForMeasure=t.populateMeasure(t.getView().getModel().getProperty("/ODATA_URL"),t.getView().getModel().getProperty("/ODATA_ENTITYSET"))}catch(e){}var h=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_MEASURE"),noDataText:t.oResourceBundle.getText("NO_DATA_FOUND"),items:{path:"/measures",template:new sap.m.StandardListItem({title:{parts:[{path:"measureName",type:new sap.ui.model.type.String()}],formatter:function(o,s){return o}},})},confirm:function(E){t.getView().getModel().setProperty("/COLUMN_NAME",E.getParameter("selectedItem").getProperty("title"))},liveChange:function(E){var s="'"+E.getParameter("value").toLowerCase()+"'";var f=new sap.ui.model.Filter("tolower(measureName)",sap.ui.model.FilterOperator.Contains,s);var b=E.getSource().getBinding("items");b.filter(new sap.ui.model.Filter([f],false))}});h.setModel(t.oModelForMeasure);h.open()}},measureChange:function(v){var t=this;try{t.oModelForMeasure=t.populateMeasure(t.getView().getModel().getProperty("/ODATA_URL"),t.getView().getModel().getProperty("/ODATA_ENTITYSET"))}catch(e){}},handleChangeAdditionalInfo:function(e){var t=this;t.getView().getModel().setProperty("info",t.getView().byId("additionalInfoId"))},populateRelevantEntitySet:function(d){var t=this;var m=this.getView().getModel().getData();var o=m.ODATA_URL.substr(0,m.ODATA_URL.lastIndexOf("/"));o=o.replace(/\//g,'.').replace(".","");var b=m.ODATA_URL.substr(m.ODATA_URL.lastIndexOf("/")+1);b=b.split(".")[0];var e="/ODATA_FOR_ENTITY(P_PACKAGE='"+m.VIEW_NAME.split("/")[0]+"',P_OBJECT='"+m.VIEW_NAME.split("/")[1]+"')/Results?$filter=PACKAGE eq '"+o+"' and OBJECT eq '"+b+"'";this.oApplicationFacade.getODataModel().read(e,null,null,false,function(c){if(c.results&&c.results.length){var f=c.results[0].CDATA_STR;d.open();if(f){var g=f.split("\n");for(var i=0,l=g.length;i<l;i++){if(g[i].indexOf("//")!=-1){g[i]=g[i].substr(0,g[i].indexOf("//"))}}f=g.join("\n");while(f.indexOf("/*")!=-1){var s=f.indexOf("/*");var h=f.indexOf("*/");h=(h==-1)?f.length:(h-2);f=f.substr(0,s)+f.substr(h)}}var j=[];var M=new sap.ui.model.json.JSONModel();var a=f.split(m.VIEW_NAME.split("/")[0]+'::'+m.VIEW_NAME.split("/")[1]);if(a.length==1){a=f.split(m.VIEW_NAME.split("/")[0]+'/'+m.VIEW_NAME.split("/")[1])}if(a.length==1){sap.m.MessageToast.show("OData Document not compatible");M=t.populateEntitySet(t.getView().byId("odataServiceInput").getValue());d.setModel(M);return}for(var i=1,l=a.length;i<l;i++){var k={};k.entityName=a[i].split('"')[2];j.push(k)}M.setData({entitySet:j});d.setModel(M);return}},function(a){})},populateEntitySet:function(d){var c=this;var m=new sap.ui.model.json.JSONModel();var r=[],e=[],o={};var i;r=sap.suite.smartbusiness.odata.getAllEntitySet(d);for(i=0;i<r.length;i++){o={};o.entityName=r[i];e.push(o)}m.setData({entitySet:e});return m},validateQueryServiceURI:function(d){d=jQuery.trim(d);if(!jQuery.sap.startsWith(d,"/")){d="/"+d}if(jQuery.sap.endsWith(d,"/")){d=d.substring(0,d.length-1)}return d},populateMeasure:function(d,e){d=this.validateQueryServiceURI(d)+"";e=e+"";var m=[],a=[],o={};var i;m=sap.suite.smartbusiness.odata.getAllMeasures(d,e);for(i=0;i<m.length;i++){o={};o.measureName=m[i];a.push(o)}var M=new sap.ui.model.json.JSONModel();M.setData({measures:a});return M},additionalInformationForKpi:function(e){var t=this;t.dialogAdditionalInfo=new sap.m.Dialog({type:"Message",title:t.oResourceBundle.getText("ADDITIONAL_INFO_FROM_KPI"),content:[new sap.m.Label({text:{path:'/DATA_SPECIFICATION',formatter:function(v){if(t.getView().getModel().getData().DATA_SPECIFICATION){return t.getView().getModel().getData().DATA_SPECIFICATION}else{return t.oResourceBundle.getText("ERROR_NO_DATA_TO_DISPLAY")}}}})],beginButton:new sap.m.Button({text:t.oResourceBundle.getText("CLOSE"),press:function(E){E.getSource().getParent().close()}})});t.dialogAdditionalInfo.setModel(t.getView().getModel());t.dialogAdditionalInfo.open()},addNewProperty:function(){if(this.getView().byId("propertyName").getValue()){this.getView().byId("propertyName").setValueState("None");if(this.getView().byId("propertyValue").getValue()){this.getView().byId("propertyValue").setValueState("None");var p=this.getView().byId('propertyNameValueBox').getModel();p.getData().PROPERTIES=p.getData().PROPERTIES||[];for(var i=0;i<p.getData().PROPERTIES.length;i++){if((p.getData().PROPERTIES[i].NAME===this.getView().byId("propertyName").getValue())&&(p.getData().PROPERTIES[i].VALUE===this.getView().byId("propertyValue").getValue())){sap.suite.smartbusiness.utils.showErrorMessage(this.oResourceBundle.getText("ERROR_PROPERTY_VALUE_PAIR_EXISTS"));return}}p.getData().PROPERTIES.push({NAME:this.getView().byId("propertyName").getValue(),VALUE:this.getView().byId("propertyValue").getValue()});p.updateBindings();this.getView().byId("propertyName").setValue("");this.getView().byId("propertyValue").setValue("")}else{this.getView().byId("propertyValue").setValueState("Error");sap.suite.smartbusiness.utils.showErrorMessage(that.oResourceBundle.getText("ERROR_ENTER_PROPERTY_VALUE"))}}else{this.getView().byId("propertyName").setValueState("Error");sap.suite.smartbusiness.utils.showErrorMessage(that.oResourceBundle.getText("ERROR_ENTER_PROPERTY_NAME"))}},removeProperty:function(e){var p=e.getSource().getBindingContext().getPath();e.getSource().getBindingContext().getModel().getData().PROPERTIES.splice(p.substring(p.lastIndexOf("/")+1),1);e.getSource().getBindingContext().getModel().updateBindings()},populateDimensionsAndInputParameters:function(d,e){var a=[];var b=[];this.oData4SAPAnalyticsModel=new sap.suite.smartbusiness.odata4analytics.Model(new sap.suite.smartbusiness.odata4analytics.Model.ReferenceByURI(d),null);this.queryResultObj=this.oData4SAPAnalyticsModel.findQueryResultByName(e);var q=this.queryResultObj.getAllDimensions();for(k in q){var n=q[k].getName();var p=q[k].getKeyProperty().type;var c={name:n,propertyType:p};a.push(c)}var f=this.oModelForDimensions.getData();f.dimensions=a;f.dataSource=d;f.entitySet=e;if(f.selectedDimensions){for(var k in f.selectedDimensions){f.selectedDimensions[k].propertyType=this.queryResultObj.findDimensionByName(f.selectedDimensions[k].name)?this.queryResultObj.findDimensionByName(f.selectedDimensions[k].name).getKeyProperty().type:"";if(f.selectedDimensions[k].propertyType=="Edm.DateTime"){var v=f.selectedDimensions[k].value_1.split(",");for(i in v){if(v[i]!=""){var g=new Date(v[i]);var m=g.getMonth()+1;m=/^\d$/.test(m)?"0"+m:m;var h=g.getDate();h=/^\d$/.test(h)?"0"+h:h;var j=g.getHours();j=/^\d$/.test(j)?"0"+j:j;var l=g.getMinutes();l=/^\d$/.test(l)?"0"+l:l;var s=g.getSeconds();s=/^\d$/.test(s)?"0"+s:s;v[i]=g.getFullYear()+"-"+m+"-"+h+" "+j+":"+l+":"+s+"."+g.getMilliseconds()}}f.selectedDimensions[k].value_1=v.join(",");v=null;v=f.selectedDimensions[k].value_2.split(",");for(var i in v){if(v[i]!=""){var g=new Date(f.selectedDimensions[k].value_2);var m=g.getMonth()+1;m=/^\d$/.test(m)?"0"+m:m;var h=g.getDate();h=/^\d$/.test(h)?"0"+h:h;var j=g.getHours();j=/^\d$/.test(j)?"0"+j:j;var l=g.getMinutes();l=/^\d$/.test(l)?"0"+l:l;var s=g.getSeconds();s=/^\d$/.test(s)?"0"+s:s;v[i]=g.getFullYear()+"-"+m+"-"+h+" "+j+":"+l+":"+s+"."+g.getMilliseconds()}}f.selectedDimensions[k].value_2=v.join(",");this.dimensionValue[f.selectedDimensions[k].name]=this.dimensionValue[f.selectedDimensions[k].name]?this.dimensionValue[f.selectedDimensions[k].name]:{};this.dimensionValue[f.selectedDimensions[k].name]["value_1"]=f.selectedDimensions[k].value_1;this.dimensionValue[f.selectedDimensions[k].name]["value_2"]=f.selectedDimensions[k].value_2}}}this.oModelForDimensions.setData(f);var o=this.queryResultObj.getParameterization();if(o){if(this.oModelForInputParameters.getData().inputParameters){var b=this.oModelForInputParameters.getData().inputParameters;for(var k in b){b[k].propertyType=o.findParameterByName(b[k].name).getProperty().type;if(b[k].propertyType=="Edm.DateTime"){var v=b[k].value_1.split(",");for(i in v){if(v[i]!=""){var g=new Date(v[i]);var m=g.getMonth()+1;m=/^\d$/.test(m)?"0"+m:m;var h=g.getDate();h=/^\d$/.test(h)?"0"+h:h;var j=g.getHours();j=/^\d$/.test(j)?"0"+j:j;var l=g.getMinutes();l=/^\d$/.test(l)?"0"+l:l;var s=g.getSeconds();s=/^\d$/.test(s)?"0"+s:s;v[i]=g.getFullYear()+"-"+m+"-"+h+" "+j+":"+l+":"+s+"."+g.getMilliseconds()}}b[k].value_1=v.join(",");v=null;v=b[k].value_2.split(",");for(var i in v){if(v[i]!=""){var g=new Date(f.selectedDimensions[k].value_2);var m=g.getMonth()+1;m=/^\d$/.test(m)?"0"+m:m;var h=g.getDate();h=/^\d$/.test(h)?"0"+h:h;var j=g.getHours();j=/^\d$/.test(j)?"0"+j:j;var l=g.getMinutes();l=/^\d$/.test(l)?"0"+l:l;var s=g.getSeconds();s=/^\d$/.test(s)?"0"+s:s;v[i]=g.getFullYear()+"-"+m+"-"+h+" "+j+":"+l+":"+s+"."+g.getMilliseconds()}}b[k].value_2=v.join(",")}}}else{var r=o.getAllParameters();for(var k in r){var n=r[k].getName();var p=r[k].getProperty().type;var t=r[k].isOptional();var c={name:n,propertyType:p,operator:"EQ",value_1:"",value_2:""};b.push(c)}}if(b.length>0)this.byId("inputParameterLayoutHeaders").setVisible(true);f=this.oModelForInputParameters.getData();f.inputParameters=b;this.oModelForInputParameters.setData(f)}},setInputParameterAndFilterLayout:function(){var t=this;this.dimensionValueHelpDialogs={};this.dimensionValue={};this.byId("inputParameterLayoutHeaders").setVisible(false);this.byId("inputParameterBaseLayout").setModel(this.oModelForInputParameters);this.byId("inputParameterBaseLayout").bindAggregation("items","/inputParameters",function(i,c){var a=new sap.m.Select({width:"100%",customData:[{key:"valueType",value:"value_1"}],items:[new sap.ui.core.Item({text:t.oResourceBundle.getText("EQUAL_TO"),key:"EQ"})],selectedKey:"{operator}",layoutData:new sap.ui.layout.GridData({span:"L4 M4"})});var b=new sap.m.Input({value:"{value_1}",customData:[{key:"valueType",value:"value_1"}],valueHelpRequest:jQuery.proxy(t.openInputParameterValueHelpDialog,t),change:jQuery.proxy(t.handleDimensionValueChange,t),valueState:{path:"error_1",formatter:function(e){if(e)return"Error";else return"None"}},layoutData:new sap.ui.layout.GridData({span:"L4 M4"})});var d=new sap.ui.layout.Grid({defaultSpan:"L9 M9",content:[new sap.m.Input({value:"{name}",editable:false,layoutData:new sap.ui.layout.GridData({span:"L4 M4"})}),a,b]});return d});this.byId("dimensionLayoutHeaders").setVisible(false);this.byId("baseDimensionLayout").setModel(this.oModelForDimensions);this.byId("baseDimensionLayout").bindAggregation("items","/selectedDimensions",function(i,c){var d=new sap.m.Select({width:"100%",customData:[{key:"valueType",value:"value_1"}],items:[new sap.ui.core.Item({text:t.oResourceBundle.getText("EQUAL_TO"),key:"EQ"}),new sap.ui.core.Item({text:t.oResourceBundle.getText("GREATER_THAN"),key:"GT"}),new sap.ui.core.Item({text:t.oResourceBundle.getText("LESS_THAN"),key:"LT"}),new sap.ui.core.Item({text:t.oResourceBundle.getText("NOT_EQUAL_TO"),key:"NE"}),new sap.ui.core.Item({text:t.oResourceBundle.getText("BETWEEN"),key:"BT"})],selectedKey:"{operator}",change:jQuery.proxy(t.handleOperatorChange,t),layoutData:new sap.ui.layout.GridData({span:"L3 M3"})});var a=new sap.m.Input({value:"{value_1}",customData:[{key:"valueType",value:"value_1"}],showValueHelp:true,valueState:{path:"error_1",formatter:function(j){if(j)return"Error";else return"None"}},valueHelpRequest:jQuery.proxy(t.handleDimensionValueHelp,t),change:jQuery.proxy(t.handleDimensionValueChange,t),layoutData:new sap.ui.layout.GridData({span:"L4 M4"})});var b=new sap.m.Input({value:"{value_2}",customData:[{key:"valueType",value:"value_2"}],showValueHelp:true,visible:{path:"operator",formatter:function(o){return(o==="BT")?true:false}},valueState:{path:"error_2",formatter:function(j){if(j)return"Error";else return"None"}},valueHelpRequest:jQuery.proxy(t.handleDimensionValueToHelp,t),change:jQuery.proxy(t.handleDimensionValueChange,t),layoutData:new sap.ui.layout.GridData({span:"L4 M4"})});var e=new sap.m.Label({text:"To",visible:{path:"operator",formatter:function(o){return(o==="BT")?true:false}}});var f=new sap.m.VBox({items:[a,e,b],layoutData:new sap.ui.layout.GridData({span:"L4 M4"})});var g=new sap.m.Button({icon:"sap-icon://sys-cancel",type:"Transparent",layoutData:new sap.ui.layout.GridData({span:"L2 M2 S2"}),press:function(j){var p=j.getSource().getBindingContext().getPath();if(t.dimensionValue){if(t.dimensionValue[j.getSource().getBindingContext().getObject().name]){delete t.dimensionValue[j.getSource().getBindingContext().getObject().name]}}j.getSource().getBindingContext().getModel().getData().selectedDimensions.splice(p.substring(p.lastIndexOf("/")+1),1);j.getSource().getBindingContext().getModel().updateBindings();if(j.getSource().getBindingContext().getModel().getData().selectedDimensions.length==0){t.byId("dimensionLayoutHeaders").setVisible(false)}}});var h=new sap.ui.layout.Grid({defaultSpan:"L12 M12",content:[new sap.m.Input({value:"{name}",editable:false,layoutData:new sap.ui.layout.GridData({span:"L3 M3"})}),d,f,g]});return h})},openInputParameterValueHelpDialog:function(n){var t=this;var i=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_VALUES"),multiSelect:true,rememberSelections:true,items:{path:"/results",template:new sap.m.StandardListItem({title:"{"+n+"}",})},confirm:function(e){},liveChange:function(e){}});i.setGrowingThreshold(100);i.open()},openDimensionDialog:function(){var t=this;if(!this.dimensionDialog){var s=new sap.ui.model.Sorter("name",false);this.dimensionDialog=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_DIMENSIONS"),multiSelect:true,items:{path:"/dimensions",sorter:s,template:new sap.m.StandardListItem({title:"{name}"})},confirm:function(e){var a=t.oModelForDimensions.getData().selectedDimensions||[];var b=e.getParameter("selectedItems");var c=[];for(var k in b){c[k]=b[k].getBindingContext()}for(var k in c){var d=t._cloneObj(c[k].getObject());d.value_1="";d.value_2="";d.operator="EQ";a.push(d)}if(c.length>0)t.byId("dimensionLayoutHeaders").setVisible(true);else t.byId("dimensionLayoutHeaders").setVisible(false);t.oModelForDimensions.setProperty("/selectedDimensions",a)},liveChange:function(e){var a=e.getParameter("value");var f=new sap.ui.model.Filter("name",sap.ui.model.FilterOperator.Contains,a);var b=e.getSource().getBinding("items");b.filter([f])}});this.dimensionDialog.setGrowingThreshold(100);this.dimensionDialog.setModel(this.oModelForDimensions)}this.dimensionDialog.open()},handleDimensionValueHelp:function(e){this.openDimensionValueHelpDialog(e,"value_1")},handleDimensionValueToHelp:function(e){this.openDimensionValueHelpDialog(e,"value_2")},openDimensionValueHelpDialog:function(e,v){var t=this;var p=e.getSource();var b=this.getView().getModel();var d=new sap.ui.model.json.JSONModel();var a=[];this.dimensionContext=e.getSource().getBindingContext();var c=e.getSource().getBindingContext().getProperty("name");var f=e.getSource().getBindingContext().getProperty("operator");var g=e.getSource().getBindingContext().getProperty("propertyType");var h=this.oModelForInputParameters.getData().inputParameters;for(var l in h){a.push({OPERATOR:h[l].operator,NAME:h[l].name,VALUE_1:h[l].value_1,VALUE_2:h[l].value_2,TYPE:"PA"})}var q=sap.suite.smartbusiness.odata.getUri({serviceUri:b.getProperty("/ODATA_URL"),entitySet:b.getProperty("/ODATA_ENTITYSET"),filter:a,dimension:c});q.model.read(q.uri,null,null,false,function(r){if(t.dimensionValue[c]){t.dimensionValue[c][v]=t.dimensionValue[c][v]?t.dimensionValue[c][v]:"";var u=t.dimensionValue[c][v]===""?null:t.dimensionValue[c][v].split(",");for(l in u){var w=true;for(var i in r.results){if(g=="Edm.DateTime"){var x=new Date(u[l]).toJSON();var y=new Date(r.results[i][c]).toJSON();if(x==y){w=false;break}}else if(u[l]===r.results[i][c]){w=false;break}}if(w){var z={};z[c]=u[l];z.userInput=true;z.selected=true;r.results.push(z)}else r.results[i].selected=true}}d.setData(r)},function(r){});var s=new sap.ui.model.Sorter(c,false,function(r){if(r.getProperty("userInput")===true)return{key:"USER_VALUES",text:t.oResourceBundle.getText("VALUES_ENTERED_BY_USER")};else return{key:"SERVICE_VALUES",text:t.oResourceBundle.getText("VALUES_FETCHED_FROM_SERVICE")}});this.dimensionValueHelpDialogs=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_VALUES"),multiSelect:true,rememberSelections:true,items:{path:"/results",sorter:s,template:new sap.m.StandardListItem({title:"{"+c+"}",selected:"{selected}"})},confirm:function(e){var r="";var C=e.getParameter("selectedContexts");for(var l in C){if(g=="Edm.DateTime"){var u=new Date(C[l].getProperty(t.dimensionContext.getProperty("name")));var w=u.getMonth()+1;w=/^\d$/.test(w)?"0"+w:w;var x=u.getDate();x=/^\d$/.test(x)?"0"+x:x;var y=u.getHours();y=/^\d$/.test(y)?"0"+y:y;var z=u.getMinutes();z=/^\d$/.test(z)?"0"+z:z;var A=u.getSeconds();A=/^\d$/.test(A)?"0"+A:A;r=r+u.getFullYear()+"-"+w+"-"+x+" "+y+":"+z+":"+A+"."+u.getMilliseconds()+","}else r=r+C[l].getProperty(t.dimensionContext.getProperty("name"))+","}r=r.substring(0,r.length-1);t.oModelForDimensions.setProperty(t.dimensionContext.getPath()+"/"+v,r);p.fireChange({value:r});t.dimensionValue[c]=t.dimensionValue[c]?t.dimensionValue[c]:{};t.dimensionValue[c][v]=r},liveChange:function(e){var r=e.getParameter("value");var F=new sap.ui.model.Filter(c,sap.ui.model.FilterOperator.Contains,r);var B=e.getSource().getBinding("items");B.filter([F])}});this.dimensionValueHelpDialogs.setGrowingThreshold(100);this.dimensionValueHelpDialogs.setModel(d);var m=this.oModelForDimensions.getData().selectedDimensions;var n=this.dimensionValueHelpDialogs.getItems();for(var i=0;i<m.length;i++){if((c===m[i].name)&&(f===m[i].operator)){var o;if(m[i].operator==="BT"){if(v==="value_1")o=m[i].value_1.split(",");else o=m[i].value_2.split(",")}else{o=m[i].value_1.split(",")}for(var j=0;j<o.length;j++){for(var k=1;k<n.length;k++){if(o[j]===n[k].getTitle()){n[k].setSelected(true)}}}}}this.dimensionValueHelpDialogs.open();for(var i=1;i<n.length;i++){if(!n[i].getSelected()){this.dimensionValueHelpDialogs.getItems()[i].setSelected(true);this.dimensionValueHelpDialogs.getItems()[i].setSelected(false)}}},handleDimensionValueChange:function(e){this.validateValue(e,"dimensionValue");var v=e.getSource().getCustomData()[0].getValue();var d=e.getSource().getBindingContext().getProperty("name");if(!this.dimensionValue[d])this.dimensionValue[d]={};this.dimensionValue[d][v]=e.getParameter("value")},validateValue:function(e,s){var t=this,r;var d=e.getSource().getBindingContext().getProperty("name");var v=e.getSource().getCustomData()[0].getValue();var a=(s==="dimensionValue")?e.getParameter("value").split(","):e.getSource().getBindingContext().getProperty("value_1");var o=e.getSource().getBindingContext().getProperty("operator");if(o==="BT"){if(a.length>1){r=false;sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_MULTIPLE_VALUES_FOR_BETWEEN",d));var p=v==="value_1"?e.getSource().getBindingContext().getPath()+"/error_1":e.getSource().getBindingContext().getPath()+"/error_2";e.getSource().getModel().setProperty(p,true);return}else{var p=v==="value_1"?e.getSource().getBindingContext().getPath()+"/error_1":e.getSource().getBindingContext().getPath()+"/error_2";e.getSource().getModel().setProperty(p,false)}}var b=e.getSource().getBindingContext().getProperty("propertyType");var c,f;for(var k in a){r=true;var g=/<(script)(.*)\/?>/i;var j=/function\s*[^\(]*\(\s*([^\)]*)\)/;var h=/[^\(]*\(\s*([^\)]*)\)\s*{/;if(g.test(a[k])||j.test(a[k])||h.test(a[k])){r=false;c=t.oResourceBundle.getText("ERROR_INVALID_TEXT_FOR",d)}if(b=="Edm.Int32"||b=="Edm.Int16"||b=="Edm.Int64"){f=/^[-+]?\d+$/;r=f.test(a[k])?true:false;c=t.oResourceBundle.getText("ERROR_INVALID_ENTRY_ENTER_INTEGER",d)}else if(b=="Edm.Decimal"){f=/^[-+]?\d+(\.\d+)?$/;r=f.test(a[k])?true:false;c=t.oResourceBundle.getText("ERROR_INVALID_ENTRY_ENTER_DECIMAL",d)}else if(b=="Edm.DateTime"){f=/^[1-9][0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])(\s([0-1][0-9]|2[0-3]):[0-5][0-9]:([0-9]|[0-5][0-9])[.][0-9]+)?$/;r=f.test(a[k])?true:false;c=t.oResourceBundle.getText("ERROR_INVALID_ENTRY_ENTER_DATE",d)}if(!r){sap.suite.smartbusiness.utils.showErrorMessage(c);var p=v==="value_1"?e.getSource().getBindingContext().getPath()+"/error_1":e.getSource().getBindingContext().getPath()+"/error_2";e.getSource().getModel().setProperty(p,true);return}else{var p=v==="value_1"?e.getSource().getBindingContext().getPath()+"/error_1":e.getSource().getBindingContext().getPath()+"/error_2";e.getSource().getModel().setProperty(p,false)}}},handleOperatorChange:function(e){var c=e.getSource().getBindingContext();c.getObject().value_1="";if(this.dimensionValue){if(this.dimensionValue[c.getObject().name]){this.dimensionValue[c.getObject().name].value_1=""}}if(c.getProperty("operator")==="BT"){c.getObject().value_2="";if(this.dimensionValue){if(this.dimensionValue[c.getObject().name]){this.dimensionValue[c.getObject().name].value_2=""}}}c.getModel().updateBindings()},validateDimensionsAndInputParameters:function(){var i=this.oModelForInputParameters.getData().inputParameters;var d=this.oModelForDimensions.getData().selectedDimensions;var e=false;var a="";var b="";for(var k in i){if(i[k].error_1===true||i[k].error_2===true)e=true;if(i[k].value_1===""){e=true;a="mandatoryFieldEmpty";i[k].error_1=true}}this.oModelForInputParameters.updateBindings();for(var k in d){if(d[k].error_1===true||d[k].error_2===true){e=true;a="invalidEntry";b=d[k]}if(d[k].value_1===""){e=true;a="fieldEmpty";d[k].error_1=true}if(d[k].operator==="BT"&&d[k].value_2===""){e=true;a="fieldEmpty";d[k].error_2=true}}this.oModelForDimensions.updateBindings();return{error:e,errorType:a,errorDimension:b}},resetDimensionsAndInputParameters:function(){this.oModelForDimensions.setData({});this.oModelForInputParameters.setData({});this.dimensionDialog=null;this.dimensionValueHelpDialogs={};this.dimensionValue={};this.byId("inputParameterLayoutHeaders").setVisible(false);this.byId("dimensionLayoutHeaders").setVisible(false)},createTargetThresholdLayout:function(){var t=this;var a=this.getView().getModel().getData().TREND;var r=this.getView().getModel().getData().REFERENCE_VALUE;if(this.getView().getModel().getData().INDICATOR){this.getView().byId('targetThresholdPanel').setVisible(true);this.getView().byId('targetThresholdPanel').getContent()[0].destroy();if(this.getView().getModel().getData().mode!=="edit"){delete this.getView().getModel().getData().CRITICALHIGH;delete this.getView().getModel().getData().WARNINGHIGH;delete this.getView().getModel().getData().TARGET;delete this.getView().getModel().getData().WARNINGLOW;delete this.getView().getModel().getData().CRITICALLOW;delete this.getView().getModel().getData().TREND;delete this.getView().getModel().getData().REFERENCE_VALUE}t.getView().byId('targetThresholdPanel').addContent(new sap.ui.core.mvc.XMLView({viewName:"sap.suite.ui.smartbusiness.designtime.evaluation.view.createEvalTargetThresholdTrendInput",viewData:{controller:t}}))}if(!this.getView().getModel().getData().INDICATOR){this.getView().byId('targetThresholdPanel').setVisible(false)}this.getView().getModel().setProperty("TREND",a);this.getView().getModel().setProperty("REFERENCE_VALUE",r)},addAdditionalLanguageDialog:function(){var t=this;this.additionalLanguageListModel=new sap.ui.model.json.JSONModel();this.additionalLanguageListModelData=jQuery.extend([],t.getView().getModel().getData().ADDITIONAL_LANGUAGE_ARRAY);this.getView().getModel().getData().NO_OF_ADDITIONAL_LANGUAGES=this.additionalLanguageListModelData.length;this.additionalLanguageListModel.setData(this.additionalLanguageListModelData);this.languageTextInput=new sap.m.Input({layoutData:new sap.ui.layout.GridData({span:"L8 M8 S8"})});this.languageDescriptionInput=new sap.m.TextArea({layoutData:new sap.ui.layout.GridData({span:"L8 M8 S8"})});this.languageKeySelect=new sap.m.Select({layoutData:new sap.ui.layout.GridData({span:"L6 M6 S6"})});this.addedLanguagesList=new sap.m.List({layoutData:new sap.ui.layout.GridData({span:"L5 M5 S5"}),});this.addedLanguagesList.bindItems("additionalLanguageListModel>/",new sap.m.CustomListItem({content:new sap.ui.layout.Grid({hSpacing:1,vSpacing:0,defaultSpan:"L12 M12 S12",content:[new sap.m.Input({value:"{additionalLanguageListModel>TITLE}",design:"Bold",layoutData:new sap.ui.layout.GridData({span:"L12 M12 S12",vAlign:"Middle"}),editable:false}),new sap.m.Input({value:"{additionalLanguageListModel>DESCRIPTION}",design:"Bold",layoutData:new sap.ui.layout.GridData({span:"L6 M6 S6",vAlign:"Middle"}),editable:false}),new sap.m.Input({value:"{additionalLanguageListModel>LANGUAGE_KEY}",design:"Bold",layoutData:new sap.ui.layout.GridData({span:"L4 M4 S4"}),editable:false}),new sap.m.Button({icon:"sap-icon://sys-cancel",type:"Transparent",press:function(e){var d=e.getSource().getBindingContext("additionalLanguageListModel").getPath().substr(1);var n=t.addedLanguagesList.getModel("additionalLanguageListModel").getData().splice(d,1);t.addedLanguagesList.getModel("additionalLanguageListModel").updateBindings()},layoutData:new sap.ui.layout.GridData({span:"L2 M2 S2"})})]})}));this.addedLanguagesList.setModel(t.additionalLanguageListModel,"additionalLanguageListModel");var a=new sap.m.Dialog({contentHeight:"50%",contentWidth:"25%",title:this.oApplicationFacade.getResourceBundle().getText("ADDITIONAL_LANGUAGE"),content:[new sap.ui.layout.Grid({hSpacing:1,vSpacing:4,defaultSpan:"L12 M12 S12",content:[new sap.ui.layout.form.SimpleForm({editable:true,layout:"ResponsiveGridLayout",content:[new sap.m.Label({text:t.oResourceBundle.getText("TITLE"),layoutData:new sap.ui.layout.GridData({span:"L3 M3 S3",})}),t.languageTextInput,new sap.m.Label({text:t.oResourceBundle.getText("DESCRIPTION"),layoutData:new sap.ui.layout.GridData({span:"L3 M3 S3",})}),t.languageDescriptionInput,new sap.m.Label({text:t.oResourceBundle.getText("LANGUAGE"),layoutData:new sap.ui.layout.GridData({span:"L3 M3 S3"})}),t.languageKeySelect,new sap.m.Button({icon:"sap-icon://add",layoutData:new sap.ui.layout.GridData({span:"L2 M2 S2"}),press:function(){if(t.languageTextInput.getValue()||t.languageDescriptionInput.getValue()){for(var i=0;i<t.addedLanguagesList.getModel("additionalLanguageListModel").getData().length;i++){if(t.addedLanguagesList.getModel("additionalLanguageListModel").getData()[i].LANGUAGE_KEY===t.languageKeySelect.getSelectedItem().getKey()){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_LANGUAGE_EXISTS",t.languageKeySelect.getSelectedItem().getKey()));return}}var b={"TITLE":t.languageTextInput.getValue(),"DESCRIPTION":t.languageDescriptionInput.getValue(),"LANGUAGE_KEY":t.languageKeySelect.getSelectedItem().getKey()};t.addedLanguagesList.getModel("additionalLanguageListModel").getData().push(b);t.addedLanguagesList.getModel("additionalLanguageListModel").updateBindings();t.languageTextInput.setValue("");t.languageDescriptionInput.setValue("")}}})]})]}).addStyleClass("languageGrid"),t.addedLanguagesList],beginButton:new sap.m.Button({text:t.oResourceBundle.getText("OK"),press:function(){a.close();t.getView().getModel().getData().ADDITIONAL_LANGUAGE_ARRAY=t.addedLanguagesList.getModel("additionalLanguageListModel").getData();t.getView().getModel().getData().NO_OF_ADDITIONAL_LANGUAGES=t.getView().getModel().getData().ADDITIONAL_LANGUAGE_ARRAY.length;t.getView().getModel().updateBindings()}}),endButton:new sap.m.Button({text:t.oResourceBundle.getText("CANCEL"),press:function(){a.close()}})});this.oDataModel.read("/LANGUAGE?$select=LAISO",null,null,false,function(d){d=d.results;for(var i=0;i<d.length;i++){if((d[i].LAISO).toUpperCase()==(sap.ui.getCore().getConfiguration().getLocale().getLanguage()).toUpperCase()){d.splice(i,1)}}var m=new sap.ui.model.json.JSONModel();m.setData(d);t.languageKeySelect.setModel(m,"otherLanguageKey");t.languageKeySelect.bindItems("otherLanguageKey>/",new sap.ui.core.Item({text:"{otherLanguageKey>LAISO}",key:"{otherLanguageKey>LAISO}"}))});a.open()},_cloneObj:function(e){var t;if(e instanceof Array){t=[];for(var i=0;i<e.length;i++){t[i]=this._cloneObj(e[i])}}else if(e instanceof Object){t={};for(var a in e){if(e.hasOwnProperty(a)){t[a]=this._cloneObj(e[a])}}}else{t=e}return t},formatLangCount:function(v){if(!this.getView().getModel().getData()){v=0}else v=this.getView().getModel().getData().NO_OF_ADDITIONAL_LANGUAGES;return this.oApplicationFacade.getResourceBundle().getText("ADDITIONAL_LANGUAGE")+"("+v+")"},validateEvaluationValues:function(d){d=d||this.getView().getModel().getData();var v=[];var e=[];var s=0;var c={};if(d.CRITICALLOW||d.CRITICALLOW===0){v.push({key:"CL",value:d.CRITICALLOW,score:s++})}if(d.WARNINGLOW||d.WARNINGLOW===0){v.push({key:"WL",value:d.WARNINGLOW,score:s++})}if(d.TARGET||d.TARGET===0){v.push({key:"TA",value:d.TARGET,score:s++})}if(d.WARNINGHIGH||d.WARNINGHIGH===0){v.push({key:"WH",value:d.WARNINGHIGH,score:s++})}if(d.CRITICALHIGH||d.CRITICALHIGH===0){v.push({key:"CH",value:d.CRITICALHIGH,score:s++})}v.sort(function(a,b){return(a.value-b.value)});for(var i=0,l=v.length;i<l;i++){if(v[i].score!=i){e.push(v[i].key)}if(v[i]&&v[i-1]){if(v[i].value==v[i-1].value){c[v[i-1].key]=v[i-1].value;c[v[i].key]=v[i].value}}}if(!(e.length)){e=Object.keys(c)}return e},resetAdditionalMeasures:function(){var t=this;if(t.getView().getModel().getData().ODATA_URL&&t.getView().getModel().getData().ODATA_ENTITYSET){if(t.getView().byId('targetThresholdPanel').getContent()[0].getController().measuresDialog){var m=t.getView().byId('targetThresholdPanel').getContent()[0].getController().populateMeasure(t.getView().getModel().getData().ODATA_URL,t.getView().getModel().getData().ODATA_ENTITYSET);t.getView().byId('targetThresholdPanel').getContent()[0].getController().measuresDialog.setModel(m)}}else{if(t.getView().byId('targetThresholdPanel').getContent()[0].getController().measuresDialog){var m=new sap.ui.model.json.JSONModel({});t.getView().byId('targetThresholdPanel').getContent()[0].getController().measuresDialog.setModel(m)}}t.getView().byId('targetThresholdPanel').getContent()[0].byId('additionalMeasures').removeAllTokens()}});
