jQuery.sap.require("sap.ca.scfld.md.controller.BaseDetailController");jQuery.sap.require("sap.m.MessageBox");jQuery.sap.require("sap.m.MessageToast");sap.ca.scfld.md.controller.BaseDetailController.extend("sap.suite.ui.smartbusiness.designtime.workspace.view.S3",{onInit:function(){var t=this;var v=this.getView();this.oRouter.attachRouteMatched(function(e){if(e.getParameter("name")==="multiSelect"){var p=this.getView().getContent()[0].getContent();for(var i=0,l=p.length;i<l;i++){p[i].setVisible(false)}this.oApplicationFacade.multiSelectMode=true}else if(e.getParameter("name")==="detail"){if(this.oApplicationFacade.multiSelectMode){var p=this.getView().getContent()[0].getContent();for(var i=0,l=p.length;i<l;i++){p[i].setVisible(true)}this.oApplicationFacade.multiSelectMode=undefined}this.oApplicationFacade.currentContextPath=e.getParameter("arguments").contextPath;var c=new sap.ui.model.Context(v.getModel(),'/'+(e.getParameter("arguments").contextPath));v.setBindingContext(c);v.contextPath=e.getParameter("arguments").contextPath;t.contextIndicatorId=v.getBindingContext().getProperty("ID")||e.getParameter("arguments").contextPath.split("(")[1].split(",")[0].split("=")[1].replace(/'/g,'');var m=new sap.ui.model.json.JSONModel();t.getView().byId("kpiAssociationTable").getBinding("items").filter(new sap.ui.model.Filter([new sap.ui.model.Filter("SOURCE_INDICATOR",sap.ui.model.FilterOperator.EQ,t.contextIndicatorId),new sap.ui.model.Filter("TARGET_INDICATOR",sap.ui.model.FilterOperator.EQ,t.contextIndicatorId)],false));t.byId("kpiAssociationTable").getBinding("items").attachDataReceived(function(d){t.getView().byId("associationIconTab").setCount(t.getView().byId("kpiAssociationTable").getItems().length)});if(v.getBindingContext().getObject()){this.onAfterIndicatorContext(v.getBindingContext().getObject());this.contextIndicatorId=v.getBindingContext().getProperty("ID")}else{this.oApplicationFacade.getODataModel().read(v.contextPath,null,null,true,function(d){t.onAfterIndicatorContext(d);t.currentContextDataForBookmark=d;t.contextIndicatorId=d.ID},function(a){t.contextIndicatorId=e.getParameter("arguments").contextPath.split("(")[1].split(",")[0].split("=")[1].replace(/'/g,'');sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("YMSG_ERROR_RETRIEVING_DATA"),a.response.body)})}t.byId("evaluationTable").getBinding("items").attachDataReceived(function(d){t.oApplicationFacade.evaluationContexts=[];var a=t.byId("evaluationTable").getItems();for(var i=0;i<a.length;i++){t.oApplicationFacade.evaluationContexts[i]=a[i].getBindingContext().getPath()}})}},this);this.oHeaderFooterOptions={bSuppressBookmarkButton:{},buttonList:[]};t.byId("directionArrowAssociation").setColor(sap.ui.core.theming.Parameters.get("sapUiLightText"))},getHeaderFooterOptions:function(){return this.oHeaderFooterOptions},onAfterRendering:function(){},formatOwner:function(o){return(o||"")},formatStatus:function(s){return((s)?(this.oApplicationFacade.getResourceBundle().getText("ACTIVE")):this.oApplicationFacade.getResourceBundle().getText("DRAFT"))},formatGoalType:function(g){var t=this;var a=null;switch(g){case'MA':a=t.oApplicationFacade.getResourceBundle().getText("MAXIMIZING");break;case'MI':a=t.oApplicationFacade.getResourceBundle().getText("MINIMIZING");break;case'RA':a=t.oApplicationFacade.getResourceBundle().getText("RANGE");break;default:a=t.oApplicationFacade.getResourceBundle().getText("NONE")}return a},formatEvaluationCount:function(e){return(e||0)},formatFavoriteMark:function(f){return((f)?true:false)},formatTags:function(t){return((this.getView().byId("tags").getItems().length>1)?(', '+t):(t))},formatAssociationCount:function(s,t){var a=this;if(s==null&&t==null){return a.oApplicationFacade.getResourceBundle().getText("ASSOCIATIONS")+"(0)"}if(s==null){return a.oApplicationFacade.getResourceBundle().getText("ASSOCIATIONS")+"("+t+")"}if(t==null){return a.oApplicationFacade.getResourceBundle().getText("ASSOCIATIONS")+"("+s+")"}var c=(parseInt(s)+parseInt(t));return a.oApplicationFacade.getResourceBundle().getText("ASSOCIATIONS")+"("+c.toString()+")"},formatProperties:function(n,v){var p=((this.getView().byId("assoProperties").getItems().length>1)?(", "+n+" : "+v):(n+" : "+v+","));return p},formatArrowDirection:function(s){return((s==this.contextIndicatorId)?("sap-icon://arrow-right"):("sap-icon://arrow-left"))},formatAssociationType:function(a){if(a=="SUPPORTING"){return this.oApplicationFacade.getResourceBundle().getText("SUPPORTING")}else{return this.oApplicationFacade.getResourceBundle().getText("CONFLICTING")}},formatTargetIndicatorText:function(s,t,a,b){var i=null;if(t==this.contextIndicatorId){i=a}else{i=b}return i},formatStatusOfAssociation:function(i,c){var t=this;if(c=="2"){var s=t.oApplicationFacade.getResourceBundle().getText("STATUS_ACTIVE")+","+t.oApplicationFacade.getResourceBundle().getText("STATUS_DRAFT");return s}if(i==0){return t.oApplicationFacade.getResourceBundle().getText("STATUS_NEW")}if(i==1){return t.oApplicationFacade.getResourceBundle().getText("STATUS_ACTIVE")}},formatKpiStatus:function(s,c){var t=this;var i="";if(c>1){i=(t.oApplicationFacade.getResourceBundle().getText("STATUS_ACTIVE")+","+t.oApplicationFacade.getResourceBundle().getText("STATUS_DRAFT"))}else if(s){i=t.oApplicationFacade.getResourceBundle().getText("STATUS_ACTIVE")}else{i=t.oApplicationFacade.getResourceBundle().getText("STATUS_NEW")}return i},handleEvaluationSelect:function(e){var t=this;for(var i=0;i<this.oApplicationFacade.evaluationContexts.length;i++){if(e.getParameter("listItem").getBindingContext().sPath===this.oApplicationFacade.evaluationContexts[i]){this.oApplicationFacade.evaluationIndex=i;break}}sap.suite.smartbusiness.utils.replaceHash({action:"SBWorkspace",route:"evalDetail",context:(this.getView().contextPath+"/"+e.getParameter("listItem").getBindingContext().sPath.substring(1))})},onAfterIndicatorContext:function(c){var t=this;t.updateFooterButtons(c)},getAllFooterButtons:function(){var t=this;var b=[{id:"addEval",sId:"addEvaluationButton",sI18nBtnTxt:"ADD_EVALUATION",onBtnPressed:function(e){sap.suite.smartbusiness=sap.suite.smartbusiness||{};sap.suite.smartbusiness.modelerAppCache=sap.suite.smartbusiness.modelerAppCache||{};sap.suite.smartbusiness.modelerAppCache.createSBKPIEvaluation=sap.suite.smartbusiness.modelerAppCache.createSBKPIEvaluation||{};sap.suite.smartbusiness.modelerAppCache.createSBKPIEvaluation.appFromWorkspace=true;sap.suite.smartbusiness.utils.appToAppNavigation({action:"createSBKPIEvaluation",route:"addEvaluation",context:(t.getView().getBindingContext().getPath())})},},{sId:"favouriteToggleButton",sI18nBtnTxt:"ADD_FAVOURITE",onBtnPressed:function(e){var p="/FAVOURITES";var c=t.getView().getBindingContext().getObject();var d=t.oApplicationFacade.getODataModel();var a={ID:c.ID,TYPE:c.ENTITY_TYPE,USER_ID:t.oApplicationFacade.currentLogonHanaUser,MANUAL_ENTRY:1,LAST_WORKED_ON:null};if(c.MANUAL_ENTRY){sap.suite.smartbusiness.utils.remove(sap.suite.smartbusiness.utils.serviceUrl("INDICATOR_FAVOURITE_SERVICE_URI"),a,function(f){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("FAVOURITE_IN_DELETE_SUCCESS_KPI_OPI"));d.refresh();c.MANUAL_ENTRY=0;t.updateFooterButtons(c)},function(f){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("FAVOURITE_IN_DELETE_ERROR_KPI_OPI"),f.responseText)})}else if(c.MANUAL_ENTRY==0){sap.suite.smartbusiness.utils.update(sap.suite.smartbusiness.utils.serviceUrl("INDICATOR_FAVOURITE_SERVICE_URI"),a,null,function(f){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("FAVOURITE_IN_SUCCESS_KPI_OPI"));d.refresh();c.MANUAL_ENTRY=1;t.updateFooterButtons(c)},function(f){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("FAVOURITE_KPI_OPI_ERROR"),f.responseText)})}else if(c.MANUAL_ENTRY==null){sap.suite.smartbusiness.utils.create(sap.suite.smartbusiness.utils.serviceUrl("INDICATOR_FAVOURITE_SERVICE_URI"),a,null,function(f){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("FAVOURITE_IN_SUCCESS_KPI_OPI"));d.refresh();c.MANUAL_ENTRY=1;t.updateFooterButtons(c)},function(f){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("FAVOURITE_KPI_OPI_ERROR"),f.responseText)})}}},{sId:"activateButton",sI18nBtnTxt:"ACTIVATE",onBtnPressed:function(e){var a="ACTIVE_INDICATORS";var p={};var c=[];var P=t.getView().getBindingContext().sPath;p.ID=P.substring((P.indexOf("'")+1),P.lastIndexOf("'"));c.push(p);t.oApplicationFacade.getODataModel().read(("/INDICATOR_TEXTS?$filter=ID eq '"+t.contextIndicatorId+"' and IS_ACTIVE eq 0 and TITLE ne ''"),null,null,false,function(d){if(d&&d.results&&d.results.length){var O=t.oApplicationFacade.getODataModel();sap.suite.smartbusiness.utils.create(sap.suite.smartbusiness.utils.serviceUrl("ACTIVATE_INDICATOR_SERVICE_URI"),c,null,function(d){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("ACTIVATE_KPI_OPI_SUCCESS"));sap.suite.smartbusiness.utils.replaceHash({hash:window.location.hash.replace("IS_ACTIVE=0","IS_ACTIVE=1")},true);O.refresh()},function(f){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ACTIVATE_KPI_OPI_ERROR"),f.responseText)})}else{sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_KPI_OPI_TITLE"))}},function(){})}},{id:"editBut",sId:"editButton",sI18nBtnTxt:"EDIT",onBtnPressed:function(e){var c=t.getView().getBindingContext().getPath();c=(t.getView().getBindingContext().getObject().COUNTER==2)?c.replace("IS_ACTIVE=1","IS_ACTIVE=0"):c;c=c.replace("INDICATORS_MODELER","INDICATORS");sap.suite.smartbusiness=sap.suite.smartbusiness||{};sap.suite.smartbusiness.modelerAppCache=sap.suite.smartbusiness.modelerAppCache||{};sap.suite.smartbusiness.modelerAppCache.createSBKPI=sap.suite.smartbusiness.modelerAppCache.createSBKPI||{};sap.suite.smartbusiness.modelerAppCache.createSBKPI.appFromWorkspace=true;if(t.getView().getBindingContext().getObject().COUNTER==2){sap.suite.smartbusiness.utils.appToAppNavigation({action:"createSBKPI",route:"editDraftKpi",context:(c)})}else if(t.getView().getBindingContext().getObject().COUNTER==1){sap.suite.smartbusiness.utils.appToAppNavigation({action:"createSBKPI",route:"editKpi",context:(c)})}}},{sId:"deleteButton",sI18nBtnTxt:"DELETE_BUTTON_TEXT",onBtnPressed:function(e){if(!(sap.m.MessageBox)){jQuery.sap.require("sap.m.MessageBox")}sap.m.MessageBox.show(t.oApplicationFacade.getResourceBundle().getText("WARNING_SINGLE_INDICATOR_DELETE_KPI_OPI"),"sap-icon://hint",t.oApplicationFacade.getResourceBundle().getText("DELETE_BUTTON_TEXT"),[sap.m.MessageBox.Action.OK,sap.m.MessageBox.Action.CANCEL],function(e){if(e=="OK"){var a=t.getView().getBindingContext().sPath.substring(1).replace("INDICATORS_MODELER","INDICATORS");var p=[];p.push({ID:t.getView().getBindingContext().getObject().ID,IS_ACTIVE:t.getView().getBindingContext().getObject().IS_ACTIVE});var O=t.oApplicationFacade.getODataModel();sap.suite.smartbusiness.utils.remove(sap.suite.smartbusiness.utils.serviceUrl("INDICATOR_SERVICE_URI"),p,function(d){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("DELETE_KPI_OPI_SUCCESS"));O.refresh();sap.suite.smartbusiness.utils.replaceHash({hash:window.location.hash.substr(0,window.location.hash.indexOf("&/"))},true)},function(c){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("DELETE_KPI_OPI_ERROR"),c.responseText)})}if(e=="CANCEL"){}})}},{sId:"duplicateButton",sI18nBtnTxt:"DUPLICATE",onBtnPressed:function(e){sap.suite.smartbusiness=sap.suite.smartbusiness||{};sap.suite.smartbusiness.modelerAppCache=sap.suite.smartbusiness.modelerAppCache||{};sap.suite.smartbusiness.modelerAppCache.createSBKPI=sap.suite.smartbusiness.modelerAppCache.createSBKPI||{};sap.suite.smartbusiness.modelerAppCache.createSBKPI.appFromWorkspace=true;sap.suite.smartbusiness.utils.appToAppNavigation({action:"createSBKPI",route:"duplicateKpi",context:(t.getView().getBindingContext().getPath().replace("INDICATORS_MODELER","INDICATORS"))})}}];return b},updateFooterButtons:function(i){i=i||this.getView().getBindingContext().getObject();var f=this.getAllFooterButtons();this.oHeaderFooterOptions.buttonList=[];if((i.COUNTER==2)||(i.IS_ACTIVE)){this.oHeaderFooterOptions.oEditBtn=f[0]}if(i.MANUAL_ENTRY){f[1].sI18nBtnTxt=this.oApplicationFacade.getResourceBundle().getText("REMOVE_FAVOURITE")}else{f[1].sI18nBtnTxt=this.oApplicationFacade.getResourceBundle().getText("ADD_FAVOURITE")}this.oHeaderFooterOptions.buttonList.push(f[1]);if(!(i.IS_ACTIVE)){this.oHeaderFooterOptions.oEditBtn=f[2]}this.oHeaderFooterOptions.buttonList.push(f[5]);if(i.COUNTER==2){f[3].sI18nBtnTxt=this.oApplicationFacade.getResourceBundle().getText("EDIT_DRAFT")}else{f[3].sI18nBtnTxt=this.oApplicationFacade.getResourceBundle().getText("EDIT")}this.oHeaderFooterOptions.buttonList.push(f[3]);this.oHeaderFooterOptions.buttonList.push(f[4]);this.setHeaderFooterOptions(this.oHeaderFooterOptions)}});
