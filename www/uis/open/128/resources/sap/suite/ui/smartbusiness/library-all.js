/*!
* SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2013 SAP SE. All rights reserved
*/
sap.ui.controller("sap.suite.ui.smartbusiness.designtime.association.Main",{onInit:function(){jQuery.sap.require("sap.ca.scfld.md.Startup");sap.ca.scfld.md.Startup.init('sap.suite.ui.smartbusiness.designtime.association',this)},onExit:function(){}});sap.ui.controller("sap.suite.ui.smartbusiness.designtime.authorization.Main",{onInit:function(){jQuery.sap.require("sap.ca.scfld.md.Startup");sap.ca.scfld.md.Startup.init('sap.suite.ui.smartbusiness.designtime.authorization',this)},onExit:function(){}});sap.ui.controller("sap.suite.ui.smartbusiness.designtime.drilldown.Main",{onInit:function(){jQuery.sap.require("sap.ca.scfld.md.Startup");sap.ca.scfld.md.Startup.init('sap.suite.ui.smartbusiness.designtime.drilldown',this)}});sap.ui.controller("sap.suite.ui.smartbusiness.designtime.evaluation.Main",{onInit:function(){jQuery.sap.require("sap.ca.scfld.md.Startup");sap.ca.scfld.md.Startup.init('sap.suite.ui.smartbusiness.designtime.evaluation',this)}});sap.ui.controller("sap.suite.ui.smartbusiness.designtime.evaluation.view.createEvalTargetThresholdTrendInput",{onBeforeRendering:function(){var t=this;this.parentController=this.getView().getViewData().controller;this.oApplicationFacade=this.parentController.oApplicationFacade;this.oResourceBundle=this.oApplicationFacade.getResourceBundle();this.getView().getModel().getData().VALUES_SOURCE=this.getView().byId("valueTypeSelect").getSelectedKey();if(this.getView().getModel().getData().TREND){this.getView().byId('applyTrendCheckBox').setSelected(true)}else{this.getView().byId('applyTrendCheckBox').setSelected(false)}this.createTrendThresholdLayout()},openMeasureSelectDialog:function(e){var t=this;this.valueType=e.getSource().getCustomData()[0].getKey();var d=this.parentController.getView().getModel().getData().ODATA_URL;var D=this.parentController.getView().getModel().getData().ODATA_ENTITYSET;if(!(d&&D)){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_WRONG_ENTITY_SET"));return}else{var m=this.populateMeasure(d,D);var a=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_MEASURE"),noDataText:t.oResourceBundle.getText("NO_DATA_FOUND"),items:{path:"/measures",template:new sap.m.StandardListItem({title:"{measureName}",})},confirm:function(e){switch(t.valueType){case"REFERENCE_VALUE":t.getView().getModel().setProperty("/REFERENCE_VALUE",e.getParameter("selectedItem").getProperty("title"));break;case"CRITICALHIGH":t.getView().getModel().setProperty("/CRITICALHIGH",e.getParameter("selectedItem").getProperty("title"));break;case"WARNINGHIGH":t.getView().getModel().setProperty("/WARNINGHIGH",e.getParameter("selectedItem").getProperty("title"));break;case"TARGET":t.getView().getModel().setProperty("/TARGET",e.getParameter("selectedItem").getProperty("title"));break;case"WARNINGLOW":t.getView().getModel().setProperty("/WARNINGLOW",e.getParameter("selectedItem").getProperty("title"));break;case"CRITICALLOW":t.getView().getModel().setProperty("/CRITICALLOW",e.getParameter("selectedItem").getProperty("title"));break;case"TREND":t.getView().getModel().setProperty("/TREND",e.getParameter("selectedItem").getProperty("title"));break}},liveChange:function(e){var s=e.getParameter("value");var f=new sap.ui.model.Filter("measureName",sap.ui.model.FilterOperator.Contains,s);var b=e.getSource().getBinding("items");b.filter([f],false)}});a.setModel(m);a.open()}},validateQueryServiceURI:function(d){d=jQuery.trim(d);if(!jQuery.sap.startsWith(d,"/")){d="/"+d}if(jQuery.sap.endsWith(d,"/")){d=d.substring(0,d.length-1)}return d},populateMeasure:function(d,e){d=this.validateQueryServiceURI(d)+"";e=e+"";var m=[],a=[],o={};var i;m=sap.suite.smartbusiness.odata.getAllMeasures(d,e);for(i=0;i<m.length;i++){o={};o.measureName=m[i];a.push(o)}var M=new sap.ui.model.json.JSONModel();M.setData({measures:a});return M},createTrendThresholdLayout:function(){var t=this;var v=this.getView().getModel().getData();if(v){this.createTrendLayout();switch(v.GOAL_TYPE){case"MA":t.createLayoutForMaximizingKPI();this.getView().byId('kpiGoalTypeImage').setSrc("../../resources/sap/suite/ui/smartbusiness/designtime/evaluation/img/Maximizing.png");this.getView().byId('kpiGoalTypeLabel').setText(t.oResourceBundle.getText("KPI_GOAL_TYPE_MAXIMIZING"));this.getView().byId('criticalLowLabel').setText(t.oResourceBundle.getText("CRITICAL"));this.getView().byId('warningLowLabel').setText(t.oResourceBundle.getText("WARNING"));this.getView().byId('criticalHighLabel').setVisible(false);this.getView().byId('warningHighLabel').setVisible(false);this.getView().byId('evaluationCriticalHigh').setVisible(false);this.getView().byId('evaluationWarningHigh').setVisible(false);break;case"MI":t.createLayoutForMinimizingKPI();this.getView().byId('kpiGoalTypeImage').setSrc("../../resources/sap/suite/ui/smartbusiness/designtime/evaluation/img/Minimizing.png");this.getView().byId('kpiGoalTypeLabel').setText(t.oResourceBundle.getText("KPI_GOAL_TYPE_MINIMIZING"));this.getView().byId('criticalHighLabel').setText(t.oResourceBundle.getText("CRITICAL"));this.getView().byId('warningHighLabel').setText(t.oResourceBundle.getText("WARNING"));this.getView().byId('criticalLowLabel').setVisible(false);this.getView().byId('warningLowLabel').setVisible(false);this.getView().byId('evaluationCriticalLow').setVisible(false);this.getView().byId('evaluationWarningLow').setVisible(false);break;case"RA":t.createLayoutForRangeKPI();this.getView().byId('kpiGoalTypeImage').setSrc("../../resources/sap/suite/ui/smartbusiness/designtime/evaluation/img/Range.png");this.getView().byId('criticalLowLabel').setText(t.oResourceBundle.getText("CRITICAL_LOW"));this.getView().byId('warningLowLabel').setText(t.oResourceBundle.getText("WARNING_LOW"));this.getView().byId('criticalHighLabel').setText(t.oResourceBundle.getText("CRITICAL_HIGH"));this.getView().byId('warningHighLabel').setText(t.oResourceBundle.getText("WARNING_HIGH"));this.getView().byId('kpiGoalTypeLabel').setText(t.oResourceBundle.getText("KPI_GOAL_TYPE_RANGE"));break}}},createLayoutForMaximizingKPI:function(){var t=this;switch(this.getView().byId('valueTypeSelect').getSelectedKey()){case"MEASURE":t.getView().byId('evaluationCriticalLow').setShowValueHelp(true);t.getView().byId('evaluationWarningLow').setShowValueHelp(true);t.getView().byId('evaluationTarget').setShowValueHelp(true);t.getView().byId('evaluationReferenceValue').setShowValueHelp(true);break;case"FIXED":t.getView().byId('evaluationCriticalLow').setShowValueHelp(false);t.getView().byId('evaluationWarningLow').setShowValueHelp(false);t.getView().byId('evaluationTarget').setShowValueHelp(false);t.getView().byId('evaluationReferenceValue').setShowValueHelp(false);break}},createLayoutForMinimizingKPI:function(){var t=this;switch(this.getView().byId('valueTypeSelect').getSelectedKey()){case"MEASURE":t.getView().byId('evaluationCriticalHigh').setShowValueHelp(true);t.getView().byId('evaluationWarningHigh').setShowValueHelp(true);t.getView().byId('evaluationTarget').setShowValueHelp(true);t.getView().byId('evaluationReferenceValue').setShowValueHelp(true);break;case"FIXED":t.getView().byId('evaluationCriticalHigh').setShowValueHelp(false);t.getView().byId('evaluationWarningHigh').setShowValueHelp(false);t.getView().byId('evaluationTarget').setShowValueHelp(false);t.getView().byId('evaluationReferenceValue').setShowValueHelp(false);break}},createLayoutForRangeKPI:function(){var t=this;switch(this.getView().byId('valueTypeSelect').getSelectedKey()){case"MEASURE":var m=jQuery.proxy(t.openMeasureSelectDialog,t);t.getView().byId('evaluationCriticalHigh').setShowValueHelp(true);t.getView().byId('evaluationWarningHigh').setShowValueHelp(true);t.getView().byId('evaluationCriticalLow').setShowValueHelp(true);t.getView().byId('evaluationWarningLow').setShowValueHelp(true);t.getView().byId('evaluationTarget').setShowValueHelp(true);t.getView().byId('evaluationReferenceValue').setShowValueHelp(true);break;case"FIXED":t.getView().byId('evaluationCriticalLow').setShowValueHelp(false);t.getView().byId('evaluationWarningLow').setShowValueHelp(false);t.getView().byId('evaluationCriticalHigh').setShowValueHelp(false);t.getView().byId('evaluationWarningHigh').setShowValueHelp(false);t.getView().byId('evaluationTarget').setShowValueHelp(false);t.getView().byId('evaluationReferenceValue').setShowValueHelp(false);break}},createMeasuresDialog:function(){var t=this;var d=this.parentController.getView().getModel().getData().ODATA_URL;var D=this.parentController.getView().getModel().getData().ODATA_ENTITYSET;if(!(d&&D)){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_WRONG_ENTITY_SET"));return}var m=this.populateMeasure(d,D);t.measuresDialog=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_MEASURE"),noDataText:t.oResourceBundle.getText("NO_DATA_FOUND"),multiSelect:true,items:{path:"/measures",template:new sap.m.StandardListItem({title:"{measureName}",})},confirm:function(e){var s=e.getParameter("selectedItems");for(var k in s){t.byId("additionalMeasures").addToken(new sap.m.Token({text:s[k].getTitle()}));t.measuresDialog.removeItem(s[k])}}});t.measuresDialog.setModel(m)},openAdditionalMeasures:function(e){var t=this;if(!t.measuresDialog){t.createMeasuresDialog()}var a=t.measuresDialog.getItems();var b=t.byId("additionalMeasures").getTokens();for(var i=0;i<b.length;i++){for(var j=0;j<a.length;j++){if(b[i].getText()===a[j].getTitle()){t.measuresDialog.removeItem(a[j])}}}t.measuresDialog.open()},multiMeasureTokenChange:function(e){var t=this;if(e.getParameter("type")=="removed"){if(!t.measuresDialog){t.createMeasuresDialog()}var a=e.getParameter("token");var m=[];m=t.measuresDialog.getModel().getData().measures;for(var i=0;i<m.length;i++){if(m[i].measureName===a.getText()){t.measuresDialog.addItem(new sap.m.StandardListItem({title:a.getText(),}))}}}var m=[];m=t.byId("additionalMeasures").getTokens();for(var i=0,l=m.length;i<l;i++){if(m[i].getText()==t.getView().getModel().getData().COLUMN_NAME){t.byId("additionalMeasures").setValueState("Error");return}else{t.byId("additionalMeasures").setValueState("None")}}},multiMeasureChange:function(v){var t=this;var m=[];m=t.byId("additionalMeasures").getValue().split(",");for(var i=0;i<m.length;i++){t.byId("additionalMeasures").setValue("");t.byId("additionalMeasures").addToken(new sap.m.Token({text:m[i]}))}m=t.byId("additionalMeasures").getTokens();if(m.length==0){t.byId("additionalMeasures").setValueState("None")}for(var i=0,l=m.length;i<l;i++){if(m[i].getText()==t.getView().getModel().getData().COLUMN_NAME){t.byId("additionalMeasures").setValueState("Error");return}else{t.byId("additionalMeasures").setValueState("None")}}},applyAdditionalMeasuresCheckBoxSelected:function(){var t=this;if(this.getView().byId('selectAdditionalMeasuresCheckBox').getSelected()){t.getView().byId('additionalMeasures').setVisible(true)}else{var b=new sap.m.Dialog({icon:"sap-icon://warning2",title:t.oResourceBundle.getText("WARNING"),state:"Warning",type:"Message",content:[new sap.m.Text({text:t.oResourceBundle.getText("ON_ADIITIONAL_MEASURES_DESELECT")})],beginButton:new sap.m.Button({text:t.oResourceBundle.getText("CONTINUE"),press:function(){var a=t.getView().byId('additionalMeasures').getTokens();for(var i=0;i<a.length;i++){if(t.measuresDialog){t.measuresDialog.addItem(new sap.m.StandardListItem({title:a[i].getText(),}))}}t.getView().byId('additionalMeasures').removeAllTokens();t.getView().byId('additionalMeasures').setVisible(false);b.close()}}),endButton:new sap.m.Button({text:t.oResourceBundle.getText("CANCEL"),press:function(){t.getView().byId('selectAdditionalMeasuresCheckBox').setSelected(true);b.close()}})});b.open()}},applyTrendCheckBoxSelected:function(){if(this.getView().byId('applyTrendCheckBox').getSelected()){this.getView().getModel().getData().TREND="";this.getView().getModel().updateBindings();this.getView().byId('trendLabel').setVisible(true);this.getView().byId('evaluationTrend').setVisible(true);this.createTrendLayout()}else{this.getView().getModel().getData().TREND="";this.getView().getModel().updateBindings();this.getView().byId('trendLabel').setVisible(false);this.getView().byId('evaluationTrend').setShowValueHelp(false);this.getView().byId('evaluationTrend').setVisible(false)}},createTrendLayout:function(){var t=this;if(this.getView().byId('applyTrendCheckBox').getSelected()){switch((this.getView().byId('valueTypeSelect').getSelectedKey()).toUpperCase()){case"MEASURE":t.getView().byId('evaluationTrend').setShowValueHelp(true);break;case"FIXED":t.getView().byId('evaluationTrend').setShowValueHelp(false);break;default:break}}else{t.getView().byId('trendLabel').setVisible(false);t.getView().byId('evaluationTrend').setShowValueHelp(false);t.getView().byId('evaluationTrend').setVisible(false)}},valueTypeSelectChange:function(){this.getView().getModel().getData().REFERENCE_VALUE="";this.getView().getModel().getData().CRITICALLOW="";this.getView().getModel().getData().WARNINGLOW="";this.getView().getModel().getData().TARGET="";this.getView().getModel().getData().WARNINGHIGH="";this.getView().getModel().getData().CRITICALHIGH="";this.getView().getModel().getData().TREND="";this.getView().getModel().updateBindings();this.createTrendThresholdLayout()}});sap.ui.controller("sap.suite.ui.smartbusiness.designtime.kpi.Main",{onInit:function(){jQuery.sap.require("sap.ca.scfld.md.Startup");sap.ca.scfld.md.Startup.init('sap.suite.ui.smartbusiness.designtime.kpi',this)}});sap.ui.controller("sap.suite.ui.smartbusiness.designtime.tools.migration.Main",{onInit:function(){jQuery.sap.require("sap.ca.scfld.md.Startup");sap.ca.scfld.md.Startup.init('sap.suite.ui.smartbusiness.designtime.tools.migration',this)}});sap.ui.controller("sap.suite.ui.smartbusiness.designtime.visualization.Main",{onInit:function(){jQuery.sap.require("sap.ca.scfld.md.Startup");sap.ca.scfld.md.Startup.init('sap.suite.ui.smartbusiness.designtime.visualization',this)},onExit:function(){}});sap.ui.controller("sap.suite.ui.smartbusiness.designtime.workspace.Main",{onInit:function(){jQuery.sap.require("sap.ca.scfld.md.Startup");sap.ca.scfld.md.Startup.init('sap.suite.ui.smartbusiness.designtime.workspace',this)},onExit:function(){}});sap.ui.controller("sap.suite.ui.smartbusiness.drilldown.view.Main",{onInit:function(){jQuery.sap.require("sap.ca.scfld.md.Startup");sap.ca.scfld.md.Startup.init('sap.suite.ui.smartbusiness.drilldown',this)}});jQuery.sap.declare('sap.suite.ui.smartbusiness.library-all');jQuery.sap.declare('sap.suite.ui.smartbusiness.designtime.association.Main.controller');jQuery.sap.declare('sap.suite.ui.smartbusiness.designtime.authorization.Main.controller');jQuery.sap.declare('sap.suite.ui.smartbusiness.designtime.drilldown.Main.controller');jQuery.sap.declare('sap.suite.ui.smartbusiness.designtime.drilldown.js.util');jQuery.sap.declare('sap.suite.ui.smartbusiness.designtime.evaluation.Main.controller');jQuery.sap.declare('sap.suite.ui.smartbusiness.designtime.evaluation.view.createEvalTargetThresholdTrendInput.controller');jQuery.sap.declare('sap.suite.ui.smartbusiness.designtime.kpi.Main.controller');jQuery.sap.declare('sap.suite.ui.smartbusiness.designtime.tools.migration.Main.controller');jQuery.sap.declare('sap.suite.ui.smartbusiness.designtime.visualization.Main.controller');jQuery.sap.declare('sap.suite.ui.smartbusiness.designtime.workspace.Main.controller');jQuery.sap.declare('sap.suite.ui.smartbusiness.drilldown.view.Main.controller');if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.association.Configuration')){jQuery.sap.declare("sap.suite.ui.smartbusiness.designtime.association.Configuration");jQuery.sap.require('sap.ca.scfld.md.ConfigurationBase');jQuery.sap.require('sap.ca.scfld.md.app.Application');sap.ca.scfld.md.ConfigurationBase.extend("sap.suite.ui.smartbusiness.designtime.association.Configuration",{oServiceParams:{serviceList:[{name:"SMART_BUSINESS",masterCollection:"INDICATORS_MODELER",serviceUrl:"/sap/hba/r/sb/core/odata/modeler/SMART_BUSINESS.xsodata/",isDefault:true,mockedDataSource:"",useBatch:false}]},getServiceList:function(){return this.getServiceParams().serviceList},getMasterKeyAttributes:function(){return["Id"]},getExcludedQueryStringParameters:function(){return["sap-client","sap-language"]},getHanaSystem:function(){var h=hasher||window.hasher;var a=h.getHashAsArray();if(a&&a.length&&a[0]){var b=a[0].substr(a[0].indexOf("?")+1).split("&");for(var i=0,l=b.length;i<l;i++){if(b[i]&&(b[i].indexOf("sap-system")!=-1)){return b[i].split("=")[1]}}}return""},getServiceParams:function(){if(sap.ushell&&sap.ushell.Container){var s=this.oServiceParams.serviceList[0].serviceUrl;this.oServiceParams.serviceList[0].serviceUrl=sap.ushell.Container.getService("URLParsing").addSystemToServiceUrl(s,this.getHanaSystem())}return this.oServiceParams},})};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.association.view.S2.controller')){jQuery.sap.declare('sap.suite.ui.smartbusiness.designtime.association.view.S2.controller');
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2013 SAP SE. All rights reserved
 */
jQuery.sap.require('sap.ca.scfld.md.controller.ScfldMasterController');sap.ca.scfld.md.controller.ScfldMasterController.extend("sap.suite.ui.smartbusiness.designtime.association.view.S2",{onInit:function(){var t=this;t.oApplicationFacade.getODataModel().setSizeLimit(100000);if(!(t.oApplicationFacade.currentLogonHanaUser)){this.oApplicationFacade.getODataModel().read("/SESSION_USER",null,null,true,function(d){t.oApplicationFacade.currentLogonHanaUser=(d.results&&d.results.length)?d.results[0].LOGON_USER:null},function(e){t.oApplicationFacade.currentLogonHanaUser=null;sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("YMSG_ERROR_RETRIEVING_DATA"),e.response.body)})}this.byId("list").getBinding("items").filter(new sap.ui.model.Filter("IS_ACTIVE",sap.ui.model.FilterOperator.EQ,1))},createFilterOptions:function(){var t=this;var f=new sap.m.ViewSettingsDialog({id:this.createId("filterOptionsDialog"),filterItems:[new sap.m.ViewSettingsFilterItem({text:t.oApplicationFacade.getResourceBundle().getText("ACTIVITY"),key:"activity",items:[new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("SELF_CREATED"),key:"self_created"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("RECENTLY_WORKED_UPON"),key:"recently_worked_upon"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("FAVOURITE"),key:"favorite"}),]})],confirm:function(e){t.setFiltering(e.getParameter("filterItems"))}});return f},createSortOptions:function(){var t=this;var s=new sap.m.ViewSettingsDialog({id:this.createId("sortOptionsDialog"),sortItems:[new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("BY_NEWEST"),key:"newest"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("BY_OLDEST"),key:"oldest"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("BY_TYPE"),key:"type"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("ALPHABETICALLY"),key:"alphabetically"})],confirm:function(e){if(e.getParameter("sortItem")){t.setSorting(e.getParameter("sortItem").getKey(),e.getParameter("sortDescending"))}else{t.setGrouping("workspace",true)}}});return s},createGroupOptions:function(){var t=this;var g=new sap.m.ViewSettingsDialog({id:this.createId("groupOptionsDialog"),groupItems:[new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("BY_WORKSPACE"),key:"workspace"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("BY_TYPE"),key:"type"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("BY_STATUS"),key:"status"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("BY_OWNER"),key:"owner"})],confirm:function(e){if(e.getParameter("groupItem")){t.setGrouping(e.getParameter("groupItem").getKey(),e.getParameter("groupDescending"))}else{t.setGrouping("workspace",true)}}});return g},getHeaderFooterOptions:function(){var t=this;return{sI18NMasterTitle:"MASTER_TITLE",onBack:function(){window.history.back()},oFilterOptions:{onFilterPressed:function(e){t.getView().filterOptionDialog=t.getView().filterOptionDialog||t.createFilterOptions();t.getView().filterOptionDialog.open()}},oSortOptions:{onSortPressed:function(e){t.getView().sortOptionDialog=t.getView().sortOptionDialog||t.createSortOptions();t.getView().sortOptionDialog.open()}},oGroupOptions:{onGroupPressed:function(e){t.getView().groupOptionDialog=t.getView().groupOptionDialog||t.createGroupOptions();t.getView().groupOptionDialog.open()}}}},formatTitle:function(t){return(t||"")},formatAssociationCount:function(s,t){if(s==null&&t==null){return 0}if(s==null){return parseInt(t)}if(t==null){return parseInt(s)}return(parseInt(s)+parseInt(t))},formatID:function(i,t){if(t=="KPI"){return(this.oApplicationFacade.getResourceBundle().getText(t,i))}else{return(this.oApplicationFacade.getResourceBundle().getText(t)+": "+i)}},formatOwnerName:function(o){return(this.oApplicationFacade.getResourceBundle().getText("ADDED_BY",o))},formatState:function(s){return(s?"ACTIVE":"DRAFT")},formatGroupName:function(c){var t=this;var i=c.getProperty("MANUAL_ENTRY");var g="";switch(i){case 1:g=t.oApplicationFacade.getResourceBundle().getText("MY_FAVOURITES");break;case 0:g=t.oApplicationFacade.getResourceBundle().getText("MY_LAST_WORKED_UPON");break;default:g=t.oApplicationFacade.getResourceBundle().getText("ALL_KPI_OPI")}return{key:g,text:g}},setGrouping:function(k,g){var t=this;g=g||false;var l=this.getView().byId("list");if(k=="type"){l.getBinding("items").sort([new sap.ui.model.Sorter("TYPE",g,function(c){return{key:c.getProperty("TYPE"),text:(c.getProperty("TYPE")+"S")}})])}else if(k=="status"){l.getBinding("items").sort([new sap.ui.model.Sorter("IS_ACTIVE",g,function(c){return{key:c.getProperty("IS_ACTIVE")?"ACTIVE":"DRAFT",text:c.getProperty("IS_ACTIVE")?t.oApplicationFacade.getResourceBundle().getText("ACTIVE_KPI_OPI"):t.oApplicationFacade.getResourceBundle().getText("DRAFT_KPI_OPI"),}})])}else if(k=="owner"){l.getBinding("items").sort([new sap.ui.model.Sorter("OWNER_NAME",g,function(c){var o=c.getProperty("OWNER_NAME");var a="";switch(o){case null:a=t.oApplicationFacade.getResourceBundle().getText("NO_OWNER");break;case"":a=t.oApplicationFacade.getResourceBundle().getText("NO_OWNER");break;default:a=o}return{key:a,text:a}})])}else if(k=="workspace"){l.getBinding("items").sort([new sap.ui.model.Sorter("MANUAL_ENTRY",g,function(c){var i=c.getProperty("MANUAL_ENTRY");var a="";switch(i){case 1:a=t.oApplicationFacade.getResourceBundle().getText("MY_FAVOURITES");break;case 0:a=t.oApplicationFacade.getResourceBundle().getText("MY_LAST_WORKED_UPON");break;default:a=t.oApplicationFacade.getResourceBundle().getText("ALL_KPI_OPI")}return{key:a,text:a}})])}},setFiltering:function(i){var t=this;var f=[];var l=this.getView().byId("list");var a={"drafts":(new sap.ui.model.Filter("IS_ACTIVE",sap.ui.model.FilterOperator.EQ,0)),"activated":(new sap.ui.model.Filter("IS_ACTIVE",sap.ui.model.FilterOperator.EQ,1)),"self_created":(new sap.ui.model.Filter("CREATED_BY",sap.ui.model.FilterOperator.EQ,t.oApplicationFacade.currentLogonHanaUser)),"recently_worked_upon":(new sap.ui.model.Filter("MANUAL_ENTRY",sap.ui.model.FilterOperator.EQ,0)),"favorite":(new sap.ui.model.Filter("MANUAL_ENTRY",sap.ui.model.FilterOperator.EQ,1))};f=sap.suite.smartbusiness.utils.getFilterArray(i,a);if(f.length){l.getBinding("items").filter(new sap.ui.model.Filter(f,true))}else{l.getBinding("items").filter(f)}},setSorting:function(k,g){var t=this;g=g||false;var l=t.getView().byId("list");if(k=="newest"){l.getBinding("items").sort([new sap.ui.model.Sorter("CREATED_ON",true,null)])}else if(k=="oldest"){l.getBinding("items").sort([new sap.ui.model.Sorter("CREATED_ON",false,null)])}else if(k=="type"){l.getBinding("items").sort([new sap.ui.model.Sorter("TYPE",g,null)])}else if(k=="alphabetically"){l.getBinding("items").sort([new sap.ui.model.Sorter("TITLE",g,null)])}},onExit:function(){var h=hasher||window.hasher;if(!(h.getHash())){sap.suite.smartbusiness.utils.backToHome()}},applySearchPatternToListItem:function(i,f){if(sap.ca.scfld.md.controller.ScfldMasterController.prototype.applySearchPatternToListItem.apply(this,arguments)){return true}else{}return false}})};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.association.view.S3.controller')){jQuery.sap.declare('sap.suite.ui.smartbusiness.designtime.association.view.S3.controller');jQuery.sap.require('sap.ca.scfld.md.controller.BaseDetailController');jQuery.sap.require('sap.m.MessageBox');sap.ca.scfld.md.controller.BaseDetailController.extend("sap.suite.ui.smartbusiness.designtime.association.view.S3",{onInit:function(){var t=this;var v=this.getView();this.oRouter.attachRouteMatched(function(e){if(e.getParameter("name")==="detail"){var c=new sap.ui.model.Context(v.getModel(),'/'+(e.getParameter("arguments").contextPath));v.setBindingContext(c);t.contextIndicatorId=v.getBindingContext().getProperty("ID")||e.getParameter("arguments").contextPath.split("(")[1].split(",")[0].split("=")[1].replace(/'/g,'');var m=new sap.ui.model.json.JSONModel();t.getView().byId("kpiAssociationTable").getBinding("items").filter(new sap.ui.model.Filter([new sap.ui.model.Filter("SOURCE_INDICATOR",sap.ui.model.FilterOperator.EQ,t.contextIndicatorId),new sap.ui.model.Filter("TARGET_INDICATOR",sap.ui.model.FilterOperator.EQ,t.contextIndicatorId)],false));t.getView().byId("tags").getBinding("items").filter(new sap.ui.model.Filter([new sap.ui.model.Filter("ID",sap.ui.model.FilterOperator.EQ,t.contextIndicatorId),new sap.ui.model.Filter("IS_ACTIVE",sap.ui.model.FilterOperator.EQ,1),new sap.ui.model.Filter("TYPE",sap.ui.model.FilterOperator.EQ,"IN")],true))}},this);this.oHeaderFooterOptions={bSuppressBookmarkButton:{},oEditBtn:{sI18nBtnTxt:"ADD_ASSOCIATION",onBtnPressed:function(e){sap.suite.smartbusiness.utils.replaceHash({action:"manageSBKPIAssociation",route:"associationCreate",context:t.getView().getBindingContext().sPath.substring(1)})}}};t.byId("idDirection").setColor(sap.ui.core.theming.Parameters.get("sapUiLightText"));t.byId("associationEdit").setColor(sap.ui.core.theming.Parameters.get("sapUiLightText"));t.byId("associationDelete").setColor(sap.ui.core.theming.Parameters.get("sapUiLightText"))},getHeaderFooterOptions:function(){return this.oHeaderFooterOptions},formatAssociationCount:function(s,t){var a=this;if(s==null&&t==null){return a.oApplicationFacade.getResourceBundle().getText("ASSOCIATIONS")+"(0)"}if(s==null){return a.oApplicationFacade.getResourceBundle().getText("ASSOCIATIONS")+"("+t+")"}if(t==null){return a.oApplicationFacade.getResourceBundle().getText("ASSOCIATIONS")+"("+s+")"}var c=(parseInt(s)+parseInt(t));return a.oApplicationFacade.getResourceBundle().getText("ASSOCIATIONS")+"("+c.toString()+")"},formatStatus:function(s){return((s)?this.oApplicationFacade.getResourceBundle().getText("STATUS_ACTIVE"):this.oApplicationFacade.getResourceBundle().getText("STATUS_DRAFT"))},formatGoalType:function(g){var a=null;switch(g){case'MA':a=this.oApplicationFacade.getResourceBundle().getText("MAXIMIZING");break;case'MI':a=this.oApplicationFacade.getResourceBundle().getText("MINIMIZING");break;case'RA':a=this.oApplicationFacade.getResourceBundle().getText("RANGE");break;default:a=this.oApplicationFacade.getResourceBundle().getText("NONE")}return a},formatTags:function(t){return((this.getView().byId("tags").getItems().length>1)?(', '+t):(t))},formatStatusOfAssociation:function(i,c){var t=this;if(c=="2"){var s=t.oApplicationFacade.getResourceBundle().getText("STATUS_ACTIVE")+","+t.oApplicationFacade.getResourceBundle().getText("STATUS_DRAFT");return s}if(i==0){return t.oApplicationFacade.getResourceBundle().getText("STATUS_NEW")}if(i==1){return t.oApplicationFacade.getResourceBundle().getText("STATUS_ACTIVE")}},formatProperties:function(n,v){var p=((this.getView().byId("assoProperties").getItems().length>1)?(", "+n+" : "+v):(n+" : "+v+","));return p},formatAssociationType:function(a){if(a=="SUPPORTING"){return this.oApplicationFacade.getResourceBundle().getText("SUPPORTING")}else{return this.oApplicationFacade.getResourceBundle().getText("CONFLICTING")}},formatArrowDirection:function(s){return((s==this.contextIndicatorId)?("sap-icon://arrow-right"):("sap-icon://arrow-left"))},formatTargetIndicatorText:function(s,t,a,b){var i=null;if(t==this.contextIndicatorId){i=a}else{i=b}return i},handleAssociationEdit:function(e){var t=this;var a;if(e.getSource().getBindingContext().getObject().COUNTER=="1"){a=e.getSource().getBindingContext().sPath.substring(1).replace("ASSOCIATIONS_MODELER","ASSOCIATIONS")}else{a=e.getSource().getBindingContext().sPath.substring(1).replace("ASSOCIATIONS_MODELER","ASSOCIATIONS").replace("IS_ACTIVE=1","IS_ACTIVE=0")}sap.suite.smartbusiness.utils.replaceHash({action:"manageSBKPIAssociation",route:"associationEdit",context:(t.getView().getBindingContext().sPath.substring(1).replace("INDICATORS_MODELER","INDICATORS")+"/"+a)})},handleAssociationDelete:function(e){var t=this;t.entity=e.getSource().getBindingContext().sPath.substring(1).replace("ASSOCIATIONS_MODELER","ASSOCIATIONS");t.entityObj=t.formOldObjectForAssociation(t.entity);var c=new sap.m.Dialog({title:t.oApplicationFacade.getResourceBundle().getText("DELETE"),type:"Message",content:[new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText("DELETE_ASSOCIATION")})],beginButton:new sap.m.Button({text:"Ok",press:function(E){c.close();var O=t.oApplicationFacade.getODataModel();sap.suite.smartbusiness.utils.remove(sap.suite.smartbusiness.utils.serviceUrl("ASSOCIATIONS_CUD"),t.entityObj,function(d){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("DELETION_SUCCESSFUL"));O.refresh()},function(a){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("DELETION_FAILED"))})}}),endButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("CANCEL"),press:function(){c.close()}})});c.open()},formOldObjectForAssociation:function(s){var t=this;var o={};o.TYPE=s.substring(s.indexOf("'",s.search("TYPE"))+1,s.indexOf("'",s.indexOf("'",s.search("TYPE"))+1));o.SOURCE_INDICATOR=s.substring(s.indexOf("'",s.search("SOURCE_INDICATOR"))+1,s.indexOf("'",s.indexOf("'",s.search("SOURCE_INDICATOR"))+1));o.TARGET_INDICATOR=s.substring(s.indexOf("'",s.search("TARGET_INDICATOR"))+1,s.indexOf("'",s.indexOf("'",s.search("TARGET_INDICATOR"))+1));o.IS_ACTIVE=parseInt(s.substring(s.indexOf("=",s.search("IS_ACTIVE"))+1,s.indexOf("=",s.search("IS_ACTIVE"))+2));return o},})};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.association.view.S4.controller')){jQuery.sap.declare('sap.suite.ui.smartbusiness.designtime.association.view.S4.controller');jQuery.sap.require('sap.ca.scfld.md.controller.BaseDetailController');jQuery.sap.includeStyleSheet("../../resources/sap/suite/ui/smartbusiness/designtime/association/view/nameValueTable.css");sap.ca.scfld.md.controller.BaseDetailController.extend("sap.suite.ui.smartbusiness.designtime.association.view.S4",{onInit:function(){var t=this;var v=this.getView();this.oRouter.attachRouteMatched(function(e){t.viewMode=e.getParameter("name");t.directionChange=0;t.getView().byId("associationPropertyValue").setValueState("None");t.getView().byId("associationPropertyName").setValueState("None");if(e.getParameter("name")==="associationEdit"){var c=new sap.ui.model.Context(v.getModel(),'/'+(e.getParameter("arguments").contextPath));t.associationContext=new sap.ui.model.Context(v.getModel(),'/'+(e.getParameter("arguments").associationPath));v.sourceIndicatorContexts={contextPath:e.getParameter("arguments").contextPath,context:c};v.associationContexts={contextPath:e.getParameter("arguments").associationPath,context:t.associationContext};v.setBindingContext(t.associationContext);t.modelForSelectAssociation=new sap.ui.model.json.JSONModel();t.byId("associationTypeSelect").setModel(t.modelForSelectAssociation,"associationSelectModel");t.oApplicationFacade.getODataModel().read(v.associationContexts.contextPath,null,null,false,function(a){t.modelForSelectAssociation.setData({TITLE:a.TITLE,TYPE:a.TYPE});t.associationData=a;t.initialAssociationType=a.TYPE},function(){});t.sourceIndicatorModel=new sap.ui.model.json.JSONModel();t.byId("sourceIndicatorContent").setModel(t.sourceIndicatorModel,"sourceIndicator");t.targetIndicatorModel=new sap.ui.model.json.JSONModel();t.byId("targetIndicatorContent").setModel(t.targetIndicatorModel,"targetIndicator");t.associationPropertiesModel=new sap.ui.model.json.JSONModel();t.byId("propertyNameValueBox").setModel(t.associationPropertiesModel,"associationProp");if(c.getObject()){t.contextIndicatorId=v.getBindingContext().getProperty("ID")}else{this.oApplicationFacade.getODataModel().read(v.sourceIndicatorContexts.contextPath,null,null,true,function(a){t.contextIndicatorId=a.ID},function(){})}t.oApplicationFacade.getODataModel().read(v.associationContexts.contextPath+"/SOURCE_INDICATOR_INFO",null,null,false,function(a){if(a.results&&a.results.length){t.sourceIndicatorModel.setData({INDICATOR:a.results});t.byId("sourceIndicatorText").setText(t.oApplicationFacade.getResourceBundle().getText("CURRENT_KPI_OPI")+": "+(a.results[0].TITLE||""));t.initialSourceIndicatorId=a.results[0].ID}else{t.sourceIndicatorModel.setData({INDICATOR:a});t.byId("sourceIndicatorText").setText(t.oApplicationFacade.getResourceBundle().getText("CURRENT_KPI_OPI")+": "+(a.TITLE||""));t.initialSourceIndicatorId=a.ID}},function(){});t.oApplicationFacade.getODataModel().read(v.associationContexts.contextPath+"/TARGET_INDICATOR_INFO",null,null,false,function(a){if(a.results&&a.results.length){t.targetIndicatorModel.setData({INDICATOR:a.results});t.byId("selectedKpiOpiId").setValue(a.results[0].TITLE);t.initialTargetIndicatorId=a.results[0].ID}else{t.targetIndicatorModel.setData({INDICATOR:a});t.byId("selectedKpiOpiId").setValue(a.TITLE);t.initialTargetIndicatorId=a.ID}},function(){});t.oApplicationFacade.getODataModel().read(v.associationContexts.contextPath+"/PROPERTIES",null,null,true,function(a){t.associationPropertiesModel.setData({PROPERTIES:a.results});t.oldPropertiesList=$.extend(true,{},t.getView().byId('propertyNameValueBox').getModel("associationProp"))},function(){})}else if(e.getParameter("name")==="associationCreate"){t.sourceIndicatorModel=new sap.ui.model.json.JSONModel();t.byId("sourceIndicatorContent").setModel(t.sourceIndicatorModel,"sourceIndicator");t.associationData={};t.targetIndicatorModel=new sap.ui.model.json.JSONModel();t.targetIndicatorModel.setData({INDICATOR:[]});t.byId("targetIndicatorContent").setModel(t.targetIndicatorModel,"targetIndicator");t.associationPropertiesModel=new sap.ui.model.json.JSONModel();t.byId("propertyNameValueBox").setModel(t.associationPropertiesModel,"associationProp");t.associationPropertiesModel.setData({PROPERTIES:[]});t.oldPropertiesList=$.extend(true,{},t.associationPropertiesModel);this.byId("selectedKpiOpiId").setEditable(true);var c=new sap.ui.model.Context(v.getModel(),'/'+(e.getParameter("arguments").contextPath));t.associationContext=new sap.ui.model.Context(v.getModel(),'/'+(e.getParameter("arguments").associationPath));v.sourceIndicatorContexts={contextPath:e.getParameter("arguments").contextPath,context:c};v.associationContexts={contextPath:e.getParameter("arguments").associationPath,context:t.associationContext};v.setBindingContext(c);t.byId("selectedKpiOpiId").setValue("");if(c.getObject()){t.contextIndicatorId=v.getBindingContext().getProperty("ID");this.byId("sourceIndicatorText").setText(t.oApplicationFacade.getResourceBundle().getText("CURRENT_KPI_OPI")+": "+(v.getBindingContext().getProperty("TITLE")||""));t.sourceIndicatorModel.setData({INDICATOR:t.oApplicationFacade.getODataModel().oData[e.getParameter("arguments").contextPath]})}else{this.oApplicationFacade.getODataModel().read(v.sourceIndicatorContexts.contextPath,null,null,true,function(a){t.byId("sourceIndicatorText").setText(t.oApplicationFacade.getResourceBundle().getText("CURRENT_KPI_OPI")+": "+(a.TITLE||""));t.sourceIndicatorModel.setData({INDICATOR:a});t.contextIndicatorId=a.ID},function(){})}}},this);this.oHeaderFooterOptions={bSuppressBookmarkButton:{},onBack:function(){var b=new sap.m.Dialog({icon:"sap-icon://warning2",title:t.oApplicationFacade.getResourceBundle().getText("WARNING"),state:"Error",type:"Message",content:[new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText("ON_BACK_WARNING")})],beginButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("CONTINUE"),press:function(){if(t.viewMode=="associationEdit"){sap.suite.smartbusiness.utils.replaceHash({action:"manageSBKPIAssociation",route:"detail",context:t.getView().sourceIndicatorContexts.contextPath.replace("INDICATORS","INDICATORS_MODELER")})}else if(t.viewMode=="associationCreate"){sap.suite.smartbusiness.utils.replaceHash({action:"manageSBKPIAssociation",route:"detail",context:t.getView().sourceIndicatorContexts.contextPath})}}}),endButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("CANCEL"),press:function(){b.close()}})});if(t.anythingChangedOnBack()==true){b.open()}else{if(t.viewMode=="associationEdit"){sap.suite.smartbusiness.utils.replaceHash({action:"manageSBKPIAssociation",route:"detail",context:t.getView().sourceIndicatorContexts.contextPath.replace("INDICATORS","INDICATORS_MODELER")})}else if(t.viewMode=="associationCreate"){sap.suite.smartbusiness.utils.replaceHash({action:"manageSBKPIAssociation",route:"detail",context:t.getView().sourceIndicatorContexts.contextPath})}}},oEditBtn:{sId:"SAVE",sI18nBtnTxt:"SAVE",onBtnPressed:function(e){v.getController().saveAndExit(0)}},buttonList:[{sI18nBtnTxt:"SAVE_AND_ACTIVATE",onBtnPressed:function(e){v.getController().saveAndExit(1);v.getController().activateAssociation()}},{sI18nBtnTxt:"SAVE_CREATE_NEW",onBtnPressed:function(e){v.getController().saveAndCreateNew()}},{sI18nBtnTxt:"CANCEL",onBtnPressed:function(e){var b=new sap.m.Dialog({icon:"sap-icon://warning2",title:t.oApplicationFacade.getResourceBundle().getText("WARNING"),state:"Error",type:"Message",content:[new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText("ON_BACK_WARNING")})],beginButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("CONTINUE"),press:function(){v.getController().cancel()}}),endButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("CANCEL"),press:function(){b.close()}})});if(t.anythingChangedOnBack()==true){b.open()}else{if(t.viewMode=="associationEdit"){sap.suite.smartbusiness.utils.replaceHash({action:"manageSBKPIAssociation",route:"detail",context:t.getView().sourceIndicatorContexts.contextPath.replace("INDICATORS","INDICATORS_MODELER")})}else if(t.viewMode=="associationCreate"){sap.suite.smartbusiness.utils.replaceHash({action:"manageSBKPIAssociation",route:"detail",context:t.getView().sourceIndicatorContexts.contextPath})}}}}]};var d=t.oApplicationFacade.getResourceBundle().getText("DELETE")+" "+t.oApplicationFacade.getResourceBundle().getText("DRAFT");this.oHeaderFooterOptionsForDraft={bSuppressBookmarkButton:{},onBack:function(){var b=new sap.m.Dialog({icon:"sap-icon://warning2",title:t.oApplicationFacade.getResourceBundle().getText("WARNING"),state:"Error",type:"Message",content:[new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText("ON_BACK_WARNING")})],beginButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("CONTINUE"),press:function(){if(t.viewMode=="associationEdit"){sap.suite.smartbusiness.utils.replaceHash({action:"manageSBKPIAssociation",route:"detail",context:t.getView().sourceIndicatorContexts.contextPath.replace("INDICATORS","INDICATORS_MODELER")})}else if(t.viewMode=="associationCreate"){sap.suite.smartbusiness.utils.replaceHash({action:"manageSBKPIAssociation",route:"detail",context:t.getView().sourceIndicatorContexts.contextPath})}}}),endButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("CANCEL"),press:function(){b.close()}})});if(t.anythingChangedOnBack()==true){b.open()}else{if(t.viewMode=="associationEdit"){sap.suite.smartbusiness.utils.replaceHash({action:"manageSBKPIAssociation",route:"detail",context:t.getView().sourceIndicatorContexts.contextPath.replace("INDICATORS","INDICATORS_MODELER")})}else if(t.viewMode=="associationCreate"){sap.suite.smartbusiness.utils.replaceHash({action:"manageSBKPIAssociation",route:"detail",context:t.getView().sourceIndicatorContexts.contextPath})}}},oEditBtn:{sI18nBtnTxt:"SAVE",onBtnPressed:function(e){v.getController().saveAndExit(0)}},buttonList:[{sI18nBtnTxt:"SAVE_AND_ACTIVATE",onBtnPressed:function(e){v.getController().saveAndExit(1);v.getController().activateAssociation()}},{sI18nBtnTxt:"SAVE_CREATE_NEW",onBtnPressed:function(e){v.getController().saveAndCreateNew()}},{sI18nBtnTxt:"CANCEL",onBtnPressed:function(e){var b=new sap.m.Dialog({icon:"sap-icon://warning2",title:t.oApplicationFacade.getResourceBundle().getText("WARNING"),state:"Error",type:"Message",content:[new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText("ON_BACK_WARNING")})],beginButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("CONTINUE"),press:function(){v.getController().cancel()}}),endButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("CANCEL"),press:function(){b.close()}})});b.open()}},{sI18nBtnTxt:d,onBtnPressed:function(e){var c=new sap.m.Dialog({title:d,type:"Message",beginButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("OK"),press:function(){c.close();t.deleteDraft();if(t.viewMode=="associationEdit"){sap.suite.smartbusiness.utils.replaceHash({action:"manageSBKPIAssociation",route:"detail",context:t.getView().sourceIndicatorContexts.contextPath.replace("INDICATORS","INDICATORS_MODELER")})}}}),endButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("CANCEL"),press:function(){c.close()}})});c.open()}}]};t.byId("directionArrowAssociation").setColor(sap.ui.core.theming.Parameters.get("sapUiLightText"));t.byId("deleteAssociationProp").setColor(sap.ui.core.theming.Parameters.get("sapUiLightText"))},formOldAssociationObject:function(s){var t=this;var o={};o.TYPE=s.substring(s.indexOf("'",s.search("TYPE"))+1,s.indexOf("'",s.indexOf("'",s.search("TYPE"))+1));o.SOURCE_INDICATOR=s.substring(s.indexOf("'",s.search("SOURCE_INDICATOR"))+1,s.indexOf("'",s.indexOf("'",s.search("SOURCE_INDICATOR"))+1));o.TARGET_INDICATOR=s.substring(s.indexOf("'",s.search("TARGET_INDICATOR"))+1,s.indexOf("'",s.indexOf("'",s.search("TARGET_INDICATOR"))+1));o.IS_ACTIVE=parseInt(s.substring(s.indexOf("=",s.search("IS_ACTIVE"))+1,s.indexOf("=",s.search("IS_ACTIVE"))+2));return o},anythingChangedOnBack:function(){var t=this;var p=(t.viewMode!="associationCreate")?t.associationContext.sPath:null;var o=p?t.formOldAssociationObject(p):{TARGET_INDICATOR:"",SOURCE_INDICATOR:"",TYPE:this.byId("associationTypeSelect").getItems()[0].getKey(),IS_ACTIVE:0};var n=t.getView().byId('propertyNameValueBox').getModel("associationProp").getData().PROPERTIES;var a=t.oldPropertiesList?t.oldPropertiesList.getData().PROPERTIES:[];var u=sap.suite.smartbusiness.utils.dirtyBitCheck({oldPayload:a,newPayload:n,objectType:"ASSOCIATION_PROPERTIES"});if(o.TARGET_INDICATOR!=(t.targetIndicatorModel.getData().INDICATOR.ID||"")||t.directionChange==1||o.TYPE!=t.byId("associationTypeSelect").getSelectedItem().getKey()||u.updates.length>0||u.deletes.length>0){return true}else{return false}},deleteDraft:function(){var t=this;var p=t.associationContext.sPath;var d=t.formOldAssociationObject(p);sap.suite.smartbusiness.utils.remove(sap.suite.smartbusiness.utils.serviceUrl("ASSOCIATIONS_CUD"),d,function(a){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("DELETION_SUCCESSFUL"))},function(e){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("DELETION_FAILED"))})},changeValueState:function(){var t=this;t.getView().byId("associationPropertyValue").setValueState("None");t.getView().byId("associationPropertyName").setValueState("None")},getHeaderFooterOptions:function(){var t=this;var p=t.associationContext.sPath;var I=parseInt(p.charAt(p.indexOf("=",p.search("IS_ACTIVE"))+1));if(t.viewMode=="associationEdit"){if(I==1){return this.oHeaderFooterOptions}else{return this.oHeaderFooterOptionsForDraft}}else if(t.viewMode=="associationCreate"){return this.oHeaderFooterOptions}},handleAssociationTypeChange:function(){var t=this;var m=this.getView().byId('propertyNameValueBox').getModel("associationProp");m.getData().PROPERTIES=m.getData().PROPERTIES||[];for(i=0;i<m.getData().PROPERTIES.length;i++){if(m.getData().PROPERTIES[i].TYPE=="SUPPORTING"){m.getData().PROPERTIES[i].TYPE="CONFLICTING"}else{m.getData().PROPERTIES[i].TYPE="SUPPORTING"}}m.updateBindings()},handleReverseAssociationDirection:function(){var t=this;if(t.directionChange==0){t.directionChange=1}else{t.directionChange=0}var i,a;var s=this.byId("sourceIndicatorContent").getModel("sourceIndicator").getData().INDICATOR;var b=this.byId("targetIndicatorContent").getModel("targetIndicator").getData().INDICATOR;if(b.length==0){this.getView().byId("selectedKpiOpiId").setValueState("Error");sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("TARGET_KPI_NOT_SELECTED"))}else{this.byId("sourceIndicatorContent").getModel("sourceIndicator").setData({INDICATOR:b});this.byId("targetIndicatorContent").getModel("targetIndicator").setData({INDICATOR:s});var m=this.getView().byId('propertyNameValueBox').getModel("associationProp");m.getData().PROPERTIES=m.getData().PROPERTIES||[];for(i=0;i<m.getData().PROPERTIES.length;i++){a=null;a=m.getData().PROPERTIES[i].SOURCE_INDICATOR;m.getData().PROPERTIES[i].SOURCE_INDICATOR=m.getData().PROPERTIES[i].TARGET_INDICATOR;m.getData().PROPERTIES[i].TARGET_INDICATOR=a}m.updateBindings()}},listAllKpis:function(){var t=this;t.hanaViewValueHelpDialog=t.hanaViewValueHelpDialog||new sap.m.SelectDialog({title:t.oApplicationFacade.getResourceBundle().getText("SELECT_VIEW"),noDataText:t.oApplicationFacade.getResourceBundle().getText("NO_DATA_FOUND"),items:{path:"/INDICATORS_MODELER",template:new sap.m.ObjectListItem({title:"{TITLE}",number:"{parts:[{path:'ASSOCIATION_SOURCE_COUNT'},{path:'ASSOCIATION_TARGET_COUNT'}], formatter:'.formatAssociationCount'}",firstStatus:new sap.m.ObjectStatus({text:t.oApplicationFacade.getResourceBundle().getText("ASSOCIATIONS"),}),attributes:[new sap.m.ObjectAttribute({text:"{ID}"})]}),},confirm:function(e){var i;if(t.viewMode==="associationEdit"){}else if(t.viewMode==="associationCreate"){if(t.getView().byId("selectedKpiOpiId").getValueState()==="Error"){t.getView().byId("selectedKpiOpiId").setValueState("None")}}t.byId("selectedKpiOpiId").setValue(e.getParameter("selectedItem").getBindingContext().getProperty("TITLE"));t.targetIndicatorModel.setData({INDICATOR:e.getParameter("selectedItem").getBindingContext().getObject()});t.targetIndicatorModel.updateBindings();var m=t.getView().byId('propertyNameValueBox').getModel("associationProp");m.getData().PROPERTIES=m.getData().PROPERTIES||[];for(i=0;i<m.getData().PROPERTIES.length;i++){m.getData().PROPERTIES[i].TARGET_INDICATOR=e.getParameter("selectedItem").getBindingContext().getProperty("ID")}m.updateBindings()},liveChange:function(e){var s="'"+e.getParameter("value").toLowerCase()+"'";var F=new sap.ui.model.Filter("tolower(ID)",sap.ui.model.FilterOperator.Contains,s);var o=new sap.ui.model.Filter("tolower(TITLE)",sap.ui.model.FilterOperator.Contains,s);var a=new sap.ui.model.Filter("ID",sap.ui.model.FilterOperator.NE,t.contextIndicatorId);var b=new sap.ui.model.Filter("IS_ACTIVE",sap.ui.model.FilterOperator.EQ,1);var B=e.getSource().getBinding("items");var c=new sap.ui.model.Filter([F,o],false);var d=new sap.ui.model.Filter([a,b],true);B.filter(new sap.ui.model.Filter([c,d],true))}});t.hanaViewValueHelpDialog.setModel(t.oApplicationFacade.getODataModel());var f=[];f.push(new sap.ui.model.Filter("IS_ACTIVE",sap.ui.model.FilterOperator.EQ,1));f.push(new sap.ui.model.Filter("ID",sap.ui.model.FilterOperator.NE,t.contextIndicatorId));t.hanaViewValueHelpDialog.getBinding("items").filter(new sap.ui.model.Filter(f,true));t.hanaViewValueHelpDialog.open()},addNewProperty:function(){var t=this;var p=0;if(this.getView().byId("associationPropertyName").getValue()&&this.getView().byId("associationPropertyValue").getValue()){if(this.viewMode=="associationEdit"){this.isActiveValue=0}else if(this.viewMode=="associationCreate"){var a=this.byId("targetIndicatorContent").getModel("targetIndicator").getData().INDICATOR;if(a.length==0){this.getView().byId("selectedKpiOpiId").setValueState("Error");sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("TARGET_KPI_NOT_SELECTED"));return}this.isActiveValue=0}this.getView().byId("associationPropertyName").setValueState("None");if(this.getView().byId("associationPropertyValue").getValue()){this.getView().byId("associationPropertyValue").setValueState("None");var b=this.getView().byId('propertyNameValueBox').getModel("associationProp");b.getData().PROPERTIES=b.getData().PROPERTIES||[];for(var i=0;i<b.getData().PROPERTIES.length;i++){if(b.getData().PROPERTIES[i].NAME==this.getView().byId("associationPropertyName").getValue()&&b.getData().PROPERTIES[i].VALUE==this.getView().byId("associationPropertyValue").getValue()){p=1}}if(p==0){b.getData().PROPERTIES.push({NAME:this.getView().byId("associationPropertyName").getValue(),VALUE:this.getView().byId("associationPropertyValue").getValue(),TYPE:this.byId("associationTypeSelect").getSelectedItem().getKey(),SOURCE_INDICATOR:(this.byId("sourceIndicatorContent").getModel("sourceIndicator").getData().INDICATOR.ID||this.byId("sourceIndicatorContent").getModel("sourceIndicator").getData().INDICATOR[0].ID),TARGET_INDICATOR:(this.byId("targetIndicatorContent").getModel("targetIndicator").getData().INDICATOR.ID||this.byId("targetIndicatorContent").getModel("targetIndicator").getData().INDICATOR[0].ID),IS_ACTIVE:this.isActiveValue});b.updateBindings();this.getView().byId("associationPropertyName").setValue("");this.getView().byId("associationPropertyValue").setValue("")}else{this.getView().byId("associationPropertyValue").setValueState("Error");this.getView().byId("associationPropertyName").setValueState("Error");sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ERROR_DUPLICATE_PROPERTY_VALUE"))}}else{this.getView().byId("associationPropertyValue").setValueState("Error");sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ENTER_PROPERTY_VALUE"))}}else{this.getView().byId("associationPropertyName").setValueState("Error");sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("EMTER_PROPERTY_NAME"))}},removeProperty:function(e){var t=this;var p=e.getSource().getBindingContext("associationProp").getPath();e.getSource().getBindingContext("associationProp").getModel().getData().PROPERTIES.splice(p.substring(p.lastIndexOf("/")+1),1);e.getSource().getBindingContext("associationProp").getModel().updateBindings()},saveAndExit:function(i){var t=this;this.saveAssociation(i);if(i==0){if(this.viewMode=="associationEdit"){sap.suite.smartbusiness.utils.replaceHash({action:"manageSBKPIAssociation",route:"detail",context:t.getView().sourceIndicatorContexts.contextPath.replace("INDICATORS","INDICATORS_MODELER")})}else if(this.viewMode=="associationCreate"){sap.suite.smartbusiness.utils.replaceHash({action:"manageSBKPIAssociation",route:"detail",context:t.getView().sourceIndicatorContexts.contextPath})}}},activateAssociation:function(){var t=this;var s=this.byId("sourceIndicatorContent").getModel("sourceIndicator").getData().INDICATOR.length?this.byId("sourceIndicatorContent").getModel("sourceIndicator").getData().INDICATOR[0]:this.byId("sourceIndicatorContent").getModel("sourceIndicator").getData().INDICATOR;var a=this.byId("targetIndicatorContent").getModel("targetIndicator").getData().INDICATOR.length?this.byId("targetIndicatorContent").getModel("targetIndicator").getData().INDICATOR[0]:this.byId("targetIndicatorContent").getModel("targetIndicator").getData().INDICATOR;t.ODataModel=t.oApplicationFacade.getODataModel();sap.suite.smartbusiness.utils.create(sap.suite.smartbusiness.utils.serviceUrl("ACTIVATE_ASSOCIATION_SERVICE_URI"),t.payload,null,function(){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("STATUS_ACTIVATED"));t.oApplicationFacade.getODataModel().refresh();if(t.viewMode=="associationEdit"){sap.suite.smartbusiness.utils.replaceHash({action:"manageSBKPIAssociation",route:"detail",context:t.getView().sourceIndicatorContexts.contextPath.replace("INDICATORS","INDICATORS_MODELER")})}else if(t.viewMode=="associationCreate"){sap.suite.smartbusiness.utils.replaceHash({action:"manageSBKPIAssociation",route:"detail",context:t.getView().sourceIndicatorContexts.contextPath})}},function(e){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ASSOCIATION_ACTIVATION_FAILED"),e.responseText)})},saveAndCreateNew:function(){var t=this;this.saveAssociation();t.byId("selectedKpiOpiId").setValue("");t.targetIndicatorModel.setData({});t.targetIndicatorModel.updateBindings();var m=t.getView().byId('propertyNameValueBox').getModel("associationProp");m.getData().PROPERTIES=m.getData().PROPERTIES||[];m.getData().PROPERTIES=[];m.updateBindings()},cancel:function(){var t=this;if(t.viewMode=="associationEdit"){sap.suite.smartbusiness.utils.replaceHash({action:"manageSBKPIAssociation",route:"detail",context:t.getView().sourceIndicatorContexts.contextPath.replace("INDICATORS","INDICATORS_MODELER")})}else if(t.viewMode=="associationCreate"){sap.suite.smartbusiness.utils.replaceHash({action:"manageSBKPIAssociation",route:"detail",context:t.getView().sourceIndicatorContexts.contextPath})}},formOldObjectForAssociation:function(s,t){var a=this;var b=a.sourceIndicatorModel.getData().INDICATOR.length?a.sourceIndicatorModel.getData().INDICATOR[0]:a.sourceIndicatorModel.getData().INDICATOR;var o={TYPE:this.byId("associationTypeSelect").getSelectedItem().getKey(),SOURCE_INDICATOR:s.ID,TARGET_INDICATOR:t.ID,IS_ACTIVE:0,CREATED_BY:b.CREATED_BY,CREATED_ON:b.CREATED_ON,CHANGED_BY:null,CHANGED_ON:null};var c=a.associationContext.sPath;o.TYPE=c.substring(c.indexOf("'",c.search("TYPE"))+1,c.indexOf("'",c.indexOf("'",c.search("TYPE"))+1));o.SOURCE_INDICATOR=c.substring(c.indexOf("'",c.search("SOURCE_INDICATOR"))+1,c.indexOf("'",c.indexOf("'",c.search("SOURCE_INDICATOR"))+1));o.TARGET_INDICATOR=c.substring(c.indexOf("'",c.search("TARGET_INDICATOR"))+1,c.indexOf("'",c.indexOf("'",c.search("TARGET_INDICATOR"))+1));o.IS_ACTIVE=parseInt(c.substring(c.indexOf("=",c.search("IS_ACTIVE"))+1,c.indexOf("=",c.search("IS_ACTIVE"))+2));return o},performBatchOperation:function(b){var t=this;t.oDataModel=t.oApplicationFacade.getODataModel();t.oDataModel.addBatchChangeOperations(b);t.oDataModel.submitBatch(function(d,r,e){if(e.length){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ASSOCIATION_SAVED_FAILED"));return}var a=false;var c=d.__batchResponses[0].__changeResponses;for(var k in c)if(c[k].statusCode!="201"&&c[k].statusCode!="204"&&c[k].statusCode!="200")a=true;if(a)sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ASSOCIATION_SAVED_FAILED"));else{sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("ASSOCIATION_SAVED"))}},function(e){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ASSOCIATION_SAVED_FAILED"))},false)},savePropertiesHelper:function(a,u,s,t,b){var c=this;c.batchArray=[];var p;var d=[];c.oDataModel=c.oApplicationFacade.getODataModel();for(var i=0;i<a.PROPERTIES.length;i++){p={};p.IS_ACTIVE=0;p.TYPE=a.PROPERTIES[i].TYPE;p.NAME=a.PROPERTIES[i].NAME;p.VALUE=a.PROPERTIES[i].VALUE;p.SOURCE_INDICATOR=a.PROPERTIES[i].SOURCE_INDICATOR;p.TARGET_INDICATOR=a.PROPERTIES[i].TARGET_INDICATOR;d.push(p)}if((c.viewMode==="associationEdit"&&!(c.associationData.IS_ACTIVE))||(c.viewMode==="associationEdit"&&c.associationData.IS_ACTIVE&&b)){var f={};f.DELETE={};f.CREATE={};var c=this;var s=this.byId("sourceIndicatorContent").getModel("sourceIndicator").getData().INDICATOR.length?this.byId("sourceIndicatorContent").getModel("sourceIndicator").getData().INDICATOR[0]:this.byId("sourceIndicatorContent").getModel("sourceIndicator").getData().INDICATOR;var t=this.byId("targetIndicatorContent").getModel("targetIndicator").getData().INDICATOR.length?this.byId("targetIndicatorContent").getModel("targetIndicator").getData().INDICATOR[0]:this.byId("targetIndicatorContent").getModel("targetIndicator").getData().INDICATOR;c.ODataModel=c.oApplicationFacade.getODataModel();c.payload={TYPE:c.byId("associationTypeSelect").getSelectedItem().getKey(),SOURCE_INDICATOR:s.ID,TARGET_INDICATOR:t.ID};if(u.updates.length!=0){var e=c.associationContext.sPath;c.batchArray.push(c.oDataModel.createBatchOperation(e,"DELETE"));c.batchArray.push(c.oDataModel.createBatchOperation("/ASSOCIATIONS","POST",u.updates[0]))}var o=c.oldPropertiesList.getData().PROPERTIES;var g=sap.suite.smartbusiness.utils.dirtyBitCheck({oldPayload:o,newPayload:d,objectType:"ASSOCIATION_PROPERTIES"});if(u.updates.length!=0){f.DELETE={"TYPE":u.deletes[0].TYPE,"SOURCE_INDICATOR":u.deletes[0].SOURCE_INDICATOR,"TARGET_INDICATOR":u.deletes[0].TARGET_INDICATOR,"IS_ACTIVE":u.deletes[0].IS_ACTIVE,"PROPERTY":o};f.CREATE={"TYPE":u.updates[0].TYPE,"SOURCE_INDICATOR":u.updates[0].SOURCE_INDICATOR,"TARGET_INDICATOR":u.updates[0].TARGET_INDICATOR,"IS_ACTIVE":u.updates[0].IS_ACTIVE,"PROPERTY":d};sap.suite.smartbusiness.utils.update(sap.suite.smartbusiness.utils.serviceUrl("ASSOCIATIONS_CUD"),f,null,function(){sap.m.MessageToast.show(c.oApplicationFacade.getResourceBundle().getText("ASSOCIATION_SAVED"));c.oApplicationFacade.getODataModel().refresh()},function(k){sap.suite.smartbusiness.utils.showErrorMessage(c.oApplicationFacade.getResourceBundle().getText("ASSOCIATION_SAVED_FAILED"),k.responseText)})}else{if(g.deletes.length>0){f.TYPE=g.deletes[0].TYPE;f.TARGET_INDICATOR=g.deletes[0].TARGET_INDICATOR;f.SOURCE_INDICATOR=g.deletes[0].SOURCE_INDICATOR;f.IS_ACTIVE=g.deletes[0].IS_ACTIVE}if(g.updates.length>0){f.TYPE=g.updates[0].TYPE;f.TARGET_INDICATOR=g.updates[0].TARGET_INDICATOR;f.SOURCE_INDICATOR=g.updates[0].SOURCE_INDICATOR;f.IS_ACTIVE=g.updates[0].IS_ACTIVE}f.PROPERTY={remove:g.deletes,create:g.updates};delete f.CREATE;delete f.DELETE;sap.suite.smartbusiness.utils.update(sap.suite.smartbusiness.utils.serviceUrl("ASSOCIATIONS_CUD"),f,null,function(){sap.m.MessageToast.show(c.oApplicationFacade.getResourceBundle().getText("ASSOCIATION_SAVED"));c.oApplicationFacade.getODataModel().refresh()},function(k){sap.suite.smartbusiness.utils.showErrorMessage(c.oApplicationFacade.getResourceBundle().getText("ASSOCIATION_SAVED_FAILED"),k.responseText)})}}if(c.viewMode==="associationCreate"||(c.viewMode==="associationEdit"&&c.associationData.IS_ACTIVE&&!b)){var h=c.sourceIndicatorModel.getData().INDICATOR.length?c.sourceIndicatorModel.getData().INDICATOR[0]:c.sourceIndicatorModel.getData().INDICATOR;var j={TYPE:c.byId("associationTypeSelect").getSelectedItem().getKey(),SOURCE_INDICATOR:s.ID,TARGET_INDICATOR:t.ID,IS_ACTIVE:0,CREATED_BY:h.CREATED_BY,CREATED_ON:h.CREATED_ON,CHANGED_BY:null,CHANGED_ON:null};c.finalAssociationPayload={};c.finalAssociationPayload.TYPE=j.TYPE;c.finalAssociationPayload.SOURCE_INDICATOR=j.SOURCE_INDICATOR;c.finalAssociationPayload.TARGET_INDICATOR=j.TARGET_INDICATOR;c.finalAssociationPayload.IS_ACTIVE=j.IS_ACTIVE;c.finalAssociationPayload.PROPERTY=d;var s=this.byId("sourceIndicatorContent").getModel("sourceIndicator").getData().INDICATOR.length?this.byId("sourceIndicatorContent").getModel("sourceIndicator").getData().INDICATOR[0]:this.byId("sourceIndicatorContent").getModel("sourceIndicator").getData().INDICATOR;var t=this.byId("targetIndicatorContent").getModel("targetIndicator").getData().INDICATOR.length?this.byId("targetIndicatorContent").getModel("targetIndicator").getData().INDICATOR[0]:this.byId("targetIndicatorContent").getModel("targetIndicator").getData().INDICATOR;c.ODataModel=c.oApplicationFacade.getODataModel();c.payload={TYPE:c.byId("associationTypeSelect").getSelectedItem().getKey(),SOURCE_INDICATOR:s.ID,TARGET_INDICATOR:t.ID};sap.suite.smartbusiness.utils.create(sap.suite.smartbusiness.utils.serviceUrl("ASSOCIATIONS_CUD"),c.finalAssociationPayload,null,function(){sap.m.MessageToast.show(c.oApplicationFacade.getResourceBundle().getText("ASSOCIATION_SAVED"));c.oApplicationFacade.getODataModel().refresh()},function(k){sap.suite.smartbusiness.utils.showErrorMessage(c.oApplicationFacade.getResourceBundle().getText("ASSOCIATION_SAVED_FAILED"),k.responseText)})}},saveAssociationHelper:function(s,t,i){var a=this;var b={};if(a.sourceIndicatorModel.getData().INDICATOR.length){b=a.sourceIndicatorModel.getData().INDICATOR[0]}else{b=a.sourceIndicatorModel.getData().INDICATOR}var c={TYPE:a.byId("associationTypeSelect").getSelectedItem().getKey(),SOURCE_INDICATOR:s.ID,TARGET_INDICATOR:t.ID,IS_ACTIVE:0,CREATED_BY:b.CREATED_BY,CREATED_ON:b.CREATED_ON,CHANGED_BY:null,CHANGED_ON:null};var d={PROPERTIES:a.getView().byId('propertyNameValueBox').getModel("associationProp").getData().PROPERTIES};var u=null;if((a.viewMode==="associationEdit"&&!(a.associationData.IS_ACTIVE))||(a.viewMode==="associationEdit"&&a.associationData.IS_ACTIVE&&i)){var o=a.formOldObjectForAssociation(s,t);u=sap.suite.smartbusiness.utils.dirtyBitCheck({oldPayload:o,newPayload:c,objectType:"ASSOCIATIONS"});a.savePropertiesHelper(d,u,s,t,i)}else if(a.viewMode==="associationCreate"||(a.viewMode==="associationEdit"&&a.associationData.IS_ACTIVE)){a.savePropertiesHelper(d,u,s,t)}},saveAssociation:function(i){var t=this;var s={};var a={};if(this.byId("sourceIndicatorContent").getModel("sourceIndicator").getData().INDICATOR.length&&this.byId("targetIndicatorContent").getModel("targetIndicator").getData().INDICATOR.length){s=this.byId("sourceIndicatorContent").getModel("sourceIndicator").getData().INDICATOR[0];a=this.byId("targetIndicatorContent").getModel("targetIndicator").getData().INDICATOR[0]}else{s=this.byId("sourceIndicatorContent").getModel("sourceIndicator").getData().INDICATOR;a=this.byId("targetIndicatorContent").getModel("targetIndicator").getData().INDICATOR}var p={};if(this.viewMode==="associationEdit"){t.saveAssociationHelper(s,a,i)}else if(t.viewMode==="associationCreate"){if(a==null){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("SELECT_A_KPI_TO_ASSOCIATE"));t.byId("selectedKpiOpiId").setValueState(sap.ui.core.ValueState.Error)}else{t.saveAssociationHelper(s,a,i)}t.oApplicationFacade.getODataModel().refresh()}},onBeforeRendering:function(){},onAfterRendering:function(){},onExit:function(){}})};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.authorization.Configuration')){
/*!
* SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2013 SAP SE. All rights reserved
*/
jQuery.sap.declare("sap.suite.ui.smartbusiness.designtime.authorization.Configuration");jQuery.sap.require('sap.ca.scfld.md.ConfigurationBase');jQuery.sap.require('sap.ca.scfld.md.app.Application');sap.ca.scfld.md.ConfigurationBase.extend("sap.suite.ui.smartbusiness.designtime.authorization.Configuration",{oServiceParams:{serviceList:[{name:"SMART_BUSINESS",masterCollection:"EVALUATIONS",serviceUrl:"/sap/hba/r/sb/core/odata/modeler/SMART_BUSINESS.xsodata/",isDefault:true,mockedDataSource:"",useBatch:false}]},getServiceList:function(){return this.getServiceParams().serviceList},getMasterKeyAttributes:function(){return["Id"]},getExcludedQueryStringParameters:function(){return["sap-client","sap-language"]},getHanaSystem:function(){var h=hasher||window.hasher;var a=h.getHashAsArray();if(a&&a.length&&a[0]){var b=a[0].substr(a[0].indexOf("?")+1).split("&");for(var i=0,l=b.length;i<l;i++){if(b[i]&&(b[i].indexOf("sap-system")!=-1)){return b[i].split("=")[1]}}}return""},getServiceParams:function(){if(sap.ushell&&sap.ushell.Container){var s=this.oServiceParams.serviceList[0].serviceUrl;this.oServiceParams.serviceList[0].serviceUrl=sap.ushell.Container.getService("URLParsing").addSystemToServiceUrl(s,this.getHanaSystem())}return this.oServiceParams},})};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.authorization.view.S2.controller')){jQuery.sap.declare('sap.suite.ui.smartbusiness.designtime.authorization.view.S2.controller');jQuery.sap.require('sap.ca.scfld.md.controller.ScfldMasterController');sap.ca.scfld.md.controller.ScfldMasterController.extend("sap.suite.ui.smartbusiness.designtime.authorization.view.S2",{onInit:function(){var t=this;t.oApplicationFacade.getODataModel().setSizeLimit(100000);if(!(t.oApplicationFacade.currentLogonHanaUser)){this.oApplicationFacade.getODataModel().read("/SESSION_USER",null,null,true,function(d){t.oApplicationFacade.currentLogonHanaUser=(d.results&&d.results.length)?d.results[0].LOGON_USER:null},function(e){t.oApplicationFacade.currentLogonHanaUser=null;sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("YMSG_ERROR_RETRIEVING_DATA"),e.response.body)})}this.byId("list").getBinding("items").filter([new sap.ui.model.Filter("IS_ACTIVE","EQ",1)])},createFilterOptions:function(){var t=this;var f=new sap.m.ViewSettingsDialog({id:this.createId("filterOptionsDialog"),filterItems:[new sap.m.ViewSettingsFilterItem({text:t.oApplicationFacade.getResourceBundle().getText("ACTIVITY"),key:"activity",items:[new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("SELF_CREATED"),key:"self_created"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("RECENTLY_WORKED_UPON"),key:"recently_worked_upon"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("FAVORITE"),key:"favorite"}),]})],confirm:function(e){var a="";var s=e.getParameter("filterItems");t.setFiltering(e.getParameter("filterItems"));if(s&&s.length){var b={};for(var i=0,l=s.length;i<l;i++){b[s[i].getParent().getKey()]=b[s[i].getParent().getKey()]||"";b[s[i].getParent().getKey()]+=(b[s[i].getParent().getKey()])?(","):"";b[s[i].getParent().getKey()]+=s[i].getText()}for(var c in b){if(b.hasOwnProperty(c)){a+=(a)?" ; ":"";a+=b[c]}}t.byId("filterToolbar").setVisible(true);t.byId("visualizationInfo").setText(a)}else{t.byId("visualizationInfo").setText("");t.byId("filterToolbar").setVisible(false)}}});return f},createSortOptions:function(){var t=this;var s=new sap.m.ViewSettingsDialog({id:this.createId("sortOptionsDialog"),sortItems:[new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("CREATION_DATE"),key:"newest"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("ALPHABETICALLY"),key:"alphabetically"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("NONE"),key:"none"})],confirm:function(e){if(e.getParameter("sortItem")){if(e.getParameter("sortItem").getKey()=="none"){t.setGrouping("indicator",(e.getParameter("groupDescending")||false))}else{t.setSorting(e.getParameter("sortItem").getKey(),e.getParameter("sortDescending"))}}else{t.setGrouping("indicator",(e.getParameter("groupDescending")||false))}}});return s},createGroupOptions:function(){var t=this;var g=new sap.m.ViewSettingsDialog({id:this.createId("groupOptionsDialog"),groupItems:[new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("BY_WORKSPACE"),key:"workspace"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("BY_INDICATOR"),key:"indicator"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("BY_OWNER"),key:"owner"})],confirm:function(e){if(e.getParameter("groupItem")){t.setGrouping(e.getParameter("groupItem").getKey(),e.getParameter("groupDescending"))}else{t.setGrouping("indicator",(e.getParameter("groupDescending")||false))}}});g.setSelectedGroupItem("workspace");g.setGroupDescending(true);return g},getHeaderFooterOptions:function(){var t=this;return{sI18NMasterTitle:"MASTER_TITLE",onBack:function(){window.history.back()},oFilterOptions:{onFilterPressed:function(e){t.getView().filterOptionDialog=t.getView().filterOptionDialog||t.createFilterOptions();t.getView().filterOptionDialog.open()}},oSortOptions:{onSortPressed:function(e){t.getView().sortOptionDialog=t.getView().sortOptionDialog||t.createSortOptions();t.getView().sortOptionDialog.open()}},oGroupOptions:{onGroupPressed:function(e){t.getView().groupOptionDialog=t.getView().groupOptionDialog||t.createGroupOptions();t.getView().groupOptionDialog.open()}},}},formatIndicatorId:function(c){var t=this;var i=c.getProperty("MANUAL_ENTRY");var g="";switch(i){case 1:g=t.oApplicationFacade.getResourceBundle().getText("MY_FAVOURITES");break;case 0:g=t.oApplicationFacade.getResourceBundle().getText("MY_LAST_WORKED_UPON");break;default:g=t.oApplicationFacade.getResourceBundle().getText("ALL_EVALUATIONS")}return{key:g,text:g}},setGrouping:function(k,g){var t=this;g=g||false;var l=this.getView().byId("list");if(k=="indicator"){l.getBinding("items").sort([new sap.ui.model.Sorter("INDICATOR",g,function(c){return{key:c.getProperty("INDICATOR"),text:("KPI: "+c.getProperty("INDICATOR"))}})])}else if(k=="owner"){l.getBinding("items").sort([new sap.ui.model.Sorter("OWNER_NAME",g,function(c){var o=c.getProperty("OWNER_NAME");var a="";switch(o){case null:a=t.oApplicationFacade.getResourceBundle().getText("NO_OWNER");break;case"":a=t.oApplicationFacade.getResourceBundle().getText("NO_OWNER");break;default:a=o}return{key:a,text:a}})])}else if(k=="workspace"){l.getBinding("items").sort([new sap.ui.model.Sorter("MANUAL_ENTRY",g,function(c){var i=c.getProperty("MANUAL_ENTRY");var a="";switch(i){case 1:a=t.oApplicationFacade.getResourceBundle().getText("MY_FAVOURITES");break;case 0:a=t.oApplicationFacade.getResourceBundle().getText("MY_LAST_WORKED_UPON");break;default:a=t.oApplicationFacade.getResourceBundle().getText("ALL_EVALUATIONS")}return{key:a,text:a}})])}},setFiltering:function(i){var t=this;var f=[];var l=t.getView().byId("list");var a={"self_created":(new sap.ui.model.Filter("CREATED_BY",sap.ui.model.FilterOperator.EQ,t.oApplicationFacade.currentLogonHanaUser)),"recently_worked_upon":(new sap.ui.model.Filter("MANUAL_ENTRY",sap.ui.model.FilterOperator.EQ,0)),"favorite":(new sap.ui.model.Filter("MANUAL_ENTRY",sap.ui.model.FilterOperator.EQ,1))};f=sap.suite.smartbusiness.utils.getFilterArray(i,a);if(f.length){l.getBinding("items").filter(new sap.ui.model.Filter(f,true))}else{l.getBinding("items").filter(f)}},setSorting:function(k,g){var t=this;g=g||false;var l=t.getView().byId("list");if(k=="newest"){l.getBinding("items").sort([new sap.ui.model.Sorter("CREATED_ON",g,null)])}else if(k=="alphabetically"){l.getBinding("items").sort([new sap.ui.model.Sorter("TITLE",g,null)])}},applySearchPatternToListItem:function(I,f){if(sap.ca.scfld.md.controller.ScfldMasterController.prototype.applySearchPatternToListItem.apply(this,arguments)){return true}else{var d=I.getDependents()||[];for(var i=0,l=d.length;i<l;i++){if(d[i].getText().toLowerCase().indexOf(f)!=-1){return true}}}return false}})};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.authorization.view.S3.controller')){jQuery.sap.declare('sap.suite.ui.smartbusiness.designtime.authorization.view.S3.controller');jQuery.sap.require('sap.ca.scfld.md.controller.BaseDetailController');sap.ca.scfld.md.controller.BaseDetailController.extend("sap.suite.ui.smartbusiness.designtime.authorization.view.S3",{onInit:function(){var t=this;var v=this.getView();this.oRouter.attachRouteMatched(function(e){if(e.getParameter("name")==="detail"){var c=new sap.ui.model.Context(v.getModel(),'/'+e.getParameter("arguments").contextPath);var a=e.getParameter("arguments").contextPath;v.setBindingContext(c);t.getUsersAndRoles(v.getBindingContext().getProperty("ID")||a.split("(")[1].split(",")[0].split("=")[1].replace(/'/g,''))}},this);var t=this;this.oHeaderFooterOptions={bSuppressBookmarkButton:{},oEditBtn:{sI18nBtnTxt:"S3_EDIT",onBtnPressed:function(e){sap.suite.smartbusiness.utils.replaceHash({action:"authorizeSBEvaluation",route:"subDetail",context:v.getBindingContext().getPath().split("/")[1]})},bEnabled:false,},}},getUsersAndRoles:function(i){var t=this;this.byId("users").getBinding("content").filter([new sap.ui.model.Filter("ID","EQ",i),new sap.ui.model.Filter("TYPE","EQ","USER")]);this.byId("roles").getBinding("content").filter([new sap.ui.model.Filter("ID","EQ",i),new sap.ui.model.Filter("TYPE","EQ","ROLE")]);this.byId("users").getBinding("content").attachDataReceived(function(d){t.byId("usersTab").setCount(d.getSource().getLength());t.byId("usersTitle").setText(t.oApplicationFacade.getResourceBundle().getText("AUTH_USERS")+" ("+d.getSource().getLength()+")")});this.byId("roles").getBinding("content").attachDataReceived(function(d){t.byId("rolesTab").setCount(d.getSource().getLength());t.byId("rolesTitle").setText(t.oApplicationFacade.getResourceBundle().getText("ROLES")+" ("+d.getSource().getLength()+")")})},formatId:function(i){return this.oApplicationFacade.getResourceBundle().getText("ID")+" : "+i},formatOwner:function(o){return sap.suite.smartbusiness.formatters.getBundleText(undefined,"OWNER",o)},getHeaderFooterOptions:function(){return this.oHeaderFooterOptions},formatProperties:function(n,v){return((this.getView().byId("properties").getItems().length>1)?(', '+n+' : '+v):(n+' : '+v))},formatFavoriteMark:function(f){return((f)?true:false)},})};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.authorization.view.S4.controller')){jQuery.sap.declare('sap.suite.ui.smartbusiness.designtime.authorization.view.S4.controller');jQuery.sap.require('sap.ca.scfld.md.controller.BaseFullscreenController');sap.ca.scfld.md.controller.BaseFullscreenController.extend("sap.suite.ui.smartbusiness.designtime.authorization.view.S4",{onInit:function(){var t=this;this.userSearch=false;this.roleSearch=false;this.previousAuthorizations=[];this.previousSelectedIds={};this.previousSelectedIds["USER"]={};this.previousSelectedIds["ROLE"]={};this.selectedIds={};this.selectedIds["USER"]={};this.selectedIds["ROLE"]={};var f=['A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z'];this.filterByAlphabetModel=new sap.ui.model.json.JSONModel();this.filterByAlphabetModel.setData(f);this.selectedItemsModel=new sap.ui.model.json.JSONModel();this.selectedItemsModel.setData([]);this.byId("selectedItemsList").setModel(this.selectedItemsModel,"selectedItems");this.alphabetFilterDialog={};this.deletedItems=[];this.oRouter.attachRouteMatched(function(e){if(e.getParameter("name")!="subDetail")return;var c=new sap.ui.model.Context(t.getView().getModel(),'/'+(e.getParameter("arguments").contextPath));t.getView().setBindingContext(c);t.itemId=t.getView().getBindingContext().getProperty("ID");if(!t.itemId){t.itemId=(/ID=\'.*\'/).exec(e.getParameter("arguments").contextPath)[0];t.itemId=t.itemId.slice(t.itemId.indexOf("'")+1,t.itemId.lastIndexOf("'"))}t.getView().getModel().read("/AUTHORIZED_USERS",null,"$filter=ID eq '"+t.itemId+"'",false,function(d){t.selectedIds["USER"]={};t.selectedIds["ROLE"]={};t.deletedItems=[];t.previousAuthorizations=jQuery.extend(true,[],d.results);t.selectedItemsModel.setData(d.results);t.initialSelectedItems=jQuery.extend(true,[],d.results);t.byId("selectedItemsTab").setCount(d.results.length);for(var k in d.results)t.selectedIds[d.results[k].TYPE][d.results[k].NAME]=d.results[k].NAME;t.previousSelectedIds=jQuery.extend(true,{},t.selectedIds)},function(a){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ERROR_LOADING_AUTH"))});t.byId("userList").bindItems("/HANA_USERS",new sap.m.CustomListItem({selected:{path:"NAME",formatter:function(n){return((t.selectedIds["USER"][n])?true:false)}},content:[new sap.ui.layout.Grid({defaultSpan:"L12 M12",width:"60%",vSpacing:0,content:[new sap.ui.core.Icon({src:"sap-icon://person-placeholder",size:"40px",color:{path:"NAME",formatter:function(n){return(t.selectedIds["USER"][n]?"#009de0":"#e6e6e6")}},layoutData:new sap.ui.layout.GridData({span:"L1 M1"})}),new sap.m.Label({text:"{NAME}",layoutData:new sap.ui.layout.GridData({span:"L8 M8"})})]})]}));t.byId("roleList").bindItems("/HANA_ROLES",new sap.m.CustomListItem({selected:{path:"NAME",formatter:function(n){return(t.selectedIds["ROLE"][n]?true:false)}},content:[new sap.ui.layout.Grid({defaultSpan:"L12 M12",width:"60%",vSpacing:0,content:[new sap.ui.core.Icon({src:"sap-icon://group",size:"40px",color:{path:"NAME",formatter:function(n){return(t.selectedIds["ROLE"][n]?"#009de0":"#e6e6e6")}},layoutData:new sap.ui.layout.GridData({span:"L1 M1"})}),new sap.m.Label({text:"{NAME}",layoutData:new sap.ui.layout.GridData({span:"L7 M7"})}),new sap.m.Link({text:{path:'NO_OF_USERS',formatter:jQuery.proxy(t.formatNoOfUsers,t)},press:jQuery.proxy(t.onAllRolesLinkSelect,t),layoutData:new sap.ui.layout.GridData({span:"L2 M2"})})]})]}))});this.oHeaderFooterOptions={bSuppressBookmarkButton:{},sI18NFullscreenTitle:"S3_EDIT",oFilterOptions:{onFilterPressed:function(e){if(t.byId("idIconTabBarMulti").getSelectedKey()=="selected")sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("FILTER_NOT_APPLICABLE"));else t.openFilterDialog()}},onBack:function(e){t.handleBackAndCancel()},oEditBtn:{sI18nBtnTxt:"SAVE",onBtnPressed:function(e){t.saveAuthorizations()}},buttonList:[{sI18nBtnTxt:"RESET",onBtnPressed:function(e){t.resetAuthorizations()},},{sI18nBtnTxt:"CANCEL",onBtnPressed:function(e){t.handleBackAndCancel()}}]};this.setHeaderFooterOptions(this.oHeaderFooterOptions)},getHeaderFooterOptions:function(){return this.oHeaderFooterOptions},onUserSearch:function(e){var p=this.userSearch;e.getSource().getValue()==""?this.userSearch=false:this.userSearch=true;var i=this.byId("userList").getBinding("items");if(p)i.aFilters.pop();if(this.userSearch)i.aFilters.push(new sap.ui.model.Filter("tolower(NAME)","Contains","'"+e.getSource().getValue().toLowerCase()+"'"));i.filter(i.aFilters)},onRoleSearch:function(e){var p=this.roleSearch;e.getSource().getValue()==""?this.roleSearch=false:this.roleSearch=true;var i=this.byId("roleList").getBinding("items");if(p)i.aFilters.pop();if(this.roleSearch)i.aFilters.push(new sap.ui.model.Filter("tolower(NAME)","Contains","'"+e.getSource().getValue().toLowerCase()+"'"));i.filter(i.aFilters)},refreshFilter:function(){var e=this.byId("idIconTabBarMulti").getSelectedKey();var i=this.byId((e==="users")?"userList":"roleList").getBinding("items");i.filter(i.aFilters.pop(),false);this.byId((e==="users")?"userInfoToolbar":"roleInfoToolbar").setVisible(false);this.alphabetFilterDialog[e]=null},onUserItemSelectionChange:function(e){this.onItemSelectionChange(e,"USER")},onRoleItemSelectionChange:function(e){this.onItemSelectionChange(e,"ROLE")},onItemSelectionChange:function(e,t){var s=this.selectedItemsModel.getData();var a=e.getParameter("listItem");var b=a.getBindingContext().getObject();if(a.getSelected()){for(var k in this.deletedItems){if(this.deletedItems[k].NAME===b.NAME&&this.deletedItems[k].TYPE===t)this.deletedItems.splice(k,1)}b.TYPE=t;s.push(b);var c=a.getContent()[0].getContent()[0];c.setColor("#009de0");this.selectedIds[t][b.NAME]=b.NAME}else{for(var k in this.previousAuthorizations){if(this.previousAuthorizations[k].NAME===b.NAME&&this.previousAuthorizations[k].TYPE===t){b.TYPE=t;this.deletedItems.push(b)}}for(var k in s)if((s[k].NAME==b.NAME)&&(s[k].TYPE==t))s.splice(k,1);var c=a.getContent()[0].getContent()[0];c.setColor("#e6e6e6");this.selectedIds[t][b.NAME]=null}this.selectedItemsModel.setData(s);this.byId("selectedItemsTab").setCount(s.length)},onSelectedItemDelete:function(e){var d=e.getParameter("listItem").getBindingContext("selectedItems").getObject();var i=this.byId(d.TYPE=="USER"?"userList":"roleList");for(var k in this.previousAuthorizations){if(this.previousAuthorizations[k].NAME===d.NAME&&this.previousAuthorizations[k].TYPE===d.TYPE)this.deletedItems.push(d)}this.selectedIds[d.TYPE][d.NAME]=null;i.getModel().refresh(true);var s=this.selectedItemsModel.getData();var a=e.getParameter("listItem").getBindingContext("selectedItems").getPath().substr(1);s.splice(a,1);this.selectedItemsModel.setData(s);this.byId("selectedItemsList").rerender();this.byId("selectedItemsTab").setCount(s.length)},onAllRolesLinkSelect:function(e){var r=e.getSource().getBindingContext().getProperty("NAME");var n=e.getSource().getBindingContext().getProperty("NO_OF_USERS");this.onRolesLinkSelect(e,r,n)},onSelectedRolesLinkSelect:function(e){var r=e.getSource().getBindingContext("selectedItems").getProperty("NAME");var n=e.getSource().getBindingContext("selectedItems").getProperty("NO_OF_USERS");this.onRolesLinkSelect(e,r,n)},onRolesLinkSelect:function(e,r,n){n=n+" "+(n==1?this.oApplicationFacade.getResourceBundle().getText("USER"):this.oApplicationFacade.getResourceBundle().getText("USERS"));if(!this._rolesPopover){this.roleNameLabel=new sap.m.Label({text:r,design:"Bold",layoutData:new sap.ui.layout.GridData({span:"L10 M10"})});this.noOfUsersLabel=new sap.m.Label({text:n,design:"Bold",layoutData:new sap.ui.layout.GridData({span:"L12 M12"})});var a=new sap.ui.layout.Grid({defaultSpan:"L12 M12",content:[new sap.ui.core.Icon({src:"sap-icon://group",size:"40px",color:"#e6e6e6",layoutData:new sap.ui.layout.GridData({span:"L2 M2"})}),this.roleNameLabel,this.noOfUsersLabel]});this.usersForRole=new sap.ui.layout.Grid({span:"L12 M12"});var b=new sap.m.VBox({items:[a,this.usersForRole],});this._rolesPopover=new sap.m.Popover({title:"{i18n>ROLE_DETAILS}",content:b});this.getView().addDependent(this._rolesPopover)}this.roleNameLabel.setText(r);this.noOfUsersLabel.setText(n);this.usersForRole.bindAggregation("content","/USERS_GRANTED_ROLE(P_ROLE_NAME='"+r+"')/Results",new sap.m.Label({text:"{NAME}",layoutData:new sap.ui.layout.GridData({span:"L12 M12"})}));var i=e.getSource();jQuery.sap.delayedCall(0,this,function(){this._rolesPopover.openBy(i)})},formatSelectedItemsIcon:function(t){if(t==="ROLE")return"sap-icon://group";else return"sap-icon://person-placeholder"},formatNoOfUsers:function(n){if(n)return n+" "+(n==1?this.oApplicationFacade.getResourceBundle().getText("USER"):this.oApplicationFacade.getResourceBundle().getText("USERS"));else return""},saveAuthorizations:function(){var t=this;var s=this.selectedItemsModel.getData();var d=[];var c=[];var i=true;var p={ID:this.itemId,REVOKE:[],GRANT:[]};var b=new sap.m.BusyDialog();b.open();for(var k in this.deletedItems){p.REVOKE.push(this.deletedItems[k].NAME)}for(var k in s){p.GRANT.push(s[k].NAME)}sap.suite.smartbusiness.utils.create(sap.suite.smartbusiness.utils.serviceUrl("AUTHORIZATION_SERVICE_URI"),p,null,function(a){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("AUTH_SAVE_SUCCESS"));t.onNavBack();sap.suite.smartbusiness.utils.replaceHash({action:"authorizeSBEvaluation",route:"detail",context:t.getView().getBindingContext().getPath().split("/")[1]});b.close()},function(e){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("AUTH_SAVE_ERROR"),e.responseText);b.close()})},resetAuthorizations:function(){this.selectedIds=jQuery.extend(true,{},this.previousSelectedIds);this.selectedItemsModel.setData(jQuery.extend(true,[],this.previousAuthorizations));this.byId("selectedItemsTab").setCount(this.previousAuthorizations.length);this.byId("selectedItemsList").rerender();this.byId("userList").getModel().refresh(true);this.byId("roleList").getModel().refresh(true);this.deletedItems=[]},onNavBack:function(){this.selectedIds["USER"]={};this.selectedIds["ROLE"]={};this.deletedItems=[]},openFilterDialog:function(){var t=this;var e=this.byId("idIconTabBarMulti").getSelectedKey();if(!this.alphabetFilterDialog[e]){this.alphabetFilterDialog[e]=new sap.m.SelectDialog({title:t.oApplicationFacade.getResourceBundle().getText("FILTER")+" : "+(e=="users"?t.oApplicationFacade.getResourceBundle().getText("USERS"):t.oApplicationFacade.getResourceBundle().getText("ROLES")),growingScrollToLoad:true,rememberSelections:true,multiSelect:true,search:function(E){t.alphabetFilterDialog[e].getBinding("items").filter(new sap.ui.model.Filter("","Contains",this.getValue()))},confirm:function(E){var f=[];var i=t.byId((e==="users")?"userList":"roleList").getBinding("items");var s=null;if(e==="users")s=t.userSearch?i.aFilters.pop():null;else s=t.roleSearch?i.aFilters.pop():null;var a=[];var b=E.getParameter("selectedContexts");for(var k in b){f.push(new sap.ui.model.Filter("NAME","StartsWith",b[k].getObject()));a.push(b[k].getObject())}if(s)f.push(s);i.filter(f,false);if(a.length>0){t.byId((e==="users")?"userInfoToolbar":"roleInfoToolbar").setVisible(true);t.byId((e==="users")?"userInfoToolbarLabel":"roleInfoToolbarLabel").setText(t.oApplicationFacade.getResourceBundle().getText("FILTERED_BY")+"("+a.join(", ")+")")}else t.byId((e==="users")?"userInfoToolbar":"roleInfoToolbar").setVisible(false)},items:{path:"/",template:new sap.m.StandardListItem({title:"{}"})}});this.alphabetFilterDialog[e].setModel(this.filterByAlphabetModel)}this.alphabetFilterDialog[e].open()},onSelectIconTab:function(e){if(e.getParameter("selectedKey")=="selected"){this.oHeaderFooterOptions.oFilterOptions.bDisabled=true;this.setHeaderFooterOptions(this.oHeaderFooterOptions)}else{this.oHeaderFooterOptions.oFilterOptions.bDisabled=false;this.setHeaderFooterOptions(this.oHeaderFooterOptions)}},handleBackAndCancel:function(){var t=this;var d=sap.suite.smartbusiness.utils.dirtyBitCheck({oldPayload:t.initialSelectedItems,newPayload:t.selectedItemsModel.getData(),objectType:"AUTHORIZATION"});if(d.updates.length||d.deletes.length){var b=new sap.m.Dialog({icon:"sap-icon://warning2",title:t.oApplicationFacade.getResourceBundle().getText("WARNING"),state:"Error",type:"Message",content:[new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText("ON_BACK_WARNING")})],beginButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("CONTINUE"),press:function(){sap.suite.smartbusiness.utils.replaceHash({action:"authorizeSBEvaluation",route:"detail",context:t.getView().getBindingContext().getPath().split("/")[1]})}}),endButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("CANCEL"),press:function(){b.close()}})});b.open()}else{sap.suite.smartbusiness.utils.replaceHash({action:"authorizeSBEvaluation",route:"detail",context:t.getView().getBindingContext().getPath().split("/")[1]})}}})};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.drilldown.Configuration')){jQuery.sap.declare("sap.suite.ui.smartbusiness.designtime.drilldown.Configuration");jQuery.sap.require('sap.ca.scfld.md.ConfigurationBase');jQuery.sap.require('sap.ca.scfld.md.app.Application');sap.ca.scfld.md.ConfigurationBase.extend("sap.suite.ui.smartbusiness.designtime.drilldown.Configuration",{oServiceParams:{serviceList:[{name:"smart_business_runtime_services",masterCollection:"EVALUATIONS",serviceUrl:"/sap/hba/r/sb/core/odata/modeler/SMART_BUSINESS.xsodata",isDefault:true,mockedDataSource:"/ddaconfig/model/metadata.xml"}]},getHanaSystem:function(){var h=hasher||window.hasher;var a=h.getHashAsArray();if(a&&a.length&&a[0]){var b=a[0].substr(a[0].indexOf("?")+1).split("&");for(var i=0,l=b.length;i<l;i++){if(b[i]&&(b[i].indexOf("sap-system")!=-1)){return b[i].split("=")[1]}}}return""},getServiceParams:function(){if(sap.ushell&&sap.ushell.Container){var s=this.oServiceParams.serviceList[0].serviceUrl;this.oServiceParams.serviceList[0].serviceUrl=sap.ushell.Container.getService("URLParsing").addSystemToServiceUrl(s,this.getHanaSystem())}return this.oServiceParams},getServiceList:function(){return this.getServiceParams().serviceList},getMasterKeyAttributes:function(){return["ID","IS_ACTIVE"]},getExcludedQueryStringParameters:function(){return["sap-client","sap-language"]}})};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.drilldown.view.S2.controller')){jQuery.sap.declare('sap.suite.ui.smartbusiness.designtime.drilldown.view.S2.controller');jQuery.sap.require('sap.ca.scfld.md.controller.ScfldMasterController');sap.ca.scfld.md.controller.ScfldMasterController.extend("sap.suite.ui.smartbusiness.designtime.drilldown.view.S2",{onInit:function(){var t=this;t.oApplicationFacade.getODataModel().setSizeLimit(100000);if(!(t.oApplicationFacade.currentLogonHanaUser)){this.oApplicationFacade.getODataModel().read("/SESSION_USER",null,null,true,function(d){t.oApplicationFacade.currentLogonHanaUser=(d.results&&d.results.length)?d.results[0].LOGON_USER:null},function(e){t.oApplicationFacade.currentLogonHanaUser=null;sap.suite.smartbusiness.utils.showErrorMessage(t.getView().getModel("i18n").getProperty("YMSG_ERROR_RETRIEVING_DATA"),e.response.body)})}},formatIndicatorId:function(c){return{text:("KPI: "+c.getProperty("INDICATOR")),key:c.getProperty("INDICATOR")}},_handleItemPress:function(){},createGroupOptions:function(){var t=this;var g=new sap.m.ViewSettingsDialog({id:this.createId("groupOptionsDialog"),groupItems:[new sap.m.ViewSettingsItem({text:t.getView().getModel("i18n").getProperty("BY_INDICATOR"),key:"indicator"}),new sap.m.ViewSettingsItem({text:t.getView().getModel("i18n").getProperty("BY_OWNER"),key:"owner"})],confirm:function(e){if(e.getParameter("groupItem")){t.setGrouping(e.getParameter("groupItem").getKey(),e.getParameter("groupDescending"))}else{t.setGrouping("indicator",(e.getParameter("groupDescending")||false))}}});return g},getHeaderFooterOptions:function(){var t=this;return{sI18NMasterTitle:"ALL_ACTIVE_EVALUATIONS",oFilterOptions:{onFilterPressed:function(e){t.getView().filterOptionDialog=t.getView().filterOptionDialog||t.createFilterOptions();t.getView().filterOptionDialog.open()}},oSortOptions:{onSortPressed:function(e){t.getView().sortOptionDialog=t.getView().sortOptionDialog||t.createSortOptions();t.getView().sortOptionDialog.open()}},oGroupOptions:{onGroupPressed:function(e){t.getView().groupOptionDialog=t.getView().groupOptionDialog||t.createGroupOptions();t.getView().groupOptionDialog.open()}},}},setGrouping:function(k,g){var t=this;g=g||false;var l=this.getView().byId("list");if(k=="indicator"){l.getBinding("items").sort([new sap.ui.model.Sorter("INDICATOR",g,function(c){return{key:c.getProperty("INDICATOR"),text:("KPI: "+c.getProperty("INDICATOR"))}})])}else if(k=="owner"){l.getBinding("items").sort([new sap.ui.model.Sorter("OWNER_NAME",g,function(c){var o=c.getProperty("OWNER_NAME");var a="";switch(o){case null:a=t.getView().getModel("i18n").getProperty("NO_OWNER");break;case"":a=t.getView().getModel("i18n").getProperty("NO_OWNER");break;default:a=o}return{key:a,text:a}})])}},createSortOptions:function(){var t=this;var s=new sap.m.ViewSettingsDialog({id:this.createId("sortOptionsDialog"),sortItems:[new sap.m.ViewSettingsItem({text:t.getView().getModel("i18n").getProperty("CREATION_DATE"),key:"newest"}),new sap.m.ViewSettingsItem({text:t.getView().getModel("i18n").getProperty("ALPHABETICALLY"),key:"alphabetically"}),new sap.m.ViewSettingsItem({text:t.getView().getModel("i18n").getProperty("NONE"),key:"none"})],confirm:function(e){if(e.getParameter("sortItem")){if(e.getParameter("sortItem").getKey()=="none"){t.setGrouping("indicator",(e.getParameter("groupDescending")||false))}else{t.setSorting(e.getParameter("sortItem").getKey(),e.getParameter("sortDescending"))}}else{t.setGrouping("indicator",(e.getParameter("groupDescending")||false))}}});return s},setSorting:function(k,g){g=g||false;var l=this.getView().byId("list");if(k=="newest"){l.getBinding("items").sort([new sap.ui.model.Sorter("CREATED_ON",g,null)])}else if(k=="alphabetically"){l.getBinding("items").sort([new sap.ui.model.Sorter("TITLE",g,null)])}},setFiltering:function(i){var f=[];var l=this.getView().byId("list");var a={"self_created":(new sap.ui.model.Filter("CREATED_BY",sap.ui.model.FilterOperator.EQ,this.oApplicationFacade.currentLogonHanaUser)),};for(var b in i){f.push(a[b])}if(f.length){l.getBinding("items").filter(new sap.ui.model.Filter(f,false))}else{l.getBinding("items").filter(f)}},createFilterOptions:function(){var t=this;var f=new sap.m.ViewSettingsDialog({id:this.createId("filterOptionsDialog"),filterItems:[new sap.m.ViewSettingsFilterItem({text:t.getView().getModel("i18n").getProperty("ACTIVITY"),key:"activity",items:[new sap.m.ViewSettingsItem({text:t.getView().getModel("i18n").getProperty("SELF_CREATED"),key:"self_created"}),]})],confirm:function(e){var a="";var s=e.getParameter("filterItems");t.setFiltering(e.getParameter("filterKeys"));if(s&&s.length){var b={};for(var i=0,l=s.length;i<l;i++){b[s[i].getParent().getKey()]=b[s[i].getParent().getKey()]||"";b[s[i].getParent().getKey()]+=(b[s[i].getParent().getKey()])?(","):"";b[s[i].getParent().getKey()]+=s[i].getText()}for(var c in b){if(b.hasOwnProperty(c)){a+=(a)?" ; ":"";a+=b[c]}}}}});return f},})};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.evaluation.Component')){jQuery.sap.declare("sap.suite.ui.smartbusiness.designtime.evaluation.Component");jQuery.sap.require('sap.ca.scfld.md.ComponentBase');sap.ca.scfld.md.ComponentBase.extend("sap.suite.ui.smartbusiness.designtime.evaluation.Component",{metadata:sap.ca.scfld.md.ComponentBase.createMetaData("FS",{"name":"Fullscreen Sample","version":"1.0.0-SNAPSHOT","library":"sap.suite.ui.smartbusiness.designtime.evaluation","includes":["../../lib/Util.js"],"dependencies":{"libs":["sap.m"],"components":[],},"config":{"resourceBundle":"i18n/i18n.properties","titleResource":"FULLSCREEN_TITLE","icon":"sap-icon://Fiori5/F0822","favIcon":"../../../../../../../resources/sap/ca/ui/themes/base/img/favicon/F0822_Create_Evaluation.ico","homeScreenIconPhone":"../../../../../../../resources/sap/ca/ui/themes/base/img/launchicon/F0822_Create_Evaluation/57_iPhone_Desktop_Launch.png","homeScreenIconPhone@2":"../../../../../../../resources/sap/ca/ui/themes/base/img/launchicon/F0822_Create_Evaluation/114_iPhone-Retina_Web_Clip.png","homeScreenIconTablet":"../../../../../../../resources/sap/ca/ui/themes/base/img/launchicon/F0822_Create_Evaluation/72_iPad_Desktop_Launch.png","homeScreenIconTablet@2":"../../../../../../../resources/sap/ca/ui/themes/base/img/launchicon/F0822_Create_Evaluation/144_iPad_Retina_Web_Clip.png","startupImage320x460":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/320_x_460.png","startupImage640x920":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/640_x_920.png","startupImage640x1096":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/640_x_1096.png","startupImage768x1004":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/768_x_1004.png","startupImage748x1024":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/748_x_1024.png","startupImage1536x2008":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/1536_x_2008.png","startupImage1496x2048":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/1496_x_2048.png"},viewPath:"sap.suite.ui.smartbusiness.designtime.evaluation.view",fullScreenPageRoutes:{"fullscreen":{"pattern":"","view":"S1"},"addEvaluation":{"pattern":"addEvaluation/{indicatorContext}","view":"S1"},"editEvaluation":{"pattern":"editEvaluation/{indicatorContext}/{evaluationContext}","view":"S1"},"duplicateEvaluation":{"pattern":"duplicateEvaluation/{indicatorContext}/{evaluationContext}","view":"S1"},"editEvaluationDraft":{"pattern":"editEvaluationDraft/{indicatorContext}/{evaluationContext}","view":"S1"},},}),createContent:function(){var v={component:this};return sap.ui.view({viewName:"sap.suite.ui.smartbusiness.designtime.evaluation.Main",type:sap.ui.core.mvc.ViewType.XML,viewData:v})}})};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.evaluation.Configuration')){jQuery.sap.declare("sap.suite.ui.smartbusiness.designtime.evaluation.Configuration");jQuery.sap.require('sap.ca.scfld.md.ConfigurationBase');jQuery.sap.require('sap.ca.scfld.md.app.Application');sap.ca.scfld.md.ConfigurationBase.extend("sap.suite.ui.smartbusiness.designtime.evaluation.Configuration",{oServiceParams:{serviceList:[{name:"SMART_BUSINESS",masterCollection:"",serviceUrl:"/sap/hba/r/sb/core/odata/modeler/SMART_BUSINESS.xsodata/",isDefault:true,mockedDataSource:"",useBatch:false}]},getAppConfig:function(){return this.oAppConfig},getServiceList:function(){return this.oServiceParams.serviceList},getMasterKeyAttributes:function(){return["Id"]},getExcludedQueryStringParameters:function(){return["sap-client","sap-language"]},getHanaSystem:function(){var h=hasher||window.hasher;var a=h.getHashAsArray();if(a&&a.length&&a[0]){var b=a[0].substr(a[0].indexOf("?")+1).split("&");for(var i=0,l=b.length;i<l;i++){if(b[i]&&(b[i].indexOf("sap-system")!=-1)){return b[i].split("=")[1]}}}return""},getServiceParams:function(){if(sap.ushell&&sap.ushell.Container){var s=this.oServiceParams.serviceList[0].serviceUrl;this.oServiceParams.serviceList[0].serviceUrl=sap.ushell.Container.getService("URLParsing").addSystemToServiceUrl(s,this.getHanaSystem())}return this.oServiceParams},})};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.evaluation.view.S1.controller')){jQuery.sap.declare('sap.suite.ui.smartbusiness.designtime.evaluation.view.S1.controller');jQuery.sap.require('sap.ca.scfld.md.controller.BaseFullscreenController');jQuery.sap.includeStyleSheet("../../resources/sap/suite/ui/smartbusiness/designtime/evaluation/view/evaluationParameters.css");sap.ca.scfld.md.controller.BaseFullscreenController.extend("sap.suite.ui.smartbusiness.designtime.evaluation.view.S1",{onAfterRendering:function(){var t=this;t.initialModel=t._cloneObj(t.getView().getModel().getData())},navigateBack:function(){var t=this;var a;var b=new sap.m.Dialog({icon:"sap-icon://warning2",title:t.oResourceBundle.getText("WARNING"),state:"Warning",type:"Message",content:[new sap.m.Text({text:t.oResourceBundle.getText("NAVIGATION_DATA_LOSS")})],beginButton:new sap.m.Button({text:t.oResourceBundle.getText("CONTINUE"),press:function(){b.close();if(t.fromHome){window.location.hash=""}else{if(this.editDraft){window.location.hash="FioriApplication-SBWorkspace?sap-system=HANA&/evalDetail/INDICATORS_MODELER(ID='"+t.getView().getModel().getData().INDICATOR+"',IS_ACTIVE=1)/EVALUATIONS_MODELER(ID='"+t.getView().getModel().getData().ID+"',IS_ACTIVE=1)"}else if(t.evalContext){window.location.hash="FioriApplication-SBWorkspace?sap-system=HANA&/evalDetail/INDICATORS_MODELER(ID='"+t.getView().getModel().getData().INDICATOR+"',IS_ACTIVE=1)/EVALUATIONS_MODELER(ID='"+t.getView().getModel().getData().ID+"',IS_ACTIVE="+a+")"}else{window.location.hash="FioriApplication-SBWorkspace?sap-system=HANA&/detail/INDICATORS_MODELER(ID='"+t.getView().getModel().getData().INDICATOR+"',IS_ACTIVE=1)"}}}}),endButton:new sap.m.Button({text:t.oResourceBundle.getText("CANCEL"),press:function(){b.close()}})});var u=false;if(t.getView().getModel().getData().mode==="create"){var c={};c.oldPayload=t.getEvalParamPayload(t.initialModel);c.newPayload=t.getEvalParamPayload(t.getView().getModel().getData());c.objectType="Evaluations";c=sap.suite.smartbusiness.utils.dirtyBitCheck(c);if(c.updates.length>0){u=true}}else{var t=this,i=0;var c={};t.saveFilters(t.getView());t.saveValues(t.getView());t.saveTags(t.getView());t.saveProperties(t.getView());t.saveAdditionalLanguages(t.getView());c.oldPayload=t.getEvalParamPayload(t.evalDetails);c.oldPayload.DATA_SPECIFICATION="";a=c.oldPayload.IS_ACTIVE;c.oldPayload.IS_ACTIVE=0;c.newPayload=t.getEvalParamPayload(t.getView().getModel().getData());c.newPayload.DATA_SPECIFICATION="";c.objectType="Evaluations";c=sap.suite.smartbusiness.utils.dirtyBitCheck(c);if(c.updates.length>0){u=true}c.oldPayload=t.evalDetails.FILTERS.results;for(var k in c.oldPayload){c.oldPayload[k].IS_ACTIVE=0}c.newPayload=t.evalFiltersPayload;c.objectType="EVALUATION_FILTERS";c=sap.suite.smartbusiness.utils.dirtyBitCheck(c);if(c.deletes.length>0){u=true}if(c.updates.length>0){u=true}for(i=0;i<t.evalDetails.VALUES.results.length;i++){if(t.evalDetails.VALUES.results[i].COLUMN_NAME){delete t.evalDetails.VALUES.results[i].FIXED}else{delete t.evalDetails.VALUES.results[i].COLUMN_NAME}}c.oldPayload=t.evalDetails.VALUES.results;for(var k in c.oldPayload){c.oldPayload[k].IS_ACTIVE=0}c.newPayload=t.valuesPayload;c.objectType="EVALUATION_VALUES";c=sap.suite.smartbusiness.utils.dirtyBitCheck(c);if(c.deletes.length>0){u=true}if(c.updates.length>0){u=true}c.oldPayload=t.evalDetails.TAGS.results;for(var k in c.oldPayload){c.oldPayload[k].IS_ACTIVE=0}c.newPayload=t.tagsPayload;c.objectType="TAGS";c=sap.suite.smartbusiness.utils.dirtyBitCheck(c);if(c.deletes.length>0){u=true}if(c.updates.length>0){u=true}c.oldPayload=t.evalDetails.PROPERTIES.results;for(var k in c.oldPayload){c.oldPayload[k].IS_ACTIVE=0}c.newPayload=t.propPayload;c.objectType="PROPERTIES";c=sap.suite.smartbusiness.utils.dirtyBitCheck(c);if(c.deletes.length>0){u=true}if(c.updates.length>0){u=true}c.oldPayload=t.evalDetails.ADDITIONAL_LANGUAGE_ARRAY;for(var k in c.oldPayload){c.oldPayload[k].IS_ACTIVE=0}c.newPayload=t.languagesPayload;c.objectType="EVALUATION_TEXTS";c=sap.suite.smartbusiness.utils.dirtyBitCheck(c);if(c.deletes.length>0){u=true}if(c.updates.length>0){u=true}}if(u){b.open()}else{if(t.fromHome){window.location.hash=""}else{if(this.editDraft){window.location.hash="FioriApplication-SBWorkspace?sap-system=HANA&/evalDetail/INDICATORS_MODELER(ID='"+t.getView().getModel().getData().INDICATOR+"',IS_ACTIVE=1)/EVALUATIONS_MODELER(ID='"+t.getView().getModel().getData().ID+"',IS_ACTIVE=1)"}else if(t.evalContext){window.location.hash="FioriApplication-SBWorkspace?sap-system=HANA&/evalDetail/INDICATORS_MODELER(ID='"+t.getView().getModel().getData().INDICATOR+"',IS_ACTIVE=1)/EVALUATIONS_MODELER(ID='"+t.getView().getModel().getData().ID+"',IS_ACTIVE="+a+")"}else{window.location.hash="FioriApplication-SBWorkspace?sap-system=HANA&/detail/INDICATORS_MODELER(ID='"+t.getView().getModel().getData().INDICATOR+"',IS_ACTIVE=1)"}}}},onInit:function(){var t=this;t.fromHome=false;var o={onBack:function(){t.navigateBack()},bSuppressBookmarkButton:{},oEditBtn:{sI18nBtnTxt:"SAVE",onBtnPressed:function(a){t.saveAndExit()}},buttonList:[{sI18nBtnTxt:"SAVE_CREATE_NEW",onBtnPressed:function(a){t.saveAndCreateNew()}},{sI18nBtnTxt:"SAVE_AND_ACTIVATE",onBtnPressed:function(a){t.saveAndActivate()}},{sI18nBtnTxt:"ACTIVATE_VISUALIZE",onBtnPressed:function(a){t.activateAndAddTiles()}},{sI18nBtnTxt:"CANCEL",onBtnPressed:function(a){t.navigateBack()}}]};this.setHeaderFooterOptions(o);this.busyDialog=new sap.m.BusyDialog();this.oResourceBundle=this.oApplicationFacade.getResourceBundle();var m=new sap.ui.model.json.JSONModel({NO_OF_ADDITIONAL_LANGUAGES:0});this.getView().setModel(m);this.oDataModel=this.oApplicationFacade.getODataModel();this.editDraft=false;this.oModelForInputParameters=new sap.ui.model.json.JSONModel();this.oModelForDimensions=new sap.ui.model.json.JSONModel();var e=this.evalContext||"";t.getView().byId("propertyNameValueBox").bindAggregation("items","/PROPERTIES",function(a,b){return new sap.ui.layout.Grid({content:[new sap.m.Input({value:"{NAME}",layoutData:new sap.ui.layout.GridData({span:"L4 M4 S4"})}),new sap.m.Input({value:"{VALUE}",layoutData:new sap.ui.layout.GridData({span:"L4 M4 S4"})}),new sap.m.Button({icon:"sap-icon://sys-cancel",type:"Transparent",layoutData:new sap.ui.layout.GridData({span:"L2 M2 S2"}),press:function(c){t.removeProperty(c)}})],defaultSpan:"L12 M12 S12"}).addStyleClass("propertyEntryGrid");});this.oDataModel.read("/LANGUAGE?$filter=LAISO eq '"+(sap.ui.getCore().getConfiguration().getLocale().getLanguage()).toUpperCase()+"'",null,null,false,function(d){t.localLanguage=d.results[0].SPRAS});t.getView().getModel().setProperty("/NO_OF_ADDITIONAL_LANGUAGES",0);this.setInputParameterAndFilterLayout();this.decideMode()},decideMode:function(){var t=this;this.oRouter.attachRouteMatched(function(a){this.getView().getModel().setProperty("/SCALING","0");if(a.getParameter("name")==="duplicateEvaluation"){try{if(sap.ushell.services.AppConfiguration&&sap.ushell.services.AppConfiguration.setWindowTitle){sap.ushell.services.AppConfiguration.setWindowTitle(t.oResourceBundle.getText("FULLSCREEN_TITLE_DUPLICATE"))}}catch(e){jQuery.sap.log.error("Error Setting Window Page Title : "+t.oResourceBundle.getText("FULLSCREEN_TITLE_DUPLICATE"))}t.duplicateEval=true;this.evalContext=a.getParameter("arguments").evaluationContext;this.indicatorContext=a.getParameter("arguments").indicatorContext;t.getView().getModel().setProperty("/mode","create");t._oControlStore.oTitle.setText(t.oResourceBundle.getText("FULLSCREEN_DYN_TITLE","Duplicate"));t.byId("evalId").setEditable(true);t.populateEvalDetails();t.fromHome=false}else if(a.getParameter("name")==="editEvaluationDraft"){try{if(sap.ushell.services.AppConfiguration&&sap.ushell.services.AppConfiguration.setWindowTitle){sap.ushell.services.AppConfiguration.setWindowTitle(t.oResourceBundle.getText("FULLSCREEN_TITLE_EDIT"))}}catch(e){jQuery.sap.log.error("Error Setting Window Page Title : "+t.oResourceBundle.getText("FULLSCREEN_TITLE_EDIT"))}t.footerForEditMode();this.evalContext=a.getParameter("arguments").evaluationContext;this.indicatorContext=a.getParameter("arguments").indicatorContext;t.getView().getModel().setProperty("/mode","edit");this.editDraft=true;t.populateEvalDetails();t._oControlStore.oTitle.setText(t.oResourceBundle.getText("FULLSCREEN_DYN_TITLE","Edit"));t.byId("evalId").setEditable(false);t.fromHome=false}else if(a.getParameter("arguments").indicatorContext&&a.getParameter("arguments").evaluationContext){try{if(sap.ushell.services.AppConfiguration&&sap.ushell.services.AppConfiguration.setWindowTitle){sap.ushell.services.AppConfiguration.setWindowTitle(t.oResourceBundle.getText("FULLSCREEN_TITLE_EDIT"))}}catch(e){jQuery.sap.log.error("Error Setting Window Page Title : "+t.oResourceBundle.getText("FULLSCREEN_TITLE_EDIT"))}this.evalContext=a.getParameter("arguments").evaluationContext;this.indicatorContext=a.getParameter("arguments").indicatorContext;t.getView().getModel().setProperty("/mode","edit");t.populateEvalDetails();t._oControlStore.oTitle.setText(t.oResourceBundle.getText("FULLSCREEN_DYN_TITLE","Edit"));t.byId("evalId").setEditable(false);t.fromHome=false}else if(a.getParameter("arguments").indicatorContext){t.getView().getModel().setProperty("/mode","create");t.busyDialog.open();this.indicatorContext=a.getParameter("arguments").indicatorContext;t.getView().getModel().setProperty("/IS_ACTIVE",0);t.getView().getModel().setProperty("/NO_OF_ADDITIONAL_LANGUAGES",0);t.getKpiDetails();t._oControlStore.oTitle.setText(t.oResourceBundle.getText("FULLSCREEN_DYN_TITLE","Add"));t.byId("indicatorId").setEditable(false);t.fromHome=false}else{t.byId("selectKpi").setText(t.oResourceBundle.getText("SELECT_KPI_OPI"));t.getView().getModel().setProperty("/mode","create");t.getView().getModel().setProperty("/IS_ACTIVE",0);t.getView().getModel().setProperty("/NO_OF_ADDITIONAL_LANGUAGES",0);t._oControlStore.oTitle.setText(t.oResourceBundle.getText("FULLSCREEN_DYN_TITLE","Add"));t.fromHome=true}},this)},footerForEditMode:function(){var t=this;var o={bSuppressBookmarkButton:{},onBack:function(){t.navigateBack()},oEditBtn:{sI18nBtnTxt:"SAVE",onBtnPressed:function(e){t.saveAndExit()}},buttonList:[{sI18nBtnTxt:"SAVE_AND_ACTIVATE",onBtnPressed:function(e){t.saveAndActivate()}},{sI18nBtnTxt:"DELETE",onBtnPressed:function(e){t.deleteDraft()}},{sI18nBtnTxt:"CANCEL",onBtnPressed:function(e){t.navigateBack()}}]};this.setHeaderFooterOptions(o)},populateEvalDetails:function(){var t=this;t.busyDialog.open();t.oDataModel.read(t.indicatorContext,null,null,true,function(a){t.getView().getModel().setProperty("/INDICATOR",a.ID);t.byId("indicatorId").setEditable(false);t.getView().getModel().setProperty("/GOAL_TYPE",a.GOAL_TYPE);if(a.DATA_SPECIFICATION!=""){t.getView().getModel().setProperty("/DATA_SPECIFICATION",a.DATA_SPECIFICATION);t.byId("additionalInfo").setVisible(true)}else{t.byId("additionalInfo").setVisible(false)}t.getView().getModel().setProperty("/INDICATOR_TYPE",a.TYPE);t.oDataModel.read(t.evalContext,null,"$expand=FILTERS,VALUES,PROPERTIES,TAGS",true,function(d){t.evalDetails={};t.evalDetails=t._cloneObj(d);t.getView().getModel().setProperty("/ID",d.ID);t.getView().getModel().setProperty("/TITLE",d.TITLE);t.getView().getModel().setProperty("/DESCRIPTION",d.DESCRIPTION);t.oDataModel.read("/EVALUATION_TEXTS?$filter=ID eq '"+d.ID+"' and IS_ACTIVE eq "+d.IS_ACTIVE,null,null,false,function(l){l=l.results;var m=[];for(i=0;i<l.length;i++){var n={};n.TITLE=l[i].TITLE;n.DESCRIPTION=l[i].DESCRIPTION;t.oDataModel.read("/LANGUAGE?$filter=SPRAS eq '"+l[i].LANGUAGE+"'",null,null,false,function(d){n.LANGUAGE_KEY=d.results[0].LAISO;n.LANGUAGE=d.results[0].SPRAS;n.IS_ACTIVE=t.getView().getModel().getData().IS_ACTIVE;n.ID=t.getView().getModel().getData().ID});if(n.LANGUAGE!=t.localLanguage){m.push(n)}}t.getView().getModel().setProperty("/ADDITIONAL_LANGUAGE_ARRAY",m);t.getView().getModel().setProperty("/NO_OF_ADDITIONAL_LANGUAGES",m.length);t.evalDetails.ADDITIONAL_LANGUAGE_ARRAY=m;t.evalDetails.NO_OF_ADDITIONAL_LANGUAGES=m.length});t.getView().getModel().setProperty("/IS_ACTIVE",0);t.getView().getModel().setProperty("/SEMANTIC_OBJECT",d.SEMANTIC_OBJECT);t.getView().getModel().setProperty("/ACTION",d.ACTION);if(d.GOAL_TYPE)t.getView().getModel().setProperty("/GOAL_TYPE",d.GOAL_TYPE);t.getView().getModel().setProperty("/INDICATOR_TYPE",d.INDICATOR_TYPE);t.getView().getModel().setProperty("/OWNER_NAME",d.OWNER_NAME);t.getView().getModel().setProperty("/OWNER_ID",d.OWNER_ID);t.getView().getModel().setProperty("/OWNER_E_MAIL",d.OWNER_E_MAIL);t.getView().getModel().setProperty("/VIEW_NAME",d.VIEW_NAME);t.getView().getModel().setProperty("/ODATA_URL",d.ODATA_URL);t.createTargetThresholdLayout();if(d.ODATA_ENTITYSET){t.getView().getModel().setProperty("/ODATA_ENTITYSET",d.ODATA_ENTITYSET);try{t.oModelForMeasure=t.populateMeasure(t.getView().getModel().getProperty("/ODATA_URL"),t.getView().getModel().getProperty("/ODATA_ENTITYSET"));t.populateDimensionsAndInputParameters(t.getView().getModel().getProperty("/ODATA_URL"),t.getView().getModel().getProperty("/ODATA_ENTITYSET"))}catch(e){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_WRONG_ENTITY_SET"),t.oResourceBundle.getText("ERROR_ODATA_ANALYTICS"));t.resetDimensionsAndInputParameters()}}t.getView().getModel().setProperty("/COLUMN_NAME",d.COLUMN_NAME);t.getView().getModel().setProperty("/SCALING",d.SCALING);t.getView().getModel().updateBindings();if(d.TAGS.results.length>0){var b="";for(var i=0;i<d.TAGS.results.length;i++){b+=d.TAGS.results[i].TAG+","}b=b.substring(0,b.length-1);t.getView().getModel().setProperty("/TAG",b)}if(d.FILTERS.results.length>0){var c=[],f=[],j=0,k=0;for(var i=0;i<d.FILTERS.results.length;i++){if(d.FILTERS.results[i].TYPE==="PA"){c[j]={};c[j++]=d.FILTERS.results[i]}else if(d.FILTERS.results[i].TYPE==="FI"){f[k]={};f[k++]=d.FILTERS.results[i]}}if(c.length>0){var g={};g.inputParameters=[];g.inputParameters=t.formObjectForFilters(c);if(t.oModelForInputParameters.getData().inputParameters&&t.oModelForInputParameters.getData().inputParameters.length){for(var i=0;i<t.oModelForInputParameters.getData().inputParameters.length;i++){for(var j=0;j<g.inputParameters.length;j++){if(t.oModelForInputParameters.getData().inputParameters[i].name===g.inputParameters[j].name){t.oModelForInputParameters.getData().inputParameters[i].value_1=g.inputParameters[j].value_1;t.oModelForInputParameters.getData().inputParameters[i].value_2=g.inputParameters[j].value_2}}}t.oModelForInputParameters.updateBindings()}}if(f.length>0){var h={};h.selectedDimensions=[];h.selectedDimensions=t.formObjectForFilters(f);t.oModelForDimensions.getData().selectedDimensions=h.selectedDimensions;t.oModelForDimensions.updateBindings()}}if(d.PROPERTIES.results.length>0){t.getView().getModel().setProperty("/PROPERTIES",d.PROPERTIES.results);t.getView().getModel().updateBindings()}t.getView().getModel().setProperty("/VALUES_SOURCE",d.VALUES_SOURCE);if(d.VALUES.results.length>0){for(i=0;i<d.VALUES.results.length;i++){if(d.VALUES.results[i].FIXED){t.populateTargetAndTresholds(d.VALUES.results[i].TYPE,d.VALUES.results[i].FIXED)}else{t.populateTargetAndTresholds(d.VALUES.results[i].TYPE,d.VALUES.results[i].COLUMN_NAME)}}}t.busyDialog.close()},function(e){t.busyDialog.close();sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_EVALUATION_DOES_NOT_EXIST"))})},function(e){t.busyDialog.close();sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_KPI_DOES_NOT_EXIST"))})},populateAdditionalMeasures:function(t,v){var a=this;var m=a.getView().byId('targetThresholdPanel').getContent()[0].byId("additionalMeasures");m.addToken(new sap.m.Token({text:v}));a.getView().byId('targetThresholdPanel').getContent()[0].byId("selectAdditionalMeasuresCheckBox").setSelected(true);a.getView().byId('targetThresholdPanel').getContent()[0].byId('additionalMeasures').setVisible(true)},populateTargetAndTresholds:function(t,v){var a=this;switch(t){case"CL":a.getView().getModel().setProperty("/CRITICALLOW",v);break;case"WL":a.getView().getModel().setProperty("/WARNINGLOW",v);break;case"TA":a.getView().getModel().setProperty("/TARGET",v);break;case"CH":a.getView().getModel().setProperty("/CRITICALHIGH",v);break;case"WH":a.getView().getModel().setProperty("/WARNINGHIGH",v);break;case"TC":a.getView().getModel().setProperty("/TREND",v);break;case"RE":a.getView().getModel().setProperty("/REFERENCE_VALUE",v);break;default:a.populateAdditionalMeasures(t,v)}},formObjectForFilters:function(l){var i=0,j=0,k=0,t=[],a;for(i=0;i<l.length;i++){if(l[i].OPERATOR=="BT"){a={};a={"name":l[i].NAME,"operator":l[i].OPERATOR,"value_1":l[i].VALUE_1,"value_2":l[i].VALUE_2};t[j++]=a}else{for(k=0;k<t.length;k++){if((t[k].name==l[i].NAME)&&(t[k].operator==l[i].OPERATOR)){break}}if(k==t.length){a={};a={"name":l[i].NAME,"operator":l[i].OPERATOR,"value_1":l[i].VALUE_1,"value_2":l[i].VALUE_2};t[j++]=a}else{t[k].value_1+=","+l[i].VALUE_1}}}return t},getKpiDetails:function(){var t=this;if(!t.indicatorContext){t.busyDialog.close();t.indicatorContext="INDICATORS_MODELER(ID='"+t.getView().getModel().getData().INDICATOR+"',IS_ACTIVE=1)"}t.oDataModel.read(t.indicatorContext,null,"$expand=TAGS,PROPERTIES",true,function(d){t.getView().getModel().setProperty("/INDICATOR",d.ID);if(d.IS_ACTIVE==0){sap.m.MessageToast.show(t.oResourceBundle.getText("ERROR_INACTIVE_KPI_CANNOT_HAVE_EVALUATION"));window.location.hash="FioriApplication-SBWorkspace?sap-system=HANA&/detail/INDICATORS_MODELER(ID='"+t.getView().getModel().getData().INDICATOR+"',IS_ACTIVE=0)";return}t.getView().byId("indicatorId").setValueState("None");t.getView().getModel().setProperty("/DESCRIPTION",d.DESCRIPTION);if(d.TAGS.results.length>0){var a="";for(var i=0;i<d.TAGS.results.length;i++){a+=d.TAGS.results[i].TAG+","}a=a.substring(0,a.length-1);t.getView().getModel().setProperty("/TAG",a)}t.getView().getModel().setProperty("/OWNER_NAME",d.OWNER_NAME);t.getView().getModel().setProperty("/OWNER_ID",d.OWNER_ID);t.getView().getModel().setProperty("/OWNER_E_MAIL",d.OWNER_E_MAIL);if(d.PROPERTIES.results.length>0){t.getView().getModel().setProperty("/PROPERTIES",d.PROPERTIES.results);t.getView().getModel().updateBindings()}if(d.DATA_SPECIFICATION!=""){t.getView().getModel().setProperty("/DATA_SPECIFICATION",d.DATA_SPECIFICATION);t.byId("additionalInfo").setVisible(true)}else{t.byId("additionalInfo").setVisible(false)}t.getView().getModel().setProperty("/DATA_SPECIFICATION",d.DATA_SPECIFICATION);t.getView().getModel().setProperty("/SEMANTIC_OBJECT",d.SEMANTIC_OBJECT);t.getView().getModel().setProperty("/ACTION",d.ACTION);t.getView().getModel().setProperty("/INDICATOR_TYPE",d.TYPE);t.getView().getModel().setProperty("/VIEW_NAME",d.VIEW_NAME);t.getView().getModel().setProperty("/ODATA_URL",d.ODATA_URL);t.createTargetThresholdLayout();if(d.ODATA_ENTITYSET){t.getView().getModel().setProperty("/ODATA_ENTITYSET",d.ODATA_ENTITYSET);t.resetDimensionsAndInputParameters();try{t.populateDimensionsAndInputParameters(t.getView().getModel().getProperty("/ODATA_URL"),t.getView().getModel().getProperty("/ODATA_ENTITYSET"));t.oModelForMeasure=t.populateMeasure(t.getView().getModel().getProperty("/ODATA_URL"),t.getView().getModel().getProperty("/ODATA_ENTITYSET"))}catch(e){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_WRONG_ENTITY_SET"),t.oResourceBundle.getText("ERROR_ODATA_ANALYTICS"));t.resetDimensionsAndInputParameters()}}t.getView().getModel().setProperty("/COLUMN_NAME",d.COLUMN_NAME);t.getView().getModel().setProperty("/GOAL_TYPE",d.GOAL_TYPE);t.busyDialog.close()},function(e){t.busyDialog.close();t.getView().byId("indicatorId").setValueState("Error");sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_KPI_DOES_NOT_EXIST"))})},getEvalParamPayload:function(f){var e={};e.ID=f.ID;e.DESCRIPTION=f.DESCRIPTION;e.INDICATOR=f.INDICATOR;e.ODATA_URL=f.ODATA_URL;e.VIEW_NAME=f.VIEW_NAME;e.COLUMN_NAME=f.COLUMN_NAME;e.OWNER_NAME=f.OWNER_NAME;e.OWNER_E_MAIL=f.OWNER_E_MAIL;e.OWNER_ID=f.OWNER_ID;e.CREATED_BY="";e.CHANGED_BY="";e.IS_ACTIVE=f.IS_ACTIVE;e.SCALING=parseInt(f.SCALING)||0;e.TITLE=f.TITLE;e.ENTITY_TYPE="";e.ODATA_ENTITYSET=f.ODATA_ENTITYSET;e.ODATA_PROPERTY="";e.SEMANTIC_OBJECT=f.SEMANTIC_OBJECT;e.ACTION=f.ACTION;e.DATA_SPECIFICATION=f.DATA_SPECIFICATION;e.GOAL_TYPE=f.GOAL_TYPE;e.INDICATOR_TYPE=f.INDICATOR_TYPE;e.VALUES_SOURCE=f.VALUES_SOURCE;return e},setFilterPayload:function(i,t,n,o,v,a){var b={};b.ID=i;b.IS_ACTIVE=this.getView().getModel().getData().IS_ACTIVE;b.TYPE=t;b.NAME=n;b.OPERATOR=o;b.VALUE_1=v;if(a)b.VALUE_2=a;else b.VALUE_2="";return b},getInputParamPayload:function(f){var e={},j=0;var a=f.getModel().getData();if(f.getController().oModelForInputParameters){e=f.getController().oModelForInputParameters.getData();if(e.inputParameters){if(e.inputParameters.length>0){var i=0,b=[],c;while(i<e.inputParameters.length){if(e.inputParameters[i].operator==="BT"){if((e[i].value_1!=="")||(e[i].value_2!=="")){b=e.inputParameters[i].value_1.split(",");c=e.inputParameters[i].value_2.split(",");if((c.length===1)&&(!b.length===1)){e.inputParameters[i].value_1=(e.inputParameters[i].propertyType=="Edm.DateTime")?new Date(e.inputParameters[i].value_1).toJSON():e.inputParameters[i].value_1;e.inputParameters[i].value_2=(e.inputParameters[i].propertyType=="Edm.DateTime")?new Date(e.inputParameters[i].value_2).toJSON():e.inputParameters[i].value_2;this.evalFiltersPayload[j]={};this.evalFiltersPayload[j]=this.setFilterPayload(a.ID,"PA",e.inputParameters[i].name,e.inputParameters[i].operator,e.inputParameters[i].value_1,e.inputParameters[i].value_2);j++}}}else{b=e.inputParameters[i].value_1.split(",");if(b.length>0){for(var k=0;k<b.length;k++){if(b[k]!==""){b[k]=(e.inputParameters[i].propertyType=="Edm.DateTime")?new Date(b[k]).toJSON():b[k];this.evalFiltersPayload[j]={};this.evalFiltersPayload[j]=this.setFilterPayload(a.ID,"PA",e.inputParameters[i].name,e.inputParameters[i].operator,b[k]);j++}}}}i++}}}}},getFiltersPayload:function(f){var a=f.getModel().getData();var e={},j=this.evalFiltersPayload.length;if(f.getController().oModelForDimensions){e=f.getController().oModelForDimensions.getData();if(e.selectedDimensions){if(e.selectedDimensions.length>0){var i=0,b=[],c;while(i<e.selectedDimensions.length){if(e.selectedDimensions[i].operator==="BT"){if((e.selectedDimensions[i].value_1!=="")&&(e.selectedDimensions[i].value_2!=="")){b=e.selectedDimensions[i].value_1.split(",");c=e.selectedDimensions[i].value_2.split(",");if((c.length===1)||(!b.length===1)){e.selectedDimensions[i].value_1=(e.selectedDimensions[i].propertyType=="Edm.DateTime")?new Date(e.selectedDimensions[i].value_1).toJSON():e.selectedDimensions[i].value_1;e.selectedDimensions[i].value_2=(e.selectedDimensions[i].propertyType=="Edm.DateTime")?new Date(e.selectedDimensions[i].value_2).toJSON():e.selectedDimensions[i].value_2;this.evalFiltersPayload[j]={};this.evalFiltersPayload[j]=this.setFilterPayload(a.ID,"FI",e.selectedDimensions[i].name,e.selectedDimensions[i].operator,e.selectedDimensions[i].value_1,e.selectedDimensions[i].value_2);j++}}}else{b=e.selectedDimensions[i].value_1.split(",");if(b.length>0){for(var k=0;k<b.length;k++){if(b[k]!=""){b[k]=(e.selectedDimensions[i].propertyType=="Edm.DateTime")?new Date(b[k]).toJSON():b[k];this.evalFiltersPayload[j]={};this.evalFiltersPayload[j]=this.setFilterPayload(a.ID,"FI",e.selectedDimensions[i].name,e.selectedDimensions[i].operator,b[k]);j++}}}}i++}}}}},getThresholdValue:function(i,t,s,v){var o={};o.ID=i;o.TYPE=t;o.IS_ACTIVE=s;var f=this.getView();var a=f.getModel().getData();var b=a.VALUES_SOURCE;if(b==="MEASURE"){o.COLUMN_NAME=v}if(b==="FIXED"){o.FIXED=v}o.ODATA_PROPERTY="";return o},getRangePayload:function(f){var a=f.getModel().getData();var i=0;if(a.CRITICALHIGH&&a.CRITICALHIGH!==""){this.valuesPayload[i]=this.getThresholdValue(a.ID,"CH",a.IS_ACTIVE,a.CRITICALHIGH);i++}if(a.WARNINGHIGH&&a.WARNINGHIGH!==""){this.valuesPayload[i]=this.getThresholdValue(a.ID,"WH",a.IS_ACTIVE,a.WARNINGHIGH);i++}if(a.TARGET&&a.TARGET!==""){this.valuesPayload[i]=this.getThresholdValue(a.ID,"TA",a.IS_ACTIVE,a.TARGET);i++}if(a.CRITICALLOW&&a.CRITICALLOW!==""){this.valuesPayload[i]=this.getThresholdValue(a.ID,"CL",a.IS_ACTIVE,a.CRITICALLOW);i++}if(a.WARNINGLOW&&a.WARNINGLOW!==""){this.valuesPayload[i]=this.getThresholdValue(a.ID,"WL",a.IS_ACTIVE,a.WARNINGLOW);i++}},getMaximizingPayload:function(f){var a=f.getModel().getData();var i=this.valuesPayload.length;if(a.TARGET&&a.TARGET!==""){this.valuesPayload[i]=this.getThresholdValue(a.ID,"TA",a.IS_ACTIVE,a.TARGET);i++}if(a.CRITICALLOW&&a.CRITICALLOW!==""){this.valuesPayload[i]=this.getThresholdValue(a.ID,"CL",a.IS_ACTIVE,a.CRITICALLOW);i++}if(a.WARNINGLOW&&a.WARNINGLOW!==""){this.valuesPayload[i]=this.getThresholdValue(a.ID,"WL",a.IS_ACTIVE,a.WARNINGLOW);i++}},getMinimizingPayload:function(f){var a=f.getModel().getData();var i=this.valuesPayload.length;if(a.CRITICALHIGH&&a.CRITICALHIGH!==""){this.valuesPayload[i]=this.getThresholdValue(a.ID,"CH",a.IS_ACTIVE,a.CRITICALHIGH);i++}if(a.WARNINGHIGH&&a.WARNINGHIGH!==""){this.valuesPayload[i]=this.getThresholdValue(a.ID,"WH",a.IS_ACTIVE,a.WARNINGHIGH);i++}if(a.TARGET&&a.TARGET!==""){this.valuesPayload[i]=this.getThresholdValue(a.ID,"TA",a.IS_ACTIVE,a.TARGET);i++}},saveFilters:function(f){this.evalFiltersPayload=[];this.getInputParamPayload(f);this.getFiltersPayload(f)},saveValues:function(f){var t=this;this.valuesPayload=[];var a=f.getModel().getData();switch(a.GOAL_TYPE){case"RA":t.getRangePayload(f);break;case"MA":t.getMaximizingPayload(f);break;case"MI":t.getMinimizingPayload(f);break}if(a.TREND&&a.TREND!==""){var i=this.valuesPayload.length;this.valuesPayload[i]=this.getThresholdValue(a.ID,"TC",a.IS_ACTIVE,a.TREND);i++}if(a.REFERENCE_VALUE&&a.REFERENCE_VALUE!==""){var i=this.valuesPayload.length;this.valuesPayload[i]=this.getThresholdValue(a.ID,"RE",a.IS_ACTIVE,a.REFERENCE_VALUE);i++}if(t.getView().byId('targetThresholdPanel').getContent()[0].byId("additionalMeasures").getTokens().length){var b=t.getView().byId('targetThresholdPanel').getContent()[0].byId("additionalMeasures").getTokens();for(var i=0,j=this.valuesPayload.length;i<b.length;i++){var c="0";if(i.toString().length===1){c="0"+i}else{c=i.toString()}this.valuesPayload[j++]={ID:a.ID,IS_ACTIVE:a.IS_ACTIVE,TYPE:c,COLUMN_NAME:b[i].getText(),ODATA_PROPERTY:""}}}},saveTags:function(f){var a=f.getModel().getData();this.tagsPayload=[];if(a.TAG){var t=[];t=a.TAG.split(",");for(var i=0;i<t.length;i++){this.tagsPayload[i]={};this.tagsPayload[i].ID=a.ID;this.tagsPayload[i].IS_ACTIVE=a.IS_ACTIVE;this.tagsPayload[i].TYPE="EV";this.tagsPayload[i].TAG=t[i]}}},saveProperties:function(f){var a=f.getModel().getData();this.propPayload=[];if(a.PROPERTIES){for(var i=0;i<a.PROPERTIES.length;i++){this.propPayload[i]={};this.propPayload[i].ID=a.ID;this.propPayload[i].IS_ACTIVE=a.IS_ACTIVE;this.propPayload[i].TYPE="EV";this.propPayload[i].NAME=a.PROPERTIES[i].NAME;this.propPayload[i].VALUE=a.PROPERTIES[i].VALUE}}},saveAdditionalLanguages:function(f){var t=this;var a=f.getModel().getData();this.languagesPayload=[];if(a.NO_OF_ADDITIONAL_LANGUAGES>0){var i=0,j=0,k=0,b;t.oDataModel.read("/LANGUAGE",null,null,false,function(d){while(i<a.ADDITIONAL_LANGUAGE_ARRAY.length){b=a.ADDITIONAL_LANGUAGE_ARRAY[i].LANGUAGE_KEY;for(j=0;j<d.results.length;j++){if(d.results[j].LAISO===b){a.ADDITIONAL_LANGUAGE_ARRAY[i].LANGUAGE=d.results[j].SPRAS;a.ADDITIONAL_LANGUAGE_ARRAY[i].LANGUAGE_KEY=d.results[j].LAISO;break}}i++}});for(i=0;i<a.ADDITIONAL_LANGUAGE_ARRAY.length;i++){this.languagesPayload[i]={};this.languagesPayload[i].ID=a.ID;this.languagesPayload[i].IS_ACTIVE=a.IS_ACTIVE;this.languagesPayload[i].LANGUAGE=a.ADDITIONAL_LANGUAGE_ARRAY[i].LANGUAGE;this.languagesPayload[i].LANGUAGE_KEY=a.ADDITIONAL_LANGUAGE_ARRAY[i].LANGUAGE_KEY;this.languagesPayload[i].TITLE=a.ADDITIONAL_LANGUAGE_ARRAY[i].TITLE;this.languagesPayload[i].DESCRIPTION=a.ADDITIONAL_LANGUAGE_ARRAY[i].DESCRIPTION}}},createBatchForEvalCreateMode:function(e){var t=this;t.evalPayload={};t.evalPayload.ID=t.evalParamPayload.ID;t.evalPayload.IS_ACTIVE=t.evalParamPayload.IS_ACTIVE;t.evalPayload.EVALUATION=t.evalParamPayload;delete t.evalPayload.EVALUATION.ID;delete t.evalPayload.EVALUATION.IS_ACTIVE;t.evalPayload.FILTERS=[];t.evalPayload.FILTERS=t.evalFiltersPayload;for(var i=0;i<t.evalPayload.FILTERS.length;i++){delete t.evalPayload.FILTERS[i].ID;delete t.evalPayload.FILTERS[i].IS_ACTIVE}t.evalPayload.VALUES=[];t.evalPayload.VALUES=t.valuesPayload;for(var i=0;i<t.evalPayload.VALUES.length;i++){delete t.evalPayload.VALUES[i].ID;delete t.evalPayload.VALUES[i].IS_ACTIVE}t.evalPayload.TAGS=[];t.evalPayload.TAGS=t.tagsPayload;for(var i=0;i<t.evalPayload.TAGS.length;i++){delete t.evalPayload.TAGS[i].ID;delete t.evalPayload.TAGS[i].IS_ACTIVE}t.evalPayload.PROPERTIES=[];t.evalPayload.PROPERTIES=t.propPayload;for(var i=0;i<t.evalPayload.PROPERTIES.length;i++){delete t.evalPayload.PROPERTIES[i].ID;delete t.evalPayload.PROPERTIES[i].IS_ACTIVE}t.evalPayload.TEXTS=[];t.evalPayload.TEXTS=t.languagesPayload;for(var i=0;i<t.evalPayload.TEXTS.length;i++){delete t.evalPayload.TEXTS[i].ID;delete t.evalPayload.TEXTS[i].IS_ACTIVE;delete t.evalPayload.TEXTS[i].LANGUAGE_KEY}var u=sap.suite.smartbusiness.utils.serviceUrl("EVALUATION_SERVICE_URI");sap.suite.smartbusiness.utils.create(u,t.evalPayload,null,function(d){t.saveSuccessHandling(e)},function(a){t.saveErrorHandling(a)})},createBatchPayload:function(e){var t=this,i=0;var p,u=false;var a={};var b={};var f=t.getView().getModel().getData();a.ID=f.ID;a.IS_ACTIVE=f.IS_ACTIVE;b.oldPayload=t.getEvalParamPayload(t.evalDetails);b.newPayload=t.evalParamPayload;b.objectType="Evaluations";b=sap.suite.smartbusiness.utils.dirtyBitCheck(b);if(b.updates.length>0){a.EVALUATION={};a.EVALUATION.update={};a.EVALUATION.update=t.evalParamPayload;delete a.EVALUATION.update.ID;delete a.EVALUATION.update.IS_ACTIVE;u=true}b.oldPayload=t.evalDetails.FILTERS.results;b.newPayload=t.evalFiltersPayload;b.objectType="EVALUATION_FILTERS";b=sap.suite.smartbusiness.utils.dirtyBitCheck(b);a.FILTERS={};if(b.deletes.length>0){for(i=0;i<b.deletes.length;i++){delete b.deletes[i].ID;delete b.deletes[i].IS_ACTIVE}a.FILTERS.remove=b.deletes;u=true}if(b.updates.length>0){for(var i=0;i<b.updates.length;i++){delete b.updates[i].ID;delete b.updates[i].IS_ACTIVE}a.FILTERS.create=b.updates;u=true}for(i=0;i<t.evalDetails.VALUES.results.length;i++){if(t.evalDetails.VALUES.results[i].COLUMN_NAME){delete t.evalDetails.VALUES.results[i].FIXED}else{delete t.evalDetails.VALUES.results[i].COLUMN_NAME}}b.oldPayload=t.evalDetails.VALUES.results;b.newPayload=t.valuesPayload;b.objectType="EVALUATION_VALUES";b=sap.suite.smartbusiness.utils.dirtyBitCheck(b);a.VALUES={};if(b.deletes.length>0){for(var i=0;i<b.deletes;i++){delete b.deletes[i].ID;delete b.deletes[i].IS_ACTIVE}a.VALUES.remove=b.deletes;u=true}if(b.updates.length>0){for(var i=0;i<b.updates.length;i++){delete b.updates[i].ID;delete b.updates[i].IS_ACTIVE}a.VALUES.create=b.updates;u=true}b.oldPayload=t.evalDetails.TAGS.results;b.newPayload=t.tagsPayload;b.objectType="TAGS";b=sap.suite.smartbusiness.utils.dirtyBitCheck(b);a.TAGS={};if(b.deletes.length>0){for(i=0;i<b.deletes.length;i++){delete b.deletes[i].ID;delete b.deletes[i].IS_ACTIVE}a.TAGS.remove=b.deletes;u=true}if(b.updates.length>0){for(var i=0;i<b.updates.length;i++){delete b.updates[i].ID;delete b.updates[i].IS_ACTIVE}a.TAGS.create=b.updates;u=true}b.oldPayload=t.evalDetails.PROPERTIES.results;b.newPayload=t.propPayload;b.objectType="PROPERTIES";b=sap.suite.smartbusiness.utils.dirtyBitCheck(b);a.PROPERTIES={};if(b.deletes.length>0){for(i=0;i<b.deletes.length;i++){delete b.deletes[i].ID;delete b.deletes[i].IS_ACTIVE}a.PROPERTIES.remove=b.deletes;u=true}if(b.updates.length>0){for(var i=0;i<b.updates.length;i++){delete b.updates[i].ID;delete b.updates[i].IS_ACTIVE}a.PROPERTIES.create=b.updates;u=true}b.oldPayload=t.evalDetails.ADDITIONAL_LANGUAGE_ARRAY;b.newPayload=t.languagesPayload;b.objectType="EVALUATION_TEXTS";b=sap.suite.smartbusiness.utils.dirtyBitCheck(b);a.TEXTS={};if(b.deletes.length>0){for(i=0;i<b.deletes.length;i++){delete b.deletes[i].ID;delete b.deletes[i].IS_ACTIVE}a.TEXTS.remove=b.deletes;u=true}if(b.updates.length>0){for(var i=0;i<b.updates.length;i++){delete b.updates[i].ID;delete b.updates[i].IS_ACTIVE}a.TEXTS.create=b.updates;u=true}if(!u){t.busyDialog.close();t.saveSuccessHandling(e);return}else{var c=sap.suite.smartbusiness.utils.serviceUrl("EVALUATION_SERVICE_URI");sap.suite.smartbusiness.utils.update(c,a,null,function(d){t.saveSuccessHandling(e)},function(d){t.saveErrorHandling(d)})}},saveErrorHandling:function(e){var t=this;sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_EVAL_SAVE"));t.busyDialog.close()},saveSuccessHandling:function(e){var t=this;sap.m.MessageToast.show(t.oResourceBundle.getText("SUCCESS_EVAL_SAVE"));if(e==="activate"||e==="saveActivate"){var o={};o.ID=t.getView().getModel().getData().ID;var u=sap.suite.smartbusiness.utils.serviceUrl("ACTIVATE_EVALUATION_SERVICE_URI");sap.suite.smartbusiness.utils.create(u,o,null,function(d){t.busyDialog.close();sap.m.MessageToast.show(t.oResourceBundle.getText("SUCCESS_EVAL_ACTIVATE"));if(e==="activate")window.location.hash="FioriApplication-configureSBKPITile?sap-system=HANA&/detail/EVALUATIONS_CHIP(ID='"+t.getView().getModel().getData().ID+"',IS_ACTIVE=1)";else if(e==="saveActivate"&&!t.fromHome)window.location.hash="FioriApplication-SBWorkspace?sap-system=HANA&/evalDetail/INDICATORS_MODELER(ID='"+t.getView().getModel().getData().INDICATOR+"',IS_ACTIVE=1)/EVALUATIONS_MODELER(ID='"+t.getView().getModel().getData().ID+"',IS_ACTIVE=1)";else if(t.fromHome){window.location.hash=""}},function(a){t.busyDialog.close();sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ACTIVATING_EVALUATION"))})}else if(e=="create"){t.busyDialog.close();if(t.fromHome){window.location.hash=""}else{if(this.editDraft){window.location.hash="FioriApplication-SBWorkspace?sap-system=HANA&/evalDetail/INDICATORS_MODELER(ID='"+t.getView().getModel().getData().INDICATOR+"',IS_ACTIVE=1)/EVALUATIONS_MODELER(ID='"+t.getView().getModel().getData().ID+"',IS_ACTIVE=1)"}else if(t.duplicateEval){window.location.hash="FioriApplication-SBWorkspace?sap-system=HANA&/evalDetail/INDICATORS_MODELER(ID='"+t.getView().getModel().getData().INDICATOR+"',IS_ACTIVE=1)/EVALUATIONS_MODELER(ID='"+t.getView().getModel().getData().ID+"',IS_ACTIVE=0)"}else if(t.evalDetails){var i=t.evalDetails.IS_ACTIVE;window.location.hash="FioriApplication-SBWorkspace?sap-system=HANA&/evalDetail/INDICATORS_MODELER(ID='"+t.getView().getModel().getData().INDICATOR+"',IS_ACTIVE=1)/EVALUATIONS_MODELER(ID='"+t.getView().getModel().getData().ID+"',IS_ACTIVE="+i+")"}else{window.location.hash="FioriApplication-SBWorkspace?sap-system=HANA&/evalDetail/INDICATORS_MODELER(ID='"+t.getView().getModel().getData().INDICATOR+"',IS_ACTIVE=1)/EVALUATIONS_MODELER(ID='"+t.getView().getModel().getData().ID+"',IS_ACTIVE=0)"}}}else if(e=="createNew"){t.busyDialog.close();t.byId("evalId").setEditable(true);t.getView().getModel().setData({});t.getView().getModel().setProperty("/NO_OF_ADDITIONAL_LANGUAGES",0);t.getKpiDetails();window.location.hash="FioriApplication-createSBKPIEvaluation&/addEvaluation/"+t.indicatorContext}t.busyDialog.close()},saveAndExit:function(e){var t=this;t.createBatch=[];t.deleteBatch=[];var f=t.getView().getModel().getData();if(!f.INDICATOR){t.byId("indicatorId").setValueState("Error");sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_SELECT_KPI"));return}if(t.byId("indicatorId").getValueState()==="Error"){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_KPI_DOES_NOT_EXIST"));return}if(t.byId("evalOwnerEmail").getValueState()==="Error"){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_VALID_EVAL_E_MAIL"));return}if(f.mode==="edit"){if(!f.ID){t.byId("evalId").setValueState("Error");sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_EVALUATION_ID"));return}if(t.byId("evalId").getValueState()==="Error"){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_VALID_EVAL_ID"));return}}else{if(!t.validateEvalId()){if(!f.ID){t.byId("evalId").setValueState("Error");sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_EVALUATION_ID"));return}if(t.byId("evalId").getValueState()==="Error"){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_VALID_EVAL_ID"));return}}else{return}}if(f.VALUES_SOURCE==="FIXED"){var v=this.validateEvaluationValues(this.getView().getModel().getData());if(v.length){var m=this.oResourceBundle.getText("ERROR_ENTER_VALID_THRESHOLD_VALUES");var i;for(i=0;i<v.length;i++){if(v[i]==="CL"){if(this.getView().getModel().getData().GOAL_TYPE==="RA"){m=m+"\n"+this.oResourceBundle.getText("CRITICAL_LOW")}else{m=m+"\n"+this.oResourceBundle.getText("CRITICAL")}}if(v[i]==="WL"){if(this.getView().getModel().getData().GOAL_TYPE==="RA"){m=m+"\n"+this.oResourceBundle.getText("WARNING_LOW")}else{m=m+"\n"+this.oResourceBundle.getText("WARNING")}}if(v[i]==="TA"){m=m+"\n"+this.oResourceBundle.getText("TARGET")}if(v[i]==="CH"){if(this.getView().getModel().getData().GOAL_TYPE==="RA"){m=m+"\n"+this.oResourceBundle.getText("CRITICAL_HIGH")}else{m=m+"\n"+this.oResourceBundle.getText("CRITICAL")}}if(v[i]==="WH"){if(this.getView().getModel().getData().GOAL_TYPE==="RA"){m=m+"\n"+this.oResourceBundle.getText("WARNING_HIGH")}else{m=m+"\n"+this.oResourceBundle.getText("WARNING")}}}sap.suite.smartbusiness.utils.showErrorMessage(m);return}}if(!t.indicatorContext){t.indicatorContext="INDICATORS_MODELER(ID='"+f.INDICATOR+"',IS_ACTIVE=1)"}t.busyDialog.open();t.evalParamPayload={};t.evalParamPayload=t.getEvalParamPayload(t.getView().getModel().getData());t.saveFilters(t.getView());t.saveValues(t.getView());t.saveTags(t.getView());t.saveProperties(t.getView());t.saveAdditionalLanguages(t.getView());if(!e){e="create"}if(f.mode==="create"){t.createBatch=t.createBatchForEvalCreateMode(e)}else if(f.mode==="edit"){if(t.evalDetails.IS_ACTIVE===0&&f.IS_ACTIVE===0){t.createBatchPayload(e)}else if(t.evalDetails.IS_ACTIVE===1&&f.IS_ACTIVE===0){t.getView().getModel().setProperty("/mode","create");t.createBatch=t.createBatchForEvalCreateMode(e)}}},saveAndCreateNew:function(e){this.saveAndExit("createNew")},saveAndActivate:function(){var t=this;t.checkForActivation("saveActivate")},checkForActivation:function(p){var t=this;var f=t.getView().getModel().getData();if(!f.TITLE||f.TITLE===""){t.byId("evalTitle").setValueState("Error");sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_EVALUATION_TITLE"));return}var e=t.validateDimensionsAndInputParameters();if(e.error){if(e.errorType==="mandatoryFieldEmpty"){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_ALL_INPUT_PARAMETERS"));return}if(e.errorType==="fieldEmpty"){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_ALL_DIMENSION_VALUES"));return}if(e.errorType==="invalidEntry"){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_INVALID_TEXT_FOR",e.errorDimension.name));return}}if(f.ODATA_URL===""){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_ODATA_URL"));return}if(f.ODATA_ENTITYSET===""){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_ENTITY_SET"));return}if(f.COLUMN_NAME===""){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_MEASURE"));return}if(t.getView().byId('targetThresholdPanel').getContent()[0].byId("additionalMeasures").getTokens().length){var a=t.byId('targetThresholdPanel').getContent()[0].byId("additionalMeasures").getTokens();for(var i=0,l=a.length;i<l;i++){if(a[i].getText()==f.COLUMN_NAME){t.byId('targetThresholdPanel').getContent()[0].byId("additionalMeasures").setValueState("Error");sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ADDI_MEASURE_HAS_MAIN_MEASURE"));return}}}if(!f.TARGET||f.TARGET==""){var b=new sap.m.Dialog({icon:"sap-icon://warning2",title:t.oResourceBundle.getText("WARNING"),state:"Warning",type:"Message",content:[new sap.m.Text({text:t.oResourceBundle.getText("ERROR_TARGET_NOT_ENTERED")})],beginButton:new sap.m.Button({text:t.oResourceBundle.getText("CONTINUE"),press:function(){b.close();t.saveAndExit(p)}}),endButton:new sap.m.Button({text:t.oResourceBundle.getText("CANCEL"),press:function(){b.close()}})});b.open()}else{t.saveAndExit(p)}},activateAndAddTiles:function(){var t=this;t.checkForActivation("activate")},cancel:function(){this.navigateBack()},deleteDraft:function(){var t=this;var o={};o.ID=t.getView().getModel().getData().ID;o.IS_ACTIVE=t.getView().getModel().getData().IS_ACTIVE;var u=sap.suite.smartbusiness.utils.serviceUrl("EVALUATION_SERVICE_URI");sap.suite.smartbusiness.utils.remove(u,o,function(d){sap.m.MessageToast.show(t.oResourceBundle.getText("SUCCESS_DELETING_DRAFT"));window.location.hash="FioriApplication-SBWorkspace?sap-system=HANA&/detail/INDICATORS_MODELER(ID='"+t.getView().getModel().getData().INDICATOR+"',IS_ACTIVE=1)"},function(e){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_DELETING_DRAFT"))})},validateEvalId:function(){var t=this;var e=this.getView().byId('evalId');var i=0;var a=e.getValue();if(a){if(!(/^[a-zA-Z0-9.]*$/.test(a))){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_VALID_EVAL_ID"));e.setValueState("Error");return true}else{e.setValueState("None");this.oDataModel.read("/EVALUATIONS",null,"$filter=ID eq '"+a+"'",true,function(d){if(d.results.length>0){if(d.results[0].ID){e.setValueState("Error");sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_EVAL_WITH_ID_EXISTS",a));return true}else{e.setValueState("None")}}else{e.setValueState("None")}},function(){e.setValueState("None")})}}return false},validateEmailAddress:function(){var t=this;var e=this.getView().byId('evalOwnerEmail');var a=e.getValue();if(a){if(!(/^\w+[\w-\.]*\@\w+((-\w+)|(\w*))\.[a-z]/.test(a))){e.setValueState("Error");sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_VALID_EVAL_E_MAIL"))}else{e.setValueState("None")}}else{e.setValueState("None")}},listAllKpis:function(){var t=this;var h=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_KPI"),noDataText:t.oResourceBundle.getText("NO_DATA_FOUND"),items:{path:"/INDICATORS_MODELER",template:new sap.m.ObjectListItem({title:"{TITLE}",number:"{EVALUATION_COUNT}",firstStatus:new sap.m.ObjectStatus({text:"Evaluations",}),attributes:[new sap.m.ObjectAttribute({text:"{ID}"})]})},confirm:function(e){t.busyDialog.open();t.indicatorContext="INDICATORS_MODELER(ID='"+e.getParameter("selectedItem").getBindingContext().getProperty("ID")+"',IS_ACTIVE=1)";t.getKpiDetails()},liveChange:function(e){var s="'"+e.getParameter("value").toLowerCase()+"'";var F=new sap.ui.model.Filter("tolower(ID)",sap.ui.model.FilterOperator.Contains,s);var o=new sap.ui.model.Filter("tolower(TITLE)",sap.ui.model.FilterOperator.Contains,s);var a=new sap.ui.model.Filter("IS_ACTIVE",sap.ui.model.FilterOperator.EQ,1);var b=e.getSource().getBinding("items");var c=new sap.ui.model.Filter([F,o],false);var d=new sap.ui.model.Filter([a],true);b.filter(new sap.ui.model.Filter([c,d],true))}});h.setModel(t.oDataModel);var f=[];f.push(new sap.ui.model.Filter("IS_ACTIVE",sap.ui.model.FilterOperator.EQ,1));h.getBinding("items").filter(new sap.ui.model.Filter(f,true));h.open()},handleHanaViewValueHelp:function(){var t=this;var h=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_VIEW"),noDataText:t.oResourceBundle.getText("NO_DATA_FOUND"),items:{path:"/HANA_VIEWS",template:new sap.m.StandardListItem({title:{parts:[{path:"OBJECT",type:new sap.ui.model.type.String()},{path:"PACKAGE",type:new sap.ui.model.type.String()},{path:"SUFFIX",type:new sap.ui.model.type.String()}],formatter:function(o,p,s){if(s.indexOf("view")!=-1)return p+"/"+o;else return p+"::"+o}},description:"{SUFFIX}"})},confirm:function(e){t.getView().getModel().setProperty("/VIEW_NAME",e.getParameter("selectedItem").getProperty("title"));t.getView().getModel().setProperty("/ODATA_URL","");t.getView().getModel().setProperty("/ODATA_ENTITYSET","");t.getView().getModel().setProperty("/COLUMN_NAME","");t.resetAdditionalMeasures();t.currentSelectedHanaViewObject=e.getParameter("selectedItem").getBindingContext().getObject()},liveChange:function(e){var s="'"+e.getParameter("value").toLowerCase()+"'";var f=new sap.ui.model.Filter("tolower(PACKAGE)",sap.ui.model.FilterOperator.Contains,s);var F=new sap.ui.model.Filter("tolower(OBJECT)",sap.ui.model.FilterOperator.Contains,s);var b=e.getSource().getBinding("items");b.filter(new sap.ui.model.Filter([f,F],false))}});h.setModel(this.oDataModel);h.open()},hanaViewChange:function(v){var t=this;t.getView().getModel().setProperty("/ODATA_URL","");t.getView().getModel().setProperty("/ODATA_ENTITYSET","");t.getView().getModel().setProperty("/COLUMN_NAME","");t.resetAdditionalMeasures();t.resetDimensionsAndInputParameters()},handleOdataServiceValueHelp:function(){var t=this;if(!t.byId("viewInput").getValue()){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_A_HANA_VIEW"))}else{var a=t.getView().getModel().getProperty("/VIEW_NAME");a=(a.indexOf("/")!=-1?a.split("/"):a.split("::"));var h=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_ODATA_SERVICE"),noDataText:t.oResourceBundle.getText("NO_DATA_FOUND"),items:{path:"/ODATA_FOR_ENTITY(P_PACKAGE='"+a[0]+"',P_OBJECT='"+a[1]+"')/Results",template:new sap.m.StandardListItem({title:{parts:[{path:"PACKAGE",type:new sap.ui.model.type.String()},{path:"OBJECT",type:new sap.ui.model.type.String()}],formatter:function(o,p,s){o=o.replace(/\./g,'/');return"/"+o+"/"+p+".xsodata"}},})},confirm:function(e){t.getView().getModel().setProperty("/ODATA_URL",e.getParameter("selectedItem").getProperty("title"));t.getView().getModel().setProperty("/ODATA_ENTITYSET","");t.getView().getModel().setProperty("/COLUMN_NAME","");t.resetAdditionalMeasures();t.currentSelectedODataUrlObject=e.getParameter("selectedItem").getBindingContext().getObject()},liveChange:function(e){var s="'"+e.getParameter("value").toLowerCase()+"'";var f=new sap.ui.model.Filter("tolower(PACKAGE)",sap.ui.model.FilterOperator.Contains,s);var F=new sap.ui.model.Filter("tolower(OBJECT)",sap.ui.model.FilterOperator.Contains,s);var b=e.getSource().getBinding("items");b.filter(new sap.ui.model.Filter([f,F],false))}});h.setModel(t.oDataModel);h.open()}},oDataUrlChange:function(v){var t=this;t.getView().getModel().setProperty("/ODATA_ENTITYSET","");t.getView().getModel().setProperty("/COLUMN_NAME","");t.resetAdditionalMeasures();t.resetDimensionsAndInputParameters()},handleEntitySetValueHelp:function(){var t=this;if(!t.byId("odataServiceInput").getValue()){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_ODATA_URL"))}else{var t=this;t.oModelForEntity;var h=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_ENTITY_SET"),noDataText:t.oResourceBundle.getText("NO_DATA_FOUND"),items:{path:"/entitySet",template:new sap.m.StandardListItem({title:{parts:[{path:"entityName",type:new sap.ui.model.type.String()}],formatter:function(o,s){return o}},})},confirm:function(E){t.getView().getModel().setProperty("/ODATA_ENTITYSET",E.getParameter("selectedItem").getProperty("title"));t.resetDimensionsAndInputParameters();t.resetAdditionalMeasures();try{t.populateDimensionsAndInputParameters(t.getView().getModel().getProperty("/ODATA_URL"),t.getView().getModel().getProperty("/ODATA_ENTITYSET"))}catch(e){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_WRONG_ENTITY_SET"),t.oResourceBundle.getText("ERROR_ODATA_ANALYTICS"));t.resetDimensionsAndInputParameters()}},liveChange:function(e){var s="'"+e.getParameter("value").toLowerCase()+"'";var f=new sap.ui.model.Filter("tolower(entityName)",sap.ui.model.FilterOperator.Contains,s);var b=e.getSource().getBinding("items");b.filter(new sap.ui.model.Filter([f],false))}});try{if(t.getView().getModel().getData().VIEW_NAME){t.populateRelevantEntitySet(h)}else{t.oModelForEntity=t.populateEntitySet(t.getView().byId("odataServiceInput").getValue());h.setModel(t.oModelForEntity);h.open()}}catch(a){}}},entitySetChange:function(v){var t=this;t.resetAdditionalMeasures();if(t.getView().getModel().getProperty("/ODATA_URL")&&t.getView().getModel().getProperty("/ODATA_ENTITYSET")){try{t.populateDimensionsAndInputParameters(t.getView().getModel().getProperty("/ODATA_URL"),t.getView().getModel().getProperty("/ODATA_ENTITYSET"))}catch(e){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_WRONG_ENTITY_SET"),t.oResourceBundle.getText("ERROR_ODATA_ANALYTICS"));t.resetDimensionsAndInputParameters()}}else{t.resetDimensionsAndInputParameters();t.getView().getModel().setProperty("/COLUMN_NAME","")}},handleMeasureValueHelp:function(){var t=this;var t=this;if(!t.byId("entitySetInput").getValue()){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_ENTITY_SET"))}else{try{t.oModelForMeasure=t.populateMeasure(t.getView().getModel().getProperty("/ODATA_URL"),t.getView().getModel().getProperty("/ODATA_ENTITYSET"))}catch(e){}var h=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_MEASURE"),noDataText:t.oResourceBundle.getText("NO_DATA_FOUND"),items:{path:"/measures",template:new sap.m.StandardListItem({title:{parts:[{path:"measureName",type:new sap.ui.model.type.String()}],formatter:function(o,s){return o}},})},confirm:function(E){t.getView().getModel().setProperty("/COLUMN_NAME",E.getParameter("selectedItem").getProperty("title"))},liveChange:function(E){var s="'"+E.getParameter("value").toLowerCase()+"'";var f=new sap.ui.model.Filter("tolower(measureName)",sap.ui.model.FilterOperator.Contains,s);var b=E.getSource().getBinding("items");b.filter(new sap.ui.model.Filter([f],false))}});h.setModel(t.oModelForMeasure);h.open()}},measureChange:function(v){var t=this;try{t.oModelForMeasure=t.populateMeasure(t.getView().getModel().getProperty("/ODATA_URL"),t.getView().getModel().getProperty("/ODATA_ENTITYSET"))}catch(e){}},handleChangeAdditionalInfo:function(e){var t=this;t.getView().getModel().setProperty("info",t.getView().byId("additionalInfoId"))},populateRelevantEntitySet:function(d){var t=this;var m=this.getView().getModel().getData();var o=m.ODATA_URL.substr(0,m.ODATA_URL.lastIndexOf("/"));o=o.replace(/\//g,'.').replace(".","");var b=m.ODATA_URL.substr(m.ODATA_URL.lastIndexOf("/")+1);b=b.split(".")[0];var e="/ODATA_FOR_ENTITY(P_PACKAGE='"+m.VIEW_NAME.split("/")[0]+"',P_OBJECT='"+m.VIEW_NAME.split("/")[1]+"')/Results?$filter=PACKAGE eq '"+o+"' and OBJECT eq '"+b+"'";this.oApplicationFacade.getODataModel().read(e,null,null,false,function(c){if(c.results&&c.results.length){var f=c.results[0].CDATA_STR;d.open();if(f){var g=f.split("\n");for(var i=0,l=g.length;i<l;i++){if(g[i].indexOf("//")!=-1){g[i]=g[i].substr(0,g[i].indexOf("//"))}}f=g.join("\n");while(f.indexOf("/*")!=-1){var s=f.indexOf("/*");var h=f.indexOf("*/");h=(h==-1)?f.length:(h-2);f=f.substr(0,s)+f.substr(h)}}var j=[];var M=new sap.ui.model.json.JSONModel();var a=f.split(m.VIEW_NAME.split("/")[0]+'::'+m.VIEW_NAME.split("/")[1]);if(a.length==1){a=f.split(m.VIEW_NAME.split("/")[0]+'/'+m.VIEW_NAME.split("/")[1])}if(a.length==1){sap.m.MessageToast.show("OData Document not compatible");M=t.populateEntitySet(t.getView().byId("odataServiceInput").getValue());d.setModel(M);return}for(var i=1,l=a.length;i<l;i++){var k={};k.entityName=a[i].split('"')[2];j.push(k)}M.setData({entitySet:j});d.setModel(M);return}},function(a){})},populateEntitySet:function(d){var c=this;var m=new sap.ui.model.json.JSONModel();var r=[],e=[],o={};var i;r=sap.suite.smartbusiness.odata.getAllEntitySet(d);for(i=0;i<r.length;i++){o={};o.entityName=r[i];e.push(o)}m.setData({entitySet:e});return m},validateQueryServiceURI:function(d){d=jQuery.trim(d);if(!jQuery.sap.startsWith(d,"/")){d="/"+d}if(jQuery.sap.endsWith(d,"/")){d=d.substring(0,d.length-1)}return d},populateMeasure:function(d,e){d=this.validateQueryServiceURI(d)+"";e=e+"";var m=[],a=[],o={};var i;m=sap.suite.smartbusiness.odata.getAllMeasures(d,e);for(i=0;i<m.length;i++){o={};o.measureName=m[i];a.push(o)}var M=new sap.ui.model.json.JSONModel();M.setData({measures:a});return M},additionalInformationForKpi:function(e){var t=this;t.dialogAdditionalInfo=new sap.m.Dialog({type:"Message",title:t.oResourceBundle.getText("ADDITIONAL_INFO_FROM_KPI"),content:[new sap.m.Label({text:{path:'/DATA_SPECIFICATION',formatter:function(v){if(t.getView().getModel().getData().DATA_SPECIFICATION){return t.getView().getModel().getData().DATA_SPECIFICATION}else{return t.oResourceBundle.getText("ERROR_NO_DATA_TO_DISPLAY")}}}})],beginButton:new sap.m.Button({text:t.oResourceBundle.getText("CLOSE"),press:function(E){E.getSource().getParent().close()}})});t.dialogAdditionalInfo.setModel(t.getView().getModel());t.dialogAdditionalInfo.open()},addNewProperty:function(){if(this.getView().byId("propertyName").getValue()){this.getView().byId("propertyName").setValueState("None");if(this.getView().byId("propertyValue").getValue()){this.getView().byId("propertyValue").setValueState("None");var p=this.getView().byId('propertyNameValueBox').getModel();p.getData().PROPERTIES=p.getData().PROPERTIES||[];for(var i=0;i<p.getData().PROPERTIES.length;i++){if((p.getData().PROPERTIES[i].NAME===this.getView().byId("propertyName").getValue())&&(p.getData().PROPERTIES[i].VALUE===this.getView().byId("propertyValue").getValue())){sap.suite.smartbusiness.utils.showErrorMessage(this.oResourceBundle.getText("ERROR_PROPERTY_VALUE_PAIR_EXISTS"));return}}p.getData().PROPERTIES.push({NAME:this.getView().byId("propertyName").getValue(),VALUE:this.getView().byId("propertyValue").getValue()});p.updateBindings();this.getView().byId("propertyName").setValue("");this.getView().byId("propertyValue").setValue("")}else{this.getView().byId("propertyValue").setValueState("Error");sap.suite.smartbusiness.utils.showErrorMessage(that.oResourceBundle.getText("ERROR_ENTER_PROPERTY_VALUE"))}}else{this.getView().byId("propertyName").setValueState("Error");sap.suite.smartbusiness.utils.showErrorMessage(that.oResourceBundle.getText("ERROR_ENTER_PROPERTY_NAME"))}},removeProperty:function(e){var p=e.getSource().getBindingContext().getPath();e.getSource().getBindingContext().getModel().getData().PROPERTIES.splice(p.substring(p.lastIndexOf("/")+1),1);e.getSource().getBindingContext().getModel().updateBindings()},populateDimensionsAndInputParameters:function(d,e){var a=[];var b=[];this.oData4SAPAnalyticsModel=new sap.suite.smartbusiness.odata4analytics.Model(new sap.suite.smartbusiness.odata4analytics.Model.ReferenceByURI(d),null);this.queryResultObj=this.oData4SAPAnalyticsModel.findQueryResultByName(e);var q=this.queryResultObj.getAllDimensions();for(k in q){var n=q[k].getName();var p=q[k].getKeyProperty().type;var c={name:n,propertyType:p};a.push(c)}var f=this.oModelForDimensions.getData();f.dimensions=a;f.dataSource=d;f.entitySet=e;if(f.selectedDimensions){for(var k in f.selectedDimensions){f.selectedDimensions[k].propertyType=this.queryResultObj.findDimensionByName(f.selectedDimensions[k].name)?this.queryResultObj.findDimensionByName(f.selectedDimensions[k].name).getKeyProperty().type:"";if(f.selectedDimensions[k].propertyType=="Edm.DateTime"){var v=f.selectedDimensions[k].value_1.split(",");for(i in v){if(v[i]!=""){var g=new Date(v[i]);var m=g.getMonth()+1;m=/^\d$/.test(m)?"0"+m:m;var h=g.getDate();h=/^\d$/.test(h)?"0"+h:h;var j=g.getHours();j=/^\d$/.test(j)?"0"+j:j;var l=g.getMinutes();l=/^\d$/.test(l)?"0"+l:l;var s=g.getSeconds();s=/^\d$/.test(s)?"0"+s:s;v[i]=g.getFullYear()+"-"+m+"-"+h+" "+j+":"+l+":"+s+"."+g.getMilliseconds()}}f.selectedDimensions[k].value_1=v.join(",");v=null;v=f.selectedDimensions[k].value_2.split(",");for(var i in v){if(v[i]!=""){var g=new Date(f.selectedDimensions[k].value_2);var m=g.getMonth()+1;m=/^\d$/.test(m)?"0"+m:m;var h=g.getDate();h=/^\d$/.test(h)?"0"+h:h;var j=g.getHours();j=/^\d$/.test(j)?"0"+j:j;var l=g.getMinutes();l=/^\d$/.test(l)?"0"+l:l;var s=g.getSeconds();s=/^\d$/.test(s)?"0"+s:s;v[i]=g.getFullYear()+"-"+m+"-"+h+" "+j+":"+l+":"+s+"."+g.getMilliseconds()}}f.selectedDimensions[k].value_2=v.join(",");this.dimensionValue[f.selectedDimensions[k].name]=this.dimensionValue[f.selectedDimensions[k].name]?this.dimensionValue[f.selectedDimensions[k].name]:{};this.dimensionValue[f.selectedDimensions[k].name]["value_1"]=f.selectedDimensions[k].value_1;this.dimensionValue[f.selectedDimensions[k].name]["value_2"]=f.selectedDimensions[k].value_2}}}this.oModelForDimensions.setData(f);var o=this.queryResultObj.getParameterization();if(o){if(this.oModelForInputParameters.getData().inputParameters){var b=this.oModelForInputParameters.getData().inputParameters;for(var k in b){b[k].propertyType=o.findParameterByName(b[k].name).getProperty().type;if(b[k].propertyType=="Edm.DateTime"){var v=b[k].value_1.split(",");for(i in v){if(v[i]!=""){var g=new Date(v[i]);var m=g.getMonth()+1;m=/^\d$/.test(m)?"0"+m:m;var h=g.getDate();h=/^\d$/.test(h)?"0"+h:h;var j=g.getHours();j=/^\d$/.test(j)?"0"+j:j;var l=g.getMinutes();l=/^\d$/.test(l)?"0"+l:l;var s=g.getSeconds();s=/^\d$/.test(s)?"0"+s:s;v[i]=g.getFullYear()+"-"+m+"-"+h+" "+j+":"+l+":"+s+"."+g.getMilliseconds()}}b[k].value_1=v.join(",");v=null;v=b[k].value_2.split(",");for(var i in v){if(v[i]!=""){var g=new Date(f.selectedDimensions[k].value_2);var m=g.getMonth()+1;m=/^\d$/.test(m)?"0"+m:m;var h=g.getDate();h=/^\d$/.test(h)?"0"+h:h;var j=g.getHours();j=/^\d$/.test(j)?"0"+j:j;var l=g.getMinutes();l=/^\d$/.test(l)?"0"+l:l;var s=g.getSeconds();s=/^\d$/.test(s)?"0"+s:s;v[i]=g.getFullYear()+"-"+m+"-"+h+" "+j+":"+l+":"+s+"."+g.getMilliseconds()}}b[k].value_2=v.join(",")}}}else{var r=o.getAllParameters();for(var k in r){var n=r[k].getName();var p=r[k].getProperty().type;var t=r[k].isOptional();var c={name:n,propertyType:p,operator:"EQ",value_1:"",value_2:""};b.push(c)}}if(b.length>0)this.byId("inputParameterLayoutHeaders").setVisible(true);f=this.oModelForInputParameters.getData();f.inputParameters=b;this.oModelForInputParameters.setData(f)}},setInputParameterAndFilterLayout:function(){var t=this;this.dimensionValueHelpDialogs={};this.dimensionValue={};this.byId("inputParameterLayoutHeaders").setVisible(false);this.byId("inputParameterBaseLayout").setModel(this.oModelForInputParameters);this.byId("inputParameterBaseLayout").bindAggregation("items","/inputParameters",function(i,c){var a=new sap.m.Select({width:"100%",customData:[{key:"valueType",value:"value_1"}],items:[new sap.ui.core.Item({text:t.oResourceBundle.getText("EQUAL_TO"),key:"EQ"})],selectedKey:"{operator}",layoutData:new sap.ui.layout.GridData({span:"L4 M4"})});var b=new sap.m.Input({value:"{value_1}",customData:[{key:"valueType",value:"value_1"}],valueHelpRequest:jQuery.proxy(t.openInputParameterValueHelpDialog,t),change:jQuery.proxy(t.handleDimensionValueChange,t),valueState:{path:"error_1",formatter:function(e){if(e)return"Error";else return"None"}},layoutData:new sap.ui.layout.GridData({span:"L4 M4"})});var d=new sap.ui.layout.Grid({defaultSpan:"L9 M9",content:[new sap.m.Input({value:"{name}",editable:false,layoutData:new sap.ui.layout.GridData({span:"L4 M4"})}),a,b]});return d});this.byId("dimensionLayoutHeaders").setVisible(false);this.byId("baseDimensionLayout").setModel(this.oModelForDimensions);this.byId("baseDimensionLayout").bindAggregation("items","/selectedDimensions",function(i,c){var d=new sap.m.Select({width:"100%",customData:[{key:"valueType",value:"value_1"}],items:[new sap.ui.core.Item({text:t.oResourceBundle.getText("EQUAL_TO"),key:"EQ"}),new sap.ui.core.Item({text:t.oResourceBundle.getText("GREATER_THAN"),key:"GT"}),new sap.ui.core.Item({text:t.oResourceBundle.getText("LESS_THAN"),key:"LT"}),new sap.ui.core.Item({text:t.oResourceBundle.getText("NOT_EQUAL_TO"),key:"NE"}),new sap.ui.core.Item({text:t.oResourceBundle.getText("BETWEEN"),key:"BT"})],selectedKey:"{operator}",change:jQuery.proxy(t.handleOperatorChange,t),layoutData:new sap.ui.layout.GridData({span:"L3 M3"})});var a=new sap.m.Input({value:"{value_1}",customData:[{key:"valueType",value:"value_1"}],showValueHelp:true,valueState:{path:"error_1",formatter:function(j){if(j)return"Error";else return"None"}},valueHelpRequest:jQuery.proxy(t.handleDimensionValueHelp,t),change:jQuery.proxy(t.handleDimensionValueChange,t),layoutData:new sap.ui.layout.GridData({span:"L4 M4"})});var b=new sap.m.Input({value:"{value_2}",customData:[{key:"valueType",value:"value_2"}],showValueHelp:true,visible:{path:"operator",formatter:function(o){return(o==="BT")?true:false}},valueState:{path:"error_2",formatter:function(j){if(j)return"Error";else return"None"}},valueHelpRequest:jQuery.proxy(t.handleDimensionValueToHelp,t),change:jQuery.proxy(t.handleDimensionValueChange,t),layoutData:new sap.ui.layout.GridData({span:"L4 M4"})});var e=new sap.m.Label({text:"To",visible:{path:"operator",formatter:function(o){return(o==="BT")?true:false}}});var f=new sap.m.VBox({items:[a,e,b],layoutData:new sap.ui.layout.GridData({span:"L4 M4"})});var g=new sap.m.Button({icon:"sap-icon://sys-cancel",type:"Transparent",layoutData:new sap.ui.layout.GridData({span:"L2 M2 S2"}),press:function(j){var p=j.getSource().getBindingContext().getPath();if(t.dimensionValue){if(t.dimensionValue[j.getSource().getBindingContext().getObject().name]){delete t.dimensionValue[j.getSource().getBindingContext().getObject().name]}}j.getSource().getBindingContext().getModel().getData().selectedDimensions.splice(p.substring(p.lastIndexOf("/")+1),1);j.getSource().getBindingContext().getModel().updateBindings();if(j.getSource().getBindingContext().getModel().getData().selectedDimensions.length==0){t.byId("dimensionLayoutHeaders").setVisible(false)}}});var h=new sap.ui.layout.Grid({defaultSpan:"L12 M12",content:[new sap.m.Input({value:"{name}",editable:false,layoutData:new sap.ui.layout.GridData({span:"L3 M3"})}),d,f,g]});return h})},openInputParameterValueHelpDialog:function(n){var t=this;var i=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_VALUES"),multiSelect:true,rememberSelections:true,items:{path:"/results",template:new sap.m.StandardListItem({title:"{"+n+"}",})},confirm:function(e){},liveChange:function(e){}});i.setGrowingThreshold(100);i.open()},openDimensionDialog:function(){var t=this;if(!this.dimensionDialog){var s=new sap.ui.model.Sorter("name",false);this.dimensionDialog=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_DIMENSIONS"),multiSelect:true,items:{path:"/dimensions",sorter:s,template:new sap.m.StandardListItem({title:"{name}"})},confirm:function(e){var a=t.oModelForDimensions.getData().selectedDimensions||[];var b=e.getParameter("selectedItems");var c=[];for(var k in b){c[k]=b[k].getBindingContext()}for(var k in c){var d=t._cloneObj(c[k].getObject());d.value_1="";d.value_2="";d.operator="EQ";a.push(d)}if(c.length>0)t.byId("dimensionLayoutHeaders").setVisible(true);else t.byId("dimensionLayoutHeaders").setVisible(false);t.oModelForDimensions.setProperty("/selectedDimensions",a)},liveChange:function(e){var a=e.getParameter("value");var f=new sap.ui.model.Filter("name",sap.ui.model.FilterOperator.Contains,a);var b=e.getSource().getBinding("items");b.filter([f])}});this.dimensionDialog.setGrowingThreshold(100);this.dimensionDialog.setModel(this.oModelForDimensions)}this.dimensionDialog.open()},handleDimensionValueHelp:function(e){this.openDimensionValueHelpDialog(e,"value_1")},handleDimensionValueToHelp:function(e){this.openDimensionValueHelpDialog(e,"value_2")},openDimensionValueHelpDialog:function(e,v){var t=this;var p=e.getSource();var b=this.getView().getModel();var d=new sap.ui.model.json.JSONModel();var a=[];this.dimensionContext=e.getSource().getBindingContext();var c=e.getSource().getBindingContext().getProperty("name");var f=e.getSource().getBindingContext().getProperty("operator");var g=e.getSource().getBindingContext().getProperty("propertyType");var h=this.oModelForInputParameters.getData().inputParameters;for(var l in h){a.push({OPERATOR:h[l].operator,NAME:h[l].name,VALUE_1:h[l].value_1,VALUE_2:h[l].value_2,TYPE:"PA"})}var q=sap.suite.smartbusiness.odata.getUri({serviceUri:b.getProperty("/ODATA_URL"),entitySet:b.getProperty("/ODATA_ENTITYSET"),filter:a,dimension:c});q.model.read(q.uri,null,null,false,function(r){if(t.dimensionValue[c]){t.dimensionValue[c][v]=t.dimensionValue[c][v]?t.dimensionValue[c][v]:"";var u=t.dimensionValue[c][v]===""?null:t.dimensionValue[c][v].split(",");for(l in u){var w=true;for(var i in r.results){if(g=="Edm.DateTime"){var x=new Date(u[l]).toJSON();var y=new Date(r.results[i][c]).toJSON();if(x==y){w=false;break}}else if(u[l]===r.results[i][c]){w=false;break}}if(w){var z={};z[c]=u[l];z.userInput=true;z.selected=true;r.results.push(z)}else r.results[i].selected=true}}d.setData(r)},function(r){});var s=new sap.ui.model.Sorter(c,false,function(r){if(r.getProperty("userInput")===true)return{key:"USER_VALUES",text:t.oResourceBundle.getText("VALUES_ENTERED_BY_USER")};else return{key:"SERVICE_VALUES",text:t.oResourceBundle.getText("VALUES_FETCHED_FROM_SERVICE")}});this.dimensionValueHelpDialogs=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_VALUES"),multiSelect:true,rememberSelections:true,items:{path:"/results",sorter:s,template:new sap.m.StandardListItem({title:"{"+c+"}",selected:"{selected}"})},confirm:function(e){var r="";var C=e.getParameter("selectedContexts");for(var l in C){if(g=="Edm.DateTime"){var u=new Date(C[l].getProperty(t.dimensionContext.getProperty("name")));var w=u.getMonth()+1;w=/^\d$/.test(w)?"0"+w:w;var x=u.getDate();x=/^\d$/.test(x)?"0"+x:x;var y=u.getHours();y=/^\d$/.test(y)?"0"+y:y;var z=u.getMinutes();z=/^\d$/.test(z)?"0"+z:z;var A=u.getSeconds();A=/^\d$/.test(A)?"0"+A:A;r=r+u.getFullYear()+"-"+w+"-"+x+" "+y+":"+z+":"+A+"."+u.getMilliseconds()+","}else r=r+C[l].getProperty(t.dimensionContext.getProperty("name"))+","}r=r.substring(0,r.length-1);t.oModelForDimensions.setProperty(t.dimensionContext.getPath()+"/"+v,r);p.fireChange({value:r});t.dimensionValue[c]=t.dimensionValue[c]?t.dimensionValue[c]:{};t.dimensionValue[c][v]=r},liveChange:function(e){var r=e.getParameter("value");var F=new sap.ui.model.Filter(c,sap.ui.model.FilterOperator.Contains,r);var B=e.getSource().getBinding("items");B.filter([F])}});this.dimensionValueHelpDialogs.setGrowingThreshold(100);this.dimensionValueHelpDialogs.setModel(d);var m=this.oModelForDimensions.getData().selectedDimensions;var n=this.dimensionValueHelpDialogs.getItems();for(var i=0;i<m.length;i++){if((c===m[i].name)&&(f===m[i].operator)){var o;if(m[i].operator==="BT"){if(v==="value_1")o=m[i].value_1.split(",");else o=m[i].value_2.split(",")}else{o=m[i].value_1.split(",")}for(var j=0;j<o.length;j++){for(var k=1;k<n.length;k++){if(o[j]===n[k].getTitle()){n[k].setSelected(true)}}}}}this.dimensionValueHelpDialogs.open();for(var i=1;i<n.length;i++){if(!n[i].getSelected()){this.dimensionValueHelpDialogs.getItems()[i].setSelected(true);this.dimensionValueHelpDialogs.getItems()[i].setSelected(false)}}},handleDimensionValueChange:function(e){this.validateValue(e,"dimensionValue");var v=e.getSource().getCustomData()[0].getValue();var d=e.getSource().getBindingContext().getProperty("name");if(!this.dimensionValue[d])this.dimensionValue[d]={};this.dimensionValue[d][v]=e.getParameter("value")},validateValue:function(e,s){var t=this,r;var d=e.getSource().getBindingContext().getProperty("name");var v=e.getSource().getCustomData()[0].getValue();var a=(s==="dimensionValue")?e.getParameter("value").split(","):e.getSource().getBindingContext().getProperty("value_1");var o=e.getSource().getBindingContext().getProperty("operator");if(o==="BT"){if(a.length>1){r=false;sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_MULTIPLE_VALUES_FOR_BETWEEN",d));var p=v==="value_1"?e.getSource().getBindingContext().getPath()+"/error_1":e.getSource().getBindingContext().getPath()+"/error_2";e.getSource().getModel().setProperty(p,true);return}else{var p=v==="value_1"?e.getSource().getBindingContext().getPath()+"/error_1":e.getSource().getBindingContext().getPath()+"/error_2";e.getSource().getModel().setProperty(p,false)}}var b=e.getSource().getBindingContext().getProperty("propertyType");var c,f;for(var k in a){r=true;var g=/<(script)(.*)\/?>/i;var j=/function\s*[^\(]*\(\s*([^\)]*)\)/;var h=/[^\(]*\(\s*([^\)]*)\)\s*{/;if(g.test(a[k])||j.test(a[k])||h.test(a[k])){r=false;c=t.oResourceBundle.getText("ERROR_INVALID_TEXT_FOR",d)}if(b=="Edm.Int32"||b=="Edm.Int16"||b=="Edm.Int64"){f=/^[-+]?\d+$/;r=f.test(a[k])?true:false;c=t.oResourceBundle.getText("ERROR_INVALID_ENTRY_ENTER_INTEGER",d)}else if(b=="Edm.Decimal"){f=/^[-+]?\d+(\.\d+)?$/;r=f.test(a[k])?true:false;c=t.oResourceBundle.getText("ERROR_INVALID_ENTRY_ENTER_DECIMAL",d)}else if(b=="Edm.DateTime"){f=/^[1-9][0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])(\s([0-1][0-9]|2[0-3]):[0-5][0-9]:([0-9]|[0-5][0-9])[.][0-9]+)?$/;r=f.test(a[k])?true:false;c=t.oResourceBundle.getText("ERROR_INVALID_ENTRY_ENTER_DATE",d)}if(!r){sap.suite.smartbusiness.utils.showErrorMessage(c);var p=v==="value_1"?e.getSource().getBindingContext().getPath()+"/error_1":e.getSource().getBindingContext().getPath()+"/error_2";e.getSource().getModel().setProperty(p,true);return}else{var p=v==="value_1"?e.getSource().getBindingContext().getPath()+"/error_1":e.getSource().getBindingContext().getPath()+"/error_2";e.getSource().getModel().setProperty(p,false)}}},handleOperatorChange:function(e){var c=e.getSource().getBindingContext();c.getObject().value_1="";if(this.dimensionValue){if(this.dimensionValue[c.getObject().name]){this.dimensionValue[c.getObject().name].value_1=""}}if(c.getProperty("operator")==="BT"){c.getObject().value_2="";if(this.dimensionValue){if(this.dimensionValue[c.getObject().name]){this.dimensionValue[c.getObject().name].value_2=""}}}c.getModel().updateBindings()},validateDimensionsAndInputParameters:function(){var i=this.oModelForInputParameters.getData().inputParameters;var d=this.oModelForDimensions.getData().selectedDimensions;var e=false;var a="";var b="";for(var k in i){if(i[k].error_1===true||i[k].error_2===true)e=true;if(i[k].value_1===""){e=true;a="mandatoryFieldEmpty";i[k].error_1=true}}this.oModelForInputParameters.updateBindings();for(var k in d){if(d[k].error_1===true||d[k].error_2===true){e=true;a="invalidEntry";b=d[k]}if(d[k].value_1===""){e=true;a="fieldEmpty";d[k].error_1=true}if(d[k].operator==="BT"&&d[k].value_2===""){e=true;a="fieldEmpty";d[k].error_2=true}}this.oModelForDimensions.updateBindings();return{error:e,errorType:a,errorDimension:b}},resetDimensionsAndInputParameters:function(){this.oModelForDimensions.setData({});this.oModelForInputParameters.setData({});this.dimensionDialog=null;this.dimensionValueHelpDialogs={};this.dimensionValue={};this.byId("inputParameterLayoutHeaders").setVisible(false);this.byId("dimensionLayoutHeaders").setVisible(false)},createTargetThresholdLayout:function(){var t=this;var a=this.getView().getModel().getData().TREND;var r=this.getView().getModel().getData().REFERENCE_VALUE;if(this.getView().getModel().getData().INDICATOR){this.getView().byId('targetThresholdPanel').setVisible(true);this.getView().byId('targetThresholdPanel').getContent()[0].destroy();if(this.getView().getModel().getData().mode!=="edit"){delete this.getView().getModel().getData().CRITICALHIGH;delete this.getView().getModel().getData().WARNINGHIGH;delete this.getView().getModel().getData().TARGET;delete this.getView().getModel().getData().WARNINGLOW;delete this.getView().getModel().getData().CRITICALLOW;delete this.getView().getModel().getData().TREND;delete this.getView().getModel().getData().REFERENCE_VALUE}t.getView().byId('targetThresholdPanel').addContent(new sap.ui.core.mvc.XMLView({viewName:"sap.suite.ui.smartbusiness.designtime.evaluation.view.createEvalTargetThresholdTrendInput",viewData:{controller:t}}))}if(!this.getView().getModel().getData().INDICATOR){this.getView().byId('targetThresholdPanel').setVisible(false)}this.getView().getModel().setProperty("TREND",a);this.getView().getModel().setProperty("REFERENCE_VALUE",r)},addAdditionalLanguageDialog:function(){var t=this;this.additionalLanguageListModel=new sap.ui.model.json.JSONModel();this.additionalLanguageListModelData=jQuery.extend([],t.getView().getModel().getData().ADDITIONAL_LANGUAGE_ARRAY);this.getView().getModel().getData().NO_OF_ADDITIONAL_LANGUAGES=this.additionalLanguageListModelData.length;this.additionalLanguageListModel.setData(this.additionalLanguageListModelData);this.languageTextInput=new sap.m.Input({layoutData:new sap.ui.layout.GridData({span:"L8 M8 S8"})});this.languageDescriptionInput=new sap.m.TextArea({layoutData:new sap.ui.layout.GridData({span:"L8 M8 S8"})});this.languageKeySelect=new sap.m.Select({layoutData:new sap.ui.layout.GridData({span:"L6 M6 S6"})});this.addedLanguagesList=new sap.m.List({layoutData:new sap.ui.layout.GridData({span:"L5 M5 S5"}),});this.addedLanguagesList.bindItems("additionalLanguageListModel>/",new sap.m.CustomListItem({content:new sap.ui.layout.Grid({hSpacing:1,vSpacing:0,defaultSpan:"L12 M12 S12",content:[new sap.m.Input({value:"{additionalLanguageListModel>TITLE}",design:"Bold",layoutData:new sap.ui.layout.GridData({span:"L12 M12 S12",vAlign:"Middle"}),editable:false}),new sap.m.Input({value:"{additionalLanguageListModel>DESCRIPTION}",design:"Bold",layoutData:new sap.ui.layout.GridData({span:"L6 M6 S6",vAlign:"Middle"}),editable:false}),new sap.m.Input({value:"{additionalLanguageListModel>LANGUAGE_KEY}",design:"Bold",layoutData:new sap.ui.layout.GridData({span:"L4 M4 S4"}),editable:false}),new sap.m.Button({icon:"sap-icon://sys-cancel",type:"Transparent",press:function(e){var d=e.getSource().getBindingContext("additionalLanguageListModel").getPath().substr(1);var n=t.addedLanguagesList.getModel("additionalLanguageListModel").getData().splice(d,1);t.addedLanguagesList.getModel("additionalLanguageListModel").updateBindings()},layoutData:new sap.ui.layout.GridData({span:"L2 M2 S2"})})]})}));this.addedLanguagesList.setModel(t.additionalLanguageListModel,"additionalLanguageListModel");var a=new sap.m.Dialog({contentHeight:"50%",contentWidth:"25%",title:this.oApplicationFacade.getResourceBundle().getText("ADDITIONAL_LANGUAGE"),content:[new sap.ui.layout.Grid({hSpacing:1,vSpacing:4,defaultSpan:"L12 M12 S12",content:[new sap.ui.layout.form.SimpleForm({editable:true,layout:"ResponsiveGridLayout",content:[new sap.m.Label({text:t.oResourceBundle.getText("TITLE"),layoutData:new sap.ui.layout.GridData({span:"L3 M3 S3",})}),t.languageTextInput,new sap.m.Label({text:t.oResourceBundle.getText("DESCRIPTION"),layoutData:new sap.ui.layout.GridData({span:"L3 M3 S3",})}),t.languageDescriptionInput,new sap.m.Label({text:t.oResourceBundle.getText("LANGUAGE"),layoutData:new sap.ui.layout.GridData({span:"L3 M3 S3"})}),t.languageKeySelect,new sap.m.Button({icon:"sap-icon://add",layoutData:new sap.ui.layout.GridData({span:"L2 M2 S2"}),press:function(){if(t.languageTextInput.getValue()||t.languageDescriptionInput.getValue()){for(var i=0;i<t.addedLanguagesList.getModel("additionalLanguageListModel").getData().length;i++){if(t.addedLanguagesList.getModel("additionalLanguageListModel").getData()[i].LANGUAGE_KEY===t.languageKeySelect.getSelectedItem().getKey()){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_LANGUAGE_EXISTS",t.languageKeySelect.getSelectedItem().getKey()));return}}var b={"TITLE":t.languageTextInput.getValue(),"DESCRIPTION":t.languageDescriptionInput.getValue(),"LANGUAGE_KEY":t.languageKeySelect.getSelectedItem().getKey()};t.addedLanguagesList.getModel("additionalLanguageListModel").getData().push(b);t.addedLanguagesList.getModel("additionalLanguageListModel").updateBindings();t.languageTextInput.setValue("");t.languageDescriptionInput.setValue("")}}})]})]}).addStyleClass("languageGrid"),t.addedLanguagesList],beginButton:new sap.m.Button({text:t.oResourceBundle.getText("OK"),press:function(){a.close();t.getView().getModel().getData().ADDITIONAL_LANGUAGE_ARRAY=t.addedLanguagesList.getModel("additionalLanguageListModel").getData();t.getView().getModel().getData().NO_OF_ADDITIONAL_LANGUAGES=t.getView().getModel().getData().ADDITIONAL_LANGUAGE_ARRAY.length;t.getView().getModel().updateBindings()}}),endButton:new sap.m.Button({text:t.oResourceBundle.getText("CANCEL"),press:function(){a.close()}})});this.oDataModel.read("/LANGUAGE?$select=LAISO",null,null,false,function(d){d=d.results;for(var i=0;i<d.length;i++){if((d[i].LAISO).toUpperCase()==(sap.ui.getCore().getConfiguration().getLocale().getLanguage()).toUpperCase()){d.splice(i,1)}}var m=new sap.ui.model.json.JSONModel();m.setData(d);t.languageKeySelect.setModel(m,"otherLanguageKey");t.languageKeySelect.bindItems("otherLanguageKey>/",new sap.ui.core.Item({text:"{otherLanguageKey>LAISO}",key:"{otherLanguageKey>LAISO}"}))});a.open()},_cloneObj:function(e){var t;if(e instanceof Array){t=[];for(var i=0;i<e.length;i++){t[i]=this._cloneObj(e[i])}}else if(e instanceof Object){t={};for(var a in e){if(e.hasOwnProperty(a)){t[a]=this._cloneObj(e[a])}}}else{t=e}return t},formatLangCount:function(v){if(!this.getView().getModel().getData()){v=0}else v=this.getView().getModel().getData().NO_OF_ADDITIONAL_LANGUAGES;return this.oApplicationFacade.getResourceBundle().getText("ADDITIONAL_LANGUAGE")+"("+v+")"},validateEvaluationValues:function(d){d=d||this.getView().getModel().getData();var v=[];var e=[];var s=0;var c={};if(d.CRITICALLOW||d.CRITICALLOW===0){v.push({key:"CL",value:d.CRITICALLOW,score:s++})}if(d.WARNINGLOW||d.WARNINGLOW===0){v.push({key:"WL",value:d.WARNINGLOW,score:s++})}if(d.TARGET||d.TARGET===0){v.push({key:"TA",value:d.TARGET,score:s++})}if(d.WARNINGHIGH||d.WARNINGHIGH===0){v.push({key:"WH",value:d.WARNINGHIGH,score:s++})}if(d.CRITICALHIGH||d.CRITICALHIGH===0){v.push({key:"CH",value:d.CRITICALHIGH,score:s++})}v.sort(function(a,b){return(a.value-b.value)});for(var i=0,l=v.length;i<l;i++){if(v[i].score!=i){e.push(v[i].key)}if(v[i]&&v[i-1]){if(v[i].value==v[i-1].value){c[v[i-1].key]=v[i-1].value;c[v[i].key]=v[i].value}}}if(!(e.length)){e=Object.keys(c)}return e},resetAdditionalMeasures:function(){var t=this;if(t.getView().getModel().getData().ODATA_URL&&t.getView().getModel().getData().ODATA_ENTITYSET){if(t.getView().byId('targetThresholdPanel').getContent()[0].getController().measuresDialog){var m=t.getView().byId('targetThresholdPanel').getContent()[0].getController().populateMeasure(t.getView().getModel().getData().ODATA_URL,t.getView().getModel().getData().ODATA_ENTITYSET);t.getView().byId('targetThresholdPanel').getContent()[0].getController().measuresDialog.setModel(m)}}else{if(t.getView().byId('targetThresholdPanel').getContent()[0].getController().measuresDialog){var m=new sap.ui.model.json.JSONModel({});t.getView().byId('targetThresholdPanel').getContent()[0].getController().measuresDialog.setModel(m)}}t.getView().byId('targetThresholdPanel').getContent()[0].byId('additionalMeasures').removeAllTokens()}})};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.kpi.Component')){jQuery.sap.declare("sap.suite.ui.smartbusiness.designtime.kpi.Component");jQuery.sap.require('sap.ca.scfld.md.ComponentBase');sap.ca.scfld.md.ComponentBase.extend("sap.suite.ui.smartbusiness.designtime.kpi.Component",{metadata:sap.ca.scfld.md.ComponentBase.createMetaData("FS",{"name":"Fullscreen Sample","version":"1.0.0-SNAPSHOT","library":"sap.suite.ui.smartbusiness.designtime.kpi","includes":["../../lib/Util.js"],"dependencies":{"libs":["sap.m"],"components":[],},"config":{"resourceBundle":"i18n/i18n.properties","titleResource":"FULLSCREEN_TITLE","icon":"sap-icon://Fiori5/F0817","favIcon":"../../../../../../../resources/sap/ca/ui/themes/base/img/favicon/F0817_Define_New_KPI.ico","homeScreenIconPhone":"../../../../../../../resources/sap/ca/ui/themes/base/img/launchicon/F0817_Define_New_KPI/57_iPhone_Desktop_Launch.png","homeScreenIconPhone@2":"../../../../../../../resources/sap/ca/ui/themes/base/img/launchicon/F0817_Define_New_KPI/114_iPhone-Retina_Web_Clip.png","homeScreenIconTablet":"../../../../../../../resources/sap/ca/ui/themes/base/img/launchicon/F0817_Define_New_KPI/72_iPad_Desktop_Launch.png","homeScreenIconTablet@2":"../../../../../../../resources/sap/ca/ui/themes/base/img/launchicon/F0817_Define_New_KPI/144_iPad_Retina_Web_Clip.png","startupImage320x460":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/320_x_460.png","startupImage640x920":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/640_x_920.png","startupImage640x1096":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/640_x_1096.png","startupImage768x1004":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/768_x_1004.png","startupImage748x1024":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/748_x_1024.png","startupImage1536x2008":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/1536_x_2008.png","startupImage1496x2048":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/1496_x_2048.png"},viewPath:"sap.suite.ui.smartbusiness.designtime.kpi.view",fullScreenPageRoutes:{"editKpi":{"pattern":"editKpi/{contextPath}","view":"S1"},"createKpi":{"pattern":"","view":"S1"},"editDraftKpi":{"pattern":"editDraftKpi/{contextPath}","view":"S1"},"duplicateKpi":{"pattern":"duplicateKpi/{contextPath}","view":"S1"}},}),createContent:function(){var v={component:this};return sap.ui.view({viewName:"sap.suite.ui.smartbusiness.designtime.kpi.Main",type:sap.ui.core.mvc.ViewType.XML,viewData:v})}})};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.kpi.Configuration')){jQuery.sap.declare("sap.suite.ui.smartbusiness.designtime.kpi.Configuration");jQuery.sap.require('sap.ca.scfld.md.ConfigurationBase');jQuery.sap.require('sap.ca.scfld.md.app.Application');sap.ca.scfld.md.ConfigurationBase.extend("sap.suite.ui.smartbusiness.designtime.kpi.Configuration",{oServiceParams:{serviceList:[{name:"SMART_BUSINESS",masterCollection:"INDICATORS",serviceUrl:"/sap/hba/r/sb/core/odata/modeler/SMART_BUSINESS.xsodata/",isDefault:true,}]},getAppConfig:function(){return this.oAppConfig},getServiceList:function(){return this.oServiceParams.serviceList},getMasterKeyAttributes:function(){return["Id"]},getExcludedQueryStringParameters:function(){return["sap-client","sap-language"]},getHanaSystem:function(){var h=hasher||window.hasher;var a=h.getHashAsArray();if(a&&a.length&&a[0]){var b=a[0].substr(a[0].indexOf("?")+1).split("&");for(var i=0,l=b.length;i<l;i++){if(b[i]&&(b[i].indexOf("sap-system")!=-1)){return b[i].split("=")[1]}}}return""},getServiceParams:function(){if(sap.ushell&&sap.ushell.Container){var s=this.oServiceParams.serviceList[0].serviceUrl;this.oServiceParams.serviceList[0].serviceUrl=sap.ushell.Container.getService("URLParsing").addSystemToServiceUrl(s,this.getHanaSystem())}return this.oServiceParams},})};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.kpi.view.S1.controller')){jQuery.sap.declare('sap.suite.ui.smartbusiness.designtime.kpi.view.S1.controller');jQuery.sap.require('sap.ca.scfld.md.controller.BaseFullscreenController');jQuery.sap.includeStyleSheet("../../resources/sap/suite/ui/smartbusiness/designtime/kpi/view/KpiParametersCss.css");sap.ca.scfld.md.controller.BaseFullscreenController.extend("sap.suite.ui.smartbusiness.designtime.kpi.view.S1",{onInit:function(){var t=this;this.kpiCreateModel=new sap.ui.model.json.JSONModel();this.oDataModel=this.oApplicationFacade.getODataModel();this.viewData={};this.oResourceBundle=this.oApplicationFacade.getResourceBundle();this.oDataModel.read("/LANGUAGE?$filter=LAISO eq '"+(sap.ui.getCore().getConfiguration().getLocale().getLanguage()).toUpperCase()+"'",null,null,false,function(a){t.localLanguage=a.results[0].SPRAS});var o={bSuppressBookmarkButton:{},onBack:function(){t.cancel()},oEditBtn:{sI18nBtnTxt:"SAVE",onBtnPressed:function(e){t.save()}},buttonList:[{sI18nBtnTxt:"SAVE_ACTIVATE",onBtnPressed:function(e){t.saveAndActivate()}},{sI18nBtnTxt:"SAVE_CREATE_NEW",onBtnPressed:function(e){t.saveAndCreateNew()}},{sI18nBtnTxt:"ACTIVATE_ADD_EVAL",onBtnPressed:function(e){t.activateAndAddEvaluation()}},{sI18nBtnTxt:"CANCEL",onBtnPressed:function(e){t.cancel()}}]};var c={bSuppressBookmarkButton:{},sI18NFullscreenTitle:"FULLSCREEN_EDIT_TITLE",onBack:function(){t.cancel()},oEditBtn:{sI18nBtnTxt:"SAVE",onBtnPressed:function(e){t.save()}},buttonList:[{sI18nBtnTxt:"SAVE_ACTIVATE",onBtnPressed:function(e){t.saveAndActivate()}},{sI18nBtnTxt:"SAVE_CREATE_NEW",onBtnPressed:function(e){t.saveAndCreateNew()}},{sI18nBtnTxt:"ACTIVATE_ADD_EVAL",onBtnPressed:function(e){t.activateAndAddEvaluation()}},{sI18nBtnTxt:"CANCEL",onBtnPressed:function(e){t.cancel()}}]};var d={bSuppressBookmarkButton:{},sI18NFullscreenTitle:"FULLSCREEN_EDIT_TITLE",onBack:function(){t.cancel()},oEditBtn:{sI18nBtnTxt:"SAVE",onBtnPressed:function(e){t.save()}},buttonList:[{sI18nBtnTxt:"SAVE_ACTIVATE",onBtnPressed:function(e){t.saveAndActivate()}},{sI18nBtnTxt:"DELETE_DRAFT",onBtnPressed:function(e){t.deleteDraft()}},{sI18nBtnTxt:"CANCEL",onBtnPressed:function(e){t.cancel()}}]};this.setHeaderFooterOptions(o);this.oRouter.attachRouteMatched(function(f){t.route=f.getParameter("name");if(f.getParameter("name")=="editKpi"){t.context=new sap.ui.model.Context(t.getView().getModel(),'/'+(f.getParameter("arguments").contextPath));var g=(/ID=\'.*\'/).exec(f.getParameter("arguments").contextPath)[0];var k=g.slice(g.indexOf("'")+1,g.lastIndexOf("'"));var h=(/IS_ACTIVE=.*/).exec(f.getParameter("arguments").contextPath)[0];var j=h.slice(h.indexOf("=")+1,h.lastIndexOf(")"));t.viewData={mode:"EDIT",ID:k,IS_ACTIVE:parseInt(j)};if(t.viewData.IS_ACTIVE==1){t.viewData.IS_DRAFT=true}t.setHeaderFooterOptions(c);t._oControlStore.oTitle.setText(t.oResourceBundle.getText("FULLSCREEN_DYN_TITLE","Edit"));try{if(sap.ushell.services.AppConfiguration&&sap.ushell.services.AppConfiguration.setWindowTitle){sap.ushell.services.AppConfiguration.setWindowTitle(t.oResourceBundle.getText("FULLSCREEN_EDIT_TITLE"))}}catch(e){jQuery.sap.log.error("Error Setting Window Page Title : "+t.oResourceBundle.getText("FULLSCREEN_EDIT_TITLE"))}}else if(f.getParameter("name")=="editDraftKpi"){t.context=new sap.ui.model.Context(t.getView().getModel(),'/'+(f.getParameter("arguments").contextPath));var g=(/ID=\'.*\'/).exec(f.getParameter("arguments").contextPath)[0];var k=g.slice(g.indexOf("'")+1,g.lastIndexOf("'"));var h=(/IS_ACTIVE=.*/).exec(f.getParameter("arguments").contextPath)[0];var j=h.slice(h.indexOf("=")+1,h.lastIndexOf(")"));t.viewData={mode:"EDIT",ID:k,IS_ACTIVE:parseInt(j),IS_DRAFT:true};t.setHeaderFooterOptions(d);t._oControlStore.oTitle.setText(t.oResourceBundle.getText("FULLSCREEN_DYN_TITLE","Edit"));try{if(sap.ushell.services.AppConfiguration&&sap.ushell.services.AppConfiguration.setWindowTitle){sap.ushell.services.AppConfiguration.setWindowTitle(t.oResourceBundle.getText("FULLSCREEN_EDIT_TITLE"))}}catch(e){jQuery.sap.log.error("Error Setting Window Page Title : "+t.oResourceBundle.getText("FULLSCREEN_EDIT_TITLE"))}}else if(f.getParameter("name")=="duplicateKpi"){t.context=new sap.ui.model.Context(t.getView().getModel(),'/'+(f.getParameter("arguments").contextPath));var g=(/ID=\'.*\'/).exec(f.getParameter("arguments").contextPath)[0];var k=g.slice(g.indexOf("'")+1,g.lastIndexOf("'"));var h=(/IS_ACTIVE=.*/).exec(f.getParameter("arguments").contextPath)[0];var j=h.slice(h.indexOf("=")+1,h.lastIndexOf(")"));t.viewData={mode:"DUPLICATE",ID:k,IS_ACTIVE:parseInt(j)};t._oControlStore.oTitle.setText(t.oResourceBundle.getText("FULLSCREEN_DYN_TITLE","Duplicate"))}else{t.viewData={mode:"CREATE",};t._oControlStore.oTitle.setText(t.oResourceBundle.getText("FULLSCREEN_DYN_TITLE","Create"))}if(t.viewData.mode=="CREATE"){var l={};l.MODE="CREATE";l.TYPE="KPI";l.KPITYPE=true;l.OPITYPE=false;l.NO_OF_ADDITIONAL_LANGUAGES=0;l.ADDITIONAL_LANGUAGE_ARRAY=[];l.GOAL_TYPE="MA";t.kpiModelDataForDirtyBitCheck=$.extend(true,{},l);t.kpiCreateModel.setData(l);t.getView().setModel(t.kpiCreateModel)}else if(t.viewData.mode=="EDIT"||t.viewData.mode=="DUPLICATE"){t.oDataModel.read("/INDICATORS(ID='"+t.viewData.ID+"',IS_ACTIVE="+t.viewData.IS_ACTIVE+")",null,null,false,function(a){t.indicatorPayloadForDirtyBitTest=$.extend(true,{},a);a.MODE=t.viewData.mode;if(a.TYPE=="KPI"){a.KPITYPE=true;a.OPITYPE=false}else if(a.TYPE=="OPI"){a.KPITYPE=false;a.OPITYPE=true}t.oDataModel.read("/TAGS?$filter=ID eq '"+a.ID+"' and IS_ACTIVE eq "+a.IS_ACTIVE+" and TYPE eq 'IN'",null,null,false,function(b){b=b.results;var n=[];var i;for(i=0;i<b.length;i++){n.push(b[i].TAG)}a.TAGS=n;a.TAG=a.TAGS.toString(",");t.OLD_TAGS=n},function(b){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_FETCHING_TAGS"))});t.oDataModel.read("/PROPERTIES?$filter=ID eq '"+a.ID+"' and IS_ACTIVE eq "+a.IS_ACTIVE+" and TYPE eq 'IN'",null,null,false,function(p){p=p.results;var b=[];var i;for(i=0;i<p.length;i++){var n={};n.NAME=p[i].NAME,n.VALUE=p[i].VALUE;b.push(n)}a.PROPERTIES=b;t.OLD_PROPERTIES=$.extend(true,[],b)},function(b){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_FETCHING_PROPERTIES"))});t.oDataModel.read("/INDICATOR_TEXTS?$filter=ID eq '"+a.ID+"' and IS_ACTIVE eq "+a.IS_ACTIVE,null,null,false,function(b){b=b.results;var n=[];var i;for(i=0;i<b.length;i++){if(b[i].LANGUAGE!=t.localLanguage){n.push(b[i])}}var p=[];var i;for(i=0;i<n.length;i++){var q={};q.ADDITIONAL_LANGUAGE_TITLE=n[i].TITLE;q.ADDITIONAL_LANGUAGE_DESCRIPTION=n[i].DESCRIPTION;q.ADDITIONAL_LANGUAGE_SPRAS_KEY=n[i].LANGUAGE;t.oDataModel.read("/LANGUAGE?$filter=SPRAS eq '"+n[i].LANGUAGE+"'",null,null,false,function(r){q.ADDITIONAL_LANGUAGE_KEY=r.results[0].LAISO});p.push(q)}a.ADDITIONAL_LANGUAGE_ARRAY=p;a.NO_OF_ADDITIONAL_LANGUAGES=a.ADDITIONAL_LANGUAGE_ARRAY.length;t.OLD_ADDITIONAL_LANGUAGE_ARRAY=p},function(b){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_FETCHING_ADDITIONAL_LANGUAGES"))});t.kpiCreateModel.setData(a);t.getView().setModel(t.kpiCreateModel);if(a.MODE=="EDIT"){t.getView().byId("kpiId").setEditable(false)}},function(a){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("YMSG_ERROR_RETRIEVING_DATA"))})}var m=t.getView().byId('kpiParameterInputForm');m.addContent(new sap.m.Label({text:t.oResourceBundle.getText("PROPERTY_NAME_VALUE")}));if(t.viewData.mode==="EDIT"||t.viewData.mode==="DUPLICATE"){t.byId("odataServiceInput").fireChange()}t.getView().byId("propertyNameValueBox").bindAggregation("items","/PROPERTIES",function(a,b){return new sap.ui.layout.Grid({content:[new sap.m.Input({value:"{NAME}",layoutData:new sap.ui.layout.GridData({span:"L4 M4 S4"})}),new sap.m.Input({value:"{VALUE}",layoutData:new sap.ui.layout.GridData({span:"L4 M4 S4"})}),new sap.m.Button({icon:"sap-icon://sys-cancel",type:"Transparent",layoutData:new sap.ui.layout.GridData({span:"L2 M2 S2"}),press:function(f){t.removeProperty(f)}})],defaultSpan:"L12 M12 S12"}).addStyleClass("propertyEntryGrid")})})},save:function(){var s=this.saveKpiDetails();if(s){if(this.viewData.IS_DRAFT){sap.suite.smartbusiness.utils.appToAppNavigation({action:"SBWorkspace",route:"detail",context:"INDICATORS_MODELER(ID='"+this.getView().getModel().getData().ID+"',IS_ACTIVE=1)"})}else{sap.suite.smartbusiness.utils.appToAppNavigation({action:"SBWorkspace",route:"detail",context:"INDICATORS_MODELER(ID='"+this.getView().getModel().getData().ID+"',IS_ACTIVE=0)"})}}},activateAndAddEvaluation:function(){var t=this;var s=false;var a=false;if(!(this.getView().getModel().getData().TITLE)){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_INDICATOR_TITLE"));s=false;a=false}else{s=this.saveKpiDetails();if(s){var p={ID:this.getView().getModel().getData().ID};sap.suite.smartbusiness.utils.create(sap.suite.smartbusiness.utils.serviceUrl('ACTIVATE_INDICATOR_SERVICE_URI'),p,null,function(d){if(t.getView().getModel().getData().TYPE=="KPI"){sap.m.MessageToast.show(t.oResourceBundle.getText("ACTIVATE_KPI_SUCCESS"))}else{sap.m.MessageToast.show(t.oResourceBundle.getText("ACTIVATE_OPI_SUCCESS"))}a=true},function(e){if(t.getView().getModel().getData().TYPE=="KPI"){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ACTIVATE_KPI_ERROR"))}else{sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ACTIVATE_OPI_ERROR"))}a=false})}}if(a){sap.suite.smartbusiness.utils.appToAppNavigation({action:"createSBKPIEvaluation",route:"addEvaluation",context:"INDICATORS_MODELER(ID='"+this.getView().getModel().getData().ID+"',IS_ACTIVE=1)"})}},saveAndCreateNew:function(){var s=this.saveKpiDetails();if(s){var k={};k.MODE="CREATE";k.NO_OF_ADDITIONAL_LANGUAGES=0;k.ADDITIONAL_LANGUAGE_ARRAY=[];k.GOAL_TYPE="MA";k.KPITYPE=true;k.OPITYPE=false;k.TYPE="KPI";this.kpiCreateModel.setData(k);this.getView().setModel(this.kpiCreateModel);this.getView().getModel().getData().KPITYPE=true;this.getView().getModel().getData().OPITYPE=false;this.getView().getModel().getData().TYPE="KPI";this.getView().byId("KPI").setSelected(true);this.getView().byId("OPI").setSelected(false);this.getView().getModel().updateBindings();this.getView().byId('kpiId').setEditable(true);this.getView().byId('viewInput').fireChange();this.kpiModelDataForDirtyBitCheck=$.extend(true,{},k);sap.suite.smartbusiness.utils.appToAppNavigation({action:"createSBKPI"})}},saveAndActivate:function(){var t=this;var s=false;var a=false;if(!(this.getView().getModel().getData().TITLE)){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_INDICATOR_TITLE"));a=false}else{s=this.saveKpiDetails();if(s){var p={ID:this.getView().getModel().getData().ID};sap.suite.smartbusiness.utils.create(sap.suite.smartbusiness.utils.serviceUrl('ACTIVATE_INDICATOR_SERVICE_URI'),p,null,function(d){if(t.getView().getModel().getData().TYPE=="KPI"){sap.m.MessageToast.show(t.oResourceBundle.getText("ACTIVATE_KPI_SUCCESS"))}else{sap.m.MessageToast.show(t.oResourceBundle.getText("ACTIVATE_OPI_SUCCESS"))}a=true},function(e){if(t.getView().getModel().getData().TYPE=="KPI"){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ACTIVATE_KPI_ERROR"))}else{sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ACTIVATE_OPI_ERROR"))}a=false})}}if(a){sap.suite.smartbusiness.utils.appToAppNavigation({action:"SBWorkspace",route:"detail",context:"INDICATORS_MODELER(ID='"+this.getView().getModel().getData().ID+"',IS_ACTIVE=1)"})}},deleteDraft:function(){var t=this;var b=new sap.m.Dialog({icon:"sap-icon://warning2",title:t.oResourceBundle.getText("WARNING"),state:"Warning",type:"Message",content:[new sap.m.Text({text:t.oResourceBundle.getText("WARNING_DELETE_DRAFT_KPI_OPI")})],beginButton:new sap.m.Button({text:t.oResourceBundle.getText("OK"),press:function(){b.close();t.callDeleteDraft()}}),endButton:new sap.m.Button({text:t.oResourceBundle.getText("CANCEL"),press:function(){b.close()}})});b.open()},callDeleteDraft:function(){var t=this;var p={};p.ID=t.viewData.ID;p.IS_ACTIVE=t.viewData.IS_ACTIVE;sap.suite.smartbusiness.utils.remove(sap.suite.smartbusiness.utils.serviceUrl('INDICATOR_SERVICE_URI'),p,function(d){if(t.getView().getModel().getData().TYPE=="KPI"){sap.m.MessageToast.show(t.oResourceBundle.getText("SUCCESS_KPI_DELETE"))}else{sap.m.MessageToast.show(t.oResourceBundle.getText("SUCCESS_OPI_DELETE"))}sap.suite.smartbusiness.utils.appToAppNavigation({action:"SBWorkspace",route:"detail",context:"INDICATORS_MODELER(ID='"+t.getView().getModel().getData().ID+"',IS_ACTIVE=1)"})},function(e){if(t.getView().getModel().getData().TYPE=="KPI"){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_KPI_DELETE"))}else{sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_OPI_DELETE"))}})},cancel:function(){var t=this;var i=false;var l=false;var a=false;var p=false;if(this.route==="createKpi"){if(t.kpiCreateModel.getData().ADDITIONAL_LANGUAGE_ARRAY&&t.kpiCreateModel.getData().ADDITIONAL_LANGUAGE_ARRAY.length){l=true}if((t.kpiCreateModel.getData().TAGS&&t.kpiCreateModel.getData().TAGS.length)||t.kpiCreateModel.getData().TAG){a=true}if(t.kpiCreateModel.getData().PROPERTIES&&t.kpiCreateModel.getData().PROPERTIES.length){p=true}delete t.kpiModelDataForDirtyBitCheck.ADDITIONAL_LANGUAGE_ARRAY;delete t.kpiModelDataForDirtyBitCheck.TAG;delete t.kpiModelDataForDirtyBitCheck.TAGS;delete t.kpiModelDataForDirtyBitCheck.PROPERTIES;delete t.kpiCreateModel.getData().ADDITIONAL_LANGUAGE_ARRAY;delete t.kpiCreateModel.getData().TAG;delete t.kpiCreateModel.getData().TAGS;delete t.kpiCreateModel.getData().PROPERTIES;var b=sap.suite.smartbusiness.utils.dirtyBitCheck({oldPayload:t.kpiModelDataForDirtyBitCheck,newPayload:t.kpiCreateModel.getData(),objectType:"INDICATORS"});if(b&&b.updates.length){i=true}if(i||l||a||p){var c=new sap.m.Dialog({icon:"sap-icon://warning2",title:t.oResourceBundle.getText("WARNING"),state:"Warning",type:"Message",content:[new sap.m.Text({text:t.oResourceBundle.getText("WARNING_UNSAVED_MESSAGE")})],beginButton:new sap.m.Button({text:t.oResourceBundle.getText("CONTINUE"),press:function(){c.close();window.history.back()}}),endButton:new sap.m.Button({text:t.oResourceBundle.getText("CANCEL"),press:function(){c.close()}})});c.open()}else{window.history.back()}}else{var d=t.getIndicatorChanges();var e=t.getTagChanges();var f=t.getPropertiesChanges();var g=t.getLanguageChanges();if(d&&(d.updates.length)){i=true}if(g&&(g.updates.length||g.deletes.length)){l=true}if(e&&(e.updates.length||e.deletes.length)){a=true}if(f&&(f.updates.length||f.deletes.length)){p=true}if(i||l||a||p){var c=new sap.m.Dialog({icon:"sap-icon://warning2",title:t.oResourceBundle.getText("WARNING"),state:"Warning",type:"Message",content:[new sap.m.Text({text:t.oResourceBundle.getText("WARNING_UNSAVED_MESSAGE")})],beginButton:new sap.m.Button({text:t.oResourceBundle.getText("CONTINUE"),press:function(){c.close();if(sap.suite.smartbusiness.modelerAppCache&&sap.suite.smartbusiness.modelerAppCache.createSBKPI&&sap.suite.smartbusiness.modelerAppCache.createSBKPI.appFromWorkspace){if(t.context){if(t.route=="editKpi"||t.route=="duplicateKpi"){sap.suite.smartbusiness.utils.appToAppNavigation({action:"SBWorkspace",route:"detail",context:t.context.sPath.substr(1).replace("INDICATORS","INDICATORS_MODELER")})}else if(t.route=="editDraftKpi"){sap.suite.smartbusiness.utils.appToAppNavigation({action:"SBWorkspace",route:"detail",context:t.context.sPath.substr(1).replace("INDICATORS","INDICATORS_MODELER").replace("IS_ACTIVE=0","IS_ACTIVE=1")})}}else{sap.suite.smartbusiness.utils.appToAppNavigation({action:"SBWorkspace"})}}else{sap.suite.smartbusiness.utils.appToAppNavigation({})}}}),endButton:new sap.m.Button({text:t.oResourceBundle.getText("CANCEL"),press:function(){c.close()}})});c.open()}else{if(sap.suite.smartbusiness.modelerAppCache&&sap.suite.smartbusiness.modelerAppCache.createSBKPI&&sap.suite.smartbusiness.modelerAppCache.createSBKPI.appFromWorkspace){if(t.context){if(t.route=="editKpi"||t.route=="duplicateKpi"){sap.suite.smartbusiness.utils.appToAppNavigation({action:"SBWorkspace",route:"detail",context:t.context.sPath.substr(1).replace("INDICATORS","INDICATORS_MODELER")})}else if(t.route=="editDraftKpi"){sap.suite.smartbusiness.utils.appToAppNavigation({action:"SBWorkspace",route:"detail",context:t.context.sPath.substr(1).replace("INDICATORS","INDICATORS_MODELER").replace("IS_ACTIVE=0","IS_ACTIVE=1")})}}else{sap.suite.smartbusiness.utils.appToAppNavigation({action:"SBWorkspace"})}}else{sap.suite.smartbusiness.utils.appToAppNavigation({})}}}},saveKpiDetails:function(){var t=this;var k=this.kpiCreateModel.getData();var s=true;var a={"ID":k.ID||"","IS_ACTIVE":0,"INDICATOR":{"DESCRIPTION":k.DESCRIPTION||"","GOAL_TYPE":k.GOAL_TYPE||"","TITLE":k.TITLE||"","TYPE":k.TYPE||"","OWNER_E_MAIL":k.OWNER_E_MAIL||"","OWNER_ID":k.OWNER_ID||"","OWNER_NAME":k.OWNER_NAME||"","COLUMN_NAME":k.COLUMN_NAME||"","DATA_SPECIFICATION":k.DATA_SPECIFICATION||"","ODATA_URL":k.ODATA_URL||"","ODATA_ENTITYSET":k.ODATA_ENTITYSET||"","VIEW_NAME":k.VIEW_NAME||"","ENTITY_TYPE":"","SEMANTIC_OBJECT":k.SEMANTIC_OBJECT||"","ACTION":k.ACTION||""}};if(a.ID==""){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_INDICATOR_ID"));s=false;return}if(!(s)||t.byId("kpiId").getValueState()==="Error"){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_VALID_KPI_ID"));s=false;return}if(t.byId("kpiOwnerEmail").getValueState()==="Error"){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_VALID_KPI_EMAIL"));s=false;return}else{if(this.viewData.mode=="DUPLICATE"){if(!this.validateKpiId()){return}}if(t.viewData.mode=="CREATE"||t.viewData.mode=="DUPLICATE"||(t.viewData.mode=="EDIT"&&this.viewData.IS_ACTIVE==1)){a.TEXTS=[];a.TAGS=[];a.PROPERTIES=[];var l=t.insertLanguagePayload();var p=t.insertPropertiesPayload();var b=t.insertTagPayload();if(l.length){a.TEXTS=l}if(p.length){a.PROPERTIES=p}if(b.length){a.TAGS=b}sap.suite.smartbusiness.utils.create(sap.suite.smartbusiness.utils.serviceUrl('INDICATOR_SERVICE_URI'),a,null,function(n){if(t.getView().getModel().getData().TYPE=="KPI"){sap.m.MessageToast.show(t.oResourceBundle.getText("SUCCESS_KPI_SAVE"))}else{sap.m.MessageToast.show(t.oResourceBundle.getText("SUCCESS_OPI_SAVE"))}s=true},function(n){if(t.getView().getModel().getData().TYPE=="KPI"){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_KPI_SAVE"))}else{sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_OPI_SAVE"))}s=false})}else if(t.viewData.mode=="EDIT"){a.TEXTS={};a.TAGS={};a.PROPERTIES={};var c=false;var d=false;var e=false;var f=false;var g=t.getIndicatorChanges();if(g){if(g.updates.length){c=true;a.INDICATOR={};for(var i=0;i<g.updates.length;i++){a.INDICATOR.update=g.updates[i]}}}var h=t.getLanguageChanges();if(h){if(h.deletes.length){d=true;for(var i=0;i<h.deletes.length;i++){a.TEXTS.remove=h.deletes}}if(h.updates.length){d=true;for(var i=0;i<h.updates.length;i++){a.TEXTS.create=h.updates}}}var j=t.getTagChanges();if(j){if(j.deletes.length){e=true;for(var i=0;i<j.deletes.length;i++){a.TAGS.remove=j.deletes}}if(j.updates.length){e=true;for(var i=0;i<j.updates.length;i++){a.TAGS.create=j.updates}}}var m=t.getPropertiesChanges();if(m){if(m.deletes.length){f=true;for(var i=0;i<m.deletes.length;i++){a.PROPERTIES.remove=m.deletes}}if(m.updates.length){f=true;for(var i=0;i<m.updates.length;i++){a.PROPERTIES.create=m.updates}}}if(c||e||f||d){sap.suite.smartbusiness.utils.update(sap.suite.smartbusiness.utils.serviceUrl('INDICATOR_SERVICE_URI'),a,null,function(n){if(t.getView().getModel().getData().TYPE=="KPI"){sap.m.MessageToast.show(t.oResourceBundle.getText("SUCCESS_KPI_SAVE"))}else{sap.m.MessageToast.show(t.oResourceBundle.getText("SUCCESS_OPI_SAVE"))}s=true},function(n){if(t.getView().getModel().getData().TYPE=="KPI"){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_KPI_SAVE"))}else{sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_OPI_SAVE"))}s=false})}}}return s},getIndicatorChanges:function(){var o=this.indicatorPayloadForDirtyBitTest;var n=this.kpiCreateModel.getData();var a={"DESCRIPTION":o.DESCRIPTION||"","GOAL_TYPE":o.GOAL_TYPE||"","TITLE":o.TITLE||"","TYPE":o.TYPE||"","OWNER_E_MAIL":o.OWNER_E_MAIL||"","OWNER_ID":o.OWNER_ID||"","OWNER_NAME":o.OWNER_NAME||"","COLUMN_NAME":o.COLUMN_NAME||"","DATA_SPECIFICATION":o.DATA_SPECIFICATION||"","ODATA_URL":o.ODATA_URL||"","ODATA_ENTITYSET":o.ODATA_ENTITYSET||"","VIEW_NAME":o.VIEW_NAME||"","ENTITY_TYPE":"","SEMANTIC_OBJECT":o.SEMANTIC_OBJECT||"","ACTION":o.ACTION||""};var b={"DESCRIPTION":n.DESCRIPTION||"","GOAL_TYPE":n.GOAL_TYPE||"","TITLE":n.TITLE||"","TYPE":n.TYPE||"","OWNER_E_MAIL":n.OWNER_E_MAIL||"","OWNER_ID":n.OWNER_ID||"","OWNER_NAME":n.OWNER_NAME||"","COLUMN_NAME":n.COLUMN_NAME||"","DATA_SPECIFICATION":n.DATA_SPECIFICATION||"","ODATA_URL":n.ODATA_URL||"","ODATA_ENTITYSET":n.ODATA_ENTITYSET||"","VIEW_NAME":n.VIEW_NAME||"","ENTITY_TYPE":"","SEMANTIC_OBJECT":n.SEMANTIC_OBJECT||"","ACTION":n.ACTION||""};var i=sap.suite.smartbusiness.utils.dirtyBitCheck({oldPayload:a,newPayload:b,objectType:"INDICATORS"});return i},getLanguageChanges:function(){var t=this;this.languagePayloadForDirtyBitTest=[];var n=this.insertLanguagePayload();for(var i=0;i<this.OLD_ADDITIONAL_LANGUAGE_ARRAY.length;i++){var l={};l.LANGUAGE=this.OLD_ADDITIONAL_LANGUAGE_ARRAY[i].ADDITIONAL_LANGUAGE_SPRAS_KEY;l.TITLE=this.OLD_ADDITIONAL_LANGUAGE_ARRAY[i].ADDITIONAL_LANGUAGE_TITLE;l.DESCRIPTION=this.OLD_ADDITIONAL_LANGUAGE_ARRAY[i].ADDITIONAL_LANGUAGE_DESCRIPTION;this.languagePayloadForDirtyBitTest.push(l)}var a=sap.suite.smartbusiness.utils.dirtyBitCheck({oldPayload:t.languagePayloadForDirtyBitTest,newPayload:n,objectType:"INDICATOR_TEXTS"});return a},getTagChanges:function(){var t=this;this.tagPayloadForDirtyBitTest=[];var n=this.insertTagPayload();var o=[];for(var i=0;i<t.OLD_TAGS.length;i++){var a={};a.TAG=t.OLD_TAGS[i];a.TYPE="IN";this.tagPayloadForDirtyBitTest.push(a)}var b=sap.suite.smartbusiness.utils.dirtyBitCheck({oldPayload:t.tagPayloadForDirtyBitTest,newPayload:n,objectType:"TAGS"});return b},getPropertiesChanges:function(){var t=this;this.propertiesPayloadForDirtyBitTest=[];var n=this.insertPropertiesPayload();for(var i=0;i<this.OLD_PROPERTIES.length;i++){var p={};p.TYPE="IN";p.NAME=t.OLD_PROPERTIES[i].NAME;p.VALUE=t.OLD_PROPERTIES[i].VALUE;this.propertiesPayloadForDirtyBitTest.push(p)}var a=sap.suite.smartbusiness.utils.dirtyBitCheck({oldPayload:t.propertiesPayloadForDirtyBitTest,newPayload:n,objectType:"PROPERTIES"});return a},insertLanguagePayload:function(){var k=this.kpiCreateModel.getData();var l={};var a=[];if(k.NO_OF_ADDITIONAL_LANGUAGES>0){var i;for(i=0;i<k.NO_OF_ADDITIONAL_LANGUAGES;i++){l={};l.LANGUAGE=k.ADDITIONAL_LANGUAGE_ARRAY[i].ADDITIONAL_LANGUAGE_SPRAS_KEY;l.TITLE=k.ADDITIONAL_LANGUAGE_ARRAY[i].ADDITIONAL_LANGUAGE_TITLE;l.DESCRIPTION=k.ADDITIONAL_LANGUAGE_ARRAY[i].ADDITIONAL_LANGUAGE_DESCRIPTION;a.push(l)}}return a},insertTagPayload:function(){var k=this.kpiCreateModel.getData();var t={};var a=[];if(k.TAG){var b=k.TAG.split(",");var i;for(i=0;i<b.length;i++){t={};t.TYPE="IN";t.TAG=b[i];a.push(t)}}return a},insertPropertiesPayload:function(){var k=this.kpiCreateModel.getData();var p={};var a=[];if(k.PROPERTIES){var i;for(i=0;i<k.PROPERTIES.length;i++){p={};p.TYPE="IN";p.NAME=k.PROPERTIES[i].NAME;p.VALUE=k.PROPERTIES[i].VALUE;a.push(p)}}return a},addAdditionalLanguageDialog:function(){var t=this;this.additionalLanguageListModel=new sap.ui.model.json.JSONModel();this.additionalLanguageListModelData=$.extend([],t.getView().getModel().getData().ADDITIONAL_LANGUAGE_ARRAY);this.getView().getModel().getData().NO_OF_ADDITIONAL_LANGUAGES=this.additionalLanguageListModelData.length;this.additionalLanguageListModel.setData(this.additionalLanguageListModelData);this.languageTextInput=new sap.m.Input({layoutData:new sap.ui.layout.GridData({span:"L8 M8 S8"})});this.languageDescriptionInput=new sap.m.TextArea({layoutData:new sap.ui.layout.GridData({span:"L8 M8 S8"})});this.languageKeySelect=new sap.m.Select({layoutData:new sap.ui.layout.GridData({span:"L6 M6 S6"})});this.addedLanguagesList=new sap.m.List({layoutData:new sap.ui.layout.GridData({span:"L5 M5 S5"}),});this.addedLanguagesList.bindItems("additionalLanguageListModel>/",new sap.m.CustomListItem({content:new sap.ui.layout.Grid({hSpacing:1,vSpacing:0,defaultSpan:"L12 M12 S12",content:[new sap.m.Input({value:"{additionalLanguageListModel>ADDITIONAL_LANGUAGE_TITLE}",design:"Bold",layoutData:new sap.ui.layout.GridData({span:"L12 M12 S12",vAlign:"Middle"}),editable:false}),new sap.m.Input({value:"{additionalLanguageListModel>ADDITIONAL_LANGUAGE_DESCRIPTION}",design:"Bold",layoutData:new sap.ui.layout.GridData({span:"L6 M6 S6",vAlign:"Middle"}),editable:false}),new sap.m.Input({value:"{additionalLanguageListModel>ADDITIONAL_LANGUAGE_KEY}",design:"Bold",layoutData:new sap.ui.layout.GridData({span:"L4 M4 S4"}),editable:false}),new sap.m.Button({icon:"sap-icon://sys-cancel",type:"Transparent",press:function(e){var d=e.getSource().getBindingContext("additionalLanguageListModel").getPath().substr(1);var n=t.addedLanguagesList.getModel("additionalLanguageListModel").getData().splice(d,1);t.addedLanguagesList.getModel("additionalLanguageListModel").updateBindings()},layoutData:new sap.ui.layout.GridData({span:"L2 M2 S2"})})]})}));this.addedLanguagesList.setModel(t.additionalLanguageListModel,"additionalLanguageListModel");var a=new sap.m.Dialog({contentHeight:"50%",contentWidth:"25%",title:t.oResourceBundle.getText("ADDITIONAL_LANGUAGE"),content:[new sap.ui.layout.Grid({hSpacing:1,vSpacing:4,defaultSpan:"L12 M12 S12",content:[new sap.ui.layout.form.SimpleForm({editable:true,layout:"ResponsiveGridLayout",content:[new sap.m.Label({text:t.oResourceBundle.getText("TITLE"),textAlign:"Right",layoutData:new sap.ui.layout.GridData({span:"L3 M3 S3",})}),t.languageTextInput,new sap.m.Label({text:t.oResourceBundle.getText("DESCRIPTION"),layoutData:new sap.ui.layout.GridData({span:"L3 M3 S3",})}),t.languageDescriptionInput,new sap.m.Label({text:t.oResourceBundle.getText("LANGUAGE")+":",layoutData:new sap.ui.layout.GridData({span:"L3 M3 S3"})}),t.languageKeySelect,new sap.m.Button({icon:"sap-icon://add",layoutData:new sap.ui.layout.GridData({span:"L2 M2 S2"}),press:function(){if(t.languageTextInput.getValue()||t.languageDescriptionInput.getValue()){for(var i=0;i<t.addedLanguagesList.getModel("additionalLanguageListModel").getData().length;i++){if(t.addedLanguagesList.getModel("additionalLanguageListModel").getData()[i].ADDITIONAL_LANGUAGE_KEY===t.languageKeySelect.getSelectedItem().getText()){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_LANGUAGE_EXISTS",t.languageKeySelect.getSelectedItem().getText()));return}}var b={"ADDITIONAL_LANGUAGE_TITLE":t.languageTextInput.getValue(),"ADDITIONAL_LANGUAGE_DESCRIPTION":t.languageDescriptionInput.getValue(),"ADDITIONAL_LANGUAGE_KEY":t.languageKeySelect.getSelectedItem().getText(),"ADDITIONAL_LANGUAGE_SPRAS_KEY":t.languageKeySelect.getSelectedItem().getKey()};t.addedLanguagesList.getModel("additionalLanguageListModel").getData().push(b);t.addedLanguagesList.getModel("additionalLanguageListModel").updateBindings();t.languageTextInput.setValue("");t.languageDescriptionInput.setValue("")}}})]})]}).addStyleClass("languageGrid"),t.addedLanguagesList],beginButton:new sap.m.Button({text:t.oResourceBundle.getText("OK"),press:function(){a.close();t.getView().getModel().getData().ADDITIONAL_LANGUAGE_ARRAY=t.addedLanguagesList.getModel("additionalLanguageListModel").getData();t.getView().getModel().getData().NO_OF_ADDITIONAL_LANGUAGES=t.getView().getModel().getData().ADDITIONAL_LANGUAGE_ARRAY.length;t.getView().getModel().updateBindings()}}),endButton:new sap.m.Button({text:t.oResourceBundle.getText("CANCEL"),press:function(){a.close()}})});this.oDataModel.read("/LANGUAGE?$select=LAISO,SPRAS",null,null,false,function(d){d=d.results;var i;for(var i=0;i<d.length;i++){if((d[i].LAISO).toUpperCase()==(sap.ui.getCore().getConfiguration().getLocale().getLanguage()).toUpperCase()){d.splice(i,1)}}var m=new sap.ui.model.json.JSONModel();m.setData(d);t.languageKeySelect.setModel(m,"otherLanguageKey");t.languageKeySelect.bindItems("otherLanguageKey>/",new sap.ui.core.Item({text:"{otherLanguageKey>LAISO}",key:"{otherLanguageKey>SPRAS}"}))});a.open()},addNewProperty:function(){var t=this;if(this.getView().byId("kpiPropertyName").getValue()){this.getView().byId("kpiPropertyName").setValueState("None");if(this.getView().byId("kpiPropertyValue").getValue()){this.getView().byId("kpiPropertyValue").setValueState("None");var p=this.getView().byId('propertyNameValueBox').getModel();p.getData().PROPERTIES=p.getData().PROPERTIES||[];for(var i=0;i<p.getData().PROPERTIES.length;i++){if((p.getData().PROPERTIES[i].NAME===this.getView().byId("kpiPropertyName").getValue())&&(p.getData().PROPERTIES[i].VALUE===this.getView().byId("kpiPropertyValue").getValue())){sap.suite.smartbusiness.utils.showErrorMessage(this.oResourceBundle.getText("ERROR_PROPERTY_VALUE_PAIR_EXISTS"));return}}p.getData().PROPERTIES.push({NAME:this.getView().byId("kpiPropertyName").getValue(),VALUE:this.getView().byId("kpiPropertyValue").getValue()});p.updateBindings();this.getView().byId("kpiPropertyName").setValue("");this.getView().byId("kpiPropertyValue").setValue("")}else{this.getView().byId("kpiPropertyValue").setValueState("Error");sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ENTER_PROPERTY_VALUE"))}}else{this.getView().byId("kpiPropertyName").setValueState("Error");sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ENTER_PROPERTY_NAME"))}},removeProperty:function(e){var p=e.getSource().getBindingContext().getPath();e.getSource().getBindingContext().getModel().getData().PROPERTIES.splice(p.substring(p.lastIndexOf("/")+1),1);e.getSource().getBindingContext().getModel().updateBindings()},kpiOpiRadioButtonChange:function(e){if(this.getView().byId('KPI').getSelected()==true){this.getView().getModel().getData().TYPE="KPI";this.getView().getModel().getData().KPITYPE=true;this.getView().getModel().getData().OPITYPE=false}else{this.getView().getModel().getData().TYPE="OPI";this.getView().getModel().getData().KPITYPE=false;this.getView().getModel().getData().OPITYPE=true}if(this.getView().byId('OPI').getSelected()==true){this.getView().getModel().getData().TYPE="OPI";this.getView().getModel().getData().KPITYPE=false;this.getView().getModel().getData().OPITYPE=true}else{this.getView().getModel().getData().TYPE="KPI";this.getView().getModel().getData().KPITYPE=true;this.getView().getModel().getData().OPITYPE=false}},validateKpiId:function(){var k=this.getView().byId('kpiId');var t=this;var s=false;var a=k.getValue();if(a){if(!(/^[a-zA-Z0-9.]*$/.test(a))){k.setValueState("Error");s=false}else{k.setValueState("None");this.oDataModel.read("/INDICATORS?$filter=ID eq '"+a+"'",null,null,false,function(i){if(i.results[0]){k.setValueState("Error");sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ID_ALREADY_EXISTS"));s=false}else{k.setValueState("None");s=true}},function(){k.setValueState("None");s=true})}}return s},formatAdditionalLanguageLink:function(v){return this.oApplicationFacade.getResourceBundle().getText("ADDITIONAL_LANGUAGE")+"("+v+")"},formatSemanticActionLabel:function(v){return v+"/"+this.oApplicationFacade.getResourceBundle().getText("ACTION")},validateEmailAddress:function(){var k=this.getView().byId('kpiOwnerEmail');var a=k.getValue();if(a){if(!(/^\w+[\w-\.]*\@\w+((-\w+)|(\w*))\.[a-z]/.test(a))){k.setValueState("Error")}else{k.setValueState("None")}}else{k.setValueState("None")}},populateRelevantEntitySet:function(d){var t=this;var m=this.getView().getModel().getData();var o=m.ODATA_URL.substr(0,m.ODATA_URL.lastIndexOf("/"));o=o.replace(/\//g,'.').replace(".","");var b=m.ODATA_URL.substr(m.ODATA_URL.lastIndexOf("/")+1);b=b.split(".")[0];var e="/ODATA_FOR_ENTITY(P_PACKAGE='"+m.VIEW_NAME.split("/")[0]+"',P_OBJECT='"+m.VIEW_NAME.split("/")[1]+"')/Results?$filter=PACKAGE eq '"+o+"' and OBJECT eq '"+b+"'";this.oApplicationFacade.getODataModel().read(e,null,null,false,function(c){if(c.results&&c.results.length){var f=c.results[0].CDATA_STR;d.open();if(f){var g=f.split("\n");for(var i=0,l=g.length;i<l;i++){if(g[i].indexOf("//")!=-1){g[i]=g[i].substr(0,g[i].indexOf("//"))}}f=g.join("\n");while(f.indexOf("/*")!=-1){var s=f.indexOf("/*");var h=f.indexOf("*/");h=(h==-1)?f.length:(h-2);f=f.substr(0,s)+f.substr(h)}}var j=[];var M=new sap.ui.model.json.JSONModel();var a=f.split(m.VIEW_NAME.split("/")[0]+'::'+m.VIEW_NAME.split("/")[1]);if(a.length==1){a=f.split(m.VIEW_NAME.split("/")[0]+'/'+m.VIEW_NAME.split("/")[1])}if(a.length==1){M=t.populateEntitySet(t.getView().byId("odataServiceInput").getValue());d.setModel(M);return}for(var i=1,l=a.length;i<l;i++){var k={};k.entityName=a[i].split('"')[2];j.push(k)}M.setData({entitySet:j});d.setModel(M);return}},function(a){})},handleHanaViewValueHelp:function(){var t=this;var h=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_VIEW"),noDataText:t.oResourceBundle.getText("NO_DATA_FOUND"),items:{path:"/HANA_VIEWS",template:new sap.m.StandardListItem({title:{parts:[{path:"OBJECT",type:new sap.ui.model.type.String()},{path:"PACKAGE",type:new sap.ui.model.type.String()},{path:"SUFFIX",type:new sap.ui.model.type.String()}],formatter:function(o,p,s){if(s.indexOf("view")!=-1)return p+"/"+o;else return p+"::"+o}},description:"{SUFFIX}"})},confirm:function(e){t.getView().getModel().setProperty("/VIEW_NAME",e.getParameter("selectedItem").getProperty("title"));t.byId("viewInput").fireChange()},liveChange:function(e){var s="'"+e.getParameter("value").toLowerCase()+"'";var f=new sap.ui.model.Filter("tolower(PACKAGE)",sap.ui.model.FilterOperator.Contains,s);var F=new sap.ui.model.Filter("tolower(OBJECT)",sap.ui.model.FilterOperator.Contains,s);var b=e.getSource().getBinding("items");b.filter(new sap.ui.model.Filter([f,F],false))}});h.setModel(this.oDataModel);h.open()},handleHanaViewInputChange:function(){this.getView().getModel().getData().ODATA_URL="";this.getView().getModel().getData().ODATA_ENTITYSET="";this.getView().getModel().getData().COLUMN_NAME="";this.getView().getModel().updateBindings()},handleOdataServiceValueHelp:function(){var t=this;if(!t.byId("viewInput").getValue()){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_HANA_VIEW"))}else{var a=t.getView().getModel().getProperty("/VIEW_NAME");a=(a.indexOf("/")!=-1?a.split("/"):a.split("::"));var h=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_ODATA_SERVICE"),noDataText:t.oResourceBundle.getText("NO_DATA_FOUND"),items:{path:"/ODATA_FOR_ENTITY(P_PACKAGE='"+a[0]+"',P_OBJECT='"+a[1]+"')/Results",template:new sap.m.StandardListItem({title:{parts:[{path:"PACKAGE",type:new sap.ui.model.type.String()},{path:"OBJECT",type:new sap.ui.model.type.String()}],formatter:function(o,p,s){o=o.replace(/\./g,'/');return"/"+o+"/"+p+".xsodata"}},})},confirm:function(e){t.getView().getModel().setProperty("/ODATA_URL",e.getParameter("selectedItem").getProperty("title"))},liveChange:function(e){var s="'"+e.getParameter("value").toLowerCase()+"'";var f=new sap.ui.model.Filter("tolower(PACKAGE)",sap.ui.model.FilterOperator.Contains,s);var F=new sap.ui.model.Filter("tolower(OBJECT)",sap.ui.model.FilterOperator.Contains,s);var b=e.getSource().getBinding("items");b.filter(new sap.ui.model.Filter([f,F],false))}});h.setModel(t.oDataModel);h.open()}},handleEntitySetValueHelp:function(){var t=this;if(!t.byId("odataServiceInput").getValue()){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_ODATA_SERVICE_URL"))}else{var t=this;t.oModelForEntity;var h=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_ENTITY_SET"),noDataText:t.oResourceBundle.getText("NO_DATA_FOUND"),items:{path:"/entitySet",template:new sap.m.StandardListItem({title:{parts:[{path:"entityName",type:new sap.ui.model.type.String()}],formatter:function(o,s){return o}},})},confirm:function(E){t.getView().getModel().setProperty("/ODATA_ENTITYSET",E.getParameter("selectedItem").getProperty("title"))},liveChange:function(E){var s="'"+E.getParameter("value").toLowerCase()+"'";var f=new sap.ui.model.Filter("tolower(entityName)",sap.ui.model.FilterOperator.Contains,s);var b=E.getSource().getBinding("items");b.filter(new sap.ui.model.Filter([f],false))}});try{if(t.getView().getModel().getData().VIEW_NAME){t.populateRelevantEntitySet(h)}else{t.oModelForEntity=t.populateEntitySet(t.getView().byId("odataServiceInput").getValue());h.setModel(t.oModelForEntity);h.open()}}catch(e){}}},handleMeasureValueHelp:function(){var t=this;if(!t.byId("entitySetInput").getValue()){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_ENTITY_SET"))}else{try{t.oModelForMeasure=t.populateMeasure(t.getView().getModel().getProperty("/ODATA_URL"),t.getView().getModel().getProperty("/ODATA_ENTITYSET"))}catch(e){}var h=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_MEASURE"),noDataText:t.oResourceBundle.getText("NO_DATA_FOUND"),items:{path:"/measures",template:new sap.m.StandardListItem({title:{parts:[{path:"measureName",type:new sap.ui.model.type.String()}],formatter:function(o,s){return o}},})},confirm:function(E){t.getView().getModel().setProperty("/COLUMN_NAME",E.getParameter("selectedItem").getProperty("title"))},liveChange:function(E){var s="'"+E.getParameter("value").toLowerCase()+"'";var f=new sap.ui.model.Filter("tolower(measureName)",sap.ui.model.FilterOperator.Contains,s);var b=E.getSource().getBinding("items");b.filter(new sap.ui.model.Filter([f],false))}});h.setModel(t.oModelForMeasure);h.open()}},handleChangeAdditionalInfo:function(e){var t=this;t.getView().getModel().setProperty("info",t.getView().byId("additionalInfoId"))},populateEntitySet:function(d){var c=this;var m=new sap.ui.model.json.JSONModel();var r=[],e=[],o={};var i;r=sap.suite.smartbusiness.odata.getAllEntitySet(d);for(i=0;i<r.length;i++){o={};o.entityName=r[i];e.push(o)}m.setData({entitySet:e});return m},validateQueryServiceURI:function(d){d=jQuery.trim(d);if(!jQuery.sap.startsWith(d,"/")){d="/"+d}if(jQuery.sap.endsWith(d,"/")){d=d.substring(0,d.length-1)}return d},populateMeasure:function(d,e){d=this.validateQueryServiceURI(d)+"";e=e+"";var m=[],a=[],o={};var i;m=sap.suite.smartbusiness.odata.getAllMeasures(d,e);for(i=0;i<m.length;i++){o={};o.measureName=m[i];a.push(o)}var M=new sap.ui.model.json.JSONModel();M.setData({measures:a});return M},onODataServiceLoad:function(){var t=this;setTimeout(function(){t.getView().getModel().setProperty("/ODATA_URL",t.getView().byId("odataServiceSelect").getSelectedItem().getText());t.getView().byId("odataServiceSelect").fireChange()},0);this.oDataModel.detachRequestCompleted(t.onODataServiceLoad,t)},onEntitySetServiceLoad:function(){var t=this;setTimeout(function(){t.getView().getModel().setProperty("/ODATA_ENTITYSET",t.getView().byId("entitySetSelect").getSelectedItem().getText());t.getView().byId("entitySetSelect").fireChange()},0)},onMeasureServiceLoad:function(){var t=this;setTimeout(function(){t.getView().getModel().setProperty("/COLUMN_NAME",t.getView().byId("valueMeasureSelect").getSelectedItem().getText());t.getView().byId("valueMeasureSelect").fireChange()},0)},onExit:function(){var h=hasher||window.hasher;if(!(h.getHash())){sap.suite.smartbusiness.utils.backToHome()}if(sap.suite.smartbusiness.modelerAppCache&&sap.suite.smartbusiness.modelerAppCache.createSBKPI&&sap.suite.smartbusiness.modelerAppCache.createSBKPI.appFromWorkspace){delete sap.suite.smartbusiness.modelerAppCache.createSBKPI.appFromWorkspace}}})};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.tools.migration.Component')){jQuery.sap.declare("sap.suite.ui.smartbusiness.designtime.tools.migration.Component");jQuery.sap.require('sap.ca.scfld.md.ComponentBase');sap.ca.scfld.md.ComponentBase.extend("sap.suite.ui.smartbusiness.designtime.tools.migration.Component",{metadata:sap.ca.scfld.md.ComponentBase.createMetaData("FS1",{"name":"Fullscreen Sample","version":"1.0.0-SNAPSHOT","library":"sap.suite.ui.smartbusiness.designtime.tools.migration","includes":["../../../lib/formatters.js","../../../lib/Util.js"],"dependencies":{"libs":["sap.m","sap.ca.ui"],"components":[]},"config":{"resourceBundle":"i18n/i18n.properties","titleResource":"FULLSCREEN_TITLE","startupImage320x460":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/320_x_460.png","startupImage640x920":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/640_x_920.png","startupImage640x1096":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/640_x_1096.png","startupImage768x1004":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/768_x_1004.png","startupImage748x1024":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/748_x_1024.png","startupImage1536x2008":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/1536_x_2008.png","startupImage1496x2048":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/1496_x_2048.png"},viewPath:"sap.suite.ui.smartbusiness.designtime.tools.migration.view",fullScreenPageRoutes:{"fullscreen":{"pattern":"","view":"S1"}}}),createContent:function(){var v={component:this};return sap.ui.view({viewName:"sap.suite.ui.smartbusiness.designtime.tools.migration.Main",type:sap.ui.core.mvc.ViewType.XML,viewData:v})}})};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.tools.migration.Configuration')){jQuery.sap.declare("sap.suite.ui.smartbusiness.designtime.tools.migration.Configuration");jQuery.sap.require('sap.ca.scfld.md.ConfigurationBase');jQuery.sap.require('sap.ca.scfld.md.app.Application');sap.ca.scfld.md.ConfigurationBase.extend("sap.suite.ui.smartbusiness.designtime.tools.migration.Configuration",{oServiceParams:{serviceList:[]},getAppConfig:function(){return this.oAppConfig},getServiceList:function(){return this.oServiceParams.serviceList},getMasterKeyAttributes:function(){return["Id"]},getExcludedQueryStringParameters:function(){return["sap-client","sap-language"]},getHanaSystem:function(){var h=hasher||window.hasher;var a=h.getHashAsArray();if(a&&a.length&&a[0]){var b=a[0].substr(a[0].indexOf("?")+1).split("&");for(var i=0,l=b.length;i<l;i++){if(b[i]&&(b[i].indexOf("sap-system")!=-1)){return b[i].split("=")[1]}}}return""},getServiceParams:function(){if(sap.ushell&&sap.ushell.Container){var s=this.oServiceParams.serviceList[0].serviceUrl;this.oServiceParams.serviceList[0].serviceUrl=sap.ushell.Container.getService("URLParsing").addSystemToServiceUrl(s,this.getHanaSystem())}return this.oServiceParams},})};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.tools.migration.view.S1.controller')){jQuery.sap.declare('sap.suite.ui.smartbusiness.designtime.tools.migration.view.S1.controller');jQuery.sap.require('sap.ca.scfld.md.controller.BaseFullscreenController');sap.ca.scfld.md.controller.BaseFullscreenController.extend("sap.suite.ui.smartbusiness.designtime.tools.migration.view.S1",{onInit:function(){jQuery.sap.require("sap.m.MessageBox");var r=jQuery.sap.getModulePath("sap.suite.ui.smartbusiness.designtime.tools.migration");var m=this;var t=this;this.oI18nModel=new sap.ui.model.resource.ResourceModel({bundleName:"sap/suite/ui/smartbusiness/designtime/tools/migration/i18n/i18n"});this.getView().setModel(m.oI18nModel,"i18n");var o={bSuppressBookmarkButton:{},oEditBtn:{sI18nBtnTxt:m.oI18nModel.getResourceBundle().getText("BTN_MIGRATE"),onBtnPressed:function(e){m.migrateData()}},buttonList:[{sI18nBtnTxt:m.oI18nModel.getResourceBundle().getText("BTN_RESET"),onBtnPressed:function(e){m.clearData()}},{sI18nBtnTxt:m.oI18nModel.getResourceBundle().getText("BTN_CANCEL"),onBtnPressed:function(e){m.cancel()}}]};this.setHeaderFooterOptions(o);this.newEvaluationsModel=new sap.ui.model.json.JSONModel();var n={EVALUATIONS:[{ID:"",INDICATOR:"",TITLE:"",OLD_ID:"",VALID_ID:""}]};this.newEvaluationsModel.setData((n));this._dialog=new sap.m.BusyDialog({});this.getView().byId("kpiInput").setValueHelpOnly(true)},showBusy:function(o){var m=this;var t=this;if(o=="L")this._dialog.setText(m.oI18nModel.getResourceBundle().getText("LOADING_DIALOG_TEXT"));if(o=="M")this._dialog.setText(m.oI18nModel.getResourceBundle().getText("MIGRATING_DIALOG_TEXT"));this._dialog.open()},hideBusy:function(){var t=this;this._dialog.close()},handleKpiValueHelp:function(){var m=this;var t=this;this.selectedKPIs=[];this.oldModel=new sap.ui.model.odata.ODataModel("/sap/hba/apps/kpi/s/odata/modeler_services.xsodata",true);this.oldModelDDA=new sap.ui.model.odata.ODataModel("/sap/hba/apps/kpi/s/odata/query_view_annotation_services.xsodata",true);this.oldModelVariants=new sap.ui.model.odata.ODataModel("/sap/hba/apps/kpi/s/odata/variant_services.xsodata",true);this.newModel=new sap.ui.model.odata.ODataModel("/sap/hba/r/sb/core/odata/modeler/SMART_BUSINESS.xsodata",true);this.kpiList=new sap.m.ObjectListItem({title:"{id}",number:"{evalCount}",numberUnit:"Evaluations",attributes:new sap.m.ObjectAttribute({text:"{text}"}),});var k=new sap.m.SelectDialog({title:m.oI18nModel.getResourceBundle().getText("SELECT_KPI_DIALOG"),multiSelect:true,noDataText:"No data found",items:{path:"/ActiveKPIs",sorter:new sap.ui.model.Sorter({path:'id',descending:false}),template:m.kpiList},confirm:function(e){var c=e.mParameters.selectedContexts;m.selectedKPIs=[];for(var i=0;i<c.length;i++){m.selectedKPIs.push(c[i].sPath.split('\'')[1])}if(m.selectedKPIs.length>0){var a;var b=0;var p="";var j=0;for(var i=j;i<m.selectedKPIs.length;i++){p="ID eq '"+m.selectedKPIs[i]+"' and IS_ACTIVE eq 1";a=m.serviceCallDataValidation("/INDICATORS",["$format=json","$filter="+p],m.newModel);if(a.success){b++}}}if(m.selectedKPIs.length>0){if(b>0&&b!=m.selectedKPIs.length){sap.m.MessageBox.show(m.oI18nModel.getResourceBundle().getText("MSG_FEW_KPIs_MIGRATED"),sap.m.MessageBox.Icon.INFORMATION,m.oI18nModel.getResourceBundle().getText("INFORMATION_MSG_TITLE"),[sap.m.MessageBox.Action.OK],function(){m.showBusy("L");setTimeout(function(){m.bindEvaluations()},2500)})}if(b==0){m.showBusy("L");setTimeout(function(){m.bindEvaluations()},2500)}if(b>0&&b==m.selectedKPIs.length){sap.m.MessageBox.show(m.oI18nModel.getResourceBundle().getText("MSG_ALL_KPIs_MIGRATED"),sap.m.MessageBox.Icon.INFORMATION,m.oI18nModel.getResourceBundle().getText("INFORMATION_MSG_TITLE"),[sap.m.MessageBox.Action.OK],function(){m.showBusy("L");setTimeout(function(){m.bindEvaluations()},2500)})}}},liveChange:function(e){var s="'"+e.getParameter("value").toLowerCase()+"'";var f=new sap.ui.model.Filter("tolower(id)",sap.ui.model.FilterOperator.Contains,s);var b=e.getSource().getBinding("items");b.filter([f])}});k.setModel(m.oldModel);k.open()},bindEvaluations:function(){var m=this;m.testVal=[];var t=this;var v=[];var a={};var b="";var o=this.getView().byId("oldList");var n=this.getView().byId("newList");var p={};p.VIEWS=[];var d={};d.CONFIGURATIONS=[];var f=new sap.m.List({});var g=new sap.m.List({});var h=new sap.ui.model.json.JSONModel();this.dialogModel=new sap.ui.model.json.JSONModel();this.newConfigurationObject=[];m.newConfigurationObject.CONFIGURATIONS=[];var k=new sap.m.ObjectListItem({title:"{viewName}",});var l=new sap.ui.layout.Grid({hSpacing:1,vSpacing:1,content:[new sap.m.Label({text:"{CONFIGURATION_NAME}",design:sap.m.LabelDesign.Bold,layoutData:new sap.ui.layout.GridData({span:"L12 M12 S12"})}),new sap.m.Label({text:"*View ID: ",layoutData:new sap.ui.layout.GridData({span:"L3 M3 S3",linebreakL:true,linebreakM:true,linebreakS:true})}),new sap.m.Input({type:"Text",value:"{VALID_CONFIGURATION_ID}",layoutData:new sap.ui.layout.GridData({span:"L8 M8 S8",}),}),]});f.bindItems({path:"/VIEWS",sorter:new sap.ui.model.Sorter({path:'viewName',descending:false,}),template:k});var q=new sap.m.ResponsivePopover({});var r=new sap.m.CustomListItem({content:l,});var s=new sap.m.Dialog({endButton:new sap.m.Button({text:m.oI18nModel.getResourceBundle().getText("BTN_SAVE_CLOSE"),press:function(){var x=this.getModel().getData().CONFIGURATIONS;for(var i=0;i<x.length;i++){for(var j=0;j<m.newConfigurationObject.CONFIGURATIONS.length;j++){if(x[i].CONFIGURATION_NAME==m.newConfigurationObject.CONFIGURATIONS[j].CONFIGURATION_NAME){m.newConfigurationObject.CONFIGURATIONS[j].CONFIGURATION_ID=x[i].VALID_CONFIGURATION_ID}}}s.close()}}),});s.addContent(g);s.setModel(m.dialogModel);g.bindItems({path:"/CONFIGURATIONS",sorter:new sap.ui.model.Sorter({path:'CONFIGURATION_NAME',descending:false,}),template:r});q.addContent(f);q.setModel(h);o.attachUpdateStarted(function(e){this.setBusy(true);this.setNoDataText(m.oI18nModel.getResourceBundle().getText("LIST_LOADING"))});o.attachUpdateFinished(function(e){this.setBusy(false);this.setNoDataText("")});n.attachUpdateStarted(function(e){this.setBusy(true);this.setNoDataText(m.oI18nModel.getResourceBundle().getText("LIST_LOADING"))});n.attachUpdateFinished(function(e){this.setBusy(false);this.setNoDataText("")});for(var i=0;i<m.selectedKPIs.length;i++){a={};a.operator="EQ";a.value1=m.selectedKPIs[i];v.push(a)}var F=new sap.ui.model.odata.Filter("objectId",v,false);var u=new sap.ui.layout.Grid({hSpacing:1,vSpacing:1,content:[new sap.m.Label({text:"{evaluationText}",design:sap.m.LabelDesign.Bold,layoutData:new sap.ui.layout.GridData({span:"L9 M9 S9"})}).addStyleClass("listContentTop"),new sap.m.Label({text:this.oI18nModel.getResourceBundle().getText("VAR_ID"),layoutData:new sap.ui.layout.GridData({span:"L2 M2 S3",linebreakL:true,linebreakM:true,linebreakS:true})}),new sap.m.Input({type:"Text",value:"{variantId}",layoutData:new sap.ui.layout.GridData({span:"L8 M8 S8",}),editable:false}),new sap.m.Link({text:{path:"/variantId",formatter:function(){var b;var c=this.getBindingContext().getProperty("objectId");var e=this.getBindingContext().getProperty("variantId");var a=m.serviceCallDataValidation("/DDA_CONFIG_PROPERTIES",["$format=json","$filter=(objectId eq '"+c+"' and variantId eq '"+e+"' and property eq 'queryAnnotationDocURIs')"],m.oldModel);if(a.success){b=a.data[0].value.split(",").length;return(t.oI18nModel.getResourceBundle().getText("CONFIGURED_DD",b))}else{b=0;return(t.oI18nModel.getResourceBundle().getText("CONFIGURED_DD",b))}}},press:function(e){b="";p.VIEWS=[];var c=this.getBindingContext().getProperty("objectId");var j=this.getBindingContext().getProperty("variantId");var a=m.serviceCallDataValidation("/DDA_CONFIG_PROPERTIES",["$format=json","$filter=(objectId eq '"+c+"' and variantId eq '"+j+"' and property eq 'queryAnnotationDocURIs')"],m.oldModel);if(a.success){b=a.data[0].value.split(",").length;q.setTitle(t.oI18nModel.getResourceBundle().getText("CONFIGURED_DD",b));for(var i=0;i<b;i++){var x={};x.viewName=a.data[0].value.split(",")[i];p.VIEWS.push(x)}h.setData(p);q.openBy(e.getSource())}else{h.setData(p);b=0;q.setTitle(t.oI18nModel.getResourceBundle().getText("CONFIGURED_DD",b));q.openBy(e.getSource())}},layoutData:new sap.ui.layout.GridData({span:"L8 M8 S8",indent:"L2 M2 S2",linebreakL:true,linebreakM:true,linebreakS:true}),}),]});var w=new sap.ui.layout.Grid({hSpacing:1,vSpacing:1,content:[new sap.m.Label({text:"{TITLE}",design:sap.m.LabelDesign.Bold,layoutData:new sap.ui.layout.GridData({span:"L9 M9 S9"})}).addStyleClass("listContentTop"),new sap.m.Label({text:"*"+this.oI18nModel.getResourceBundle().getText("EVAL_ID"),layoutData:new sap.ui.layout.GridData({span:"L3 M3 S3",linebreakL:true,linebreakM:true,linebreakS:true})}),new sap.m.Input({type:"Text",value:"{ID}",layoutData:new sap.ui.layout.GridData({span:"L8 M8 S8",liveChange:function(e){},change:function(e){}}),}),new sap.m.Link({text:{path:"/variantId",formatter:function(){var b;var c=this.getBindingContext().getProperty("OLD_ID").split("~")[0];var e=this.getBindingContext().getProperty("OLD_ID").split("~")[1];var a=m.serviceCallDataValidation("/DDA_CONFIG_PROPERTIES",["$format=json","$filter=(objectId eq '"+c+"' and variantId eq '"+e+"' and property eq 'queryAnnotationDocURIs')"],m.oldModel);if(a.success){b=a.data[0].value.split(",").length;return(t.oI18nModel.getResourceBundle().getText("CONFIGURED_DD",b))}else{b=0;return(t.oI18nModel.getResourceBundle().getText("CONFIGURED_DD",b))}}},press:function(e){b="";d.CONFIGURATIONS=[];var x=this.getBindingContext().getProperty("OLD_ID").split("~")[0];var A=this.getBindingContext().getProperty("OLD_ID").split("~")[1];var a=m.serviceCallDataValidation("/DDA_CONFIG_PROPERTIES",["$format=json","$filter=(objectId eq '"+x+"' and variantId eq '"+A+"' and property eq 'queryAnnotationDocURIs')"],m.oldModel);if(a.success){b=a.data[0].value.split(",").length;s.setTitle(this.oI18nModel.getResourceBundle().getText("CONFIGURED_DD",b));var B=0;for(var i=0;i<b;i++){B=0;for(var j=0;j<m.newConfigurationObject.CONFIGURATIONS.length;j++){if(m.newConfigurationObject.CONFIGURATIONS[j].CONFIGURATION_NAME==a.data[0].value.split(",")[i]){B++;var c=m.newConfigurationObject.CONFIGURATIONS[j].VALID_CONFIGURATION_ID;m.newConfigurationObject.CONFIGURATIONS[j].VALID_CONFIGURATION_ID=m.newConfigurationObject.CONFIGURATIONS[j].CONFIGURATION_ID;m.newConfigurationObject.CONFIGURATIONS[j].CONFIGURATION_ID=c;d.CONFIGURATIONS.push(jQuery.extend({},m.newConfigurationObject.CONFIGURATIONS[j]));break}}if(B==0){var C={};C.CONFIGURATION_NAME=a.data[0].value.split(",")[i];C.CONFIGURATION_ID=a.data[0].objectId+"~"+a.data[0].variantId+"_"+a.data[0].value.split(",")[i];C.VALID_CONFIGURATION_ID=this.getBindingContext().getProperty("VALID_ID")+"."+a.data[0].value.split(",")[i];C.EVALUATION_ID=this.getBindingContext().getProperty("OLD_ID");d.CONFIGURATIONS.push(C);m.newConfigurationObject.CONFIGURATIONS.push(jQuery.extend({},C))}}m.dialogModel.setData(d);s.open()}else{m.dialogModel.setData(d);b=0;s.setTitle(t.oI18nModel.getResourceBundle().getText("CONFIGURED_DD",b));s.open()}},layoutData:new sap.ui.layout.GridData({span:"L8 M8 S8",indent:"L3 M3 S3",linebreakL:true,linebreakM:true,linebreakS:true}),})]});var y=new sap.m.CustomListItem({content:w,});var z=new sap.m.CustomListItem({content:u,});n.setModel(this.newEvaluationsModel);n.bindItems({path:"/EVALUATIONS",sorter:new sap.ui.model.Sorter({path:'INDICATOR',descending:false,group:true}),template:y});o.setModel(m.oldModel);o.bindItems({path:"/ActiveEvaluations",filters:[F],sorter:new sap.ui.model.Sorter({path:'objectId',descending:false,group:true}),template:z});this.prepareTempDataForNewList()},prepareTempDataForNewList:function(){var n={};n.EVALUATIONS=[];var t=this;var m=this;m.objectToPush={};m.objectToPush.INDICATORS=[];m.objectToPush.INDICATOR_TEXTS=[];m.objectToPush.EVALUATIONS=[];m.objectToPush.EVALUATION_TEXTS=[];m.objectToPush.EVALUATION_FILTERS=[];m.objectToPush.EVALUATION_VALUES=[];m.objectToPush.TAGS=[];var K=[];var a=[];var b=0;var E=[];var V=[];var c={};var d={};var e={};var f="";var g="";var h="";for(var i=0;i<m.selectedKPIs.length;i++){if(i<(m.selectedKPIs.length-1)){f+="id eq '"+m.selectedKPIs[i]+"' or ";g+="objectId eq '"+m.selectedKPIs[i]+"' or "}else{f+="id eq '"+m.selectedKPIs[i]+"'";g+="objectId eq '"+m.selectedKPIs[i]+"'"}}c=m.serviceCallDataValidation("/ActiveKPIs",["$format=json","$filter=("+f+")"],m.oldModel);d=m.serviceCallDataValidation("/ActiveEvaluations",["$format=json","$filter=("+g+")"],m.oldModel);e=m.serviceCallDataValidation("/ActiveKPIsTexts",["$format=json","$filter=("+f+")"],m.oldModel);if(c.success){K=c.data}if(d.success){E=d.data}if(e.success){a=e.data}if(K.length>0&&a.length>0){for(var i=0;i<a.length;i++){m.objectToPush.INDICATOR_TEXTS.push(m.migrateIndicatorTexts(a[i]))}}if(K.length>0){for(var i=0;i<K.length;i++){var l=[];m.objectToPush.INDICATORS.push(m.migrateIndicator(K[i]));l=m.migrateTags(K[i]);if(l.length>0){for(var k=0;k<l.length;k++){m.objectToPush.TAGS.push(l[k])}}if(E.length>0){for(var j=0;j<E.length;j++){if(K[i].id==E[j].objectId){n.EVALUATIONS.push(m.migrateTempEvaluation(K[i],E[j]))}}}}}this.newEvaluationsModel.setData(n);m.hideBusy();if(n.EVALUATIONS.length==0){sap.m.MessageBox.show(m.oI18nModel.getResourceBundle().getText("MSG_NO_EVALUATIONS"),sap.m.MessageBox.Icon.INFORMATION,m.oI18nModel.getResourceBundle().getText("INFORMATION_MSG_TITLE"),[sap.m.MessageBox.Action.OK])}},prepareMigrationData:function(){var m=this;var t=this;var n=this.newEvaluationsModel.getData();var a=m.newConfigurationObject.CONFIGURATIONS;if(m.objectToPush.EVALUATIONS.length>0)m.objectToPush.EVALUATIONS=[];m.objectToPush.EVALUATION_TEXTS=[];m.objectToPush.EVALUATION_FILTERS=[];m.objectToPush.EVALUATION_VALUES=[];m.objectToPush.DDA_MASTER=[];m.objectToPush.DDA_CONFIG=[];m.objectToPush.DDA_FILTERS=[];m.objectToPush.DDA_HEADER=[];m.objectToPush.DDA_CHART=[];m.objectToPush.DDA_COLUMNS=[];m.objectToPush.DDA_MASTER_TEXT=[];var K=[];var b=0;var E=[];var c;var V=[];var d={};var e={};var f={};var g={};var D={};var v={};var h={};var l="";var o="";var p="";var r="";var u="";var w="";var x="";for(var i=0;i<m.selectedKPIs.length;i++){if(i<(m.selectedKPIs.length-1)){l+="id eq '"+m.selectedKPIs[i]+"' or ";o+="objectId eq '"+m.selectedKPIs[i]+"' or "}else{l+="id eq '"+m.selectedKPIs[i]+"'";o+="objectId eq '"+m.selectedKPIs[i]+"'"}}d=m.serviceCallDataValidation("/ActiveKPIs",["$format=json","$filter=("+l+")"],m.oldModel);e=m.serviceCallDataValidation("/ActiveEvaluations",["$format=json","$filter=("+o+")"],m.oldModel);f=m.serviceCallDataValidation("/ActiveEvaluationsTexts",["$format=json","$filter=("+o+")"],m.oldModel);if(d.success){K=d.data}if(e.success){E=e.data}if(f.success){c=f.data}if(c&&E){if(c.length>0&&E.length>0){for(var i=0;i<c.length;i++){m.objectToPush.EVALUATION_TEXTS.push(m.migrateEvaluationTexts(c[i],n.EVALUATIONS))}}}if(K.length>0&&E.length>0){for(var i=0;i<K.length;i++){for(var j=0;j<E.length;j++){if(K[i].id==E[j].objectId){var y=[];m.objectToPush.EVALUATIONS.push(m.migrateEvaluation(K[i],E[j],n.EVALUATIONS));y=m.migrateEvaluationValues(K[i],E[j],n.EVALUATIONS);for(var k=0;k<y.length;k++){m.objectToPush.EVALUATION_VALUES.push(y[k])}}}}for(var j=0;j<E.length;j++){r="id eq '"+E[j].variantId+"'";g=m.serviceCallDataValidation("/VARIANT_VALUES",["$format=json","$filter=("+r+")"],m.oldModelVariants);if(g.success){var A=[];A=m.migrateEvaluationFilters(E[j],g.data,n.EVALUATIONS);for(var k=0;k<A.length;k++){m.objectToPush.EVALUATION_FILTERS.push(A[k])}}}var B="";for(var j=0;j<E.length;j++){var C=m.serviceCallDataValidation("/DDA_CONFIG_PROPERTIES",["$format=json","$filter=(objectId eq '"+E[j].objectId+"' and variantId eq '"+E[j].variantId+"' and property eq 'queryAnnotationDocURIs')"],m.oldModel);u="objectId eq '"+E[j].objectId+"' and variantId eq '"+E[j].variantId+"'";D=m.serviceCallDataValidation("/DDA_CONFIG_PROPERTIES",["$format=json","$filter=("+u+")"],m.oldModel);if(C.success&&D.success){var F={};var G=0;var H=0;var I="";var J;var L=C.data[0].variantId.split(' ').join('');var M="";if(L.indexOf('.')>-1){M=L.split('.');I=J||(C.data[0].objectId+"."+M[M.length-1])}else{I=J||(C.data[0].objectId+"."+L)}B=C.data[0].value.split(",").length;for(var s=0;s<B;s++){H=0;G=0;for(var z=0;z<a.length;z++){if(a[z].CONFIGURATION_NAME==C.data[0].value.split(",")[s]){G++;break}}if(G==0){F={};F.CONFIGURATION_ID=I+"."+C.data[0].value.split(",")[s];F.CONFIGURATION_NAME=C.data[0].value.split(",")[s];for(var q=0;q<n.EVALUATIONS.length;q++){if((E[j].objectId+"~"+E[j].variantId)==n.EVALUATIONS[q].OLD_ID){H++;F.EVALUATION_ID=n.EVALUATIONS[q].OLD_ID;break}}if(H==0){F.EVALUATION_ID=E[j].objectId+"~"+E[j].variantId;break}a.push(jQuery.extend({},F))}}w="";for(var k=0;k<B;k++){if(k<(B-1)){w+="queryViewAnnotationDocumentURI eq '"+C.data[0].value.split(",")[k]+"' or "}else{w+="queryViewAnnotationDocumentURI eq '"+C.data[0].value.split(",")[k]+"'"}}if(j==0||x=="")x=w;else x+=" or "+w;if(w.length>0){v=m.serviceCallDataValidation("/QUERYVIEWANNOTATION",["$format=json","$expand=QUERY_VIEW_PROPERTIES&$filter=("+w+")"],m.oldModelDDA);if(v.success)m.migrateDDA(D.data,v.data,n.EVALUATIONS,a)}}}if(x.length>0){h=m.serviceCallDataValidation("/QUERYVIEWANNOTATIONTEXTS",["$format=json","$filter=("+x+")"],m.oldModelDDA);var N=[];if(h.success){N=m.migrateDDAText(h.data,a,n.EVALUATIONS);for(var k=0;k<N.length;k++){m.objectToPush.DDA_MASTER_TEXT.push(N[k])}}}}},migrateIndicator:function(K,m){m=m||1;var I={};I.ID=K.id;I.IS_ACTIVE=m;I.TYPE="KPI";I.TITLE=K.text;I.DESCRIPTION=K.description||"";if(Number(K.improvementDirection)==0){I.GOAL_TYPE="RA"}else if(Number(K.improvementDirection)==1){I.GOAL_TYPE="MA"}else{I.GOAL_TYPE="MI"}I.DATA_SPECIFICATION="";I.ODATA_URL=K.queryServiceURI;I.ODATA_ENTITYSET=K.queryQualifiedResultEntitySetName;I.VIEW_NAME="";I.COLUMN_NAME=K.queryResultMeasurePropertyName;I.OWNER_NAME=K.owner||"";I.OWNER_ID="";I.ENTITY_TYPE="";I.OWNER_E_MAIL="";I.ODATA_PROPERTY="";I.SEMANTIC_OBJECT=K.semanticObject;I.ACTION=K.semanticObjectAlias;return I},migrateIndicatorTexts:function(K){var I={};I.ID=K.id;I.IS_ACTIVE=1;I.LANGUAGE=K.sapLanguageKey;I.TITLE=K.text;I.DESCRIPTION=K.description||"";return I},migrateTags:function(K,m,t){m=m||1;t=t||"IN";var T=[];var a={};if(K.tags){if(K.tags.length>0){var b=K.tags.split(",");for(var i=0,l=b.length;i<l;i++){a.ID=K.id;a.IS_ACTIVE=m;a.TYPE=t;a.TAG=b[i];T.push(a);a={}}return T}}return T},migrateEvaluation:function(K,E,a,m){m=m||1;var b={};var c;for(var i=0;i<a.length;i++){if((E.objectId+"~"+E.variantId)==a[i].OLD_ID)c=a[i].ID}var v="";var d=E.variantId.split(' ').join('');if(d.indexOf('.')>-1){v=d.split('.');b.ID=c||(E.objectId+"."+v[v.length-1])}else{b.ID=c||(E.objectId+"."+d)}b.IS_ACTIVE=m;b.INDICATOR=E.objectId;b.INDICATOR_TYPE="KPI";b.TITLE=E.evaluationText;b.DESCRIPTION="";b.VIEW_NAME="";b.SCALING=E.scaleFactor;b.ODATA_URL=K.queryServiceURI;b.ODATA_ENTITYSET=K.queryQualifiedResultEntitySetName;b.COLUMN_NAME=K.queryResultMeasurePropertyName;b.OWNER_NAME=K.owner||"";b.OWNER_ID="";b.OWNER_E_MAIL="";b.ENTITY_TYPE="";if(Number(K.improvementDirection)==0){b.GOAL_TYPE="RA"}else if(Number(K.improvementDirection)==1){b.GOAL_TYPE="MA"}else{b.GOAL_TYPE="MI"}b.DATA_SPECIFICATION="";b.ODATA_PROPERTY="";b.SEMANTIC_OBJECT=K.semanticObject;b.ACTION=K.semanticObjectAlias;b.VALUES_SOURCE="FIXED";return b},migrateEvaluationTexts:function(E,a){var b;var c={};for(var i=0;i<a.length;i++){if((E.objectId+"~"+E.variantId)==a[i].OLD_ID){b=a[i].ID;break}}var v="";var d=E.variantId.split(' ').join('');if(d.indexOf('.')>-1){v=d.split('.');c.ID=b||(E.objectId+"."+v[v.length-1])}else{c.ID=b||(E.objectId+"."+d)}c.IS_ACTIVE=1;c.LANGUAGE=E.sapLanguageKey;c.TITLE=E.evaluationText;c.DESCRIPTION="";return c},migrateTempEvaluation:function(K,E,m){m=m||1;var a={};var v="";var b=E.variantId.split(' ').join('');if(b.indexOf('.')>-1){v=b.split('.');a.ID=E.objectId+"."+v[v.length-1];a.VALID_ID=E.objectId+"."+v[v.length-1]}else{a.ID=E.objectId+"."+b;a.VALID_ID=E.objectId+"."+b}a.OLD_ID=E.objectId+"~"+E.variantId;a.VARIANT_ID=b;a.INDICATOR=E.objectId;a.TITLE=E.evaluationText;return a},migrateEvaluationValues:function(K,E,a,m){m=m||1;var b=[];var e={};var c;for(var i=0;i<a.length;i++){if((E.objectId+"~"+E.variantId)==a[i].OLD_ID)c=a[i].ID}var d="";var v="";var f=E.variantId.split(' ').join('');if(f.indexOf('.')>-1){v=f.split('.');d=c||(E.objectId+"."+v[v.length-1])}else{d=c||(E.objectId+"."+f)}var g=0;if((E.toleranceRangeHighValue==0)||E.toleranceRangeHighValue){e.ID=d;e.IS_ACTIVE=m;e.TYPE="WH";e.FIXED=E.toleranceRangeHighValue;e.COLUMN_NAME="";e.ODATA_PROPERTY="";b.push(e);e={}}if((E.deviationRangeHighValue==0)||E.deviationRangeHighValue){e.ID=d;e.IS_ACTIVE=m;e.TYPE="CH";e.FIXED=E.deviationRangeHighValue;e.COLUMN_NAME="";e.ODATA_PROPERTY="";b.push(e);e={}}if((E.toleranceRangeLowValue==0)||E.toleranceRangeLowValue){e.ID=d;e.IS_ACTIVE=m;e.TYPE="WL";e.FIXED=E.toleranceRangeLowValue;e.COLUMN_NAME="";e.ODATA_PROPERTY="";b.push(e);e={}}if((E.deviationRangeLowValue==0)||E.deviationRangeLowValue){e.ID=d;e.IS_ACTIVE=m;e.TYPE="CL";e.FIXED=E.deviationRangeLowValue;e.COLUMN_NAME="";e.ODATA_PROPERTY="";b.push(e);e={}}if((E.target==0)||E.target){e.ID=d;e.IS_ACTIVE=m;e.TYPE="TA";e.FIXED=E.target;e.COLUMN_NAME="";e.ODATA_PROPERTY="";b.push(e);e={}}return b},migrateEvaluationFilters:function(E,V,a,m){m=m||1;var b=[];var c;for(var i=0;i<a.length;i++){if((E.objectId+"~"+E.variantId)==a[i].OLD_ID)c=a[i].ID}var d="";var v="";var e=E.variantId.split(' ').join('');if(e.indexOf('.')>-1){v=e.split('.');d=c||(E.objectId+"."+v[v.length-1])}else{d=c||(E.objectId+"."+e)}var f={};for(var i=0,l=V.length;i<l;i++){f.ID=d;f.IS_ACTIVE=m;f.NAME=V[i].filterPropertyName;f.VALUE_1=V[i].value;f.VALUE_2=V[i].valueTo||"";f.OPERATOR=V[i].comparator;if(V[i].type=="F")f.TYPE="FI";if(V[i].type=="I")f.TYPE="PA";b.push(f);f={}}return b},migrateDDAText:function(C,a,E){var m=this;var D=[];var b={};var c=[];var d=[];for(var j=0;j<C.length;j++){for(var i=0;i<a.length;i++){if(C[j].queryViewAnnotationDocumentURI==a[i].CONFIGURATION_NAME){c[j]=a[i].CONFIGURATION_ID;for(var k=0;k<E.length;k++){if(a[i].EVALUATION_ID==E[k].OLD_ID){d[j]=E[k].ID;break}}}}}for(var i=0;i<C.length;i++){b={};b.CONFIGURATION_ID=c[i];b.EVALUATION_ID=d[i];b.SAP_LANGUAGE_KEY=C[i].sapLanguageKey;b.TEXT=C[i].title;b.IS_ACTIVE=1;D.push(b)}return D},migrateDDAText:function(C,a,E){var m=this;var D=[];var b={};var c=[];var d=[];for(var j=0;j<C.length;j++){for(var i=0;i<a.length;i++){if(C[j].queryViewAnnotationDocumentURI==a[i].CONFIGURATION_NAME){c[j]=a[i].CONFIGURATION_ID;for(var k=0;k<E.length;k++){if(a[i].EVALUATION_ID==E[k].OLD_ID){d[j]=E[k].ID;break}}}}}for(var i=0;i<C.length;i++){b={};b.CONFIGURATION_ID=c[i];b.EVALUATION_ID=d[i];b.SAP_LANGUAGE_KEY=C[i].sapLanguageKey;b.TEXT=C[i].title;b.IS_ACTIVE=1;D.push(b)}return D},migrateDDA:function(D,Q,E,C){var a=this;var d={};var q=[];var b={};var c;for(var i=0;i<E.length;i++){if((D[0].objectId+"~"+D[0].variantId)==E[i].OLD_ID)c=E[i].ID}var e="";var v="";var f=D[0].variantId.split(' ').join('');if(f.indexOf('.')>-1){v=f.split('.');e=c||(D[0].objectId+"."+v[v.length-1])}else{e=c||(D[0].objectId+"."+f)}for(var i=0,l=Q.length;i<l;i++){b=Q[i];var g=0;for(var j=0,m=Q[i].QUERY_VIEW_PROPERTIES.length;j<m;j++){b[Q[i].QUERY_VIEW_PROPERTIES[j]["property"]]=Q[i].QUERY_VIEW_PROPERTIES[j]["value"]}if(q.length==0)q.push(jQuery.extend({},b));else{for(var k=0;k<q.length;k++){if(b.queryViewAnnotationDocumentURI==q[k].queryViewAnnotationDocumentURI)g++}if(g==0)q.push(jQuery.extend({},b))}delete b.QUERY_VIEW_PROPERTIES}for(var i=0,l=D.length;i<l;i++){if(D[i].property=='queryAnnotationDocURIs'){d.queryAnnotationDocURIs=D[i].value.split(",")}else if(D[i].property=='filters'){d.filters=D[i].value.split(",")}else{d[D[i].property]=D[i].value}}h={};h.EVALUATION_ID=e;h.CONFIGURATION_ID="NIL";if(d.filters){for(j=0,m=d.filters.length;j<m;j++){h.DIMENSION=d.filters[j];h.VISIBILITY=1;h.IS_ACTIVE=1;a.objectToPush.DDA_FILTERS.push(jQuery.extend({},h))}}h={};h.EVALUATION_ID=e;h.CONFIGURATION_ID="NIL";h.REFERENCE_EVALUATION_ID=h.EVALUATION_ID;h.VISUALIZATION_TYPE='NT';h.VISUALIZATION_ORDER=1;h.VISIBILITY=1;h.DIMENSION=null;h.IS_ACTIVE=1;a.objectToPush.DDA_HEADER.push(jQuery.extend({},h));h.VISUALIZATION_TYPE='AT';h.VISUALIZATION_ORDER=2;h.VISIBILITY=1;h.DIMENSION=null;h.IS_ACTIVE=1;a.objectToPush.DDA_HEADER.push(jQuery.extend({},h));h.VISUALIZATION_TYPE='TT';h.VISUALIZATION_ORDER=3;h.VISIBILITY=1;h.DIMENSION=null;h.IS_ACTIVE=1;a.objectToPush.DDA_HEADER.push(jQuery.extend({},h));h={};h.EVALUATION_ID=e;h.CONFIGURATION_ID="NIL";h.PROPERTY_TYPE='SAP_FILTER';h.PROPERTY_VALUE='';h.VISIBILITY=d.isFilter||0;h.IS_ACTIVE=1;a.objectToPush.DDA_CONFIG.push(jQuery.extend({},h));h.PROPERTY_TYPE='SAP_AGGREGATE_VALUE';h.PROPERTY_VALUE='';h.VISIBILITY=d.aggregateNumberEnabled||0;h.IS_ACTIVE=1;a.objectToPush.DDA_CONFIG.push(jQuery.extend({},h));h.PROPERTY_TYPE='SAP_HEADER';h.PROPERTY_VALUE='';h.VISIBILITY=d.isTarget||0;h.IS_ACTIVE=1;a.objectToPush.DDA_CONFIG.push(jQuery.extend({},h));h.PROPERTY_TYPE='QUERY_SERVICE_URI';h.PROPERTY_VALUE=Q[0].queryServiceURI;h.VISIBILITY=1;h.IS_ACTIVE=1;a.objectToPush.DDA_CONFIG.push(jQuery.extend({},h));h.PROPERTY_TYPE='QUERY_ENTITY_SET';h.PROPERTY_VALUE=Q[0].queryQualifiedResultEntitySetName;h.VISIBILITY=1;h.IS_ACTIVE=1;a.objectToPush.DDA_CONFIG.push(jQuery.extend({},h));for(var i=0,l=d.queryAnnotationDocURIs.length;i<l;i++){var h={};var n;for(var k=0;k<C.length;k++){if(d.queryAnnotationDocURIs[i]==C[k].CONFIGURATION_NAME)n=C[k].CONFIGURATION_ID}h.EVALUATION_ID=e;h.CONFIGURATION_ID=n||(e+"."+d.queryAnnotationDocURIs[i]);h.TEXT=q[i].title;h.CONFIG_ORDER=i+1;h.IS_ACTIVE=1;a.objectToPush.DDA_MASTER.push(jQuery.extend({},h));h={};var o=1;h.EVALUATION_ID=e;h.CONFIGURATION_ID=n||(e+"."+d.queryAnnotationDocURIs[i]);var p=q[i].measurePropertyNames.split(",");var r=q[i].dimensionPropertyNames.split(",");var s=q[i].QUERY_VIEW_PROPERTIES.results.filter(function(x){return x["property"]=="dimensionPropertySortNames"});var t=s.length?s[0].value:null;var u=t?t.split(","):null;s=q[i].QUERY_VIEW_PROPERTIES.results.filter(function(x){return x["property"]=="measurePropertySortNames"});var w=s.length?s[0].value:null;var y=w?w.split(","):null;s=q[i].QUERY_VIEW_PROPERTIES.results.filter(function(x){return x["property"]=="colorNames"});var z=s.length?s[0].value:null;var A=z?z.split(","):null;s=q[i].QUERY_VIEW_PROPERTIES.results.filter(function(x){return x["property"]=="colorType"});var B=s.length?s[0].value:null;s=q[i].QUERY_VIEW_PROPERTIES.results.filter(function(x){return x["property"]=="semanticColorMeasure"});var F=s.length?s[0].value:null;s=q[i].QUERY_VIEW_PROPERTIES.results.filter(function(x){return x["property"]=="hiddenMeasureNames"});var G=s.length?s[0].value:null;var H=G?G.split(","):null;for(var j=0,m=r.length;j<m;j++){h.NAME=r[j];h.TYPE='DIMENSION';if(u!=null){if(u.length){h.SORT_BY=(u&&u[j])?u[j]:r[j]}else h.SORT_BY=r[j]}else h.SORT_BY=r[j];h.AXIS=1;h.STACKING=0;h.VISIBILITY="BOTH";h.COLOR=null;switch(Number(q[i].orderBy)){case 1:h.SORT_ORDER=null;break;case 2:h.SORT_ORDER=null;break;case 3:h.SORT_ORDER='asc';break;case 4:h.SORT_ORDER='desc';break;case 0:h.SORT_ORDER=null;break}h.COLUMNS_ORDER=o++;h.IS_ACTIVE=1;a.objectToPush.DDA_COLUMNS.push(jQuery.extend({},h))}for(var j=0,m=p.length;j<m;j++){h.NAME=p[j];h.TYPE='MEASURE';h.VISIBILITY="BOTH";if(y!=null){if(y.length){h.SORT_BY=(y&&y[j])?y[j]:p[j]}else h.SORT_BY=p[j]}else h.SORT_BY=p[j];if(q[i].chartType&&(jQuery.sap.startsWithIgnoreCase(q[i].chartType,"dual"))&&(j<2)){h.AXIS=j+1}else{h.AXIS=1}h.STACKING=0;h.COLOR=null;switch(Number(q[i].orderBy)){case 1:h.SORT_ORDER='asc';break;case 2:h.SORT_ORDER='desc';break;case 3:h.SORT_ORDER=null;break;case 4:h.SORT_ORDER=null;break;case 0:h.SORT_ORDER=null;break}h.COLUMNS_ORDER=o++;h.IS_ACTIVE=1;if(q[i].chartType&&(q[i].chartType.indexOf("Stacked")>-1)){h.STACKING=1}if(H!=null){if(H&&(H.indexOf(p[j])>-1)){h.VISIBILITY="CHART"}}if(B==0||B==2){if(A!=null)h.COLOR=(A&&A[j])?A[j]:"";else h.COLOR=""}else if(q[i].colorType==1){}a.objectToPush.DDA_COLUMNS.push(jQuery.extend({},h))}h={};h.EVALUATION_ID=e;h.CONFIGURATION_ID=n||(e+"."+d.queryAnnotationDocURIs[i]);h.VALUE_TYPE='ABSOLUTE';h.AXIS_TYPE='SINGLE';h.DATA_LIMIT=q[i].top||null;switch(q[i].chartType){case null:h.CHART_TYPE='Table';break;case'Select Type':h.CHART_TYPE='Table';break;case'StackedColumn':h.CHART_TYPE='Column';break;case'Stacked Column':h.CHART_TYPE='Column';break;case'Transposed':h.CHART_TYPE='Column';break;case'DualStackedBar':h.CHART_TYPE='Bar';h.AXIS_TYPE='DUAL';break;case'StackedBar':h.CHART_TYPE='Bar';break;case'StackedColumn100':h.CHART_TYPE='Column';h.VALUE_TYPE='PERCENTAGE';break;case'DualStackedColumn':h.CHART_TYPE='Column';h.AXIS_TYPE='DUAL';break;case'DualStackedBar100':h.CHART_TYPE='Bar';h.VALUE_TYPE='PERCENTAGE';h.AXIS_TYPE='DUAL';break;case'DualStackedColumn100':h.CHART_TYPE='Column';h.VALUE_TYPE='PERCENTAGE';h.AXIS_TYPE='DUAL';break;default:h.CHART_TYPE=q[i].chartType}switch(B){case undefined:h.COLOR_SCHEME='NONE';break;case null:h.COLOR_SCHEME='NONE';break;case 0:h.COLOR_SCHEME='MANUAL_NON_SEMANTIC';break;case 1:h.COLOR_SCHEME='AUTO_SEMANTIC';break;case 2:h.COLOR_SCHEME='MANUAL_SEMANTIC';break;default:h.COLOR_SCHEME='NONE'}h.THRESHOLD_MEASURE=F;h.IS_ACTIVE=1;a.objectToPush.DDA_CHART.push(jQuery.extend({},h))}},clearData:function(){this.getView().byId("oldList").removeAllItems();this.getView().byId("newList").removeAllItems();this.objectToPush.INDICATORS=[];this.objectToPush.INDICATOR_TEXTS=[];this.objectToPush.EVALUATIONS=[];this.objectToPush.EVALUATION_TEXTS=[];this.objectToPush.EVALUATION_FILTERS=[];this.objectToPush.EVALUATION_VALUES=[];this.objectToPush.TAGS=[];this.objectToPush.DDA_MASTER=[];this.objectToPush.DDA_CONFIG=[];this.objectToPush.DDA_FILTERS=[];this.objectToPush.DDA_HEADER=[];this.objectToPush.DDA_CHART=[];this.objectToPush.DDA_COLUMNS=[];this.objectToPush.DDA_MASTER_TEXT=[]},migrateData:function(){var m=this;if((this.objectToPush!=undefined)&&(this.objectToPush.INDICATORS.length>0)){sap.m.MessageBox.show(m.oI18nModel.getResourceBundle().getText("MSG_MIGRATION_BEGIN"),sap.m.MessageBox.Icon.INFORMATION,m.oI18nModel.getResourceBundle().getText("INFORMATION_MSG_TITLE"),[sap.m.MessageBox.Action.OK],function(){m.showBusy("M");setTimeout(function(){m.writeData()},2500)})}else{sap.m.MessageBox.show(m.oI18nModel.getResourceBundle().getText("MSG_NO_KPI"),sap.m.MessageBox.Icon.INFORMATION,m.oI18nModel.getResourceBundle().getText("INFORMATION_MSG_TITLE"),[sap.m.MessageBox.Action.OK])}},cancel:function(){window.history.back()},writeData:function(){var m=this;this.errorMessage="";this.prepareMigrationData();var d=m.objectToPush;if(d){m.initiateRequests()}},initiateRequests:function(){var m=this;var u="/sap/hba/r/sb/core/logic/MIGRATION.xsjs";jQuery.ajax({url:"/sap/hba/r/sb/core/logic/__token.xsjs",async:false,type:"HEAD",headers:{"X-CSRF-Token":"Fetch"},success:function(d,s,x){jQuery.ajax({type:"POST",url:u,cache:false,data:encodeURIComponent(JSON.stringify(m.objectToPush)),headers:{"X-CSRF-Token":x.getResponseHeader("X-CSRF-Token")},success:function(a){if(JSON.parse(a).success){sap.m.MessageBox.show(m.oI18nModel.getResourceBundle().getText("MSG_MIGRATION_SUCCESS"),sap.m.MessageBox.Icon.INFORMATION,m.oI18nModel.getResourceBundle().getText("INFORMATION_MSG_TITLE"),[sap.m.MessageBox.Action.OK],function(){m.cancel()})}else{sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:m.oI18nModel.getResourceBundle().getText("MSG_MIGRATION_ERROR"),details:JSON.parse(a).errorMessage})}m.hideBusy()},async:true,error:function(X,t,e){sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:m.oI18nModel.getResourceBundle().getText("MSG_MIGRATION_ERROR"),details:e+"\n"+JSON.parse(X.responseText).errorMessage});m.hideBusy()}})},error:function(){sap.suite.smartbusiness.utils.showErrorMessage(that.oApplicationFacade.getResourceBundle().getText("ERR_FETCH_AUTH_TOKEN"));$.sap.log.error("ERR_FETCH_AUTH_TOKEN")}})},serviceCreate:function(e,p,O){var r={success:false,text:""};O.create(e,p,null,function(d){r.success=true},function(a){var b=JSON.parse(a.response.body);r.success=false;r.text=a.response.statusText+" - "+b.error.message.value});return r},serviceDelete:function(e,i,O){var r={success:false,text:""};O.remove(e+"("+i+")",null,function(d){r.success=true},function(a){r.success=false;r.text=a.response.statusText},false,"",true);return r},serviceCallDataValidation:function(e,p,d){var r={success:false,text:""};d.read(e,null,p,false,function(a,b){if(a.results[0]){r.success=true;r.data=a.results}else{r.success=false;r.text="Record not found"}},function(a){r.success=false;r.text=a.response.statusText});return r},})};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.visualization.Configuration')){jQuery.sap.declare("sap.suite.ui.smartbusiness.designtime.visualization.Configuration");jQuery.sap.require('sap.ca.scfld.md.ConfigurationBase');jQuery.sap.require('sap.ca.scfld.md.app.Application');sap.ca.scfld.md.ConfigurationBase.extend("sap.suite.ui.smartbusiness.designtime.visualization.Configuration",{oServiceParams:{serviceList:[{name:"SMART_BUSINESS",masterCollection:"EVALUATIONS",serviceUrl:"/sap/hba/r/sb/core/odata/modeler/SMART_BUSINESS.xsodata/",isDefault:true,refreshAfterChange:true,useBatch:false}]},getServiceList:function(){return this.getServiceParams().serviceList},getMasterKeyAttributes:function(){return["Id"]},getExcludedQueryStringParameters:function(){return["sap-client","sap-language"]},getHanaSystem:function(){var h=hasher||window.hasher;var a=h.getHashAsArray();if(a&&a.length&&a[0]){var b=a[0].substr(a[0].indexOf("?")+1).split("&");for(var i=0,l=b.length;i<l;i++){if(b[i]&&(b[i].indexOf("sap-system")!=-1)){return b[i].split("=")[1]}}}return""},getServiceParams:function(){if(sap.ushell&&sap.ushell.Container){var s=this.oServiceParams.serviceList[0].serviceUrl;this.oServiceParams.serviceList[0].serviceUrl=sap.ushell.Container.getService("URLParsing").addSystemToServiceUrl(s,this.getHanaSystem())}return this.oServiceParams},})};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.visualization.view.S2.controller')){jQuery.sap.declare('sap.suite.ui.smartbusiness.designtime.visualization.view.S2.controller');jQuery.sap.require('sap.ca.scfld.md.controller.ScfldMasterController');sap.ca.scfld.md.controller.ScfldMasterController.extend("sap.suite.ui.smartbusiness.designtime.visualization.view.S2",{onInit:function(){var t=this;t.oApplicationFacade.getODataModel().setSizeLimit(100000);if(!(t.oApplicationFacade.currentLogonHanaUser)){this.oApplicationFacade.getODataModel().read("/SESSION_USER",null,null,true,function(d){t.oApplicationFacade.currentLogonHanaUser=(d.results&&d.results.length)?d.results[0].LOGON_USER:null},function(e){t.oApplicationFacade.currentLogonHanaUser=null;sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("YMSG_ERROR_RETRIEVING_DATA"),e.response.body)})}this.byId("list").getBinding("items").filter([new sap.ui.model.Filter("IS_ACTIVE","EQ",1)])},createFilterOptions:function(){var t=this;var f=new sap.m.ViewSettingsDialog({id:this.createId("filterOptionsDialog"),filterItems:[new sap.m.ViewSettingsFilterItem({text:t.oApplicationFacade.getResourceBundle().getText("ACTIVITY"),key:"activity",items:[new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("SELF_CREATED"),key:"self_created"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("RECENTLY_WORKED_UPON"),key:"recently_worked_upon"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("FAVORITE"),key:"favorite"}),]})],confirm:function(e){var a="";var s=e.getParameter("filterItems");t.setFiltering(e.getParameter("filterItems"));if(s&&s.length){var b={};for(var i=0,l=s.length;i<l;i++){b[s[i].getParent().getKey()]=b[s[i].getParent().getKey()]||"";b[s[i].getParent().getKey()]+=(b[s[i].getParent().getKey()])?(","):"";b[s[i].getParent().getKey()]+=s[i].getText()}for(var c in b){if(b.hasOwnProperty(c)){a+=(a)?" ; ":"";a+=b[c]}}t.byId("filterToolbar").setVisible(true);t.byId("visualizationInfo").setText(a)}else{t.byId("visualizationInfo").setText("");t.byId("filterToolbar").setVisible(false)}}});return f},createSortOptions:function(){var t=this;var s=new sap.m.ViewSettingsDialog({id:this.createId("sortOptionsDialog"),sortItems:[new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("CREATION_DATE"),key:"newest"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("ALPHABETICALLY"),key:"alphabetically"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("NONE"),key:"none"})],confirm:function(e){if(e.getParameter("sortItem")){if(e.getParameter("sortItem").getKey()=="none"){t.setGrouping("indicator",(e.getParameter("groupDescending")||false))}else{t.setSorting(e.getParameter("sortItem").getKey(),e.getParameter("sortDescending"))}}else{t.setGrouping("indicator",(e.getParameter("groupDescending")||false))}}});return s},createGroupOptions:function(){var t=this;var g=new sap.m.ViewSettingsDialog({id:this.createId("groupOptionsDialog"),groupItems:[new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("BY_INDICATOR"),key:"indicator"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("BY_OWNER"),key:"owner"})],confirm:function(e){if(e.getParameter("groupItem")){t.setGrouping(e.getParameter("groupItem").getKey(),e.getParameter("groupDescending"))}else{t.setGrouping("indicator",(e.getParameter("groupDescending")||false))}}});return g},getHeaderFooterOptions:function(){var t=this;return{sI18NMasterTitle:"MASTER_TITLE",onBack:function(){window.history.back()},oFilterOptions:{onFilterPressed:function(e){t.getView().filterOptionDialog=t.getView().filterOptionDialog||t.createFilterOptions();t.getView().filterOptionDialog.open()}},oSortOptions:{onSortPressed:function(e){t.getView().sortOptionDialog=t.getView().sortOptionDialog||t.createSortOptions();t.getView().sortOptionDialog.open()}},oGroupOptions:{onGroupPressed:function(e){t.getView().groupOptionDialog=t.getView().groupOptionDialog||t.createGroupOptions();t.getView().groupOptionDialog.open()}},}},formatIndicatorId:function(c){return{text:("KPI: "+c.getProperty("INDICATOR")),key:c.getProperty("INDICATOR")}},setGrouping:function(k,g){var t=this;g=g||false;var l=this.getView().byId("list");if(k=="indicator"){l.getBinding("items").sort([new sap.ui.model.Sorter("INDICATOR",g,function(c){return{key:c.getProperty("INDICATOR"),text:("KPI: "+c.getProperty("INDICATOR"))}})])}else if(k=="owner"){l.getBinding("items").sort([new sap.ui.model.Sorter("OWNER_NAME",g,function(c){var o=c.getProperty("OWNER_NAME");var a="";switch(o){case null:a=t.oApplicationFacade.getResourceBundle().getText("NO_OWNER");break;case"":a=t.oApplicationFacade.getResourceBundle().getText("NO_OWNER");break;default:a=o}return{key:a,text:a}})])}},setFiltering:function(i){var f=[];var l=this.getView().byId("list");var a={"self_created":(new sap.ui.model.Filter("CREATED_BY",sap.ui.model.FilterOperator.EQ,this.oApplicationFacade.currentLogonHanaUser)),"recently_worked_upon":(new sap.ui.model.Filter("MANUAL_ENTRY",sap.ui.model.FilterOperator.EQ,0)),"favorite":(new sap.ui.model.Filter("MANUAL_ENTRY",sap.ui.model.FilterOperator.EQ,1))};f=sap.suite.smartbusiness.utils.getFilterArray(i,a);if(f.length){l.getBinding("items").filter(new sap.ui.model.Filter(f,true))}else{l.getBinding("items").filter(f)}},setSorting:function(k,g){g=g||false;var l=this.getView().byId("list");if(k=="newest"){l.getBinding("items").sort([new sap.ui.model.Sorter("CREATED_ON",g,null)])}else if(k=="alphabetically"){l.getBinding("items").sort([new sap.ui.model.Sorter("TITLE",g,null)])}},formatChipCount:function(c){return c||0},onExit:function(){var h=hasher||window.hasher;if(!(h.getHash())){sap.suite.smartbusiness.utils.backToHome()}}})};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.visualization.view.S3.controller')){jQuery.sap.declare('sap.suite.ui.smartbusiness.designtime.visualization.view.S3.controller');jQuery.sap.require('sap.ca.scfld.md.controller.BaseDetailController');jQuery.sap.require('sap.m.MessageBox');sap.ca.scfld.md.controller.BaseDetailController.extend("sap.suite.ui.smartbusiness.designtime.visualization.view.S3",{onInit:function(){var t=this;var v=this.getView();this.oRouter.attachRouteMatched(function(e){if(e.getParameter("name")==="detail"){t.selectedTile=undefined;var c=new sap.ui.model.Context(v.getModel(),'/'+e.getParameter("arguments").contextPath);v.setBindingContext(c)}},this);var t=this;this.oHeaderFooterOptions={bSuppressBookmarkButton:{},oEditBtn:{sI18nBtnTxt:t.oApplicationFacade.getResourceBundle().getText("FULLSCREEN_TITLE"),onBtnPressed:function(e){sap.suite.smartbusiness.utils.replaceHash({action:"configureSBKPITile",route:"addTile",context:t.getView().getBindingContext().sPath.substr(1)})},bEnabled:false,},buttonList:[]}},getHeaderFooterOptions:function(){return this.oHeaderFooterOptions},getChipRow:function(i,c){var t=this;var a;var b;var d=JSON.parse(JSON.parse(JSON.parse(c.getObject().configuration).tileConfiguration).TILE_PROPERTIES);var n=new sap.m.Text();if(d.navType=="0"){n.setText(t.oApplicationFacade.getResourceBundle().getText("GENERIC_DRILLDOWN"))}else{n.setText(t.oApplicationFacade.getResourceBundle().getText("OTHER_DRILLDOWN"))}var s=new sap.m.ObjectNumber();if(c.getObject().COUNTER=="1"){if(c.getObject().isActive){s.setNumber(t.oApplicationFacade.getResourceBundle().getText("STATUS_ACTIVE"));s.setState("Success")}else{s.setNumber(t.oApplicationFacade.getResourceBundle().getText("STATUS_NEW"));s.setState("None")}}else{s.setNumber(t.oApplicationFacade.getResourceBundle().getText("STATUS_ACTIVE_DRAFT"));s.setState("Success")}var f;var e;if(Number(d.navType)){e=true}else{e=false}if(c.getProperty("tileType")=="NT")a=new sap.suite.ui.commons.NumericContent({size:"S",value:"0.0",scale:"M",valueColor:"Good",unit:t.oApplicationFacade.getResourceBundle().getText("TILE_CURRENCY"),footer:t.oApplicationFacade.getResourceBundle().getText("ACTUAL")});else if(c.getProperty("tileType")=="CT")a=new sap.suite.ui.commons.ComparisonChart({scale:"M",size:"S",data:[new sap.suite.ui.commons.ComparisonData({title:t.oApplicationFacade.getResourceBundle().getText("VALUE_1"),value:1550}),new sap.suite.ui.commons.ComparisonData({title:t.oApplicationFacade.getResourceBundle().getText("VALUE_2"),value:219.2}),new sap.suite.ui.commons.ComparisonData({title:t.oApplicationFacade.getResourceBundle().getText("VALUE_3"),value:66.46})]});else if(c.getProperty("tileType")=="AT")a=new sap.suite.ui.commons.BulletChart({scale:"M",size:"S",minValue:0,maxvalue:312,targetValue:150,actual:new sap.suite.ui.commons.BulletChartData({value:312,color:"Error"}),thresholds:[new sap.suite.ui.commons.BulletChartData({value:312,color:"Error"}),new sap.suite.ui.commons.BulletChartData({value:200,color:"Critical"})]});else if(c.getProperty("tileType")=="TT")a=new sap.suite.ui.commons.MicroAreaChart({size:"S",width:"130px",height:"59px",minXValue:0,maxXValue:100,minYValue:0,maxYValue:100,firstXLabel:new sap.suite.ui.commons.MicroAreaChartLabel({label:"Jan 1",color:"Neutral"}),lastXLabel:new sap.suite.ui.commons.MicroAreaChartLabel({label:"Jan 31",color:"Neutral"}),firstYLabel:new sap.suite.ui.commons.MicroAreaChartLabel({label:"3 M",color:"Error"}),lastYLabel:new sap.suite.ui.commons.MicroAreaChartLabel({label:"23 M",color:"Good"}),target:new sap.suite.ui.commons.MicroAreaChartItem({points:[new sap.suite.ui.commons.MicroAreaChartPoint({x:0,y:0}),new sap.suite.ui.commons.MicroAreaChartPoint({x:30,y:30}),new sap.suite.ui.commons.MicroAreaChartPoint({x:60,y:40}),new sap.suite.ui.commons.MicroAreaChartPoint({x:100,y:90})]}),innerMinThreshold:new sap.suite.ui.commons.MicroAreaChartItem({color:"Good"}),innerMaxThreshold:new sap.suite.ui.commons.MicroAreaChartItem({color:"Good"}),minThreshold:new sap.suite.ui.commons.MicroAreaChartItem({color:"Error",points:[new sap.suite.ui.commons.MicroAreaChartPoint({x:0,y:0}),new sap.suite.ui.commons.MicroAreaChartPoint({x:30,y:40}),new sap.suite.ui.commons.MicroAreaChartPoint({x:60,y:50}),new sap.suite.ui.commons.MicroAreaChartPoint({x:100,y:100})]}),maxThreshold:new sap.suite.ui.commons.MicroAreaChartItem({color:"Error",points:[new sap.suite.ui.commons.MicroAreaChartPoint({x:0,y:0}),new sap.suite.ui.commons.MicroAreaChartPoint({x:30,y:20}),new sap.suite.ui.commons.MicroAreaChartPoint({x:60,y:30}),new sap.suite.ui.commons.MicroAreaChartPoint({x:100,y:70})]}),chart:new sap.suite.ui.commons.MicroAreaChartItem({points:[new sap.suite.ui.commons.MicroAreaChartPoint({x:0,y:0}),new sap.suite.ui.commons.MicroAreaChartPoint({x:30,y:40}),new sap.suite.ui.commons.MicroAreaChartPoint({x:60,y:50}),new sap.suite.ui.commons.MicroAreaChartPoint({x:100,y:100})]}),});else if(c.getProperty("tileType")=="CM"){a=new sap.suite.ui.commons.ComparisonChart({scale:"M",size:"S",data:[new sap.suite.ui.commons.ComparisonData({title:t.oApplicationFacade.getResourceBundle().getText("MEASURE_1"),value:34,color:"Good"}),new sap.suite.ui.commons.ComparisonData({title:t.oApplicationFacade.getResourceBundle().getText("MEASURE_2"),value:125,color:"Error"}),new sap.suite.ui.commons.ComparisonData({title:t.oApplicationFacade.getResourceBundle().getText("MEASURE_3"),value:97,color:"Critical"})]})}b=new sap.suite.ui.commons.GenericTile({size:"S",header:c.getProperty("title"),subheader:c.getProperty("description"),customData:[new sap.ui.core.CustomData({key:"tileType",value:c.getProperty("tileType")})],tileContent:new sap.suite.ui.commons.TileContent({content:a,size:"S",}),press:function(g){}}).addStyleClass("sbTile");return new sap.m.ColumnListItem({type:"Navigation",press:function(g){var h=this.getBindingContext().sPath;if(this.getBindingContext().getObject().isActive){if(this.getBindingContext().getObject().COUNTER==2){h=h.replace("isActive=1","isActive=0")}}else{h=h.replace("isActive=1","isActive=0")}h=h.replace("/CHIPS_MODELER","CHIPS");sap.suite.smartbusiness.utils.replaceHash({action:"configureSBKPITile",route:"editTile",context:(t.getView().getBindingContext().sPath.substr(1)+"/"+h)})},cells:[b,new sap.ui.layout.VerticalLayout({content:[n,new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText("SEMANTIC_OBJECT")+': '+d.semanticObject,visible:e}),new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText("ACTION")+': '+d.semanticAction,visible:e}),]}).addStyleClass("navigationVLayout"),s,new sap.ui.layout.HorizontalLayout({content:[new sap.ui.core.Icon({src:"sap-icon://edit",size:"22px",press:function(g){var h=this.getBindingContext().sPath;if(this.getBindingContext().getObject().isActive){if(this.getBindingContext().getObject().COUNTER==2){h=h.replace("isActive=1","isActive=0")}}else{h=h.replace("isActive=1","isActive=0")}h=h.replace("/CHIPS_MODELER","CHIPS");sap.suite.smartbusiness.utils.replaceHash({action:"configureSBKPITile",route:"editTile",context:(t.getView().getBindingContext().sPath.substr(1)+"/"+h)})}}),new sap.ui.core.Icon({src:"sap-icon://sys-cancel",size:"22px",press:function(g){t.handleDelete(this)}})]}).addStyleClass("chipActionsHLayout")]})},handleDelete:function(c){var t=this;sap.m.MessageBox.show(t.oApplicationFacade.getResourceBundle().getText("WANT_TO_DELETE_SELECTED_TILE"),"sap-icon://hint",t.oApplicationFacade.getResourceBundle().getText("DELETE"),[sap.m.MessageBox.Action.OK,sap.m.MessageBox.Action.CANCEL],function(e){if(e=="OK"){sap.suite.smartbusiness.utils.remove(sap.suite.smartbusiness.utils.serviceUrl("CHIP_SERVICE_URI"),{id:c.getBindingContext().getObject().id,isActive:c.getBindingContext().getObject().isActive},function(d){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("DELETION_SUCCESSFUL"));t.oApplicationFacade.getODataModel().refresh()},function(a){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("DELETION_FAILED"),a.responseText)})}if(e=="CANCEL"){}})},formatChipsCount:function(c){return this.oApplicationFacade.getResourceBundle().getText("TILES")+" ("+(c||0)+")"},getFooterButtons:function(){var t=this;var b=[{sI18nBtnTxt:t.oApplicationFacade.getResourceBundle().getText("ACTIVATE"),onBtnPressed:function(e){if(t.selectedTile){var d=JSON.parse(JSON.parse(JSON.parse(t.selectedTile.getBindingContext().getObject().configuration).tileConfiguration).TILE_PROPERTIES);var a=JSON.parse(JSON.parse(JSON.parse(t.selectedTile.getBindingContext().getObject().configuration).tileConfiguration).EVALUATION);var c="";if(!(d.semanticObject&&d.semanticAction&&t.selectedTile.getBindingContext().getObject().title&&t.selectedTile.getBindingContext().getObject().description)||(!(d.storyId)&&d.navType==1)||(d.semanticObject.length==(d.semanticObject.split(" ").length-1))||(d.semanticAction.length==(d.semanticAction.split(" ").length-1))){if(!(d.semanticObject)||(d.semanticObject.length==(d.semanticObject.split(" ").length-1))){c+=t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_SEMANTIC_OBJECT")+"\n"}if(!(d.semanticAction)||(d.semanticAction.length==(d.semanticAction.split(" ").length-1))){c+=t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_SEMANTIC_ACTION")+"\n"}if(!(t.selectedTile.getBindingContext().getObject().title)||(t.selectedTile.getBindingContext().getObject().title.length==(t.selectedTile.getBindingContext().getObject().title.split(" ").length-1))){c+=t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_TITLE")+"\n"}if(!(t.selectedTile.getBindingContext().getObject().description)||(t.selectedTile.getBindingContext().getObject().description.length==(t.selectedTile.getBindingContext().getObject().description.split(" ").length-1))){c+=t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_DESCRIPTION")+"\n"}if((!(d.storyId)&&(d.navType==1))){c+=t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_STORY_ID")}sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ACTIVATION_ERROR"),c)}else{if(t.selectedTile.getBindingContext().getObject().tileType=="CM"){if(!(a)||!(a.COLUMN_NAMES)||!(a.COLUMN_NAMES.length)){c+=t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_THREE_MEASURES")}else{for(var i=0,l=a.COLUMN_NAMES.length;i<l;i++){if(!(a.COLUMN_NAMES[i].COLUMN_NAME)||!(a.COLUMN_NAMES[i].semanticColor)){c+=t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_THREE_MEASURES");break}}if((!c)&&(a.COLUMN_NAMES.length==3)){if(a.COLUMN_NAMES[0].COLUMN_NAME==a.COLUMN_NAMES[1].COLUMN_NAME){c+=t.oApplicationFacade.getResourceBundle().getText("ERROR_DUPLICATE_MEASURE_THREE_MEASURES")}else if(a.COLUMN_NAMES[0].COLUMN_NAME==a.COLUMN_NAMES[2].COLUMN_NAME){c+=t.oApplicationFacade.getResourceBundle().getText("ERROR_DUPLICATE_MEASURE_THREE_MEASURES")}else if(a.COLUMN_NAMES[1].COLUMN_NAME==a.COLUMN_NAMES[2].COLUMN_NAME){c+=t.oApplicationFacade.getResourceBundle().getText("ERROR_DUPLICATE_MEASURE_THREE_MEASURES")}}}}if(c){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ACTIVATION_ERROR"),c)}else{sap.suite.smartbusiness.utils.create(sap.suite.smartbusiness.utils.serviceUrl("ACTIVATE_CHIP_SERVICE_URI"),{id:t.selectedTile.getBindingContext().getObject().id},null,function(d){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("ACTIVATION_SUCCESSFUL"));t.oApplicationFacade.getODataModel().refresh();t.selectedTile=undefined;t.updateFooterButtons()},function(f){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ACTIVATION_ERROR"),f.responseText)})}}}else{sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("SELECT_A_TILE_TO_DELETE"))}},},{sI18nBtnTxt:t.oApplicationFacade.getResourceBundle().getText("EDIT")+" "+t.oApplicationFacade.getResourceBundle().getText("STATUS_DRAFT"),onBtnPressed:function(e){if(t.selectedTile){var c=t.selectedTile.getBindingContext().sPath.replace("isActive=1","isActive=0");c=c.replace("/CHIPS_MODELER","CHIPS");t.oRouter.navTo("editTile",{contextPath:t.getView().getBindingContext().sPath.substr(1),chipContextPath:c})}else{sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("SELECT_A_TILE_TO_EDIT"))}},},{sI18nBtnTxt:t.oApplicationFacade.getResourceBundle().getText("EDIT"),onBtnPressed:function(e){if(t.selectedTile){t.oRouter.navTo("editTile",{contextPath:t.getView().getBindingContext().sPath.substr(1),chipContextPath:t.selectedTile.getBindingContext().sPath.replace("/CHIPS_MODELER","CHIPS")})}else{sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("SELECT_A_TILE_TO_EDIT"))}},},{sI18nBtnTxt:t.oApplicationFacade.getResourceBundle().getText("DELETE"),onBtnPressed:function(e){if(t.selectedTile){sap.m.MessageBox.show(t.oApplicationFacade.getResourceBundle().getText("WANT_TO_DELETE_SELECTED_TILE"),"sap-icon://hint",t.oApplicationFacade.getResourceBundle().getText("DELETE"),[sap.m.MessageBox.Action.OK,sap.m.MessageBox.Action.CANCEL],function(e){if(e=="OK"){t.oApplicationFacade.getODataModel().remove(t.selectedTile.getBindingContext().sPath.replace("CHIPS_MODELER","CHIPS"),null,function(d){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("DELETION_SUCCESSFUL"));t.oApplicationFacade.getODataModel().refresh();t.selectedTile=undefined;t.updateFooterButtons()},function(a){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("DELETION_FAILED"),a.response.body)})}if(e=="CANCEL"){}})}else{sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("SELECT_A_TILE_TO_DELETE"))}},}];return b},setSorting:function(k,g){g=g||false;var l=this.getView().byId("tileGrid");if(k=="tileType"){l.getBinding("items").sort([new sap.ui.model.Sorter("tileType",g,null)])}else if(k=="status"){l.getBinding("items").sort([new sap.ui.model.Sorter("isActive",g,null),new sap.ui.model.Sorter("COUNTER",g,null)])}else if(k=="none"){l.getBinding("items").sort([])}},setFiltering:function(i){var f=[];var l=this.getView().byId("tileGrid");var a={"NT":(new sap.ui.model.Filter("tileType",sap.ui.model.FilterOperator.EQ,'NT')),"CT":(new sap.ui.model.Filter("tileType",sap.ui.model.FilterOperator.EQ,'CT')),"AT":(new sap.ui.model.Filter("tileType",sap.ui.model.FilterOperator.EQ,'AT')),"TT":(new sap.ui.model.Filter("tileType",sap.ui.model.FilterOperator.EQ,'TT')),"CM":(new sap.ui.model.Filter("tileType",sap.ui.model.FilterOperator.EQ,'CM')),"new":(new sap.ui.model.Filter("isActive",sap.ui.model.FilterOperator.EQ,0)),"active":(new sap.ui.model.Filter("isActive",sap.ui.model.FilterOperator.EQ,1))};f=sap.suite.smartbusiness.utils.getFilterArray(i,a);if(f.length){l.getBinding("items").filter(new sap.ui.model.Filter(f,true))}else{l.getBinding("items").filter(f)}},handleSortPress:function(){var t=this;this.sortOptionsDialog=this.sortOptionsDialog||new sap.m.ViewSettingsDialog({id:this.createId("sortOptionsDialog"),sortItems:[new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("TILE_TYPE"),key:"tileType"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("STATUS"),key:"status"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("NONE"),key:"none"})],confirm:function(e){if(e.getParameter("sortItem")){t.setSorting(e.getParameter("sortItem").getKey(),e.getParameter("sortDescending"))}}});this.sortOptionsDialog.open()},handleFilterPress:function(){var t=this;this.filterOptionsDialog=this.filterOptionsDialog||new sap.m.ViewSettingsDialog({id:this.createId("filterOptionsDialog"),filterItems:[new sap.m.ViewSettingsFilterItem({text:t.oApplicationFacade.getResourceBundle().getText("TILE_TYPE"),key:"tileType",items:[new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("NUMERIC_TILE"),key:"NT"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("COMPARISON_TILE"),key:"CT"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("TREND_TILE"),key:"AT"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("ACTUAL_VS_TARGET_TILE"),key:"TT"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("COMPARISON_MM_TILE"),key:"CM"})]}),new sap.m.ViewSettingsFilterItem({text:t.oApplicationFacade.getResourceBundle().getText("STATUS"),key:"status",items:[new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("STATUS_NEW"),key:"new"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("STATUS_ACTIVE"),key:"active"})]})],confirm:function(e){var a="";var s=e.getParameter("filterItems");t.setFiltering(e.getParameter("filterItems"));if(s&&s.length){var f={};for(var i=0,l=s.length;i<l;i++){f[s[i].getParent().getKey()]=f[s[i].getParent().getKey()]||"";f[s[i].getParent().getKey()]+=(f[s[i].getParent().getKey()])?(","):"";f[s[i].getParent().getKey()]+=s[i].getText()}for(var b in f){if(f.hasOwnProperty(b)){a+=(a)?" ; ":"";a+=f[b]}}t.byId("filterToolbar").setVisible(true);t.byId("visualizationInfo").setText(a)}else{t.byId("visualizationInfo").setText("");t.byId("filterToolbar").setVisible(false)}}});this.filterOptionsDialog.open()}})};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.visualization.view.S4.controller')){jQuery.sap.declare('sap.suite.ui.smartbusiness.designtime.visualization.view.S4.controller');jQuery.sap.require('sap.ca.scfld.md.controller.BaseFullscreenController');sap.ca.scfld.md.controller.BaseFullscreenController.extend("sap.suite.ui.smartbusiness.designtime.visualization.view.S4",{onInit:function(){var t=this;var v=this.getView();this.LUMIRA_SEMANTIC_OBECT="LumiraAnalytics";this.LUMIRA_ACTION="openStory";this.lumiraSemanticObject="LumiraAnalytics";this.lumiraAction="openStory";this.apfSemanticObject="";this.apfAction="";this.APF_SEMANTIC_OBECT="";this.APF_ACTION="";this.sbAction="analyzeSBKPIDetails";if(!(t.oApplicationFacade.currentLogonHanaUser)){this.oApplicationFacade.getODataModel().read("/SESSION_USER",null,null,true,function(d){t.oApplicationFacade.currentLogonHanaUser=(d.results&&d.results.length)?d.results[0].LOGON_USER:null},function(e){t.oApplicationFacade.currentLogonHanaUser=null;sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("YMSG_ERROR_RETRIEVING_DATA"),e.response.body)})}this.oRouter.attachRouteMatched(function(e){if(e.getParameter("name")=="addTile"||e.getParameter("name")=="editTile"){this.oApplicationFacade.getODataModel().read("/LANGUAGE?$select=LAISO,SPRAS",null,null,false,function(d){d=d.results;if(d.length){if(d.length==1){t.languagesObject={LAISO:{},SPRAS:{}};t.languagesObject.LAISO[d[0]["LAISO"]]=d[0]["SPRAS"];t.languagesObject.SPRAS[d[0]["SPRAS"]]=d[0]["LAISO"]}else{t.languagesObject=d.reduce(function(p,c,i,a){t.languagesObject=t.languagesObject||{};t.languagesObject.LAISO=t.languagesObject.LAISO||{};t.languagesObject.SPRAS=t.languagesObject.SPRAS||{};if(i==1){t.languagesObject.LAISO[a[0]["LAISO"]]=a[0]["SPRAS"];t.languagesObject.SPRAS[a[0]["SPRAS"]]=a[0]["LAISO"]}t.languagesObject.LAISO[a[i]["LAISO"]]=a[i]["SPRAS"];t.languagesObject.SPRAS[a[i]["SPRAS"]]=a[i]["LAISO"];return t.languagesObject})}}t.languagesArray=d})}if(e.getParameter("name")=="addTile"){this.getSelectedRadioButton(null,"GDD");this.byId('selectTileType').setSelectedKey('NT');this.selectTile('NT');this.getView().byId('NT').$().css("border","solid 2px "+sap.ui.core.theming.Parameters.get("sapUiHighlight"));this.lumiraSemanticObject="LumiraAnalytics";this.lumiraAction="openStory";this.apfSemanticObject="";this.apfAction="";this.initialAppParameters=[];t.oApplicationFacade.getODataModel().read(e.getParameter("arguments").contextPath+"/TEXTS",null,null,true,function(l){l=l.results;var a=[];var i;for(i=0;i<l.length;i++){if(l[i].LANGUAGE!=t.localLanguage){a.push(l[i])}}var b=[];var i;for(i=0;i<a.length;i++){var c={};c.ADDITIONAL_LANGUAGE_TITLE=a[i].TITLE;c.ADDITIONAL_LANGUAGE_DESCRIPTION=a[i].DESCRIPTION;c.ADDITIONAL_SAP_LANGUAGE_KEY=a[i].LANGUAGE;c.ADDITIONAL_LANGUAGE_KEY=t.languagesObject.SPRAS[c.ADDITIONAL_SAP_LANGUAGE_KEY];b.push(c)}t.oldLanguagePayload=$.extend(true,[],a);t.additionalLanguageLinkModel.setProperty("/ADDITIONAL_LANGUAGE_ARRAY",b);t.additionalLanguageLinkModel.setProperty("/NO_OF_ADDITIONAL_LANGUAGES",t.additionalLanguageLinkModel.getData().ADDITIONAL_LANGUAGE_ARRAY.length);t.byId('additionalLanguageLink').bindProperty("text","additionalLanguageLinkModel>/NO_OF_ADDITIONAL_LANGUAGES",function(V){return t.oApplicationFacade.getResourceBundle().getText("ADDITIONAL_LANGUAGE")+"("+V+")"})},function(a){})}if(e.getParameter("name")==="addTile"||e.getParameter("name")==="editTile"){t.inSufficientAdditionalMeasureAlerted=false;t.inSufficientAdditionalMeasure=false;t.byId("semanticObjectText").setValueState("None");t.byId("selectODD").setValueState("None");t.byId("tileTitle").setValueState("None");t.byId("tileSubtitle").setValueState("None");t.byId("appPropertyName").setValueState("None");t.byId("appPropertyValue").setValueState("None");t.byId("selectStoryId").setValueState("None");this.getSelectedRadioButton(null,"GDD");this.appMode=e.getParameter("name");this.context=new sap.ui.model.Context(v.getModel(),'/'+e.getParameter("arguments").contextPath);v.setBindingContext(this.context);this.tileConfigurationModel=new sap.ui.model.json.JSONModel();this.byId("tileConfigForm").setModel(this.tileConfigurationModel,"tileConfig");this.tileConfigurationModel.setData({});this.appParametersModel=new sap.ui.model.json.JSONModel();this.getView().byId('propertyNameValueBox').setModel(this.appParametersModel,"appParameters");this.additionalLanguageLinkModel=new sap.ui.model.json.JSONModel();this.getView().byId('additionalLanguageLink').setModel(this.additionalLanguageLinkModel,"additionalLanguageLinkModel");t.localLanguage=t.languagesObject.LAISO[sap.ui.getCore().getConfiguration().getLocale().getLanguage().split("-")[0].toUpperCase()];if(this.context.getObject()){this.onAfterContextData(this.context.getObject())}else{this.oApplicationFacade.getODataModel().read("/"+e.getParameter("arguments").contextPath,null,null,true,function(d){t.onAfterContextData(d)},function(a){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("FAILED_TO_READ_CHIP_INFO"),a.response.body)})}t.oApplicationFacade.getODataModel().read(e.getParameter("arguments").contextPath+"/VALUES",null,null,false,function(d){t.evaluationDetails=t.evaluationDetails||{};t.evaluationDetails.VALUES=[];var a={};var o={};for(var i=0,l=d.results.length;i<l;i++){o={};o.TYPE=d.results[i].TYPE;o.FIXED=d.results[i].FIXED;o.COLUMN_NAME=d.results[i].COLUMN_NAME;o.ODATA_PROPERTY=d.results[i].ODATA_PROPERTY;t.evaluationDetails.VALUES.push(o);a[o.TYPE]=o}var m={Measures:[]};if(t.evaluationObj){m={Measures:[{COLUMN_NAME:t.evaluationObj.COLUMN_NAME}]}}i=0;while(a[((i<10)?("0"+i):i)]){m.Measures.push({COLUMN_NAME:a[((i<10)?("0"+i):i)].COLUMN_NAME});i++}if(m.Measures.length<2){t.inSufficientAdditionalMeasure=true}t.customMeasuresModel=new sap.ui.model.json.JSONModel();t.customMeasuresModel.setData(m);var b=jQuery.extend(true,{},m,{});t.customMeasuresModel1=new sap.ui.model.json.JSONModel();t.customMeasuresModel1.setData(b)},function(a){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("YMSG_ERROR_RETRIEVING_DATA"),a.response.body)});t.oApplicationFacade.getODataModel().read(e.getParameter("arguments").contextPath+"/FILTERS",null,null,true,function(d){t.evaluationDetails=t.evaluationDetails||{};t.evaluationDetails.FILTERS=[];var o={};for(var i=0,l=d.results.length;i<l;i++){o={};o.TYPE=d.results[i].TYPE;o.NAME=d.results[i].NAME;o.VALUE_1=d.results[i].VALUE_1;o.OPERATOR=d.results[i].OPERATOR;o.VALUE_2=d.results[i].VALUE_2;t.evaluationDetails.FILTERS.push(o)}},function(a){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("YMSG_ERROR_RETRIEVING_DATA"),a.response.body)})}if(e.getParameter("name")=="editTile"){this.chipContext=new sap.ui.model.Context(v.getModel(),'/'+e.getParameter("arguments").chipContextPath);t.oApplicationFacade.getODataModel().read(e.getParameter("arguments").chipContextPath+"/TEXTS",null,null,true,function(l){l=l.results;var a=[];var i;for(i=0;i<l.length;i++){if(l[i].language!=t.localLanguage){a.push(l[i])}}var b=[];var i;for(i=0;i<a.length;i++){var c={};c.ADDITIONAL_LANGUAGE_TITLE=a[i].title;c.ADDITIONAL_LANGUAGE_DESCRIPTION=a[i].description;c.ADDITIONAL_SAP_LANGUAGE_KEY=a[i].language;c.ADDITIONAL_LANGUAGE_KEY=t.languagesObject.SPRAS[c.ADDITIONAL_SAP_LANGUAGE_KEY];b.push(c)}t.oldLanguagePayload=$.extend(true,[],a);t.additionalLanguageLinkModel.setProperty("/ADDITIONAL_LANGUAGE_ARRAY",b);t.additionalLanguageLinkModel.setProperty("/NO_OF_ADDITIONAL_LANGUAGES",t.additionalLanguageLinkModel.getData().ADDITIONAL_LANGUAGE_ARRAY.length);t.byId('additionalLanguageLink').bindProperty("text","additionalLanguageLinkModel>/NO_OF_ADDITIONAL_LANGUAGES",function(V){return t.oApplicationFacade.getResourceBundle().getText("ADDITIONAL_LANGUAGE")+"("+V+")"})},function(a){});if(this.chipContext.getObject()){this.onAfterChipContextData(this.chipContext.getObject())}else{this.oApplicationFacade.getODataModel().read(e.getParameter("arguments").chipContextPath,null,null,true,function(d){delete d.DDA_CONFIGURATIONS;delete d.EVALUATION_INFO;delete d.TEXTS;delete d.__metadata;t.onAfterChipContextData(d)},function(a){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("FAILED_TO_READ_CHIP_INFO"),a.response.body)})}}},this)},getHeaderFooterOptions:function(){var t=this;this.oHeaderFooterOptions={bSuppressBookmarkButton:{},onBack:function(){t.handleBackAndCancel()},oEditBtn:{sI18nBtnTxt:"SAVE",onBtnPressed:function(e){var c=t.formChipConfiguration();var s=t.publishChip(c);if(s){t.oApplicationFacade.getODataModel().refresh();sap.suite.smartbusiness.utils.replaceHash({action:"configureSBKPITile",route:"detail",context:t.context.sPath.substr(1)})}}},buttonList:[]};return this.oHeaderFooterOptions},getSelectedRadioButton:function(e,c){var b=this.getView().getBindingContext();if((e&&e.mParameters.selected)||c){this.confirmationType=(e)?e.getSource().data("drilldownType"):c;if(this.confirmationType==='GDD'){this.getView().byId('selectNavType').setVisible(false);this.getView().byId('selectStoryId').setVisible(false);this.getView().byId('semanticObjectText').setVisible(false);this.getView().byId('selectODD').setVisible(false);this.getView().byId('propertyNameValueBoxHeader').setVisible(false);this.getView().byId('propertyNameValueBox').setVisible(false);if(this.tileConfigurationModel&&this.tileConfigurationModel.getData()){this.tileConfigurationModel.getData().semanticObject=this.onLoadSemanticObject;this.tileConfigurationModel.getData().action=this.sbAction;this.tileConfigurationModel.getData().navType="0"}}else if(this.confirmationType==='ODD'){this.getView().byId('selectNavType').setVisible(true);this.getView().byId('selectStoryId').setVisible(true);this.getView().byId('selectODD').setVisible(true);this.getView().byId('semanticObjectText').setVisible(true);this.getView().byId('selectODD').setVisible(true);this.getView().byId('propertyNameValueBoxHeader').setVisible(true);this.getView().byId('propertyNameValueBox').setVisible(true);if(this.tileConfigurationModel&&this.tileConfigurationModel.getData()){this.tileConfigurationModel.getData().navType=(Number(this.tileConfigurationModel.getData().navType))?this.tileConfigurationModel.getData().navType:"1"}this.getView().byId('selectNavType').setSelectedKey(this.tileConfigurationModel.getData().navType);this.selectNavType(null,this.tileConfigurationModel.getData().navType)}}},selectTileType:function(e){this.tileConfigurationModel.getData().tileType=e.getSource().getSelectedKey();this.selectTile(e.getSource().getSelectedItem().getKey())},onTileSelect:function(e){this.tileType=e.getSource().data("tileType");this.selectTile(this.tileType);this.getView().byId('selectTileType').setSelectedKey(this.tileType);this.tileConfigurationModel.getData().tileType=this.getView().byId('selectTileType').getSelectedKey()},selectTile:function(k){this.getView().byId('NT').$().css("border","solid 2px "+sap.ui.core.theming.Parameters.get("sapUiWhite"));this.getView().byId('CT').$().css("border","solid 2px "+sap.ui.core.theming.Parameters.get("sapUiWhite"));this.getView().byId('TT').$().css("border","solid 2px "+sap.ui.core.theming.Parameters.get("sapUiWhite"));this.getView().byId('AT').$().css("border","solid 2px "+sap.ui.core.theming.Parameters.get("sapUiWhite"));this.getView().byId('CM').$().css("border","solid 2px "+sap.ui.core.theming.Parameters.get("sapUiWhite"));this.getView().byId(k).$().css("border","solid 2px "+sap.ui.core.theming.Parameters.get("sapUiHighlight"));if(k==="NT"){this.getView().byId('selectDimension').setVisible(false);this.getView().byId('selectSortOrder').setVisible(false);this.getView().byId('measure1Layout').setVisible(false);this.getView().byId('measure2Layout').setVisible(false);this.getView().byId('measure3Layout').setVisible(false)}else if(k==="CT"){this.getView().byId('selectDimension').setVisible(true);this.getView().byId('selectSortOrder').setVisible(true);this.getView().byId('measure1Layout').setVisible(false);this.getView().byId('measure2Layout').setVisible(false);this.getView().byId('measure3Layout').setVisible(false)}else if(k==="TT"){this.getView().byId('selectDimension').setVisible(true);this.getView().byId('selectSortOrder').setVisible(false);this.getView().byId('measure1Layout').setVisible(false);this.getView().byId('measure2Layout').setVisible(false);this.getView().byId('measure3Layout').setVisible(false)}else if(k==="AT"){this.getView().byId('selectDimension').setVisible(false);this.getView().byId('selectSortOrder').setVisible(false);this.getView().byId('measure1Layout').setVisible(false);this.getView().byId('measure2Layout').setVisible(false);this.getView().byId('measure3Layout').setVisible(false)}else if(k==="CM"){if(this.inSufficientAdditionalMeasure&&!(this.inSufficientAdditionalMeasureAlerted)){sap.m.MessageToast.show(this.oApplicationFacade.getResourceBundle().getText("INSUFFICIENT_ADDL_MEASURES"));this.inSufficientAdditionalMeasureAlerted=true}this.getView().byId('selectDimension').setVisible(false);this.getView().byId('selectSortOrder').setVisible(false);this.getView().byId('measure1Layout').setVisible(true);this.getView().byId('measure2Layout').setVisible(true);this.getView().byId('measure3Layout').setVisible(true)}},selectSortOrder:function(e){this.tileConfigurationModel.getData().sortOrder=e.getSource().getSelectedKey()},selectNavType:function(e,k){if(e){k=e.getSource().getSelectedKey()}this.tileConfigurationModel.getData().navType=k;this.byId("selectNavType").setSelectedKey(k);switch(Number(k)){case 1:this.getView().byId("selectStoryId").setVisible(true);this.tileConfigurationModel.getData().semanticObject=this.lumiraSemanticObject;this.getView().byId("semanticObjectText").setValue(this.lumiraSemanticObject);this.tileConfigurationModel.getData().action=this.lumiraAction;this.getView().byId("selectODD").setValue(this.lumiraAction);break;case 2:this.getView().byId("selectStoryId").setVisible(false);this.tileConfigurationModel.getData().semanticObject=this.apfSemanticObject;this.getView().byId("semanticObjectText").setValue(this.apfSemanticObject);this.tileConfigurationModel.getData().action=this.apfAction;this.getView().byId("selectODD").setValue(this.apfAction);break;case 3:this.tileConfigurationModel.getData().semanticObject=this.tempSemanticObject||this.evaluationObj.semanticObject||"";this.getView().byId("semanticObjectText").setValue(this.tileConfigurationModel.getData().semanticObject);this.tileConfigurationModel.getData().action=this.tempAction||this.evaluationObj.action||"";this.getView().byId("selectODD").setValue(this.tileConfigurationModel.getData().action);break;case 4:this.getView().byId("selectStoryId").setVisible(false);this.tileConfigurationModel.getData().semanticObject=this.tempSemanticObject||this.evaluationObj.semanticObject||"";this.getView().byId("semanticObjectText").setValue(this.tempSemanticObject||this.evaluationObj.semanticObject||"");this.tileConfigurationModel.getData().action=this.tempAction||this.evaluationObj.action||"";this.getView().byId("selectODD").setValue(this.tempAction||this.evaluationObj.action||"");break;default:break}},formChipConfiguration:function(){var t=this;var p={};var d=this.tileConfigurationModel.getData();var c=null;var a={};var b={};p.id=d.id||"";this.currentChipId=p.id;p.isActive=0;p.catalogId='HANA_CATALOG';p.title=d.title;p.description=d.description;p.tileType=d.tileType;p.evaluationId=d.evaluationId;p.url=p.url||this.getChipUrl(p.tileType);p.keywords=d.keywords;if(d.changedOn){p.changedOn=d.changedOn}b.id=d.id||"";b.evaluationId=d.evaluationId;b.tileType=d.tileType;if(d.tileType=='CT'){b.dimension=d.dimension||this.byId("selectDimension").getSelectedKey();b.sortOrder=d.sortOrder||this.byId("selectSortOrder").getSelectedKey()}if(d.tileType=='TT'){b.dimension=d.dimension||this.byId("selectDimension").getSelectedKey()}var e=this.getView().getBindingContext().getObject()||this.evaluationObj;b.frameType='OneByOne';if(this.byId("genericDrilldown").getSelected()){b.navType="0";b.semanticObject=(d.semanticObject&&(d.semanticObject.length!=(d.semanticObject.split(" ").length-1)))?d.semanticObject:e.COLUMN_NAME;b.semanticAction=this.sbAction}else{b.navType=d.navType||this.byId("selectNavType").getSelectedKey();if(b.navType=="1"){b.storyId=d.storyId||this.byId("selectStoryId").getValue()}else{delete d.storyId}b.semanticObject=d.semanticObject||this.byId("semanticObjectText").getValue();b.semanticAction=d.action||this.byId("selectODD").getValue()}a.ADDITIONAL_APP_PARAMETERS={};var f=this.byId("propertyNameValueBox").getModel("appParameters").getData();if(f.PROPERTIES&&f.PROPERTIES.length){for(var i=0,l=f.PROPERTIES.length;i<l;i++){a.ADDITIONAL_APP_PARAMETERS[f.PROPERTIES[i].NAME]=f.PROPERTIES[i].VALUE}}a.ADDITIONAL_APP_PARAMETERS=Object.keys(a.ADDITIONAL_APP_PARAMETERS).length?JSON.stringify(a.ADDITIONAL_APP_PARAMETERS):JSON.stringify({});a.TILE_PROPERTIES=JSON.stringify(b);a.EVALUATION_FILTERS=this.evaluationDetails.FILTERS.length?JSON.stringify(this.evaluationDetails.FILTERS):JSON.stringify([]);a.EVALUATION_VALUES=this.evaluationDetails.VALUES.length?JSON.stringify(this.evaluationDetails.VALUES):JSON.stringify([]);this.evaluationDetails.EVALUATION={};this.evaluationDetails.EVALUATION.ID=e.ID;this.evaluationDetails.EVALUATION.INDICATOR=e.INDICATOR;this.evaluationDetails.EVALUATION.INDICATOR_TYPE=e.INDICATOR_TYPE;this.evaluationDetails.EVALUATION.INDICATOR_TITLE=e.INDICATOR_TITLE;this.evaluationDetails.EVALUATION.GOAL_TYPE=e.GOAL_TYPE;this.evaluationDetails.EVALUATION.TITLE=e.TITLE;this.evaluationDetails.EVALUATION.SCALING=e.SCALING;this.evaluationDetails.EVALUATION.ODATA_URL=e.ODATA_URL;this.evaluationDetails.EVALUATION.ODATA_ENTITYSET=e.ODATA_ENTITYSET;this.evaluationDetails.EVALUATION.VIEW_NAME=e.VIEW_NAME;if(d.tileType=='CM'){this.evaluationDetails.EVALUATION.COLUMN_NAMES=[];var g=this.getView().getModel("multiMeasures").getData();if(g&&g.MULTI_MEASURE){g=g.MULTI_MEASURE}this.evaluationCustomMeasureArray=[];for(var i=0,l=g.length;i<l;i++){if(g[i].COLUMN_NAME){this.evaluationDetails.EVALUATION.COLUMN_NAMES.push({COLUMN_NAME:g[i].COLUMN_NAME,semanticColor:g[i].semanticColor});this.evaluationCustomMeasureArray.push({COLUMN_NAME:g[i].COLUMN_NAME,semanticColor:g[i].semanticColor})}else{this.evaluationCustomMeasureArray.push({COLUMN_NAME:null,semanticColor:null})}}}this.evaluationDetails.EVALUATION.COLUMN_NAME=e.COLUMN_NAME;this.evaluationDetails.EVALUATION.OWNER_NAME=e.OWNER_NAME;this.evaluationDetails.EVALUATION.VALUES_SOURCE=e.VALUES_SOURCE;a.EVALUATION=this.evaluationDetails.EVALUATION?JSON.stringify(this.evaluationDetails.EVALUATION):JSON.stringify({});c=JSON.stringify({tileConfiguration:JSON.stringify(a),isSufficient:"1",timeStamp:Date.now().toString()});var h=4050;if(p.id){h=4096}if(c.length>h){a.EVALUATION_FILTERS=JSON.stringify([]);c=JSON.stringify({tileConfiguration:JSON.stringify(a),isSufficient:"0",timeStamp:Date.now().toString()});if(c.length>h){a.EVALUATION_VALUES=JSON.stringify([]);a.EVALUATION_FILTERS=JSON.stringify([]);c=JSON.stringify({tileConfiguration:JSON.stringify(a),isSufficient:"0",timeStamp:Date.now().toString()})}}p.configuration=c;return p},publishChip:function(p){var s=true;var t=this;p.keywords=p.keywords||"";delete p.navType;delete p.semanticObject;delete p.action;this.chipTextPayload=[];var b=[];this.deleteBatch=[];this.createBatch=[];var a=true;var d=this.oApplicationFacade.getODataModel();if(this.appMode=="addTile"){var f=[];if(t.additionalLanguageLinkModel.getData().NO_OF_ADDITIONAL_LANGUAGES){for(var i=0;i<t.additionalLanguageLinkModel.getData().NO_OF_ADDITIONAL_LANGUAGES;i++){var c={};c.title=t.additionalLanguageLinkModel.getData().ADDITIONAL_LANGUAGE_ARRAY[i].ADDITIONAL_LANGUAGE_TITLE;c.description=t.additionalLanguageLinkModel.getData().ADDITIONAL_LANGUAGE_ARRAY[i].ADDITIONAL_LANGUAGE_DESCRIPTION;c.id=p.id;c.language=t.additionalLanguageLinkModel.getData().ADDITIONAL_LANGUAGE_ARRAY[i].ADDITIONAL_SAP_LANGUAGE_KEY;c.isActive=0;t.chipTextPayload.push(c)}}f.push({id:p.id,isActive:p.isActive,CHIP:p,TEXTS:t.chipTextPayload});sap.suite.smartbusiness.utils.create(sap.suite.smartbusiness.utils.serviceUrl("CHIP_SERVICE_URI"),f,null,function(h){s=true;t.currentChipId=JSON.parse(h).response[0].id;sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("TILE_SAVED_SUCCESSFULLY"))},function(h){s=false;sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ERROR_SAVING_TILE"),h.responseText)})}else{if(this.currentContextState){var f=[];if(t.additionalLanguageLinkModel.getData().NO_OF_ADDITIONAL_LANGUAGES){for(var i=0;i<t.additionalLanguageLinkModel.getData().NO_OF_ADDITIONAL_LANGUAGES;i++){var c={};c.title=t.additionalLanguageLinkModel.getData().ADDITIONAL_LANGUAGE_ARRAY[i].ADDITIONAL_LANGUAGE_TITLE;c.description=t.additionalLanguageLinkModel.getData().ADDITIONAL_LANGUAGE_ARRAY[i].ADDITIONAL_LANGUAGE_DESCRIPTION;c.id=p.id;c.language=t.additionalLanguageLinkModel.getData().ADDITIONAL_LANGUAGE_ARRAY[i].ADDITIONAL_SAP_LANGUAGE_KEY;c.isActive=0;t.chipTextPayload.push(c)}}f.push({id:p.id,isActive:p.isActive,CHIP:p,TEXTS:t.chipTextPayload});sap.suite.smartbusiness.utils.create(sap.suite.smartbusiness.utils.serviceUrl("CHIP_SERVICE_URI"),f,null,function(h){s=true;sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("TILE_SAVED_SUCCESSFULLY"))},function(h){s=false;sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ERROR_SAVING_TILE"),h.responseText)})}else{var f=[];if(t.additionalLanguageLinkModel.getData().NO_OF_ADDITIONAL_LANGUAGES){for(var i=0;i<t.additionalLanguageLinkModel.getData().NO_OF_ADDITIONAL_LANGUAGES;i++){var c={};c.title=t.additionalLanguageLinkModel.getData().ADDITIONAL_LANGUAGE_ARRAY[i].ADDITIONAL_LANGUAGE_TITLE;c.description=t.additionalLanguageLinkModel.getData().ADDITIONAL_LANGUAGE_ARRAY[i].ADDITIONAL_LANGUAGE_DESCRIPTION;c.id=p.id;c.language=t.additionalLanguageLinkModel.getData().ADDITIONAL_LANGUAGE_ARRAY[i].ADDITIONAL_SAP_LANGUAGE_KEY;c.isActive=0;t.chipTextPayload.push(c)}}t.languagePayloadForDirtyBitTest=[];for(var i=0;i<t.oldLanguagePayload.length;i++){var e={};e.id=p.id;e.language=t.oldLanguagePayload[i].language;e.isActive=t.oldLanguagePayload[i].isActive;e.description=t.oldLanguagePayload[i].description;e.title=t.oldLanguagePayload[i].title;t.languagePayloadForDirtyBitTest.push(e)}var l=sap.suite.smartbusiness.utils.dirtyBitCheck({oldPayload:t.languagePayloadForDirtyBitTest,newPayload:t.chipTextPayload,objectType:"CHIP_TEXTS"});var g={remove:[],create:[]};if(l){if(l.deletes.length){for(var i=0;i<l.deletes.length;i++){g.remove.push(l.deletes[i])}}if(l.updates.length){for(var i=0;i<l.updates.length;i++){t.createBatch.push(d.createBatchOperation("/CHIP_TEXTS","POST",l.updates[i]));g.create.push(l.updates[i])}}}f.push({id:p.id,isActive:p.isActive,CHIP:{update:p},TEXTS:g});sap.suite.smartbusiness.utils.update(sap.suite.smartbusiness.utils.serviceUrl("CHIP_SERVICE_URI"),f,null,function(h){s=true;sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("TILE_SAVED_SUCCESSFULLY"))},function(h){s=false;sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ERROR_SAVING_TILE"),h.responseText)})}}return s},getChipUrl:function(t){var c={"NT":"/sap/bc/ui5_ui5/ui2/ushell/resources/sap/ushell/components/tiles/indicatornumeric/NumericTileChip.xml","CT":"/sap/bc/ui5_ui5/ui2/ushell/resources/sap/ushell/components/tiles/indicatorcontribution/ContributionTileChip.xml","TT":"/sap/bc/ui5_ui5/ui2/ushell/resources/sap/ushell/components/tiles/indicatorArea/AreaChartTileChip.xml","AT":"/sap/bc/ui5_ui5/ui2/ushell/resources/sap/ushell/components/tiles/indicatordeviation/DeviationTileChip.xml","CM":"/sap/bc/ui5_ui5/ui2/ushell/resources/sap/ushell/components/tiles/indicatorcomparison/ComparisonTileChip.xml"};return c[t]},populateDimension:function(d,e){d=this.validateQueryServiceURI(d)+"";e=e+"";var a=[],b=[],o={};var i;a=sap.suite.smartbusiness.odata.getAllDimensions(d,e);for(i=0;i<a.length;i++){o={};o.dimensionName=a[i];b.push(o)}var m=new sap.ui.model.json.JSONModel();m.setData({dimensions:b});return m},validateQueryServiceURI:function(d){d=jQuery.trim(d);if(!jQuery.sap.startsWith(d,"/")){d="/"+d}if(jQuery.sap.endsWith(d,"/")){d=d.substring(0,d.length-1)}return d},handleDimensionSelectionChange:function(e){this.tileConfigurationModel.getData().dimension=e.getSource().getSelectedItem().getKey()},setGenericDrillDown:function(n){return(n==0)?true:false},setOtherDrillDown:function(n){if(n>0){this.getView().byId('selectODD').setVisible(true)}else{this.getView().byId('selectODD').setVisible(false)}return(n>0)?true:false},onAfterContextData:function(c){var t=this;this.evaluationObj=c;if(this.customMeasuresModel&&this.customMeasuresModel.getData()){var a=this.customMeasuresModel.getData();a.Measures.unshift({COLUMN_NAME:this.evaluationObj.COLUMN_NAME});this.customMeasuresModel.setData(a)}if(this.customMeasuresModel1&&this.customMeasuresModel1.getData()){var b=this.customMeasuresModel1.getData();b.Measures.unshift({COLUMN_NAME:this.evaluationObj.COLUMN_NAME});this.customMeasuresModel1.setData(b)}try{this.oModelForEntity=this.populateDimension(c.ODATA_URL,c.ODATA_ENTITYSET);this.tileConfigurationModel.getData().dimension=this.oModelForEntity.getData().dimensions[0].dimensionName;this.initialData=jQuery.extend(true,{},this.tileConfigurationModel.getData(),{})}catch(e){}finally{if(this.oModelForEntity.getData().dimensions.length){this.getView().byId("selectDimension").setModel(this.oModelForEntity,"populateDimension")}else{sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("UNABLE_TO_FETCH_NAVIG"))}}if(this.appMode=="addTile"){t.selectTile('NT');t.getView().byId('NT').$().css("border","solid 2px "+sap.ui.core.theming.Parameters.get("sapUiHighlight"));t.currentLocaleLanguage=t.languagesObject.LAISO[sap.ui.getCore().getConfiguration().getLanguage().split("-")[0].toUpperCase()];var d="/EVALUATIONS_CHIP_TEXTS?$filter=ID eq '"+c.ID+"' and IS_ACTIVE eq 1";t.oApplicationFacade.getODataModel().read(d,null,null,true,function(f){t.evaluationDetails=t.evaluationDetails||{};t.evaluationDetails.TEXTS=[];var o={};for(var i=0,l=f.results.length;i<l;i++){o={};o.language=f.results[i].LANGUAGE;o.title=f.results[i].TITLE;o.description=f.results[i].DESCRIPTION;t.evaluationDetails.TEXTS.push(o)}},function(e){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("YMSG_ERROR_RETRIEVING_DATA"),e.response.body)});this.updateFooterButtons(null);this.tileConfigurationModel.setData({evaluationId:c.ID,title:c.INDICATOR_TITLE,description:c.TITLE,semanticObject:(c.SEMANTIC_OBJECT||''),action:(c.ACTION||''),storyId:'',tileType:'NT',navType:0});this.initialData=jQuery.extend(true,{},this.tileConfigurationModel.getData(),{});this.tempSemanticObject=c.SEMANTIC_OBJECT||"";this.onLoadSemanticObject=this.tempSemanticObject;this.tempAction=c.ACTION||"";var m=new sap.ui.model.json.JSONModel();m.setData({MULTI_MEASURE:[{COLUMN_NAME:t.evaluationObj.COLUMN_NAME,semanticColor:"Error"},{COLUMN_NAME:"",semanticColor:"Critical"},{COLUMN_NAME:"",semanticColor:"Good"}]});this.getView().setModel(m,"multiMeasures")}},onAfterChipContextData:function(c){var t=this;this.currentContextState=c.isActive;this.currentChipId=c.id;this.updateFooterButtons(c);if(this.appMode=="editTile"){var a=JSON.parse(c.configuration);var b=[];if(JSON.parse(a.tileConfiguration).ADDITIONAL_APP_PARAMETERS){b=JSON.parse(JSON.parse(a.tileConfiguration).ADDITIONAL_APP_PARAMETERS)}var e={};var m={MULTI_MEASURE:[]};if(JSON.parse(a.tileConfiguration).EVALUATION){e=JSON.parse(JSON.parse(a.tileConfiguration).EVALUATION);var d=new sap.ui.model.json.JSONModel();if(e.COLUMN_NAMES&&e.COLUMN_NAMES.length){for(var i=0,l=e.COLUMN_NAMES.length;i<l;i++){m.MULTI_MEASURE.push({COLUMN_NAME:e.COLUMN_NAMES[i].COLUMN_NAME,semanticColor:e.COLUMN_NAMES[i].semanticColor})}if(m.MULTI_MEASURE&&m.MULTI_MEASURE.length==2){m.MULTI_MEASURE.push({COLUMN_NAME:"",semanticColor:"Good"})}d.setData(m);this.getView().setModel(d,"multiMeasures")}else{d.setData({MULTI_MEASURE:[{COLUMN_NAME:t.evaluationObj.COLUMN_NAME,semanticColor:"Error"},{COLUMN_NAME:"",semanticColor:"Critical"},{COLUMN_NAME:"",semanticColor:"Good"}]});this.getView().setModel(d,"multiMeasures")}}var f=JSON.parse(JSON.parse(a.tileConfiguration).TILE_PROPERTIES);c.semanticObject=f.semanticObject;t.onLoadSemanticObject=c.semanticObject;c.action=f.semanticAction;this.tempSemanticObject=c.semanticObject||"";this.tempAction=c.action||"";c.navType=f.navType||"0";c.sortOrder=f.sortOrder||undefined;c.dimension=f.dimension||undefined;if(c.navType.toString()=="1"){this.lumiraSemanticObject=c.semanticObject;this.lumiraAction=c.action;this.apfSemanticObject=this.APF_SEMANTIC_OBECT;this.apfAction=this.APF_ACTION}else if(c.navType.toString()=="2"){this.apfSemanticObject=c.semanticObject;this.apfAction=c.action;this.lumiraSemanticObject=this.LUMIRA_SEMANTIC_OBECT;this.lumiraAction=this.LUMIRA_ACTION}else{this.apfSemanticObject=this.APF_SEMANTIC_OBECT;this.apfAction=this.APF_ACTION;this.lumiraSemanticObject=this.LUMIRA_SEMANTIC_OBECT;this.lumiraAction=this.LUMIRA_ACTION}this.byId('selectTileType').setSelectedKey(c.tileType);this.selectTile(c.tileType);if(Number(c.navType)==1){c.storyId=f.storyId}else{c.storyId=""}this.tileConfigurationModel.setData(c);this.initialData=jQuery.extend(true,{},this.tileConfigurationModel.getData(),{});if(Number(c.navType)){this.byId("selectNavType").setSelectedKey(c.navType);this.getSelectedRadioButton(null,"ODD")}else{this.getSelectedRadioButton(null,"GDD")}var p=[];if(b&&Object.keys(b).length){for(var k in b){if(b.hasOwnProperty(k)){p.push({NAME:k,VALUE:b[k]})}}}this.byId("propertyNameValueBox").getModel("appParameters").setData({PROPERTIES:p});this.initialAppParameters=jQuery.extend(true,[],(this.appParametersModel.getData().PROPERTIES||[]))}},addNewProperty:function(){var t=this;if(this.getView().byId("appPropertyName").getValue()){this.getView().byId("appPropertyName").setValueState("None");if(this.getView().byId("appPropertyValue").getValue()){this.getView().byId("appPropertyValue").setValueState("None");var p=this.getView().byId('propertyNameValueBox').getModel("appParameters");p.getData().PROPERTIES=p.getData().PROPERTIES||[];if(this.checkForDuplicateProperty()){p.getData().PROPERTIES.push({NAME:this.getView().byId("appPropertyName").getValue(),VALUE:this.getView().byId("appPropertyValue").getValue()});p.updateBindings();this.getView().byId("appPropertyName").setValue("");this.getView().byId("appPropertyValue").setValue("")}}else{this.getView().byId("appPropertyValue").setValueState("Error");this.getView().byId("appPropertyValue").setValueStateText(this.oApplicationFacade.getResourceBundle().getText("ENTER_PROPERTY_VALUE"));sap.m.MessageToast.show(this.oApplicationFacade.getResourceBundle().getText("ENTER_PROPERTY_VALUE"))}}else{this.getView().byId("appPropertyName").setValueState("Error");this.getView().byId("appPropertyName").setValueStateText(this.oApplicationFacade.getResourceBundle().getText("ENTER_PROPERTY_NAME"));sap.m.MessageToast.show(this.oApplicationFacade.getResourceBundle().getText("ENTER_PROPERTY_NAME"))}},removeProperty:function(e){var p=e.getSource().getBindingContext("appParameters").getPath();e.getSource().getBindingContext("appParameters").getModel().getData().PROPERTIES.splice(p.substring(p.lastIndexOf("/")+1),1);e.getSource().getBindingContext("appParameters").getModel().updateBindings()},getAllFooterButtons:function(){var t=this;var b=[{sI18nBtnTxt:t.oApplicationFacade.getResourceBundle().getText("DELETE_DRAFT"),onBtnPressed:function(e){sap.m.MessageBox.show(t.oApplicationFacade.getResourceBundle().getText("WANT_TO_DELETE_SELECTED_TILE"),"sap-icon://hint",t.oApplicationFacade.getResourceBundle().getText("DELETE"),[sap.m.MessageBox.Action.OK,sap.m.MessageBox.Action.CANCEL],function(e){if(e=="OK"){sap.suite.smartbusiness.utils.remove(sap.suite.smartbusiness.utils.serviceUrl("CHIP_SERVICE_URI"),{id:t.currentChipId,isActive:t.currentContextState},function(d){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("DELETION_SUCCESSFUL"));t.oApplicationFacade.getODataModel().refresh();sap.suite.smartbusiness.utils.replaceHash({action:"configureSBKPITile",route:"detail",context:t.context.sPath.substr(1)})},function(a){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("DELETION_FAILED"),a.response.body)})}if(e=="CANCEL"){}})},},{sI18nBtnTxt:t.oApplicationFacade.getResourceBundle().getText("SAVE")+' and '+t.oApplicationFacade.getResourceBundle().getText("ACTIVATE"),onBtnPressed:function(e){var d=t.tileConfigurationModel.getData();var a="";var c=null;if((!(d.semanticObject)&&Number(d.navType)!=0)||((d.semanticObject.length==(d.semanticObject.split(" ").length-1))&&Number(d.navType)!=0)||(!(d.action)&&Number(d.navType)!=0)||((d.action.length==(d.action.split(" ").length-1))&&Number(d.navType)!=0)||!(d.title)||!(d.description)||(!(d.storyId)&&Number(d.navType)==1)||((d.storyId.length==(d.storyId.split(" ").length-1))&&Number(d.navType)==1)||(d.title.length==(d.title.split(" ").length-1))||(d.description.length==(d.description.split(" ").length-1))){if(((!(d.semanticObject)||(d.semanticObject.length==(d.semanticObject.split(" ").length-1)))&&(Number(d.navType)!=0))){a+=t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_SEMANTIC_OBJECT")+"\n";t.byId("semanticObjectText").setValueState("Error");t.byId("semanticObjectText").setValueStateText(t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_SEMANTIC_OBJECT"))}if(((!(d.action)||(d.action.length==(d.action.split(" ").length-1)))&&(Number(d.navType)!=0))){a+=t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_SEMANTIC_ACTION")+"\n";t.byId("selectODD").setValueState("Error");t.byId("selectODD").setValueStateText(t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_SEMANTIC_ACTION"))}if(((!(d.storyId)||(d.storyId.length==(d.storyId.split(" ").length-1)))&&(Number(d.navType)==1))){a+=t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_STORY_ID")+"\n";t.byId("selectStoryId").setValueState("Error");t.byId("selectStoryId").setValueStateText(t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_STORY_ID"))}if(!(d.title)||(d.title.length==(d.title.split(" ").length-1))){a+=t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_TITLE")+"\n";t.byId("tileTitle").setValueState("Error");t.byId("tileTitle").setValueStateText(t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_TITLE"))}if(!(d.description)||(d.description.length==(d.description.split(" ").length-1))){a+=t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_DESCRIPTION");t.byId("tileSubtitle").setValueState("Error");t.byId("tileSubtitle").setValueStateText(t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_DESCRIPTION"))}sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ACTIVATION_ERROR"),a)}else{c=t.formChipConfiguration();if(d.tileType=="CM"){var f=JSON.parse(JSON.parse(JSON.parse(c.configuration).tileConfiguration).EVALUATION);if(!(t.evaluationCustomMeasureArray)||!(t.evaluationCustomMeasureArray.length)){a+=t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_THREE_MEASURES")}else{for(var i=0,l=2;i<l;i++){if(!(t.evaluationCustomMeasureArray[i].COLUMN_NAME)||!(t.evaluationCustomMeasureArray[i].semanticColor)){a+=t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_THREE_MEASURES");break}}if((!a)&&(t.evaluationCustomMeasureArray.length==3)){if(t.evaluationCustomMeasureArray[2].COLUMN_NAME&&t.evaluationCustomMeasureArray[2].semanticColor){if(f.COLUMN_NAMES[0].COLUMN_NAME==f.COLUMN_NAMES[1].COLUMN_NAME){a+=t.oApplicationFacade.getResourceBundle().getText("ERROR_DUPLICATE_MEASURE_THREE_MEASURES")}else if(t.evaluationCustomMeasureArray[0].COLUMN_NAME==t.evaluationCustomMeasureArray[2].COLUMN_NAME){a+=t.oApplicationFacade.getResourceBundle().getText("ERROR_DUPLICATE_MEASURE_THREE_MEASURES")}else if(t.evaluationCustomMeasureArray[1].COLUMN_NAME==t.evaluationCustomMeasureArray[2].COLUMN_NAME){a+=t.oApplicationFacade.getResourceBundle().getText("ERROR_DUPLICATE_MEASURE_THREE_MEASURES")}}else{t.evaluationCustomMeasureArray.pop();if(t.evaluationCustomMeasureArray[0].COLUMN_NAME==t.evaluationCustomMeasureArray[1].COLUMN_NAME){a+=t.oApplicationFacade.getResourceBundle().getText("ERROR_DUPLICATE_MEASURE_THREE_MEASURES")}}}}}if(a){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ACTIVATION_ERROR"),a)}else{var s=t.publishChip(c);if(s){sap.suite.smartbusiness.utils.create(sap.suite.smartbusiness.utils.serviceUrl("ACTIVATE_CHIP_SERVICE_URI"),{id:t.currentChipId},null,function(d){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("ACTIVATION_SUCCESSFUL"));t.oApplicationFacade.getODataModel().refresh();sap.suite.smartbusiness.utils.replaceHash({action:"configureSBKPITile",route:"detail",context:t.context.sPath.substr(1)})},function(g){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ACTIVATION_ERROR"),g.responseText)})}}}},},{sI18nBtnTxt:"CONFIG_DRILLDOWN",onBtnPressed:function(e){sap.suite.smartbusiness.utils.appToAppNavigation({action:"configureSBKPIDrilldown",route:"detail",context:("EVALUATIONS_DDA('"+t.getView().getBindingContext().getProperty("ID")+"')")})}},{sI18nBtnTxt:"SAVE_CREATE_NEW",onBtnPressed:function(e){var c=t.formChipConfiguration();var s=t.publishChip(c);if(s){if(t.appMode=="addTile"){var h=hasher||window.hasher;var a=hasher.getHash();sap.suite.smartbusiness.utils.appToAppNavigation({action:"configureSBKPITile"});setTimeout(function(){sap.suite.smartbusiness.utils.hashChange({hash:a})},0)}else{sap.suite.smartbusiness.utils.replaceHash({action:"configureSBKPITile",route:"addTile",context:t.context.sPath.substr(1)})}}}},{sI18nBtnTxt:"CANCEL",onBtnPressed:function(e){t.handleBackAndCancel()}}];return b},updateFooterButtons:function(c){var b=this.getAllFooterButtons();this.oHeaderFooterOptions.buttonList=[];if(c){if((!(c.isActive))&&(this.appMode=="editTile")){this.oHeaderFooterOptions.buttonList.push(b[0])}}for(var i=1,l=b.length;i<l;i++){if(i==2){if(c&&(c.isActive==1)){this.oHeaderFooterOptions.buttonList.push(b[i])}}else{this.oHeaderFooterOptions.buttonList.push(b[i])}}this.setHeaderFooterOptions(this.oHeaderFooterOptions)},checkForDuplicateProperty:function(){var t=this;var p=this.getView().byId('propertyNameValueBox').getModel("appParameters").getData().PROPERTIES;var a=this.getView().byId("appPropertyName").getValue();var v=this.getView().byId("appPropertyValue").getValue();if(!isNaN(Number(a))){this.getView().byId("appPropertyName").setValueState("Error");this.getView().byId("appPropertyName").setValueStateText(t.oApplicationFacade.getResourceBundle().getText("ERROR_PROPERTY_NOT_STRING"));sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("ERROR_PROPERTY_NOT_STRING"));return false}for(var i=0,l=p.length;i<l;i++){if((p[i].NAME==a)){if(p[i].NAME==a){this.getView().byId("appPropertyName").setValueState("Error");this.getView().byId("appPropertyName").setValueStateText(t.oApplicationFacade.getResourceBundle().getText("ERROR_MULTIPLE_VALUES_FOR_PROPERTY"));sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("ERROR_MULTIPLE_VALUES_FOR_PROPERTY"))}return false}}return true},inputNameChange:function(e){var t=this;var p=e.getSource().getValue();var a=Number(e.getSource().getBindingContext("appParameters").sPath[e.getSource().getBindingContext("appParameters").sPath.length-1]);var b=this.getView().byId('propertyNameValueBox').getModel("appParameters").getData().PROPERTIES;for(var i=0,l=b.length;i<l;i++){if(i==a){continue}if(b[i].NAME==p){e.getSource().setValueState("Error");e.getSource().setValueStateText(t.oApplicationFacade.getResourceBundle().getText("ERROR_MULTIPLE_VALUES_FOR_PROPERTY"));sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("ERROR_MULTIPLE_VALUES_FOR_PROPERTY"));return}}e.getSource().setValueState("None")},inputValueChange:function(e){var t=this;var v=e.getSource().getValue();var p=e.getSource().getBindingContext("appParameters").getObject().NAME;var a=Number(e.getSource().getBindingContext("appParameters").sPath[e.getSource().getBindingContext("appParameters").sPath.length-1]);var b=this.getView().byId('propertyNameValueBox').getModel("appParameters").getData().PROPERTIES;for(var i=0,l=b.length;i<l;i++){if(i==a){continue}if(b[i].NAME==p&&b[i].VALUE==v){e.getSource().setValueState("Error");e.getSource().setValueStateText(t.oApplicationFacade.getResourceBundle().getText("ERROR_DUPLICATE_PROPERTY_VALUE"));sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("ERROR_DUPLICATE_PROPERTY_VALUE"))}}},onAfterRendering:function(){var t=this;if(this.appMode=="addTile"){this.getView().byId('NT').$().css("border","solid 2px "+sap.ui.core.theming.Parameters.get("sapUiHighlight"))}this.initialData=jQuery.extend(true,{},this.tileConfigurationModel.getData(),{})},handleSemanticObjectChange:function(e){if(e.getSource().getValue()){e.getSource().setValueState("None")}this.tempSemanticObject=e.getSource().getValue();if(this.tileConfigurationModel.getData().navType.toString()=="2"){this.apfSemanticObject=e.getSource().getValue()}if(this.tileConfigurationModel.getData().navType.toString()=="1"){this.lumiraSemanticObject=e.getSource().getValue()}if(this.tileConfigurationModel.getData().navType.toString()=="0"||this.tileConfigurationModel.getData().navType.toString()=="4"){this.onLoadSemanticObject=e.getSource().getValue()}},setSemanticAction:function(e){if(e.getSource().getValue()){e.getSource().setValueState("None")}this.tempAction=e.getSource().getValue();if(this.tileConfigurationModel.getData().navType.toString()=="2"){this.apfAction=e.getSource().getValue()}if(this.tileConfigurationModel.getData().navType.toString()=="1"){this.lumiraAction=e.getSource().getValue()}},subTitleChange:function(e){if(e.getSource().getValue()){e.getSource().setValueState("None")}},titleChange:function(e){if(e.getSource().getValue()){e.getSource().setValueState("None")}},appPropertyNameChange:function(e){if(e.getSource().getValue()){e.getSource().setValueState("None")}},appPropertyValueChange:function(e){if(e.getSource().getValue()){e.getSource().setValueState("None")}},setStoryId:function(e){if(e.getSource().getValue()){e.getSource().setValueState("None")}},handleStoryIdValueHelp:function(){var t=this;var s=new sap.m.SelectDialog({title:t.oApplicationFacade.getResourceBundle().getText("STORY_ID"),noDataText:t.oApplicationFacade.getResourceBundle().getText("NO_DATA_FOUND"),items:{path:"/Stories",template:new sap.m.StandardListItem({title:"{NAME}",description:"{UUID}"})},confirm:function(e){t.tileConfigurationModel.getData().storyId=e.getParameter("selectedItem").getProperty("description");t.byId("selectStoryId").setValue(t.tileConfigurationModel.getData().storyId)},liveChange:function(e){var a="'"+e.getParameter("value").toLowerCase()+"'";var f=new sap.ui.model.Filter("tolower(NAME)",sap.ui.model.FilterOperator.Contains,a);var F=new sap.ui.model.Filter("tolower(UUID)",sap.ui.model.FilterOperator.Contains,a);var b=e.getSource().getBinding("items");b.filter(new sap.ui.model.Filter([f,F],false))}});s.open();var d=new sap.ui.model.odata.ODataModel("/sap/bi/launchpad/integration/smb.xsodata",true);s.setModel(d);if(this.evaluationObj.VIEW_NAME){s.getBinding("items").filter([new sap.ui.model.Filter("VIEW_NAME","EQ",this.evaluationObj.VIEW_NAME)])}},handleCustomMeasure:function(e){var t=this;var c=e.getSource();this.customMeasuresDialog=new sap.m.SelectDialog({title:t.oApplicationFacade.getResourceBundle().getText("CHOOSE_ADDL_MEASURE"),noDataText:t.oApplicationFacade.getResourceBundle().getText("NO_DATA_FOUND"),items:{path:"additionalMeasures>/Measures",template:new sap.m.StandardListItem({title:"{additionalMeasures>COLUMN_NAME}"})},confirm:function(E){var v=E.getParameter("selectedItem").getProperty("title");c.setValue(v)},liveChange:function(E){var s="'"+E.getParameter("value").toLowerCase()+"'";var f=new sap.ui.model.Filter("tolower(COLUMN_NAME)",sap.ui.model.FilterOperator.Contains,s);var b=E.getSource().getBinding("items");b.filter(new sap.ui.model.Filter([f],false))}});this.customMeasuresDialog.open();this.customMeasuresDialog.setModel(this.customMeasuresModel,"additionalMeasures")},handleCustomMeasure1:function(e){var t=this;var c=e.getSource();this.customMeasuresDialog1=new sap.m.SelectDialog({title:t.oApplicationFacade.getResourceBundle().getText("CHOOSE_ADDL_MEASURE"),noDataText:t.oApplicationFacade.getResourceBundle().getText("NO_DATA_FOUND"),items:{path:"additionalMeasures1>/Measures",template:new sap.m.StandardListItem({title:"{additionalMeasures1>COLUMN_NAME}"})},confirm:function(E){var v=E.getParameter("selectedItem").getProperty("title");c.setValue(v)},liveChange:function(E){var s="'"+E.getParameter("value").toLowerCase()+"'";var f=new sap.ui.model.Filter("tolower(COLUMN_NAME)",sap.ui.model.FilterOperator.Contains,s);var b=E.getSource().getBinding("items");b.filter(new sap.ui.model.Filter([f],false))}});this.customMeasuresDialog1.open();var m=this.customMeasuresModel1.getData();if(m.Measures[0].COLUMN_NAME!==""){m.Measures.unshift({COLUMN_NAME:""})}this.customMeasuresModel1.setData(m);this.customMeasuresDialog1.setModel(this.customMeasuresModel1,"additionalMeasures1")},addAdditionalLanguageDialog:function(){var t=this;this.additionalLanguageListModel=new sap.ui.model.json.JSONModel();this.additionalLanguageListModelData=$.extend(true,{},this.additionalLanguageLinkModel.getData());this.additionalLanguageListModel.setData(t.additionalLanguageListModelData);this.languageTextInput=new sap.m.Input({layoutData:new sap.ui.layout.GridData({span:"L8 M8 S8"})});this.languageDescriptionInput=new sap.m.Input({layoutData:new sap.ui.layout.GridData({span:"L8 M8 S8"})});this.languageKeySelect=new sap.m.Select({layoutData:new sap.ui.layout.GridData({span:"L6 M6 S6"})});this.addedLanguagesList=new sap.m.List({layoutData:new sap.ui.layout.GridData({span:"L5 M5 S5"}),}).setModel(t.additionalLanguageListModel,"additionalLanguageListModel");this.addedLanguagesList.bindItems("additionalLanguageListModel>/ADDITIONAL_LANGUAGE_ARRAY",new sap.m.CustomListItem({content:new sap.ui.layout.Grid({hSpacing:1,vSpacing:0,defaultSpan:"L12 M12 S12",content:[new sap.m.Input({value:"{additionalLanguageListModel>ADDITIONAL_LANGUAGE_TITLE}",design:"Bold",layoutData:new sap.ui.layout.GridData({span:"L12 M12 S12",vAlign:"Middle"}),editable:false}),new sap.m.Input({value:"{additionalLanguageListModel>ADDITIONAL_LANGUAGE_DESCRIPTION}",design:"Bold",layoutData:new sap.ui.layout.GridData({span:"L6 M6 S6",vAlign:"Middle"}),editable:false}),new sap.m.Input({value:"{additionalLanguageListModel>ADDITIONAL_LANGUAGE_KEY}",design:"Bold",layoutData:new sap.ui.layout.GridData({span:"L4 M4 S4"}),editable:false}),new sap.m.Button({icon:"sap-icon://sys-cancel",type:"Transparent",press:function(e){var b=e.getSource().getBindingContext("additionalLanguageListModel").getPath().substr(1);var n=t.addedLanguagesList.getModel("additionalLanguageListModel").getData().ADDITIONAL_LANGUAGE_ARRAY.splice(b,1);t.addedLanguagesList.getModel("additionalLanguageListModel").getData().NO_OF_ADDITIONAL_LANGUAGES=t.addedLanguagesList.getModel("additionalLanguageListModel").getData().ADDITIONAL_LANGUAGE_ARRAY.length;t.addedLanguagesList.getModel("additionalLanguageListModel").updateBindings()},layoutData:new sap.ui.layout.GridData({span:"L2 M2 S2"})})]})}));var a=new sap.m.Dialog({contentHeight:"50%",contentWidth:"25%",title:t.oApplicationFacade.getResourceBundle().getText("ADDITIONAL_LANGUAGE"),content:[new sap.ui.layout.Grid({hSpacing:1,vSpacing:4,defaultSpan:"L12 M12 S12",content:[new sap.ui.layout.form.SimpleForm({editable:true,layout:"ResponsiveGridLayout",content:[new sap.m.Label({text:t.oApplicationFacade.getResourceBundle().getText("TITLE"),textAlign:"Right",layoutData:new sap.ui.layout.GridData({span:"L3 M3 S3",})}),t.languageTextInput,new sap.m.Label({text:t.oApplicationFacade.getResourceBundle().getText("SUB_TITLE"),layoutData:new sap.ui.layout.GridData({span:"L3 M3 S3",})}),t.languageDescriptionInput,new sap.m.Label({text:t.oApplicationFacade.getResourceBundle().getText("LANGUAGE")+":",layoutData:new sap.ui.layout.GridData({span:"L3 M3 S3"})}),t.languageKeySelect,new sap.m.Button({icon:"sap-icon://add",layoutData:new sap.ui.layout.GridData({span:"L2 M2 S2"}),press:function(){if(t.languageTextInput.getValue()||t.languageDescriptionInput.getValue()){for(var i=0;i<t.addedLanguagesList.getModel("additionalLanguageListModel").getData().ADDITIONAL_LANGUAGE_ARRAY.length;i++){if(t.addedLanguagesList.getModel("additionalLanguageListModel").getData().ADDITIONAL_LANGUAGE_ARRAY[i].ADDITIONAL_LANGUAGE_KEY===t.languageKeySelect.getSelectedItem().getText()){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ERROR_LANGUAGE_EXISTS",t.languageKeySelect.getSelectedItem().getText()));return}}var b={"ADDITIONAL_LANGUAGE_TITLE":t.languageTextInput.getValue(),"ADDITIONAL_LANGUAGE_DESCRIPTION":t.languageDescriptionInput.getValue(),"ADDITIONAL_LANGUAGE_KEY":t.languageKeySelect.getSelectedItem().getText(),"ADDITIONAL_SAP_LANGUAGE_KEY":t.languageKeySelect.getSelectedKey()};t.addedLanguagesList.getModel("additionalLanguageListModel").getData().ADDITIONAL_LANGUAGE_ARRAY.push(b);t.addedLanguagesList.getModel("additionalLanguageListModel").getData().NO_OF_ADDITIONAL_LANGUAGES=t.addedLanguagesList.getModel("additionalLanguageListModel").getData().ADDITIONAL_LANGUAGE_ARRAY.length;t.addedLanguagesList.getModel("additionalLanguageListModel").updateBindings();t.languageTextInput.setValue("");t.languageDescriptionInput.setValue("")}}})]})]}).addStyleClass("languageGrid"),t.addedLanguagesList],beginButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("OK"),press:function(){t.additionalLanguageLinkModel.setData(t.additionalLanguageListModel.getData());t.additionalLanguageLinkModel.updateBindings();a.close()}}),endButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("CANCEL"),press:function(){a.close()}})});var d=this.languagesArray;for(var i=0;i<d.length;i++){if((d[i].LAISO).toUpperCase()==(sap.ui.getCore().getConfiguration().getLocale().getLanguage()).toUpperCase()){d.splice(i,1)}}var m=new sap.ui.model.json.JSONModel();m.setData(d);t.languageKeySelect.setModel(m,"otherLanguageKey");t.languageKeySelect.bindItems("otherLanguageKey>/",new sap.ui.core.Item({text:"{otherLanguageKey>LAISO}",key:"{otherLanguageKey>SPRAS}"}));a.open()},handleBackAndCancel:function(){var t=this;var o={};o.oldPayload=t.initialData;o.newPayload=t.tileConfigurationModel.getData();o.objectType="Chips";o=sap.suite.smartbusiness.utils.dirtyBitCheck(o);t.chipTextPayload=[];if(t.additionalLanguageLinkModel.getData().NO_OF_ADDITIONAL_LANGUAGES){for(var i=0;i<t.additionalLanguageLinkModel.getData().NO_OF_ADDITIONAL_LANGUAGES;i++){var c={};c.title=t.additionalLanguageLinkModel.getData().ADDITIONAL_LANGUAGE_ARRAY[i].ADDITIONAL_LANGUAGE_TITLE;c.description=t.additionalLanguageLinkModel.getData().ADDITIONAL_LANGUAGE_ARRAY[i].ADDITIONAL_LANGUAGE_DESCRIPTION;c.language=t.additionalLanguageLinkModel.getData().ADDITIONAL_LANGUAGE_ARRAY[i].ADDITIONAL_SAP_LANGUAGE_KEY;t.chipTextPayload.push(c)}}t.languagePayloadForDirtyBitTest=[];for(var i=0;i<t.oldLanguagePayload.length;i++){var a={};a.language=t.oldLanguagePayload[i].language;a.description=t.oldLanguagePayload[i].description;a.title=t.oldLanguagePayload[i].title;t.languagePayloadForDirtyBitTest.push(a)}var l=sap.suite.smartbusiness.utils.dirtyBitCheck({oldPayload:t.languagePayloadForDirtyBitTest,newPayload:t.chipTextPayload,objectType:"CHIP_TEXTS"});var b=sap.suite.smartbusiness.utils.dirtyBitCheck({oldPayload:t.initialAppParameters,newPayload:t.appParametersModel.getData().PROPERTIES||[],objectType:"APP_PARAMETERS"});if(o.updates.length||l.deletes.length||l.updates.length||b.deletes.length||b.updates.length){var d=new sap.m.Dialog({icon:"sap-icon://warning2",title:t.oApplicationFacade.getResourceBundle().getText("WARNING"),state:"Error",type:"Message",content:[new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText("ON_BACK_WARNING")})],beginButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("CONTINUE"),press:function(){sap.suite.smartbusiness.utils.replaceHash({action:"configureSBKPITile",route:"detail",context:t.context.sPath.substr(1)})}}),endButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("CANCEL"),press:function(){d.close()}})});d.open()}else{sap.suite.smartbusiness.utils.replaceHash({action:"configureSBKPITile",route:"detail",context:t.context.sPath.substr(1)})}}})};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.workspace.Configuration')){jQuery.sap.declare("sap.suite.ui.smartbusiness.designtime.workspace.Configuration");jQuery.sap.require('sap.ca.scfld.md.ConfigurationBase');jQuery.sap.require('sap.ca.scfld.md.app.Application');sap.ca.scfld.md.ConfigurationBase.extend("sap.suite.ui.smartbusiness.designtime.workspace.Configuration",{oServiceParams:{serviceList:[{name:"SMART_BUSINESS",masterCollection:"INDICATORS_MODELER",serviceUrl:"/sap/hba/r/sb/core/odata/modeler/SMART_BUSINESS.xsodata/",isDefault:true,mockedDataSource:"",useBatch:false}]},getServiceList:function(){return this.getServiceParams().serviceList},getMasterKeyAttributes:function(){return["Id"]},getExcludedQueryStringParameters:function(){return["sap-client","sap-language"]},getHanaSystem:function(){var h=hasher||window.hasher;var a=h.getHashAsArray();if(a&&a.length&&a[0]){var b=a[0].substr(a[0].indexOf("?")+1).split("&");for(var i=0,l=b.length;i<l;i++){if(b[i]&&(b[i].indexOf("sap-system")!=-1)){return b[i].split("=")[1]}}}return""},getServiceParams:function(){if(sap.ushell&&sap.ushell.Container){var s=this.oServiceParams.serviceList[0].serviceUrl;this.oServiceParams.serviceList[0].serviceUrl=sap.ushell.Container.getService("URLParsing").addSystemToServiceUrl(s,this.getHanaSystem())}return this.oServiceParams},})};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.workspace.view.S2.controller')){jQuery.sap.declare('sap.suite.ui.smartbusiness.designtime.workspace.view.S2.controller');jQuery.sap.require('sap.ca.scfld.md.controller.ScfldMasterController');sap.ca.scfld.md.controller.ScfldMasterController.extend("sap.suite.ui.smartbusiness.designtime.workspace.view.S2",{onInit:function(){var t=this;t.oApplicationFacade.getODataModel().setSizeLimit(100000);if(!(t.oApplicationFacade.currentLogonHanaUser)){this.oApplicationFacade.getODataModel().read("/SESSION_USER",null,null,true,function(d){t.oApplicationFacade.currentLogonHanaUser=(d.results&&d.results.length)?d.results[0].LOGON_USER:null},function(a){t.oApplicationFacade.currentLogonHanaUser=null;sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("YMSG_ERROR_RETRIEVING_DATA"),a.response.body)})}this.defaultHeaderFooterOptions={sI18NMasterTitle:"MASTER_TITLE",sI18NSearchFieldPlaceholder:"SEARCHFIELD_PLACEHOLDER",onBack:function(){window.history.back()},onEditPress:function(i){t.toggleListSelection(i)},oFilterOptions:{onFilterPressed:function(a){t.getView().filterOptionDialog=t.getView().filterOptionDialog||t.createFilterOptions();t.getView().filterOptionDialog.open()}},oSortOptions:{onSortPressed:function(a){t.getView().sortOptionDialog=t.getView().sortOptionDialog||t.createSortOptions();t.getView().sortOptionDialog.open()}},oGroupOptions:{onGroupPressed:function(a){t.getView().groupOptionDialog=t.getView().groupOptionDialog||t.createGroupOptions();t.getView().groupOptionDialog.open()}},onAddPress:function(a){sap.suite.smartbusiness=sap.suite.smartbusiness||{};sap.suite.smartbusiness.modelerAppCache=sap.suite.smartbusiness.modelerAppCache||{};sap.suite.smartbusiness.modelerAppCache.createSBKPI=sap.suite.smartbusiness.modelerAppCache.createSBKPI||{};sap.suite.smartbusiness.modelerAppCache.createSBKPI.appFromWorkspace=true;sap.suite.smartbusiness.utils.appToAppNavigation({action:"createSBKPI"})}};this.multiSelectHeaderFooterOptions={bSuppressBookmarkButton:{},onBack:function(){sap.suite.smartbusiness.utils.appToAppNavigation({})},onEditPress:function(i){t.toggleListSelection(i)},buttonList:[{sId:"favouriteButton",sI18nBtnTxt:"FAVOURITE_BUTTON_TEXT",onBtnPressed:function(a){if(t.byId("list").getSelectedContexts().length){var s=t.byId("list").getSelectedContexts();var p={};var b=[];var c=null;var d=true;var D=t.oApplicationFacade.getODataModel();var f=[];for(var i=0,l=s.length;i<l;i++){if(!(s[i].getProperty("MANUAL_ENTRY"))){f.push({ID:s[i].getProperty("ID"),TYPE:s[i].getProperty("ENTITY_TYPE"),USER_ID:t.oApplicationFacade.currentLogonHanaUser,MANUAL_ENTRY:1,LAST_WORKED_ON:null})}}if(f.length){sap.suite.smartbusiness.utils.update(sap.suite.smartbusiness.utils.serviceUrl("INDICATOR_FAVOURITE_SERVICE_URI"),f,null,function(g){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("FAVOURITE_IN_SUCCESS_KPI_OPI"));D.refresh()},function(g){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("FAVOURITE_KPI_OPI_ERROR"))})}else{}}else{sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("NO_KPI_OPI_SELECTED"))}}},{sId:"removeFavouriteButton",sI18nBtnTxt:"REMOVE_FAV_BUTTON_TEXT",onBtnPressed:function(a){if(t.byId("list").getSelectedContexts().length){var s=t.byId("list").getSelectedContexts();var b=[];var p=null;var c=true;var d=t.oApplicationFacade.getODataModel();var f=[];for(var i=0,l=s.length;i<l;i++){if(s[i].getProperty("MANUAL_ENTRY")){f.push({ID:s[i].getProperty("ID"),TYPE:s[i].getProperty("ENTITY_TYPE"),USER_ID:t.oApplicationFacade.currentLogonHanaUser,MANUAL_ENTRY:1,LAST_WORKED_ON:null})}}if(f.length){sap.suite.smartbusiness.utils.remove(sap.suite.smartbusiness.utils.serviceUrl("INDICATOR_FAVOURITE_SERVICE_URI"),f,function(g){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("REM_FAVOURITE_BATCH_SAVE_SUCCESS_KPI_OPI"));d.refresh()},function(g){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("FAVOURITE_BATCH_SAVE_ERROR_KPI_OPI"))})}else{}}else{sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("NO_KPI_OPI_SELECTED"))}}},{sId:"deleteButton",sI18nBtnTxt:"DELETE_BUTTON_TEXT",onBtnPressed:function(a){if(t.byId("list").getSelectedContexts().length){sap.m.MessageBox.show(t.oApplicationFacade.getResourceBundle().getText("WARNING_INDICATOR_DELETE_KPI_OPI"),"sap-icon://hint",t.oApplicationFacade.getResourceBundle().getText("INDICATOR_DELETE_ALERT_TITLE"),[sap.m.MessageBox.Action.OK,sap.m.MessageBox.Action.CANCEL],function(a){if(a=="OK"){var s=t.byId("list").getSelectedContexts();var p={};var b=[];var c=true;var d=t.oApplicationFacade.getODataModel();var f=[];for(var i=0,l=s.length;i<l;i++){f.push({ID:s[i].getProperty("ID"),IS_ACTIVE:s[i].getProperty("IS_ACTIVE")})}if(f.length){sap.suite.smartbusiness.utils.remove(sap.suite.smartbusiness.utils.serviceUrl("INDICATOR_SERVICE_URI"),f,function(g){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("DELETE_BATCH_SAVE_SUCCESS_KPI_OPI"));d.refresh()},function(g){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("DELETE_BATCH_SAVE_ERROR_KPI_OPI"))})}else{}}if(a=="CANCEL"){}})}else{sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("NO_KPI_OPI_SELECTED"))}}}]};if(jQuery.sap.getUriParameters().get("sap-sb-enable-export")=="true"){var e={sI18nBtnTxt:"EXPORT_INDICATORS_KPI_OPI",onBtnPressed:function(a){if(t.byId("list").getSelectedContexts().length){t.exportIndicators()}else{sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("NO_KPI_OPI_SELECTED"))}}};this.multiSelectHeaderFooterOptions.buttonList.unshift(e)}this.currentHeaderFooterOptions=this.defaultHeaderFooterOptions},createFilterOptions:function(){var t=this;var f=new sap.m.ViewSettingsDialog({id:this.createId("filterOptionsDialog"),filterItems:[new sap.m.ViewSettingsFilterItem({text:t.oApplicationFacade.getResourceBundle().getText("BY_STATUS"),key:"status",items:[new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("DRAFTS"),key:"drafts"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("ACTIVATED"),key:"activated"}),]}),new sap.m.ViewSettingsFilterItem({text:t.oApplicationFacade.getResourceBundle().getText("ACTIVITY"),key:"activity",items:[new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("SELF_CREATED"),key:"self_created"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("RECENTLY_WORKED_UPON"),key:"recently_worked_upon"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("FAVOURITE"),key:"favorite"}),]})],confirm:function(e){var a="";var s=e.getParameter("filterItems");t.setFiltering(e.getParameter("filterItems"));if(s&&s.length){var b={};for(var i=0,l=s.length;i<l;i++){b[s[i].getParent().getKey()]=b[s[i].getParent().getKey()]||"";b[s[i].getParent().getKey()]+=(b[s[i].getParent().getKey()])?(","):"";b[s[i].getParent().getKey()]+=s[i].getText()}for(var c in b){if(b.hasOwnProperty(c)){a+=(a)?" ; ":"";a+=b[c]}}t.byId("filterToolbar").setVisible(true);t.byId("workspaceInfo").setText(a)}else{t.byId("workspaceInfo").setText("");t.byId("filterToolbar").setVisible(false)}}});return f},createSortOptions:function(){var t=this;var s=new sap.m.ViewSettingsDialog({id:this.createId("sortOptionsDialog"),sortItems:[new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("BY_NEWEST"),key:"newest"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("BY_OLDEST"),key:"oldest"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("BY_TYPE"),key:"type"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("ALPHABETICALLY"),key:"alphabetically"})],confirm:function(e){if(e.getParameter("sortItem")){t.setSorting(e.getParameter("sortItem").getKey(),e.getParameter("sortDescending"))}else{t.setGrouping("workspace",true)}}});return s},createGroupOptions:function(){var t=this;var g=new sap.m.ViewSettingsDialog({id:this.createId("groupOptionsDialog"),groupItems:[new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("BY_WORKSPACE"),key:"workspace"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("BY_TYPE"),key:"type"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("BY_STATUS"),key:"status"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("BY_OWNER"),key:"owner"})],confirm:function(e){if(e.getParameter("groupItem")){t.setGrouping(e.getParameter("groupItem").getKey(),e.getParameter("groupDescending"))}else{t.setGrouping("none")}}});g.setSelectedGroupItem("workspace");g.setGroupDescending(true);return g},getHeaderFooterOptions:function(){var t=this;return this.currentHeaderFooterOptions},formatTitle:function(t){return(t||"")},formatEvaluationCount:function(e){return(e||0)},formatID:function(i){var t=this;return(t.oApplicationFacade.getResourceBundle().getText("KPI_MASTER_ID_TEXT")+": "+(i||""))},formatGroupName:function(c){var t=this;var i=c.getProperty("MANUAL_ENTRY");var g="";switch(i){case 1:g=t.oApplicationFacade.getResourceBundle().getText("MY_FAVOURITES");break;case 0:g=t.oApplicationFacade.getResourceBundle().getText("MY_LAST_WORKED_UPON");break;default:g=t.oApplicationFacade.getResourceBundle().getText("ALL_KPI_OPI")}return{key:g,text:g}},setGrouping:function(k,g){var t=this;g=g||false;var l=t.getView().byId("list");if(k=="type"){l.getBinding("items").sort([new sap.ui.model.Sorter("TYPE",g,function(c){return{key:c.getProperty("TYPE"),text:(c.getProperty("TYPE")+"S")}})])}else if(k=="status"){l.getBinding("items").sort([new sap.ui.model.Sorter("IS_ACTIVE",g,function(c){return{key:c.getProperty("IS_ACTIVE")?t.oApplicationFacade.getResourceBundle().getText("STATUS_ACTIVE"):t.oApplicationFacade.getResourceBundle().getText("STATUS_DRAFT"),text:c.getProperty("IS_ACTIVE")?t.oApplicationFacade.getResourceBundle().getText("ACTIVE_KPI_OPI"):t.oApplicationFacade.getResourceBundle().getText("DRAFT_KPI_OPI"),}})])}else if(k=="owner"){l.getBinding("items").sort([new sap.ui.model.Sorter("OWNER_NAME",g,function(c){var o=c.getProperty("OWNER_NAME");var a="";switch(o){case null:a=t.oApplicationFacade.getResourceBundle().getText("NO_OWNER");break;case"":a=t.oApplicationFacade.getResourceBundle().getText("NO_OWNER");break;default:a=o}return{key:a,text:a}})])}else if(k=="workspace"){l.getBinding("items").sort([new sap.ui.model.Sorter("MANUAL_ENTRY",g,function(c){var i=c.getProperty("MANUAL_ENTRY");var a="";switch(i){case 1:a=t.oApplicationFacade.getResourceBundle().getText("MY_FAVOURITES");break;case 0:a=t.oApplicationFacade.getResourceBundle().getText("MY_LAST_WORKED_UPON");break;default:a=t.oApplicationFacade.getResourceBundle().getText("ALL_KPI_OPI")}return{key:a,text:a}})])}else if(k=="none"){l.getBinding("items").sort([])}},setFiltering:function(i){var t=this;var f=[];var l=t.getView().byId("list");var a={"drafts":(new sap.ui.model.Filter("IS_ACTIVE",sap.ui.model.FilterOperator.EQ,0)),"activated":(new sap.ui.model.Filter("IS_ACTIVE",sap.ui.model.FilterOperator.EQ,1)),"self_created":(new sap.ui.model.Filter("CREATED_BY",sap.ui.model.FilterOperator.EQ,t.oApplicationFacade.currentLogonHanaUser)),"recently_worked_upon":(new sap.ui.model.Filter("MANUAL_ENTRY",sap.ui.model.FilterOperator.EQ,0)),"favorite":(new sap.ui.model.Filter("MANUAL_ENTRY",sap.ui.model.FilterOperator.EQ,1))};f=sap.suite.smartbusiness.utils.getFilterArray(i,a);if(f.length){l.getBinding("items").filter(new sap.ui.model.Filter(f,true))}else{l.getBinding("items").filter(f)}},setSorting:function(k,g){var t=this;g=g||false;var l=t.getView().byId("list");if(k=="newest"){l.getBinding("items").sort([new sap.ui.model.Sorter("CREATED_ON",true,null)])}else if(k=="oldest"){l.getBinding("items").sort([new sap.ui.model.Sorter("CREATED_ON",false,null)])}else if(k=="type"){l.getBinding("items").sort([new sap.ui.model.Sorter("TYPE",g,null)])}else if(k=="alphabetically"){l.getBinding("items").sort([new sap.ui.model.Sorter("TITLE",g,null)])}},toggleListSelection:function(i){if(i){this.byId("list").detachSelectionChange(this._handleSelect,this);this.byId("list").setMode("MultiSelect");this.currentHeaderFooterOptions=this.multiSelectHeaderFooterOptions;this.refreshHeaderFooterForEditToggle();this.oRouter.navTo("multiSelect",{});this.showEmptyView("DETAIL_TITLE",sap.ui.getCore().getConfiguration().getLanguage()," ")}else{this.byId("list").attachSelectionChange(this._handleSelect,this);this.byId("list").setMode("SingleSelectMaster");this.currentHeaderFooterOptions=this.defaultHeaderFooterOptions;this.refreshHeaderFooterForEditToggle();this.oRouter.navTo("detail",{contextPath:this.oApplicationFacade.currentContextPath})}},exportIndicators:function(){var t=this;var d=new sap.m.SelectDialog({title:t.oApplicationFacade.getResourceBundle().getText("SELECT_PACKAGES"),items:{path:"/HANA_PACKAGES",template:new sap.m.StandardListItem({title:"{OBJECT}"})},confirm:function(e){var p=e.getParameter("selectedItem").getProperty("title");if(p){var a=t.getExportObject();a=a.replace("<Hana Package Here>",e.getParameter("selectedItem").getProperty("title"));var s=t.byId("list").getSelectedContexts();var b="";var c=[];var f="";for(var i=0,l=s.length;i<l;i++){if(s[i].getProperty("IS_ACTIVE")==1){b+=(b)?',':'';b+='{"value":"'+s[i].getProperty("ID")+'","operator":"="}'}else{f+=(f)?' , ':'';f+='"'+s[i].getProperty("TITLE")+'"';c.push(s[i])}}a=a.replace(/"<Indicators Here>"/g,b);if(b){if(c.length){sap.m.MessageBox.show(f+" "+t.oApplicationFacade.getResourceBundle().getText("INACTIVE_KPI_OPI_FOR_EXPORT"),"sap-icon://hint",t.oApplicationFacade.getResourceBundle().getText("EXPORT_ALERT_TITLE"),[sap.m.MessageBox.Action.OK,sap.m.MessageBox.Action.CANCEL],function(g){if(g=="OK"){t.callExportService(a)}else{}})}else{t.callExportService(a)}}else{sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("NO_KPI_OPI_FOR_EXPORT"))}}else{sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("NO_HANA_PACKAGE_SELECTED"))}},liveChange:function(e){var s="'"+e.getParameter("value").toLowerCase()+"'";var f=new sap.ui.model.Filter("tolower(OBJECT)",sap.ui.model.FilterOperator.Contains,s);var b=e.getSource().getBinding("items");b.filter(new sap.ui.model.Filter([f],false))}});d.setModel(this.oApplicationFacade.getODataModel());d.open()},getExportObject:function(){var e={"data":[{"tableName":"sap.hba.r.sb.core.db::INDICATORS","schema":"SAP_HBA","dependentOn":[],"keys":{"ID":["<Indicators Here>"],"IS_ACTIVE":[{"value":1,"operator":"="}]},"customKeys":["ID"]},{"tableName":"sap.hba.r.sb.core.db::INDICATOR_TEXTS","schema":"SAP_HBA","keys":{"ID":["<Indicators Here>"],"IS_ACTIVE":[{"value":1,"operator":"="}]},"customKeys":["ID"],"dependentOn":[]},{"tableName":"sap.hba.r.sb.core.db::EVALUATIONS","schema":"SAP_HBA","customKeys":["ID"],"keys":{"IS_ACTIVE":[{"value":1,"operator":"="}]},"dependentOn":[{"tableName":"sap.hba.r.sb.core.db::INDICATORS","schema":"SAP_HBA","dependentOn":[],"keys":{"ID":["<Indicators Here>"],"IS_ACTIVE":[{"value":1,"operator":"="}]},"dependentKey":"INDICATOR","mappingKey":"ID"}]},{"tableName":"sap.hba.r.sb.core.db::EVALUATION_TEXTS","schema":"SAP_HBA","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}]},"customKeys":["ID"],"dependentOn":[{"tableName":"sap.hba.r.sb.core.db::EVALUATIONS","schema":"SAP_HBA","dependentOn":[{"tableName":"sap.hba.r.sb.core.db::INDICATORS","schema":"SAP_HBA","dependentOn":[],"dependentKey":"INDICATOR","mappingKey":"ID","keys":{"ID":["<Indicators Here>"],"IS_ACTIVE":[{"value":1,"operator":"="}]}}],"keys":{},"dependentKey":"ID","mappingKey":"ID"}]},{"tableName":"sap.hba.r.sb.core.db::EVALUATION_VALUES","schema":"SAP_HBA","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}]},"customKeys":["ID"],"dependentOn":[{"tableName":"sap.hba.r.sb.core.db::EVALUATIONS","schema":"SAP_HBA","dependentOn":[{"tableName":"sap.hba.r.sb.core.db::INDICATORS","schema":"SAP_HBA","dependentOn":[],"dependentKey":"INDICATOR","mappingKey":"ID","keys":{"ID":["<Indicators Here>"],"IS_ACTIVE":[{"value":1,"operator":"="}]}}],"keys":{},"dependentKey":"ID","mappingKey":"ID"}]},{"tableName":"sap.hba.r.sb.core.db::EVALUATION_FILTERS","schema":"SAP_HBA","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}]},"customKeys":["ID"],"dependentOn":[{"tableName":"sap.hba.r.sb.core.db::EVALUATIONS","schema":"SAP_HBA","dependentOn":[{"tableName":"sap.hba.r.sb.core.db::INDICATORS","schema":"SAP_HBA","dependentOn":[],"dependentKey":"INDICATOR","mappingKey":"ID","keys":{"ID":["<Indicators Here>"],"IS_ACTIVE":[{"value":1,"operator":"="}]}}],"keys":{},"dependentKey":"ID","mappingKey":"ID"}]},{"tableName":"sap.hba.r.sb.core.db::PROPERTIES","schema":"SAP_HBA","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}],"TYPE":[{"value":"IN","operator":"="}]},"dependentOn":[{"tableName":"sap.hba.r.sb.core.db::INDICATORS","schema":"SAP_HBA","dependentKey":"ID","mappingKey":"ID","dependentOn":[],"keys":{"ID":["<Indicators Here>"],"IS_ACTIVE":[{"value":1,"operator":"="}]}}],"customKeys":["ID","TYPE"]},{"tableName":"sap.hba.r.sb.core.db::PROPERTIES","schema":"SAP_HBA","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}],"TYPE":[{"value":"EV","operator":"="}]},"dependentOn":[{"tableName":"sap.hba.r.sb.core.db::EVALUATIONS","schema":"SAP_HBA","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}]},"dependentOn":[{"tableName":"sap.hba.r.sb.core.db::INDICATORS","schema":"SAP_HBA","dependentOn":[],"mappingKey":"ID","dependentKey":"INDICATOR","keys":{"ID":["<Indicators Here>"],"IS_ACTIVE":[{"value":1,"operator":"="}]}}],"dependentKey":"ID","mappingKey":"ID"}],"customKeys":["ID","TYPE"]},{"tableName":"sap.hba.r.sb.core.db::TAGS","schema":"SAP_HBA","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}],"TYPE":[{"value":"IN","operator":"="}]},"dependentOn":[{"tableName":"sap.hba.r.sb.core.db::INDICATORS","schema":"SAP_HBA","dependentKey":"ID","mappingKey":"ID","dependentOn":[],"keys":{"ID":["<Indicators Here>"],"IS_ACTIVE":[{"value":1,"operator":"="}]}}],"customKeys":["ID","TYPE"]},{"tableName":"sap.hba.r.sb.core.db::TAGS","schema":"SAP_HBA","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}],"TYPE":[{"value":"EV","operator":"="}]},"dependentOn":[{"tableName":"sap.hba.r.sb.core.db::EVALUATIONS","schema":"SAP_HBA","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}]},"dependentOn":[{"tableName":"sap.hba.r.sb.core.db::INDICATORS","schema":"SAP_HBA","dependentOn":[],"mappingKey":"ID","dependentKey":"INDICATOR","keys":{"ID":["<Indicators Here>"],"IS_ACTIVE":[{"value":1,"operator":"="}]}}],"dependentKey":"ID","mappingKey":"ID"}],"customKeys":["ID","TYPE"]},{"tableName":"sap.hba.r.sb.core.db::ASSOCIATIONS","schema":"SAP_HBA","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}]},"dependentOn":[{"tableName":"sap.hba.r.sb.core.db::INDICATORS","schema":"SAP_HBA","dependentKey":"SOURCE_INDICATOR","mappingKey":"ID","dependentOn":[],"keys":{"ID":["<Indicators Here>"],"IS_ACTIVE":[{"value":1,"operator":"="}]}}],"customKeys":["SOURCE_INDICATOR"]},{"tableName":"sap.hba.r.sb.core.db::ASSOCIATION_PROPERTIES","schema":"SAP_HBA","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}]},"dependentOn":[{"tableName":"sap.hba.r.sb.core.db::INDICATORS","schema":"SAP_HBA","dependentKey":"SOURCE_INDICATOR","mappingKey":"ID","dependentOn":[],"keys":{"ID":["<Indicators Here>"],"IS_ACTIVE":[{"value":1,"operator":"="}]}}],"customKeys":["SOURCE_INDICATOR"]},{"tableName":"sap.hba.r.sb.core.db::DDA_MASTER","schema":"SAP_HBA","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}]},"customKeys":["EVALUATION_ID"],"dependentOn":[{"tableName":"sap.hba.r.sb.core.db::EVALUATIONS","schema":"SAP_HBA","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}]},"dependentKey":"EVALUATION_ID","mappingKey":"ID","dependentOn":[{"tableName":"sap.hba.r.sb.core.db::INDICATORS","schema":"SAP_HBA","dependentKey":"INDICATOR","mappingKey":"ID","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}],"ID":["<Indicators Here>"]},"dependentOn":[]}]}]},{"tableName":"sap.hba.r.sb.core.db::DDA_MASTER_TEXT","schema":"SAP_HBA","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}]},"customKeys":["EVALUATION_ID"],"dependentOn":[{"tableName":"sap.hba.r.sb.core.db::EVALUATIONS","schema":"SAP_HBA","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}]},"dependentKey":"EVALUATION_ID","mappingKey":"ID","dependentOn":[{"tableName":"sap.hba.r.sb.core.db::INDICATORS","schema":"SAP_HBA","dependentKey":"INDICATOR","mappingKey":"ID","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}],"ID":["<Indicators Here>"]},"dependentOn":[]}]}]},{"tableName":"sap.hba.r.sb.core.db::DDA_FILTERS","schema":"SAP_HBA","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}]},"customKeys":["EVALUATION_ID"],"dependentOn":[{"tableName":"sap.hba.r.sb.core.db::EVALUATIONS","schema":"SAP_HBA","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}]},"dependentKey":"EVALUATION_ID","mappingKey":"ID","dependentOn":[{"tableName":"sap.hba.r.sb.core.db::INDICATORS","schema":"SAP_HBA","dependentKey":"INDICATOR","mappingKey":"ID","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}],"ID":["<Indicators Here>"]},"dependentOn":[]}]}]},{"tableName":"sap.hba.r.sb.core.db::DDA_HEADER","schema":"SAP_HBA","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}]},"customKeys":["EVALUATION_ID"],"dependentOn":[{"tableName":"sap.hba.r.sb.core.db::EVALUATIONS","schema":"SAP_HBA","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}]},"dependentKey":"EVALUATION_ID","mappingKey":"ID","dependentOn":[{"tableName":"sap.hba.r.sb.core.db::INDICATORS","schema":"SAP_HBA","dependentKey":"INDICATOR","mappingKey":"ID","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}],"ID":["<Indicators Here>"]},"dependentOn":[]}]}]},{"tableName":"sap.hba.r.sb.core.db::DDA_COLUMNS","schema":"SAP_HBA","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}]},"customKeys":["EVALUATION_ID"],"dependentOn":[{"tableName":"sap.hba.r.sb.core.db::EVALUATIONS","schema":"SAP_HBA","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}]},"dependentKey":"EVALUATION_ID","mappingKey":"ID","dependentOn":[{"tableName":"sap.hba.r.sb.core.db::INDICATORS","schema":"SAP_HBA","dependentKey":"INDICATOR","mappingKey":"ID","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}],"ID":["<Indicators Here>"]},"dependentOn":[]}]}]},{"tableName":"sap.hba.r.sb.core.db::DDA_CHART","schema":"SAP_HBA","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}]},"customKeys":["EVALUATION_ID"],"dependentOn":[{"tableName":"sap.hba.r.sb.core.db::EVALUATIONS","schema":"SAP_HBA","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}]},"dependentKey":"EVALUATION_ID","mappingKey":"ID","dependentOn":[{"tableName":"sap.hba.r.sb.core.db::INDICATORS","schema":"SAP_HBA","dependentKey":"INDICATOR","mappingKey":"ID","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}],"ID":["<Indicators Here>"]},"dependentOn":[]}]}]},{"tableName":"sap.hba.r.sb.core.db::DDA_CONFIGURATION","schema":"SAP_HBA","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}]},"customKeys":["EVALUATION_ID"],"dependentOn":[{"tableName":"sap.hba.r.sb.core.db::EVALUATIONS","schema":"SAP_HBA","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}]},"dependentKey":"EVALUATION_ID","mappingKey":"ID","dependentOn":[{"tableName":"sap.hba.r.sb.core.db::INDICATORS","schema":"SAP_HBA","dependentKey":"INDICATOR","mappingKey":"ID","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}],"ID":["<Indicators Here>"]},"dependentOn":[]}]}]},{"tableName":"sap.hba.r.sb.core.db::CHIPS","schema":"SAP_HBA","keys":{"isActive":[{"value":1,"operator":"="}]},"customKeys":["id"],"dependentOn":[{"tableName":"sap.hba.r.sb.core.db::EVALUATIONS","schema":"SAP_HBA","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}]},"dependentKey":"evaluationId","mappingKey":"ID","dependentOn":[{"tableName":"sap.hba.r.sb.core.db::INDICATORS","schema":"SAP_HBA","dependentKey":"INDICATOR","mappingKey":"ID","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}],"ID":["<Indicators Here>"]},"dependentOn":[]}]}]},{"tableName":"sap.hba.r.sb.core.db::CHIP_TEXTS","schema":"SAP_HBA","keys":{"isActive":[{"operator":"=","value":1}]},"customKeys":["id"],"dependentOn":[{"tableName":"sap.hba.r.sb.core.db::CHIPS","schema":"SAP_HBA","keys":{"isActive":[{"value":1,"operator":"="}]},"dependentOn":[{"tableName":"sap.hba.r.sb.core.db::EVALUATIONS","schema":"SAP_HBA","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}]},"dependentKey":"evaluationId","mappingKey":"ID","dependentOn":[{"tableName":"sap.hba.r.sb.core.db::INDICATORS","schema":"SAP_HBA","dependentKey":"INDICATOR","mappingKey":"ID","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}],"ID":["<Indicators Here>"]},"dependentOn":[]}]}],"mappingKey":"id","dependentKey":"id"}]}],"file":{"package_name":"<Hana Package Here>"}};return JSON.stringify(e)},callExportService:function(p){var t=this;jQuery.ajax({type:"HEAD",async:false,dataType:"json",url:"/sap/hba/r/sb/core/logic/__token.xsjs",headers:{"X-CSRF-Token":"Fetch"},success:function(d,s,x){t.exportBusyDialog=t.exportBusyDialog||new sap.m.BusyDialog({text:t.oApplicationFacade.getResourceBundle().getText("EXPORT_KPI_OPI_BUSY_DIALOG_TEXT"),title:t.oApplicationFacade.getResourceBundle().getText("EXPORT_KPI_OPI_BUSY_DIALOG_TITLE")});t.exportBusyDialog.open();jQuery.ajax({url:"/sap/hba/r/sb/core/logic/transferToHanaRepo.xsjs",type:"POST",data:p,headers:{"X-CSRF-Token":x.getResponseHeader("X-CSRF-Token")},async:true,success:function(d){t.exportBusyDialog.close();sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("EXPORT_SUCCESS"))},error:function(e){t.exportBusyDialog.close();sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("EXPORT_ERROR"))}})},error:function(){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ERR_FETCH_AUTH_TOKEN"));$.sap.log.error("ERR_FETCH_AUTH_TOKEN")}})},onExit:function(){var h=hasher||window.hasher;if(!(h.getHash())){sap.suite.smartbusiness.utils.backToHome()}},applySearchPatternToListItem:function(I,f){if(sap.ca.scfld.md.controller.ScfldMasterController.prototype.applySearchPatternToListItem.apply(this,arguments)){return true}else{var d=I.getDependents()||[];for(var i=0,l=d.length;i<l;i++){if(d[i].getText().toLowerCase().indexOf(f)!=-1){return true}}}return false}})};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.workspace.view.S3.controller')){jQuery.sap.declare('sap.suite.ui.smartbusiness.designtime.workspace.view.S3.controller');jQuery.sap.require('sap.ca.scfld.md.controller.BaseDetailController');jQuery.sap.require('sap.m.MessageBox');jQuery.sap.require('sap.m.MessageToast');sap.ca.scfld.md.controller.BaseDetailController.extend("sap.suite.ui.smartbusiness.designtime.workspace.view.S3",{onInit:function(){var t=this;var v=this.getView();this.oRouter.attachRouteMatched(function(e){if(e.getParameter("name")==="multiSelect"){var p=this.getView().getContent()[0].getContent();for(var i=0,l=p.length;i<l;i++){p[i].setVisible(false)}this.oApplicationFacade.multiSelectMode=true}else if(e.getParameter("name")==="detail"){if(this.oApplicationFacade.multiSelectMode){var p=this.getView().getContent()[0].getContent();for(var i=0,l=p.length;i<l;i++){p[i].setVisible(true)}this.oApplicationFacade.multiSelectMode=undefined}this.oApplicationFacade.currentContextPath=e.getParameter("arguments").contextPath;var c=new sap.ui.model.Context(v.getModel(),'/'+(e.getParameter("arguments").contextPath));v.setBindingContext(c);v.contextPath=e.getParameter("arguments").contextPath;t.contextIndicatorId=v.getBindingContext().getProperty("ID")||e.getParameter("arguments").contextPath.split("(")[1].split(",")[0].split("=")[1].replace(/'/g,'');var m=new sap.ui.model.json.JSONModel();t.getView().byId("kpiAssociationTable").getBinding("items").filter(new sap.ui.model.Filter([new sap.ui.model.Filter("SOURCE_INDICATOR",sap.ui.model.FilterOperator.EQ,t.contextIndicatorId),new sap.ui.model.Filter("TARGET_INDICATOR",sap.ui.model.FilterOperator.EQ,t.contextIndicatorId)],false));t.byId("kpiAssociationTable").getBinding("items").attachDataReceived(function(d){t.getView().byId("associationIconTab").setCount(t.getView().byId("kpiAssociationTable").getItems().length)});if(v.getBindingContext().getObject()){this.onAfterIndicatorContext(v.getBindingContext().getObject());this.contextIndicatorId=v.getBindingContext().getProperty("ID")}else{this.oApplicationFacade.getODataModel().read(v.contextPath,null,null,true,function(d){t.onAfterIndicatorContext(d);t.currentContextDataForBookmark=d;t.contextIndicatorId=d.ID},function(a){t.contextIndicatorId=e.getParameter("arguments").contextPath.split("(")[1].split(",")[0].split("=")[1].replace(/'/g,'');sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("YMSG_ERROR_RETRIEVING_DATA"),a.response.body)})}t.byId("evaluationTable").getBinding("items").attachDataReceived(function(d){t.oApplicationFacade.evaluationContexts=[];var a=t.byId("evaluationTable").getItems();for(var i=0;i<a.length;i++){t.oApplicationFacade.evaluationContexts[i]=a[i].getBindingContext().getPath()}})}},this);this.oHeaderFooterOptions={bSuppressBookmarkButton:{},buttonList:[]};t.byId("directionArrowAssociation").setColor(sap.ui.core.theming.Parameters.get("sapUiLightText"))},getHeaderFooterOptions:function(){return this.oHeaderFooterOptions},onAfterRendering:function(){},formatOwner:function(o){return(o||"")},formatStatus:function(s){return((s)?(this.oApplicationFacade.getResourceBundle().getText("ACTIVE")):this.oApplicationFacade.getResourceBundle().getText("DRAFT"))},formatGoalType:function(g){var t=this;var a=null;switch(g){case'MA':a=t.oApplicationFacade.getResourceBundle().getText("MAXIMIZING");break;case'MI':a=t.oApplicationFacade.getResourceBundle().getText("MINIMIZING");break;case'RA':a=t.oApplicationFacade.getResourceBundle().getText("RANGE");break;default:a=t.oApplicationFacade.getResourceBundle().getText("NONE")}return a},formatEvaluationCount:function(e){return(e||0)},formatFavoriteMark:function(f){return((f)?true:false)},formatTags:function(t){return((this.getView().byId("tags").getItems().length>1)?(', '+t):(t))},formatAssociationCount:function(s,t){var a=this;if(s==null&&t==null){return a.oApplicationFacade.getResourceBundle().getText("ASSOCIATIONS")+"(0)"}if(s==null){return a.oApplicationFacade.getResourceBundle().getText("ASSOCIATIONS")+"("+t+")"}if(t==null){return a.oApplicationFacade.getResourceBundle().getText("ASSOCIATIONS")+"("+s+")"}var c=(parseInt(s)+parseInt(t));return a.oApplicationFacade.getResourceBundle().getText("ASSOCIATIONS")+"("+c.toString()+")"},formatProperties:function(n,v){var p=((this.getView().byId("assoProperties").getItems().length>1)?(", "+n+" : "+v):(n+" : "+v+","));return p},formatArrowDirection:function(s){return((s==this.contextIndicatorId)?("sap-icon://arrow-right"):("sap-icon://arrow-left"))},formatAssociationType:function(a){if(a=="SUPPORTING"){return this.oApplicationFacade.getResourceBundle().getText("SUPPORTING")}else{return this.oApplicationFacade.getResourceBundle().getText("CONFLICTING")}},formatTargetIndicatorText:function(s,t,a,b){var i=null;if(t==this.contextIndicatorId){i=a}else{i=b}return i},formatStatusOfAssociation:function(i,c){var t=this;if(c=="2"){var s=t.oApplicationFacade.getResourceBundle().getText("STATUS_ACTIVE")+","+t.oApplicationFacade.getResourceBundle().getText("STATUS_DRAFT");return s}if(i==0){return t.oApplicationFacade.getResourceBundle().getText("STATUS_NEW")}if(i==1){return t.oApplicationFacade.getResourceBundle().getText("STATUS_ACTIVE")}},formatKpiStatus:function(s,c){var t=this;var i="";if(c>1){i=(t.oApplicationFacade.getResourceBundle().getText("STATUS_ACTIVE")+","+t.oApplicationFacade.getResourceBundle().getText("STATUS_DRAFT"))}else if(s){i=t.oApplicationFacade.getResourceBundle().getText("STATUS_ACTIVE")}else{i=t.oApplicationFacade.getResourceBundle().getText("STATUS_NEW")}return i},handleEvaluationSelect:function(e){var t=this;for(var i=0;i<this.oApplicationFacade.evaluationContexts.length;i++){if(e.getParameter("listItem").getBindingContext().sPath===this.oApplicationFacade.evaluationContexts[i]){this.oApplicationFacade.evaluationIndex=i;break}}sap.suite.smartbusiness.utils.replaceHash({action:"SBWorkspace",route:"evalDetail",context:(this.getView().contextPath+"/"+e.getParameter("listItem").getBindingContext().sPath.substring(1))})},onAfterIndicatorContext:function(c){var t=this;t.updateFooterButtons(c)},getAllFooterButtons:function(){var t=this;var b=[{id:"addEval",sId:"addEvaluationButton",sI18nBtnTxt:"ADD_EVALUATION",onBtnPressed:function(e){sap.suite.smartbusiness=sap.suite.smartbusiness||{};sap.suite.smartbusiness.modelerAppCache=sap.suite.smartbusiness.modelerAppCache||{};sap.suite.smartbusiness.modelerAppCache.createSBKPIEvaluation=sap.suite.smartbusiness.modelerAppCache.createSBKPIEvaluation||{};sap.suite.smartbusiness.modelerAppCache.createSBKPIEvaluation.appFromWorkspace=true;sap.suite.smartbusiness.utils.appToAppNavigation({action:"createSBKPIEvaluation",route:"addEvaluation",context:(t.getView().getBindingContext().getPath())})},},{sId:"favouriteToggleButton",sI18nBtnTxt:"ADD_FAVOURITE",onBtnPressed:function(e){var p="/FAVOURITES";var c=t.getView().getBindingContext().getObject();var d=t.oApplicationFacade.getODataModel();var a={ID:c.ID,TYPE:c.ENTITY_TYPE,USER_ID:t.oApplicationFacade.currentLogonHanaUser,MANUAL_ENTRY:1,LAST_WORKED_ON:null};if(c.MANUAL_ENTRY){sap.suite.smartbusiness.utils.remove(sap.suite.smartbusiness.utils.serviceUrl("INDICATOR_FAVOURITE_SERVICE_URI"),a,function(f){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("FAVOURITE_IN_DELETE_SUCCESS_KPI_OPI"));d.refresh();c.MANUAL_ENTRY=0;t.updateFooterButtons(c)},function(f){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("FAVOURITE_IN_DELETE_ERROR_KPI_OPI"),f.responseText)})}else if(c.MANUAL_ENTRY==0){sap.suite.smartbusiness.utils.update(sap.suite.smartbusiness.utils.serviceUrl("INDICATOR_FAVOURITE_SERVICE_URI"),a,null,function(f){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("FAVOURITE_IN_SUCCESS_KPI_OPI"));d.refresh();c.MANUAL_ENTRY=1;t.updateFooterButtons(c)},function(f){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("FAVOURITE_KPI_OPI_ERROR"),f.responseText)})}else if(c.MANUAL_ENTRY==null){sap.suite.smartbusiness.utils.create(sap.suite.smartbusiness.utils.serviceUrl("INDICATOR_FAVOURITE_SERVICE_URI"),a,null,function(f){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("FAVOURITE_IN_SUCCESS_KPI_OPI"));d.refresh();c.MANUAL_ENTRY=1;t.updateFooterButtons(c)},function(f){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("FAVOURITE_KPI_OPI_ERROR"),f.responseText)})}}},{sId:"activateButton",sI18nBtnTxt:"ACTIVATE",onBtnPressed:function(e){var a="ACTIVE_INDICATORS";var p={};var c=[];var P=t.getView().getBindingContext().sPath;p.ID=P.substring((P.indexOf("'")+1),P.lastIndexOf("'"));c.push(p);t.oApplicationFacade.getODataModel().read(("/INDICATOR_TEXTS?$filter=ID eq '"+t.contextIndicatorId+"' and IS_ACTIVE eq 0 and TITLE ne ''"),null,null,false,function(d){if(d&&d.results&&d.results.length){var O=t.oApplicationFacade.getODataModel();sap.suite.smartbusiness.utils.create(sap.suite.smartbusiness.utils.serviceUrl("ACTIVATE_INDICATOR_SERVICE_URI"),c,null,function(d){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("ACTIVATE_KPI_OPI_SUCCESS"));sap.suite.smartbusiness.utils.replaceHash({hash:window.location.hash.replace("IS_ACTIVE=0","IS_ACTIVE=1")},true);O.refresh()},function(f){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ACTIVATE_KPI_OPI_ERROR"),f.responseText)})}else{sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_KPI_OPI_TITLE"))}},function(){})}},{id:"editBut",sId:"editButton",sI18nBtnTxt:"EDIT",onBtnPressed:function(e){var c=t.getView().getBindingContext().getPath();c=(t.getView().getBindingContext().getObject().COUNTER==2)?c.replace("IS_ACTIVE=1","IS_ACTIVE=0"):c;c=c.replace("INDICATORS_MODELER","INDICATORS");sap.suite.smartbusiness=sap.suite.smartbusiness||{};sap.suite.smartbusiness.modelerAppCache=sap.suite.smartbusiness.modelerAppCache||{};sap.suite.smartbusiness.modelerAppCache.createSBKPI=sap.suite.smartbusiness.modelerAppCache.createSBKPI||{};sap.suite.smartbusiness.modelerAppCache.createSBKPI.appFromWorkspace=true;if(t.getView().getBindingContext().getObject().COUNTER==2){sap.suite.smartbusiness.utils.appToAppNavigation({action:"createSBKPI",route:"editDraftKpi",context:(c)})}else if(t.getView().getBindingContext().getObject().COUNTER==1){sap.suite.smartbusiness.utils.appToAppNavigation({action:"createSBKPI",route:"editKpi",context:(c)})}}},{sId:"deleteButton",sI18nBtnTxt:"DELETE_BUTTON_TEXT",onBtnPressed:function(e){if(!(sap.m.MessageBox)){jQuery.sap.require("sap.m.MessageBox")}sap.m.MessageBox.show(t.oApplicationFacade.getResourceBundle().getText("WARNING_SINGLE_INDICATOR_DELETE_KPI_OPI"),"sap-icon://hint",t.oApplicationFacade.getResourceBundle().getText("DELETE_BUTTON_TEXT"),[sap.m.MessageBox.Action.OK,sap.m.MessageBox.Action.CANCEL],function(e){if(e=="OK"){var a=t.getView().getBindingContext().sPath.substring(1).replace("INDICATORS_MODELER","INDICATORS");var p=[];p.push({ID:t.getView().getBindingContext().getObject().ID,IS_ACTIVE:t.getView().getBindingContext().getObject().IS_ACTIVE});var O=t.oApplicationFacade.getODataModel();sap.suite.smartbusiness.utils.remove(sap.suite.smartbusiness.utils.serviceUrl("INDICATOR_SERVICE_URI"),p,function(d){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("DELETE_KPI_OPI_SUCCESS"));O.refresh();sap.suite.smartbusiness.utils.replaceHash({hash:window.location.hash.substr(0,window.location.hash.indexOf("&/"))},true)},function(c){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("DELETE_KPI_OPI_ERROR"),c.responseText)})}if(e=="CANCEL"){}})}},{sId:"duplicateButton",sI18nBtnTxt:"DUPLICATE",onBtnPressed:function(e){sap.suite.smartbusiness=sap.suite.smartbusiness||{};sap.suite.smartbusiness.modelerAppCache=sap.suite.smartbusiness.modelerAppCache||{};sap.suite.smartbusiness.modelerAppCache.createSBKPI=sap.suite.smartbusiness.modelerAppCache.createSBKPI||{};sap.suite.smartbusiness.modelerAppCache.createSBKPI.appFromWorkspace=true;sap.suite.smartbusiness.utils.appToAppNavigation({action:"createSBKPI",route:"duplicateKpi",context:(t.getView().getBindingContext().getPath().replace("INDICATORS_MODELER","INDICATORS"))})}}];return b},updateFooterButtons:function(i){i=i||this.getView().getBindingContext().getObject();var f=this.getAllFooterButtons();this.oHeaderFooterOptions.buttonList=[];if((i.COUNTER==2)||(i.IS_ACTIVE)){this.oHeaderFooterOptions.oEditBtn=f[0]}if(i.MANUAL_ENTRY){f[1].sI18nBtnTxt=this.oApplicationFacade.getResourceBundle().getText("REMOVE_FAVOURITE")}else{f[1].sI18nBtnTxt=this.oApplicationFacade.getResourceBundle().getText("ADD_FAVOURITE")}this.oHeaderFooterOptions.buttonList.push(f[1]);if(!(i.IS_ACTIVE)){this.oHeaderFooterOptions.oEditBtn=f[2]}this.oHeaderFooterOptions.buttonList.push(f[5]);if(i.COUNTER==2){f[3].sI18nBtnTxt=this.oApplicationFacade.getResourceBundle().getText("EDIT_DRAFT")}else{f[3].sI18nBtnTxt=this.oApplicationFacade.getResourceBundle().getText("EDIT")}this.oHeaderFooterOptions.buttonList.push(f[3]);this.oHeaderFooterOptions.buttonList.push(f[4]);this.setHeaderFooterOptions(this.oHeaderFooterOptions)}})};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.workspace.view.S4.controller')){jQuery.sap.declare('sap.suite.ui.smartbusiness.designtime.workspace.view.S4.controller');jQuery.sap.require('sap.ca.scfld.md.controller.BaseDetailController');jQuery.sap.includeStyleSheet("../../resources/sap/suite/ui/smartbusiness/designtime/workspace/view/workspaceStyling.css");sap.ca.scfld.md.controller.BaseDetailController.extend("sap.suite.ui.smartbusiness.designtime.workspace.view.S4",{onInit:function(){var t=this;var v=this.getView();this.oRouter.attachRouteMatched(function(e){if(e.getParameter("name")==="evalDetail"){var c=new sap.ui.model.Context(v.getModel(),'/'+(e.getParameter("arguments").contextPath));var a=new sap.ui.model.Context(v.getModel(),'/'+(e.getParameter("arguments").evalPath));this.evalPath=e.getParameter("arguments").evalPath;this.contextPath=e.getParameter("arguments").contextPath;t.context=new sap.ui.model.Context(v.getModel(),'/'+(e.getParameter("arguments").contextPath));t.evalContext=new sap.ui.model.Context(v.getModel(),'/'+(e.getParameter("arguments").evalPath));t.evalPath=e.getParameter("arguments").evalPath;t.contextPath=e.getParameter("arguments").contextPath;if(t.evalContext.getObject()){t.onAfterEvaluationContext(t.context.getObject(),t.evalContext.getObject());v.setBindingContext(a)}else{t.oApplicationFacade.getODataModel().read(("/"+e.getParameter("arguments").evalPath),null,null,true,function(d){t.onAfterEvaluationContext(null,d)})}t.oApplicationFacade.getODataModel().read((t.evalPath+"/FILTERS"),null,null,true,function(F){var o;t.evaluationDetails=t.evaluationDetails||{};t.evaluationDetails.EVALUATION_FILTERS=F.results;o=t.formObjectForInputParametersAndFilters(F);t.modelForFiltersAndIp=new sap.ui.model.json.JSONModel();t.modelForFiltersAndIp.setData(o);t.getView().byId("filterInputParameterTable").setModel(t.modelForFiltersAndIp,"filterInput")},function(b){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("YMSG_ERROR_RETRIEVING_DATA"),b.response.body)});if(t.context.getObject()){this.onAfterIndicatorContext()}else{this.oApplicationFacade.getODataModel().read(this.contextPath,null,null,true,function(d){t.oApplicationFacade.getODataModel().oData[t.contextPath]=d;t.onAfterIndicatorContext()},function(b){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("YMSG_ERROR_RETRIEVING_DATA"),b.response.body)})}}},this)},formObjectForTrendThreshold:function(k,e,a){var o={TA:null,TC:null,RE:null,CL:null,CH:null,WL:null,WH:null};a=(a&&a.results)?a.results:[];for(var i=0,l=a.length;i<l;i++){if((e.VALUES_SOURCE=="FIXED")||(!(e.VALUES_SOURCE))){o[a[i]["TYPE"]]=a[i]["FIXED"]}else if(e.VALUES_SOURCE=="MEASURE"){o[a[i]["TYPE"]]=a[i]["COLUMN_NAME"]}}if(k){o.GOAL_TYPE=k.GOAL_TYPE}else{o.GOAL_TYPE=null}o.VALUES_SOURCE=e.VALUES_SOURCE||"FIXED";return o},formObjectForInputParametersAndFilters:function(l){var o={EVALUATION_FILTERS:[]},f=0,a=0;var i,v='',t={};var b=(l.results&&l.results.length)?l.results[0].NAME:"";for(i=0;i<l.results.length;i++){if(l.results[i].NAME==b&&(l.results[i].OPERATOR=="EQ"||l.results[i].OPERATOR=="GT"||l.results[i].OPERATOR=="LT"||l.results[i].OPERATOR=="NE")){t={};v+=l.results[i].VALUE_1+",";t={"ID":l.results[i].ID,"IS_ACTIVE":l.results[i].IS_ACTIVE,"NAME":l.results[i].NAME,"OPERATOR":l.results[i].OPERATOR,"TYPE":l.results[i].TYPE,"VALUES":v,"VALUE_2":null};b=l.results[i].NAME;f=0}if(l.results[i].NAME!=b&&(l.results[i].OPERATOR=="EQ"||l.results[i].OPERATOR=="GT"||l.results[i].OPERATOR=="LT"||l.results[i].OPERATOR=="NE")){if(t.VALUES){t.VALUES=t.VALUES.substring(0,t.VALUES.length-1);o.EVALUATION_FILTERS.push(t)}v='';v=v+l.results[i].VALUE_1+",";t={"ID":l.results[i].ID,"IS_ACTIVE":l.results[i].IS_ACTIVE,"NAME":l.results[i].NAME,"OPERATOR":l.results[i].OPERATOR,"TYPE":l.results[i].TYPE,"VALUES":v,"VALUE_2":null};b=l.results[i].NAME;f=0}if(l.results[i].OPERATOR=="BT"){if(t.VALUES){t.VALUES=t.VALUES.substring(0,t.VALUES.length-1);o.EVALUATION_FILTERS.push(t);t={}}t={"ID":l.results[i].ID,"IS_ACTIVE":l.results[i].IS_ACTIVE,"NAME":l.results[i].NAME,"OPERATOR":l.results[i].OPERATOR,"TYPE":l.results[i].TYPE,"VALUES":l.results[i].VALUE_1,"VALUE_2":l.results[i].VALUE_2};o.EVALUATION_FILTERS.push(t);f=1;b=l.results[i].NAME;t={}}}if(f==0){t.VALUES=(t.VALUES)?t.VALUES.substring(0,t.VALUES.length-1):t.VALUES;o.EVALUATION_FILTERS.push(t)}return o},formatOwnerName:function(o){var t=this;if(o==null||o==""){return""}else{return sap.suite.smartbusiness.formatters.getBundleText(undefined,"OWNER",o)}},formatGoalType:function(g){var t=this;var a=null;switch(g){case'MA':a=t.oApplicationFacade.getResourceBundle().getText("MAXIMIZING");break;case'MI':a=t.oApplicationFacade.getResourceBundle().getText("MINIMIZING");break;case'RA':a=t.oApplicationFacade.getResourceBundle().getText("RANGE");break;default:a=t.oApplicationFacade.getResourceBundle().getText("NONE")}return a},formatThresholdCriticalHigh:function(g){var t=this;var a=null;if(t.evalContext!=null)g=t.evalContext.getObject().GOAL_TYPE;switch(g){case'MI':a=t.oApplicationFacade.getResourceBundle().getText("CRITICAL");break;case'RA':a=t.oApplicationFacade.getResourceBundle().getText("CRITICAL_HIGH");break;default:a=""}return a},formatThresholdWarningHigh:function(g){var t=this;var a=null;if(t.evalContext!=null)g=t.evalContext.getObject().GOAL_TYPE;switch(g){case'MI':a=t.oApplicationFacade.getResourceBundle().getText("WARNING");break;case'RA':a=t.oApplicationFacade.getResourceBundle().getText("WARNING_HIGH");break;default:a=""}return a},formatThresholdWarningLow:function(g){var t=this;var a=null;if(t.evalContext!=null)g=t.evalContext.getObject().GOAL_TYPE;switch(g){case'MA':a=t.oApplicationFacade.getResourceBundle().getText("WARNING");break;case'RA':a=t.oApplicationFacade.getResourceBundle().getText("WARNING_LOW");break;default:a=""}return a},formatThresholdCriticalLow:function(g){var t=this;var a=null;if(t.evalContext!=null)g=t.evalContext.getObject().GOAL_TYPE;switch(g){case'MA':a=t.oApplicationFacade.getResourceBundle().getText("CRITICAL");break;case'RA':a=t.oApplicationFacade.getResourceBundle().getText("CRITICAL_LOW");break;default:a=""}return a},formatProperties:function(n,v){return((this.getView().byId("properties").getItems().length>1)?(', '+n+' : '+v):(n+' : '+v))},formatOperator:function(o){var t=this;var a=null;switch(o){case'EQ':a=t.oApplicationFacade.getResourceBundle().getText("EQUAL_TO");break;case'GT':a=t.oApplicationFacade.getResourceBundle().getText("GREATER_THAN");break;case'LT':a=t.oApplicationFacade.getResourceBundle().getText("LESS_THAN");break;case'NE':a=t.oApplicationFacade.getResourceBundle().getText("NOT_EQUAL_TO");break;case'BT':a=t.oApplicationFacade.getResourceBundle().getText("BETWEEN");break;case undefined:a=null;break;default:a=t.oApplicationFacade.getResourceBundle().getText("NONE")}return a},formatTypeOfFilter:function(i){var t=this;var p=null;switch(i){case'FI':p=t.oApplicationFacade.getResourceBundle().getText("FILTER");break;case'PA':p=t.oApplicationFacade.getResourceBundle().getText("INPUT_PARAMETER");break;case undefined:operatorTypeText=null;break;default:p=t.oApplicationFacade.getResourceBundle().getText("NONE")}return p},getHeaderFooterOptions:function(){var t=this;this.oHeaderFooterOptions={bSuppressBookmarkButton:{},onBack:function(){var h=window.location.hash.replace("evalDetail","detail");sap.suite.smartbusiness.utils.replaceHash({hash:h.substr(0,h.lastIndexOf("/"))},true)},oUpDownOptions:{sI18NDetailTitle:"ITEM_DETAIL_HEADER",iPosition:0,iCount:0,fSetPosition:function(n){t.oApplicationFacade.evaluationIndex=n;var a=t.oApplicationFacade.evaluationContexts[t.oApplicationFacade.evaluationIndex].substring(1);var v=t.getView();t.oHeaderFooterOptions.oUpDownOptions.iPosition=t.oApplicationFacade.evaluationIndex;t.oHeaderFooterOptions.oUpDownOptions.iCount=t.oApplicationFacade.evaluationContexts.length;t.setHeaderFooterOptions(t.oHeaderFooterOptions);t.getHeaderFooterOptions();sap.suite.smartbusiness.utils.replaceHash({action:"SBWorkspace",route:"evalDetail",context:(t.contextPath+"/"+a)})}},buttonList:t.getAllFooterButtons()};if(t.oApplicationFacade.evaluationIndex&&t.oApplicationFacade.evaluationContexts){t.onAfterAllEvaluationContexts();if(t.bookmark==false){t.updateFooterButtons()}}else{t.oApplicationFacade.evaluationContexts=[];t.oApplicationFacade.getODataModel().read((t.contextPath+"/EVALUATIONS"),null,null,true,function(d){for(var i=0,l=d.results.length;i<l;i++){t.oApplicationFacade.evaluationContexts[i]=("/"+d.results[i].__metadata.uri.split("/")[d.results[i].__metadata.uri.split("/").length-1]);t.oApplicationFacade.getODataModel().oData[t.oApplicationFacade.evaluationContexts[i].substr(1)]=d.results[i];if(t.oApplicationFacade.evaluationContexts[i]==('/'+(t.evalPath))){t.oApplicationFacade.evaluationIndex=i;var e=new sap.ui.model.Context(t.getView().getModel(),'/'+(t.evalPath));t.getView().setBindingContext(e)}}t.onAfterAllEvaluationContexts(t.oApplicationFacade.evaluationIndex,t.oApplicationFacade.evaluationContexts)},function(e){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("YMSG_ERROR_RETRIEVING_DATA"),e.response.body)})}return this.oHeaderFooterOptions},formatEvalStatus:function(s,c){var t=this;var i="";if(c>1){i=(t.oApplicationFacade.getResourceBundle().getText("STATUS_ACTIVE")+","+t.oApplicationFacade.getResourceBundle().getText("STATUS_DRAFT"))}else if(s){i=t.oApplicationFacade.getResourceBundle().getText("STATUS_ACTIVE")}else{i=t.oApplicationFacade.getResourceBundle().getText("STATUS_NEW")}return i},hideShow:function(g){var t=this;if(g=="MA"){t.byId("CHlabel").setVisible(false);t.byId("CHinput").setVisible(false);t.byId("WHlabel").setVisible(false);t.byId("WHinput").setVisible(false);t.byId("WLlabel").setVisible(true);t.byId("WLinput").setVisible(true);t.byId("CLlabel").setVisible(true);t.byId("CLinput").setVisible(true)}else if(g=="MI"){t.byId("WLlabel").setVisible(false);t.byId("WLinput").setVisible(false);t.byId("CLlabel").setVisible(false);t.byId("CLinput").setVisible(false);t.byId("CHlabel").setVisible(true);t.byId("CHinput").setVisible(true);t.byId("WHlabel").setVisible(true);t.byId("WHinput").setVisible(true)}else if(g=="RA"){t.byId("WLlabel").setVisible(true);t.byId("WLinput").setVisible(true);t.byId("CLlabel").setVisible(true);t.byId("CLinput").setVisible(true);t.byId("CHlabel").setVisible(true);t.byId("CHinput").setVisible(true);t.byId("WHlabel").setVisible(true);t.byId("WHinput").setVisible(true)}else if(g==null){t.byId("WLlabel").setVisible(false);t.byId("WLinput").setVisible(false);t.byId("CLlabel").setVisible(false);t.byId("CLinput").setVisible(false);t.byId("CHlabel").setVisible(false);t.byId("CHinput").setVisible(false);t.byId("WHlabel").setVisible(false);t.byId("WHinput").setVisible(false)}},onAfterAllEvaluationContexts:function(){var t=this;t.oHeaderFooterOptions.oUpDownOptions.iPosition=t.oApplicationFacade.evaluationIndex;t.oHeaderFooterOptions.oUpDownOptions.iCount=t.oApplicationFacade.evaluationContexts.length;t.setHeaderFooterOptions(t.oHeaderFooterOptions);t.updateFooterButtons(t.evalContext.getObject())},onAfterIndicatorContext:function(){var t=this},formatFavoriteMark:function(f){return((f)?true:false)},onAfterEvaluationContext:function(i,e){var t=this;t.hideShow(e.GOAL_TYPE);t.byId("goalType").setText(t.formatGoalType(e.GOAL_TYPE));t.oApplicationFacade.getODataModel().read((t.evalPath+"/VALUES"),null,null,true,function(a){var o={};t.evaluationDetails=t.evaluationDetails||{};t.evaluationDetails.EVALUATION_VALUES=a.results;o=t.formObjectForTrendThreshold(i,e,a);t.modelForTarget=new sap.ui.model.json.JSONModel();t.byId("thresholdTrendId").setModel(t.modelForTarget);t.modelForTarget.setData(o)},function(a){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("YMSG_ERROR_RETRIEVING_DATA"),a.response.body)});if(t.oHeaderFooterOptions){t.updateFooterButtons(e)}else{t.bookmark=false}t.evaluationDetails=t.evaluationDetails||{};t.evaluationDetails.EVALUATIONS=e;t.currentEvaluationObj=e},getAllFooterButtons:function(){var t=this;return[{sId:"activateButton",sI18nBtnTxt:"ACTIVATE",onBtnPressed:function(e){var a=t.checkForMandatoryParametersForEvaluation();t.oApplicationFacade.getODataModel().read(("/EVALUATION_TEXTS?$filter=ID eq '"+t.currentEvaluationObj.ID+"' and IS_ACTIVE eq 0 and TITLE ne ''"),null,null,false,function(d){if(!(d&&d.results&&d.results.length)){a.error.push(t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_EVALUATION_TITLE"))}},function(d){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("YMSG_ERROR_RETRIEVING_DATA"),d.response.body)});if(a.error.length){var b="";for(var i=0,l=a.error.length;i<l;i++){b+=b?"\n":"";b+=t.oApplicationFacade.getResourceBundle().getText(a.error[i])}sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ACTIVATE_EV_ERROR"),b)}else{if(a.warning.length){var w="";for(var i=0,l=a.warning.length;i<l;i++){w+=w?"\n":"";w+=t.oApplicationFacade.getResourceBundle().getText(a.warning[i])}var c=new sap.m.Dialog({icon:"sap-icon://warning2",title:t.oApplicationFacade.getResourceBundle().getText("WARNING"),state:"Warning",type:"Message",content:[new sap.m.Text({text:w+"\n\n"+t.oApplicationFacade.getResourceBundle().getText("WARNING_EV_ACTIVATE")})],beginButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("CONTINUE"),press:function(){c.close();t.activateEvaluation()}}),endButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("CANCEL"),press:function(){c.close()}})});c.open()}else{t.activateEvaluation()}}}},{sId:"favouriteToggleButton",sI18nBtnTxt:"ADD_FAVOURITE",onBtnPressed:function(e){var p="/FAVOURITES";var c=t.getView().getBindingContext().getObject();var d=t.oApplicationFacade.getODataModel();var a={ID:c.ID,TYPE:c.ENTITY_TYPE,USER_ID:t.oApplicationFacade.currentLogonHanaUser,MANUAL_ENTRY:1,LAST_WORKED_ON:null};if(c.MANUAL_ENTRY){sap.suite.smartbusiness.utils.remove(sap.suite.smartbusiness.utils.serviceUrl("EVALUATION_FAVOURITE_SERVICE_URI"),a,function(b){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("FAVOURITE_EV_DELETE_SUCCESS"));c.MANUAL_ENTRY=null;t.updateFooterButtons(c);d.refresh();t.setBtnText("favouriteToggleButton",t.oApplicationFacade.getResourceBundle().getText("ADD_FAVOURITE"))},function(b){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("FAVOURITE_EV_DELETE_ERROR"),b.responseText)})}else if(c.MANUAL_ENTRY==0){sap.suite.smartbusiness.utils.update(sap.suite.smartbusiness.utils.serviceUrl("EVALUATION_FAVOURITE_SERVICE_URI"),a,null,function(b){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("FAVOURITE_EV_SUCCESS"));c.MANUAL_ENTRY=1;t.updateFooterButtons(c);d.refresh();t.setBtnText("favouriteToggleButton",t.oApplicationFacade.getResourceBundle().getText("REMOVE_FAVOURITE"))},function(b){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("FAVOURITE_EV_DELETE_ERROR"),b.responseText)})}else if(c.MANUAL_ENTRY==null){sap.suite.smartbusiness.utils.update(sap.suite.smartbusiness.utils.serviceUrl("EVALUATION_FAVOURITE_SERVICE_URI"),a,null,function(b){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("FAVOURITE_EV_SUCCESS"));c.MANUAL_ENTRY=1;t.updateFooterButtons(c);d.refresh();t.setBtnText("favouriteToggleButton",t.oApplicationFacade.getResourceBundle().getText("REMOVE_FAVOURITE"))},function(b){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("FAVOURITE_EV_ERROR"),b.responseText)})}c.MANUAL_ENTRY?e.getSource().setText(t.oApplicationFacade.getResourceBundle().getText("REMOVE_FAVOURITE")):e.getSource().setText(t.oApplicationFacade.getResourceBundle().getText("ADD_FAVOURITE"))}},{sId:"editButton",sI18nBtnTxt:"EDIT",onBtnPressed:function(e){var a=t.getView().getBindingContext().getPath();a=(t.currentEvaluationObj.COUNTER==2)?a.replace("IS_ACTIVE=1","IS_ACTIVE=0"):a;sap.suite.smartbusiness=sap.suite.smartbusiness||{};sap.suite.smartbusiness.modelerAppCache=sap.suite.smartbusiness.modelerAppCache||{};sap.suite.smartbusiness.modelerAppCache.createSBKPIEvaluation=sap.suite.smartbusiness.modelerAppCache.createSBKPIEvaluation||{};sap.suite.smartbusiness.modelerAppCache.createSBKPIEvaluation.appFromWorkspace=true;if(t.getView().getBindingContext().getObject().COUNTER==2){sap.suite.smartbusiness.utils.appToAppNavigation({action:"createSBKPIEvaluation",route:"editEvaluationDraft",context:("/"+t.contextPath.replace("INDICATORS_MODELER","INDICATORS")+a.replace("EVALUATIONS_MODELER","EVALUATIONS"))})}else if(t.getView().getBindingContext().getObject().COUNTER==1){sap.suite.smartbusiness.utils.appToAppNavigation({action:"createSBKPIEvaluation",route:"editEvaluation",context:("/"+t.contextPath.replace("INDICATORS_MODELER","INDICATORS")+a.replace("EVALUATIONS_MODELER","EVALUATIONS"))})}}},{sId:"deleteButton",sI18nBtnTxt:"DELETE_BUTTON_TEXT",onBtnPressed:function(e){if(!(sap.m.MessageBox)){jQuery.sap.require("sap.m.MessageBox")}sap.m.MessageBox.show(t.oApplicationFacade.getResourceBundle().getText("WARNING_SINGLE_EVALUATION_DELETE"),"sap-icon://hint",t.oApplicationFacade.getResourceBundle().getText("DELETE_BUTTON_TEXT"),[sap.m.MessageBox.Action.OK,sap.m.MessageBox.Action.CANCEL],function(e){if(e=="OK"){var O=t.oApplicationFacade.getODataModel();var p=[];p.push({ID:t.getView().getBindingContext().getObject().ID,IS_ACTIVE:t.getView().getBindingContext().getObject().IS_ACTIVE});sap.suite.smartbusiness.utils.remove(sap.suite.smartbusiness.utils.serviceUrl("EVALUATION_SERVICE_URI"),p,function(d){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("DELETE_EV_SUCCESS"));O.refresh();var h=window.location.hash.replace("evalDetail","detail");sap.suite.smartbusiness.utils.replaceHash({hash:h.substr(0,h.lastIndexOf("/"))},true)},function(a){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("DELETE_EV_ERROR"),a.responseText)})}if(e=="CANCEL"){}})}},{sId:"duplicateButton",sI18nBtnTxt:"DUPLICATE",onBtnPressed:function(e){sap.suite.smartbusiness=sap.suite.smartbusiness||{};sap.suite.smartbusiness.modelerAppCache=sap.suite.smartbusiness.modelerAppCache||{};sap.suite.smartbusiness.modelerAppCache.createSBKPIEvaluation=sap.suite.smartbusiness.modelerAppCache.createSBKPIEvaluation||{};sap.suite.smartbusiness.modelerAppCache.createSBKPIEvaluation.appFromWorkspace=true;sap.suite.smartbusiness.utils.appToAppNavigation({action:"createSBKPIEvaluation",route:"duplicateEvaluation",context:("/"+t.contextPath.replace("INDICATORS_MODELER","INDICATORS")+"/"+t.evalPath.replace("EVALUATIONS_MODELER","EVALUATIONS"))})}},{sId:"addTileButton",sI18nBtnTxt:"ADD_TILE",onBtnPressed:function(e){sap.suite.smartbusiness=sap.suite.smartbusiness||{};sap.suite.smartbusiness.modelerAppCache=sap.suite.smartbusiness.modelerAppCache||{};sap.suite.smartbusiness.modelerAppCache.configureSBKPITile=sap.suite.smartbusiness.modelerAppCache.configureSBKPITile||{};sap.suite.smartbusiness.modelerAppCache.configureSBKPITile.appFromWorkspace=true;sap.suite.smartbusiness.utils.appToAppNavigation({action:"configureSBKPITile",route:"detail",context:("EVALUATIONS_CHIP"+t.evalPath.substr(t.evalPath.indexOf("(")))})}},{sId:"drilldownButton",sI18nBtnTxt:"DRILLDOWN_CONFIG",onBtnPressed:function(e){sap.suite.smartbusiness=sap.suite.smartbusiness||{};sap.suite.smartbusiness.modelerAppCache=sap.suite.smartbusiness.modelerAppCache||{};sap.suite.smartbusiness.modelerAppCache.configureSBKPIDrilldown=sap.suite.smartbusiness.modelerAppCache.configureSBKPIDrilldown||{};sap.suite.smartbusiness.modelerAppCache.configureSBKPIDrilldown.appFromWorkspace=true;sap.suite.smartbusiness.utils.appToAppNavigation({action:"configureSBKPIDrilldown",route:"detail",context:("EVALUATIONS_DDA('"+t.evalContext.getProperty("ID")+"')")})}},{sId:"authUsersButton",sI18nBtnTxt:"AUTH_USERS",onBtnPressed:function(e){sap.suite.smartbusiness=sap.suite.smartbusiness||{};sap.suite.smartbusiness.modelerAppCache=sap.suite.smartbusiness.modelerAppCache||{};sap.suite.smartbusiness.modelerAppCache.authorizeSBEvaluation=sap.suite.smartbusiness.modelerAppCache.authorizeSBEvaluation||{};sap.suite.smartbusiness.modelerAppCache.authorizeSBEvaluation.appFromWorkspace=true;sap.suite.smartbusiness.utils.appToAppNavigation({action:"authorizeSBEvaluation",route:"detail",context:(t.evalPath)})}}]},updateFooterButtons:function(e){e=e||this.getView().getModel("evaluation").getData().EVALUATION;var f=this.getAllFooterButtons();this.oHeaderFooterOptions.buttonList=[];if(e.IS_ACTIVE){this.oHeaderFooterOptions.oEditBtn=f[5];this.oHeaderFooterOptions.buttonList.push(f[6]);this.oHeaderFooterOptions.buttonList.push(f[7])}else{this.oHeaderFooterOptions.oEditBtn=f[0]}if(e.MANUAL_ENTRY){f[1].sI18nBtnTxt=this.oApplicationFacade.getResourceBundle().getText("REMOVE_FAVOURITE")}else{f[1].sI18nBtnTxt=this.oApplicationFacade.getResourceBundle().getText("ADD_FAVOURITE")}this.oHeaderFooterOptions.buttonList.push(f[1]);this.oHeaderFooterOptions.buttonList.push(f[4]);if(e.COUNTER==2){f[2].sI18nBtnTxt=this.oApplicationFacade.getResourceBundle().getText("EDIT_DRAFT")}else{f[2].sI18nBtnTxt=this.oApplicationFacade.getResourceBundle().getText("EDIT")}this.oHeaderFooterOptions.buttonList.push(f[2]);this.oHeaderFooterOptions.buttonList.push(f[3]);this.setHeaderFooterOptions(this.oHeaderFooterOptions)},checkForMandatoryParametersForEvaluation:function(){var t=this;var e=t.evalContext.getObject();var a=[];var w=[];var b={};var c=this.evaluationDetails.EVALUATION_FILTERS;var d=this.evaluationDetails.EVALUATION_VALUES;var f=false;e.ODATA_URL?true:a.push("ERROR_ENTER_ODATA_URL");e.ODATA_ENTITYSET?true:a.push("ERROR_ENTER_ENTITY_SET");e.COLUMN_NAME?true:a.push("ERROR_ENTER_MEASURE");if(e.ODATA_URL&&e.ODATA_ENTITYSET){this.oData4SAPAnalyticsModel=new sap.suite.smartbusiness.odata4analytics.Model(new sap.suite.smartbusiness.odata4analytics.Model.ReferenceByURI(e.ODATA_URL),null);this.queryResultObj=this.oData4SAPAnalyticsModel.findQueryResultByName(e.ODATA_ENTITYSET);if(this.queryResultObj.getParameterization()){b=this.queryResultObj.getParameterization().getAllParameters()}for(var i=0,l=d.length;i<l;i++){if(d[i].TYPE=="TA"){f=true}else if(d[i].TYPE&&(d[i].TYPE.toString().search(/^\d\d$/)==0)){if(d[i].COLUMN_NAME==e.COLUMN_NAME){a.push("ADDI_MEASURE_HAS_MAIN_MEASURE")}}}if(!f){w.push("ERROR_ENTER_TARGET")}for(var i=0,l=c.length;i<l;i++){if(c[i].TYPE=='PA'){if(b[c[i].NAME]&&(c[i].VALUE_1)&&(c[i].VALUE_1!=0)){delete b[c[i].NAME]}}}if(Object.keys(b).length){a.push("ERROR_ENTER_ALL_INPUT_PARAMETERS")}}return{error:a,warning:w}},formatFilterValue:function(v){if(!v)return v;var a=v.split(",");pattern=/^[1-9][0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])T([0-1][0-9]|2[0-3])(:[0-5][0-9]){2}[.][0-9]{3}Z$/;if(!pattern.test(a[0]))return v;var d=[];for(var k in a)d.push(new Date(a[k]).toString());return d.join(",")},activateEvaluation:function(){var t=this;var p={};var e="ACTIVE_EVALUATIONS";var P=t.getView().getBindingContext().sPath;var i=t.getView().getBindingContext().getProperty("MANUAL_ENTRY");p.ID=P.substring((P.indexOf("'")+1),P.lastIndexOf("'"));var O=t.oApplicationFacade.getODataModel();sap.suite.smartbusiness.utils.create(sap.suite.smartbusiness.utils.serviceUrl("ACTIVATE_EVALUATION_SERVICE_URI"),p,null,function(d){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("ACTIVATE_EV_SUCCESS"));O.refresh();sap.suite.smartbusiness.utils.replaceHash({hash:window.location.hash.replace("IS_ACTIVE=0","IS_ACTIVE=1")},true);t.byId("evalStatus").setText(t.oApplicationFacade.getResourceBundle().getText("STATUS_ACTIVE"));t.byId("evalStatus").setState(sap.ui.core.ValueState.Success);t.setHeaderFooterOptions(t.oHeaderFooterOptions)},function(a){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ACTIVATE_EV_ERROR"),a.responseText)})}})};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.drilldown.Component')){jQuery.sap.declare("sap.suite.ui.smartbusiness.drilldown.Component");jQuery.sap.require('sap.ca.scfld.md.ComponentBase');sap.ca.scfld.md.ComponentBase.extend("sap.suite.ui.smartbusiness.drilldown.Component",{metadata:sap.ca.scfld.md.ComponentBase.createMetaData("FS",{"name":"Smart Business Generic Drilldown","version":"1.0.0","library":"sap.suite.ui.smartbusiness.drilldown","includes":["lib/AllLibrary.js"],"dependencies":{"libs":["sap.m","sap.ca.ui"],"components":[]},config:{resourceBundle:"i18n/i18n.properties",titleResource:"SAP Smart Business",fullWidth:true},viewPath:"sap.suite.ui.smartbusiness.drilldown.view",fullScreenPageRoutes:{"fullscreen":{"pattern":":all*:","view":"Drilldown"}},}),createContent:function(){var m=jQuery.sap.getModulePath("sap.suite.ui.smartbusiness.drilldown");jQuery.sap.require("sap.ca.ui.utils.Lessifier");sap.ca.ui.utils.Lessifier.lessifyCSS("sap.suite.ui.smartbusiness.drilldown","css/colors.css");jQuery.sap.includeStyleSheet(m+"/css/override.css");try{var v=this.getComponentData().startupParameters;v.component=this}catch(e){v={};v.component=this;jQuery.sap.log.error("Startup Parameters not found!!")}return sap.ui.view({viewName:"sap.suite.ui.smartbusiness.drilldown.view.Main",type:sap.ui.core.mvc.ViewType.XML,viewData:v})}})};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.drilldown.Configuration')){jQuery.sap.declare("sap.suite.ui.smartbusiness.drilldown.Configuration");jQuery.sap.require('sap.ca.scfld.md.ConfigurationBase');jQuery.sap.require('sap.ca.scfld.md.app.Application');sap.ca.scfld.md.ConfigurationBase.extend("sap.suite.ui.smartbusiness.drilldown.Configuration",{getServiceParams:function(){return[]},getServiceList:function(){return[]}})};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.drilldown.lib.Configuration')){jQuery.sap.declare("sap.suite.ui.smartbusiness.drilldown.lib.Configuration");sap.suite=sap.suite||{};sap.suite.smartbusiness=sap.suite.smartbusiness||{};sap.suite.smartbusiness.drilldown=(function(){var _={};var b=function(u){return jQuery.sap.encodeURL(u)};var t=function(s){if(s){return s.trim()}return s};var H=function(o){this.oHeader=o;this.oHeader.CONFIGURATION=t(this.oHeader.CONFIGURATION);if(this.oHeader.CONFIGURATION){var a=this.oHeader.CONFIGURATION;try{tempObject=JSON.parse(a);for(var i in tempObject){tempObject[i]=JSON.parse(tempObject[i])}this.oHeader.PARSED_CONFIGURATION=tempObject}catch(e){jQuery.sap.log.error("Error Parsing Drilldown Header Configuration");this.oHeader.PARSED_CONFIGURATION=null}}else{this.oHeader.PARSED_CONFIGURATION=null}};H.prototype={getVisualizationType:function(){return this.oHeader.VISUALIZATION_TYPE},getReferenceEvaluationId:function(){return this.oHeader.REFERENCE_EVALUATION_ID},getConfigurationId:function(){return this.oHeader.CONFIGURATION_ID},getEvaluationId:function(){return this.oHeader.EVALUATION_ID},getVisualizationOrder:function(){return this.oHeader.VISUALIZATION_ORDER},isVisible:function(){return this.oHeader.VISIBILITY==1},isAssociated:function(){if(this.getReferenceEvaluationId()){if(this.getReferenceEvaluationId()!==this.getEvaluationId()){return true}}return false},isDimensionRequired:function(){return this.getVisualizationType()=="TREND"||this.getVisualizationType()=="COMPARISION"},getDimension:function(){return this.oHeader.DIMENSION},getTileConfiguration:function(){return this.oHeader.PARSED_CONFIGURATION},getVisibility:function(){return this.oHeader.VISIBILITY}};var C=function(o){this.oChart=o};C.prototype={getValueType:function(){return this.oChart.VALUE_TYPE},getAxisType:function(){return this.oChart.AXIS_TYPE},getChartType:function(){var a=this;return{isBar:function(){return a.oChart.CHART_TYPE.toUpperCase()=="BAR"},isColumn:function(){return a.oChart.CHART_TYPE.toUpperCase()=="COLUMN"},isLine:function(){return a.oChart.CHART_TYPE.toUpperCase()=="LINE"},isCombination:function(){return a.oChart.CHART_TYPE.toUpperCase()=="COMBINATION"},isTable:function(){return a.oChart.CHART_TYPE.toUpperCase()=="TABLE"},isBubble:function(){return a.oChart.CHART_TYPE.toUpperCase()=="BUBBLE"},getText:function(){return a.oChart.CHART_TYPE}}},getColorScheme:function(){var a=this;return{getText:function(){return a.oChart.COLOR_SCHEME},isManual:function(){return a.oChart.COLOR_SCHEME=="MANUAL_NON_SEMANTIC"||a.oChart.COLOR_SCHEME=="MANUAL_SEMANTIC"},isManualSemantic:function(){return a.oChart.COLOR_SCHEME=="MANUAL_SEMANTIC"},isManualNonSematic:function(){return a.oChart.COLOR_SCHEME=="MANUAL_NON_SEMANTIC"},isAutoSemantic:function(){return a.oChart.COLOR_SCHEME=='AUTO_SEMANTIC'}}},getThresholdMeasure:function(){return this.oChart.THRESHOLD_MEASURE},getDataLimit:function(){return this.oChart.DATA_LIMIT},isAbsoluteValue:function(){return this.getValueType()=="ABSOLUTE"},isPercentageValue:function(){return this.getValueType()=="PERCENTAGE"},isSingleAxis:function(){return this.getAxisType()=="SINGLE"},isDualAxis:function(){return this.getAxisType()=="DUAL"},isStackingEnabled:function(v){var a=false;var e=v.getColumns();e.forEach(function(i){var o=v.findColumnByName(i);if(o.isStacked()){a=true;return false}});return a}};var c=function(){};c.prototype={getName:function(){return this.oParam.NAME},getSortBy:function(){return this.oParam.SORT_BY},getSortOrder:function(){return this.oParam.SORT_ORDER},getType:function(){return this.oParam.TYPE},getVisibility:function(){return this.oParam.VISIBILITY},isVisibleInChart:function(){return this.oParam.VISIBILITY=="BOTH"||this.oParam.VISIBILITY=="CHART"},isVisibleInTable:function(){return this.oParam.VISIBILITY=="BOTH"||this.oParam.VISIBILITY=="TABLE"},getColor:function(){return this.oParam.COLOR},isStacked:function(){return this.oParam.STACKING==1},getStacking:function(){return this.oParam.STACKING},isDimension:function(){return this.getType().toUpperCase()=="DIMENSION"},isMeasure:function(){return this.getType().toUpperCase()=="MEASURE"},getAxis:function(){return this.oParam.AXIS}};var D=function(p){this.oParam=p};D.prototype=new c();var M=function(p){this.oParam=p};M.prototype=new c();var F=function(p){this.oFilter=p};F.prototype={getName:function(){return this.oFilter.DIMENSION},isVisible:function(){return this.oFilter.VISIBILITY==1}};var V=function(p){this._viewId=p.CONFIGURATION_ID;this._evaluationId=p.EVALUATION_ID;this._title=p.TEXT;this._order=p.CONFIG_ORDER;this._columns=[];this._dimensions=[];this._measures=[];this._dimensionMap={};this._measureMap={};this._chartConfig=[]};V.prototype={getTitle:function(){return this._title},getId:function(){return this._viewId},getEvaluationId:function(){return this._evaluationId},getViewOrder:function(){return this._order},getColumns:function(){return this._columns},getDimensions:function(){return this._dimensions},getDimensionCount:function(){return this._dimensions.length},getMeasures:function(){return this._measures},getMeasureCount:function(){return this._measures.length},findDimensionByName:function(a){if(this._dimensionMap[a]){return this._dimensionMap[a]}else{throw new Error("Invalid Dimension Name : "+a)}},findMeasureByName:function(m){if(this._measureMap[m]){return this._measureMap[m]}else{throw new Error("Invalid Dimension Name : "+m)}},findColumnByName:function(a){if(this._dimensionMap[a]){return this._dimensionMap[a]}else if(this._measureMap[a]){return this._measureMap[a]}else{throw new Error("Invalid Column Name : "+a)}},getChartConfiguration:function(){return this._chartConfig}};var d=function(e,j){this.evaluationId=e;this._batchResponse=j;var k=null;var m={};var n=[];var o=-1;this._filters=[];this._filterMap={};this._headers=[];var p=function(q,r,s,u,w,x){q.forEach(function(v,i,a){var A=v.CONFIGURATION_ID;if(A){o++;n.push(A);var O=new V(v);m[A]=O;if(o==0){k=A}V.setDimensionAndMeasures(w,O);V.setChart(x,O)}});var S=d.Constants;for(var y in S){var z=S[y].func;if(jQuery.sap.startsWith(z,"is")){d.prototype[z]=function(){return true}}else{d.prototype[z]=function(){return null}}}r.forEach(function(v,i,a){var A=S[v.PROPERTY_TYPE];if(A){var z=A.func;if(jQuery.sap.startsWith(z,"is")){d.prototype[z]=function(){return v.VISIBILITY==1}}else{d.prototype[z]=function(){return v.PROPERTY_VALUE}}}else{jQuery.sap.log.error("Unknown Property_Name : "+v.PROPERTY_TYPE)}},this);if(u.length){u.forEach(function(v,i,a){this._filters.push(v.DIMENSION);this._filterMap[v.DIMENSION]=new F(v)},this)}if(s.length){s.forEach(function(v,i,a){this.getHeaders().push(new H(v))},this)}};this.getFilters=function(){return this._filters};this.getHeaders=function(){return this._headers};this.getMaxViewOrder=function(){var a=0;for(var v in m){a=Math.max(a,m[v].getViewOrder())}return a};this.findViewById=function(i){if(m[i]){return m[i]}return null},this.getDefaultViewId=function(){return k},this.getDefaultView=function(){if(k){return m[k]}return null};this.removeViewById=function(v){delete m[v]};this.getAllViews=function(){var v=[];n.forEach(function(a){v.push({ID:a,TITLE:this.findViewById(a).getTitle()||"-NA- ("+a+")"})},this);return v};p.call(this,this._batchResponse[0].data.results,this._batchResponse[1].data.results,this._batchResponse[2].data.results,this._batchResponse[3].data.results,this._batchResponse[4].data.results,this._batchResponse[5].data.results)};d.Constants={SAP_FILTER:{desc:"Flag whether filter is enabled",func:"isFilterEnabled"},SAP_HEADER:{desc:"Flag whether header is enabled",func:"isHeaderEnabled"},SAP_AGGREGATE_VALUE:{desc:"Flag whether aggregate kpi value is enabled",func:"isAggregateValueEnabled"},QUERY_SERVICE_URI:{desc:"Evaluation Query Service Uri",func:"getQueryServiceUri"},QUERY_ENTITY_SET:{desc:"Result path for the query service uri",func:"getEntitySet"}};V.setDimensionAndMeasures=function(o,T){o.forEach(function(v,i,a){if(v.CONFIGURATION_ID==this.getId()){this._columns.push(v.NAME);if(v.TYPE.toUpperCase()=="MEASURE"){this._measureMap[v.NAME]=new M(v);this._measures.push(v.NAME)}else if(v.TYPE.toUpperCase()=="DIMENSION"){this._dimensionMap[v.NAME]=new D(v);this._dimensions.push(v.NAME)}}},T)};V.setChart=function(o,T){if(o.length){o.forEach(function(v,i,a){if(this.getId()==v.CONFIGURATION_ID){this.getChartConfiguration().push(new C(v))}},T)}};var f=function(e){var T={TT:"Area Chart Tile",CT:"Comparison Tile",NT:"Numeric Tile",AT:"Bullet Tile"};var a={name:e,children:[]};var i=this.getAllViews();for(var j in i){var k={name:i[j].TITLE||"NA",children:[]};var v=this.findViewById(i[j].ID);var m={name:"*Configuration",children:[]};k.children.push(m);m.children.push({name:"Filter Enabled : "+this.isFilterEnabled()});m.children.push({name:"Kpi Aggregate Value Enabled: "+this.isAggregateValueEnabled()});m.children.push({name:"Header Enabled : "+this.isHeaderEnabled()});m.children.push({name:"OData Service Uri : "+this.getQueryServiceUri()});m.children.push({name:"Entity Set : "+this.getEntitySet()});var n=this.getFilters();var o={name:"*Filters("+n.length+")",children:[]};k.children.push(o);n.forEach(function(z){o.children.push({name:z})});var p=v.getChartConfiguration().length?v.getChartConfiguration()[0]:null;var q={name:"*Chart",children:[]};k.children.push(q);if(p){q.children.push({name:"Type : "+p.getChartType().getText()});q.children.push({name:"Color Scheme : "+p.getColorScheme().getText()});q.children.push({name:"Value Type : "+p.getValueType()});q.children.push({name:"Axis Type : "+p.getAxisType()});q.children.push({name:"Data Limit : "+(p.getDataLimit()||"NA")});q.children.push({name:"Stacking Enabled : "+p.isStackingEnabled(v)});q.children.push({name:"Threshold Measure : "+p.getThresholdMeasure()})}else{q.children.push({name:"Oops!!!NO Chart Configuration"})}var r=v.getMeasures();var s={name:"*Measures("+r.length+")",children:[]};k.children.push(s);r.forEach(function(z,A,B){var E={name:z,children:[]};s.children.push(E);var G=v.findMeasureByName(z);E.children.push({name:"Color : "+(G.getColor()||"NA")});E.children.push({name:"Sort By : "+G.getSortBy()});E.children.push({name:"Sort Order : "+G.getSortOrder()});E.children.push({name:"Visible in Table : "+G.isVisibleInTable()});E.children.push({name:"Axis : "+G.getAxis()});E.children.push({name:"Is Stacked :"+G.isStacked()})},this);var u=v.getDimensions();var w={name:"*Dimensions("+u.length+")",children:[]};k.children.push(w);u.forEach(function(z,A,B){var E={name:z,children:[]};w.children.push(E);var G=v.findDimensionByName(z);E.children.push({name:"Sort By : "+G.getSortBy()});E.children.push({name:"Sort Order : "+G.getSortOrder()});E.children.push({name:"Visible in Table : "+G.isVisibleInTable()});E.children.push({name:"Axis :"+G.getAxis()});E.children.push({name:"Is Stacked :"+G.isStacked()})},this);var x=this.getHeaders();var y={name:"*Kpi_Headers("+x.length+")",children:[]};k.children.push(y);x.forEach(function(j,z){var A={name:z+1+"",children:[]};y.children.push(A);A.children.push({name:"Type : "+T[j.getVisualizationType()],});A.children.push({name:"Reference Evaluation : "+j.getReferenceEvaluationId(),});A.children.push({name:"Dimension : "+(j.getDimension()||"NA"),});A.children.push({name:"isAssociatedOrOtherEvaluation : "+j.isAssociated(),})});a.children.push(k)}return a};var g=function(p){var k=p.id;return k};var h=function(e){var a=[];var m=[];var v=[];var n=parseInt(e.results[0].FILTERS_COUNT)||1;var o=parseInt(e.results[0].VALUES_COUNT)||1;var p=n*o;for(var i=0;i<e.results.length;i+=p){var q=parseInt(e.results[i].FILTERS_COUNT)||1;var o=parseInt(e.results[i].VALUES_COUNT)||1;var p=q*o;var r={};r.keys={};r.keys.VALUES={};r.keys.VALUES.results=[];r.keys.FILTERS={};r.keys.FILTERS.results=[];r.keys.ID=e.results[i].ID;r.keys.DESCRIPTION=e.results[i].DESCRIPTION;r.keys.ACTION=e.results[i].ACTION;r.keys.INDICATOR=e.results[i].INDICATOR;r.keys.INDICATOR_TITLE=e.results[i].INDICATOR_TITLE;r.keys.TITLE=e.results[i].TITLE;r.keys.NAME=e.results[i].NAME;r.keys.SCALING=e.results[i].SCALING;r.keys.ODATA_URL=e.results[i].ODATA_URL;r.keys.ODATA_ENTITYSET=e.results[i].ODATA_ENTITYSET;r.keys.VIEW_NAME=e.results[i].VIEW_NAME;r.keys.COLUMN_NAME=e.results[i].COLUMN_NAME;r.keys.OWNER_NAME=e.results[i].OWNER_NAME;r.keys.OWNER_E_MAIL=e.results[i].OWNER_E_MAIL;r.keys.OWNER_ID=e.results[i].OWNER_ID;r.keys.PROPERTIES=e.results[i].PROPERTIES||{};r.keys.ODATA_PROPERTY=e.results[i].ODATA_PROPERTY;r.keys.SEMANTIC_OBJECT=e.results[i].SEMANTIC_OBJECT;r.keys.VALUES_SOURCE=e.results[i].VALUES_SOURCE;r.keys.INDICATOR_TYPE=e.results[i].INDICATOR_TYPE;r.keys.GOAL_TYPE=e.results[i].GOAL_TYPE;for(var j=i;j<o+i;j++){if(parseInt(e.results[i].VALUES_COUNT)){var s={};s.TYPE=e.results[j].TYPE;s.FIXED=e.results[j].FIXED;s.COLUMN_NAME=e.results[j].COLUMN_NAME_1;s.ODATA_PROPERTY=e.results[j].ODATA_PROPERTY_1;s.ID=e.results[j].ID;r.keys.VALUES.results.push(s)}}for(var k=i;k<p+i;k+=o){if(parseInt(e.results[i].FILTERS_COUNT)){var u={};u.ID=e.results[k].ID;u.NAME=e.results[k].NAME;u.OPERATOR=e.results[k].OPERATOR;u.TYPE=e.results[k].TYPE_1;u.VALUE_1=e.results[k].VALUE_1;u.VALUE_2=e.results[k].VALUE_2;r.keys.FILTERS.results.push(u)}}a.push(r.keys)}return a};var l=function(s,a){if(sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService){var u=sap.ushell.Container.getService("URLParsing");s=u.addSystemToServiceUrl(s,a)}return s};return{getConfigurationTree:function(e,s,a){this.loadConfiguration({evaluationId:e,cache:true,success:function(i){var d=this.parse(e,i);s.call(null,f.apply(d,["Evaluation"]))},error:function(i){jQuery.sap.log.error("Error Fetching Drilldown Configuration")},context:this})},parse:function(e,a){return new d(e,a)},getConfigurationFromCache:function(e){return _[e]},loadConfiguration:function(p){var e=p.evaluationId;var a=!!p.cache;if(_[e]&&a){p.success.call(p.context||null,_[e])}else{var o=null;var s="/sap/hba/r/sb/core/odata/runtime/SMART_BUSINESS.xsodata";s=l(s,p.sapSystem);if(sap.suite.smartbusiness.odata){o=sap.suite.smartbusiness.odata.getModelByServiceUri(s)}else{o=new sap.ui.model.odata.ODataModel(s,true)}o.setTokenHandlingEnabled(false);var m="/DDA_MASTER?$filter="+b("EVALUATION_ID eq '"+e+"'")+"&$orderby=CONFIG_ORDER";var i="/DDA_CONFIG?$filter="+b("EVALUATION_ID eq '"+e+"'");var j="/DDA_HEADER?$filter="+b("EVALUATION_ID eq '"+e+"'")+"&$orderby=VISUALIZATION_ORDER";var k="/DDA_FILTERS?$filter="+b("EVALUATION_ID eq '"+e+"'");var n="/DDA_COLUMNS?$filter="+b("EVALUATION_ID eq '"+e+"'")+"&$orderby=COLUMNS_ORDER";var q="/DDA_CHART?$filter="+b("EVALUATION_ID eq '"+e+"'");var r=o.createBatchOperation(m,"GET");var u=o.createBatchOperation(i,"GET");var v=o.createBatchOperation(j,"GET");var w=o.createBatchOperation(k,"GET");var x=o.createBatchOperation(n,"GET");var y=o.createBatchOperation(q,"GET");o.addBatchReadOperations([r,u,v,w,x,y]);var z=o.submitBatch(function(A,B){var E=A.__batchResponses;_[e]=E;p.success.call(p.context||null,E)},function(A){jQuery.sap.log.error("Failed to fetch DDA Configuration");if(p.error){p.error.call(p.context||null,A)}},true);return z}},setEvaluationsCache:function(p,a){var e=this;if(!p.evalIdArray){throw new Error("Evaluation Id Not Found")}var j=g(p);var m=null;var u=sap.ushell.Container.getService("URLParsing");var s=u.addSystemToServiceUrl("/sap/hba/r/sb/core/odata/runtime/SMART_BUSINESS.xsodata",p.sapSystem);if(sap.suite.smartbusiness.odata){m=sap.suite.smartbusiness.odata.getModelByServiceUri(s)}else{m=new sap.ui.model.odata.ODataModel(s,true)}var k="";p.evalIdArray.forEach(function(i){var j=i;var q=sap.suite.smartbusiness.cache.getEvaluationById(j);if(!q)k+="ID eq '#EVALUATION_ID' or ".replace("#EVALUATION_ID",j)});if(k){k=k.slice(0,-4);var o={};o["$filter"]=k;o["$orderby"]="ID,NAME";var n=m.read("/EVALUATIONS_CORE",null,o,true,function(q){if(q.results&&q.results.length){var r=h(q);for(var i=0;i<r.length;i++)sap.suite.smartbusiness.cache.setEvaluationById(r[i].ID,r[i]);p.success.call(p.context||null)}else{jQuery.sap.log.error("Empty Evaluation returned");p.success.call(p.context||null)}},function(){jQuery.sap.log.error("Error fetching Evaluations");p.success.call(p.context||null)});return n}else{p.success.call(p.context||null);return null}},getEvaluationById:function(p){if(!p.id){throw new Error("Evaluation Id Not Found")}var a=g(p);if(p.cache){var e=sap.suite.smartbusiness.cache.getEvaluationById(a);if(e){if(p.success){p.success.call(p.context||null,e);return null}}}var m=null;var u=sap.ushell.Container.getService("URLParsing");var s=u.addSystemToServiceUrl("/sap/hba/r/sb/core/odata/runtime/SMART_BUSINESS.xsodata",p.sapSystem);if(sap.suite.smartbusiness.odata){m=sap.suite.smartbusiness.odata.getModelByServiceUri(s)}else{m=new sap.ui.model.odata.ODataModel(s,true)}var i="ID eq '#EVALUATION_ID'".replace("#EVALUATION_ID",p.id);var j=null;var o={};o["$filter"]=i;var k="";if(p.filters){k+="FILTERS,"}if(p.thresholds){k+="VALUES,"}if(k){o["$expand"]=k.substring(0,k.length-1)}var n=m.read("/EVALUATIONS",null,o,true,function(q){if(q.results&&q.results.length){j=q.results[0];sap.suite.smartbusiness.cache.setEvaluationById(a,j);p.success.call(p.context||null,j)}else{p.error.call(p.context||null,"Empty Results with EvaluationID : "+p.id)}},function(){jQuery.sap.log.error("Error fetching Evaluation : ",p.id);if(p.error){p.error.apply(p.context||null,arguments)}});return n}}})()};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.drilldown.lib.CustomTable')){jQuery.sap.declare("sap.suite.ui.smartbusiness.drilldown.lib.CustomTable");sap.m.Table.extend("sap.suite.ui.smartbusiness.drilldown.lib.CustomTable",{metadata:{properties:{actionItems:{type:"any",multiple:true}}},renderer:{}});sap.suite.ui.smartbusiness.drilldown.lib.CustomTable.prototype.init=function(){sap.m.Table.prototype.init.apply(this);this._selectedContext=[];var c=new sap.m.Bar({contentMiddle:[new sap.m.Label({text:"{i18n>TABLE_POPOVER_HEADING}"})],contentRight:(jQuery.device.is.phone)?[]:[new sap.m.Button({icon:"sap-icon://decline",width:"2.375rem",press:jQuery.proxy(this._closePopover,this)})]});this._popOver=new sap.m.ResponsivePopover({modal:false,enableScrolling:true,verticalScrolling:true,horizontalScrolling:false,placement:sap.m.PlacementType.Auto,contentWidth:"18rem",customHeader:c});var s=sap.ui.getCore().getUIArea(sap.ui.getCore().getStaticAreaRef());s.addContent(this._popOver,true)};sap.suite.ui.smartbusiness.drilldown.lib.CustomTable.prototype._closePopover=function(){if(this._popOver.isOpen()){this._popOver.close()}};sap.suite.ui.smartbusiness.drilldown.lib.CustomTable.prototype.setPopoverFooter=function(c){this._popOver.removeAllContent();this._popOver.addContent(c)};sap.suite.ui.smartbusiness.drilldown.lib.CustomTable.prototype.onBeforeRendering=function(){this._popOver.getCustomHeader().getContentMiddle()[0].setText(this.getModel("i18n").getProperty("TABLE_POPOVER_HEADING"));this.attachSelectionChange(function(e){var a=e.getParameters().listItems[0];this.popoverOpenAt=a;var s=[];var i=this.getSelectedItems();var c=this.getColumns();if(i.length){var b=i[0];var d=b.getBindingContext().getObject();var o={};for(var f in d){o[f]=d[f]}s.push(o);this.setSelectedContext(s);if(true||this._notEmpty()){this._popOver.openBy(a.getCells()[parseInt(a.getCells().length/2)||0],false)}}else{this._closePopover()}})};sap.suite.ui.smartbusiness.drilldown.lib.CustomTable.prototype._notEmpty=function(){var c=this._popOver.getContent();var n=false;if(c&&c.length>0){var b=c[0];var l=b.getItems();l.forEach(function(a){if(a.getItems().length>0){n=true;return false}})}return n};sap.suite.ui.smartbusiness.drilldown.lib.CustomTable.prototype.setSelectedContext=function(s){this._selectedContext=s};sap.suite.ui.smartbusiness.drilldown.lib.CustomTable.prototype.getSelectedContext=function(s){return this._selectedContext}};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.drilldown.lib.Hash')){jQuery.sap.declare("sap.suite.ui.smartbusiness.drilldown.lib.Hash");sap.suite=sap.suite||{};sap.suite.smartbusiness=sap.suite.smartbusiness||{};sap.suite.smartbusiness.url=sap.suite.smartbusiness.url||{};sap.suite.smartbusiness.url.hash=(function(){var o=null;var n=null;var b=null,c=null,d=null,e=null;var H=null;var f="|^",g=/\|\^/g;function r(){b=null,c=null,d=null,e=null;H=null}function h(a){var s={};if(a){var B=a.split("/");for(var i=1;i<B.length;i++){var C=B[i];var D=C.split("=");if(s[D[0]]){}else{s[D[0]]=[]}if(D[1]){var E=decodeURIComponent(D[1]).split(",");var F=s[D[0]];for(var j=0;j<E.length;j++){if(F.indexOf(E[j])==-1){E[j]=E[j].replace(g,",");F.push(E[j])}}}}}return s}function k(a){var j={};if(a){var s=a.split("&");for(var i=0;i<s.length;i++){var B=s[i];var C=B.split("=");if(j[C[0]]){}else{j[C[0]]=[]}var D=j[C[0]];if(D.indexOf(C[1])==-1){D.push(C[1])}}}return j}function p(n){n=n||window.location.hash;if(n){var a=/^(?:#|)([\S\s]*?)(&\/[\S\s]*)?$/;var i=a.exec(n);var j=i[1];var s=i[2];var B=/^([A-Za-z0-9_]+)-([A-Za-z0-9_]+)[\?]?(.*)/;if(j){var C=B.exec(j);b=C[1];c=C[2];d=k(C[3])}e=h(s)}}function _(){};if(window.addEventListener){}function l(){var j="";if(b){j+=b}if(c&&b){j+="-"+c}if(d){j+="?";for(var B in d){var C=d[B];for(var i=0;i<C.length;i++){j+=B+"="+C[i]+"&"}}j=j.substring(0,j.length-1)}if(e){var C="";for(var B in e){if(e[B]instanceof Array){e[B].forEach(function(s,i,a){a[i]=(s+"").replace(/,/g,f)})}C+=B+"="+encodeURIComponent(e[B])+"/"}if(C.length){C=C.substring(0,C.length-1);C="&/"+C}j+=C}return j};function m(){return l()};function u(){var s=l();window.location.hash=s;H=s;p()}p();function q(O,U){if(typeof U=='undefined'){U=true}U=!!U;b=O;if(U){u()}}function t(a,U){if(typeof U=='undefined'){U=true}U=!!U;c=a;if(U){u()}}function v(a,U){if(typeof U=='undefined'){U=true}U=!!U;d=a;if(U){u()}}function w(a,U){if(typeof U=='undefined'){U=true}if(d&&d[a]){d[a]=null;delete d[a]}if(U){u()}}function x(a,U){if(typeof U=='undefined'){U=true}U=!!U;e=a;if(U){u()}}function y(a,U){if(typeof U=='undefined'){U=true}if(e&&e[a]){e[a]=null;delete e[a]}if(U){u()}}function z(a,U){if(typeof U=='undefined'){U=true}U=!!U;if(!d){d=a}else{for(var i in a){var s=a[i];if(!d[i]){d[i]=[]}var B=d[i];for(var j=0;j<s.length;j++){if(B.indexOf(s[j]+"")==-1){B.push(s[j]+"")}}}}if(U){u()}}function A(a,U){if(typeof U=='undefined'){U=true}U=!!U;if(!e){e=a}else{for(var i in a){var s=a[i];if(!jQuery.isArray(s)){s=[s]}if(!e[i]){e[i]=[]}var B=e[i];for(var j=0;j<s.length;j++){if(B.indexOf(s[j]+"")==-1){B.push(s[j]+"")}}}}if(U){u()}}return{getSemanticObject:function(){r();p(window.location.hash);return b},getAction:function(){r();p(window.location.hash);return c},getStartupParameters:function(){r();p(window.location.hash);return d},getApplicationParameters:function(a){r();p(window.location.hash);if(a&&a.length){a.forEach(function(i){delete e[i]})}return e},setSemanticObject:function(O,U){q(O,U);return this},setAction:function(c,U){t(c,U);return this},setStartupParameters:function(a,U){v(a,U);return this},updateStartupParameters:function(a,U){z(a,U);return this},removeStartupParameter:function(a,U){w(a,U);return this},setApplicationParameters:function(a,U){x(a,U);return this},updateApplicationParameters:function(a,U){A(a,U);return this},removeApplicationParameter:function(a,U){y(a,U);return this},getUrlParameters:function(){return jQuery.sap.getUriParameters()},updateHash:function(){u()},getHash:function(){return m()}}})()};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.drilldown.lib.MiniChartManager')){jQuery.sap.declare("sap.suite.ui.smartbusiness.drilldown.lib.MiniChartManager");sap.suite=sap.suite||{};sap.suite.smartbusiness=sap.suite.smartbusiness||{};sap.suite.smartbusiness.miniChartManager=(function(){"use strict";var h=[];var V={NT:"Numeric",CT:"Comparison",AT:"Bullet",TT:"AreaChart",CM:"MeasureComparison"};var a={"NT":4,"AT":3,"CT":2,"TT":1,"CM":0};var u=sap.ushell.Container.getService("URLParsing");var g=function(p,o){var e="";if(o.isAssociated())e=o.getReferenceEvaluationId();else e=o.getReferenceEvaluationId();var r=[];var d="";if(sap.suite.smartbusiness.cache.getEvaluationById(e))d=sap.suite.smartbusiness.cache.getEvaluationById(e).ODATA_URL;if(d){var U=u.addSystemToServiceUrl(sap.suite.smartbusiness.cache.getEvaluationById(e).ODATA_URL,p.sapSystem);var b=sap.suite.smartbusiness.cache.getEvaluationById(e).ODATA_ENTITYSET;var c=sap.suite.smartbusiness.odata.getAllDimensions(U,b);for(var i=0;i<p.urlFilters.length;i++){if(c.indexOf(p.urlFilters[i].NAME)!=-1)r.push(p.urlFilters[i])}}return r};return{renderHeaders:function(p){if(p.allTiles.length){var b=p.allTiles;h=[];b.forEach(function(o){var t=o.getVisualizationType();if(V[t]){var c=V[t];jQuery.sap.require("sap.suite.ui.smartbusiness.tiles."+c);if(sap.suite.ui.smartbusiness.tiles[c]){var f=g(p,o);var d=new sap.suite.ui.smartbusiness.tiles[c]({dimension:o.getDimension(),evaluationId:o.getEvaluationId(),associationEvaluationId:o.getReferenceEvaluationId(),sapSystem:p.sapSystem,additionalFilters:f,tileConfiguration:o.getTileConfiguration()}).addStyleClass("drilldownKpiTiles");h.push(d);var e=new sap.suite.ui.commons.HeaderCellItem();var i=new sap.suite.ui.commons.HeaderCell();p.headerContainer.addItem(d);if(p.urlFilters.length){if(f&&f.length){}else{d.setVisible(false);d.setClick(false)}}}else{jQuery.sap.log.error("Ignoring the tile "+c+" : Not Implemented Yet")}}else{jQuery.sap.log.error("No Tile Mapping  for Visualisation Type : "+t)}})}},hashChangeListner:function(p){if(p.firstTimeFlag){var b=[];var c=p.allTiles;for(var i=0;i<c.length;i++){var d=null;var o=c[i];var e=h[i];e.abortODataCalls();var f=g(p,o);if(p.urlFilters.length){if(f&&f.length){e.$().css("opacity","1");e.setAdditionalFilters(f);e.$().off("click")}else{e.$().css("opacity","0.2");e.$().click(function(){return false})}}else{e.$().css("opacity","1");e.setAdditionalFilters(f);e.$().off("click")}}}},}})()};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.drilldown.lib.Navigation')){jQuery.sap.declare("sap.suite.ui.smartbusiness.drilldown.lib.Navigation");sap.suite=sap.suite||{};sap.suite.smartbusiness=sap.suite.smartbusiness||{};sap.suite.smartbusiness.navigation=(function(){var a={};var _={};function b(s,c,d){var e="/GetLinksForSemanticObject?semanticObject='"+s+"'";var f="";if(d&&Object.keys(d).length){var f="";for(var k in d){f+=k+"="+d[k]+"&"}f=encodeURIComponent(f.substring(0,f.length-1));f="&businessParams='"+f+"'"}else if(c&&c.length){for(var i=0;i<c.length;i++){f+=c[i]+"=1&"}f=encodeURIComponent(f.replace(/&$/g,""));f="&businessParams='"+f+"'"}return e+f}return{getLinksBySemanticObject:function(p){var t=this;var d=new sap.ui.model.odata.ODataModel("/sap/opu/odata/UI2/INTEROP",true);var s=b(p.semanticObject,p.dimensions,p.businessParam);var c=d.read(s,null,null,true,function(e){p.success.call(p.context||null,e.results)},function(){jQuery.sap.log.error("Error fetching getLinksBySemanticObject : "+p.semanticObject);p.success.call(p.context||null,[])},!!p.async);return c},getLinksByContext:function(p){var o=[];if(p.viewId&&_[p.viewId]){p.success.call(p.context||null,_[p.viewId])}else{var s=[p.semanticObject],l=[];p.dimensions=p.dimensions||[];s=s.concat(p.dimensions);var c=s.length;if(c){for(var i=0;i<s.length;i++){var d=this.getLinksBySemanticObject({async:true,semanticObject:s[i],dimensions:p.dimensions,success:function(e){l=l.concat(e);if(--c==0){_[p.viewId]=l;p.success.call(p.context||null,l)}},error:function(){if(--c==0){_[p.viewId]=l;p.success.call(p.context||null,l)}}});o.push(d)}}else{p.success.call(p.context||null,[])}}return o}}})()};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.drilldown.lib.Performance')){jQuery.sap.declare("sap.suite.ui.smartbusiness.drilldown.lib.Performance");sap.suite.ui.smartbusiness.drilldown.lib.Performance=function(p){this.oParam=p;this._init()};sap.suite.ui.smartbusiness.drilldown.lib.Performance.prototype={_processData:function(j){var d=[];for(var e in j){var D=j[e];d.push({"TimeTaken":(D.time)/1000,"Call":D.title})}return d},_init:function(){var t=this;this._dataSet=new sap.viz.ui5.data.FlattenedDataset({data:{path:"/"}});var d=["Call"];var m=["TimeTaken"];d.forEach(function(D){var a=new sap.viz.ui5.data.DimensionDefinition({name:D,axis:1,value:{path:D}});this._dataSet.addDimension(a)},this);m.forEach(function(M){var a=new sap.viz.ui5.data.MeasureDefinition({name:M,value:{path:M}});this._dataSet.addMeasure(a)},this);this._oChart=new sap.viz.ui5.Bar({dataset:this._dataSet,width:"750px",height:"380px"});this._oChart.setModel(new sap.ui.model.json.JSONModel());this._oDialog=new sap.m.Dialog({title:"Performance Check",contentWidth:"800px",contentHeight:"400px",endButton:new sap.m.Button({text:"Close",press:function(){t._oDialog.close()}})});this._oDialog.addContent(this._oChart)},start:function(d,c){var p=this._processData(d);this._oChart.getModel().setData(p);var t=this;if(!this._oDialog.isOpen()){if(c){this._oDialog.addStyleClass("sapUiSizeCompact")}else{this._oDialog.removeStyleClass("sapUiSizeCompact")}this._oDialog.open();setTimeout(function(){t._oChart.rerender()},200)}}}};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.drilldown.view.Drilldown.controller')){jQuery.sap.declare('sap.suite.ui.smartbusiness.drilldown.view.Drilldown.controller');jQuery.sap.require('sap.ca.scfld.md.controller.BaseFullscreenController');jQuery.sap.require('sap.m.MessageBox');sap.ca.scfld.md.controller.BaseFullscreenController.extend("sap.suite.ui.smartbusiness.drilldown.view.Drilldown",{_getEvaluationId:function(){try{var s=this.oConnectionManager.getComponent().oComponentData.startupParameters;return s["evaluationId"][0]}catch(e){return sap.suite.smartbusiness.url.hash.getStartupParameters().evaluationId[0]}},_getDataFromUrl:function(){try{var s=this.oConnectionManager.getComponent().oComponentData.startupParameters;this.TILE_TYPE='';this.DIMENSION='';if(s["tileType"]){this.TILE_TYPE=s["tileType"][0]}if(s["dimension"]){this.DIMENSION=s["dimension"][0]}if(s["sap-system"]){this.SAP_SYSTEM=s["sap-system"][0]}if(s["chipId"]){this.CHIP_ID=s["chipId"][0]}}catch(e){var p=sap.suite.smartbusiness.url.hash.getStartupParameters();if(p){if(p.tileType){this.TILE_TYPE=p.tileType[0]}if(p.dimension){this.DIMENSION=p.dimension[0]}if(p["sap-system"]){this.SAP_SYSTEM=p["sap-system"][0]}if(p["chipId"]){this.CHIP_ID=p["chipId"][0]}}}},fetchAllEvaluations:function(p){var h=[this._getEvaluationId()];var H=this.CONFIGURATION.getHeaders();H.forEach(function(c){if(c.isAssociated()){if(h.indexOf(c.getReferenceEvaluationId())==-1){h.push(c.getReferenceEvaluationId())}if(h.indexOf(c.getEvaluationId())==-1){h.push(c.getEvaluationId())}}});this._bundled_evaluations_call_ref=sap.suite.smartbusiness.drilldown.setEvaluationsCache({evalIdArray:h,sapSystem:this.SAP_SYSTEM,success:p.success,context:p.context})},onAfterRendering:function(){var E=this._getEvaluationId();this._EVALUATION_ID=E;this.firstTimeFlag=false;this._getDataFromUrl();if(!this._proxyHashChangeListener){this._proxyHashChangeListener=jQuery.proxy(this.hashChangeListener,this);this._attachHashChangeEvent()}this._busyDialog.open();var s=new Date().getTime();this.DDA_CONFIG_ODATA_CALL_REF=sap.suite.smartbusiness.drilldown.loadConfiguration({evaluationId:E,cache:true,success:function(b){var e=new Date().getTime();this._requestTimeLog["DDA_CONFIG_FETCH"]={title:"Configuration",time:e-s};this.CONFIGURATION=sap.suite.smartbusiness.drilldown.parse(E,b);var t=this;if(this.CONFIGURATION.getAllViews().length==0){jQuery.sap.log.error("drilldown not configured");var i=t.getView().getModel("i18n");sap.m.MessageBox.alert(i.getResourceBundle().getText("DDA_NOT_CONFIGURED"),function(){window.location.hash="";t._busyDialog.close()});return}var a=new Date().getTime();this.fetchAllEvaluations({success:function(){var c=new Date().getTime();this._requestTimeLog["BUNDLED_EVALUATIONS_FETCH"]={title:"Evaluations",time:c-a};this.EVALUATION_ODATA_CALL_REF=sap.suite.smartbusiness.drilldown.getEvaluationById({id:E,cache:true,filters:true,thresholds:true,success:function(d){this._busyDialog.close();this.EVALUATION=sap.suite.smartbusiness.kpi.parseEvaluation(d);this._initialize()},error:function(){this._busyDialog.close();throw new Error("Evaluation Details Not Found with ID : "+E)},context:this,sapSystem:this.SAP_SYSTEM})},context:this,})},error:function(){jQuery.sap.log.error("Drilldown Configuration Fetching Failed");this._busyDialog.close()},context:this,sapSystem:this.SAP_SYSTEM})},onInit:function(){sap.suite.smartbusiness.cache.invalidateKpiDetailsCache();this._requestTimeLog={};this._busyDialog=new sap.m.BusyDialog();sap.sb_drilldown_app=this;this.EVALUATION=null;this.CONFIGURATION=null;this.SELECTED_VIEW=null;this.POPOVER_VIEW_NAVIGATION_MODEL=new sap.ui.model.json.JSONModel({"VIEW_NAVIGATION":[]});this.POPOVER_EXTERNAL_APP_NAVIGATION_MODEL=new sap.ui.model.json.JSONModel({"APP_NAVIGATION":[]});this.SEMANTIC_OBJECT=sap.suite.smartbusiness.url.hash.getSemanticObject();this.ACTION=sap.suite.smartbusiness.url.hash.getAction();var l=new sap.ui.core.Locale(sap.ui.getCore().getConfiguration().getLanguage());this.VALUE_FORMATTER=sap.ca.ui.model.format.NumberFormat.getInstance({style:"standard"},l);this.urlParsingService=sap.ushell.Container.getService("URLParsing");this.addExportMethodToTable();this._hideOrShowFacetFilterIfRequired()},_hideOrShowFacetFilterIfRequired:function(){var f=this.getUIComponents().getFilter();var a=sap.suite.smartbusiness.url.hash.getApplicationParameters(["viewId"]);if(jQuery.isEmptyObject(a)==false){f.setVisible(true)}},onBeforeRendering:function(){},_initialize:function(){this.setHeaderFooterOptions(this.getHeaderFooterOptions());this._initExternalNavigationLinks();var w=this.EVALUATION.getKpiName()+" - "+this.EVALUATION.getTitle();try{if(sap.ushell.services.AppConfiguration&&sap.ushell.services.AppConfiguration.setWindowTitle){sap.ushell.services.AppConfiguration.setWindowTitle(w)}}catch(e){jQuery.sap.log.error("Error Setting Window Page Title : "+w)}var p=sap.suite.smartbusiness.odata.properties(this.urlParsingService.addSystemToServiceUrl(this.EVALUATION.getODataUrl(),this.SAP_SYSTEM),this.EVALUATION.getEntitySet());this.COLUMN_LABEL_MAPPING=p.getLabelMappingObject();this.DIMENSION_TEXT_PROPERTY_MAPPING=p.getTextPropertyMappingObject();this.MEASURE_UNIT_PROPERTY_MAPPING=p.getUnitPropertyMappingObject();this._initAddToHomeDialogBox();var v=new sap.ui.model.json.JSONModel();v.setData(this.CONFIGURATION.getAllViews());var U=this.getUIComponents();U.getChartToolbar().setModel(v,"VIEW_SWITCH");this.chartModel=new sap.ui.model.json.JSONModel();var c=9999;this.chartModel.setSizeLimit(c);U.getChartToolbar().setModel(this.chartModel);this.EvaluationHeaderModel=new sap.ui.model.json.JSONModel();U.getHeader().setModel(this.EvaluationHeaderModel);this.titleModel=new sap.ui.model.json.JSONModel();U.getPage().getCustomHeader().getContentMiddle()[0].setModel(this.titleModel);this.renderDrilldownHeader();this._initRequestTimeLogChart();this.hashChangeListener()},switchedToTableView:function(){if(this.getUIComponents().getChart()){this.setChartSelectionContextObject(null)}},switchedToChartView:function(){this.getUIComponents().getTable().setSelectedContext(null)},renderDrilldownHeader:function(){var f=this.CONFIGURATION.getFilters();this.renderFilters(f);var h=this.CONFIGURATION.getHeaders();this.renderKpiHeaders(h);this.renderTitle();this.renderEvaluationHeader()},renderTitle:function(){var t=this.getUIComponents().getPage().getCustomHeader().getContentMiddle()[0];if(t){t.setText(this.EVALUATION.getKpiName())}},renderFilters:function(f){var a=this.getUIComponents().getFilter();a.setEvaluationData(this.EVALUATION);a.setEvaluationId(this.EVALUATION.getId());a.setDimensions(f);a.setSapSystem(this.SAP_SYSTEM)},renderKpiHeaders:function(h){var s=this;var a=this.getUIComponents().getTileContainer();a.removeAllItems();this.miniChartManager=sap.suite.smartbusiness.miniChartManager.renderHeaders({allTiles:h,headerContainer:a,sapSystem:this.SAP_SYSTEM,urlFilters:this.getUrlFilters()})},renderView:function(c){this.table=null;this.chart=null;this._addUIComponents(c);var a=c.getColumns();var b=c.getChartConfiguration();this.renderTable(a,b[0].getColorScheme());if(this.chart){this.renderChart(c,b[0],a)}},renderEvaluationHeader:function(){var o=this.getUIComponents().getHeader(),t=this;o.setTitle(this.EVALUATION.getTitle());if(this.EVALUATION.getDescription()){o.removeAllAttributes();o.addAttribute(new sap.m.ObjectAttribute({text:this.EVALUATION.getDescription()}))}var k=this.EVALUATION.getKpiMeasureName();var f=k;if(this.DIMENSION_TEXT_PROPERTY_MAPPING[k]){f=this.DIMENSION_TEXT_PROPERTY_MAPPING[k]}var a=this.MEASURE_UNIT_PROPERTY_MAPPING[k];o.bindProperty("number","/data/"+f,f!=k?function(v){return v}:function(v){if(v){if(t.EVALUATION.getScaling()==-2){return(t.VALUE_FORMATTER.format(v*100)+"%")}else{return t.VALUE_FORMATTER.format(v)}}return v});if(a){o.bindProperty("numberUnit","/data/"+a)}},fetchKpiValue:function(){if(!this.CONFIGURATION.isAggregateValueEnabled()){return}var t=this;var u=sap.suite.smartbusiness.odata.getUri({serviceUri:this.urlParsingService.addSystemToServiceUrl(this.EVALUATION.getODataUrl(),this.SAP_SYSTEM),entitySet:this.EVALUATION.getEntitySet(),measure:this._getEvaluationThresholdMeasures(),filter:this.getAllFilters()});var s=new Date().getTime();var e=this._getEvaluationId();this.FETCH_AGREGATION_VALUE_ODATA_CALL_REF_SUCCESS=function(d){var a=new Date().getTime();t._requestTimeLog["KPI_VALUE"]={title:"Kpi Value",time:a-s};if(d&&d.results.length){t.EvaluationHeaderModel.setData({data:d.results[0]});sap.suite.smartbusiness.cache.setKpiDetailsById(e,d);if(sap.suite.smartbusiness.cache.current_calls[e]){var x=sap.suite.smartbusiness.cache.current_calls[e];delete sap.suite.smartbusiness.cache.current_calls[e];x.resolve()}}else{jQuery.sap.log.error("Couldn't fetch Aggregate Value. Response was "+d+" for uri : "+u.uri);t.EvaluationHeaderModel.setData({data:{}})}};this.FETCH_AGREGATION_VALUE_ODATA_CALL_REF_FAIL=function(a){jQuery.sap.log.error(a);t.EvaluationHeaderModel.setData({data:{}});if(sap.suite.smartbusiness.cache.current_calls[e]){sap.suite.smartbusiness.cache.current_calls[e].reject()}};var f=sap.suite.smartbusiness.cache.getKpiDetailsById(e);if(f){this.FETCH_AGREGATION_VALUE_ODATA_CALL_REF_SUCCESS(f)}else if(sap.suite.smartbusiness.cache.current_calls[e]){jQuery.when(sap.suite.smartbusiness.cache.current_calls[e]).then(function(){var d=sap.suite.smartbusiness.cache.getKpiDetailsById(e);t.FETCH_AGREGATION_VALUE_ODATA_CALL_REF_SUCCESS(d)},function(a){t.logError(a)})}else{sap.suite.smartbusiness.cache.current_calls[e]=jQuery.Deferred();this.FETCH_AGREGATION_VALUE_ODATA_CALL_REF=u.model.read(u.uri,null,null,true,this.FETCH_AGREGATION_VALUE_ODATA_CALL_REF_SUCCESS,this.FETCH_AGREGATION_VALUE_ODATA_CALL_REF_FAIL)}},_addPopoverContent:function(c,i){var l=new sap.m.List({visible:{path:"/VIEW_NAVIGATION",formatter:function(A){if(A&&A.length>0){return true}return false}}});l.bindItems("/VIEW_NAVIGATION",new sap.m.StandardListItem({title:"{TITLE}",type:sap.m.ListType.Navigation,customData:new sap.ui.core.CustomData({key:"{ID}",value:"{ID}"}),press:jQuery.proxy(this._onViewSelection,this,{publishContext:true,isTable:!!i})}).setTooltip("{TITLE}"));var a=this._getListOfViewsForPopover(this.CONFIGURATION.getAllViews(),this.SELECTED_VIEW.getId());l.setModel(this.POPOVER_VIEW_NAVIGATION_MODEL);var b=new sap.m.List({});this._popoverNavigationListReferences.push(b);b.bindItems("/APP_NAVIGATION",new sap.m.StandardListItem({title:"{text}",type:sap.m.ListType.Navigation,customData:new sap.ui.core.CustomData({key:"{id}",value:"{applicationAlias}"}),press:jQuery.proxy(this._onAppSelection,this,{publishContext:true,isTable:!!i})}).setTooltip("{text}"));b.setModel(this.POPOVER_EXTERNAL_APP_NAVIGATION_MODEL);var p=new sap.m.VBox({items:[l,b],width:"99%"});c.setPopoverFooter(p)},_addUIComponents:function(v){this.table=null;this.chart=null;var c=this.getUIComponents().getChartToolbar();c.removeAllCharts();var a=v.getChartConfiguration()[0];if(a){var t=this;this._popoverNavigationListReferences=[];this.table=new sap.suite.ui.smartbusiness.drilldown.lib.CustomTable({mode:sap.m.ListMode.SingleSelectMaster}).addStyleClass("smartBusinessDrilldownTable");this.table.attachSelectionChange(function(){t._onTableRowSelected()});this.table.addEventDelegate({onAfterRendering:function(){t.switchedToTableView()}});this.table.setModel(this.getView().getModel("i18n"),"i18n");this._addPopoverContent(this.table,true);if(a.getChartType().isTable()){c.addChart(this.table)}else{this.chart=new sap.ca.ui.charts.Chart({showPopover:true,chartType:"Bar"});this.chart.setAdvancedChartSettings({plotArea:{animation:{dataLoading:false,dataUpdating:false,resizing:false}},legend:{title:{visible:false}},yAxis:{title:{visible:true}},xAxis:{title:{visible:true}}});this.chart.addEventDelegate({onAfterRendering:function(){t.switchedToChartView()}});c.addChart(this.chart);c.addChart(this.table);this._addPopoverContent(this.chart,false)}}else{jQuery.sap.log.error("NO Chart Configuration found!! ")}},_setNoDataText:function(p){this.table.setNoDataText(this.getView().getModel("i18n").getProperty(p));if(this.chart){this.chart.setNoData(new sap.m.Label({text:this.getView().getModel("i18n").getProperty(p)}))}},fetchDataForChart:function(){var c=this.getUIComponents().getChartToolbar();var V=this.SELECTED_VIEW;var t=this;try{this.chartModel.setData({data:[]});c.setBusy(true);var d=[].concat(this.SELECTED_VIEW.getDimensions());d.forEach(function(f){var o=V.findDimensionByName(f);var g=o.getSortBy();if((d.indexOf(g)==-1)){if(o.getSortOrder()=="asc"||o.getSortOrder()=="desc"){d.push(g)}}});var m=this.SELECTED_VIEW.getMeasures();var s=null;if(this.TABLE_SORTING&&this.TABLE_SORTING.length){s=this.TABLE_SORTING}else if(this.COLUMNS_SORT&&this.COLUMNS_SORT.length){s=this.COLUMNS_SORT}var a=null;try{var D=window.parseInt(this.SELECTED_VIEW.getChartConfiguration()[0].getDataLimit());if(isNaN(D)){jQuery.sap.log.error("Invalid Data Limit Value : "+a)}else{if(D!=-1){a=D}}}catch(e){jQuery.sap.log.error("Error parsing Data Limit Value")}var u=sap.suite.smartbusiness.odata.getUri({serviceUri:this.urlParsingService.addSystemToServiceUrl(this.EVALUATION.getODataUrl(),this.SAP_SYSTEM),entitySet:this.EVALUATION.getEntitySet(),dimension:d,measure:m,filter:this.getAllFilters(),sort:s,dataLimit:a});this._setNoDataText("DATA_LOADING");var b=new Date().getTime();this.CHART_TABLE_DATA_ODATA_CALL_REF=u.model.read(u.uri,null,null,true,function(f){var g=new Date().getTime();t._requestTimeLog["CHART_TABLE_DATA"]={title:"Chart/Table Data",time:g-b};if(f.results.length===0){t._setNoDataText("DATA_NODATA")}t.chartModel.setData({data:f.results});c.setBusy(false);if(t.getUIComponents().getChart()){var p=t.getChartPopoverFormatter();t.getUIComponents().getChart().setPopoverFormatter(p)}if(f.results.length){t._appendUOMToTableHeader(f.results[0]);t._appendUOMToChartAxis(f.results[0])}},function(){jQuery.sap.log.error("Error fetching data : "+u.uri);t._setNoDataText("DATA_LOADING_FAILED");t.chartModel.setData({data:[]});c.setBusy(false);t.chartModel.setData({data:[]})})}catch(e){t._setNoDataText("DATA_LOADING_FAILED");jQuery.sap.log.error(e);c.setBusy(false);this.chartModel.setData({data:[]})}},_getTableContextParameters:function(d){var e={};var t=this.getUIComponents().getTable().getSelectedContext();if(t&&t.length){t.forEach(function(a){d.forEach(function(b){var c=a[b];if(c){if(c.getTime){c=c.getTime()}if(e[b]){e[b].push(c)}else{e[b]=[];e[b].push(c)}}})})}return e},_getChartContextParameters:function(d){var e,c;c=this.getChartSelectionContextObject();e={};if(c){var a=this.getUIComponents().getChart().getDataset();for(var b in c){var f=c[b];var g=a.findContext(f).getObject();d.forEach(function(h){var i=g[h];if(i){if(i.getTime){i=i.getTime()}if(e[h]){e[h].push(i)}else{e[h]=[];e[h].push(i)}}})}}return e},_onViewSelection:function(c,e){var v=e.getSource().getCustomData()[0].getKey();var p=sap.suite.smartbusiness.url.hash.getApplicationParameters();p["viewId"]=v;sap.suite.smartbusiness.url.hash.setApplicationParameters(p,false);var a={};var d=this.SELECTED_VIEW.getDimensions();if(c.isTable){a=this._getTableContextParameters(d);sap.suite.smartbusiness.url.hash.updateApplicationParameters(a,false);this.getUIComponents().getTable().setSelectedContext(null)}else{a=this._getChartContextParameters(d);sap.suite.smartbusiness.url.hash.updateApplicationParameters(a,false);this.setChartSelectionContextObject(null)}sap.suite.smartbusiness.url.hash.updateHash();this._hideOrShowFacetFilterIfRequired()},getChartSelectionContextObject:function(){return this._chartPopoverContext},setChartSelectionContextObject:function(v){this._chartPopoverContext=v},_detachHashChangeListener:function(){try{this.hashChanger.detachEvent("hashChanged",this._proxyHashChangeListener);this._proxyHashChangeListener=null}catch(e){jQuery.sap.log.error("Error Detaching hashChanged Event")}},_onAppSelection:function(c,e){var a,n=e.getSource().getCustomData()[0].getKey();var s=n.split("~")[0];var b=s.split("-");var d=b[0];var f=b[1];var g=sap.suite.smartbusiness.url.hash.getApplicationParameters(["viewId"]);if(d=="AdhocAnalysis"){g=sap.suite.smartbusiness.url.hash.getApplicationParameters()}sap.suite.smartbusiness.url.hash.setSemanticObject(d,false);sap.suite.smartbusiness.url.hash.setAction(f,false);sap.suite.smartbusiness.url.hash.setApplicationParameters(null,false);sap.suite.smartbusiness.url.hash.updateStartupParameters(g,false);var h=this.SELECTED_VIEW.getDimensions();if(c.isFromOpenIn){a=this._getTableContextParameters(h);sap.suite.smartbusiness.url.hash.updateStartupParameters(a,false);a=this._getChartContextParameters(h);sap.suite.smartbusiness.url.hash.updateStartupParameters(a,false)}else{if(c.isTable){a=this._getTableContextParameters(h);sap.suite.smartbusiness.url.hash.updateStartupParameters(a,false)}else{a=this._getChartContextParameters(h);sap.suite.smartbusiness.url.hash.updateStartupParameters(a,false)}}this._detachHashChangeListener();sap.suite.smartbusiness.url.hash.updateHash()},_fillChartTablePopoverContent:function(){var v=this._getListOfViewsForPopover(this.CONFIGURATION.getAllViews(),this.SELECTED_VIEW.getId());this.POPOVER_VIEW_NAVIGATION_MODEL.setData({VIEW_NAVIGATION:v});this.POPOVER_EXTERNAL_APP_NAVIGATION_MODEL.setData({APP_NAVIGATION:[]});if(this._popoverNavigationListReferences&&this._popoverNavigationListReferences.length){this._popoverNavigationListReferences.forEach(function(n){n.setNoDataText(" ");n.setBusy(true)},this)}this.SEMANTIC_OBJECT_BY_CONTEXT_LINKS_ODATA_CALL_REF=sap.suite.smartbusiness.navigation.getLinksByContext({semanticObject:this.SEMANTIC_OBJECT,dimensions:this.SELECTED_VIEW.getDimensions(),context:this,viewId:this.EVALUATION.getId()+"_"+this.SELECTED_VIEW.getId(),success:function(l){var O=jQuery.extend({},this._OPEN_IN_LINKS);var u=this._getUniqueNavLinks(l,O);if(u.length){this.POPOVER_EXTERNAL_APP_NAVIGATION_MODEL.setData({APP_NAVIGATION:u})}if(this._popoverNavigationListReferences&&this._popoverNavigationListReferences.length){this._popoverNavigationListReferences.forEach(function(n){n.setBusy(false);n.setNoDataText("-")},this)}}})},_getListOfViewsForPopover:function(a,e){var b=[];a.forEach(function(v){if(v.ID!==e){b.push(jQuery.extend(false,{},v))}});return b},_onTableRowSelected:function(){this._fillChartTablePopoverContent()},_onChartDataPointSelection:function(e){var s=e.getParameter("srcEvent");var c=s.getParameter("data")[0].data[0].ctx.path;this._chartPopoverContext=this._chartPopoverContext||{};var g=function(b){var d=Object.keys(b).sort();var f="";d.forEach(function(k){f+=k+"#"+b[k]+"#"});return f};var _=g(c);if(this._chartPopoverContext[_]){delete this._chartPopoverContext[_]}else{this._chartPopoverContext[_]=c}if(this._chartPopoverContext){var a=Object.keys(this._chartPopoverContext).length;if(a!==this.chart.getInternalVizChart().getVIZInstance().selection().length){this._chartPopoverContext={};this._chartPopoverContext[_]=c}}if(this.chart.getInternalVizChart().getVIZInstance().selection().length==0){this._chartPopoverContext={}}this._fillChartTablePopoverContent()},_getStacking:function(c){var s={stacking:false,dimensionStacked:false,measureStacked:false,stackedDimensionName:null};var a=this.SELECTED_VIEW;c.forEach(function(e){var C=a.findColumnByName(e);if(C.isMeasure()){if(C.isStacked()){s.stacking=true;s.measureStacked=true;return false}}});if(!s.stacking){c.forEach(function(e){var C=a.findColumnByName(e);if(C.isDimension()){if(C.isStacked()){s.stacking=true;s.dimensionStacked=true;if(C.getAxis()==2){s.stackedDimensionName=C.getName();return false}}}})}return s},_getEvaluationThresholdMeasures:function(){var t=[];t.push(this.EVALUATION.getKpiMeasureName());if(this.EVALUATION.getThresholdValueType()==="MEASURE"){var a=this.EVALUATION.getValues().results;if(a&&a.length){for(var i=0;i<a.length;i++){if((a[i]).COLUMN_NAME&&!((a[i]).FIXED)){t.push((a[i]).COLUMN_NAME)}}}}return t},_addDimensionAndMeasureToDataset:function(c,d,C,a){this.thresholdMeasuresArray=this._getEvaluationThresholdMeasures();var s=this._getStacking(a);var V=this.SELECTED_VIEW;var o=C.getChartType();if((o.isBar()||o.isColumn())&&s.dimensionStacked){a.forEach(function(b){var e=V.findColumnByName(b);if(e.isDimension()){var A=1;if(e.getName()==s.stackedDimensionName&&V.getDimensionCount()>1){A=2;c.setStackedChartWidthEnhancer(true)}var D=new sap.viz.ui5.data.DimensionDefinition({name:this.COLUMN_LABEL_MAPPING[e.getName()],axis:A,value:{path:this.DIMENSION_TEXT_PROPERTY_MAPPING[e.getName()],formatter:this.getColumnValueFormatter(this.DIMENSION_TEXT_PROPERTY_MAPPING[e.getName()],true)}});D.column_name=e.getName();d.addDimension(D)}},this)}else{a.forEach(function(b){var e=V.findColumnByName(b);if(e.isDimension()){var D=new sap.viz.ui5.data.DimensionDefinition({name:this.COLUMN_LABEL_MAPPING[e.getName()],axis:1,value:{path:this.DIMENSION_TEXT_PROPERTY_MAPPING[e.getName()],formatter:this.getColumnValueFormatter(this.DIMENSION_TEXT_PROPERTY_MAPPING[e.getName()],true)}});D.column_name=e.getName();d.addDimension(D)}},this)}if(o.isLine()||o.isCombination()){a.forEach(function(b){var e=V.findColumnByName(b);if(e.isMeasure()){var m=new sap.viz.ui5.data.MeasureDefinition({name:this.COLUMN_LABEL_MAPPING[e.getName()],value:{path:e.getName()}});m.column_name=e.getName();d.addMeasure(m)}},this)}else if(o.isBubble()){var _=0;a.forEach(function(b,i){var e=V.findColumnByName(b);if(e.isMeasure()){++_;var m=new sap.viz.ui5.data.MeasureDefinition({name:this.COLUMN_LABEL_MAPPING[e.getName()],group:_,value:{path:e.getName()}});m.column_name=e.getName();d.addMeasure(m)}},this)}else if(o.isBar()||o.isColumn()){if(C.isSingleAxis()){a.forEach(function(b){var e=V.findColumnByName(b);if(e.isMeasure()){var m=new sap.viz.ui5.data.MeasureDefinition({name:this.COLUMN_LABEL_MAPPING[e.getName()],value:{path:e.getName()}});m.column_name=e.getName();d.addMeasure(m)}},this)}else if(C.isDualAxis()){a.forEach(function(b){var e=V.findColumnByName(b);if(e.isMeasure()){var m=new sap.viz.ui5.data.MeasureDefinition({group:e.getAxis(),name:this.COLUMN_LABEL_MAPPING[e.getName()],value:{path:e.getName()}});m.column_name=e.getName();d.addMeasure(m)}},this)}}},_appendUOMToChartAxis:function(d){var c,m,a,U,u,b,e,f,g;var h=function(o){var k=[];for(var l in o){k.push(o[l])}return k.join(" & ")};var i=function(A){return{title:{visible:true,text:A}}};c=this.getUIComponents().getChart();if(!c){return}m=this.SELECTED_VIEW.getMeasures();a=c.getAdvancedChartSettings()||{};U={};u=false;if(m.length==1&&m[0]==this.EVALUATION.getKpiMeasureName()){var M=m[0];b=this.MEASURE_UNIT_PROPERTY_MAPPING[M];if(b){e=d[b];if(e){U[M]=e;u=true}else{U[M]=this.COLUMN_LABEL_MAPPING[M]}}else{U[M]=this.COLUMN_LABEL_MAPPING[M]}}else{m.forEach(function(M){b=this.MEASURE_UNIT_PROPERTY_MAPPING[M];if(b){e=d[b];if(e){U[M]=this.COLUMN_LABEL_MAPPING[M]+" ("+e+")";u=true}else{U[M]=this.COLUMN_LABEL_MAPPING[M]}}else{U[M]=this.COLUMN_LABEL_MAPPING[M]}},this)}f=this.SELECTED_VIEW.getChartConfiguration()[0];g=f.getChartType();if(u){if(g.isColumn()||g.isBar()){if(f.isSingleAxis()){if(g.isBar()){a.xAxis=i(h(U))}else{a.yAxis=i(h(U))}}else{var x={},j={};m.forEach(function(M){var o=this.SELECTED_VIEW.findMeasureByName(M);if(o.getAxis()==1){x[M]=U[M]}else if(o.getAxis()==2){j[M]=U[M]}},this);if(g.isBar()){a.xAxis=i(h(j));a.xAxis2=i(h(x))}else{a.yAxis=i(h(x));a.yAxis2=i(h(j))}}}else if(g.isBubble()){var D=c.getDataset().getMeasures();D.forEach(function(o){var s=o.column_name;var l=U[s];if(o.getGroup()==1){a.xAxis=i(l)}else if(o.getGroup()==2){a.yAxis=i(l)}},this)}else if(g.isTable()){}else{a.yAxis=i(h(U))}}},_updateAxisLabelIfRequired:function(c,d,C,a){var o=C.getChartType();var V=this.SELECTED_VIEW;var b=c.getAdvancedChartSettings()||{};var I="("+this.getView().getModel("i18n").getProperty("IN_PERCENTAGE")+")";var g=function(l){return{title:{visible:true,text:l}}};if(C.isPercentageValue()){if(o.isBar()||o.isColumn()){var m=V.getMeasures();if(C.isSingleAxis()){var M=[];m.forEach(function(i){M.push(this.COLUMN_LABEL_MAPPING[i])},this);var s=M.join(" & ")+I;if(o.isColumn()){b.yAxis=g(s)}else{b.xAxis=g(s)}}else{var f=[];var S=[];m.forEach(function(i){var j=V.findMeasureByName(i);if(j.getAxis()==1){f.push(this.COLUMN_LABEL_MAPPING[i])}else if(j.getAxis()==2){S.push(this.COLUMN_LABEL_MAPPING[i])}},this);var e=f.join(" & ")+I;var h=S.join(" & ")+I;if(o.isColumn()){b.yAxis=g(e);b.yAxis2=g(h)}else{b.xAxis2=g(e);b.xAxis=g(h)}}}}},renderChart:function(v,c,a){var b=this.getUIComponents().getChart();b.attachSelectDataPoint(jQuery.proxy(this._onChartDataPointSelection,this));if(!c||!a.length)return;var d=new sap.viz.core.FlattenedDataset({data:{path:"/data"}});b.setStackedChartWidthEnhancer(false);this._addDimensionAndMeasureToDataset(b,d,c,a);b.setChartType(this.getCAChartType(c,v));b.setDataset(d);this.setChartLabelFormatters(b,c,this.SELECTED_VIEW);this._overrideChartAxisLabelFormatters(b,c);if((this.EVALUATION.getScaling()==-2)&&(c.isDualAxis())&&(c.isAbsoluteValue())&&(c.getChartType().isBar()||c.getChartType().isColumn())){this._handleDualAxisWhenPercentScale(b,c.getChartType())}this.applyColorToChart(b,c);this._showChartLegendIfApplicable(c,a)},_showChartLegendIfApplicable:function(c,C){var o=this.getUIComponents().getChartToolbar();var s=this._getStacking(C);var V=this.SELECTED_VIEW;var a=c.getChartType();var i=((a.isBar()||a.isColumn())&&s.dimensionStacked&&s.stackedDimensionName&&(V.getDimensionCount()>1))?true:false;if((V.getMeasures().length>1)||(i)){o.setShowLegend(true)}else{o.setShowLegend(false)}},_overrideChartAxisLabelFormatters:function(c,C){var l=new sap.ui.core.Locale(sap.ui.getCore().getConfiguration().getLanguage());var p=sap.ca.ui.model.format.NumberFormat.getInstance({},l);if(C.isPercentageValue()){var o=C.getChartType();if(o.isBar()){c.setXAxisLabelFormatter(function(r){return p.format_percentage(r)});c.setYAxisLabelFormatter(function(r){return r});if(C.isDualAxis()){c.setXAxis2LabelFormatter(function(r){return p.format_percentage(r)})}}else if(o.isColumn()){c.setYAxisLabelFormatter(function(r){return p.format_percentage(r)});c.setXAxisLabelFormatter(function(r){return r});if(C.isDualAxis()){c.setYAxis2LabelFormatter(function(r){return p.format_percentage(r)})}}}},_handleDualAxisWhenPercentScale:function(c,a){var t=this;var V=this.SELECTED_VIEW;var m=V.getMeasures();var b=this._getMeasuresByAxis();var i=this._isMeasureSetPercentScaled(b.axis1Msr);var d=this._isMeasureSetPercentScaled(b.axis2Msr);var l=[[],[]];if(i)l[0].push(t._getChartPercentFormatter());else l[0].push(t._getChartNumberFormatter());if(d)l[1].push(t._getChartPercentFormatter());else l[1].push(t._getChartNumberFormatter());c.setDataLabelFormatter(l);if(a.isBar()){c.setXAxisLabelFormatter(i?t._getChartPercentFormatter():t._getChartNumberFormatter());c.setYAxisLabelFormatter(t._pseudoChartFormatter);c.setXAxis2LabelFormatter(d?t._getChartPercentFormatter():t._getChartNumberFormatter());c.setYAxis2LabelFormatter(t._pseudoChartFormatter)}else if(a.isColumn()){c.setXAxisLabelFormatter(t._pseudoChartFormatter);c.setYAxisLabelFormatter(i?t._getChartPercentFormatter():t._getChartNumberFormatter());c.setXAxis2LabelFormatter(t._pseudoChartFormatter);c.setYAxis2LabelFormatter(d?t._getChartPercentFormatter():t._getChartNumberFormatter())}},_isEvaluationThresholdMeasure:function(m){if(this.thresholdMeasuresArray&&this.thresholdMeasuresArray.length){var t=this.thresholdMeasuresArray}else{var t=this._getEvaluationThresholdMeasures()}if(t&&t.length){if(t.indexOf(m)!=-1){return true}}return false},_getMeasuresByAxis:function(){var t=this;var V=this.SELECTED_VIEW;var m=V.getMeasures();var a=[],b=[];for(var i=0;i<m.length;i++){var c=V.findColumnByName(m[i]);if(c.isMeasure()&&(c.getAxis()==1)){a.push(m[i])}else if(c.isMeasure()&&(c.getAxis()==2)){b.push(m[i])}}return{axis1Msr:a,axis2Msr:b}},_isMeasureSetPercentScaled:function(m){if(this.thresholdMeasuresArray&&this.thresholdMeasuresArray.length){var t=this.thresholdMeasuresArray}else{var t=this._getEvaluationThresholdMeasures()}if(t&&t.length&&m&&m.length){for(var i=0;i<m.length;i++){if(t.indexOf(m[i])!=-1){return true}}}return false},setChartLabelFormatters:function(c,o,v){var i=this._isMeasureSetPercentScaled(this.SELECTED_VIEW.getMeasures());if((this.EVALUATION.getScaling()==-2)&&!((o.isPercentageValue())&&(o.getChartType().isBar()||o.getChartType().isColumn()))&&i){var f=this.getChartLabelFormatter(o,v,true);c.setXAxisLabelFormatter(f.x1);c.setYAxisLabelFormatter(f.y1);c.setXAxis2LabelFormatter(f.x2);c.setYAxis2LabelFormatter(f.y2);c.setDataLabelFormatter(f.dataLabel)}else{var f=this.getChartLabelFormatter(o,v);c.setXAxisLabelFormatter(f.x1);c.setYAxisLabelFormatter(f.y1);c.setXAxis2LabelFormatter(f.x2);c.setYAxis2LabelFormatter(f.y2);c.setDataLabelFormatter(f.dataLabel)}},_pseudoChartFormatter:function(s){return s},_getChartNumberFormatter:function(i){var l=new sap.ui.core.Locale(sap.ui.getCore().getConfiguration().getLanguage());function a(n){return!isNaN(parseFloat(n))&&isFinite(n)}var f={style:i?'standard':'short'};var c=sap.ca.ui.model.format.NumberFormat.getInstance(f,l);return function(s){return a(s)?c.format(s):s}},_getChartPercentFormatter:function(i){var l=new sap.ui.core.Locale(sap.ui.getCore().getConfiguration().getLanguage());function a(n){return!isNaN(parseFloat(n))&&isFinite(n)}var f={style:i?'standard':'short'};var c=sap.ca.ui.model.format.NumberFormat.getInstance(f,l);return function(s){return a(s)?c.format_percentage(s):s}},getChartLabelFormatter:function(c,v,i){jQuery.sap.require("sap.ca.ui.model.format.NumberFormat");if(i){var f={x1:this._pseudoChartFormatter,y1:this._getChartPercentFormatter(),x2:this._pseudoChartFormatter,y2:this._pseudoChartFormatter,dataLabel:[[this._getChartPercentFormatter()],[this._getChartPercentFormatter()],[this._getChartPercentFormatter()]]}}else{var f={x1:this._pseudoChartFormatter,y1:this._getChartNumberFormatter(),x2:this._pseudoChartFormatter,y2:this._pseudoChartFormatter,dataLabel:[[this._getChartNumberFormatter()]]}}if(c.getChartType().isBubble()||(c.getChartType().isBar()&&c.isAbsoluteValue())){if(i)f.x1=this._getChartPercentFormatter();else f.x1=this._getChartNumberFormatter()}if(c.getChartType().isBar()||(c.getChartType().isColumn()&&c.isStackingEnabled(v)&&c.isPercentageValue())){f.y1=this._pseudoChartFormatter}if(c.getChartType().isBar()&&c.isDualAxis()&&c.isStackingEnabled(v)){if(i)f.x2=this._getChartPercentFormatter();else f.x2=this._getChartNumberFormatter()}if(c.getChartType().isColumn()&&c.isStackingEnabled(v)&&c.isDualAxis()){if(i)f.y2=this._getChartPercentFormatter();else f.y2=this._getChartNumberFormatter()}return f},getColumnValueFormatter:function(n,i,a,b){var t=this;var V=this.SELECTED_VIEW;var c=(V.getChartConfiguration())[0];var f;if(i){f=function(s){return s==0?s+"":s}}else{if(a){if(c.getChartType().isTable()){if(t._isEvaluationThresholdMeasure(n))f=this._getChartPercentFormatter(true);else f=this._getChartNumberFormatter(true)}else if((c.isDualAxis())&&(c.isAbsoluteValue())&&(c.getChartType().isBar()||c.getChartType().isColumn())){var C=V.findColumnByName(n);if(b[(C.getAxis())-1])f=this._getChartPercentFormatter(true);else f=this._getChartNumberFormatter(true)}else{f=this._getChartPercentFormatter(true)}}else f=this._getChartNumberFormatter(true)}var u=this.urlParsingService.addSystemToServiceUrl(this.EVALUATION.getODataUrl(),this.SAP_SYSTEM);var m=sap.suite.smartbusiness.odata.getEdmType(u,n,true);var T=m.type;var F=m.format;F=F.toUpperCase();if(T=='Edm.DateTime'){if(!sap.suite.smartbusiness.odata.isTimeZoneIndependent(u,this.EVALUATION.getEntitySet())){var d;if(F=="DATE"){d="daysAgo"}else if(F=="DATETIME"){d="short"}else if(F=="NONE"){d="daysAgo"}if(d){var o=new sap.ca.ui.model.type.Date({style:d});f=function(s){return o.formatValue(s,"string")}}}else{f=function(e){if(e&&e.getMinutes){e.setMinutes(e.getMinutes()+e.getTimezoneOffset());var g=(F=="DATE")?"getDateInstance":"getDateTimeInstance";return sap.ui.core.format.DateFormat[g]().format(e)}return e}}}return f},getChartPopoverFormatter:function(){var c=this.SELECTED_VIEW.getChartConfiguration()[0];var f=[[],[],[]];var t=this;var V=this.SELECTED_VIEW;var m=this.SELECTED_VIEW.getMeasures();var u=this.MEASURE_UNIT_PROPERTY_MAPPING;var C=c.getChartType();var l=new sap.ui.core.Locale(sap.ui.getCore().getConfiguration().getLanguage());var a=sap.ca.ui.model.format.NumberFormat.getInstance({style:'Standard'},l);var i=this._isMeasureSetPercentScaled(m);function _(M){return function(v){var h="";var j=t.getUIComponents().getChart().getModel().getData().data;if(j&&j.length){h=(j&&j[0])?j[0][u[M]]?" "+j[0][u[M]]:"":"";j[0][u[M]]}return a.format_standard(v)+h}}function b(M){return function(v){return a.format_percentage(v)}}if(c.isPercentageValue()){for(var k=0;k<m.length;k++){f[0].push(function(v){return a.format_percentage(v)});f[1].push(function(v){return a.format_percentage(v)})}}else{if(this.EVALUATION.getScaling()==-2&&i){if((c.isDualAxis())&&(c.isAbsoluteValue())&&(c.getChartType().isBar()||c.getChartType().isColumn())){var d=this._getMeasuresByAxis();var e=this._isMeasureSetPercentScaled(d.axis1Msr);var g=this._isMeasureSetPercentScaled(d.axis2Msr);if(e){for(var k=0;k<d.axis1Msr.length;k++){f[0].push(b((d.axis1Msr)[k]))}}else{for(var k=0;k<d.axis1Msr.length;k++){f[0].push(_((d.axis1Msr)[k]))}}if(g){for(var k=0;k<d.axis2Msr.length;k++){f[1].push(b((d.axis2Msr)[k]))}}else{for(var k=0;k<d.axis2Msr.length;k++){f[1].push(_((d.axis2Msr)[k]))}}}else{for(var k=0;k<m.length;k++){f[0].push(b(m[k]));f[1].push(b(m[k]));f[2].push(b(m[k]))}}}else{for(var k=0;k<m.length;k++){f[0].push(_(m[k]));f[1].push(_(m[k]))}}}return f},applyColorToChart:function(c,a){var t=a.getThresholdMeasure();var C=this;var b=a.getColorScheme();if(!b.getText()){JQuery.sap.log.error("Color Scheme Value Missing");return}var m=c.getDataset().getMeasures();if(b.isManual()){m.forEach(function(M,i,o){var _=this.SELECTED_VIEW.findMeasureByName(M.column_name).getColor();if(!_){if(b.isManualSemantic()){jQuery.sap.log.warning("Semantic Color NOT found for measure name : "+M.getName()+", assigning default to 'Neutral Light'");_="sapCaUiChartSemanticColor-Neutral-Light"}else{jQuery.sap.log.warning("Color NOT found for measure name : "+M.getName()+", assigning default color");_=""}}M.addCustomData(new sap.ui.core.CustomData({key:"fillColor",value:_}))},this)}else if(b.isAutoSemantic()&&!this.EVALUATION.isTargetKpi()){if(t){m.forEach(function(M,i,o){if(M.getName()==t){M.addCustomData(new sap.ui.core.CustomData({key:"fillColor",value:sap.ca.ui.charts.ChartSemanticColor.Neutral}))}else{M.addCustomData(new sap.ui.core.CustomData({key:"fillColor",value:sap.ca.ui.charts.ChartSemanticColor.Good}))}},this);c.setChartSemanticColorFormatter(function(o){var d=c.getModel().getData().data;var e=o.ctx.path.dii_a1;var f=d[e];var r=f[t];if(r!=null&&typeof r!='undefined'){if(C.EVALUATION.isTargetKpi()){if(o.val==r){return sap.ca.ui.charts.ChartSemanticColor.Neutral}return sap.ca.ui.charts.ChartSemanticColor.NeutralLight}else{if(o.val>r){if(C.EVALUATION.isMaximizingKpi()){return sap.ca.ui.charts.ChartSemanticColor.Good}return sap.ca.ui.charts.ChartSemanticColor.Bad}else if(o.val<r){if(C.EVALUATION.isMinimizingKpi()){return sap.ca.ui.charts.ChartSemanticColor.Good}return sap.ca.ui.charts.ChartSemanticColor.Bad}else{return sap.ca.ui.charts.ChartSemanticColor.Neutral}}}else{jQuery.sap.log.error("Threshold Measure:'"+t+"'  not in Dataset. Error Applying Semantic Color");return sap.ca.ui.charts.ChartSemanticColor.NeutralLight}})}else{jQuery.sap.log.error("Chart Color Scheme is Auto-Semantic but no threshold measure Configured!!!")}}else{jQuery.sap.log.debug("Color Scheme is None: Default Color will be used by CA Chart")}if(b.isAutoSemantic()){if(this.EVALUATION.isTargetKpi()){jQuery.sap.log.error("Auto Semantic Coloring can not be applied on target type KPI")}}},getCAChartType:function(c,v){if(c.getChartType().isBar()){if(c.isSingleAxis()){if(c.isAbsoluteValue()){if(c.isStackingEnabled(v)){return sap.ca.ui.charts.ChartType.StackedBar}else{return sap.ca.ui.charts.ChartType.Bar}}else{return sap.ca.ui.charts.ChartType.StackedBar100}}else if(c.isDualAxis()){if(c.isAbsoluteValue()){return sap.ca.ui.charts.ChartType.DualStackedBar}else{return sap.ca.ui.charts.ChartType.DualStackedBar100}}}else if(c.getChartType().isColumn()){if(c.isSingleAxis()){if(c.isAbsoluteValue()){if(c.isStackingEnabled(v)){return sap.ca.ui.charts.ChartType.StackedColumn}else{return sap.ca.ui.charts.ChartType.Column}}else{return sap.ca.ui.charts.ChartType.StackedColumn100}}else if(c.isDualAxis()){if(c.isAbsoluteValue()){return sap.ca.ui.charts.ChartType.DualStackedColumn}else{return sap.ca.ui.charts.ChartType.DualStackedColumn100}}}else{return c.getChartType().getText()}},_getVisibleColumns:function(d){var v=[];d.forEach(function(c,i,a){var C=this.SELECTED_VIEW.findColumnByName(c);if(C.isVisibleInTable()){v.push(c)}},this);return v},_getValueState:function(a,t){if(!this.EVALUATION.isTargetKpi()){if(a<t){return this.EVALUATION.isMaximizingKpi()?sap.ui.core.ValueState.Error:sap.ui.core.ValueState.Success}else if(a==t){return sap.ui.core.ValueState.None}else{return this.EVALUATION.isMaximizingKpi()?sap.ui.core.ValueState.Success:sap.ui.core.ValueState.Error}}else{return sap.ui.core.ValueState.None}},_getTableCell:function(o,c,i,a){var t=this.SELECTED_VIEW.getChartConfiguration()[0]&&this.SELECTED_VIEW.getChartConfiguration()[0].getThresholdMeasure();var b=this;if(this.EVALUATION.isTargetKpi()){return new sap.m.Label({text:{path:o,formatter:this.getColumnValueFormatter(o,false,i,a)}})}else{if(c.isAutoSemantic()&&t){return new sap.m.ObjectNumber({number:{path:o,formatter:this.getColumnValueFormatter(o,false,i,a)},state:{parts:[{path:o},{path:t}],formatter:function(m,d){try{m=window.parseFloat(m);d=window.parseFloat(d);return b._getValueState(m,d)}catch(e){return sap.ui.core.ValueState.None}}}})}else{return new sap.m.Label({text:{path:o,formatter:this.getColumnValueFormatter(o,false,i,a)}})}}},_sortTableByColumnName:function(c){var i={"asc":String.fromCharCode(0xe1e1),"desc":String.fromCharCode(0xe1e2)};var s=null;if(c.sort_by===void(0)){s="desc"}else{s=c.sort_by=="asc"?"desc":"asc"}c.sort_by=s;var a=this.getUIComponents().getTable().getColumns();a.forEach(function(C){var h=C.getHeader();h.setText(h.dimension_label+(h.UOM?" ("+h.UOM+")":""))});c.setText(i[s]+" "+c.dimension_label+(c.UOM?" ("+c.UOM+")":""));var C=this.SELECTED_VIEW.findColumnByName(c.dimension_key);var b=C.getSortBy();this.TABLE_SORTING=[{name:b,order:s}];this.fetchDataForChart()},_appendUOMToTableHeader:function(r){if(this.UOM_APPENDED_TO_HEADER){return}var c=this.getUIComponents().getTable().getColumns();c.forEach(function(C){var a=C.getHeader().getText();var b=C.column_name;var o=this.SELECTED_VIEW.findColumnByName(b);if(o.isMeasure()){var u=this.MEASURE_UNIT_PROPERTY_MAPPING[b];if(u!==b){var d=r[u];if(d){C.getHeader().UOM=d;C.getHeader().setText(a+" ("+d+")")}}}},this);this.UOM_APPENDED_TO_HEADER=true},renderTable:function(t,c){var a=this;var b=this.getUIComponents().getTable();var C=(this.SELECTED_VIEW.getChartConfiguration())[0];b.removeAllColumns();var S=this.SELECTED_VIEW;var v=this._getVisibleColumns(t);this.COLUMNS_SORT=[];t.forEach(function(s,k,m){var o=this.SELECTED_VIEW.findColumnByName(s);if(o.getSortBy()&&o.getSortOrder()){if(o.getSortOrder()=="asc"||o.getSortOrder()=="desc"){this.COLUMNS_SORT.push({name:o.getSortBy(),order:o.getSortOrder()})}}},this);var d=false;if((this.EVALUATION.getScaling()==-2)&&!((C.isPercentageValue())&&(C.getChartType().isBar()||C.getChartType().isColumn()))){d=this._isMeasureSetPercentScaled(this.SELECTED_VIEW.getMeasures())}var e=[];if(d){if((C.isDualAxis())&&(C.isAbsoluteValue())&&(C.getChartType().isBar()||C.getChartType().isColumn())){var f=this._getMeasuresByAxis();e.push(this._isMeasureSetPercentScaled(f.axis1Msr));e.push(this._isMeasureSetPercentScaled(f.axis2Msr))}}var g=new sap.m.ColumnListItem();for(var i=0,l=v.length;i<l;i++){var o=this.SELECTED_VIEW.findColumnByName(v[i]);var L=new sap.m.Label({text:this.COLUMN_LABEL_MAPPING[v[i]]}).addStyleClass("tableColumnHeader");L.dimension_key=v[i];L.dimension_label=this.COLUMN_LABEL_MAPPING[v[i]];L.attachBrowserEvent("click",function(){a._sortTableByColumnName(this)});var h=new sap.m.Column({hAlign:o.isMeasure()?"Right":"Left",styleClass:"qty",header:L,minScreenWidth:"Tablet",demandPopin:true,});h.column_name=v[i];if(o.isMeasure()){var j=this._getTableCell(v[i],c,d,e);g.addCell(j)}else{var j=new sap.m.Label({text:{path:this.DIMENSION_TEXT_PROPERTY_MAPPING[v[i]],formatter:this.getColumnValueFormatter(this.DIMENSION_TEXT_PROPERTY_MAPPING[v[i]],true)}});g.addCell(j)}b.addColumn(h)}b.bindAggregation("items","/data",g)},_abortPendingODataCalls:function(){var a=function(d){try{if(d){d.abort()}}catch(e){}};var b=function(o){if(o&&o.length){o.forEach(function(c){a(c)})}};a(this.DDA_CONFIG_ODATA_CALL_REF);a(this._bundled_evaluations_call_ref);a(this.EVALUATION_ODATA_CALL_REF);a(this.SEMANTIC_OBJECT_LINKS_ODATA_CALL_REF);b(this.SEMANTIC_OBJECT_BY_CONTEXT_LINKS_ODATA_CALL_REF);a(this.CHART_TABLE_DATA_ODATA_CALL_REF);a(this.FETCH_AGREGATION_VALUE_ODATA_CALL_REF)},onBack:function(e){this._abortPendingODataCalls();window.history.back()},_resetConfigurations:function(){this.TABLE_SORTING=null;this.UOM_APPENDED_TO_HEADER=null;this.setChartSelectionContextObject(null)},onViewChange:function(e){this._resetConfigurations();var s=e.getParameters()["selectedKey"];var A=sap.suite.smartbusiness.url.hash.getApplicationParameters();A["viewId"]=[s];sap.suite.smartbusiness.url.hash.setApplicationParameters(A)},_attachHashChangeEvent:function(){this.hashChanger=this.oRouter.oHashChanger;var t=this;if(this.hashChanger){try{if(!t.hashChangerAttached){this.hashChanger.attachEvent("hashChanged",this._proxyHashChangeListener);this.hashChanger.viewRef=this}t.hashChangerAttached=true}catch(e){jQuery.sap.log.error("Couldn't Attach HashChange Event")}}else{jQuery.sap.log.error("Router HashChanger Object Found NULL")}},getUrlFilters:function(){var p=sap.suite.smartbusiness.url.hash.getApplicationParameters(["viewId"]);var u=[];for(var k in p){var f=p[k];if(f&&f.length){f.forEach(function(F){var O={};O["NAME"]=k;O["OPERATOR"]="EQ";O["VALUE_1"]=F;O["VALUE_2"]="";O["TYPE"]="FI";u.push(O)})}}return u},getAllFilters:function(){var e=this.EVALUATION.getFilters()["results"]||[];return e.concat(this.getUrlFilters())},getAdditionFiltersForChipConfiguration:function(){var p=sap.suite.smartbusiness.url.hash.getApplicationParameters(["viewId"]);var u=[];if(p){for(var k in p){var f=p[k];if(f&&f.length){f.forEach(function(e){var t=[];t[0]=k;t[1]="EQ";t[2]=e;t[3]="";u.push(t)})}}}return u},_hideKpiHeaderIfRequired:function(){return;if(this.CONFIGURATION.getHeaders().length==0){return}try{var a=sap.suite.smartbusiness.url.hash.getApplicationParameters(["viewId"]);if(a){if(Object.keys(a).length){this.getUIComponents().getTileContainer().$().css("overflow","hidden");this.getUIComponents().getTileContainer().$().animate({height:"0px"});return}}this.getUIComponents().getTileContainer().$().animate({height:"156px"})}catch(e){jQuery.sap.log.error("Failed to Hide KPI Header : "+e)}},hashChangeListener:function(h){this.NEW_HASH=h?h.getParameter("newHash"):"";this.OLD_HASH=h?h.getParameter("oldHash"):"";var A=sap.suite.smartbusiness.url.hash.getApplicationParameters();var K="viewId";if(!A[K]){this.SELECTED_VIEW=this.CONFIGURATION.getDefaultView();if(this.SELECTED_VIEW){this.renderView(this.SELECTED_VIEW);A.viewId=[this.SELECTED_VIEW.getId()];sap.suite.smartbusiness.url.hash.setApplicationParameters(A,false);var a=sap.suite.smartbusiness.url.hash.getHash();window.location.replace("#"+a)}else{jQuery.sap.log.error("Evaluation does not have any views configured")}}else if(!this.SELECTED_VIEW){this.firstTimeFlag=true;this.SELECTED_VIEW=this.CONFIGURATION.findViewById(A[K][0]);if(this.SELECTED_VIEW){this._resetConfigurations();this.renderView(this.SELECTED_VIEW);this._hideKpiHeaderIfRequired();this._setViewComboBoxSelectedIndex();this.fetchKpiValue();this.fetchDataForChart();this._fixFacetListSelection()}else{jQuery.sap.log.error("The view with viewId : "+A[K][0]+" does not exist")}}else if(this.SELECTED_VIEW&&A[K][0]!=this.SELECTED_VIEW.getId()){this.SELECTED_VIEW=this.CONFIGURATION.findViewById(A[K][0]);if(this.firstTimeFlag){sap.suite.smartbusiness.cache.invalidateKpiDetailsCache()}this._setViewComboBoxSelectedIndex();this._resetConfigurations();this.renderView(this.SELECTED_VIEW);this.fetchKpiValue();this.fetchDataForChart();this._hideKpiHeaderIfRequired();this._fixFacetListSelection();this._refreshKpiHeaderTiles()}else{if(this.firstTimeFlag){sap.suite.smartbusiness.cache.invalidateKpiDetailsCache()}this._setViewComboBoxSelectedIndex();this._hideKpiHeaderIfRequired();this.fetchKpiValue();this.fetchDataForChart();this._fixFacetListSelection();this._refreshKpiHeaderTiles()}this.getUIComponents().getFilter().refreshFilter()},_refreshKpiHeaderTiles:function(){var h=this.getUIComponents().getTileContainer();sap.suite.smartbusiness.miniChartManager.hashChangeListner({allTiles:this.CONFIGURATION.getHeaders(),headerContainer:h,sapSystem:this.SAP_SYSTEM,urlFilters:this.getUrlFilters(),firstTimeFlag:this.firstTimeFlag});this.firstTimeFlag=true},_setViewComboBoxSelectedIndex:function(){try{this.getUIComponents().getChartToolbar()._oFirstDimensionSelect.setSelectedKey(this.SELECTED_VIEW.getId())}catch(e){jQuery.sap.log.error("Failed to Set Selected Index of View ComboBox")}},_fixFacetListSelection:function(){try{var f=this.getUIComponents().getFilter();var a=f.getFacetFilterReference();var u=sap.suite.smartbusiness.url.hash.getApplicationParameters(["viewId"]);var b=a.getLists();if(b.length){b.forEach(function(c){var d=c._techName;if(u[d]){var F=u[d];var i=c.getItems();if(i.length){i.forEach(function(g){var h=g.getBindingContext().getObject()[c._techName]||"";h=h.getTime?h.getTime()+"":h+"";if(F.indexOf(h)>-1){g.setSelected(true)}else{g.setSelected(false)}})}}else{var i=c.getItems();if(i.length){i.forEach(function(g){g.setSelected(false)})}}},this)}}catch(e){}},_getUniqueNavLinks:function(r,e){var u=[];var c=sap.suite.smartbusiness.url.hash.getSemanticObject()+"-"+sap.suite.smartbusiness.url.hash.getAction();r.forEach(function(s){var t=s.id.match(/-([^?~])*~([^?])*/g);t=t?t.toString():"";if(t){if(!e[t]){e[t]=t;if(s.id.indexOf(c)==-1){u.push(s)}}}});return u},_initExternalNavigationLinks:function(){this._OPEN_IN_LINKS={};var s=sap.suite.smartbusiness.url.hash.getSemanticObject();this._oExternalNavLinksSOPopover=new sap.m.ResponsivePopover({modal:false,showHeader:false,enableScrolling:true,verticalScrolling:true,horizontalScrolling:false,placement:sap.m.PlacementType.Top,contentWidth:"18rem",});var a=new Date().getTime();var b={};if(this.CHIP_ID){b["chipId"]=this.CHIP_ID}if(this._EVALUATION_ID){b["evaluationId"]=this._EVALUATION_ID}this.SEMANTIC_OBJECT_LINKS_ODATA_CALL_REF=sap.suite.smartbusiness.navigation.getLinksBySemanticObject({success:function(r){var e=new Date().getTime();this._requestTimeLog["SEMANTIC_OBJECT_LINKS"]={title:"Semantic Object Links",time:e-a};r=this._getUniqueNavLinks(r,this._OPEN_IN_LINKS);if(r.length){var m=new sap.ui.model.json.JSONModel({"EXTERNAL_APP_LINKS":r});var l=new sap.m.List({});l.bindItems("/EXTERNAL_APP_LINKS",new sap.m.StandardListItem({title:"{text}",customData:new sap.ui.core.CustomData({key:"{id}",value:"{applicationAlias}"}),type:sap.m.ListType.Navigation,press:jQuery.proxy(this._onAppSelection,this,{publishContext:true,isFromOpenIn:true})})).setModel(m);this._oExternalNavLinksSOPopover.removeAllContent();this._oExternalNavLinksSOPopover.addContent(l)}else{this.setHeaderFooterOptionsWithoutOpenInButton()}},async:false,error:function(e){jQuery.sap.log.error("Error fetching navigation links by semantic object : "+s);this.setHeaderFooterOptionsWithoutOpenInButton()},semanticObject:s,businessParam:b,context:this})},_showExternalNavigationLinks:function(s){if(!this._oExternalNavLinksSOPopover.isOpen()){this._oExternalNavLinksSOPopover.openBy(s)}},_toggleFilter:function(){var c=this;var f=this.getUIComponents().getFilter();if(!f.getSelectedItems()){f.setVisible(!f.getVisible())}else if(f.getSelectedItems()&&f.getVisible()==true){this.oI18nModel=c.getView().getModel("i18n");sap.m.MessageBox.alert(c.oI18nModel.getResourceBundle().getText("Do_you_really_want_to_reset_the_filters?"),{onClose:function(e){if(e=="OK"){f.resetFilter();f.setVisible(false)}else if(e=="CANCEL"){f.setVisible(true)}},title:c.oI18nModel.getResourceBundle().getText("Reset_Filters"),actions:[sap.m.MessageBox.Action.OK,sap.m.MessageBox.Action.CANCEL]})}},setHeaderFooterOptionsWithoutOpenInButton:function(){var o=this.getHeaderFooterOptions();o.buttonList=[];this.setHeaderFooterOptions(o);this.renderTitle()},getHeaderFooterOptions:function(){var o=this._getHeaderFooterOptions();var c=this;var i=c.getView().getModel("i18n");var a=sap.ui.Device.os.name;if(a&&a!=sap.ui.Device.os.OS.IOS){o.additionalShareButtonList.push({sBtnTxt:i.getResourceBundle().getText("EXPORT_AS_EXCEL"),sIcon:"sap-icon://excel-attachment",onBtnPressed:function(e){c._exportAsExcel()}})}if((window.location.hostname=="localhost")||(jQuery.sap.getUriParameters().get("sbcmode")=="99")){o.additionalShareButtonList.push({sBtnTxt:"Enable Compact Mode",sIcon:"sap-icon://resize",onBtnPressed:function(e){if(c._compactMode){c.getView().removeStyleClass("sapUiSizeCompact");c._compactMode=false;e.getSource().setText("Enable Compact Mode")}else{c.getView().addStyleClass("sapUiSizeCompact");c._compactMode=true;e.getSource().setText("Disable Compact Mode")}jQuery(window).trigger("resize")}})}if((window.location.hostname=="localhost")||(jQuery.sap.getUriParameters().get("sbrequestlog")=="99")){o.additionalShareButtonList.push({sBtnTxt:"Request-Time Log",sIcon:"sap-icon://time-entry-request",onBtnPressed:function(e){c._performance.start(c._requestTimeLog,c._compactMode)}})}var E=["NT","AT","TT"];if(E.indexOf(this.TILE_TYPE)>-1){o.additionalShareButtonList.push({sBtnTxt:i.getResourceBundle().getText("SAVE_AS_TILE"),sIcon:"sap-icon://add-favorite",onBtnPressed:function(e){c._openAddToHomeDialogBox()}})}return o},_getHeaderFooterOptions:function(){var c=this;var i=c.getView().getModel("i18n");this.oListItem=new sap.m.ObjectListItem();var a=String.fromCharCode(0xe078);var o={onBack:function(){c._abortPendingODataCalls();window.history.back()},sFullscreenTitle:"",onFacetFilter:function(){c._toggleFilter();$(window).trigger('resize')},buttonList:[{sBtnTxt:i.getResourceBundle().getText("OPEN_IN_LABEL"),onBtnPressed:function(e){c._showExternalNavigationLinks(e.getSource())}}],bSuppressBookmarkButton:true,oJamOptions:{fGetShareSettings:function(){var h=c.getView().byId("header-ribbon");var l=new sap.m.ObjectListItem();l.setTitle(h.getTitle());l.setNumber(h.getNumber());l.setNumberUnit(h.getNumberUnit());var s={object:{id:window.location.href,display:l,share:"SAP Smart Business"}};return s},},additionalShareButtonList:[],oEmailSettings:{fGetMailBody:function(){var h=c.getView().byId("header-ribbon");if(h.getNumberUnit()){return"("+c.EVALUATION.getKpiName().trim()+"/"+h.getTitle().trim()+": "+h.getNumber()+" "+(h.getNumberUnit())+")"+"\n"+window.location.href}else{return"("+c.EVALUATION.getKpiName().trim()+"/"+h.getTitle().trim()+": "+h.getNumber()+")"+"\n"+window.location.href}}},};return o},_initRequestTimeLogChart:function(){if((window.location.hostname=="localhost")||(jQuery.sap.getUriParameters().get("sbrequestlog")=="99")){jQuery.sap.require("sap.suite.ui.smartbusiness.drilldown.lib.Performance");this._performance=new sap.suite.ui.smartbusiness.drilldown.lib.Performance()}},addExportMethodToTable:function(){var t=this;sap.m.Table.prototype.exportData=sap.m.Table.prototype.exportData||function(s){jQuery.sap.require("sap.ui.core.util.Export");s=s||{};if(!s.rows){s.rows={path:"/data"}}var e=new sap.ui.core.util.Export(s);this.addDependent(e);return e}},_exportAsExcel:function(){var t=this;jQuery.sap.require("sap.ui.core.util.ExportTypeCSV");var c=[];var a=[];a=this.SELECTED_VIEW.getColumns();for(var i=0;i<a.length;i++){c.push(a[i]);var b=this.DIMENSION_TEXT_PROPERTY_MAPPING[a[i]];var u=this.MEASURE_UNIT_PROPERTY_MAPPING[a[i]];if(b&&b!=a[i]){c.push(b)}if(u){c.push(u)}}var d=jQuery.map(c,function(e){return{name:t.COLUMN_LABEL_MAPPING[e]||e,template:{content:{path:e,}}}});this.getUIComponents().getTable().exportData({exportType:new sap.ui.core.util.ExportTypeCSV({separatorChar:";"}),columns:d}).saveFile().always(function(){this.destroy()})},_openAddToHomeDialogBox:function(){this.oATHDialog.setModel(this.getView().getModel("i18n"),"i18n");this._compactMode?this.oATHDialog.addStyleClass("sapUiSizeCompact"):this.oATHDialog.removeStyleClass("sapUiSizeCompact");this.oATHDialog.open()},_initAddToHomeDialogBox:function(){var c=this;this.oATHDialogContent=new sap.ui.view({type:"XML",viewName:"sap.suite.ui.smartbusiness.drilldown.view.AddToHome",viewData:this});this.oATHDialog=new sap.m.Dialog({title:"{i18n>SAVE_AS_TILE_DIALOG_TITLE}",content:[this.oATHDialogContent],beginButton:new sap.m.Button({text:"{i18n>OK_BUTTON}",press:function(){c.oATHDialogContent.getController().publishTile(function(){c.oATHDialog.close()})}}),endButton:new sap.m.Button({text:"{i18n>CANCEL_BUTTON}",press:function(){c.oATHDialog.close()}})});this.oATHDialog.addStyleClass("sbAddToHomeDialogBox");this.getView().addDependent(this.oATHDialog)},getUIComponents:function(){var p=this.getView().byId("smartbusiness_drilldown_page");var c=this.getView().byId("chartToolbar");var h=this.getView().byId("header-ribbon");var t=this.getView().byId("header-container");var f=this.getView().byId("facetFilter");var a=this;return{getChart:function(){return a.chart},getTable:function(){return a.table},getChartToolbar:function(){return c},getFilter:function(){return f},getHeader:function(){return h},getTileContainer:function(){return t},getPage:function(){return p}}},onExit:function(){this._abortPendingODataCalls();this._detachHashChangeListener()}})};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.lib.DrilldownConfiguration')){jQuery.sap.declare("sap.suite.ui.smartbusiness.lib.DrilldownConfiguration");sap.suite=sap.suite||{};sap.suite.smartbusiness=sap.suite.smartbusiness||{};sap.suite.smartbusiness.ddaconfig=sap.suite.smartbusiness.ddaconfig||{};sap.suite.smartbusiness.ddaconfig.Header=function(h){this.oHeader=h};sap.suite.smartbusiness.ddaconfig.Header.prototype={getVisualizationType:function(){return this.oHeader.VISUALIZATION_TYPE},getReferenceEvaluationId:function(){return this.oHeader.REFERENCE_EVALUATION_ID},getConfigurationId:function(){return this.oHeader.CONFIGURATION_ID},getEvaluationId:function(){return this.oHeader.EVALUATION_ID},getVisualizationOrder:function(){return this.oHeader.VISUALIZATION_ORDER},isVisible:function(){return this.oHeader.VISIBILITY==1},getEvaluation:function(){var t=this;var D=this.oHeader.REFERENCE_EVALUATION_INFO;return{getTitle:function(){if(D&&D.TITLE){return D.TITLE}else{return""}},getSubtitle:function(){if(D&&D.INDICATOR_TITLE){return D.INDICATOR_TITLE}else{return""}}}},isAssociated:function(){if(this.getReferenceEvaluationId()){if(this.getReferenceEvaluationId()!==this.getEvaluationId()){return true}}return false},isDimensionRequired:function(){return this.getVisualizationType()=="TREND"||this.getVisualizationType()=="COMPARISION"},getDimension:function(){return this.oHeader.DIMENSION},getMeasure:function(){return this.oHeader.MEASURE},getVisibility:function(){return this.oHeader.VISIBILITY},getConfiguration:function(){var d=[{name:"",color:"Good"},{name:"",color:"Critical"},{name:"",color:"Error"}];var a={order:"desc",by:"M"};var b={MEASURES:d,SORTING:a};if(this.oHeader.CONFIGURATION){try{b=JSON.parse(this.oHeader.CONFIGURATION);b.MEASURES=b.MEASURES?JSON.parse(b.MEASURES):d;b.SORTING=b.SORTING?JSON.parse(b.SORTING):a}catch(e){}}return b}};sap.suite.smartbusiness.ddaconfig.Chart=function(c){this.oChart=c};sap.suite.smartbusiness.ddaconfig.Chart.prototype={getValueType:function(){return this.oChart.VALUE_TYPE},getAxisType:function(){return this.oChart.AXIS_TYPE},getThresholdMeasure:function(){return this.oChart.THRESHOLD_MEASURE},getChartType:function(){var _=this;return{isBar:function(){return _.oChart.CHART_TYPE.toUpperCase()=="BAR"},isColumn:function(){return _.oChart.CHART_TYPE.toUpperCase()=="COLUMN"},isLine:function(){return _.oChart.CHART_TYPE.toUpperCase()=="LINE"},isCombinationChart:function(){return _.oChart.CHART_TYPE.toUpperCase()=="COMBINATION"},isTable:function(){return _.oChart.CHART_TYPE.toUpperCase()=="TABLE"},isBubble:function(){return _.oChart.CHART_TYPE.toUpperCase()=="BUBBLE"},getText:function(){return _.oChart.CHART_TYPE}}},getColorScheme:function(){var t=this;return{getText:function(){return t.oChart.COLOR_SCHEME},isManual:function(){return t.oChart.COLOR_SCHEME=="MANUAL_NON_SEMANTIC"||t.oChart.COLOR_SCHEME=="MANUAL_SEMANTIC"},isManualSemantic:function(){return t.oChart.COLOR_SCHEME=="MANUAL_SEMANTIC"},isManualNonSematic:function(){return t.oChart.COLOR_SCHEME=="MANUAL_NON_SEMANTIC"},isAutoSemantic:function(){return t.oChart.COLOR_SCHEME=='AUTO_SEMANTIC'}}},getDataLimit:function(){return this.oChart.DATA_LIMIT},isAbsoluteValue:function(){return this.getValueType()=="ABSOLUTE"},isPercentageValue:function(){return this.getValueType()=="PERCENTAGE"},isSingleAxis:function(){return this.getAxisType()=="SINGLE"},isDualAxis:function(){return this.getAxisType()=="DUAL"},isStackingEnabled:function(){return false}};sap.suite.smartbusiness.ddaconfig.Column=function(){};sap.suite.smartbusiness.ddaconfig.Column.prototype={getName:function(){return this.oParam.NAME},getSortBy:function(){return this.oParam.SORT_BY},getSortOrder:function(){return this.oParam.SORT_ORDER},getType:function(){return this.oParam.TYPE},getVisibility:function(){return this.oParam.VISIBILITY},isVisibleInChart:function(){return this.oParam.VISIBILITY=="BOTH"||this.oParam.VISIBILITY=="CHART"},isVisibleInTable:function(){return this.oParam.VISIBILITY=="BOTH"||this.oParam.VISIBILITY=="TABLE"},getColor:function(){return this.oParam.COLOR},isStacked:function(){return this.oParam.STACKING==1},getStacking:function(){return this.oParam.STACKING},isDimension:function(){return this.getType().toUpperCase()=="DIMENSION"},isMeasure:function(){return this.getType().toUpperCase()=="MEASURE"},getAxis:function(){return this.oParam.AXIS}};sap.suite.smartbusiness.ddaconfig.Dimension=function(p){this.oParam=p};sap.suite.smartbusiness.ddaconfig.Dimension.prototype=new sap.suite.smartbusiness.ddaconfig.Column();sap.suite.smartbusiness.ddaconfig.Measure=function(p){this.oParam=p};sap.suite.smartbusiness.ddaconfig.Measure.prototype=new sap.suite.smartbusiness.ddaconfig.Column();sap.suite.smartbusiness.ddaconfig.Filter=function(p){this.oFilter=p};sap.suite.smartbusiness.ddaconfig.Filter.prototype={getName:function(){return this.oFilter.DIMENSION},isVisible:function(){return this.oFilter.VISIBILITY==1}};sap.suite.smartbusiness.ddaconfig.View=function(p){this._viewId=p.CONFIGURATION_ID;this._evaluationId=p.EVALUATION_ID;this._title=p.TEXT;this._order=p.CONFIG_ORDER;this._columns=[];this._dimensions=[];this._measures=[];this._filters=[];this._dimensionMap={};this._measureMap={};this._filterMap={};this._headers=[],this._chartConfig=[];this._additionalLanguageTitles=[]};sap.suite.smartbusiness.ddaconfig.View.prototype={getTitle:function(){return this._title},getId:function(){return this._viewId},getEvaluationId:function(){return this._evaluationId},getViewOrder:function(){return this._order},getFilters:function(){return this._filters},getColumns:function(){return this._columns},getDimensions:function(){return this._dimensions},getMeasures:function(){return this._measures},findDimensionByName:function(d){if(this._dimensionMap[d]){return this._dimensionMap[d]}else{throw new Error("Invalid Dimension Name : "+d)}},findMeasureByName:function(m){if(this._measureMap[m]){return this._measureMap[m]}else{throw new Error("Invalid Dimension Name : "+m)}},findColumnByName:function(c){if(this._dimensionMap[c]){return this._dimensionMap[c]}else if(this._measureMap[c]){return this._measureMap[c]}else{throw new Error("Invalid Column Name : "+c)}},getHeaders:function(){return this._headers},getChartConfiguration:function(){return this._chartConfig},getAdditionalLanguageTitles:function(){return this._additionalLanguageTitles}};sap.suite.smartbusiness.ddaconfig.View.setDimensionAndMeasures=function(c,t){c.forEach(function(v,i,a){if(v.CONFIGURATION_ID==this.getId()){this._columns.push(v.NAME);if(v.TYPE.toUpperCase()=="MEASURE"){this._measureMap[v.NAME]=new sap.suite.smartbusiness.ddaconfig.Measure(v);this._measures.push(v.NAME)}else if(v.TYPE.toUpperCase()=="DIMENSION"){this._dimensionMap[v.NAME]=new sap.suite.smartbusiness.ddaconfig.Dimension(v);this._dimensions.push(v.NAME)}}},t)};sap.suite.smartbusiness.ddaconfig.View.setFilters=function(f,t){f.forEach(function(v,i,a){this._filters.push(v.DIMENSION);this._filterMap[v.DIMENSION]=new sap.suite.smartbusiness.ddaconfig.Filter(v)},t)};sap.suite.smartbusiness.ddaconfig.View.setConfig=function(c,t){var S=sap.suite.smartbusiness.ddaconfig.Configuration.Constants;for(var e in S){var f=S[e].func;if(jQuery.sap.startsWith(f,"is")){sap.suite.smartbusiness.ddaconfig.View.prototype[f]=function(){return true}}else{sap.suite.smartbusiness.ddaconfig.View.prototype[f]=function(){return null}}}c.forEach(function(v,i,a){var b=S[v.PROPERTY_TYPE];if(b){var f=b.func;if(jQuery.sap.startsWith(f,"is")){sap.suite.smartbusiness.ddaconfig.View.prototype[f]=function(){return v.VISIBILITY==1}}else{sap.suite.smartbusiness.ddaconfig.View.prototype[f]=function(){return v.PROPERTY_VALUE}}}else{jQuery.sap.log.error("Unknown Property_Name : "+v.PROPERTY_TYPE)}},t)};sap.suite.smartbusiness.ddaconfig.View.setHeader=function(h,t){if(h.length){h.forEach(function(v,i,a){this.getHeaders().push(new sap.suite.smartbusiness.ddaconfig.Header(v))},t);t.getHeaders().sort(function(o,a){if(o.VISUALIZATION_ORDER>a.VISUALIZTION_ORDER){return 1}return-1})}};sap.suite.smartbusiness.ddaconfig.View.setChart=function(c,t){if(c.length){c.forEach(function(v,i,a){if(this.getId()==v.CONFIGURATION_ID){this.getChartConfiguration().push(new sap.suite.smartbusiness.ddaconfig.Chart(v))}},t)}};sap.suite.smartbusiness.ddaconfig.View.setAdditionalLanguageTitles=function(m,t){if(m.length){m.forEach(function(v,i,a){if(this.getId()==v.CONFIGURATION_ID){this.getAdditionalLanguageTitles().push(v)}},t)}};sap.suite.smartbusiness.ddaconfig.Configuration=function(e,M){this.evaluationId=e;var d=null;this.MODE=!!M;var b={};var _=true;var c=jQuery.sap.getUriParameters().get("debug_ddaconfig")=="true";var f=-1;var g=function(m,C,H,F,o,k,l){m.forEach(function(v,i,a){var n=v.CONFIGURATION_ID;if(n){f++;var O=new sap.suite.smartbusiness.ddaconfig.View(v);b[n]=O;if(f==0){d=n}sap.suite.smartbusiness.ddaconfig.View.setConfig(C,O);sap.suite.smartbusiness.ddaconfig.View.setDimensionAndMeasures(o,O);sap.suite.smartbusiness.ddaconfig.View.setFilters(F,O);sap.suite.smartbusiness.ddaconfig.View.setHeader(H,O);sap.suite.smartbusiness.ddaconfig.View.setChart(k,O);sap.suite.smartbusiness.ddaconfig.View.setAdditionalLanguageTitles(l,O);_=false}})};this.getMaxViewOrder=function(){var m=0;for(var v in b){m=Math.max(m,b[v].getViewOrder())}return m};this.hasNoConfiguration=function(){return _};this.findViewById=function(i){if(b[i]){return b[i]}return null},this.getDefaultViewId=function(){return d},this.getDefaultView=function(){if(d){return b[d]}return null};this.removeViewById=function(v){delete b[v]};this.removeAllViews=function(v){b={}};this.getAllViews=function(){var v=[];for(var a in b){var t={};t["ID"]=a;t["TITLE"]=b[a].getTitle()||"-NA- ("+a+")";v.push(t)}return v};this.getTree=function(){var t={name:"Evaluation",children:[]};var a=this.getAllViews();for(var i in a){var k={name:a[i].TITLE||"NA",children:[]};var v=this.findViewById(a[i].ID);var m=v.getMeasures();var l={name:"measures",children:[]};k.children.push(l);m.forEach(function(r,s,u){l.children.push({name:r,children:[]})},this);var n=v.getDimensions();var o={name:"dimensions",children:[]};k.children.push(o);n.forEach(function(r,s,u){o.children.push({name:r,children:[]})},this);var p=v.getHeaders();var q={name:"header",children:[]};k.children.push(q);p.forEach(function(i){var r={name:"1",children:[]};q.children.push(r);r.children.push({name:"Visualization Type = "+i.getVisualizationType(),children:[]});r.children.push({name:"Reference Evaluation = "+i.getReferenceEvaluationId(),children:[]})});t.children.push(k)}return t};var h=function(u){return jQuery.sap.encodeURL(u)};var j=function(){var t=this;var D=null;var s="/sap/hba/r/sb/core/odata/modeler/SMART_BUSINESS.xsodata";if(sap.suite.smartbusiness.odata){D=sap.suite.smartbusiness.odata.getModelByServiceUri(s)}else{D=new sap.ui.model.odata.ODataModel(s,true)}var m="/DDA_MASTER?$filter="+h("EVALUATION_ID eq '"+this.evaluationId+"'")+"&$orderby=CONFIG_ORDER";var a="/DDA_CONFIG?$filter="+h("EVALUATION_ID eq '"+this.evaluationId+"'");var i="/DDA_HEADER?$expand=REFERENCE_EVALUATION_INFO&$filter="+h("EVALUATION_ID eq '"+this.evaluationId+"'");var k="/DDA_FILTERS?$filter="+h("EVALUATION_ID eq '"+this.evaluationId+"'");var l="/DDA_COLUMNS?$filter="+h("EVALUATION_ID eq '"+this.evaluationId+"'")+"&$orderby=COLUMNS_ORDER";var n="/DDA_CHART?$filter="+h("EVALUATION_ID eq '"+this.evaluationId+"'");var o="/DDA_MASTER_TEXT?$filter="+h("EVALUATION_ID eq '"+this.evaluationId+"'");var r=D.createBatchOperation(m,"GET");var p=D.createBatchOperation(a,"GET");var q=D.createBatchOperation(i,"GET");var u=D.createBatchOperation(k,"GET");var v=D.createBatchOperation(l,"GET");var w=D.createBatchOperation(n,"GET");var x=D.createBatchOperation(o,"GET");D.addBatchReadOperations([r,p,q,u,v,w,x]);D.submitBatch(function(y,z){var A=y.__batchResponses;if(c){jQuery.sap.log.info("DDA-MASTER : ",JSON.stringify(A[0]));jQuery.sap.log.info("DDA-CONFIG : ",JSON.stringify(A[1]));jQuery.sap.log.info("DDA-HEADER : ",JSON.stringify(A[2]));jQuery.sap.log.info("DDA-FILTERS : ",JSON.stringify(A[3]));jQuery.sap.log.info("DDA-COLUMNS : ",JSON.stringify(A[4]));jQuery.sap.log.info("DDA-CHART : ",JSON.stringify(A[5]));jQuery.sap.log.info("DDA-MASTER-TEXT : ",JSON.stringify(A[6]))}sap.suite.smartbusiness.ddaconfig.MasterData={};sap.suite.smartbusiness.ddaconfig.MasterData.MASTER=A[0].data.results;sap.suite.smartbusiness.ddaconfig.MasterData.CONFIG=A[1].data.results;sap.suite.smartbusiness.ddaconfig.MasterData.HEADER=A[2].data.results;sap.suite.smartbusiness.ddaconfig.MasterData.FILTERS=A[3].data.results;sap.suite.smartbusiness.ddaconfig.MasterData.COLUMNS=A[4].data.results;sap.suite.smartbusiness.ddaconfig.MasterData.CHART=A[5].data.results;g.call(t,A[0].data.results,A[1].data.results,A[2].data.results,A[3].data.results,A[4].data.results,A[5].data.results,A[6].data.results)},function(y){throw new Error("Failed to fetch DDA Configuration")},false)};j.call(this)};sap.suite.smartbusiness.ddaconfig.Configuration.Constants={SAP_FILTER:{desc:"Flag whether filter is enabled",func:"isFilterEnabled"},SAP_HEADER:{desc:"Flag whether header is enabled",func:"isHeaderEnabled"},SAP_AGGREGATE_VALUE:{desc:"Flag whether aggregate kpi value is enabled",func:"isAggregateValueEnabled"},QUERY_SERVICE_URI:{desc:"Evaluation Query Service Uri",func:"getQueryServiceUri"},QUERY_ENTITY_SET:{desc:"Result path for the query service uri",func:"getEntitySet"}};sap.suite.smartbusiness.ddaconfig.writeservices=(function(){var _=null;return{getInstance:function(f){jQuery.sap.require("sap.suite.ui.smartbusiness.lib.DrilldownWriteService");if(_&&!f){return _}else{_=new sap.suite.smartbusiness.ddaconfig.DrilldownWriteService()}return _}}})()};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.lib.DrilldownModel')){jQuery.sap.declare("sap.suite.ui.smartbusiness.lib.DrilldownModel");sap.suite=sap.suite||{};sap.suite.smartbusiness=sap.suite.smartbusiness||{};sap.suite.smartbusiness.ddaconfig=sap.suite.smartbusiness.ddaconfig||{};sap.suite.smartbusiness.ddaconfig.Model=function(e,v,i){this.ddaConfigurator=null;this.viewId=v;this.selectedView=null;this.i18nModel=i;this.evaluationId=e;if(this.evaluationId){this._init()}};sap.suite.smartbusiness.ddaconfig.Model._instances={};sap.suite.smartbusiness.ddaconfig.Model.languageTexts={ALL_LANGUAGES:[],CURRENT_LANGUAGE:[],isLoaded:false};sap.suite.smartbusiness.ddaconfig.Model.getInstance=function(e,f,i){function g(a){var m=new sap.suite.smartbusiness.ddaconfig.Model(a,null,i);sap.suite.smartbusiness.ddaconfig.Model._instances[a]=m;return sap.suite.smartbusiness.ddaconfig.Model._instances[a]}if(f){return g(e,null,i)}if(sap.suite.smartbusiness.ddaconfig.Model._instances[e]){return sap.suite.smartbusiness.ddaconfig.Model._instances[e]}else{return g(e,null,i)}};sap.suite.smartbusiness.ddaconfig.Model.prototype={_init:function(e){this.ddaConfigurator=new sap.suite.smartbusiness.ddaconfig.Configuration(this.evaluationId);this.EVALUATION_DATA=sap.suite.smartbusiness.kpi.getEvaluationById({id:this.evaluationId,cache:true,filters:true,thresholds:true});this._setModel()},NEW_VIEWID:"~NA~",_setModel:function(){this._oModel=new sap.ui.model.json.JSONModel(this.getModelDataForDDAConfiguration());try{this._oModel.setSizeLimit(9999)}catch(e){}},removeAllViews:function(){this.getConfigurator().removeAllViews();this._oModel.setData(this.getModelDataForDDAConfiguration())},bindModel:function(c,n){if(n){c.setModel(this._oModel,n)}else{c.setModel(this._oModel)}this._oModel.refresh()},getConfigurator:function(){return this.ddaConfigurator},setEvaluationId:function(e){this.evaluationId=e;this._init()},setViewId:function(v){this.viewId=v;this.selectedView=this.ddaConfigurator.findViewById(this.viewId);this._setModel()},fetchLanguageData:function(n,s){if(sap.suite.smartbusiness.ddaconfig.Model.languageTexts.isLoaded){s({ALL_LANGUAGES:sap.suite.smartbusiness.ddaconfig.Model.languageTexts.ALL_LANGUAGES,CURRENT_LANGUAGE:sap.suite.smartbusiness.ddaconfig.Model.languageTexts.CURRENT_LANGUAGE})}else{var l=sap.ui.getCore().getConfiguration().getLocale().getLanguage().toUpperCase();new sap.ui.model.odata.ODataModel("/sap/hba/r/sb/core/odata/modeler/SMART_BUSINESS.xsodata",true).read("/LANGUAGE?$select=SPRAS,LAISO",null,null,true,function(d){sap.suite.smartbusiness.ddaconfig.Model.languageTexts.isLoaded=true;var a={ALL_LANGUAGES:[],CURRENT_LANGUAGE:[]};for(var i=0;i<d.results.length;++i){if(d.results[i]["LAISO"]==l){a["CURRENT_LANGUAGE"]=d.results[i]["SPRAS"];d.results.splice(i,1);break}}a["ALL_LANGUAGES"]=d.results;sap.suite.smartbusiness.ddaconfig.Model.languageTexts.ALL_LANGUAGES=a["ALL_LANGUAGES"];sap.suite.smartbusiness.ddaconfig.Model.languageTexts.CURRENT_LANGUAGE=a["CURRENT_LANGUAGE"];s(a)})}},_getEvalData:function(i){try{var a=sap.suite.smartbusiness.kpi.getEvaluationById({id:i,cache:true,filters:false,thresholds:false,getDDAEvaluation:true});return a}catch(e){return{}}},getDefaultModelData:function(){var t=this;try{var d=sap.suite.smartbusiness.odata.getAllDimensions(this.EVALUATION_DATA.ODATA_URL,this.EVALUATION_DATA.ODATA_ENTITYSET);var m=sap.suite.smartbusiness.odata.getAllMeasures(this.EVALUATION_DATA.ODATA_URL,this.EVALUATION_DATA.ODATA_ENTITYSET);var p=sap.suite.smartbusiness.odata.properties(this.EVALUATION_DATA.ODATA_URL,this.EVALUATION_DATA.ODATA_ENTITYSET);var C=p.getLabelMappingObject()}catch(e){var d=[];var m=[]}function _(i){return t._getEvalData(i).INDICATOR_TITLE}function a(i){return t._getEvalData(i).TITLE}function b(i){return t._getEvalData(i).INDICATOR}function g(){var f=[];for(var i=0;i<m.length;i++){f.push({NAME:m[i],LABEL:C[m[i]]})}return f}var c={CONFIG:{SAP_AGGREGATE_VALUE:true},ID_EDITABLE:true,INDICATOR:this.EVALUATION_DATA.INDICATOR,ID:"",TITLE:"",EVALUATION_TITLE:this.EVALUATION_DATA.TITLE,QUERY_SERVICE_URI:this.EVALUATION_DATA.ODATA_URL,QUERY_ENTITY_SET:this.EVALUATION_DATA.ODATA_ENTITYSET,TEXT:"",MAIN_MEASURE:"",THRESHOLD_MEASURE:"",ALL_DIMENSIONS:d,ALL_MEASURES:m,ALL_MEASURES_LABELS:g(),VALUE_TYPES:[{key:"ABSOLUTE",text:this.i18nModel.getProperty("ABSOLUTE_VALUES")},{key:"PERCENTAGE",text:this.i18nModel.getProperty("PERCENTAGE_VALUES")}],AXIS_TYPES:[{key:"SINGLE",text:this.i18nModel.getProperty("SINGLE_AXIS")},{key:"DUAL",text:this.i18nModel.getProperty("DUAL_AXIS")}],AXIS_TYPE:"SINGLE",VALUE_TYPE:"ABSOLUTE",CHART_TYPE:"Column",CHART_TYPES:[{key:"Bar",text:this.i18nModel.getProperty("BARS")},{key:"Column",text:this.i18nModel.getProperty("COLUMNS")},{key:"Line",text:this.i18nModel.getProperty("LINES")},{key:"Combination",text:this.i18nModel.getProperty("COLUMNS_AND_LINES")},{key:"Bubble",text:this.i18nModel.getProperty("BUBBLES")},{key:"Table",text:this.i18nModel.getProperty("TABLE")}],DATA_MODES:[{key:"DUMMY",text:this.i18nModel.getProperty("DUMMY_DATA")},{key:"RUNTIME",text:this.i18nModel.getProperty("ACTUAL_BACKEND_DATA")}],DATA_MODE:"DUMMY",DATA_LIMIT:200,DATA_LIMITATIONS:false,COLOR_SCHEME:"NONE",COLOR_SCHEMES:[{key:"AUTO_SEMANTIC",text:this.i18nModel.getProperty("AUTO_SEMANTIC_COLORS")},{key:"MANUAL_SEMANTIC",text:this.i18nModel.getProperty("MANUAL_SEMANTIC_COLORS")},{key:"MANUAL_NON_SEMANTIC",text:this.i18nModel.getProperty("MANUAL_COLORS")},{key:"NONE",text:this.i18nModel.getProperty("DEFAULT_COLORS")}],"MANUAL_NON_SEMANTIC":[{color:sap.ca.ui.charts.ChartColor.sapUiChart1,index:0},{color:sap.ca.ui.charts.ChartColor.sapUiChart2,index:1},{color:sap.ca.ui.charts.ChartColor.sapUiChart3,index:2},{color:sap.ca.ui.charts.ChartColor.sapUiChart4,index:3},{color:sap.ca.ui.charts.ChartColor.sapUiChart5,index:4},{color:sap.ca.ui.charts.ChartColor.sapUiChart6,index:5},{color:sap.ca.ui.charts.ChartColor.sapUiChart7,index:6},{color:sap.ca.ui.charts.ChartColor.sapUiChart8,index:7},{color:sap.ca.ui.charts.ChartColor.sapUiChart9,index:8},{color:sap.ca.ui.charts.ChartColor.sapUiChart10,index:9},{color:sap.ca.ui.charts.ChartColor.sapUiChart11,index:10}],"MANUAL_SEMANTIC":[{color:"sapCaUiChartSemanticColor-Neutral-Dark",index:0},{color:"sapCaUiChartSemanticColor-Neutral",index:1},{color:"sapCaUiChartSemanticColor-Neutral-Light",index:2},{color:"sapCaUiChartSemanticColor-Good-Dark",index:3},{color:"sapCaUiChartSemanticColor-Good",index:4},{color:"sapCaUiChartSemanticColor-Good-Light",index:5},{color:"sapCaUiChartSemanticColor-Critical-Dark",index:6},{color:"sapCaUiChartSemanticColor-Critical",index:7},{color:"sapCaUiChartSemanticColor-Critical-Light",index:8},{color:"sapCaUiChartSemanticColor-Bad-Dark",index:9},{color:"sapCaUiChartSemanticColor-Bad",index:10},{color:"sapCaUiChartSemanticColor-Bad-Light",index:11}],COLUMNS:[],SIBLING_EVALUATIONS:[],ASSOCIATED_EVALUATIONS:[],ADDITIONAL_LANGUAGE_TITLES:[],FILTERS:[],HEADER_EVALUATIONID:{},HEADERS_VISIBLE:[],HEADERS:[{EVALUATION_ID:this.evaluationId,CONFIGURATION_ID:this.NEW_VIEWID,REFERENCE_EVALUATION_ID:this.evaluationId,VISUALIZATION_TYPE:'NT',VISUALIZATION_TYPE_INDEX:0,VISUALIZATION_ORDER:1,DIMENSION:d[0],SORT_BY:"",SORT_ORDER:"MD",ALL_MEASURES:m,VISIBILITY:1,ALL_DIMENSIONS:d,visible:true,TITLE:_(this.evaluationId),SUBTITLE:a(this.evaluationId),GROUPING_TITLE:"",INDICATOR:b(this.evaluationId)},{EVALUATION_ID:this.evaluationId,CONFIGURATION_ID:this.NEW_VIEWID,REFERENCE_EVALUATION_ID:this.evaluationId,VISUALIZATION_TYPE:'AT',VISUALIZATION_TYPE_INDEX:1,VISUALIZATION_ORDER:1,DIMENSION:d[0],SORT_BY:"",SORT_ORDER:"MD",ALL_MEASURES:m,ALL_DIMENSIONS:d,VISIBILITY:1,visible:false,TITLE:_(this.evaluationId),SUBTITLE:a(this.evaluationId),GROUPING_TITLE:"",INDICATOR:b(this.evaluationId)},{EVALUATION_ID:this.evaluationId,CONFIGURATION_ID:this.NEW_VIEWID,REFERENCE_EVALUATION_ID:this.evaluationId,VISUALIZATION_TYPE:'CT',VISUALIZATION_TYPE_INDEX:2,VISUALIZATION_ORDER:1,DIMENSION:d[0],SORT_BY:"",SORT_ORDER:"MD",ALL_MEASURES:m,ALL_DIMENSIONS:d,VISIBILITY:1,visible:false,TITLE:_(this.evaluationId),SUBTITLE:a(this.evaluationId),GROUPING_TITLE:"",INDICATOR:b(this.evaluationId)},{EVALUATION_ID:this.evaluationId,CONFIGURATION_ID:this.NEW_VIEWID,REFERENCE_EVALUATION_ID:this.evaluationId,VISUALIZATION_TYPE:'TT',VISUALIZATION_TYPE_INDEX:3,VISUALIZATION_ORDER:1,DIMENSION:d[0],SORT_BY:"",SORT_ORDER:"MD",ALL_MEASURES:m,ALL_DIMENSIONS:d,VISIBILITY:1,visible:false,TITLE:_(this.evaluationId),SUBTITLE:a(this.evaluationId),GROUPING_TITLE:"",INDICATOR:b(this.evaluationId)},{EVALUATION_ID:this.evaluationId,CONFIGURATION_ID:this.NEW_VIEWID,REFERENCE_EVALUATION_ID:this.evaluationId,VISUALIZATION_TYPE:'CM',VISUALIZATION_TYPE_INDEX:4,VISUALIZATION_ORDER:1,DIMENSION:d[0],SORT_BY:"",SORT_ORDER:"MD",MEASURE1:m[0],MEASURE2:m[1]||m[0],MEASURE3:"",COLOR1:"Good",COLOR2:"Critical",COLOR3:"Error",ALL_MEASURES:m,ALL_DIMENSIONS:d,VISIBILITY:1,visible:false,TITLE:_(this.evaluationId),SUBTITLE:a(this.evaluationId),GROUPING_TITLE:_(this.evaluationId)+" "+a(this.evaluationId),INDICATOR:b(this.evaluationId)}],SELECTED_VIEW:"",ALL_VIEWS:this.ddaConfigurator.getAllViews(),ALL_LANGUAGES:[],CURRENT_LANGUAGE:"E"};c.HEADER_EVALUATIONID[this.evaluationId]=true;this.fetchLanguageData("SB_DDACONFIG_LANG",function(o){c.ALL_LANGUAGES=o.ALL_LANGUAGES;c.CURRENT_LANGUAGE=o.CURRENT_LANGUAGE});return c},getModelDataForDDAConfiguration:function(){var t=this;var c=["NT","AT","CT","TT","CM"];function g(n){return(n==-1||!n)?200:n}function _(I){try{var a=sap.suite.smartbusiness.kpi.getEvaluationById({id:I,cache:true,filters:true,thresholds:true});return sap.suite.smartbusiness.odata.getAllDimensions(a.ODATA_URL,a.ODATA_ENTITYSET)}catch(e){return[]}}function d(I){try{var a=sap.suite.smartbusiness.kpi.getEvaluationById({id:I,cache:true,filters:true,thresholds:true});return sap.suite.smartbusiness.odata.getAllMeasures(a.ODATA_URL,a.ODATA_ENTITYSET)}catch(e){return[]}}var m=sap.suite.smartbusiness.odata.getAllMeasures(this.EVALUATION_DATA.ODATA_URL,this.EVALUATION_DATA.ODATA_ENTITYSET);function f(I){var e=t._getEvalData(I);return(e&&e.INDICATOR_TITLE)?e.INDICATOR_TITLE:""}function h(I){var e=t._getEvalData(I);return(e&&e.TITLE)?e.TITLE:""}function j(I){var e=t._getEvalData(I);return(e&&e.INDICATOR)?e.INDICATOR:""}var k=this.getDefaultModelData();if(this.selectedView){var t=this;k.ALL_VIEWS=this.ddaConfigurator.getAllViews();k.SELECTED_VIEW=this.selectedView.getId();k.ID=this.selectedView.getId();k.TITLE=this.selectedView.getTitle();k.ADDITIONAL_LANGUAGE_TITLES=this.selectedView.getAdditionalLanguageTitles();k.ID_EDITABLE=false;var l=this.selectedView.getChartConfiguration()[0];k.THRESHOLD_MEASURE=l?l.getThresholdMeasure():"";k.AXIS_TYPE=l?l.getAxisType():"SINGLE";k.VALUE_TYPE=l?l.getValueType():"ABSOLUTE";k.CHART_TYPE=l?l.getChartType().getText():"Bar";k.DATA_LIMIT=l?g(l.getDataLimit()):200;k.DATA_LIMITATIONS=this.getDataLimitations();k.CONFIG.SAP_AGGREGATE_VALUE=this.selectedView.isAggregateValueEnabled();k.COLOR_SCHEME=l?l.getColorScheme().getText():"AUTO_SEMANTIC";if(this.selectedView.getHeaders().length){var o=this.selectedView.getHeaders();k.HEADERS=[];k.HEADERS_VISIBLE=[];var p={};k.HEADER_EVALUATIONID={};o.forEach(function(H){k.HEADER_EVALUATIONID[H.getReferenceEvaluationId()]=true;p[H.getReferenceEvaluationId()]=p[H.getReferenceEvaluationId()]||{};var m=d(H.getReferenceEvaluationId());var r=_(H.getReferenceEvaluationId());var a=H.getConfiguration();k.HEADERS_VISIBLE.push({EVALUATION_ID:t.evaluationId,CONFIGURATION_ID:k.SELECTED_VIEW,REFERENCE_EVALUATION_ID:H.getReferenceEvaluationId(),VISUALIZATION_TYPE:H.getVisualizationType(),VISUALIZATION_ORDER:H.getVisualizationOrder(),DIMENSION:H.getDimension()||r[0],SORT_BY:"",SORT_ORDER:a.SORTING.by+(a.SORTING.order=="desc"?+"D":"A"),MEASURE1:a.MEASURES[0].name||m[0],MEASURE2:a.MEASURES[1].name||m[1]||m[0],MEASURE3:a.MEASURES[2]?a.MEASURES[2].name:"",COLOR1:a.MEASURES[0].color||"Neutral",COLOR2:a.MEASURES[1].color||"Neutral",COLOR3:a.MEASURES[2]?a.MEASURES[2].color:"Neutral",ALL_MEASURES:m,ALL_DIMENSIONS:r,VISIBILITY:H.getVisibility(),visible:true,TITLE:f(H.getReferenceEvaluationId()),SUBTITLE:h(H.getReferenceEvaluationId()),INDICATOR:j(H.getReferenceEvaluationId())})});k.HEADERS_VISIBLE.sort(function(a,b){return a.VISUALIZATION_ORDER>b.VISUALIZATION_ORDER?1:-1});k.HEADER_EVALUATIONID[this.evaluationId]=true;p[this.evaluationId]=p[this.evaluationId]||{};var t=this;for(var q in p){var m=d(q);var r=_(q);c.forEach(function(s){k.HEADERS.push({EVALUATION_ID:t.evaluationId,CONFIGURATION_ID:k.SELECTED_VIEW,REFERENCE_EVALUATION_ID:q,VISUALIZATION_TYPE:s,VISUALIZATION_TYPE_INDEX:c.indexOf(s),VISUALIZATION_ORDER:1,DIMENSION:r[0],SORT_BY:"",SORT_ORDER:"MD",MEASURE1:m[0],MEASURE2:m[1]||m[0],MEASURE3:"",COLOR1:"Good",COLOR2:"Critical",COLOR3:"Error",ALL_MEASURES:m,ALL_DIMENSIONS:_(q),VISIBILITY:1,visible:false,TITLE:f(q),SUBTITLE:h(q),GROUPING_TITLE:f(q)+" "+h(q),INDICATOR:j(q)})})}}var u=this.selectedView.getColumns();for(var i=0;i<u.length;i++){var v=this.selectedView.findColumnByName(u[i]);k.COLUMNS.push({NAME:v.getName(),TYPE:v.getType(),COLOR1:k.COLOR_SCHEME=="MANUAL_NON_SEMANTIC"?v.getColor():"",COLOR2:k.COLOR_SCHEME=="MANUAL_SEMANTIC"?v.getColor():"",AXIS:v.getAxis(),SORT_ORDER:v.getSortOrder(),SORT_BY:v.getSortBy(),VISIBILITY:v.getVisibility(),STACKING:v.getStacking()})}var w=this.selectedView.getFilters();for(var i=0;i<w.length;i++){var x=w[i];k.FILTERS.push({name:x})}}return k},getDataLimitations:function(){var c=this.selectedView.getChartConfiguration()[0];if(c&&c.getDataLimit()!=-1){return true}else if(c&&c.getDataLimit()==-1){return false}}}};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.lib.DrilldownSaveService')){jQuery.sap.declare("sap.suite.ui.smartbusiness.lib.DrilldownSaveService");sap.suite=sap.suite||{};sap.suite.smartbusiness=sap.suite.smartbusiness||{};sap.suite.smartbusiness.ddaconfig=sap.suite.smartbusiness.ddaconfig||{};sap.suite.smartbusiness.ddaconfig.DrilldownSaveService={fetchXSRFToken:function(S,e){jQuery.ajax({type:"HEAD",async:false,dataType:"json",url:"/sap/hba/r/sb/core/logic/__token.xsjs",headers:{"X-CSRF-Token":"Fetch"},success:function(d,s,x){if(S)S(d,s,x)},error:function(){if(e)e(d,s,x)}})},constants:{"write":{fn:"getWritePayload"},"delete":{fn:"getDeletePayload"},"update":{fn:"getUpdatePayload"},"viewServiceUrl":"/sap/hba/r/sb/core/logic/ddaViewConfiguration_cud.xsjs","evalServiceUrl":"/sap/hba/r/sb/core/logic/ddaEvaluation_cud.xsjs"},doUpdate:function(c){var t=this;this.fetchXSRFToken(function(d,s,x){jQuery.ajax({url:sap.suite.smartbusiness.utils.appendUrlParameters(c.url),type:"PUT",headers:{"X-CSRF-Token":x.getResponseHeader("X-CSRF-Token"),"Accept-Language":sap.suite.smartbusiness.utils.getLocaleLanguage()},data:JSON.stringify(c.payload)}).done(c.success||function(){}).fail(c.error||function(){})},c.error)},doWrite:function(c){var t=this;this.fetchXSRFToken(function(d,s,x){jQuery.ajax({url:sap.suite.smartbusiness.utils.appendUrlParameters(c.url),type:"POST",headers:{"X-CSRF-Token":x.getResponseHeader("X-CSRF-Token"),"Accept-Language":sap.suite.smartbusiness.utils.getLocaleLanguage()},data:JSON.stringify(c.payload)}).done(c.success||function(){}).fail(c.error||function(){})},c.error)},doDelete:function(c){var t=this;this.fetchXSRFToken(function(d,s,x){jQuery.ajax({url:sap.suite.smartbusiness.utils.appendUrlParameters(c.url),type:"DELETE",headers:{"X-CSRF-Token":x.getResponseHeader("X-CSRF-Token"),"Accept-Language":sap.suite.smartbusiness.utils.getLocaleLanguage()},data:JSON.stringify(c.payload)}).done(c.success||function(){}).fail(c.error||function(){})},c.error)},doServiceCall:function(c){var t=this;if(c.type=="POST"){this.doWrite(c)}else if(c.type=="PUT"){this.doUpdate(c)}else if(c.type="DELETE"){this.doDelete(c)}},saveEvalConfiguration:function(e,d,a,s,E){var t=(a=="delete"?"DELETE":(a=="update"?"PUT":"POST"));if(this.constants[a]){this.doServiceCall({type:t,payload:this[this.constants[a].fn](e,d),url:this.constants.evalServiceUrl,success:s,error:E})}else{E("Service Failed. Unrecognized action "+a)}},saveViewConfiguration:function(e,d,a,s,E){a=d.ID_EDITABLE?"write":a;var t=(a=="delete"?"DELETE":(a=="update"?"PUT":"POST"));if(this.constants[a]){this.doServiceCall({type:t,payload:this[this.constants[a].fn](e,d,true),url:this.constants.viewServiceUrl,success:s,error:E})}else{E("Service Failed. Unrecognized action "+a)}},getUpdatePayload:function(e,d,i){return{payload:this.getWritePayload(e,d,i),keys:this.getDeletePayload(e,d,i)}},getWritePayload:function(e,d,i){var c=d.ID,r;if(i){r={DDA_COLUMNS:this.getColumnsPayload(d,e,c),DDA_CHART:this.getChartPayload(d,e,c),DDA_MASTER_TEXT:this.getViewTextPayload(d,e,c)};if(d.ID_EDITABLE){r.DDA_MASTER=this.getNewViewPayload(d.ALL_VIEWS,e,c)}}else{r={DDA_FILTERS:this.getFilterPayload(d.CURRENT_FILTERS,e,c),DDA_HEADER:this.getHeaderPayload(d.HEADERS_VISIBLE,e,c),DDA_CONFIGURATION:this.getConfigurationPayload(d,e,c)};var v=this.getViewOrderPayload(d.ALL_VIEWS,e,c);if(v.length){r.DDA_MASTER=v}}return r},getDeletePayload:function(e,d,i){return{"EVALUATION_ID":e,"CONFIGURATION_ID":d.ID}},getViewTextPayload:function(d,e,c){var v=[];var a=d.CURRENT_LANGUAGE,b=d.TITLE;d=d.ADDITIONAL_LANGUAGE_TITLES||[];for(var i=0;i<d.length;i++){if(d[i].SAP_LANGUAGE_KEY==a)continue;v.push({"CONFIGURATION_ID":c,"EVALUATION_ID":e,"SAP_LANGUAGE_KEY":d[i].SAP_LANGUAGE_KEY,"TEXT":d[i].TEXT,"IS_ACTIVE":1})}v.push({"CONFIGURATION_ID":c,"EVALUATION_ID":e,"SAP_LANGUAGE_KEY":a,"TEXT":b,"IS_ACTIVE":1});return v},getChartPayload:function(d,e,c){return[{"EVALUATION_ID":e,"CONFIGURATION_ID":c,"VALUE_TYPE":d.VALUE_TYPE,"AXIS_TYPE":d.AXIS_TYPE,"CHART_TYPE":d.CHART_TYPE,"DATA_LIMIT":d.DATA_LIMITATIONS?d.DATA_LIMIT:-1,"COLOR_SCHEME":d.COLOR_SCHEME,"IS_ACTIVE":1,"THRESHOLD_MEASURE":d.THRESHOLD_MEASURE}]},getColumnsPayload:function(d,e,c){var a=[];var b=d.COLOR_SCHEME;d=d.items||[];for(var i=0;i<d.length;i++){if(d[i].SELECTED)a.push({"EVALUATION_ID":e,"CONFIGURATION_ID":c,"NAME":d[i].NAME,"TYPE":d[i].TYPE.toUpperCase(),"SORT_BY":d[i].SORT_BY,"VISIBILITY":d[i].VISIBILITY,"COLOR":(b=="MANUAL_NON_SEMANTIC"?d[i].COLOR1:b=="MANUAL_SEMANTIC"?d[i].COLOR2:"")||"","STACKING":d[i].STACKING,"AXIS":d[i].AXIS,"SORT_ORDER":d[i].SORT_ORDER,"COLUMNS_ORDER":i,"IS_ACTIVE":1})}return a},getFilterPayload:function(d,e,c){var f=[];d=d||[];for(var i=0;i<d.length;i++){f.push({"EVALUATION_ID":e,"CONFIGURATION_ID":c,"DIMENSION":d[i],"VISIBILITY":1,"IS_ACTIVE":1})}return f},_getHeaderConfiguration:function(h){var d;switch(h.VISUALIZATION_TYPE){case"CM":d=[{name:h.MEASURE1,color:h.COLOR1},{name:h.MEASURE2,color:h.COLOR2}];(h.MEASURE3&&h.MEASURE3!="_none^")?d.push({name:h.MEASURE3,color:h.COLOR3}):"";d=JSON.stringify({MEASURES:JSON.stringify(d)});break;case"CT":d={order:h.SORT_ORDER[1]=="D"?"desc":"asc",by:h.SORT_ORDER[0]};d=JSON.stringify({SORTING:JSON.stringify(d)});break}return d},getHeaderPayload:function(d,e,c){var h=[];d=d||[];for(var i=0;i<d.length;i++){if(d[i])h.push({"CONFIGURATION_ID":c,"EVALUATION_ID":e,"VISUALIZATION_TYPE":d[i].VISUALIZATION_TYPE,"VISIBILITY":1,"REFERENCE_EVALUATION_ID":d[i].REFERENCE_EVALUATION_ID,"VISUALIZATION_ORDER":i,"DIMENSION":d[i].DIMENSION,"IS_ACTIVE":1,"CONFIGURATION":this._getHeaderConfiguration(d[i])})}return h},getConfigurationPayload:function(d,e,c){var a={"SAP_FILTER":{value:"",visibility:1},"SAP_AGGREGATE_VALUE":{value:"",visibility:(d.CONFIG.SAP_AGGREGATE_VALUE?1:0)},"SAP_HEADER":{value:"",visibility:1},"QUERY_SERVICE_URI":{value:d.QUERY_SERVICE_URI,visibility:1},"QUERY_ENTITY_SET":{value:d.QUERY_ENTITY_SET,visibility:1},};var b=[];for(var f in a){b.push({"EVALUATION_ID":e,"CONFIGURATION_ID":c,"PROPERTY_TYPE":f,"PROPERTY_VALUE":a[f].value,"VISIBILITY":a[f].visibility,"IS_ACTIVE":1})}return b},getNewViewPayload:function(d,e,c){return[{"CONFIGURATION_ID":c,"EVALUATION_ID":e,"CONFIG_ORDER":(d.length+1),"IS_ACTIVE":1}]},getViewOrderPayload:function(d,e,c){var a=[];d=d||[];for(var i=0;i<d.length;i++){a.push({"CONFIGURATION_ID":d[i].ID,"EVALUATION_ID":e,"CONFIG_ORDER":i,"IS_ACTIVE":1})}return a}}};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.lib.DrilldownWriteService')){jQuery.sap.declare("sap.suite.ui.smartbusiness.lib.DrilldownWriteService");sap.suite=sap.suite||{};sap.suite.smartbusiness=sap.suite.smartbusiness||{};sap.suite.smartbusiness.ddaconfig=sap.suite.smartbusiness.ddaconfig||{};sap.suite.smartbusiness.ddaconfig.DrilldownWriteService=function(){var d=null;var s="/sap/hba/r/sb/core/odata/modeler/SMART_BUSINESS.xsodata";if(sap.suite.smartbusiness.odata){d=sap.suite.smartbusiness.odata.getModelByServiceUri(s)}else{d=new sap.ui.model.odata.ODataModel(s,true)}this.getODataModel=function(){return d};this.getEntitySet=function(){var E={CHART_CONFIGURATION:"/DDA_CHART",MASTER_CONFIGURATION:"/DDA_MASTER",COLUMNS_CONFIGURATION:"/DDA_COLUMNS",HEADER_CONFIGURATION:"/DDA_HEADER",FILTER_CONFIGURATION:"/DDA_FILTERS",DDA_CONFIGURATION:"/DDA_CONFIG",DDA_MASTER_TEXT_CONFIGURATION:"/DDA_MASTER_TEXT"};return{getChartEntity:function(){return E.CHART_CONFIGURATION},getMasterEntity:function(){return E.MASTER_CONFIGURATION},getColumnEntity:function(){return E.COLUMNS_CONFIGURATION},getHeaderEntity:function(){return E.HEADER_CONFIGURATION},getFilterEntity:function(){return E.FILTER_CONFIGURATION},getConfigEntity:function(){return E.DDA_CONFIGURATION},getMasterTextEntity:function(){return E.DDA_MASTER_TEXT_CONFIGURATION}}}};sap.suite.smartbusiness.ddaconfig.DrilldownWriteService.prototype={_executeBatch:function(e,p,h,c,C){var r=[];for(var i=0,l=p.length;i<l;i++){var a=p[i];if(h=="POST"){r.push(this.getODataModel().createBatchOperation(e,h,a))}else if(h=="DELETE"){r.push(this.getODataModel().createBatchOperation(a,h))}else if(h=="PUT"){r.push(this.getODataModel().createBatchOperation(e[i],h,a))}}this.getODataModel().addBatchChangeOperations(r);this.getODataModel().submitBatch(function(d,b){if(c){c.call(null,d,b)}},function(){if(C){C.apply(null,arguments)}},true)},createMasterEntry:function(p,c,C){this._executeBatch(this.getEntitySet().getMasterEntity(),p,"POST",c,C)},createConfig:function(p,c,C){this._executeBatch(this.getEntitySet().getConfigEntity(),p,"POST",c,C)},createFilters:function(p,c,C){this._executeBatch(this.getEntitySet().getFilterEntity(),p,"POST",c,C)},createHeader:function(p,c,C){this._executeBatch(this.getEntitySet().getHeaderEntity(),p,"POST",c,C)},createColumns:function(p,c,C){this._executeBatch(this.getEntitySet().getColumnEntity(),p,"POST",c,C)},createChartConfiguration:function(p,c,C){this._executeBatch(this.getEntitySet().getChartEntity(),p,"POST",c,C)},createMasterTextEntry:function(p,c,C){this._executeBatch(this.getEntitySet().getMasterTextEntity(),p,"POST",c,C)},updateMasterEntry:function(p,c,C){var e=[];for(var i=0;i<p.length;i++){e.push(this.getEntitySet().getMasterEntity()+"(EVALUATION_ID='"+p[i].EVALUATION_ID+"',CONFIGURATION_ID='"+p[i].CONFIGURATION_ID+"',IS_ACTIVE="+p[i].IS_ACTIVE+")")}this._executeBatch(e,p,"PUT",c,C)},updateConfig:function(i,p,c,C){this._executeBatch(this.getEntitySet().getConfigEntity()+"("+this.formId(i)+")",p,"PUT",c,C)},updateFilters:function(i,p,c,C){this._executeBatch(this.getEntitySet().getFilterEntity()+"("+this.formId(i)+")",p,"PUT",c,C)},updateHeader:function(i,p,c,C){this._executeBatch(this.getEntitySet().getHeaderEntity()+"("+this.formId(i)+")",p,"PUT",c,C)},updateColumns:function(i,p,c,C){this._executeBatch(this.getEntitySet().getColumnEntity()+"("+this.formId(i)+")",p,"PUT",c,C)},updateChartConfiguration:function(i,p,c,C){this._executeBatch(this.getEntitySet().getChartEntity()+"("+this.formId(i)+")",p,"PUT",c,C)},updateMasterTextEntry:function(i,p,c,C){this._executeBatch(this.getEntitySet().getMasterTextEntity()+"("+this.formId(i)+")",p,"PUT",c,C)},deleteMasterEntry:function(a,c,C){var e=[];for(var i=0;i<a.length;i++){e.push(this.getEntitySet().getMasterEntity()+"(EVALUATION_ID='"+a[i].EVALUATION_ID+"',CONFIGURATION_ID='"+a[i].CONFIGURATION_ID+"',IS_ACTIVE="+a[i].IS_ACTIVE+")")}this._executeBatch(null,e,"DELETE",c,C)},deleteMasterEntry_Eval:function(a,c,C){var e=[];for(var i=0;i<a.length;i++){e.push("DDA_DEL_EVAL_LEVEL(EVALUATION_ID='"+a[i].EVALUATION_ID+"',IS_ACTIVE="+a[i].IS_ACTIVE+")")}this._executeBatch(null,e,"DELETE",c,C)},deleteConfig:function(a,c,C){var e=[];for(var i=0;i<a.length;i++){e.push("DDA_CONFIG_DEL(EVALUATION_ID='"+a[i].EVALUATION_ID+"',IS_ACTIVE="+a[i].IS_ACTIVE+")")}this._executeBatch(null,e,"DELETE",c,C)},deleteFilters:function(a,c,C){var e=[];for(var i=0;i<a.length;i++){e.push("DDA_FILTERS_DEL(EVALUATION_ID='"+a[i].EVALUATION_ID+"',IS_ACTIVE="+a[i].IS_ACTIVE+")")}this._executeBatch(null,e,"DELETE",c,C)},deleteHeader:function(a,c,C){var e=[];for(var i=0;i<a.length;i++){e.push("DDA_HEADER_DEL(EVALUATION_ID='"+a[i].EVALUATION_ID+"',IS_ACTIVE="+a[i].IS_ACTIVE+")")}this._executeBatch(null,e,"DELETE",c,C)},deleteColumns:function(a,c,C){var e=[];for(var i=0;i<a.length;i++){e.push("DDA_COLUMNS_DEL(EVALUATION_ID='"+a[i].EVALUATION_ID+"',CONFIGURATION_ID='"+a[i].CONFIGURATION_ID+"',IS_ACTIVE="+a[i].IS_ACTIVE+")")}this._executeBatch(null,e,"DELETE",c,C)},deleteChartConfiguration:function(a,c,C){var e=[];for(var i=0;i<a.length;i++){e.push(this.getEntitySet().getChartEntity()+"(EVALUATION_ID='"+a[i].EVALUATION_ID+"',CONFIGURATION_ID='"+a[i].CONFIGURATION_ID+"',IS_ACTIVE="+a[i].IS_ACTIVE+")")}this._executeBatch(null,e,"DELETE",c,C)},deleteMasterTextEntry:function(a,c,C){var e=[];for(var i=0;i<a.length;i++){e.push("DDA_MASTEXT_DEL(EVALUATION_ID='"+a[i].EVALUATION_ID+"',CONFIGURATION_ID='"+a[i].CONFIGURATION_ID+"',IS_ACTIVE="+a[i].IS_ACTIVE+")")}this._executeBatch(null,e,"DELETE",c,C)},formId:function(i){var t='';for(each in i){if(isNaN(i[each])){t=t+(each+"='"+i[each]+"',")}else{t=t+(each+"="+i[each]+",")}}return t.substring(0,t.length-1)},saveDDAConfiguration:function(p){},}};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.lib.Filter')){jQuery.sap.declare("sap.suite.ui.smartbusiness.lib.Filter");sap.ui.core.Control.extend("sap.suite.ui.smartbusiness.lib.Filter",{metadata:{properties:{evaluationId:"string",dimensions:{type:"any",defaultValue:[]},visible:{type:"boolean",defaultValue:true},advancedSetting:{type:"object",defaultValue:{}},mode:{type:"string",defaultValue:"Runtime"},suppressAction:{type:"boolean",defaultValue:false},sapSystem:{type:"string",defaultValue:null}},aggregations:{"_filter":{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"},"_popover":{type:"sap.m.Popover",multiple:false,visibility:"hidden"}},events:{filterChange:{}}},renderer:function(r,c){r.write("<div");r.writeControlData(c);r.addClass("SmartBusinessFilter");r.writeClasses();r.write(">");r.renderControl(c.getAggregation("_filter"));r.write("</div>")}});sap.suite.ui.smartbusiness.lib.Filter.prototype.init=function(){this._filterObj={};if(sap.ushell&&sap.ushell.Container){this.urlParsingService=sap.ushell.Container.getService("URLParsing")}else{this.urlParsingService=undefined}};sap.suite.ui.smartbusiness.lib.Filter.prototype.onBeforeRendering=function(){if(this.getEvaluationId()){try{this._updateOdataProperties();this._facetListsReference={};var c=this._getChildControl();c.setVisible(this.getVisible());this.setAggregation("_filter",c);this._initModel();if(this.getMode()=="Runtime"){this._addDimensions(this.getDimensions())}else{this._addDimensionsDesignTime(this.getDimensions())}}catch(e){}}};sap.suite.ui.smartbusiness.lib.Filter.prototype.onAfterRendering=function(){this.refreshFilter(true)};sap.suite.ui.smartbusiness.lib.Filter.prototype.getFacetFilterReference=function(){return this.getAggregation("_filter")};sap.suite.ui.smartbusiness.lib.Filter.prototype.getSelectedItems=function(){var f=this.getAggregation("_filter");var l=f.getLists();var c=0;for(var i=0;i<l.length;i++){if(l[i].getSelectedItems().length>0){c++}}if(c>0){return true}else{return false}};sap.suite.ui.smartbusiness.lib.Filter.prototype._updateOdataProperties=function(){if(this.urlParsingService){this._serviceUri=this.urlParsingService.addSystemToServiceUrl(this.EVALUATION.getODataUrl(),this.getSapSystem())}else{this._serviceUri=this.EVALUATION.getODataUrl()}this._entitySet=this.EVALUATION.getEntitySet()};sap.suite.ui.smartbusiness.lib.Filter.prototype._getChildControl=function(){var c,t=this;function _(C,w){return new sap.m.HBox({items:C,width:w})}if(this.getMode()=="Runtime"){c=new sap.m.FacetFilter({showReset:true,showPersonalization:true,reset:jQuery.proxy(function(){t.resetFilter.call(this)},this)})}else{this._facetContainer=new sap.m.ScrollContainer({vertical:false,horizontal:true,}).addStyleClass("facetFilterContainer");c=new sap.m.HBox({justifyContent:"SpaceBetween",alignItems:"Center",items:[_([this._facetContainer]),_([new sap.m.Button({icon:"sap-icon://undo",type:"Transparent",press:function(){if(!t.getSuppressAction()){t.rerender()}}}),new sap.m.Button({icon:"sap-icon://add-filter",type:"Transparent",press:function(){if(!t.getSuppressAction()){t._popover.openBy(this)}}})])]})}return c};sap.suite.ui.smartbusiness.lib.Filter.prototype.resetFilter=function(){this._filterObj=sap.suite.smartbusiness.url.hash.getApplicationParameters();var v=sap.suite.smartbusiness.url.hash.getApplicationParameters().viewId[0];var n={viewId:[v]};var t=this;var d=sap.suite.smartbusiness.odata.getAllDimensions(this._serviceUri,this._entitySet);d.forEach(function(s){delete t._filterObj[s]});for(var e in this._filterObj){n[e]=this._filterObj[e]}sap.suite.smartbusiness.url.hash.setApplicationParameters(n);this.rerender()};sap.suite.ui.smartbusiness.lib.Filter.prototype._addDimensions=function(d){var c=[];if(d&&d.length){if(typeof d=='string'){d=d.split(",")}}if(this.getEvaluationId()){var f=sap.suite.smartbusiness.odata.getAllDimensions(this._serviceUri,this._entitySet)}for(var i=0;i<d.length;i++){c.push({name:d[i],isDelta:false})}for(var i=0;i<f.length;i++){if(d.indexOf(f[i])==-1)c.push({name:f[i],isDelta:true})}var p=sap.suite.smartbusiness.odata.properties(this._serviceUri,this._entitySet);var C=p.getLabelMappingObject();try{c.sort(function(a,b){return C[a.name]>C[b.name]?1:-1})}catch(e){jQuery.sap.log.error(e)}for(var i=0;i<c.length;i++){this.addFacetList(c[i].name,c[i].isDelta)}};sap.suite.ui.smartbusiness.lib.Filter.prototype.facetListClosed=function(e){this.fireFilterChange(e)};sap.suite.ui.smartbusiness.lib.Filter.prototype.setEvaluationData=function(e){this.EVALUATION=e};sap.suite.ui.smartbusiness.lib.Filter.prototype.getSelectedKeys=function(l){var s=[];if(l.getActive()){var a=l.getItems();for(var i=0;i<a.length;i++){if(a[i].getSelected()){var v=a[i].getBindingContext().getObject()[l._techName];var b=(v||v==0)?v:"";b=b.getTime?b.getTime():b;s.push(b+"")}}}return s};sap.suite.ui.smartbusiness.lib.Filter.prototype.addFacetList=function(f,i){var t=this;var a=this.getAggregation("_filter");var p=sap.suite.smartbusiness.odata.properties(this._serviceUri,this._entitySet);var C=p.getLabelMappingObject();var T=p.getTextPropertyMappingObject();var b=new sap.m.FacetFilterList({key:f,title:C[f],displaySecondaryValues:true,growingThreshold:999,active:!i,listOpen:function(){t._fetchListData(this)}});this._facetListsReference[f]=b;b._techName=f;b._isDelta=i;b._isFilterDirty=true;b._prevSelectedKeys=[];if(this.getMode()=="Runtime"){b.attachListClose(function(){var c=sap.suite.smartbusiness.url.hash.getApplicationParameters(['viewId']);this._prevSelectedKeys=c[this._techName]||[];if(JSON.stringify(this._prevSelectedKeys)!=JSON.stringify(t.getSelectedKeys(this))){this._prevSelectedKeys=t.getSelectedKeys(this);t._setFilterDirty(this.getKey());t._updateFilter(this.getKey(),this._prevSelectedKeys)}if(!this.getActive()){this._isFilterDirty=true}})}b.bindAggregation("items","/",new sap.m.FacetFilterItem({key:{path:f},text:{formatter:t._getColumnValueFormatter(T[f]),path:T[f]}})).setModel(new sap.ui.model.json.JSONModel());a.addList(b)};sap.suite.ui.smartbusiness.lib.Filter.prototype.refreshFilter=function(n){if(this.getVisible()){var p=this._filterObj||{};try{var f=this._facetListsReference;if(f&&this.getMode()=="Runtime"){this._filterObj=sap.suite.smartbusiness.url.hash.getApplicationParameters(["viewId"]);for(var a in this._filterObj){if((p[a]+"")!=(this._filterObj[a]+"")){f[a].setActive(true);f[a].setVisible(true);f[a]._isSelectionChanged=true}}for(var a in p){if((p[a]+"")!=(this._filterObj[a]+"")){f[a].setActive(true);f[a].setVisible(true);f[a]._isSelectionChanged=true}}n=!!n;if(this.getAggregation("_filter")&&!n){}}var b=this.getAggregation("_filter");if(b){var l=b.getLists();var c=sap.suite.smartbusiness.url.hash.getApplicationParameters(["viewId"]);for(var a in c){for(var i=0;i<l.length;i++){if(l[i].getKey()==a){this.updateSelections(l[i],c[a])}}}}}catch(e){}}};sap.suite.ui.smartbusiness.lib.Filter.prototype.updateSelections=function(f,s){var a=f.getModel().getData();if(!(a instanceof Array)||!a.length){if(s.length==1){f._isFilterDirty=true;this._fetchListData(f)}else{this._fetchPseudoListData(f,s);f._isFilterDirty=true}}else{this._retainListSelections(f)}};sap.suite.ui.smartbusiness.lib.Filter.prototype._updateFilter=function(d,f){this._filterObj=sap.suite.smartbusiness.url.hash.getApplicationParameters();var v=sap.suite.smartbusiness.url.hash.getApplicationParameters().viewId[0];var n={viewId:[v]};if(f.length){this._filterObj[d]=f}else{delete this._filterObj[d]}for(var e in this._filterObj){n[e]=this._filterObj[e]}sap.suite.smartbusiness.url.hash.setApplicationParameters(n)};sap.suite.ui.smartbusiness.lib.Filter.prototype._getValidFilters=function(d){var o=[];var f=sap.suite.smartbusiness.url.hash.getApplicationParameters(["viewId",d]);for(var e in f){var a=f[e];if(a&&a.length){a.forEach(function(F){o.push({NAME:e,VALUE_1:F,VALUE_2:"",TYPE:"FI",OPERATOR:"EQ"})})}}return o};sap.suite.ui.smartbusiness.lib.Filter.prototype.getActiveDimensions=function(){var t=[];if(this.getMode()=="RunTime"){var f=this.getAggregation("_filter").getLists();f.forEach(function(s){if(s.getActive()){t.push(s._techName)}})}else{var l=this._designTimeModel.getProperty("/");l.forEach(function(s){if(s.selected){t.push(s.name)}})}return t};sap.suite.ui.smartbusiness.lib.Filter.prototype._retainListSelections=function(l){if(this.getMode()=="Runtime"){this._filterObj=sap.suite.smartbusiness.url.hash.getApplicationParameters(["viewId"]);var c=this._filterObj[l.getKey()]||[];for(var i=0,a=l.getItems();i<a.length;i++){var b=a[i].getBindingContext().getObject()[l._techName]||"";b=b.getTime?b.getTime()+"":b+"";a[i].setSelected(c.indexOf(b)!=-1)}l._isSelectionChanged=false}};sap.suite.ui.smartbusiness.lib.Filter.prototype._getFilterString=function(d,o){return sap.suite.smartbusiness.odata.getUri({entitySet:this._entitySet,serviceUri:this._serviceUri,dimension:d,filter:o.concat(this.EVALUATION.getFilters().results)}).uri};sap.suite.ui.smartbusiness.lib.Filter.prototype._setFilterDirty=function(e){var f=this.getAggregation("_filter");for(var i=0,l=f.getLists();i<l.length;i++){if(l[i].getKey()!=e){l[i]._isFilterDirty=true}}};sap.suite.ui.smartbusiness.lib.Filter.prototype._onAfterListDataFetch=function(l,d){l.getModel().setData(d);this._retainListSelections(l);l._isFilterDirty=false;l.setBusy(false)};sap.suite.ui.smartbusiness.lib.Filter.prototype._fetchPseudoListData=function(l,p){var d=[];var a=l.getKey();for(var e in p){var o={};o[a]=p[e];d.push(o)}this._onAfterListDataFetch(l,d)};sap.suite.ui.smartbusiness.lib.Filter.prototype._fetchListData=function(l,f){if(l._isFilterDirty){var t=this;if(this.getMode()=="Runtime"){l.setBusy(true);this.oDataModel.read(this._getFilterString(l.getKey(),this._getValidFilters(l.getKey())),null,null,true,function(d){t._onAfterListDataFetch(l,d.results)},function(){})}}else if(l._isSelectionChanged){this._retainListSelections(l)}};sap.suite.ui.smartbusiness.lib.Filter.prototype._initModel=function(){if(this.getEvaluationId()){if(sap.suite.smartbusiness.odata){this.oDataModel=sap.suite.smartbusiness.odata.getModelByServiceUri(this._serviceUri)}else{this.oDataModel=new sap.ui.model.odata.ODataModel(this._serviceUri,true)}}};sap.suite.ui.smartbusiness.lib.Filter.prototype._getColumnValueFormatter=function(n){var f=function(s){return s==0?s+"":s};var m=sap.suite.smartbusiness.odata.getEdmType(this._serviceUri,n,true);var t=m.type;var F=m.format.toUpperCase();if(t=='Edm.DateTime'){if(!sap.suite.smartbusiness.odata.isTimeZoneIndependent(this._serviceUri,this._entitySet)){var a;if(F=="DATE"){a="daysAgo"}else if(F=="DATETIME"){a="short"}else if(F=="NONE"){a="daysAgo"}if(a){var o=new sap.ca.ui.model.type.Date({style:a});f=function(s){return o.formatValue(s,"string")}}}else{f=function(b){if(b&&b.getMinutes){b=new Date(b.getTime());b.setMinutes(b.getMinutes()+b.getTimezoneOffset());var i=(F=="DATE")?"getDateInstance":"getDateTimeInstance";return sap.ui.core.format.DateFormat[i]().format(b)}return b}}}return f};sap.suite.ui.smartbusiness.lib.Filter.prototype._getDesignTimeModel=function(a){var d=[];a=a||[];var p=sap.suite.smartbusiness.odata.properties(this._serviceUri,this._entitySet);var C=p.getLabelMappingObject();var b=sap.suite.smartbusiness.odata.getAllDimensions(this._serviceUri,this._entitySet);if(a&&a.length){if(typeof a=='string'){a=a.split(",")}}b.forEach(function(s){d.push({name:s,label:C[s],selected:a.indexOf(s)!=-1})});return new sap.ui.model.json.JSONModel(d)};sap.suite.ui.smartbusiness.lib.Filter.prototype._addDimensionsDesignTime=function(d){function o(e){var c=[];var q=e.getSource().getValue();var g=p.getBinding("items");if(q&&q.length>0){c=[new sap.ui.model.Filter("label",sap.ui.model.FilterOperator.Contains,q)]}g.filter(c)}this._designTimeModel=this._getDesignTimeModel(d);this._designTimeModel.setSizeLimit(999);this._facetContainer.setModel(this._designTimeModel);var p=new sap.m.List({mode:"MultiSelect"});var s=new sap.m.SearchField({width:"100%",liveChange:jQuery.proxy(o,this)});this._popover=new sap.m.Popover({customHeader:s,content:[p],showHeader:false,placement:"Bottom"});this._popover.setModel(this._designTimeModel);var a=new sap.ui.model.Sorter('label',false);p.bindAggregation("items",{path:"/",template:new sap.m.StandardListItem({title:"{label}",selected:"{selected}"}),sorter:a});var f=new sap.m.HBox({visible:"{selected}",justifyContent:"SpaceBetween",items:[new sap.m.Label({text:"{label}"}).addStyleClass("dimensionName"),new sap.ui.core.Icon({src:"sap-icon://sys-cancel",visible:!this.getSuppressAction(),press:function(){this.getParent().setVisible(false)}})]}).addStyleClass("facetFilterDimension");var b=new sap.m.HBox();b.bindAggregation("items","/",f);this._facetContainer.addContent(b)}};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.lib.ListPersona')){jQuery.sap.declare("sap.suite.ui.smartbusiness.lib.ListPersona");sap.suite.ui.smartbusiness.lib.ListPersona=function(p){this.oParam=p;this.init()};sap.suite.ui.smartbusiness.lib.ListPersona.prototype={init:function(){this.CHANGE_STATE=false;this.oContext=this.oParam.context;if(jQuery.sap.startsWith(this.oContext,"/")){this.oContext=this.oContext.substring(1)}this.oView=this.oParam.view;this.namedModel=this.oParam.namedModel;this.oModel=this.oView.getModel();if(this.namedModel){this.oModel=this.oView.getModel(this.namedModel)}var v=this.oModel.getContext("/"+this.oContext).getObject();this.oData=[];this.oBackupData=[];jQuery.extend(true,this.oData,v);jQuery.extend(true,this.oBackupData,v);this.iLength=this.oData.length;if(this.oParam.filter){this.iLength=this._getArrayIndex(this.oData.length-1)+1}this.oTempModel=new sap.ui.model.json.JSONModel({data:this.oData});this._initializeDialogView();this.oDialog.setModel(this.oTempModel);if(this.oParam.filter){this.oList.getBinding("items").filter(new sap.ui.model.Filter(this.oParam.filter.property,sap.ui.model.FilterOperator.EQ,this.oParam.filter.value))}},_getArrayIndex:function(I){var a=-1;for(var i=0;i<=I;i++){var e=this.oData[i];if(e[this.oParam.filter.property]==this.oParam.filter.value){a++}}return a},handleListSelection:function(e){if(this.iLength>1){this._oSelectedItemIndex=+((e.getParameter("listItem").getBindingContext().getPath()).split('/').pop());var i=this._oSelectedItemIndex;if(this.oParam.filter){i=this._getArrayIndex(this._oSelectedItemIndex)}this.setSelectedIndex(i)}},setSelectedIndex:function(i,c){this.selectedIndex=i;if(this.selectedIndex==0){this.moveDownButton.setEnabled(true);this.moveUpButton.setEnabled(false)}else if(this.selectedIndex>0&&this.selectedIndex<this.iLength-1){this.moveDownButton.setEnabled(true);this.moveUpButton.setEnabled(true)}else if(this.selectedIndex==this.iLength-1){this.moveDownButton.setEnabled(false);this.moveUpButton.setEnabled(true)}else{jQuery.sap.log.error("Invalid Selected Index")}if(c){this.oList.setSelectedItem(this.oList.getItems()[this.selectedIndex],true)}},_getPreviousIndex:function(I){var r=-1;for(var i=0;i<I;i++){var e=this.oData[i];if(e[this.oParam.filter.property]==this.oParam.filter.value){r=i}}return r},_getNextIndex:function(I){var r=-1;for(var i=this.oData.length-1;i>I;i--){var e=this.oData[i];if(e[this.oParam.filter.property]==this.oParam.filter.value){r=i}}return r},moveItemUp:function(){var t=this.oData[this._oSelectedItemIndex];var p=this._oSelectedItemIndex-1;if(this.oParam.filter){p=this._getPreviousIndex(this._oSelectedItemIndex)}this.oData[this._oSelectedItemIndex]=this.oData[p];this.oData[p]=t;this.oTempModel.updateBindings();this.setSelectedIndex(this.selectedIndex-1,true);this.CHANGE_STATE=true;this._oSelectedItemIndex=p},moveItemDown:function(){var t=this.oData[this._oSelectedItemIndex];var n=this._oSelectedItemIndex+1;if(this.oParam.filter){n=this._getNextIndex(this._oSelectedItemIndex)}this.oData[this._oSelectedItemIndex]=this.oData[n];this.oData[n]=t;this.oTempModel.updateBindings();this.setSelectedIndex(this.selectedIndex+1,true);this.CHANGE_STATE=true;this._oSelectedItemIndex=n},resetEverything:function(){if(this.CHANGE_STATE){this.oData=[];jQuery.extend(true,this.oData,this.oBackupData);this.oList.removeSelections();this.oTempModel=new sap.ui.model.json.JSONModel({data:this.oData});this.oDialog.setModel(this.oTempModel);this.oTempModel.updateBindings();if(this.oParam.filter){this.oList.getBinding("items").filter(new sap.ui.model.Filter(this.oParam.filter.property,sap.ui.model.FilterOperator.EQ,this.oParam.filter.value))}this.moveDownButton.setEnabled(false);this.moveUpButton.setEnabled(false);this.CHANGE_STATE=false}},_initializeDialogView:function(){var t=this;this.oList=new sap.m.List({mode:"SingleSelectMaster",selectionChange:jQuery.proxy(this.handleListSelection,this)}).bindAggregation("items","/data",new sap.m.StandardListItem({title:{path:this.oParam.listItemContext}}));this.moveUpButton=new sap.m.Button({icon:"sap-icon://arrow-top",enabled:false,press:function(){t.moveItemUp()}});this.moveDownButton=new sap.m.Button({icon:"sap-icon://arrow-bottom",enabled:false,press:function(){t.moveItemDown()}});this.undoButton=new sap.m.Button({icon:"sap-icon://undo",press:function(){t.resetEverything()}});this.oDialog=new sap.m.Dialog({title:this.oParam.title||"Change Order of List Item",content:[this.oList,new sap.m.Bar({design:"Header",contentLeft:[this.moveUpButton,this.moveDownButton],contentRight:[this.undoButton]})],beginButton:new sap.m.Button({text:this.oView.getModel("i18n").getProperty("OK"),press:jQuery.proxy(this.okDialog,this)}),endButton:new sap.m.Button({text:this.oView.getModel("i18n").getProperty("CANCEL"),press:jQuery.proxy(this.closeDialog,this)})})},start:function(){this.oDialog.open()},closeDialog:function(){this.oDialog.close()},okDialog:function(){if(this.CHANGE_STATE){this.oModel.getData()[this.oContext]=this.oData;this.oModel.updateBindings()}this.oDialog.close();if(this.oParam.callback){this.oParam.callback.call(null)}}}};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.lib.formatters')){jQuery.sap.declare("sap.suite.ui.smartbusiness.lib.formatters");sap.suite=sap.suite||{};sap.suite.smartbusiness=sap.suite.smartbusiness||{};sap.suite.smartbusiness.formatters={getBundleText:function(c,t,p,P){var b;if(c===undefined){var a=sap.ca.scfld.md.app.Application.getImpl().oConfiguration.oApplicationFacade;b=a.getResourceBundle()}else{b=c.oApplicationFacade.getResourceBundle()}var T=b.getText(t,[p,P]);return T},kpiStatus:function(s){return(s?sap.suite.smartbusiness.formatters.getBundleText(undefined,"STATUS",sap.suite.smartbusiness.formatters.getBundleText(undefined,"STATUS_ACTIVE")):sap.suite.smartbusiness.formatters.getBundleText(undefined,"STATUS",sap.suite.smartbusiness.formatters.getBundleText(undefined,"STATUS_DRAFT")))},kpiStatusText:function(s){return(s?sap.suite.smartbusiness.formatters.getBundleText(undefined,"STATUS_ACTIVE"):sap.suite.smartbusiness.formatters.getBundleText(undefined,"STATUS_DRAFT"))},kpiStatusState:function(s){return(s?sap.ui.core.ValueState.Success:sap.ui.core.ValueState.None)},kpiOwner:function(o){if(o)return sap.suite.smartbusiness.formatters.getBundleText(undefined,"ADDED_BY",o);return},kpiOwnerInOH:function(o){if(o)return sap.suite.smartbusiness.formatters.getBundleText(undefined,"OWNER",o);return},kpiID:function(i,t){if(i){if(t&&t=="KPI"){return sap.suite.smartbusiness.formatters.getBundleText(undefined,"KPI",i)}else{return sap.suite.smartbusiness.formatters.getBundleText(undefined,("OPI: "+i))}}return},kpiIDInOH:function(i,t){if(i){if(t&&t=="KPI"){return sap.suite.smartbusiness.formatters.getBundleText(undefined,"KPI",i)}else{return sap.suite.smartbusiness.formatters.getBundleText(undefined,("OPI: "+i))}}return},evalStatus:function(s){try{if(s)return"Success";return"None"}catch(e){return}},}};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.lib.oData4Analytics')){jQuery.sap.declare("sap.suite.ui.smartbusiness.lib.oData4Analytics");jQuery.sap.require('sap.ui.core.Core');sap.suite=sap.suite||{};sap.suite.smartbusiness=sap.suite.smartbusiness||{};sap.suite.smartbusiness.odata4analytics=sap.suite.smartbusiness.odata4analytics||{};sap.suite.smartbusiness.odata4analytics.constants={};sap.suite.smartbusiness.odata4analytics.constants["SAP_NAMESPACE"]="http://www.sap.com/Protocols/SAPData";sap.suite.smartbusiness.odata4analytics.constants["VERSION"]="0.7";sap.suite.smartbusiness.odata4analytics.helper={renderPropertyKeyValue:function(f,p){if(f.charAt(0)=="'")throw"Illegal property value starting with a quote";switch(p){case'Edm.String':return"'"+f+"'";case'Edm.DateTime':return"datetime'"+f+"'";case'Edm.Guid':return"guid'"+f+"'";case'Edm.Time':return"time'"+f+"'";case'Edm.DateTimeOffset':return"datetimeoffset'"+f+"'";case'Edm.Decimal':return f+"m";case'Edm.Double':return f+"d";case'Edm.Single':return f+"f";default:return f}},renderPropertyFilterValue:function(f,p){if(f.charAt(0)=="'")throw"Illegal property value starting with a quote";switch(p){case'Edm.String':return"'"+f+"'";case'Edm.DateTime':return"datetime'"+f+"'";case'Edm.Guid':return"guid'"+f+"'";case'Edm.Time':return"time'"+f+"'";case'Edm.DateTimeOffset':return"datetimeoffset'"+f+"'";case'Edm.Decimal':return f+"m";case'Edm.Double':return f+"d";case'Edm.Single':return f+"f";default:return f}},tokenizeNametoLabelText:function(n){var l="";l=n.replace(/([^A-Z0-9_]+)([A-Z0-9_])/g,"$1 $2");l=l.replace(/([A-Z0-9_]{2,})([A-Z0-9_])([^A-Z0-9_]+)/g,"$1 $2$3");l=l.replace(/(.*) _E$/,"$1");l=l.replace(/(.*) _(.*)/g,"$1 $2");return l}};sap.suite.smartbusiness.odata4analytics.Model=function(m,a){this._init(m,a)};sap.suite.smartbusiness.odata4analytics.Model.ReferenceByURI=function(u){return{sServiceURI:u}};sap.suite.smartbusiness.odata4analytics.Model.ReferenceByModel=function(m){return{oModel:m}};sap.suite.smartbusiness.odata4analytics.Model.ReferenceWithWorkaround=function(m,w){return{oModelReference:m,aWorkaroundID:w}};sap.suite.smartbusiness.odata4analytics.Model.prototype={_init:function(m,a){this._oActivatedWorkarounds=new Object();if(m&&m.aWorkaroundID){for(var i=-1,I;I=m.aWorkaroundID[++i];){this._oActivatedWorkarounds[I]=true}m=m.oModelReference}if(!m||(!m.sServiceURI&&!m.oModel)){throw"Usage with oModelReference being an instance of Model.ReferenceByURI or Model.ReferenceByModel"}if(m.oModel)this._oModel=m.oModel;else this._oModel=new sap.ui.model.odata.ODataModel(m.sServiceURI);if(this._oModel.getServiceMetadata()==undefined||this._oModel.getServiceMetadata().dataServices==undefined){throw"Model could not be loaded"}this.mergeV2Annotations(a);this._oQueryResultSet=new Object();this._oParameterizationSet=new Object();this._oEntityTypeSet=new Object();this._oEntitySetSet=new Object();this._oEntityTypeNameToEntitySetMap=new Object();var s=this._oModel.getServiceMetadata().dataServices.schema[0];for(var i=-1,c;c=s.entityContainer[++i];){if(c.isDefaultEntityContainer=="true"){this._oDefaultEntityContainer=c;break}}var e=s.entityType;var q=[],p=[],u=[];for(var i=-1,t;t=e[++i];){var P=false;if(t.extensions!=undefined){for(var j=-1,E;E=t.extensions[++j];){if(E.namespace==sap.suite.smartbusiness.odata4analytics.constants.SAP_NAMESPACE&&E.name=="semantics"){P=true;switch(E.value){case"aggregate":q.push(t);break;case"parameters":p.push(t);break;default:u.push(t)}}if(P)continue}if(!P)u.push(t)}else u.push(t)}for(var i=-1,t;t=u[++i];){var o=new sap.suite.smartbusiness.odata4analytics.EntityType(this._oModel.getServiceMetadata(),s,t);this._oEntityTypeSet[o.getQName()]=o;var b=this._getEntitySetsOfType(s,o.getQName());if(b.length==0)throw"Invalid consumption model: No entity set for entity type annotated with parameters semantics";if(b.length>1)throw"Unsupported consumption model: More than one entity set for entity type annotated with parameters semantics";var d=new sap.suite.smartbusiness.odata4analytics.EntitySet(this._oModel.getServiceMetadata(),s,b[0][0],b[0][1]);this._oEntitySetSet[d.getQName()]=d;this._oEntityTypeNameToEntitySetMap[o.getQName()]=d}var f={};for(var i=-1,t;t=p[++i];){var o=new sap.suite.smartbusiness.odata4analytics.EntityType(this._oModel.getServiceMetadata(),s,t);this._oEntityTypeSet[o.getQName()]=o;var b=this._getEntitySetsOfType(s,o.getQName());if(b.length==0)throw"Invalid consumption model: No entity set for entity type annotated with parameters semantics";if(b.length>1)throw"Unsupported consumption model: More than one entity set for entity type annotated with parameters semantics";var d=new sap.suite.smartbusiness.odata4analytics.EntitySet(this._oModel.getServiceMetadata(),s,b[0][0],b[0][1]);this._oEntitySetSet[d.getQName()]=d;this._oEntityTypeNameToEntitySetMap[o.getQName()]=d;var g=new sap.suite.smartbusiness.odata4analytics.Parameterization(o,d);this._oParameterizationSet[g.getName()]=g;f[o.getQName()]=g;var h=o.getQName();if(s.association!=undefined){for(var j=-1,A;A=s.association[++j];){if(A.referentialConstraint==undefined)continue;var k=null;if(A.end[0].type==h&&A.end[0].multiplicity=="*"&&A.end[1].multiplicity=="1"){k=A.end[1].type}else if(A.end[1].type==h&&A.end[1].multiplicity=="*"&&A.end[0].multiplicity=="1"){k=A.end[0].type}if(!k)continue;if(A.referentialConstraint.dependent.propertyRef.length!=1)continue;var l=g.findParameterByName(A.referentialConstraint.dependent.propertyRef[0].name);if(l==null)continue;var v=this._oEntityTypeSet[k];var V=this._oEntityTypeNameToEntitySetMap[k];l.setValueSetEntity(v,V)}}}for(var i=-1,t;t=q[++i];){var o=new sap.suite.smartbusiness.odata4analytics.EntityType(this._oModel.getServiceMetadata(),s,t);this._oEntityTypeSet[o.getQName()]=o;var Q=o.getQName();var g=null;var n=null;if(s.association!=undefined){for(var j=-1,A;A=s.association[++j];){var r=null;if(A.end[0].type==Q)r=A.end[1].type;else if(A.end[1].type==Q)r=A.end[0].type;else continue;var M=null;M=f[r];if(M!=null)if(g!=null){throw"LIMITATION: Unable to handle multiple parameter entity types of query entity "+o.name}else{g=M;n=A}}}var b=this._getEntitySetsOfType(s,o.getQName());if(b.length!=1)throw"Invalid consumption model: There must be exactly one entity set for an entity type annotated with aggregating semantics";var d=new sap.suite.smartbusiness.odata4analytics.EntitySet(this._oModel.getServiceMetadata(),s,b[0][0],b[0][1]);this._oEntitySetSet[d.getQName()]=d;this._oEntityTypeNameToEntitySetMap[o.getQName()]=d;var w=new sap.suite.smartbusiness.odata4analytics.QueryResult(this,o,d,g);this._oQueryResultSet[w.getName()]=w;if(g)g.setTargetQueryResult(w,n)}},oUI5ODataModelAnnotatableObject:{objectName:"schema",keyPropName:"namespace",extensions:true,aSubObject:[{objectName:"entityType",keyPropName:"name",extensions:true,aSubObject:[{objectName:"property",keyPropName:"name",aSubObject:[],extensions:true,}]},{objectName:"entityContainer",keyPropName:"name",extensions:false,aSubObject:[{objectName:"entitySet",keyPropName:"name",extensions:true,aSubObject:[],}],}]},mergeV2Annotations:function(a){try{var A=JSON.parse(a)}catch(e){return}var m;try{m=this._oModel.getServiceMetadata().dataServices}catch(e){return}for(var p in A){if(!(this.oUI5ODataModelAnnotatableObject.objectName==p))continue;if(!(A[p]instanceof Array)){continue}this.mergeV2AnnotationLevel(m[this.oUI5ODataModelAnnotatableObject.objectName],A[this.oUI5ODataModelAnnotatableObject.objectName],this.oUI5ODataModelAnnotatableObject);break}return},mergeV2AnnotationLevel:function(M,a,u){for(var i=-1,A;A=a[++i];){for(var j=-1,o;o=M[++j];){if(!(A[u.keyPropName]==o[u.keyPropName]))continue;if(A["extensions"]!=undefined){if(o["extensions"]==undefined)o["extensions"]=new Array();for(var l=-1,b;b=A["extensions"][++l];){var f=false;for(var m=-1,c;c=o["extensions"][++m];){if(b.name==c.name&&b.namespace==c.namespace){c.value=b.value;f=true;break}}if(!f)o["extensions"].push(b)}}for(var k=-1,U;U=u.aSubObject[++k];){for(var p in A){if(!(U.objectName==p))continue;if(!(A[U.objectName]instanceof Array))continue;if((o[U.objectName]==undefined)||(!(o[U.objectName]instanceof Array)))continue;this.mergeV2AnnotationLevel(o[U.objectName],A[U.objectName],U);break}}}}return},findQueryResultByName:function(n){var q=this._oQueryResultSet[n];if(!q&&this._oDefaultEntityContainer){var Q=this._oDefaultEntityContainer.name+"."+n;q=this._oQueryResultSet[Q]}return q},getAllQueryResultNames:function(){if(this._aQueryResultNames)return this._aQueryResultNames;this._aQueryResultNames=new Array(0);for(var n in this._oQueryResultSet)this._aQueryResultNames.push(this._oQueryResultSet[n].getName());return this._aQueryResultNames},getAllQueryResults:function(){return this._oQueryResultSet},getODataModel:function(){return this._oModel},_getEntitySetsOfType:function(s,q){var e=[];for(var i=-1,E;E=s.entityContainer[++i];){for(var j=-1,o;o=E.entitySet[++j];){if(o.entityType==q)e.push([E,o])}}return e},_oModel:null,_oDefaultEntityContainer:null,_aQueryResultNames:null,_oQueryResultSet:null,_oParameterizationSet:null,_oEntityTypeSet:null,_oEntitySetSet:null,_oEntityTypeNameToEntitySetMap:null,_oActivatedWorkarounds:null,};sap.suite.smartbusiness.odata4analytics.QueryResult=function(m,e,E,p){this._init(m,e,E,p)};sap.suite.smartbusiness.odata4analytics.QueryResult.prototype={_init:function(m,e,E,p,a){this._oModel=m;this._oEntityType=e;this._oEntitySet=E;this._oParameterization=p;this._oDimensionSet=new Object();this._oMeasureSet=new Object();var P=e.getTypeDescription().property;var A={};for(var i=-1,o;o=P[++i];){if(o.extensions==undefined)continue;for(var j=-1,b;b=o.extensions[++j];){if(!b.namespace==sap.suite.smartbusiness.odata4analytics.constants.SAP_NAMESPACE)continue;switch(b.name){case"aggregation-role":switch(b.value){case"dimension":var d=new sap.suite.smartbusiness.odata4analytics.Dimension(this,o);this._oDimensionSet[d.getName()]=d;break;case"measure":var M=new sap.suite.smartbusiness.odata4analytics.Measure(this,o);this._oMeasureSet[M.getName()]=M;break;case"totaled-properties-list":this._oTotaledPropertyListProperty=o;break}break;case"attribute-for":var D=new sap.suite.smartbusiness.odata4analytics.DimensionAttribute(this,o);A[D.getKeyProperty()]=D;break}}}for(var s in A){var D=A[s];D.getDimension().addAttribute(D)}if(m._oActivatedWorkarounds.IdentifyTextPropertiesByName){var c=new Array();for(var f in this._oDimensionSet){var d=this._oDimensionSet[f];if(!d.getTextProperty()){var t=null;t=e.findPropertyByName(f+"Name");if(!t)t=e.findPropertyByName(f+"Text");if(!t)t=e.findPropertyByName(f+"Desc");if(!t)t=e.findPropertyByName(f+"Description");if(t){d.setTextProperty(t);c.push(t.name)}}}for(var i=-1,g;g=c[++i];){delete this._oDimensionSet[g]}}},getName:function(){return this.getEntitySet().getQName()},getParameterization:function(){return this._oParameterization},getAllDimensionNames:function(){if(this._aDimensionNames)return this._aDimensionNames;this._aDimensionNames=[];for(var n in this._oDimensionSet)this._aDimensionNames.push(this._oDimensionSet[n].getName());return this._aDimensionNames},getAllDimensions:function(){return this._oDimensionSet},getAllMeasureNames:function(){if(this._aMeasureNames)return this._aMeasureNames;this._aMeasureNames=[];for(var n in this._oMeasureSet)this._aMeasureNames.push(this._oMeasureSet[n].getName());return this._aMeasureNames},getAllMeasures:function(){return this._oMeasureSet},findDimensionByName:function(n){return this._oDimensionSet[n]},getTotaledPropertiesListProperty:function(){return this._oTotaledPropertyListProperty},findMeasureByName:function(n){return this._oMeasureSet[n]},getModel:function(){return this._oModel},getEntityType:function(){return this._oEntityType},getEntitySet:function(){return this._oEntitySet},_oModel:null,_oEntityType:null,_oEntitySet:null,_oParameterization:null,_aDimensionNames:null,_oDimensionSet:null,_aMeasureNames:null,_oMeasureSet:null,_oTotaledPropertyListProperty:null};sap.suite.smartbusiness.odata4analytics.Parameterization=function(e,E){this._init(e,E)};sap.suite.smartbusiness.odata4analytics.Parameterization.prototype={_init:function(e,E){this._oEntityType=e;this._oEntitySet=E;this._oParameterSet=new Object();var p=e.getTypeDescription().property;for(var i=-1,P;P=p[++i];){if(P.extensions==undefined)continue;for(var j=-1,o;o=P.extensions[++j];){if(!o.namespace==sap.suite.smartbusiness.odata4analytics.constants.SAP_NAMESPACE)continue;switch(o.name){case"parameter":var a=new sap.suite.smartbusiness.odata4analytics.Parameter(this,P);this._oParameterSet[a.getName()]=a;break}}}},setTargetQueryResult:function(q,a){this._oQueryResult=q;var Q=this._oEntityType.getSchema().namespace+"."+a.name;var n=this._oEntityType.getTypeDescription().navigationProperty;if(!n)throw"Invalid consumption model: Parameters entity type lacks navigation property for association to query result entity type";for(var i=-1,N;N=n[++i];){if(N.relationship==Q)this._oNavPropToQueryResult=N.name}if(!this._oNavPropToQueryResult)throw"Invalid consumption model: Parameters entity type lacks navigation property for association to query result entity type"},getName:function(){return this.getEntitySet().getQName()},getAllParameterNames:function(){if(this._aParameterNames)return this._aParameterNames;this._aParameterNames=[];for(var n in this._oParameterSet)this._aParameterNames.push(this._oParameterSet[n].getName());return this._aParameterNames},getAllParameters:function(){return this._oParameterSet},findParameterByName:function(n){return this._oParameterSet[n]},getNavigationPropertyToQueryResult:function(){return this._oNavPropToQueryResult},getEntityType:function(){return this._oEntityType},getEntitySet:function(){return this._oEntitySet},_oEntityType:null,_oEntitySet:null,_oQueryResult:null,_oNavPropToQueryResult:null,_aParameterNames:null,_oParameterSet:null,};sap.suite.smartbusiness.odata4analytics.Parameter=function(p,P){this._init(p,P)};sap.suite.smartbusiness.odata4analytics.Parameter.prototype={_init:function(p,P){this._oParameterization=p;this._oProperty=P;var e=p.getEntityType();if(P.extensions!=undefined){for(var i=-1,E;E=P.extensions[++i];){if(!E.namespace==sap.suite.smartbusiness.odata4analytics.constants.SAP_NAMESPACE)continue;switch(E.name){case"parameter":switch(E.value){case"mandatory":this._bRequired=true;break;case"optional":this._bRequired=false;break;default:throw"Invalid annotation value for parameter property"}break;case"label":this._sLabelText=E.value;break;case"text":this._oTextProperty=e.findPropertyByName(E.value);break;case"upper-boundary":this._bIntervalBoundaryParameter=true;this._oUpperIntervalBoundaryParameterProperty=e.findPropertyByName(E.value);break;case"lower-boundary":this._bIntervalBoundaryParameter=true;this._oLowerIntervalBoundaryParameterProperty=e.findPropertyByName(E.value);break}}}if(!this._sLabelText)this._sLabelText=""},setValueSetEntity:function(e,E){this._oValueSetEntityType=e;this._oValueSetEntitySet=E},getTextProperty:function(){return this._oTextProperty},getLabelText:function(){if(!this._sLabelText&&this._oQueryResult._oModel._oActivatedWorkarounds.CreateLabelsFromTechnicalNames)this._sLabelText=sap.suite.smartbusiness.odata4analytics.helper.tokenizeNametoLabelText(this.getName());return this._sLabelText},isOptional:function(){return(!this._bRequired)},isIntervalBoundary:function(){return this._bIntervalBoundaryParameter},isLowerIntervalBoundary:function(){return(this._oUpperIntervalBoundaryParameterProperty?true:false)},getPeerIntervalBoundaryParameter:function(){var p=null;if(this._oLowerIntervalBoundaryParameterProperty)p=this._oLowerIntervalBoundaryParameterProperty.name;else p=this._oUpperIntervalBoundaryParameterProperty.name;if(!p)throw"Parameter is not an interval boundary";return this._oParameterization.findParameterByName(p)},isValueSetAvailable:function(){return(this._oValueSetEntityType?true:false)},getName:function(){return this._oProperty.name},getProperty:function(){return this._oProperty},getContainingParameterization:function(){return this._oParameterization},getURIToValueEntitySet:function(s){var u=null;u=(s?s:"")+"/"+this._oValueSetEntitySet.getQName();return u},_oParameterization:null,_oProperty:null,_sLabelText:null,_oTextProperty:null,_bRequired:false,_bIntervalBoundaryParameter:false,_oLowerIntervalBoundaryParameterProperty:null,_oUpperIntervalBoundaryParameterProperty:null,_oValueSetEntityType:null,_oValueSetEntitySet:null,};sap.suite.smartbusiness.odata4analytics.Dimension=function(q,p){this._init(q,p)};sap.suite.smartbusiness.odata4analytics.Dimension.prototype={_init:function(q,p){this._oQueryResult=q;this._oProperty=p;this._oAttributeSet=new Object();if(p.extensions!=undefined){for(var i=-1,e;e=p.extensions[++i];){if(!e.namespace==sap.suite.smartbusiness.odata4analytics.constants.SAP_NAMESPACE)continue;switch(e.name){case"label":this._sLabelText=e.value;break;case"text":this._oTextProperty=q.getEntityType().findPropertyByName(e.value);break;case"super-ordinate":this._sSuperOrdinatePropertyName=e.value;break}}}if(!this._sLabelText)this._sLabelText=""},getName:function(){return this._oProperty.name},getKeyProperty:function(){return this._oProperty},getTextProperty:function(){return this._oTextProperty},setTextProperty:function(t){this._oTextProperty=t},getLabelText:function(){if(!this._sLabelText&&this._oQueryResult._oModel._oActivatedWorkarounds.CreateLabelsFromTechnicalNames)this._sLabelText=sap.suite.smartbusiness.odata4analytics.helper.tokenizeNametoLabelText(this.getName());return this._sLabelText},getSuperOrdinateDimension:function(){if(!this._sSuperOrdinatePropertyName)return null;return this._oQueryResult.findDimensionByName(this._sSuperOrdinatePropertyName)},getHierarchy:function(){if(!this._oHierarchy)this._oHierarchy=this._oQueryResult.getEntityType().getHierarchy(this._oProperty.name);return this._oHierarchy},getAllAttributeNames:function(){if(this._aAttributeNames)return this._aAttributeNames;this._aAttributeNames=[];for(var n in this._oAttributeSet)this._aAttributeNames.push(this._oAttributeSet[n].getName());return this._aAttributeNames},getAllAttributes:function(){return this._oAttributeSet},findAttributeByName:function(n){return this._oAttributeSet[n]},addAttribute:function(d){this._oAttributeSet[d.getName()]=d},getContainingQueryResult:function(){return this._oQueryResult},_oQueryResult:null,_oProperty:null,_oTextProperty:null,_sLabelText:null,_sSuperOrdinatePropertyName:null,_aAttributeNames:null,_oAttributeSet:null,_oHierarchy:null,};sap.suite.smartbusiness.odata4analytics.DimensionAttribute=function(q,p){this._init(q,p)};sap.suite.smartbusiness.odata4analytics.DimensionAttribute.prototype={_init:function(q,p){this._oQueryResult=q;this._oProperty=p;if(p.extensions!=undefined){for(var i=-1,e;e=p.extensions[++i];){if(!e.namespace==sap.suite.smartbusiness.odata4analytics.constants.SAP_NAMESPACE)continue;switch(e.name){case"attribute-for":this._sDimensionName=e.value;break;case"label":this._sLabelText=e.value;break;case"text":this._oTextProperty=q.getEntityType().findPropertyByName(e.value);break}}}},getName:function(){return this._oProperty.name},getKeyProperty:function(){return this._oProperty},getTextProperty:function(){return this._oTextProperty},getLabelText:function(){return this._sLabelText},getDimension:function(){return this._oQueryResult.findDimensionByName(this._sDimensionName)},_oQueryResult:null,_oProperty:null,_oTextProperty:null,_sLabelText:null,_sDimensionName:null,};sap.suite.smartbusiness.odata4analytics.Measure=function(q,p){this._init(q,p)};sap.suite.smartbusiness.odata4analytics.Measure.prototype={_init:function(q,p){this._oQueryResult=q;this._oProperty=p;if(p.extensions!=undefined){for(var i=-1,e;e=p.extensions[++i];){if(!e.namespace==sap.suite.smartbusiness.odata4analytics.constants.SAP_NAMESPACE)continue;switch(e.name){case"label":this._sLabelText=e.value;break;case"text":this._oTextProperty=q.getEntityType().findPropertyByName(e.value);break;case"unit":this._oUnitProperty=q.getEntityType().findPropertyByName(e.value);break}}}if(!this._sLabelText)this._sLabelText=""},getName:function(){return this._oProperty.name},getRawValueProperty:function(){return this._oProperty},getFormattedValueProperty:function(){return this._oTextProperty},getUnitProperty:function(){return this._oUnitProperty},getLabelText:function(){return this._sLabelText},_oQueryResult:null,_oProperty:null,_oTextProperty:null,_sLabelText:null,_oUnitProperty:null};sap.suite.smartbusiness.odata4analytics.EntitySet=function(m,s,c,e){this._init(m,s,c,e)};sap.suite.smartbusiness.odata4analytics.EntitySet.prototype={_init:function(m,s,c,e){this._oEntitySet=e;this._oContainer=c;this._oSchema=s;this._oModel=m;if(s.entityContainer.length>1)this._sQName=c.name+"."+e.name;else this._sQName=e.name},getQName:function(){return this._sQName},getSetDescription:function(){return this._oEntitySet},getSchema:function(){return this._oSchema},getModel:function(){return this._oModel},_oEntitySet:null,_oContainer:null,_oSchema:null,_oModel:null,_sQName:null,};sap.suite.smartbusiness.odata4analytics.EntityType=function(m,s,e){this._init(m,s,e)};sap.suite.smartbusiness.odata4analytics.EntityType.prototype={_init:function(m,s,e){this._oEntityType=e;this._oSchema=s;this._oModel=m;this._oPropertySet=new Object();this._aFilterablePropertyNames=[];this._aSortablePropertyNames=[];this._aRequiredFilterPropertyNames=[];this._sQName=s.namespace+"."+e.name;var r={};var R=null;for(var i=-1,p;p=e.property[++i];){this._oPropertySet[p.name]=p;this._aFilterablePropertyNames.push(p.name);this._aSortablePropertyNames.push(p.name);if(p.extensions==undefined)continue;for(var j=-1,E;E=p.extensions[++j];){if(!E.namespace==sap.suite.smartbusiness.odata4analytics.constants.SAP_NAMESPACE)continue;switch(E.name){case"filterable":if(E.value=="false")this._aFilterablePropertyNames.pop(p.name);break;case"sortable":if(E.value=="false")this._aSortablePropertyNames.pop(p.name);break;case"required-filter":if(E.value=="true")this._aRequiredFilterPropertyNames.push(p.name);break;case"hierarchy-node-for":if(!(R=r[p.name]))R=r[p.name]=new Object();R.dimensionName=E.value;break;case"hierarchy-parent-node-for":case"hierarchy-parent-nod":if(!(R=r[E.value]))R=r[E.value]=new Object();R.parentNodeIDProperty=p;break;case"hierarchy-level-for":if(!(R=r[E.value]))R=r[E.value]=new Object();R.levelProperty=p;break;case"hierarchy-drill-state-for":case"hierarchy-drill-stat":if(!(R=r[E.value]))R=r[E.value]=new Object();R.drillStateProperty=p;break}}}this._oRecursiveHierarchySet=new Object();for(var h in r){var H=r[h];var o=this._oPropertySet[h];var d=this._oPropertySet[H.dimensionName];if(d==null){d=o}this._oRecursiveHierarchySet[d.name]=new sap.suite.smartbusiness.odata4analytics.RecursiveHierarchy(e,o,H.parentNodeIDProperty,H.levelProperty,d)}},findPropertyByName:function(n){return this._oPropertySet[n]},getFilterablePropertyNames:function(){return this._aFilterablePropertyNames},getSortablePropertyNames:function(){return this._aSortablePropertyNames},getRequiredFilterPropertyNames:function(){return this._aRequiredFilterPropertyNames},getAllHierarchyPropertyNames:function(){if(this._aHierarchyPropertyNames)return this._aHierarchyPropertyNames;this._aHierarchyPropertyNames=[];for(var n in this._oRecursiveHierarchySet)this._aHierarchyPropertyNames.push(this._oRecursiveHierarchySet[n].getNodeValueProperty().name);return this._aHierarchyPropertyNames},getHierarchy:function(n){if(this._oRecursiveHierarchySet[n]==undefined)return null;return this._oRecursiveHierarchySet[n]},getQName:function(){return this._sQName},getTypeDescription:function(){return this._oEntityType},getSchema:function(){return this._oSchema},getModel:function(){return this._oModel},_oEntityType:null,_oSchema:null,_oModel:null,_sQName:null,_oPropertySet:null,_aFilterablePropertyNames:null,_aRequiredFilterPropertyNames:null,_aHierarchyPropertyNames:null,_oRecursiveHierarchySet:null,};sap.suite.smartbusiness.odata4analytics.RecursiveHierarchy=function(e,n,p,N,o){this._init(e,n,p,N,o)};sap.suite.smartbusiness.odata4analytics.RecursiveHierarchy.prototype={_init:function(e,n,p,N,o){this._oEntityType=e;this._oNodeIDProperty=n;this._oParentNodeIDProperty=p;this._oNodeLevelProperty=N;this._oNodeValueProperty=o},isRecursiveHierarchy:function(){return true},isLeveledHierarchy:function(){return false},getNodeIDProperty:function(){return this._oNodeIDProperty},getParentNodeIDProperty:function(){return this._oParentNodeIDProperty},getNodeLevelProperty:function(){return this._oNodeLevelProperty},getNodeValueProperty:function(){return this._oNodeValueProperty},_oNodeIDProperty:null,_oParentNodeIDProperty:null,_oNodeLevelProperty:null,_oNodeValueProperty:null,};sap.suite.smartbusiness.odata4analytics.FilterExpression=function(m,s,e){this._init(m,s,e)};sap.suite.smartbusiness.odata4analytics.FilterExpression.prototype={_init:function(m,s,e){this._oEntityType=e;this._oSchema=s;this._oModel=m;this._aFilterCondition=new Array()},clear:function(){this._aFilterCondition=new Array()},addCondition:function(p,o,v,V){var P=this._oEntityType.findPropertyByName(p);if(P==null){throw"Cannot add filter condition for unknown property name "+p}var f=this._oEntityType.getFilterablePropertyNames();if(f.indexOf(p)===-1){throw"Cannot add filter condition for not filterable property name "+p}this._aFilterCondition.push({property:P,op:o,val1:v,val2:V});return this._aFilterablePropertyNames},addSetCondition:function(p,v){var P=this._oEntityType.findPropertyByName(p);if(P==null){throw"Cannot add filter condition for unknown property name "+p}var f=this._oEntityType.getFilterablePropertyNames();if(f.indexOf(p)===-1){throw"Cannot add filter condition for not filterable property name "+p}for(var i=-1,V;V=v[++i];){this._aFilterCondition.push({property:P,op:sap.ui.model.FilterOperator.EQ,val1:V})}return this._aFilterablePropertyNames},getExpressionAsUI5FilterArray:function(){var f=new Array();for(var i=-1,c;c=this._aFilterCondition[++i];){f.push(new sap.ui.model.Filter(c.property.name,c.op,c.val1,c.val2))}return f},getURIFilterOptionValue:function(){if(this._aFilterCondition.length==0)return"";this._aFilterCondition.sort(function(a,b){if(a.property.name==b.property.name)return 0;if(a.property.name>b.property.name)return 1;else return-1});var p=this._aFilterCondition[0].property.name;var o="";var s="";for(var i=-1,c;c=this._aFilterCondition[++i];){if(p!=c.property.name){o+=(o==""?"":" and ")+"("+s+")";s="";p=c.property.name}switch(c.op){case sap.ui.model.FilterOperator.BT:s+=(s==""?"":" or ")+"("+c.property.name+" "+sap.ui.model.FilterOperator.GE.toLowerCase()+" "+sap.suite.smartbusiness.odata4analytics.helper.renderPropertyFilterValue(c.val1,c.property.type)+" and "+c.property.name+" "+sap.ui.model.FilterOperator.LE.toLowerCase()+" "+sap.suite.smartbusiness.odata4analytics.helper.renderPropertyFilterValue(c.val2,c.property.type)+")";break;default:s+=(s==""?"":" or ")+"("+c.property.name+" "+c.op.toLowerCase()+" "+sap.suite.smartbusiness.odata4analytics.helper.renderPropertyFilterValue(c.val1,c.property.type)+")"}}o+=(o==""?"":" and ")+"("+s+")";return o},getEntityType:function(){return this._oEntityType},getSchema:function(){return this._oSchema},getModel:function(){return this._oModel},_oEntityType:null,_oSchema:null,_oModel:null,_aFilterCondition:null,};sap.suite.smartbusiness.odata4analytics.SortOrder={Ascending:"asc",Descending:"desc"};sap.suite.smartbusiness.odata4analytics.SortExpression=function(m,s,e){this._init(m,s,e)};sap.suite.smartbusiness.odata4analytics.SortExpression.prototype={_init:function(m,s,e){this._oEntityType=e;this._oSchema=s;this._oModel=m;this._aSortCondition=[]},_containsSorter:function(p){var r=null;for(var i=-1,c;c=this._aSortCondition[++i];){if(c.property.name===p){r={sorter:c,index:i};break}}return r},_removeFromArray:function(a,f,t){var r=a.slice((t||f)+1||a.length);a.length=f<0?a.length+f:f;return a.push.apply(a,r)},clear:function(){this._aSortCondition=[]},addSorter:function(p,s){var P=this._oEntityType.findPropertyByName(p);if(P==null){throw"Cannot add sort condition for unknown property name "+p}if(this._containsSorter(p)!=null){throw"Sort condition for this property name is already defined "+p}var S=this._oEntityType.getSortablePropertyNames();if(S.indexOf(p)===-1){throw"Cannot add sort condition for not sortable property name "+p}this._aSortCondition.push({property:P,order:s});return this},removeSorter:function(p){if(!p)return;var s=this._containsSorter(p);if(s){this._removeFromArray(this._aSortCondition,s.index)}},getExpressionsAsUI5SorterArray:function(){var s=[];for(var i=-1,c;c=this._aSortCondition[++i];){s.push(new sap.ui.model.Sorter(c.property.name,c.order==sap.suite.smartbusiness.odata4analytics.SortOrder.Descending))}return s},getExpressionAsUI5Sorter:function(){var s=this.getExpressionsAsUI5SorterArray();if(s.length==0){return null}else{return s[0]}},getURIOrderByOptionValue:function(){if(this._aSortCondition.length==0)return"";var o="";for(var i=-1,c;c=this._aSortCondition[++i];){o+=c.property.name+" "+c.order;if(i<this._aSortCondition.length-1){o+=", "}}return o},getEntityType:function(){return this._oEntityType},getSchema:function(){return this._oSchema},getModel:function(){return this._oModel},_oEntityType:null,_oSchema:null,_oModel:null,_aSortCondition:null,};sap.suite.smartbusiness.odata4analytics.ParameterizationRequest=function(p){this._init(p)};sap.suite.smartbusiness.odata4analytics.ParameterizationRequest.prototype={_init:function(p){if(!p)throw"No parameterization given";this._oParameterization=p;this._oParameterValueAssignment=new Array()},getParameterization:function(){return this._oParameterization},setParameterValue:function(p,v,t){var P=this._oParameterization.findParameterByName(p);if(!P)throw"Invalid parameter name "+p;if(t!=null){if(!P.isIntervalBoundary())throw"Range value cannot be applied to parameter "+p+" accepting only single values";if(!P.isLowerIntervalBoundary())throw"Range value given, but parameter "+p+" does not hold the lower boundary"}if(!P.isIntervalBoundary()){if(v==null)delete this._oParameterValueAssignment[p];else this._oParameterValueAssignment[p]=v}else{if(v==null&&t!=null)throw"Parameter "+p+": An upper boundary cannot be given without the lower boundary";if(v==null){delete this._oParameterValueAssignment[p];t=null}else this._oParameterValueAssignment[p]=v;var u=P.getPeerIntervalBoundaryParameter();if(t==null)t=v;if(v==null)delete this._oParameterValueAssignment[u.getName()];else this._oParameterValueAssignment[u.getName()]=t}return},getURIToParameterizationEntitySet:function(s){return(s?s:"")+"/"+this._oParameterization.getEntitySet().getQName()},getURIToParameterizationEntry:function(s){var d=this._oParameterization.getAllParameters();for(var D in d){if(this._oParameterValueAssignment[D]==undefined)throw"Parameter "+D+" has no value assigned"}var k="",f=true;for(var p in this._oParameterValueAssignment){k+=(f?"":",")+p+"="+sap.suite.smartbusiness.odata4analytics.helper.renderPropertyKeyValue(this._oParameterValueAssignment[p],d[p].getProperty().type);f=false}return(s?s:"")+"/"+this._oParameterization.getEntitySet().getQName()+"("+k+")"},_oParameterization:null,_oParameterValueAssignment:null,};sap.suite.smartbusiness.odata4analytics.QueryResultRequest=function(q,p){this._init(q)};sap.suite.smartbusiness.odata4analytics.QueryResultRequest.prototype={_init:function(q,p){this._oQueryResult=q;this._oParameterizationRequest=p;this._oAggregationLevel=new Object();this._oMeasures=new Object();this._bIncludeEntityKey=false;this._oFilterExpression=null},setParameterizationRequest:function(p){this._oParameterizationRequest=p},getQueryResult:function(){return this._oQueryResult},setAggregationLevel:function(d){this._oAggregationLevel=new Object();if(!d){d=this._oQueryResult.getAllDimensionNames()}this.addToAggregationLevel(d)},addToAggregationLevel:function(d){if(!d)return;for(var i=-1,D;D=d[++i];){if(!this._oQueryResult.findDimensionByName(D))throw D+" is not a valid dimension name";this._oAggregationLevel[D]={key:true,text:false,attributes:null}}},removeFromAggregationLevel:function(d){if(!d){return}for(var i=-1,D;D=d[++i];){if(!this._oQueryResult.findDimensionByName(D)){throw D+" is not a valid dimension name"}if(this._oAggregationLevel[D]!=undefined){delete this._oAggregationLevel[D];this.getSortExpression().removeSorter(D)}}},getAggregationLevel:function(){var d=new Array();for(var D in this._oAggregationLevel){d.push(D)}return d},getAggregationLevelDetails:function(d){if(this._oAggregationLevel[d]==undefined)throw"Aggregation level does not include dimension "+d;return this._oAggregationLevel[d]},setMeasures:function(m){if(!m){m=this._oQueryResult.getAllMeasureNames()}this._oMeasures=new Object();for(var i=-1,M;M=m[++i];){if(!this._oQueryResult.findMeasureByName(M))throw M+" is not a valid measure name";this._oMeasures[M]={value:true,text:false,unit:false,}}},getMeasureNames:function(){var m=new Array();for(var M in this._oMeasures){m.push(M)}return m},includeDimensionKeyTextAttributes:function(d,I,b,a){var D=new Array();if(d){if(this._oAggregationLevel[d]==undefined)throw d+" is not included in the aggregation level";D.push(d)}else{for(var n in this._oAggregationLevel){D.push(n)}a=null}for(var i=-1,s;s=D[++i];){if(I!=null)this._oAggregationLevel[s].key=I;if(b!=null)this._oAggregationLevel[s].text=b;if(a!=null)this._oAggregationLevel[s].attributes=a}},includeMeasureRawFormattedValueUnit:function(m,I,b,a){var M=new Array();if(m){if(this._oMeasures[m]==undefined)throw m+" is not part of the query result";M.push(m)}else{for(var n in this._oMeasures){M.push(n)}}for(var i=-1,s;s=M[++i];){if(I!=null)this._oMeasures[s].value=I;if(b!=null)this._oMeasures[s].text=b;if(a!=null)this._oMeasures[s].unit=a}},getFilterExpression:function(){if(this._oFilterExpression==null){var e=this._oQueryResult.getEntityType();this._oFilterExpression=new sap.suite.smartbusiness.odata4analytics.FilterExpression(e.getModel(),e.getSchema(),e)}return this._oFilterExpression},setFilterExpression:function(f){this._oFilterExpression=f},getSortExpression:function(){if(this._oSortExpression==null){var e=this._oQueryResult.getEntityType();this._oSortExpression=new sap.suite.smartbusiness.odata4analytics.SortExpression(e.getModel(),e.getSchema(),e)}return this._oSortExpression},setSortExpression:function(s){this._oSortExpression=s},setRequestOptions:function(i,I){if(i)this._bIncludeEntityKey=i;if(I)this._bIncludeCount=I},setResultPageBoundaries:function(s,e){if(s!=null&&typeof s!=="number"){throw"Start value must be null or numeric"}if(e!==null&&typeof e!=="number"){throw"End value must be null or numeric"}if(s==null)s=1;if(s<1||s>(e==null?s:e)){throw"Invalid values for requested page boundaries"}this._iSkipRequestOption=(s>1)?s:null;this._iTopRequestOption=(e!=null)?(e-s+1):null},getResultPageBoundaries:function(){return{start:(this._iSkipRequestOption==null)?1:this._iSkipRequestOption,end:(this._iTopRequestOption!=null)?(this._iSkipRequestOption==null)?1:this._iSkipRequestOption+this._iTopRequestOption:null}},getURIToQueryResultEntitySet:function(s){var u=null;if(this._oQueryResult.getParameterization()){if(!this._oParameterizationRequest)throw"Missing parameterization request";else u=this._oParameterizationRequest.getURIToParameterizationEntry(s)+"/"+this._oQueryResult.getParameterization().getNavigationPropertyToQueryResult()}else u=(s?s:"")+"/"+this._oQueryResult.getEntitySet().getQName();return u},getURIQueryOptionValue:function(q){var Q=null;switch(q){case"$select":{var s="";for(var d in this._oAggregationLevel){var D=this._oQueryResult.findDimensionByName(d);var o=this._oAggregationLevel[d];if(o.key==true)s+=(s==""?"":",")+D.getKeyProperty().name;if(o.text==true&&D.getTextProperty())s+=(s==""?"":",")+D.getTextProperty().name;if(o.attributes){for(var i=-1,a;a=o.attributes[++i];){s+=(s==""?"":",")+D.findAttributeByName(a).getName()}}}for(var m in this._oMeasures){var M=this._oQueryResult.findMeasureByName(m);var b=this._oMeasures[m];if(b.value==true)s+=(s==""?"":",")+M.getRawValueProperty().name;if(b.text==true&&M.getFormattedValueProperty())s+=(s==""?"":",")+M.getFormattedValueProperty().name;if(b.unit==true&&M.getUnitProperty())s+=(s==""?"":",")+M.getUnitProperty().name}if(this._bIncludeEntityKey){var k=this._oQueryResult.getEntityType().getTypeDescription().key.propertyRef;for(var i=-1,K;K=k[++i];){s+=(s==""?"":",")+K.name}}Q=(s?s:null);break}case"$filter":{var f=null;if(this._oFilterExpression)f=this._oFilterExpression.getURIFilterOptionValue();Q=(f?f:null);break}case"$orderby":{var S=null;if(this._oSortExpression)S=this._oSortExpression.getURIOrderByOptionValue();Q=(S?S:null);break}case"$top":{if(this._iTopRequestOption!==null){Q=this._iTopRequestOption}break}case"$skip":{Q=this._iSkipRequestOption;break}default:break}return Q},getURIToQueryResultEntries:function(s){var r=this.getURIToQueryResultEntitySet(s);var S=this.getURIQueryOptionValue("$select");var f=this.getURIQueryOptionValue("$filter");var a=this.getURIQueryOptionValue("$orderby");var t=this.getURIQueryOptionValue("$top");var b=this.getURIQueryOptionValue("$skip");var u=r;var q=false;if(S){u+="?$select="+S;q=true}if(this._oFilterExpression&&f){if(!q){u+="?";q=true}else{u+="&"}u+="$filter="+f}if(this._oSortExpression&&a){if(!q){u+="?";q=true}else{u+="&"}u+="$orderby="+a}if(this._iTopRequestOption&&t){if(!q){u+="?";q=true}else{u+="&"}u+="$top="+t}if(this._iSkipRequestOption&&b){if(!q){u+="?";q=true}else{u+="&"}u+="$skip="+b}if(this._bIncludeCount){if(!q){u+="?";q=true}else{u+="&"}u+="$inlinecount=allpages"}return u},_oQueryResult:null,_oParameterizationRequest:null,_oAggregationLevel:null,_oMeasures:null,_bIncludeEntityKey:null,_bIncludeCount:null,_oFilterExpression:null,_oSortExpression:null,_iSkipRequestOption:0,_iTopRequestOption:null};sap.suite.smartbusiness.odata4analytics.ParameterValueSetRequest=function(p){this._init(p)};sap.suite.smartbusiness.odata4analytics.ParameterValueSetRequest.prototype={_init:function(p){this._oParameter=p;this._oValueSetResult=new Object();this._oFilterExpression=null;this._oSortExpression=null},includeParameterText:function(i){if(i!=null)this._oValueSetResult.text=i},getFilterExpression:function(){if(this._oFilterExpression==null){var e=this._oParameter.getContainingParameterization().getEntityType();this._oFilterExpression=new sap.suite.smartbusiness.odata4analytics.FilterExpression(e.getModel(),e.getSchema(),e)}return this._oFilterExpression},setFilterExpression:function(f){this._oFilterExpression=f},getSortExpression:function(){if(this._oSortExpression==null){var e=this._oQueryResult.getEntityType();this._oSortExpression=new sap.suite.smartbusiness.odata4analytics.SortExpression(e.getModel(),e.getSchema(),e)}return this._oSortExpression},setSortExpression:function(s){this._oSortExpression=s},getURIQueryOptionValue:function(q){var Q=null;switch(q){case"$select":{var s="";s+=(s==""?"":",")+this._oParameter.getProperty().name;if(this._oValueSetResult.text==true&&this._oParameter.getTextProperty())s+=(s==""?"":",")+this._oParameter.getTextProperty().name;Q=(s?s:null);break}case"$filter":{var f=null;if(this._oFilterExpression)f=this._oFilterExpression.getURIFilterOptionValue();Q=(f?f:null);break}case"$orderby":{var S=null;if(this._oSortExpression)S=this._oSortExpression.getURIOrderByOptionValue();Q=(S?S:null);break}default:break}return Q},getURIToParameterValueSetEntries:function(s){var r=null;r=(s?s:"")+"/"+this._oParameter.getContainingParameterization().getEntitySet().getQName();var S=this.getURIQueryOptionValue("$select");var f=this.getURIQueryOptionValue("$filter");var a=this.getURIQueryOptionValue("$orderby");var u=r;var q=false;if(S){u+="?$select="+S;q=true}if(this._oFilterExpression&&f){if(!q){u+="?";q=true}else u+="&";u+="$filter="+f}if(this._oSortExpression&&a){if(!q){u+="?";q=true}else u+="&";u+="$orderby="+a}return u},_oParameter:null,_oFilterExpression:null,_oSortExpression:null,_oValueSetResult:null};sap.suite.smartbusiness.odata4analytics.DimensionMemberSetRequest=function(d,p){this._init(d,p)};sap.suite.smartbusiness.odata4analytics.DimensionMemberSetRequest.prototype={_init:function(d,p){this._oDimension=d;this._oParameterizationRequest=p;this._oValueSetResult=new Object();this._oFilterExpression=null;this._oSortExpression=null},setParameterizationRequest:function(p){this._oParameterizationRequest=p},includeDimensionTextAttributes:function(i,a){if(i!=null)this._oValueSetResult.text=i;if(a!=null)this._oValueSetResult.attributes=a},getFilterExpression:function(){if(this._oFilterExpression==null){var e=this._oDimension.getContainingQueryResult().getEntityType();this._oFilterExpression=new sap.suite.smartbusiness.odata4analytics.FilterExpression(e.getModel(),e.getSchema(),e)}return this._oFilterExpression},setFilterExpression:function(f){this._oFilterExpression=f},getSortExpression:function(){if(this._oSortExpression==null){var e=this._oQueryResult.getEntityType();this._oSortExpression=new sap.suite.smartbusiness.odata4analytics.SortExpression(e.getModel(),e.getSchema(),e)}return this._oSortExpression},setSortExpression:function(s){this._oSortExpression=s},hasMasterDataAvailable:function(){return false},getURIQueryOptionValue:function(q){var Q=null;switch(q){case"$select":{var s="";s+=(s==""?"":",")+this._oDimension.getKeyProperty().name;if(this._oValueSetResult.text==true&&this._oDimension.getTextProperty())s+=(s==""?"":",")+this._oDimension.getTextProperty().name;if(this._oValueSetResult.attributes){for(var i=-1,a;a=this._oValueSetResult.attributes[++i];){s+=(s==""?"":",")+this._oDimension.findAttributeByName(a).getName()}}Q=(s?s:null);break}case"$filter":{var f=null;if(this._oFilterExpression)f=this._oFilterExpression.getURIFilterOptionValue();Q=(f?f:null);break}case"$orderby":{var S=null;if(this._oSortExpression)S=this._oSortExpression.getURIOrderByOptionValue();Q=(S?S:null);break}default:break}return Q},getURIToDimensionMemberEntries:function(s){var r=null;if(this._oDimension.getContainingQueryResult().getParameterization()){if(!this._oParameterizationRequest)throw"Missing parameterization request";else r=this._oParameterizationRequest.getURIToParameterizationEntry(s)+"/"+this._oDimension.getContainingQueryResult().getParameterization().getNavigationPropertyToQueryResult()}else r=(s?s:"")+"/"+this._oDimension.getContainingQueryResult().getEntitySet().getQName();var S=this.getURIQueryOptionValue("$select");var f=this.getURIQueryOptionValue("$filter");var a=this.getURIQueryOptionValue("$orderby");var u=r;var q=false;if(S){u+="?$select="+S;q=true}if(this._oFilterExpression&&f){if(!q){u+="?";q=true}else u+="&";u+="$filter="+f}if(this._oSortExpression&&a){if(!q){u+="?";q=true}else u+="&";u+="$orderby="+a}return u},_oDimension:null,_oParameterizationRequest:null,_oFilterExpression:null,_oSortExpression:null,_oValueSetResult:null}};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.library')){
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2013 SAP SE. All rights reserved
 */
jQuery.sap.declare("sap.suite.ui.smartbusiness.library");jQuery.sap.require('sap.ui.core.Core');jQuery.sap.require('sap.ui.core.library');jQuery.sap.require('sap.m.library');sap.ui.getCore().initLibrary({name:"sap.suite.ui.smartbusiness",dependencies:["sap.ui.core","sap.m"],types:[],interfaces:[],controls:[],elements:[],noLibraryCSS:true,version:"1.24.3"})};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.association.Component')){
/*!
* SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2013 SAP SE. All rights reserved
*/
jQuery.sap.declare("sap.suite.ui.smartbusiness.designtime.association.Component");jQuery.sap.require('sap.ca.scfld.md.ComponentBase');sap.ca.scfld.md.ComponentBase.extend("sap.suite.ui.smartbusiness.designtime.association.Component",{metadata:sap.ca.scfld.md.ComponentBase.createMetaData("MD",{"name":"Master Detail Sample","version":"1.0.0-SNAPSHOT","library":"sap.suite.ui.smartbusiness.designtime.association","includes":["../../lib/formatters.js","../../lib/Util.js"],"dependencies":{"libs":["sap.m"],"components":[]},"config":{"resourceBundle":"i18n/i18n.properties","titleResource":"SHELL_TITLE","icon":"sap-icon://Fiori5/F0821","favIcon":"../../../../../../../resources/sap/ca/ui/themes/base/img/favicon/F0821_Edit_KPI_Relationships.ico","homeScreenIconPhone":"../../../../../../../resources/sap/ca/ui/themes/base/img/launchicon/F0821_Edit_KPI_Relationships/57_iPhone_Desktop_Launch.png","homeScreenIconPhone@2":"../../../../../../../resources/sap/ca/ui/themes/base/img/launchicon/F0821_Edit_KPI_Relationships/114_iPhone-Retina_Web_Clip.png","homeScreenIconTablet":"../../../../../../../resources/sap/ca/ui/themes/base/img/launchicon/F0821_Edit_KPI_Relationships/72_iPad_Desktop_Launch.png","homeScreenIconTablet@2":"../../../../../../../resources/sap/ca/ui/themes/base/img/launchicon/F0821_Edit_KPI_Relationships/144_iPad_Retina_Web_Clip.png","startupImage320x460":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/320_x_460.png","startupImage640x920":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/640_x_920.png","startupImage640x1096":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/640_x_1096.png","startupImage768x1004":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/768_x_1004.png","startupImage748x1024":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/748_x_1024.png","startupImage1536x2008":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/1536_x_2008.png","startupImage1496x2048":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/1496_x_2048.png"},viewPath:"sap.suite.ui.smartbusiness.designtime.association.view",detailPageRoutes:{"associationCreate":{"pattern":"associationCreate/{contextPath}","view":"S4"},"associationEdit":{"pattern":"associationEdit/{contextPath}/{associationPath}","view":"S4"}}}),createContent:function(){var v={component:this};return sap.ui.view({viewName:"sap.suite.ui.smartbusiness.designtime.association.Main",type:sap.ui.core.mvc.ViewType.XML,viewData:v})}})};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.authorization.Component')){jQuery.sap.declare("sap.suite.ui.smartbusiness.designtime.authorization.Component");jQuery.sap.require('sap.ca.scfld.md.ComponentBase');sap.ca.scfld.md.ComponentBase.extend("sap.suite.ui.smartbusiness.designtime.authorization.Component",{metadata:sap.ca.scfld.md.ComponentBase.createMetaData("MD",{"name":"Master Detail Sample","version":"1.0.0-SNAPSHOT","library":"sap.suite.ui.smartbusiness.designtime.authorization","includes":["../../lib/formatters.js","../../lib/Util.js"],"dependencies":{"libs":["sap.m"],"components":[]},"config":{"resourceBundle":"i18n/i18n.properties","titleResource":"SHELL_TITLE","icon":"sap-icon://Fiori5/F0816","favIcon":"../../../../../../../resources/sap/ca/ui/themes/base/img/favicon/F0816_Manage_Authorizations.ico","homeScreenIconPhone":"../../../../../../../resources/sap/ca/ui/themes/base/img/launchicon/F0816_Manage_Authorizations/57_iPhone_Desktop_Launch.png","homeScreenIconPhone@2":"../../../../../../../resources/sap/ca/ui/themes/base/img/launchicon/F0816_Manage_Authorizations/114_iPhone-Retina_Web_Clip.png","homeScreenIconTablet":"../../../../../../../resources/sap/ca/ui/themes/base/img/launchicon/F0816_Manage_Authorizations/72_iPad_Desktop_Launch.png","homeScreenIconTablet@2":"../../../../../../../resources/sap/ca/ui/themes/base/img/launchicon/F0816_Manage_Authorizations/144_iPad_Retina_Web_Clip.png","startupImage320x460":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/320_x_460.png","startupImage640x920":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/640_x_920.png","startupImage640x1096":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/640_x_1096.png","startupImage768x1004":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/768_x_1004.png","startupImage748x1024":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/748_x_1024.png","startupImage1536x2008":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/1536_x_2008.png","startupImage1496x2048":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/1496_x_2048.png"},viewPath:"sap.suite.ui.smartbusiness.designtime.authorization.view",fullScreenPageRoutes:{"subDetail":{"pattern":"subDetail/{contextPath}","view":"S4",}}}),createContent:function(){var v={component:this};return sap.ui.view({viewName:"sap.suite.ui.smartbusiness.designtime.authorization.Main",type:sap.ui.core.mvc.ViewType.XML,viewData:v})}})};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.drilldown.Component')){jQuery.sap.declare("sap.suite.ui.smartbusiness.designtime.drilldown.Component");jQuery.sap.require('sap.ca.scfld.md.ComponentBase');sap.ca.scfld.md.ComponentBase.extend("sap.suite.ui.smartbusiness.designtime.drilldown.Component",{metadata:sap.ca.scfld.md.ComponentBase.createMetaData("MD",{"name":"Master Detail Sample","version":"1.1.0-SNAPSHOT","library":"sap.suite.ui.smartbusiness.designtime.drilldown","includes":["css/style.css","../../lib/Util.js","../../lib/DrilldownModel.js","../../lib/DrilldownWriteService.js","../../lib/ListPersona.js","../../lib/DrilldownSaveService.js"],"dependencies":{"libs":["sap.m"],"components":[]},"config":{"resourceBundle":"i18n/i18n.properties","titleResource":"SHELL_TITLE","icon":"sap-icon://Fiori5/F0819","favIcon":"../../../../../../../resources/sap/ca/ui/themes/base/img/favicon/F0819_Edit_Drill_Down_Confs.ico","homeScreenIconPhone":"../../../../../../../resources/sap/ca/ui/themes/base/img/launchicon/F0819_Edit_DrillDown_Configs/57_iPhone_Desktop_Launch.png","homeScreenIconPhone@2":"../../../../../../../resources/sap/ca/ui/themes/base/img/launchicon/F0819_Edit_DrillDown_Configs/114_iPhone-Retina_Web_Clip.png","homeScreenIconTablet":"../../../../../../../resources/sap/ca/ui/themes/base/img/launchicon/F0819_Edit_DrillDown_Configs/72_iPad_Desktop_Launch.png","homeScreenIconTablet@2":"../../../../../../../resources/sap/ca/ui/themes/base/img/launchicon/F0819_Edit_DrillDown_Configs/144_iPad_Retina_Web_Clip.png","startupImage320x460":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/320_x_460.png","startupImage640x920":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/640_x_920.png","startupImage640x1096":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/640_x_1096.png","startupImage768x1004":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/768_x_1004.png","startupImage748x1024":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/748_x_1024.png","startupImage1536x2008":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/1536_x_2008.png","startupImage1496x2048":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/1496_x_2048.png"},viewPath:"sap.suite.ui.smartbusiness.designtime.drilldown.view",fullScreenPageRoutes:[{"pattern":"configureChart/{evaluationId}/{viewId}","view":"configureNewView","name":"configureChart"},{"pattern":"configurator/{evaluationId}/{viewId}","view":"configurator","name":"configurator"}]}),createContent:function(){var v={component:this};if(jQuery.browser.msie){if(jQuery.browser.fVersion=="9"){jQuery.sap.includeStyleSheet(jQuery.sap.getModulePath("sap.suite.ui.smartbusiness.designtime.drilldown/css")+"/ie9.css")}}return sap.ui.view({viewName:"sap.suite.ui.smartbusiness.designtime.drilldown.Main",type:sap.ui.core.mvc.ViewType.XML,viewData:v})}})};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.visualization.Component')){jQuery.sap.declare("sap.suite.ui.smartbusiness.designtime.visualization.Component");jQuery.sap.require('sap.ca.scfld.md.ComponentBase');sap.ca.scfld.md.ComponentBase.extend("sap.suite.ui.smartbusiness.designtime.visualization.Component",{metadata:sap.ca.scfld.md.ComponentBase.createMetaData("MD",{"name":"Master Detail Sample","version":"1.0.0-SNAPSHOT","library":"sap.suite.ui.smartbusiness.designtime.visualization","includes":["../../lib/Util.js","themes/visualization.css"],"dependencies":{"libs":["sap.m","sap.suite.ui.commons"],"components":[]},"config":{"resourceBundle":"i18n/i18n.properties","titleResource":"SHELL_TITLE","icon":"sap-icon://Fiori5/F0820","favIcon":"../../../../../../../resources/sap/ca/ui/themes/base/img/favicon/F0820_Edit_Tiles.ico","homeScreenIconPhone":"../../../../../../../resources/sap/ca/ui/themes/base/img/launchicon/F0820_Edit_Tiles/57_iPhone_Desktop_Launch.png","homeScreenIconPhone@2":"../../../../../../../resources/sap/ca/ui/themes/base/img/launchicon/F0820_Edit_Tiles/114_iPhone-Retina_Web_Clip.png","homeScreenIconTablet":"../../../../../../../resources/sap/ca/ui/themes/base/img/launchicon/F0820_Edit_Tiles/72_iPad_Desktop_Launch.png","homeScreenIconTablet@2":"../../../../../../../resources/sap/ca/ui/themes/base/img/launchicon/F0820_Edit_Tiles/144_iPad_Retina_Web_Clip.png","startupImage320x460":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/320_x_460.png","startupImage640x920":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/640_x_920.png","startupImage640x1096":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/640_x_1096.png","startupImage768x1004":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/768_x_1004.png","startupImage748x1024":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/748_x_1024.png","startupImage1536x2008":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/1536_x_2008.png","startupImage1496x2048":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/1496_x_2048.png"},viewPath:"sap.suite.ui.smartbusiness.designtime.visualization.view",fullScreenPageRoutes:{"addTile":{"pattern":"addTile/{contextPath}","view":"S4",},"editTile":{"pattern":"editTile/{contextPath}/{chipContextPath}","view":"S4",},}}),createContent:function(){var v={component:this};return sap.ui.view({viewName:"sap.suite.ui.smartbusiness.designtime.visualization.Main",type:sap.ui.core.mvc.ViewType.XML,viewData:v})}})};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.workspace.Component')){jQuery.sap.declare("sap.suite.ui.smartbusiness.designtime.workspace.Component");jQuery.sap.require('sap.ca.scfld.md.ComponentBase');sap.ca.scfld.md.ComponentBase.extend("sap.suite.ui.smartbusiness.designtime.workspace.Component",{metadata:sap.ca.scfld.md.ComponentBase.createMetaData("MD",{"name":"Master Detail Sample","version":"1.0.0-SNAPSHOT","library":"sap.suite.ui.smartbusiness.designtime.workspace","includes":["../../lib/formatters.js","../../lib/Util.js"],"dependencies":{"libs":["sap.m"],"components":[]},"config":{"resourceBundle":"i18n/i18n.properties","titleResource":"SHELL_TITLE","icon":"sap-icon://Fiori5/F0818","favIcon":"../../../../../../../resources/sap/ca/ui/themes/base/img/favicon/F0818_KPI_Workspace.ico","homeScreenIconPhone":"../../../../../../../resources/sap/ca/ui/themes/base/img/launchicon/F0818_KPI_Workspace/57_iPhone_Desktop_Launch.png","homeScreenIconPhone@2":"../../../../../../../resources/sap/ca/ui/themes/base/img/launchicon/F0818_KPI_Workspace/114_iPhone-Retina_Web_Clip.png","homeScreenIconTablet":"../../../../../../../resources/sap/ca/ui/themes/base/img/launchicon/F0818_KPI_Workspace/72_iPad_Desktop_Launch.png","homeScreenIconTablet@2":"../../../../../../../resources/sap/ca/ui/themes/base/img/launchicon/F0818_KPI_Workspace/144_iPad_Retina_Web_Clip.png","startupImage320x460":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/320_x_460.png","startupImage640x920":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/640_x_920.png","startupImage640x1096":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/640_x_1096.png","startupImage768x1004":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/768_x_1004.png","startupImage748x1024":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/748_x_1024.png","startupImage1536x2008":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/1536_x_2008.png","startupImage1496x2048":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/1496_x_2048.png"},viewPath:"sap.suite.ui.smartbusiness.designtime.workspace.view",detailPageRoutes:{"evalDetail":{"pattern":"evalDetail/{contextPath}/{evalPath}","view":"S4"},"multiSelect":{"pattern":"multiSelect","view":"S3"},"detail":{"pattern":"detail/{contextPath}","view":"S3"}},}),createContent:function(){var v={component:this};return sap.ui.view({viewName:"sap.suite.ui.smartbusiness.designtime.workspace.Main",type:sap.ui.core.mvc.ViewType.XML,viewData:v})}})};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.lib.Util')){jQuery.sap.declare("sap.suite.ui.smartbusiness.lib.Util");sap.suite=sap.suite||{};sap.suite.smartbusiness=sap.suite.smartbusiness||{};sap.suite.smartbusiness.odata=(function(){var m={};function g(M){var O=new sap.suite.smartbusiness.odata4analytics.Model(sap.suite.smartbusiness.odata4analytics.Model.ReferenceByModel(M));return O};return{getModelByServiceUri:function(s,u){if(typeof s=='string'){if(!m[s]){var M=new sap.ui.model.odata.ODataModel(s,true);m[s]=M}return m[s]}return s},getUri:function(p){function _(s){return s.replace(/'/g,"''")}try{var O=g(this.getModelByServiceUri(p.oDataModel||p.serviceUri));var q=O.findQueryResultByName(p.entitySet);var Q=new sap.suite.smartbusiness.odata4analytics.QueryResultRequest(q);var a=p.measure;if(a){if(typeof a=='string'){a=a.split(",")}Q.setMeasures(a);if(typeof p.includeMeasureRawFormattedValueUnit=='undefined'){p.includeMeasureRawFormattedValueUnit=true}if(p.includeMeasureRawFormattedValueUnit){Q.includeMeasureRawFormattedValueUnit(null,true,true,true)}}var d=p.dimension;if(d){if(typeof d=='string'){d=d.split(",")}Q.addToAggregationLevel(d);if(typeof p.includeDimensionKeyTextAttribute=='undefined'){p.includeDimensionKeyTextAttribute=true}if(p.includeDimensionKeyTextAttribute){Q.includeDimensionKeyTextAttributes(null,true,true,null)}}if(p.filter&&p.filter.length){var v=p.filter;var f=new Array();var b=new Array();for(var i=0,l=v.length;i<l;i++){var c=v[i];if(c.TYPE==="PA"){b.push(c)}else if(c.TYPE==="FI"){f.push(c)}}function h(r){var s=r.toJSON();var t=s.charAt(s.length-1).toUpperCase();if(t.charCodeAt(0)>=65&&t.charCodeAt(0)<=90){s=s.slice(0,-1)}return s};function j(r){if(r){try{if(r==+r){r=window.parseInt(r)}var s=new Date(r);var t=s.getTime();if(isNaN(t)){return r}else{return h(s)}}catch(e){}}return r};if(f.length){var F=Q.getFilterExpression();for(var i=0,l=f.length;i<l;i++){var c=f[i];if(this.getEdmType(p.serviceUri,c.NAME)=="Edm.DateTime"){c.VALUE_1=j(c.VALUE_1);c.VALUE_2=j(c.VALUE_2)}if(c.OPERATOR==sap.ui.model.FilterOperator.BT){F.addCondition(c.NAME,c.OPERATOR,window.encodeURIComponent(_(c.VALUE_1)),window.encodeURIComponent(c.VALUE_2))}else{F.addCondition(c.NAME,c.OPERATOR,window.encodeURIComponent(_(c.VALUE_1.replace(/\|\^/g,","))),null)}}}if(b.length){if(q.getParameterization()){var P=new sap.suite.smartbusiness.odata4analytics.ParameterizationRequest(q.getParameterization());for(var y=0,z=b.length;y<z;y++){var k=b[y];P.setParameterValue(k.NAME,window.encodeURIComponent(_(k.VALUE_1)))}Q.setParameterizationRequest(P)}}}var n=Q.getURIToQueryResultEntries();if(p.sort&&p.sort.length){var o="&$orderby=";p.sort.forEach(function(s){o+=s.name+" "+s.order+","});o=o.substring(0,o.length-1);n=n+o}if(p.dataLimit){n=n+"&$top="+p.dataLimit}return{uri:n,model:O.getODataModel()}}catch(e){jQuery.sap.log.error("Error Preparing Query Service Uri using OData4Analytics Library : "+e.toString());return null}},getEdmType:function(u,p,d){function _(f){var h="None";var k=f.extensions||[];for(var i=0;i<k.length;i++){if(k[i].name=="display-format"){h=k[i].value.toUpperCase();break}}return h}var D=null;var r=null;if(u instanceof sap.ui.model.odata.ODataModel){D=u}else{D=this.getModelByServiceUri(u)}if(D&&D.getServiceMetadata()){var s=D.getServiceMetadata();var e=s.dataServices.schema[0].entityType;if(e){for(var i=0;i<e.length;i++){var a=e[i];var b=a.property;for(var j=0;j<b.length;j++){var c=b[j];if(c.name==p){if(d){r={type:c.type,format:_(c)}}else{r=c.type}}}}}}return r},getAllEntitySet:function(u){var a=new Array();try{var o=g(this.getModelByServiceUri(u));a=o.getAllQueryResultNames()}catch(e){jQuery.sap.log.error("Error fetching Enity Set : "+e.toString())}return a},measures:function(u,e){var o=g(this.getModelByServiceUri(u));var q=o.findQueryResultByName(e);var a=q.getAllMeasureNames();return{getAsStringArray:function(){return a},getAsObjectArray:function(k){k=k||"name";var b=[];a.forEach(function(M){var c={};c[k]=M;b.push(c)});return b},getAsObjectArrayWithLabel:function(O,l){O=O||"name";l=l||"label";var b=[];a.forEach(function(M){var c=q.findMeasureByName(M);var d={};d[O]=M;d[l]=c.getLabelText()||M;b.push(d)});return b},getUnitProperty:function(b){var M=q.findMeasureByName(b);if(M.getUnitProperty()){return M.getUnitProperty().name}return null}}},properties:function(u,a){var o=g(this.getModelByServiceUri(u));var q=o.findQueryResultByName(a);var d=q.getAllDimensionNames();var b=q.getAllMeasureNames();return{getLabelMappingObject:function(p){var c={};if(p&&p.length){p.forEach(function(f,i,h){try{var D=q.findDimensionByName(f);c[f]=D.getLabelText()||f}catch(e){var M=q.findMeasureByName(f);c[f]=M.getLabelText()||f}});return c}else{d.forEach(function(D){var e=q.findDimensionByName(D);c[D]=e.getLabelText()||D});b.forEach(function(M){var e=q.findMeasureByName(M);c[M]=e.getLabelText()||M});return c}},getTextPropertyMappingObject:function(p){var c={};if(p&&p.length){p.forEach(function(f,i,h){try{var D=q.findDimensionByName(f);if(D.getTextProperty()){c[f]=D.getTextProperty().name||f}else{c[f]=f}}catch(e){jQuery.sap.log.error("Invalid Dimension Name : "+f)}})}else{d.forEach(function(D){var e=q.findDimensionByName(D);if(e.getTextProperty()){c[D]=e.getTextProperty().name||D}else{c[D]=D}});b.forEach(function(M){var e=q.findMeasureByName(M);if(e.getFormattedValueProperty&&e.getFormattedValueProperty()){c[M]=e.getFormattedValueProperty().name}else{c[M]=null}})}return c},getUnitPropertyMappingObject:function(){var c={};b.forEach(function(M){var e=q.findMeasureByName(M);if(e.getUnitProperty()){c[M]=e.getUnitProperty().name}else{c[M]=null}});return c}}},dimensions:function(u,e){var o=g(this.getModelByServiceUri(u));var q=o.findQueryResultByName(e);var d=q.getAllDimensionNames();return{getAsStringArray:function(){var a=q.getEntityType();return d},getAsObjectArray:function(k){k=k||"name";var a=[];d.forEach(function(D){var b={};b[k]=D;a.push(b)});return a},getAsObjectArrayWithLabel:function(O,l){O=O||"name";l=l||"label";var a=[];d.forEach(function(D){var b=q.findDimensionByName(D);var c={};c[O]=D;c[l]=b.getLabelText()||D;a.push(c)});return a},getTextProperty:function(a){var D=q.findDimensionByName(a);if(D.getTextProperty()){return D.getTextProperty().name}return null}}},getAllMeasures:function(u,a){var b=new Array();try{var o=g(this.getModelByServiceUri(u));var q=o.findQueryResultByName(a);b=q.getAllMeasureNames()}catch(e){jQuery.sap.log.error("Error Fetching All Measures : "+e.toString())}return b},getAllMeasuresWithLabelText:function(u,a){var b=new Array();try{var o=g(this.getModelByServiceUri(u));var q=o.findQueryResultByName(a);var c=q.getAllMeasureNames();for(var i=0;i<c.length;i++){var d=c[i];var M=q.findMeasureByName(d);b.push({key:d,value:M.getLabelText()})}}catch(e){jQuery.sap.log.error("Error Fetching All Measures : "+e.toString())}return b},isTimeZoneIndependent:function(u,a){var i=false;try{var o=g(this.getModelByServiceUri(u));var q=o.findQueryResultByName(a);var b=q.getEntityType();var c=b._oPropertySet;for(var d in c){if(d.match(/TimeZone$/gi)){i=true}}}catch(e){jQuery.sap.log.error("TimeZone dependency check failed : "+e.toString())}return i},getAllDimensions:function(u,a){function i(c,h){var j=0,k=0;var r=new Array();while(j<c.length&&k<h.length){if(c[j]<h[k]){j++}else if(c[j]>h[k]){k++}else{r.push(c[j]);j++;k++}}return r}var d=new Array();var f=new Array();try{var o=g(this.getModelByServiceUri(u));var q=o.findQueryResultByName(a);var b=q.getEntityType();f=b.getFilterablePropertyNames();d=q.getAllDimensionNames();if(f&&f.length){d=i(f.sort(),d.sort())}}catch(e){jQuery.sap.log.error("Error Fetching All Dimesions : "+e.toString())}return d},getAllDimensionsWithLabelText:function(u,a){var d=new Array();try{var o=g(this.getModelByServiceUri(u));var q=o.findQueryResultByName(a);var b=q.getAllDimensionNames();for(var i=0;i<b.length;i++){var c=b[i];var D=q.findDimensionByName(c);var t=null;if(D.getTextProperty()!=null)t=D.getTextProperty().name;d.push({key:c,value:D.getLabelText(),textProperty:t})}}catch(e){jQuery.sap.log.error("Error Fetching All Dimesions : "+e.toString())}return d},getAllInputParams:function(u,a){var i=new Array();try{var o=g(this.getModelByServiceUri(u));var q=o.findQueryResultByName(a);if(q.getParameterization()){var p=q.getParameterization();i=p.getAllParameterNames()}}catch(e){jQuery.sap.log.error("Error Fetching Input Params : "+e.toString())}return i},getAllInputParamsWithFlag:function(u,a){var b=new Array();try{var o=g(this.getModelByServiceUri(u));var q=o.findQueryResultByName(a);if(q.getParameterization()){var p=q.getParameterization();var c=p.getAllParameterNames();for(var i=0;i<c.length;i++){var d=c[i];var f=p.findParameterByName(d);b.push({name:d,optional:f.isOptional()})}}}catch(e){jQuery.sap.log.error("Error Fetching Input Params : "+e.toString())}return b},formatOdataEdmTimeToString:function(v){if(v&&v.constructor.name=="Object"){if(v.__edmType=="Edm.Time"){var a=v.ms;var s=Math.floor((a/1000)%60);var b=Math.floor((a/60000)%60);var h=Math.floor((a/3600000)%24);return h+"H"+b+"M"+s+"S"}}return v},formatValue:function(v,s,p,M){M=M||4;var u={3:"K",6:"M",9:"B",12:"T",0:""};var t,a,b;t=Number(v).toPrecision(M);a=Number(t.split("e")[0]);b=Number(t.split("e")[1])||0;if(!v&&v!=0)return{value:"",unitPrefix:""};if(b%3!=0){if(b%3==2){if(b+1==s){b=b+1;a=a/10}else{b=b-2;a=a*100}}else{if(b+2==s){b=b+2;a=a/100}else{b--;a=a*10}}}else if(b==15){a=a*1000;b=12}a+="";if((a).indexOf(".")<M){a=Number(a).toPrecision(M);var c=a.split(".")[1]?a.split(".")[1].length:0;if((p||p==0)&&p<c){a=Number(a).toFixed(p)}}else a=Number(a).toPrecision(M);return{value:Number(a),unitPrefix:u[b]}}}})();sap.suite.smartbusiness.cache=(function(){var B={};var D={};return{getEvaluationById:function(k){if(B[k]){return B[k]}return null},setEvaluationById:function(k,d){B[k]=d},getKpiDetailsById:function(k){if(D[k]){return D[k]}return null},setKpiDetailsById:function(k,d){D[k]=d},invalidateKpiDetailsCache:function(){D={}},current_calls:{}}})();sap.suite.smartbusiness.utils=(function(){return{addSystemToServiceUrl:function(s,S){if(S){if(s.indexOf('/')!==0||s.indexOf('//')===0){throw new Error("addSystemToServiceUrl: Invalid URL: "+s,"sap.suite.smartbusiness.utils")}if(/^[^?]*(;o=([\/;?]|$))/.test(s)){return s.replace(/;o=([\/;?]|$)/,(S?";o="+S:"")+"$1")}if(/^[^?]*;o=/.test(s)){return s}if(S){return s.replace(/(\/[^?]*?)(\/$|$|(\/?\?.*))/,"$1;o="+S+"$2")}}else{jQuery.sap.log.warning("Not adding System to Service URL : "+s)}return s},showErrorMessage:function(e,d){if(d==null||d==''){sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:e})}else{sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:e,details:d})}},getMantissaLength:function(n){var N=n.toString();var i=0;if(n<0){i=1}return(N.indexOf('.')===-1)?(n<0?N.length-1:N.length):N.substring(i,N.indexOf('.')).length},getLocaleFormattedValue:function(n,s){if(s==-2){var N;if(n>9999)N="????";else if(n<0.001)N="0";else if(n.toString().indexOf('.')!=-1)N=Number(n).toFixed(4-n.toString().indexOf('.'));else N=Number(n)}else{var d=2;var m=this.getMantissaLength(n);if(!(m%6))d=1;if(Math.abs(n)%Math.pow(10,m-1)==0){d=0}else if((Math.abs(n)%Math.pow(10,m-1))<6*Math.pow(10,m-4)){d=0}var l=new sap.ui.core.Locale(sap.ui.getCore().getConfiguration().getLanguage());var v=sap.ca.ui.model.format.NumberFormat.getInstance({style:"short",shortDecimals:d},l);var N=v.format(n)}return N},getRandomNumber:function(m){return Math.floor(Math.random()*10000)%m},getObjectOrder:function(o){var d={TAGS:["ID","IS_ACTIVE","TYPE","TAG"],PROPERTIES:["ID","IS_ACTIVE","TYPE","NAME","VALUE"],EVALUATION_TEXTS:["ID","IS_ACTIVE","LANGUAGE","TITLE","DESCRIPTION"],INDICATOR_TEXTS:["ID","IS_ACTIVE","LANGUAGE","TITLE","DESCRIPTION"],CHIP_TEXTS:["id","isActive","language","title","description"],EVALUATION_VALUES:["ID","IS_ACTIVE","TYPE","FIXED","COLUMN_NAME","ODATA_PROPERTY"],EVALUATION_FILTERS:["ID","IS_ACTIVE","TYPE","NAME","VALUE_1","OPERATOR","VALUE_2"],ASSOCIATION_PROPERTIES:["TYPE","SOURCE_INDICATOR","TARGET_INDICATOR","IS_ACTIVE","NAME","VALUE"],APP_PARAMETERS:["NAME","VALUE"],AUTHORIZATION:["NAME","TYPE"]};return d[o]},getFilterArray:function(a,f){var b=[];var c={};for(var i=0,l=a.length;i<l;i++){c[a[i].getParent().getKey()]=c[a[i].getParent().getKey()]||[];c[a[i].getParent().getKey()].push(f[a[i].getKey()])}for(var d in c){b.push(new sap.ui.model.Filter(c[d],false))}return b},dirtyBitCheck:function(a){var b=a.oldPayload;var c=a.newPayload;var t=a.objectType;if((b instanceof Array)&&(c instanceof Array)){var o={};var n={};var u=[];var d=[];o=this.arrayToObject(b,t);n=this.arrayToObject(c,t);for(var a in n){if(!(o[a])){u.push(n[a])}else{delete o[a]}}for(var a in o){d.push(o[a])}return{updates:u,deletes:d}}else if((b instanceof Object)&&(c instanceof Object)){var e={};for(var k in c){if(c.hasOwnProperty(k)){if(c[k]!=b[k]){e=c;if(t=="ASSOCIATIONS"){return{updates:[e],deletes:[b]}}return{updates:[e]}}}}return{updates:[]}}},updateChips:function(o,a){var b=null;var e=null;a=a||new sap.ui.model.odata.ODataModel("/sap/hba/r/sb/core/odata/modeler/SMART_BUSINESS.xsodata",true);if(o.INDICATORS){b=o.INDICATORS}else if(o.EVALUATIONS){e=o.EVALUATIONS}if(b&&b.length){for(var i=0,l=b.length;i<l;i++){}}if(e&&e.length){for(var i=0,l=e.length;i<l;i++){a.read(("/CHIPS?$filter=evaluationId eq '"+e[i].EVALUATIONS.ID+"' and isActive eq 1"),null,null,false,function(d){if(d.results&&d.results.length){var c=d.results;var u=[];var v=[];var f=[];var g=true;var o={};for(var j=0,m=c.length;j<m;j++){var h=JSON.parse(c[j].configuration);var t=JSON.parse(h.tileConfiguration);for(var k=0,n=e[i].EVALUATION_VALUES.length;k<n;k++){o={};o.TYPE=e[i].EVALUATION_VALUES[k].TYPE;o.FIXED=e[i].EVALUATION_VALUES[k].FIXED;o.COLUMN_NAME=e[i].EVALUATION_VALUES[k].COLUMN_NAME;o.ODATA_PROPERTY=e[i].EVALUATION_VALUES[k].ODATA_PROPERTY;v.push(o)}for(var k=0,n=e[i].EVALUATION_FILTERS.length;k<n;k++){o={};o.TYPE=e[i].EVALUATION_FILTERS[k].TYPE;o.NAME=e[i].EVALUATION_FILTERS[k].NAME;o.VALUE_1=e[i].EVALUATION_FILTERS[k].VALUE_1;o.OPERATOR=e[i].EVALUATION_FILTERS[k].OPERATOR;o.VALUE_2=e[i].EVALUATION_FILTERS[k].VALUE_2;f.push(o)}t.EVALUATION=JSON.stringify(e[i].EVALUATIONS);t.EVALUATION_VALUES=JSON.stringify(v);t.EVALUATION_FILTERS=JSON.stringify(f);h.tileConfiguration=JSON.stringify(t);h.timeStamp=Date.now().toString();h=JSON.stringify(h);if(h.length>4096){t.EVALUATION_FILTERS=JSON.stringify([]);h=JSON.stringify({tileConfiguration:JSON.stringify(t),isSufficient:"0"})}for(var p in d.results[j]){if(d.results[j].hasOwnProperty(p)){if((d.results[j][p]instanceof Object)&&!(d.results[j][p]instanceof Array)&&!(d.results[j][p]instanceof Date)){delete d.results[j][p]}}}d.results[j].configuration=h;var q="CHIPS(id='"+d.results[j].id+"',isActive=1)";u.push(a.createBatchOperation(q,"PUT",d.results[j]))}a.addBatchChangeOperations(u);a.submitBatch(function(d,r,s){if(s.length){g=false;return}var w=d.__batchResponses[0].__changeResponses;for(var x in w)if(w[x].statusCode!="201"&&w[x].statusCode!="204"&&w[x].statusCode!="200"){g=false}},function(r){g=false},false);if(!g){}}},function(c){})}}},arrayToObject:function(a,t){var o=this.getObjectOrder(t);var b={};var k="";for(var i=0,l=a.length;i<l;i++){if(!(a[i]instanceof Array)&&(a[i]instanceof Object)){k="";for(var j=0,m=o.length;j<m;j++){k+=(j)?"^|":"";k+=a[i][o[j]]}b[k]=a[i]}}return b},appToAppNavigation:function(o){var h="#";var a=window.hasher.getHashAsArray();var b=a[0].substr(a[0].indexOf("?"));if(b&&(b.charAt(b.length-1)=="&")){b=b.substr(0,b.length-1)}if(o.action){if(o.context||o.route){if(o.context.charAt(0)=="/"){o.context=o.context.substr(1)}o.context="&/"+((o.route+"/")||"")+(o.context||"")}h+=(o.semanticObject||"FioriApplication-")+o.action+b+(o.context||"")}if(!(sap.ui.core.routing)){jQuery.sap.require("sap.ui.core.routing")}var c=new sap.ui.core.routing.HashChanger();sap.suite.smartbusiness.utils.setPrevAppHash();c.setHash(h)},hashChange:function(o){if(!(sap.ui.core.routing)){jQuery.sap.require("sap.ui.core.routing")}var h=new sap.ui.core.routing.HashChanger();h.setHash(o.hash||"#")},replaceHash:function(o,i){if(i){window.location.replace(o.hash)}else{var h="#";var a=window.hasher.getHashAsArray();var b=a[0].substr(a[0].indexOf("?"));if(b&&(b.charAt(b.length-1)=="&")){b=b.substr(0,b.length-1)}if(o.action){if(o.context||o.route){if(o.context.charAt(0)=="/"){o.context=o.context.substr(1)}o.context="&/"+((o.route+"/")||"")+(o.context||"")}h+=(o.semanticObject||"FioriApplication-")+o.action+b+(o.context||"")}window.location.replace(h)}},setPrevAppHash:function(){hasher=hasher||window.hasher;sap.suite.smartbusiness=sap.suite.smartbusiness||{};sap.suite.smartbusiness.modelerAppCache=sap.suite.smartbusiness.modelerAppCache||{};sap.suite.smartbusiness.modelerAppCache.prevApp=sap.suite.smartbusiness.modelerAppCache.prevApp||{};sap.suite.smartbusiness.modelerAppCache.prevApp.prevAppHash=hasher.getHash();sap.suite.smartbusiness.modelerAppCache.prevApp.prevAppHashAsArray=hasher.getHashAsArray()},backToHome:function(){sap.suite.smartbusiness=sap.suite.smartbusiness||{};sap.suite.smartbusiness.modelerAppCache=sap.suite.smartbusiness.modelerAppCache||{};if(sap.suite.smartbusiness.modelerAppCache.prevApp){delete sap.suite.smartbusiness.modelerAppCache.prevApp}sap.suite.smartbusiness.modelerAppCache.SBWorkspace={};sap.suite.smartbusiness.modelerAppCache.createSBKPI={};sap.suite.smartbusiness.modelerAppCache.createSBKPIEvaluation={};sap.suite.smartbusiness.modelerAppCache.configureSBKPITile={};sap.suite.smartbusiness.modelerAppCache.manageSBKPIAssociation={};sap.suite.smartbusiness.modelerAppCache.configureSBKPIDrilldown={};sap.suite.smartbusiness.modelerAppCache.authorizeSBEvaluation={}},isHanaViewValid:function(o){sap.suite.smartbusiness=sap.suite.smartbusiness||{};sap.suite.smartbusiness.modelerAppCache=sap.suite.smartbusiness.modelerAppCache||{};sap.suite.smartbusiness.modelerAppCache[o.app]=sap.suite.smartbusiness.modelerAppCache[o.app]||{};if(!(o.VIEW_NAME)){return false}if(o.cache&&o.app&&(sap.suite.smartbusiness.modelerAppCache[o.app].hanaViewValid!==undefined)){return sap.suite.smartbusiness.modelerAppCache[o.app].hanaViewValid}else{var f=false;var e="/HANA_VIEWS"+"?$filter="+"PACKAGE eq "+"'"+o.VIEW_NAME.substr(0,o.VIEW_NAME.indexOf("/"))+"'"+" and "+"OBJECT eq "+"'"+o.VIEW_NAME.substr(o.VIEW_NAME.indexOf("/")+1)+"'";o.model=o.model||new sap.ui.model.odata.ODataModel("/sap/hba/r/sb/core/odata/modeler/SMART_BUSINESS.xsodata",true);o.model.read(e,null,null,false,function(d){if(d.results.length){f=true}else{f=false}},function(){f=true});if(o.app){sap.suite.smartbusiness.modelerAppCache[o.app].hanaViewValid=f}return f}},isHanaViewFormatValid:function(o){sap.suite.smartbusiness=sap.suite.smartbusiness||{};sap.suite.smartbusiness.modelerAppCache=sap.suite.smartbusiness.modelerAppCache||{};sap.suite.smartbusiness.modelerAppCache[o.app]=sap.suite.smartbusiness.modelerAppCache[o.app]||{};if(!(o.VIEW_NAME)){return false}if(o.cache&&o.app&&(sap.suite.smartbusiness.modelerAppCache[o.app].hanaViewFormatValid!==undefined)){return sap.suite.smartbusiness.modelerAppCache[o.app].hanaViewFormatValid}else{if((o.VIEW_NAME.indexOf("/")==-1)&&(o.VIEW_NAME.indexOf("::")==-1)){if(o.app){sap.suite.smartbusiness.modelerAppCache[o.app].hanaViewFormatValid=false}return false}if(o.app){sap.suite.smartbusiness.modelerAppCache[o.app].hanaViewFormatValid=true}return true}},isODataURLValidForHanaView:function(o){sap.suite.smartbusiness=sap.suite.smartbusiness||{};sap.suite.smartbusiness.modelerAppCache=sap.suite.smartbusiness.modelerAppCache||{};sap.suite.smartbusiness.modelerAppCache[o.app]=sap.suite.smartbusiness.modelerAppCache[o.app]||{};if(o.cache&&o.app&&(sap.suite.smartbusiness.modelerAppCache[o.app].oDataURLValid!==undefined)){return sap.suite.smartbusiness.modelerAppCache[o.app].oDataURLValid}else{var e="/ODATA_FOR_ENTITY"+"("+"P_PACKAGE="+"'"+o.VIEW_NAME.substr(0,o.VIEW_NAME.indexOf("/"))+"'"+","+"P_OBJECT="+"'"+o.VIEW_NAME.substr(o.VIEW_NAME.indexOf("/")+1)+"'"+")/Results";o.model=o.model||new sap.ui.model.odata.ODataModel("/sap/hba/r/sb/core/odata/modeler/SMART_BUSINESS.xsodata",true);o.model.read(e,null,null,false,function(d){if(d.results.length){if(d.results.indexOf(odata)){if(o.app){sap.suite.smartbusiness.modelerAppCache[o.app].oDataURLValid=true;sap.suite.smartbusiness.modelerAppCache[o.app].oDataURLValidForHanaView=true}return true}else{if(o.app){sap.suite.smartbusiness.modelerAppCache[o.app].oDataURLValid=false;sap.suite.smartbusiness.modelerAppCache[o.app].oDataURLValidForHanaView=false}return false}}else{if(o.app){sap.suite.smartbusiness.modelerAppCache[o.app].oDataURLValid=false;sap.suite.smartbusiness.modelerAppCache[o.app].oDataURLValidForHanaView=false}return false}},function(){if(o.app){sap.suite.smartbusiness.modelerAppCache[o.app].oDataURLValid=false;sap.suite.smartbusiness.modelerAppCache[o.app].oDataURLValidForHanaView=false}return false})}},isODataURLValidByExistence:function(o){sap.suite.smartbusiness=sap.suite.smartbusiness||{};sap.suite.smartbusiness.modelerAppCache=sap.suite.smartbusiness.modelerAppCache||{};sap.suite.smartbusiness.modelerAppCache[o.app]=sap.suite.smartbusiness.modelerAppCache[o.app]||{};if(o.cache&&o.app&&(sap.suite.smartbusiness.modelerAppCache[o.app].oDataURLValid!==undefined)){return sap.suite.smartbusiness.modelerAppCache[o.app].oDataURLValid}else{var m=new sap.ui.model.odata.ODataModel(o.ODATA_URL,true);if(m.getServiceMetadata()){odataExists=true}else{odataExists=false}if(o.app){sap.suite.smartbusiness.modelerAppCache[o.app].oDataURLValid=odataExists;sap.suite.smartbusiness.modelerAppCache[o.app].oDataURLValidByExistence=odataExists}return odataExists}},isODataURLValid:function(o){if(o.VIEW_NAME){return sap.suite.smartbusiness.utils.isODataURLValidForHanaView(o)}else{return sap.suite.smartbusiness.utils.isODataURLValidByExistence(o)}},isEntitysetValid:function(o){sap.suite.smartbusiness=sap.suite.smartbusiness||{};sap.suite.smartbusiness.modelerAppCache=sap.suite.smartbusiness.modelerAppCache||{};sap.suite.smartbusiness.modelerAppCache[o.app]=sap.suite.smartbusiness.modelerAppCache[o.app]||{};if(o.cache&&o.app&&(sap.suite.smartbusiness.modelerAppCache[o.app].entitysetValid!==undefined)){return sap.suite.smartbusiness.modelerAppCache[o.app].entitysetValid}else{try{if(o.VIEW_NAME){}else{if(sap.suite.smartbusiness.odata.getAllEntitySet(o.ODATA_URL).indexOf(o.ODATA_ENTITYSET)==-1){if(o.app){sap.suite.smartbusiness.modelerAppCache[o.app].entitysetValid=false}return false}else{if(o.app){sap.suite.smartbusiness.modelerAppCache[o.app].entitysetValid=true}return true}}}catch(e){if(o.app){sap.suite.smartbusiness.modelerAppCache[o.app].entitysetValid=false}return false}}},isMeasureValid:function(o){sap.suite.smartbusiness=sap.suite.smartbusiness||{};sap.suite.smartbusiness.modelerAppCache=sap.suite.smartbusiness.modelerAppCache||{};sap.suite.smartbusiness.modelerAppCache[o.app]=sap.suite.smartbusiness.modelerAppCache[o.app]||{};if(o.cache&&o.app&&(sap.suite.smartbusiness.modelerAppCache[o.app].measureValid!==undefined)){return sap.suite.smartbusiness.modelerAppCache[o.app].measureValid}try{if(sap.suite.smartbusiness.odata.getAllMeasures(o.ODATA_URL,o.ODATA_ENTITYSET).indexOf(o.COLUMN_NAME)==-1){if(o.app){sap.suite.smartbusiness.modelerAppCache[o.app].measureValid=false}return false}else{if(o.app){sap.suite.smartbusiness.modelerAppCache[o.app].validValueMeasure=true}return true}}catch(e){if(o.app){sap.suite.smartbusiness.modelerAppCache[o.app].validValueMeasure=false}return false}},getHanaSystem:function(){var h=hasher||window.hasher;var a=h.getHashAsArray();if(a&&a.length&&a[0]){var b=a[0].substr(a[0].indexOf("?")+1).split("&");for(var i=0,l=b.length;i<l;i++){if(b[i]&&(b[i].indexOf("sap-system")!=-1)){return b[i].split("=")[1]}}}return""},fetchCSRFToken:function(){var t="/sap/hba/r/sb/core/logic/__token.xsjs";if(sap.ushell&&sap.ushell.Container){t=sap.ushell.Container.getService("URLParsing").addSystemToServiceUrl(t,this.getHanaSystem())}return jQuery.ajax({type:"HEAD",async:false,dataType:"json",url:t,headers:{"X-CSRF-Token":"Fetch"},success:function(d,s,x){},error:function(){}})},appendUrlParameters:function(u,a){var b=u.split("?");if(b.length>2){throw new Error("Url not formed properly")}if(sap.ushell&&sap.ushell.Container){b[0]=sap.ushell.Container.getService("URLParsing").addSystemToServiceUrl(b[0],this.getHanaSystem())}u=b[0];if(b.length==2){u+="?"+b[1]}if(a&&Object.keys(a)&&Object.keys(a).length){u=u+"?"+jQuery.param(a)}return u},getLocaleLanguage:function(){return((sap.ui.getCore().getConfiguration().getLanguage())?sap.ui.getCore().getConfiguration().getLanguage().split("-")[0].toUpperCase():"")},create:function(u,p,a,b,e,c,f){var t=this;c=c?true:false;sap.suite.smartbusiness.utils.fetchCSRFToken().done(function(d,s,x){jQuery.ajax({type:"POST",async:c,url:sap.suite.smartbusiness.utils.appendUrlParameters(u,f),data:encodeURIComponent(JSON.stringify(p)),headers:{"X-CSRF-Token":x.getResponseHeader("X-CSRF-Token"),"Accept-Language":t.getLocaleLanguage()},success:b,error:e})})},update:function(u,p,a,b,e,m,c,f,g){var t=this;f=f?true:false;sap.suite.smartbusiness.utils.fetchCSRFToken().done(function(d,s,x){jQuery.ajax({type:"PUT",async:f,url:sap.suite.smartbusiness.utils.appendUrlParameters(u,g),data:encodeURIComponent(JSON.stringify(p)),headers:{"X-CSRF-Token":x.getResponseHeader("X-CSRF-Token"),"Accept-Language":t.getLocaleLanguage(),"If-None-Match":(c||"")},success:b,error:e})})},remove:function(u,p,a,e,b,c,f,g){var t=this;f=f?true:false;sap.suite.smartbusiness.utils.fetchCSRFToken().done(function(d,s,x){jQuery.ajax({type:"DELETE",async:f,url:sap.suite.smartbusiness.utils.appendUrlParameters(u,g),data:encodeURIComponent(JSON.stringify(p)),headers:{"X-CSRF-Token":x.getResponseHeader("X-CSRF-Token"),"Accept-Language":t.getLocaleLanguage(),"If-None-Match":(b||"")},success:a,error:e})})},serviceUrl:function(u){var C={INDICATOR_SERVICE_URI:"/sap/hba/r/sb/core/logic/indicators.xsjs",EVALUATION_SERVICE_URI:"/sap/hba/r/sb/core/logic/evaluations.xsjs",CHIP_SERVICE_URI:"/sap/hba/r/sb/core/logic/chips.xsjs",ACTIVATE_INDICATOR_SERVICE_URI:"/sap/hba/r/sb/core/logic/activateIndicator.xsjs",ACTIVATE_EVALUATION_SERVICE_URI:"/sap/hba/r/sb/core/logic/activateEvaluation.xsjs",INDICATOR_FAVOURITE_SERVICE_URI:"/sap/hba/r/sb/core/logic/favouriteIndicator.xsjs",EVALUATION_FAVOURITE_SERVICE_URI:"/sap/hba/r/sb/core/logic/favouriteEvaluation.xsjs",ASSOCIATIONS_CUD:"/sap/hba/r/sb/core/logic/associations_cud.xsjs",ACTIVATE_ASSOCIATION_SERVICE_URI:"/sap/hba/r/sb/core/logic/activateAssociation.xsjs",ACTIVATE_CHIP_SERVICE_URI:"/sap/hba/r/sb/core/logic/activateChip.xsjs",AUTHORIZATION_SERVICE_URI:"/sap/hba/r/sb/core/logic/authorization.xsjs",COPY_DDA_CONFIGURATION_SERVICE_URI:"/sap/hba/r/sb/core/logic/copyDrilldownConfiguration.xsjs"};return C[u]}}})();sap.suite.smartbusiness.kpi=(function(){var C={KPI_SERVICE_URI:"/sap/hba/r/sb/core/odata/modeler/SMART_BUSINESS.xsodata",KPI_RUNTIME_SERVICE_URI:"/sap/hba/r/sb/core/odata/runtime/SMART_BUSINESS.xsodata",EVALUATIONS_ENTITY_SET:"/EVALUATIONS",EVALUATIONS_DDA_ENTITY_SET:"/EVALUATIONS_DDA",ASSOCIATED_INDICATORS_ENTITY_SET:"ASSOCIATED_INDICATORS",DESIGN_TIME_SERVICE_URI:"/sap/hba/r/sb/core/odata/modeler/SMART_BUSINESS.xsodata"};function g(p,r){var a=r?"_rt":"_dt";var k=p.id;if(p.filters){k+="_FILTERS"}if(p.thresholds){k+="_VALUES"}k+=a;return k};var _=function(u,s){if(sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService){var a=sap.ushell.Container.getService("URLParsing");if(a){u=a.addSystemToServiceUrl(u,s)}}return u};return{getSiblingEvaluations:function(p){if(!p.indicator){throw new Error("Indicator Not Found")}var m=null;if(sap.suite.smartbusiness.odata){m=sap.suite.smartbusiness.odata.getModelByServiceUri(C.KPI_SERVICE_URI)}else{m=new sap.ui.model.odata.ODataModel(C.KPI_SERVICE_URI,true)}var a=!!p.success;var f="INDICATOR eq '#INDICATOR_ID'".replace("#INDICATOR_ID",p.indicator);var s=[];var d={};d["$filter"]=f;var e="";if(p.filters){e+="FILTERS,"}if(p.thresholds){e+="VALUES,"}if(e){d["$expand"]=e.substring(0,e.length-1)}var b=C.EVALUATIONS_ENTITY_SET;if(p.getDDAEvaluation){b=C.EVALUATIONS_DDA_ENTITY_SET}m.read(b,null,d,a,function(c){if(c.results&&c.results.length){var t=c.results||[];s=t}if(a){p.success.call(p.context||null,s)}},function(){jQuery.sap.log.error("Error fetching Evaluation : ",p.id);if(p.error){p.error.apply(p.context||null,arguments)}});return s},getAssociatedEvaluations:function(p){if(!p.id){throw new Error("Evaluation Not Found")}var m=null;if(sap.suite.smartbusiness.odata){m=sap.suite.smartbusiness.odata.getModelByServiceUri(C.DESIGN_TIME_SERVICE_URI)}else{m=new sap.ui.model.odata.ODataModel(C.DESIGN_TIME_SERVICE_URI,true)}var a=!!p.success;var f="SOURCE_EVALS eq '#EVALUATION_ID' or TARGET_EVALS eq '#EVALUATION_ID'".replace("#EVALUATION_ID",p.id);var b=[];var d={};d["$filter"]=f;var e="SOURCE_EVALUATION,TARGET_EVALUATION";if(p.filters){e+="FILTERS,"}if(p.thresholds){e+="VALUES,"}if(e){d["$expand"]=e.substring(0,e.length)}m.read(C.ASSOCIATED_INDICATORS_ENTITY_SET,null,d,a,function(c){c=(c.results&&c.results.length)?c.results:[];c.forEach(function(o){if(o.TARGET_EVALS==p.id){b.push(o.SOURCE_EVALUATION)}else if(o.SOURCE_EVALS==p.id){b.push(o.TARGET_EVALUATION)}});if(a){p.success.call(p.context||null,b)}},function(){jQuery.sap.log.error("Error fetching Evaluation : ",p.id);if(p.error){p.error.apply(p.context||null,arguments)}});return b},getEvaluationById:function(p){if(!p.id){throw new Error("Evaluation Id Not Found")}var u=!!p.useRuntimeService;var c=g(p,u);if(p.cache){var e=sap.suite.smartbusiness.cache.getEvaluationById(c);if(e){if(p.success){p.success.call(p.context||null,e);return null}else{return e}}}var m=null;var a=u?C.KPI_RUNTIME_SERVICE_URI:C.KPI_SERVICE_URI;var a=_(a,p.sapSystem);if(sap.suite.smartbusiness.odata){m=sap.suite.smartbusiness.odata.getModelByServiceUri(a)}else{m=new sap.ui.model.odata.ODataModel(a,true)}var b=!!p.success;var f="ID eq '#EVALUATION_ID'".replace("#EVALUATION_ID",p.id);var d=null;var D={};D["$filter"]=f;var h="";if(p.filters){h+="FILTERS,"}if(p.thresholds){h+="VALUES,"}if(h){D["$expand"]=h.substring(0,h.length-1)}var i=C.EVALUATIONS_ENTITY_SET;if(p.getDDAEvaluation){i=C.EVALUATIONS_DDA_ENTITY_SET}else{}m.read(i,null,D,b,function(j){if(j.results&&j.results.length){d=j.results[0];sap.suite.smartbusiness.cache.setEvaluationById(c,d)}if(b){p.success.call(p.context||null,d)}},function(){jQuery.sap.log.error("Error fetching Evaluation : ",p.id);if(p.error){p.error.apply(p.context||null,arguments)}});return d},parseEvaluation:function(e){return new sap.suite.smartbusiness.kpi.Evaluation(e)}}})();sap.suite.smartbusiness.kpi.Thresholds=function(t){this.thresholdsData=t;var T={"TA":{prop:'_target',func:"getTarget"},"CL":{prop:'_criticalLow',func:"getCriticalLow"},"CH":{prop:'_criticalHigh',func:"getCriticalHigh"},"WL":{prop:'_warningLow',func:"getWarningLow"},"WH":{prop:'_warningHigh',func:"getWarningHigh"},"TC":{prop:'_trend',func:"getTrend"},"RE":{prop:"_reference",func:"getReference"}};var g=function(o){if(o.FIXED){return'FIXED'}if(o.COLUMN_NAME){return'COLUMN_NAME'}if(o.ODATA_URL){return'ODATA_URL'}return null};this.parse=function(a){a.forEach(function(b){var m=T[b.TYPE];if(m){var c=g(b);this[m.prop+"Type"]=c;this[m.prop+"Value"]=b[c];sap.suite.smartbusiness.kpi.Thresholds.prototype[m.func+"Type"]=function(){return this[m.prop+"Type"]};sap.suite.smartbusiness.kpi.Thresholds.prototype[m.func]=function(){return this[m.prop+"Value"]}}},this);for(var e in T){var o=T[e];if(!sap.suite.smartbusiness.kpi.Thresholds.prototype[o.func]){sap.suite.smartbusiness.kpi.Thresholds.prototype[o.func+"Type"]=function(){return null};sap.suite.smartbusiness.kpi.Thresholds.prototype[o.func]=function(){return null}}}};this.parse(this.thresholdsData.results)};sap.suite.smartbusiness.kpi.Evaluation=function(e){this.evaluationData=e;this.thresholds=null;if(this.evaluationData&&this.evaluationData.VALUES){this._init();this.thresholds=new sap.suite.smartbusiness.kpi.Thresholds(this.evaluationData.VALUES)}};sap.suite.smartbusiness.kpi.Evaluation.PropertyMapping={ID:"getId",ODATA_URL:"getODataUrl",ODATA_ENTITYSET:"getEntitySet",GOAL_TYPE:"getGoalType",INDICATOR:"getKpiId",TITLE:"getTitle",DESCRIPTION:"getDescription",SCALING:"getScaling",COLUMN_NAME:"getKpiMeasureName",INDICATOR_TITLE:"getKpiName",SEMANTIC_OBJECT:"getSemanticObject",ACTION:"getAction",OWNER_NAME:"getOwnerName",OWNER_ID:"getOwnerId",VALUES_SOURCE:"getThresholdValueType",FILTERS:"getFilters",VALUES:"getValues",PROPERTIES:"getProperties",TAGS:"getTags",INDICATOR_PROPERTIES:"getKpiDetail"};sap.suite.smartbusiness.kpi.Evaluation.prototype={_init:function(){for(var e in sap.suite.smartbusiness.kpi.Evaluation.PropertyMapping){(function(e){var f=sap.suite.smartbusiness.kpi.Evaluation.PropertyMapping[e];sap.suite.smartbusiness.kpi.Evaluation.prototype[f]=function(){return this.evaluationData[e]}})(e)}},getThresholds:function(){return this.thresholds},isMaximizingKpi:function(){return this.getGoalType()=="MA"},isMinimizingKpi:function(){return this.getGoalType()=="MI"},isTargetKpi:function(){return this.getGoalType()=="RA"}}};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.tiles.Generic')){jQuery.sap.declare("sap.suite.ui.smartbusiness.tiles.Generic");sap.ui.core.Control.extend("sap.suite.ui.smartbusiness.tiles.Generic",{metadata:{properties:{evaluationId:"string",associationEvaluationId:{type:"string",defaultValue:null},header:"string",subheader:"string",mode:{type:"string",defaultValue:"RUNTIME"},size:{type:"string",defaultValue:"S"},dimension:{type:"string",defaultValue:null},frameType:{type:"string",defaultValue:"OneByOne"},contentOnly:{type:"boolean",defaultValue:false},kpiValueRequired:{type:"boolean",defaultValue:true},sapSystem:{type:"string",defaultValue:null},additionalFilters:{type:"object",defaultValue:{}},visible:{type:"boolean",defaultValue:true},click:{type:"boolean",defaultValue:true},tileConfiguration:{type:"object",defaultValue:null}},aggregations:{_tile:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"}}}});sap.suite.ui.smartbusiness.tiles.Generic.Mode={"RUNTIME":"RUNTIME","DUMMY":"DUMMY",};sap.suite.ui.smartbusiness.tiles.Generic.prototype._addSystemAliasToUri=function(u,s){if(sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService){var p=sap.ushell.Container.getService("URLParsing");if(p){u=p.addSystemToServiceUrl(u,s)}}return u};sap.suite.ui.smartbusiness.tiles.Generic.prototype.init=function(){this._oScalingFactor={"0":"","3":"Kilo","6":"Million","9":"Billion","-9":"Nano","-6":"Micro","-3":"Milli"};this.EVALUATION_DATA=null;this.evaluationApi=null;this.THRESHOLD_MAPPING={"TA":{prop:'TARGET_VALUE',},"CL":{prop:'CRITICAL_LOW_VALUE'},"CH":{prop:'CRITICAL_HIGH_VALUE'},"WL":{prop:'WARNING_LOW_VALUE'},"WH":{prop:'WARNING_HIGH_VALUE'},"TC":{prop:'TREND_VALUE',},"RE":{prop:"REFERENCE_VALUE"}};for(var e in this.THRESHOLD_MAPPING){var p=this.THRESHOLD_MAPPING[e].prop;this[p]=null}this.setAggregation("_tile",new sap.suite.ui.commons.GenericTile({}))};sap.suite.ui.smartbusiness.tiles.Generic.prototype.onBeforeRendering=function(){};sap.suite.ui.smartbusiness.tiles.Generic.prototype._initODataMetadata=function(){var s=this._addSystemAliasToUri(this.evaluationApi.getODataUrl(),this.getSapSystem());var p=sap.suite.smartbusiness.odata.properties(s,this.evaluationApi.getEntitySet());var c=[];c.push(this.evaluationApi.getKpiMeasureName());if(this.getDimension()){c.push(this.getDimension())}this.LABEL_PROPERTY_MAPPING=p.getLabelMappingObject();this.TEXT_PROPERTY_MAPPING=p.getTextPropertyMappingObject();this.UOM_PROPERTY_MAPPING=p.getUnitPropertyMappingObject()};sap.suite.ui.smartbusiness.tiles.Generic.prototype.renderTile=function(){var a=this.getEvaluationId();if(this.isAssociatedKpi()){a=this.getAssociationEvaluationId()}this.setLoadingState();this.oData_Call_Ref_Evaluation_Details=sap.suite.smartbusiness.drilldown.getEvaluationById({id:a,cache:true,filters:true,thresholds:true,sapSystem:this.getSapSystem(),success:function(b){if(b.ID){this.EVALUATION_DATA=b;this.evaluationApi=sap.suite.smartbusiness.kpi.parseEvaluation(b);this._initODataMetadata();this._fetchKpiValue(function(){if(!this.getVisible()){this.$().css("opacity","0.2")}else{this.$().show(1000)}if(this.getClick())this.$().off("click");else this.$().click(function(){return false});this._initThresholdPopOver();try{this.doProcess()}catch(e){jQuery.sap.log.error("Error in doProcess() : "+e.message);this.setFailedState()}})}else{this.logError("Empty results for evaluation Id : "+a)}},error:function(e){this.logError(e)},context:this})};sap.suite.ui.smartbusiness.tiles.Generic.prototype._getOtherThresholdMeasures=function(){var t=this.EVALUATION_DATA.VALUES.results;var o={};if(this.evaluationApi.getThresholdValueType()=="MEASURE"){t.forEach(function(a){var m=a.COLUMN_NAME;if(m){var b=this.THRESHOLD_MAPPING[a.TYPE];if(b){o[b.prop]=m}}},this);return o}else{t.forEach(function(a){var b=this.THRESHOLD_MAPPING[a.TYPE];if(b){this[b.prop]=a.FIXED}},this);return null}};sap.suite.ui.smartbusiness.tiles.Generic.prototype._getThresholdsValues=function(q,t){if(t){for(var e in t){this[e]=q[t[e]]}}};sap.suite.ui.smartbusiness.tiles.Generic.prototype._fetchKpiValue=function(c){if(this.getKpiValueRequired()){var k=this.evaluationApi.getKpiMeasureName();var t=this._getOtherThresholdMeasures();var a=[k];if(t){a.push(this.evaluationApi.getKpiMeasureName());for(var e in t){a.push(t[e])}}var u=this.UOM_PROPERTY_MAPPING[k];var b=this.getUrlFilters();var d=this.evaluationApi.getFilters()["results"];var q=sap.suite.smartbusiness.odata.getUri({serviceUri:this._addSystemAliasToUri(this.evaluationApi.getODataUrl(),this.getSapSystem()),entitySet:this.evaluationApi.getEntitySet(),measure:a,dimension:null,filter:this.getAllFilters()});var T=this;var f=this.getEvaluationId();if(this.isAssociatedKpi()){f=this.getAssociationEvaluationId()}this.Fetch_Kpi_Value_Success=function(h){if(h&&h.results.length){var r=h.results[0];T.KPI_VALUE=r[k];T.UOM="";if(u){T.UOM=r[u]}T._getThresholdsValues(r,t);sap.suite.smartbusiness.cache.setKpiDetailsById(f,h);if(sap.suite.smartbusiness.cache.current_calls[f]){var x=sap.suite.smartbusiness.cache.current_calls[f];delete sap.suite.smartbusiness.cache.current_calls[f];x.resolve()}c.call(T)}else{T.logError("Empty results fetching KPi Value : "+q.uri)}};this.Fetch_Kpi_Value_Fail=function(h){if(sap.suite.smartbusiness.cache.current_calls[f]){sap.suite.smartbusiness.cache.current_calls[f].reject()}T.logError("Error Fetching Kpi Value : "+q.uri)};var g=sap.suite.smartbusiness.cache.getKpiDetailsById(f);if(g){this.Fetch_Kpi_Value_Success(g)}else if(sap.suite.smartbusiness.cache.current_calls[f]){jQuery.when(sap.suite.smartbusiness.cache.current_calls[f]).then(function(){var h=sap.suite.smartbusiness.cache.getKpiDetailsById(f);T.Fetch_Kpi_Value_Success(h)},function(h){T.logError(h)})}else{sap.suite.smartbusiness.cache.current_calls[f]=jQuery.Deferred();this.OData_Call_Ref_Fetch_Kpi_Value=q.model.read(q.uri,null,null,true,this.Fetch_Kpi_Value_Success,this.Fetch_Kpi_Value_Fail)}}else{c.call(this,null)}};sap.suite.ui.smartbusiness.tiles.Generic.prototype.getAllFilters=function(){var r=[].concat(this.evaluationApi.getFilters()["results"]);if(this.getAdditionalFilters())return r.concat(this.getAdditionalFilters());return r};sap.suite.ui.smartbusiness.tiles.Generic.prototype.getUrlFilters=function(){var p=sap.suite.smartbusiness.url.hash.getApplicationParameters(["viewId"]);var u=[];for(var k in p){var f=p[k];if(f&&f.length){f.forEach(function(F){var O={};O["NAME"]=k;O["OPERATOR"]="EQ";O["VALUE_1"]=F;O["VALUE_2"]="";O["TYPE"]="FI";u.push(O)})}}return u};sap.suite.ui.smartbusiness.tiles.Generic.prototype.onAfterRendering=function(){try{if(this.getMode()==sap.suite.ui.smartbusiness.tiles.Generic.Mode.RUNTIME){this.renderTile()}else{this.doDummyProcess()}}catch(e){jQuery.sap.log.error(e);this.setFailedState()}};sap.suite.ui.smartbusiness.tiles.Generic.prototype.numberOfLeadingZeros=function(n){n=String(n);var c=0;var d=n.indexOf('.');if(d==-1)return 0;if(Number(n.split('.')[0])!=0)return 0;var i=d+1;while(n[i++]=='0'){++c}return c};sap.suite.ui.smartbusiness.tiles.Generic.prototype.formatValue=function(v,s,M){M=M||4;var u={3:"K",6:"M",9:"B",12:"T",0:""};u["-3"]="m";u["-6"]="u";u["-9"]="n";u["-12"]="t";u["-2"]="%";var t,p,a;t=Number(v).toPrecision(M);var z=this.numberOfLeadingZeros(t);if(z>0&&s<0){p=t*Math.pow(10,z+M);a=-(z+M)}else{p=Number(t.split("e")[0]);a=Number(t.split("e")[1])||0}if(!v&&v!=0)return{value:"",unitPrefix:""};if(s>=0){if(a%3!=0){if(a%3==2){if(a+1==s){a=a+1;p=p/10}else{a=a-2;p=p*100}}else{if(a+2==s){a=a+2;p=p/100}else{a--;p=p*10}}}else if(a==15){p=p*1000;a=12}}else{if(s=="-2"){var x=this.formatValue((v*100),0)}else if(a>=0&&v<10&&s=="-3"){p=v*Math.pow(10,3);a=-3}else if(a>=0)return this.formatValue(v,0);else{a=Math.abs(a);s=Math.abs(s);if(s>a){p=p/(Math.pow(10,a%3));a=a-(a%3)}else{var d=a-s;p=p/(Math.pow(10,d));a=a-d}a=0-a}}p+="";if(s=="-2"){var b=(x.unitPrefix=="")?Number(x.value+"").toFixed(4-(x.value+"").indexOf('.')):Number(x.value+"").toFixed(3-(x.value+"").indexOf('.'));return{value:Number(b),unitPrefix:(x.unitPrefix)+u[-2]}}p=Number(p).toFixed(4-p.indexOf('.'));return{value:Number(p),unitPrefix:u[a]}};sap.suite.ui.smartbusiness.tiles.Generic.prototype.formatOdataObjectToString=function(v){if(v&&v.constructor==Object){if(v.__edmType=="Edm.Time"){var m=v.ms;var s=Math.floor((m/1000)%60);var a=Math.floor((m/60000)%60);var h=Math.floor((m/3600000)%24);return h+"H"+a+"M"+s+"S"}}return v};sap.suite.ui.smartbusiness.tiles.Generic.prototype.getScalingFactorMapping=function(){return this._oScalingFactor};sap.suite.ui.smartbusiness.tiles.Generic.prototype.isAssociatedKpi=function(){if(this.getAssociationEvaluationId()&&(this.getAssociationEvaluationId()!==this.getEvaluationId())){return true}return false};sap.suite.ui.smartbusiness.tiles.Generic.prototype.getTileControl=function(){return this.getAggregation("_tile")};sap.suite.ui.smartbusiness.tiles.Generic.prototype.setFailedState=function(){if(this.getTileControl().setState){this.getTileControl().setState(sap.suite.ui.commons.LoadState.Failed)}};sap.suite.ui.smartbusiness.tiles.Generic.prototype.setLoadingState=function(){if(this.getTileControl().setState){this.getTileControl().setState(sap.suite.ui.commons.LoadState.Loading)}};sap.suite.ui.smartbusiness.tiles.Generic.prototype.setDoneState=function(){if(this.getTileControl().setState){this.getTileControl().setState(sap.suite.ui.commons.LoadState.Loaded)}};sap.suite.ui.smartbusiness.tiles.Generic.prototype.logError=function(e){jQuery.sap.log.error(e);this.setFailedState()};sap.suite.ui.smartbusiness.tiles.Generic.prototype.abortODataCalls=function(){var _=function(r){if(r){r.abort()}};_(this.comparisionChartODataRef);_(this.OData_Call_Ref_Fetch_Kpi_Value);_(this.areaChartODataRef)};sap.suite.ui.smartbusiness.tiles.Generic.prototype.onExit=function(){this.abortODataCalls()};sap.suite.ui.smartbusiness.tiles.Generic.prototype.getDummyDataForNumericTile=function(){var d={subheader:"Expenses by Region",header:"Comparative Annual Totals",footerNum:"",footerComp:"",scale:"M",unit:"EUR",value:"10.34",size:"Auto",color:"Good",};return this._cleanUpDummyData(d)};sap.suite.ui.smartbusiness.tiles.Generic.prototype.getDummyDataForBulletTile=function(){var d={subheader:"Lorem Epsom",header:"Lorem Epsom",footerNum:"",footerComp:"Compare across regions",frameType:"OneByOne",scale:"M",actual:{value:120,color:sap.suite.ui.commons.InfoTileValueColor.Good},targetValue:100,thresholds:[{value:0,color:sap.suite.ui.commons.InfoTileValueColor.Error},{value:50,color:sap.suite.ui.commons.InfoTileValueColor.Critical},{value:150,color:sap.suite.ui.commons.InfoTileValueColor.Critical},{value:200,color:sap.suite.ui.commons.InfoTileValueColor.Error}],showActualValue:true,showTargetValue:true};return this._cleanUpDummyData(d)};sap.suite.ui.smartbusiness.tiles.Generic.prototype.getDummyDataForComparisonTile=function(){var d={subheader:"Expenses By Region",header:"Comparative Anual Totals",footerNum:"",footerComp:"Compare across regions",scale:"MM",unit:"EUR",value:8888,data:[{title:"Americas",value:10},{title:"EMEA",value:50},{title:"APAC",value:-20}],};return this._cleanUpDummyData(d)};sap.suite.ui.smartbusiness.tiles.Generic.prototype.getDummyDataForMeasureComparisonTile=function(){var d={subheader:"Lorem Epsom",header:"Lorem Epsom",footerNum:"",footerComp:"Compare across regions",scale:"M",unit:"EUR",value:8888,data:[{title:"Measure 1",value:50,color:"Good"},{title:"Measure 2",value:-20,color:"Error"},{title:"Measure 3",value:10,color:"Critical"}],};return this._cleanUpDummyData(d)};sap.suite.ui.smartbusiness.tiles.Generic.prototype.getDummyDataForAreaChartTile=function(){var d={subheader:"Expenses By Region",header:"Comparative Anual Totals",footerNum:"",footerComp:"Compare across regions",scale:"MM",unit:"EUR",value:8888,size:"S",frameType:"OneByOne",state:sap.suite.ui.commons.LoadState.Loaded,title:"US Profit Margin",footer:"Current Quarter",description:"Maximum deviation",width:"100%",height:"100%",chart:{color:"Good",data:[{day:0,balance:0},{day:30,balance:20},{day:60,balance:20},{day:100,balance:80}]},target:{color:"Error",data:[{day:0,balance:0},{day:30,balance:30},{day:60,balance:40},{day:100,balance:90}]},maxThreshold:{color:"Good",data:[{day:0,balance:0},{day:30,balance:40},{day:60,balance:50},{day:100,balance:100}]},innerMaxThreshold:{color:"Error",data:[]},innerMinThreshold:{color:"Neutral",data:[]},minThreshold:{color:"Error",data:[{day:0,balance:0},{day:30,balance:20},{day:60,balance:30},{day:100,balance:70},]},minXValue:0,maxXValue:100,minYValue:0,maxYValue:100,firstXLabel:{label:"June 123",color:"Error"},lastXLabel:{label:"June 30",color:"Error"},firstYLabel:{label:"0M",color:"Good"},lastYLabel:{label:"80M",color:"Critical"},minLabel:{},maxLabel:{}};return this._cleanUpDummyData(d)};sap.suite.ui.smartbusiness.tiles.Generic.prototype._cleanUpDummyData=function(d){d.header=this.getHeader()||"Lorem Epsom";d.subheader=this.getSubheader()||"Lorem Epsom";return d};sap.suite.ui.smartbusiness.tiles.GenericRenderer={};sap.suite.ui.smartbusiness.tiles.GenericRenderer.render=function(r,c){r.write("<div");r.writeControlData(c);r.addClass("drilldownKpiTile");r.writeClasses();r.write(">");r.renderControl(c.getTileControl());r.write("</div>")};sap.suite.ui.smartbusiness.tiles.Generic.prototype._closePopover=function(){if(this._popOver.isOpen()){this._popOver.close()}};sap.suite.ui.smartbusiness.tiles.Generic.prototype._initThresholdPopOver=function(){var m=new sap.ui.model.json.JSONModel(a);var a={"THRESHOLDS":[]};var t=new sap.m.List({});t.bindItems("/THRESHOLDS",new sap.m.DisplayListItem({label:"{name}",value:"{value}"}));t.setModel(m);var b={};b.targetVal=this.TARGET_VALUE;b.critLowVal=this.CRITICAL_LOW_VALUE;b.warnLowVal=this.WARNING_LOW_VALUE;b.critHighVal=this.CRITICAL_HIGH_VALUE;b.warnHighVal=this.WARNING_HIGH_VALUE;if(this.evaluationApi.getScaling()==-2){for(var e in b){if(b[e]){b[e]=(b[e]*100)+" %"}}}if(this.evaluationApi.isMaximizingKpi()){a.THRESHOLDS.push({name:this.getModel("i18n").getProperty("TARGET_LABEL"),value:b.targetVal});a.THRESHOLDS.push({name:this.getModel("i18n").getProperty("WARNING_LOW_LABEL"),value:b.warnLowVal});a.THRESHOLDS.push({name:this.getModel("i18n").getProperty("CRITICAL_LOW_LABEL"),value:b.critLowVal})}else if(this.evaluationApi.isMinimizingKpi()){a.THRESHOLDS.push({name:this.getModel("i18n").getProperty("CRITICAL_HIGH_LABEL"),value:b.critHighVal});a.THRESHOLDS.push({name:this.getModel("i18n").getProperty("WARNING_HIGH_LABEL"),value:b.warnHighVal});a.THRESHOLDS.push({name:this.getModel("i18n").getProperty("TARGET_LABEL"),value:b.targetVal})}else if(this.evaluationApi.isTargetKpi()){a.THRESHOLDS.push({name:this.getModel("i18n").getProperty("CRITICAL_HIGH_LABEL"),value:b.critHighVal});a.THRESHOLDS.push({name:this.getModel("i18n").getProperty("WARNING_HIGH_LABEL"),value:b.warnHighVal});a.THRESHOLDS.push({name:this.getModel("i18n").getProperty("TARGET_LABEL"),value:b.targetVal});a.THRESHOLDS.push({name:this.getModel("i18n").getProperty("WARNING_LOW_LABEL"),value:b.warnLowVal});a.THRESHOLDS.push({name:this.getModel("i18n").getProperty("CRITICAL_LOW_LABEL"),value:b.critLowVal})}m.setData(a);var c=new sap.m.Bar({contentMiddle:[new sap.m.Label({text:this.getModel("i18n").getProperty("THRESHOLD_LABEL")})],contentRight:(jQuery.device.is.phone)?[]:[new sap.m.Button({icon:"sap-icon://decline",width:"2.375rem",press:jQuery.proxy(this._closePopover,this)})]});this._popOver=new sap.m.ResponsivePopover({modal:false,enableScrolling:true,verticalScrolling:true,horizontalScrolling:false,placement:sap.m.PlacementType.Auto,contentWidth:"18rem",customHeader:c,content:[t]});var s=sap.ui.getCore().getUIArea(sap.ui.getCore().getStaticAreaRef());s.addContent(this._popOver,true)};sap.suite.ui.smartbusiness.tiles.Generic.prototype.showThresholds=function(){this._popOver.openBy(this)};sap.suite.ui.smartbusiness.tiles.Generic.prototype.tilePressed=function(){if(!this.isAssociatedKpi()&&this.getMode()==sap.suite.ui.smartbusiness.tiles.Generic.Mode.RUNTIME){if(this.getTileType()=="NT"||this.getTileType()=="AT"){this.showThresholds()}}else if(this.isAssociatedKpi()&&this.getMode()==sap.suite.ui.smartbusiness.tiles.Generic.Mode.RUNTIME){var s=sap.suite.smartbusiness.url.hash.getStartupParameters();var a=sap.suite.smartbusiness.url.hash.getApplicationParameters(["viewId"]);s["evaluationId"]=[];var b=this.getAssociationEvaluationId();s.evaluationId.push(b);sap.suite.smartbusiness.url.hash.setApplicationParameters(a,false);sap.suite.smartbusiness.url.hash.setStartupParameters(s,false);var c=sap.suite.smartbusiness.drilldown.getConfigurationFromCache(b);try{if(c){configurationApi=sap.suite.smartbusiness.drilldown.parse(b,c);if(configurationApi){var d=configurationApi.getDefaultView();if(d){var v=d.getId();if(v){sap.suite.smartbusiness.url.hash.updateApplicationParameters({"viewId":[v]},false)}}}}}catch(e){}sap.suite.smartbusiness.url.hash.updateHash()}};sap.suite.ui.smartbusiness.tiles.Generic.prototype.hasSomeValue=function(){var f=true;if(arguments.length){for(var i=0,l=arguments.length;i<l;i++){if(arguments[i]||arguments[i]=="0"){}else{f=false;break}}}else{f=false}return f}};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.tiles.MeasureComparison')){jQuery.sap.declare("sap.suite.ui.smartbusiness.tiles.MeasureComparison");sap.suite.ui.smartbusiness.tiles.Generic.extend("sap.suite.ui.smartbusiness.tiles.MeasureComparison",{metadata:{properties:{kpiValueRequired:{type:"boolean",defaultValue:false},tileType:{type:"string",defaultValue:"CM"}}},renderer:{}});sap.suite.ui.smartbusiness.tiles.MeasureComparison.prototype.init=function(){sap.suite.ui.smartbusiness.tiles.Generic.prototype.init.apply(this);this._bShowUOM=false;this._bUseFormattedVDMValue=false;this._bShowKpiMeasureUOMInFooter=false;this._bHasKpiMeasure=null;this.setAggregation("_tile",new sap.suite.ui.commons.GenericTile({header:"{/header}",subheader:"{/subheader}",size:this.getSize(),frameType:this.getFrameType(),tileContent:new sap.suite.ui.commons.TileContent({unit:"{/unit}",size:this.getSize(),footer:"{/footerNum}",content:new sap.suite.ui.commons.ComparisonChart({scale:"{/scale}",size:this.getSize(),state:"{/state}",data:{template:new sap.suite.ui.commons.ComparisonData({title:"{title}",value:"{value}",color:"{color}",displayValue:"{displayValue}"}),path:"/data"}})}),press:jQuery.proxy(this.tilePressed,this)}));this.jsonModel=new sap.ui.model.json.JSONModel();this.setModel(this.jsonModel)};sap.suite.ui.smartbusiness.tiles.MeasureComparison.prototype.onBeforeRendering=function(){sap.suite.ui.smartbusiness.tiles.Generic.prototype.onBeforeRendering.apply(this);if(this.getContentOnly()){this.setAggregation("_tile",new sap.suite.ui.commons.ComparisonChart({scale:"{/scale}",size:this.getSize(),state:"{/state}",data:{template:new sap.suite.ui.commons.ComparisonData({title:"{title}",value:"{value}",color:"{color}",displayValue:"{displayValue}"}),path:"/data"}}))}};sap.suite.ui.smartbusiness.tiles.MeasureComparison.prototype.doProcess=function(){var t=this;this._fetchDataForMeasureComparisonTile(function(c){var j={};this._processedComparisionData=this._processMeasureComparisionData(c);j.data=this._processedComparisionData;if(true||t.isAssociatedKpi()){j.subheader=this.evaluationApi.getTitle();j.header=this.evaluationApi.getKpiName()}if(this._bShowKpiMeasureUOMInFooter&&this._bHasKpiMeasure){var k=this.UOM_PROPERTY_MAPPING[this.evaluationApi.getKpiMeasureName()];if(k){j.unit=c[k]}}t.jsonModel.setData(j);t.setDoneState()},this.logError)};sap.suite.ui.smartbusiness.tiles.MeasureComparison.prototype._fetchDataForMeasureComparisonTile=function(s,e){var t=this;var _=function(a){var m=[];if(a&&a.MEASURES&&a.MEASURES.length){var c=a.MEASURES;for(var i=0,l=c.length;i<l;i++){m.push(c[i].name)}}if(m.length){return m}else{throw new Error("No Measures Defined for Measure Comparision Tile")}};var p={};p.serviceUri=this._addSystemAliasToUri(this.evaluationApi.getODataUrl(),this.getSapSystem());p.entitySet=this.evaluationApi.getEntitySet();p.measure=_(this.getTileConfiguration());if(p.measure.indexOf(this.evaluationApi.getKpiMeasureName())>-1){this._bHasKpiMeasure=true}p.filter=this.getAllFilters();var f=sap.suite.smartbusiness.odata.getUri(p);this.comparisionChartODataRef=f.model.read(f.uri,null,null,true,function(d){if(d&&d.results&&d.results.length){s.call(t,d.results[0])}else{e.call(t,"no Response from QueryServiceUri")}},function(a){if(a&&a.response){jQuery.sap.log.error(a.message+" : "+a.request.requestUri)}})};sap.suite.ui.smartbusiness.tiles.MeasureComparison.prototype._processMeasureComparisionData=function(r){var p=[],f,V,U,m,a,i,b,o;b=this.getTileConfiguration().MEASURES;for(i=0,l=b.length;i<l;i++){o={};a=b[i].name;m=this.LABEL_PROPERTY_MAPPING[a];o["title"]=m;U=this.UOM_PROPERTY_MAPPING[a];V=this.TEXT_PROPERTY_MAPPING[a];if(this._bUseFormattedVDMValue&&V&&(V!=a)){f=r[V]}else{f=sap.suite.smartbusiness.utils.getLocaleFormattedValue(Number(r[a]))}o.value=Number(r[a]);o.displayValue=""+f;if(this._bShowUOM&&U){o.displayValue+=" "+r[U]}o.color=b[i].color;p.push(o)}return p};sap.suite.ui.smartbusiness.tiles.MeasureComparison.prototype.doDummyProcess=function(){this.jsonModel.setData(this.getDummyDataForMeasureComparisonTile())}};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.tiles.Numeric')){jQuery.sap.declare("sap.suite.ui.smartbusiness.tiles.Numeric");sap.suite.ui.smartbusiness.tiles.Generic.extend("sap.suite.ui.smartbusiness.tiles.Numeric",{metadata:{properties:{kpiValueRequired:{type:"boolean",defaultValue:true},tileType:{type:"string",defaultValue:"NT"}}},renderer:{}});sap.suite.ui.smartbusiness.tiles.Numeric.prototype.init=function(){sap.suite.ui.smartbusiness.tiles.Generic.prototype.init.apply(this);this.setAggregation("_tile",new sap.suite.ui.commons.GenericTile({header:"{/header}",subheader:"{/subheader}",size:this.getSize(),frameType:this.getFrameType(),tileContent:new sap.suite.ui.commons.TileContent({unit:"{/unit}",size:this.getSize(),footer:"{/footerNum}",content:new sap.suite.ui.commons.NumericContent({value:"{/value}",scale:"{/scale}",unit:"{/unit}",indicator:"{/indicator}",valueColor:"{/valueColor}",size:this.getSize(),state:"{/state}",formatterValue:"{/formatterValue}",truncateValueTo:6,nullifyValue:false})}),press:jQuery.proxy(this.tilePressed,this)}));this.jsonModel=new sap.ui.model.json.JSONModel();this.setModel(this.jsonModel)};sap.suite.ui.smartbusiness.tiles.Numeric.prototype.onBeforeRendering=function(){sap.suite.ui.smartbusiness.tiles.Generic.prototype.onBeforeRendering.apply(this);if(this.getContentOnly()){this.setAggregation("_tile",new sap.suite.ui.commons.NumericContent({value:"{/value}",scale:"{/scale}",unit:"{/unit}",indicator:"{/indicator}",valueColor:"{/valueColor}",size:this.getSize(),state:"{/state}",formatterValue:true,truncateValueTo:6,}))}};sap.suite.ui.smartbusiness.tiles.Numeric.prototype.doProcess=function(){var n={};n.valueColor=this._applyTrendColor();n.indicator=this._applyTrendIndicator();n.frameType=this.getFrameType();n.unit=this.UOM;var s="";var c=this.KPI_VALUE;if(this.EVALUATION_DATA.SCALING==-2){c*=100;n.formatterValue=false}var f=sap.suite.smartbusiness.utils.getLocaleFormattedValue(c,this.EVALUATION_DATA.SCALING);if(this.EVALUATION_DATA.SCALING==-2)n.scale="%";n.value=f.toString();if(true||this.isAssociatedKpi()){n.header=this.EVALUATION_DATA.INDICATOR_TITLE;n.subheader=this.EVALUATION_DATA.TITLE}this.jsonModel.setData(n);this.jsonModel.updateBindings();this.setDoneState()};sap.suite.ui.smartbusiness.tiles.Numeric.prototype.doDummyProcess=function(){this.jsonModel.setData(this.getDummyDataForNumericTile())};sap.suite.ui.smartbusiness.tiles.Numeric.prototype._applyTrendColor=function(){var r=null;var w=window.parseFloat(this.WARNING_LOW_VALUE);var c=window.parseFloat(this.CRITICAL_LOW_VALUE);var a=window.parseFloat(this.CRITICAL_HIGH_VALUE);var b=window.parseFloat(this.WARNING_HIGH_VALUE);var i=this.EVALUATION_DATA.GOAL_TYPE;if(this.evaluationApi.isMinimizingKpi()){if(this.hasSomeValue(a,b)){if(this.KPI_VALUE<b){r=sap.suite.ui.commons.InfoTileValueColor.Good}else if(this.KPI_VALUE<=a){r=sap.suite.ui.commons.InfoTileValueColor.Critical}else{r=sap.suite.ui.commons.InfoTileValueColor.Error}}}else if(this.evaluationApi.isMaximizingKpi()){if(this.hasSomeValue(c,w)){if(this.KPI_VALUE<c){r=sap.suite.ui.commons.InfoTileValueColor.Error}else if(this.KPI_VALUE<=w){r=sap.suite.ui.commons.InfoTileValueColor.Critical}else{r=sap.suite.ui.commons.InfoTileValueColor.Good}}}else{if(this.hasSomeValue(w,b,c,a)){if(this.KPI_VALUE<c||this.KPI_VALUE>a){r=sap.suite.ui.commons.InfoTileValueColor.Error}else if((this.KPI_VALUE>=c&&this.KPI_VALUE<=w)||(this.KPI_VALUE>=b&&this.KPI_VALUE<=a)){r=sap.suite.ui.commons.InfoTileValueColor.Critical}else{r=sap.suite.ui.commons.InfoTileValueColor.Good}}}return r};sap.suite.ui.smartbusiness.tiles.Numeric.prototype._applyTrendIndicator=function(){var t=sap.suite.ui.commons.DeviationIndicator.None;if(this.TREND_VALUE||this.TREND_VALUE=="0"){if(this.TREND_VALUE>this.KPI_VALUE){t=sap.suite.ui.commons.DeviationIndicator.Down}else if(this.TREND_VALUE<this.KPI_VALUE){t=sap.suite.ui.commons.DeviationIndicator.Up}}return t}};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.drilldown.view.configureNewView.controller')){jQuery.sap.declare('sap.suite.ui.smartbusiness.designtime.drilldown.view.configureNewView.controller');jQuery.sap.require('sap.ca.scfld.md.controller.ScfldMasterController');jQuery.sap.require('sap.m.MessageBox');jQuery.sap.require('sap.m.MessageToast');sap.ca.scfld.md.controller.ScfldMasterController.extend("sap.suite.ui.smartbusiness.designtime.drilldown.view.configureNewView",{onInit:function(){this.DDA_MODEL=null;this.evaluationId=null;this.measureDimensionList=this.byId(sap.ui.core.Fragment.createId('measureDimensionsList','measureDimensionsList'));this._oDimensionList=sap.ui.xmlfragment("sap.suite.ui.smartbusiness.designtime.drilldown.view.list",this);this._oMeasureList=sap.ui.xmlfragment("sap.suite.ui.smartbusiness.designtime.drilldown.view.list",this);try{if(sap.ui.core.Fragment.byId("measureDimensionDialog","measureDimensionDialog")){sap.ui.core.Fragment.byId("measureDimensionDialog","measureDimensionDialog").destroy()}if(sap.ui.core.Fragment.byId("thresholdDialog","dialogRef")){sap.ui.core.Fragment.byId("thresholdDialog","dialogRef").destroy()}if(sap.ui.core.Fragment.byId("editDialog","editDialog")){sap.ui.core.Fragment.byId("editDialog","editDialog").destroy()}if(sap.ui.core.Fragment.byId("dualAxisConfig","dualAxisConfig")){sap.ui.core.Fragment.byId("dualAxisConfig","dualAxisConfig").destroy()}if(sap.ui.core.Fragment.byId("msrDialogForStack1","stack1SelectDialog")){sap.ui.core.Fragment.byId("msrDialogForStack1","stack1SelectDialog").destroy()}if(sap.ui.core.Fragment.byId("additionalLanguageDialog","additionalLanguageDialog")){sap.ui.core.Fragment.byId("additionalLanguageDialog","additionalLanguageDialog").destroy()}if(sap.ui.core.Fragment.byId("chartTypeConfig","chartTypeConfig")){sap.ui.core.Fragment.byId("chartTypeConfig","chartTypeConfig").getParent().destroy()}}catch(e){};this._oShowMeasureDialog=sap.ui.xmlfragment("measureDimensionDialog","sap.suite.ui.smartbusiness.designtime.drilldown.view.measureDimensionDialog",this);this._oShowMeasureDialog.addStyleClass("dialog");this.addThresholdMeasureDialog=sap.ui.xmlfragment("thresholdDialog","sap.suite.ui.smartbusiness.designtime.drilldown.view.addThresholdMeasure",this);this._editMeasureDialog=sap.ui.xmlfragment("editDialog","sap.suite.ui.smartbusiness.designtime.drilldown.view.editDialog",this);this._dualAxisConfig=sap.ui.xmlfragment("dualAxisConfig","sap.suite.ui.smartbusiness.designtime.drilldown.view.dualAxisConfig",this);this._msrDialogForStack1=sap.ui.xmlfragment("msrDialogForStack1","sap.suite.ui.smartbusiness.designtime.drilldown.view.msrDialogForStack1",this);this.AdditionalLanguagesDialog=new sap.ui.xmlfragment("additionalLanguageDialog","sap.suite.ui.smartbusiness.designtime.drilldown.view.additionalLanguagesDialog",this);this._chartTypeConfig=sap.ui.xmlfragment("chartTypeConfig","sap.suite.ui.smartbusiness.designtime.drilldown.view.chartTypeConfig",this);this.oRouter.attachRoutePatternMatched(this.onRoutePatternMatched,this);this.busyIndicator=new sap.m.BusyDialog()},onRoutePatternMatched:function(E){if(E.getParameter("name")==="configureChart"){try{this.evaluationId=E.getParameter("arguments")["evaluationId"];this.currentViewId=E.getParameter("arguments")["viewId"];this.DDA_MODEL=sap.suite.smartbusiness.ddaconfig.Model.getInstance(this.evaluationId,false,this.getView().getModel("i18n"));if(this.currentViewId!=="~NA~"){this.DDA_MODEL.setViewId(this.currentViewId)}this.bindUiToModel();this.EVALUATION=sap.suite.smartbusiness.kpi.parseEvaluation(this.DDA_MODEL.EVALUATION_DATA);this._oModel=this.getView().getModel("SB_DDACONFIG");this.mProperties=sap.suite.smartbusiness.odata.properties(this._oModel.getData().QUERY_SERVICE_URI,this._oModel.getData().QUERY_ENTITY_SET);this.COLUMN_LABEL_MAPPING=this.mProperties.getLabelMappingObject();this._oTextsModel=this.getView().getModel("i18n");this._editMeasureDialog.setModel(this._oTextsModel,"i18n");this._dualAxisConfig.setModel(this._oTextsModel,"i18n");this._msrDialogForStack1.setModel(this._oTextsModel,"i18n");this._oShowMeasureDialog.setModel(this._oTextsModel,"i18n");this.addThresholdMeasureDialog.setModel(this._oTextsModel,"i18n");this.prepareInitialModelData(this._oModel);this.takeConfigMasterSnapShot();this._updateMeasureDimensionBindings();this.refreshChart();this.chartTypeInit()}catch(e){sap.suite.smartbusiness.utils.showErrorMessage(this.oApplicationFacade.getResourceBundle().getText("FAILED_TO_LOAD_ODATA"),e.message)}}},displayLabelsFormatter:function(s){return this.COLUMN_LABEL_MAPPING[s]},bindUiToModel:function(){this.DDA_MODEL.bindModel(this.getView(),"SB_DDACONFIG");this.DDA_MODEL.bindModel(this._editMeasureDialog,"SB_DDACONFIG");this.DDA_MODEL.bindModel(this._editMeasureDialog);this.DDA_MODEL.bindModel(this._oShowMeasureDialog,"SB_DDACONFIG");this.DDA_MODEL.bindModel(this._oShowMeasureDialog);this.DDA_MODEL.bindModel(this.addThresholdMeasureDialog,"SB_DDACONFIG");this.DDA_MODEL.bindModel(this.AdditionalLanguagesDialog,"SB_DDACONFIG")},_cloneObj:function(e){var t;if(e instanceof Array){t=[];for(var i=0;i<e.length;i++){t[i]=this._cloneObj(e[i])}}else if(e instanceof Object){t={};for(var a in e){if(e.hasOwnProperty(a)){t[a]=this._cloneObj(e[a])}}}else{t=e}return t},takeConfigMasterSnapShot:function(){this._masterConfig=this._cloneObj(this._oModel.getData())},restoreFromConfigMasterSnapShot:function(){this._oModel.setData(this._masterConfig)},copyConfigSnapshot:function(){this._config=this._cloneObj(this._oModel.getData());this.enableOrDisableSave()},restorePrevConfig:function(){this._oModel.setData(this._config)},prepareInitialModelData:function(m){var t=m.getData();var d=t.ALL_DIMENSIONS;var a=t.ALL_MEASURES;var b=[],c={};var e=t.COLUMNS;for(var i=0;i<e.length;i++){e[i].SELECTED=true;e[i].LABEL=this.COLUMN_LABEL_MAPPING[e[i].NAME];b.push(e[i]);c[e[i].NAME]=true}for(var i=0;i<d.length;i++){if(c[d[i]])continue;b.push({AXIS:1,NAME:d[i],SORT_BY:d[i],SORT_ORDER:"none",STACKING:0,TYPE:"DIMENSION",VISIBILITY:"BOTH",SELECTED:false,LABEL:this.COLUMN_LABEL_MAPPING[d[i]]})}for(var i=0;i<a.length;i++){if(c[a[i]])continue;b.push({0:Object,AXIS:2,COLOR1:"",COLOR2:"",NAME:a[i],SORT_BY:a[i],SORT_ORDER:"none",STACKING:0,TYPE:"MEASURE",VISIBILITY:"BOTH",SELECTED:false,LABEL:this.COLUMN_LABEL_MAPPING[a[i]]})}t.items=b;m.setData(t)},_updateMeasureDimensionBindings:function(){var f=new sap.ui.model.Filter("SELECTED",sap.ui.model.FilterOperator.EQ,true);var b=this.measureDimensionList.getBinding("items");b.filter(f)},onChartTypeChange:function(e){if(!this._chartTypeConfig){this._chartTypeConfig=sap.ui.xmlfragment("chartTypeConfig","sap.suite.ui.smartbusiness.designtime.drilldown.view.chartTypeConfig",this)}this.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","chartTypeConfig"));var c=this.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","chartType"));this.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","singleDual")).setVisible((c.getSelectedKey().toUpperCase()!="BUBBLE"&&c.getSelectedKey().toUpperCase()!="TABLE"&&c.getSelectedKey().toUpperCase().toUpperCase()!="LINE"&&c.getSelectedKey().toUpperCase()!="COMBINATION")?true:false);this.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","isAbsolute")).setVisible((c.getSelectedKey().toUpperCase()!="BUBBLE"&&c.getSelectedKey().toUpperCase()!="TABLE"&&c.getSelectedKey().toUpperCase().toUpperCase()!="LINE"&&c.getSelectedKey().toUpperCase()!="COMBINATION")?true:false);this.updateSemanticColorComboBox(c.getSelectedKey());this.refreshChart();this.enableOrDisableSave()},chartTypeInit:function(e){if(!this._chartTypeConfig){this._chartTypeConfig=sap.ui.xmlfragment("chartTypeConfig","sap.suite.ui.smartbusiness.designtime.drilldown.view.chartTypeConfig",this)}this.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","chartTypeConfig"));var c=this.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","chartType"));if(c.getSelectedKey().toUpperCase()!="BUBBLE")this.copyConfigSnapshot();this.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","singleDual")).setVisible((c.getSelectedKey().toUpperCase()!="BUBBLE"&&c.getSelectedKey().toUpperCase()!="TABLE"&&c.getSelectedKey().toUpperCase().toUpperCase()!="LINE"&&c.getSelectedKey().toUpperCase()!="COMBINATION")?true:false);this.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","isAbsolute")).setVisible((c.getSelectedKey().toUpperCase()!="BUBBLE"&&c.getSelectedKey().toUpperCase()!="TABLE"&&c.getSelectedKey().toUpperCase().toUpperCase()!="LINE"&&c.getSelectedKey().toUpperCase()!="COMBINATION")?true:false);this.setSemanticColorComboBox(c.getSelectedKey());this.refreshChart();this.enableOrDisableSave()},updateSemanticColorComboBox:function(c){if(!this._chartTypeConfig){this._chartTypeConfig=sap.ui.xmlfragment("chartTypeConfig","sap.suite.ui.smartbusiness.designtime.drilldown.view.chartTypeConfig",this)}c=c.toUpperCase();var s=this.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","semanticColors"));if(c=="BAR"||c=="COLUMN"){s.setVisible(true);s.setEnabled(true);s.getItemByKey("AUTO_SEMANTIC").setEnabled(true);s.getItemByKey("MANUAL_NON_SEMANTIC").setEnabled(true);s.getItemByKey("MANUAL_SEMANTIC").setEnabled(true);if(this.isStackDim){s.setSelectedKey("NONE");s.getItemByKey("AUTO_SEMANTIC").setEnabled(false);s.getItemByKey("MANUAL_NON_SEMANTIC").setEnabled(false);s.getItemByKey("MANUAL_SEMANTIC").setEnabled(false)}}else if(c=="BUBBLE"){s.setSelectedKey("NONE");s.setVisible(false)}else if(c=="TABLE"){s.setVisible(true);s.setEnabled(true);if(!(s.getSelectedKey().toUpperCase()=="NONE"||s.getSelectedKey().toUpperCase()=="AUTO_SEMANTIC"))s.setSelectedKey("NONE");s.getItemByKey("AUTO_SEMANTIC").setEnabled(true);s.getItemByKey("MANUAL_NON_SEMANTIC").setEnabled(false);s.getItemByKey("MANUAL_SEMANTIC").setEnabled(false)}else if(c=="LINE"||c=="COMBINATION"){s.setSelectedKey("MANUAL_NON_SEMANTIC");s.setVisible(true);s.setEnabled(true);s.getItemByKey("MANUAL_NON_SEMANTIC").setEnabled(true);s.getItemByKey("AUTO_SEMANTIC").setEnabled(false);s.getItemByKey("MANUAL_SEMANTIC").setEnabled(true)}},setSemanticColorComboBox:function(c){c=c.toUpperCase();var s=this.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","semanticColors"));if(c=="BAR"||c=="COLUMN"){s.setVisible(true);s.setEnabled(true);s.getItemByKey("AUTO_SEMANTIC").setEnabled(true);s.getItemByKey("MANUAL_NON_SEMANTIC").setEnabled(true);s.getItemByKey("MANUAL_SEMANTIC").setEnabled(true);if(this.isStackDim){s.getItemByKey("AUTO_SEMANTIC").setEnabled(false);s.getItemByKey("MANUAL_NON_SEMANTIC").setEnabled(false);s.getItemByKey("MANUAL_SEMANTIC").setEnabled(false)}}else if(c=="BUBBLE"){s.setVisible(false)}else if(c=="TABLE"){s.setVisible(true);s.setEnabled(true);s.getItemByKey("AUTO_SEMANTIC").setEnabled(true);s.getItemByKey("MANUAL_NON_SEMANTIC").setEnabled(false);s.getItemByKey("MANUAL_SEMANTIC").setEnabled(false)}else if(c=="LINE"||c=="COMBINATION"){s.setVisible(true);s.setEnabled(true);s.getItemByKey("MANUAL_NON_SEMANTIC").setEnabled(true);s.getItemByKey("AUTO_SEMANTIC").setEnabled(false);s.getItemByKey("MANUAL_SEMANTIC").setEnabled(true)}},formatcolor:function(s){return s?sap.ui.core.theming.Parameters.get(s):"transparent"},formatEditColor:function(s){return s?sap.ui.core.theming.Parameters.get(s):"black"},sortByMeasureVisibility:function(s){return s?(s.toUpperCase()=="MEASURE"||s.toUpperCase()=="KPI MEASURE"):false},sortByDimensionVisibility:function(s){return s?s.toUpperCase()=="DIMENSION":false},openAllMeasuresDimension:function(){this.copyConfigSnapshot();this._oShowMeasureDialog.open();var b=this._oShowMeasureDialog.getContent()[0];if(b.getSelectedButton()==b.getButtons()[1].getId()){this.showDimensionList()}else{this.showMeasureList()}},_isAddDimensionMode:function(){var b=this._oShowMeasureDialog.getContent()[0];return b.getSelectedButton()==b.getButtons()[1].getId()},onMeasureDimensionSearch:function(e){var m=this._isAddDimensionMode()?"DIMENSION":"MEASURE";var c=this._isAddDimensionMode()?this._oDimensionList:this._oMeasureList;var f=[new sap.ui.model.Filter("TYPE",sap.ui.model.FilterOperator.Contains,m)];var k=e.getSource().getValue();if(k&&k.length>0){f.push(new sap.ui.model.Filter("LABEL",sap.ui.model.FilterOperator.StartsWith,k))}var b=c.getBinding("items");b.filter(f)},onMeasureDimensionAdded:function(){this._updateMeasureDimensionBindings();this._oShowMeasureDialog.close();this.refreshChart();this.enableOrDisableSave()},onMeasureDimensionCancel:function(){this.restorePrevConfig();this._updateMeasureDimensionBindings();this._oShowMeasureDialog.close()},showDimensionList:function(){this._oShowMeasureDialog.removeContent(this._oMeasureList);this._oShowMeasureDialog.addContent(this._oDimensionList);this._oDimensionList.getBinding("items").filter(new sap.ui.model.Filter("TYPE",sap.ui.model.FilterOperator.EQ,"DIMENSION"))},showMeasureList:function(){this._oShowMeasureDialog.removeContent(this._oDimensionList);this._oShowMeasureDialog.addContent(this._oMeasureList);this._oMeasureList.getBinding("items").filter(new sap.ui.model.Filter("TYPE",sap.ui.model.FilterOperator.EQ,"MEASURE"))},formatSortOrder:function(s){if(s=="asc"){return"sap-icon://up"}else if(s=="desc"){return"sap-icon://down"}else{return""}},colorButtonVisiblity:function(s,c){if(s)return(c=="MANUAL_SEMANTIC"||c=="MANUAL_NON_SEMANTIC")&&s.toLowerCase()=='measure'},colorButton1Visiblity:function(s){return s=="MANUAL_NON_SEMANTIC"},colorButton2Visiblity:function(s){return s=="MANUAL_SEMANTIC"},onEditIconPress:function(e){var t=this;this.copyConfigSnapshot();var b=e.getSource().getBindingContext("SB_DDACONFIG");this.columnBeingEdited=b.getObject();this._editMeasureDialog.bindElement(b.getPath());if(b.getObject().TYPE.toLowerCase()=="kpi measure"){sap.ui.core.Fragment.byId("editDialog","typeOf").setText(this.getView().getModel("i18n").getProperty("KPI_MEASURE"))}if(b.getObject().VISIBILITY.toUpperCase()==="CHART")sap.ui.core.Fragment.byId("editDialog","hideInTable").setSelected(true);else sap.ui.core.Fragment.byId("editDialog","hideInTable").setSelected(false);if((((this.dda_config.chartConfig.type).toUpperCase()==="BAR")||((this.dda_config.chartConfig.type).toUpperCase()==="COLUMN"))&&((this.dda_config.chartConfig.axis).toUpperCase()==="DUAL")){sap.ui.core.Fragment.byId("editDialog","Dual_config_1").setVisible(true);sap.ui.core.Fragment.byId("editDialog","Dual_config_2").setVisible(true);var D=new sap.ui.model.json.JSONModel();D.setData({DATA:t.chartMeasures});sap.ui.core.Fragment.byId("editDialog","Dual_config_1").setModel(D,"DUAL_MODEL");sap.ui.core.Fragment.byId("editDialog","axis_1_label_edit").setText(t._oTextsModel.getResourceBundle().getText("AXIS",1));sap.ui.core.Fragment.byId("editDialog","axis_2_label_edit").setText(t._oTextsModel.getResourceBundle().getText("AXIS",2));sap.ui.core.Fragment.byId("editDialog","In_stack1_label_edit").setText(t._oTextsModel.getResourceBundle().getText("IN_STACK",1));var d=this.getMeasuresByAxis(this.chartMeasures);sap.ui.core.Fragment.byId("editDialog","stack1MsrsLabel_edit").setText(d.axis1.nameArr.join(","));sap.ui.core.Fragment.byId("editDialog","stack2MsrsLabel_edit").setText(d.axis2.nameArr.join(","));if(d.axis1.nameArr.length){sap.ui.core.Fragment.byId("editDialog","AxisMsr1_edit").setSelectedKey(d.axis1.nameArr[0])};if(d.axis2.nameArr.length){sap.ui.core.Fragment.byId("editDialog","AxisMsr2_edit").setSelectedKey(d.axis2.nameArr[0])}}else{sap.ui.core.Fragment.byId("editDialog","Dual_config_1").setVisible(false);sap.ui.core.Fragment.byId("editDialog","Dual_config_2").setVisible(false)}var S=t.getStacking(t.chartMeasures,t.chartDimensions);sap.ui.core.Fragment.byId("editDialog","enableStacking").setEnabled(true);if(S.isEnabled){sap.ui.core.Fragment.byId("editDialog","enableStacking").setSelected(true);sap.ui.core.Fragment.byId("editDialog","stackingOptions").setVisible(true);if(S.type==="M"){sap.ui.core.Fragment.byId("editDialog","addMsrToStack").setSelected(true);sap.ui.core.Fragment.byId("editDialog","dimsToStack").setVisible(false)}else if(S.type==="D"){sap.ui.core.Fragment.byId("editDialog","addMsrToStack").setSelected(false);sap.ui.core.Fragment.byId("editDialog","dimStack").setSelected(true);sap.ui.core.Fragment.byId("editDialog","dimsToStack").setVisible(true);var j=new sap.ui.model.json.JSONModel();j.setData({STdata:t.chartDimensions});sap.ui.core.Fragment.byId("editDialog","dimsToStack").setModel(j);var o=new sap.ui.core.Item({key:"{name}",text:"{name}",});sap.ui.core.Fragment.byId("editDialog","dimsToStack").bindItems("/STdata",o);if(t.getDimensionToBeStacked(t.chartDimensions)){sap.ui.core.Fragment.byId("editDialog","dimsToStack").setSelectedKey(t.getDimensionToBeStacked(t.chartDimensions).name)}}}else{sap.ui.core.Fragment.byId("editDialog","enableStacking").setSelected(false);sap.ui.core.Fragment.byId("editDialog","stackingOptions").setVisible(false)}if((((this.dda_config.chartConfig.type).toUpperCase()==="BAR")||((this.dda_config.chartConfig.type).toUpperCase()==="COLUMN"))&&(((this.dda_config.chartConfig.axis).toUpperCase()==="DUAL")||((this.dda_config.chartConfig.value).toUpperCase()==="PERCENTAGE"))){sap.ui.core.Fragment.byId("editDialog","stackingOptions").setVisible(false);sap.ui.core.Fragment.byId("editDialog","enableStacking").setEnabled(false)}if(!(((this.dda_config.chartConfig.type).toUpperCase()==="BAR")||((this.dda_config.chartConfig.type).toUpperCase()==="COLUMN"))){sap.ui.core.Fragment.byId("editDialog","stackingOptions").setVisible(false);sap.ui.core.Fragment.byId("editDialog","enableStacking").setEnabled(false)}if(b.getObject().TYPE.toUpperCase()=="MEASURE"){sap.ui.core.Fragment.byId("editDialog","useAsThreshold").setVisible(true);if(b.getObject().NAME===t._oModel.getData().THRESHOLD_MEASURE)sap.ui.core.Fragment.byId("editDialog","useAsThreshold").setSelected(true);else sap.ui.core.Fragment.byId("editDialog","useAsThreshold").setSelected(false)}else if(b.getObject().TYPE.toUpperCase()=="DIMENSION"){sap.ui.core.Fragment.byId("editDialog","useAsThreshold").setVisible(false)}this._editMeasureDialog.open()},onEnableStacking:function(){var i=sap.ui.core.Fragment.byId("editDialog","enableStacking").getSelected();if(i){sap.ui.core.Fragment.byId("editDialog","stackingOptions").setVisible(true)}else{sap.ui.core.Fragment.byId("editDialog","stackingOptions").setVisible(false)}},onMsrStacking:function(){if(sap.ui.core.Fragment.byId("editDialog","addMsrToStack").getSelected()){sap.ui.core.Fragment.byId("editDialog","dimsToStack").setVisible(false)}},onDimStacking:function(){var t=this;if(sap.ui.core.Fragment.byId("editDialog","dimStack").getSelected()){sap.ui.core.Fragment.byId("editDialog","dimsToStack").setVisible(true);var j=new sap.ui.model.json.JSONModel();j.setData({STdata:t.chartDimensions});sap.ui.core.Fragment.byId("editDialog","dimsToStack").setModel(j);var o=new sap.ui.core.Item({key:"{name}",text:"{name}",});sap.ui.core.Fragment.byId("editDialog","dimsToStack").bindItems("/STdata",o);if(t.getDimensionToBeStacked(t.chartDimensions)){sap.ui.core.Fragment.byId("editDialog","dimsToStack").setSelectedKey(t.getDimensionToBeStacked(t.chartDimensions).name)}}else{sap.ui.core.Fragment.byId("editDialog","dimsToStack").setVisible(false)}},onAfterRendering:function(){this._fixSplitterHeight();sap.ui.Device.resize.attachHandler(this._fixSplitterHeight,this)},_fixSplitterHeight:function(){var _=$(window).height();var a=48;var b=49;this.byId('splitContainer').$().css("height",(_-(a+b))+"px")},showGeneral:function(){sap.ui.core.Fragment.byId("editDialog","FormEditMeasureGeneral").setVisible(true);sap.ui.core.Fragment.byId("editDialog","FormEditMeasureAdvanced").setVisible(false)},showAdvanced:function(){sap.ui.core.Fragment.byId("editDialog","FormEditMeasureGeneral").setVisible(false);sap.ui.core.Fragment.byId("editDialog","FormEditMeasureAdvanced").setVisible(true)},onEditDialogOk:function(e){var t=this;var b=e.getSource().getBindingContext("SB_DDACONFIG");if(sap.ui.core.Fragment.byId("editDialog","hideInTable").getSelected()){t.updateColumnProperty(t._oModel.getData().items,t.columnBeingEdited.NAME,"VISIBILITY","CHART")}else{t.updateColumnProperty(t._oModel.getData().items,t.columnBeingEdited.NAME,"VISIBILITY","BOTH")}if(t.columnBeingEdited.TYPE.toUpperCase()==="MEASURE"){if(sap.ui.core.Fragment.byId("editDialog","useAsThreshold").getSelected()){t._oModel.getData().THRESHOLD_MEASURE=t.columnBeingEdited.NAME}else{if(t.columnBeingEdited.NAME===t._config.THRESHOLD_MEASURE){t._oModel.getData().THRESHOLD_MEASURE=""}}}if(sap.ui.core.Fragment.byId("editDialog","enableStacking").getSelected()){if(sap.ui.core.Fragment.byId("editDialog","addMsrToStack").getSelected()){t.setStacking(true,"M",t._oModel.getData().items);var s=t.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","semanticColors"));var c=t.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","chartType"));if(c.getSelectedKey().toUpperCase()=="BAR"||c.getSelectedKey().toUpperCase()=="COLUMN"){s.getItemByKey("AUTO_SEMANTIC").setEnabled(true);s.getItemByKey("MANUAL_NON_SEMANTIC").setEnabled(true);s.getItemByKey("MANUAL_SEMANTIC").setEnabled(true)}}else if(sap.ui.core.Fragment.byId("editDialog","dimStack").getSelected()){var d=sap.ui.core.Fragment.byId("editDialog","dimsToStack").getSelectedKey();t.setStacking(true,"D",t._oModel.getData().items);t.setDimensionToBeStacked(t._oModel.getData().items,d);var s=t.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","semanticColors"));var c=t.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","chartType"));if(c.getSelectedKey().toUpperCase()=="BAR"||c.getSelectedKey().toUpperCase()=="COLUMN"){s.setSelectedKey("NONE");s.getItemByKey("AUTO_SEMANTIC").setEnabled(false);s.getItemByKey("MANUAL_NON_SEMANTIC").setEnabled(false);s.getItemByKey("MANUAL_SEMANTIC").setEnabled(false)}}}else{t.setStacking(false,"N",t._oModel.getData().items);var s=t.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","semanticColors"));var c=t.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","chartType"));if(c.getSelectedKey().toUpperCase()=="BAR"||c.getSelectedKey().toUpperCase()=="COLUMN"){s.getItemByKey("AUTO_SEMANTIC").setEnabled(true);s.getItemByKey("MANUAL_NON_SEMANTIC").setEnabled(true);s.getItemByKey("MANUAL_SEMANTIC").setEnabled(true)}}if((((this.dda_config.chartConfig.type).toUpperCase()==="BAR")||((this.dda_config.chartConfig.type).toUpperCase()==="COLUMN"))&&((this.dda_config.chartConfig.axis).toUpperCase()==="DUAL")){var a=sap.ui.getCore().byId(sap.ui.core.Fragment.createId("editDialog","AxisMsr1_edit"));var f=sap.ui.getCore().byId(sap.ui.core.Fragment.createId("editDialog","AxisMsr2_edit"));if(a.getSelectedKey()===f.getSelectedKey()){jQuery.sap.log.error("Same measure chosen for both axes")}var g=this._oModel.getData();for(var i=0;i<g.items.length;i++){if(g.items[i].TYPE.toUpperCase()==="MEASURE"){g.items[i].AXIS=2;for(var j=0;j<t.chartMeasures.length;j++){if(g.items[i].NAME===t.chartMeasures[j].name){g.items[i].AXIS=t.chartMeasures[j].axis;break}}}}this._oModel.setData(g)}this._updateMeasureDimensionBindings();this._editMeasureDialog.close();this.refreshChart()},onEditDialogCancel:function(){this.restorePrevConfig();this._updateMeasureDimensionBindings();this._editMeasureDialog.close()},_getColorPaletteTemplate:function(b){var i=new sap.ui.core.Icon({color:{path:"SB_DDACONFIG>color",formatter:this.formatcolor},src:"sap-icon://color-fill",size:"32px",width:"5%",press:function(e){var a=b.getModel("SB_DDACONFIG").getProperty("/COLOR_SCHEME");a=(a=="MANUAL_NON_SEMANTIC")?"COLOR1":(a=="MANUAL_SEMANTIC")?"COLOR2":"";b.getBindingContext().getObject()[a]=this.getBindingContext("SB_DDACONFIG").getProperty("color");b.getModel().refresh()}});var c=new sap.m.Label({text:{path:"SB_DDACONFIG>index",formatter:function(a){var t="";switch(a){case 1:t="Neutral";break;case 4:t="Good";break;case 7:t="Warning";break;case 10:t="Bad"}return t}},visible:{path:"SB_DDACONFIG>/COLOR_SCHEME",formatter:function(s){return s=="MANUAL_SEMANTIC"}}});return new sap.m.HBox({items:[i,c]})},showColorPopUp:function(e){var c;var b=e.getSource();var a=this._oModel.getProperty("/COLOR_SCHEME");var d=new sap.m.VBox();d.bindAggregation("items","SB_DDACONFIG>/"+a,this._getColorPaletteTemplate(b));var f=new sap.m.Popover({visible:{path:"SB_DDACONFIG>/COLOR_SCHEME",formatter:function(s){return s=="MANUAL_SEMANTIC"||s=="MANUAL_NON_SEMANTIC"}},showHeader:false,content:[d],});f.setModel(this._oModel,"SB_DDACONFIG");f.openBy(b)},onEditDialogCloseButton:function(){this._editMeasureDialog.close()},onSingleDualChange:function(){var t=this;var s=((this.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","singleDual"))).getSelectedKey()).toUpperCase();switch(s){case"SINGLE":this.refreshChart();break;case"DUAL":if(this.chartMeasures.length<2){sap.m.MessageBox.alert(t._oTextsModel.getResourceBundle().getText("DUAL_AXIS_CHART_MIN_MEASURE"),{onClose:function(){t.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","singleDual")).setSelectedKey("SINGLE")}})}else{var D=new sap.ui.model.json.JSONModel();D.setData({DATA:this.chartMeasures});this._dualAxisConfig.setModel(D,"DUAL_AXIS_MODEL");this.setStacking(true,"M",this._oModel.getData().items);sap.ui.core.Fragment.byId("dualAxisConfig","select_msr_for_axis_lbl").setText(t._oTextsModel.getResourceBundle().getText("SELECT_MEASURE_FOR_AXIS"," "));sap.ui.core.Fragment.byId("dualAxisConfig","axis_1_label").setText(t._oTextsModel.getResourceBundle().getText("AXIS",1));sap.ui.core.Fragment.byId("dualAxisConfig","axis_2_label").setText(t._oTextsModel.getResourceBundle().getText("AXIS",2));sap.ui.core.Fragment.byId("dualAxisConfig","In_stack1_label").setText(t._oTextsModel.getResourceBundle().getText("IN_STACK",1));var d=this.getMeasuresByAxis(this.chartMeasures);sap.ui.core.Fragment.byId("dualAxisConfig","stack1MsrsLabel").setText(d.axis1.nameArr.join(","));sap.ui.core.Fragment.byId("dualAxisConfig","stack2MsrsLabel").setText(d.axis2.nameArr.join(","));if(d.axis1.nameArr.length){sap.ui.core.Fragment.byId("dualAxisConfig","AxisMsr1").setSelectedKey(d.axis1.nameArr[0])};if(d.axis2.nameArr.length){sap.ui.core.Fragment.byId("dualAxisConfig","AxisMsr2").setSelectedKey(d.axis2.nameArr[0])};this._dualAxisConfig.open()}break;default:break}},onDualAxisDialogOk:function(){var t=this;var a=sap.ui.getCore().byId(sap.ui.core.Fragment.createId("dualAxisConfig","AxisMsr1"));var b=sap.ui.getCore().byId(sap.ui.core.Fragment.createId("dualAxisConfig","AxisMsr2"));if(a.getSelectedKey()===b.getSelectedKey()){jQuery.sap.log.error("Same measure chosen for both axes")}var c=this._oModel.getData();for(var i=0;i<c.items.length;i++){if(c.items[i].TYPE.toUpperCase()==="MEASURE"){c.items[i].AXIS=2;for(var j=0;j<t.chartMeasures.length;j++){if(c.items[i].NAME===t.chartMeasures[j].name){c.items[i].AXIS=t.chartMeasures[j].axis;break}}}}this._oModel.setData(c);this.refreshChart();this._dualAxisConfig.close()},onDualAxisDialogCancel:function(){this.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","singleDual")).setSelectedKey("SINGLE");this._dualAxisConfig.close()},setStackMsrs:function(){var t=this;var a=sap.ui.getCore().byId(sap.ui.core.Fragment.createId("dualAxisConfig","AxisMsr1"));var b=sap.ui.getCore().byId(sap.ui.core.Fragment.createId("dualAxisConfig","AxisMsr2"));if(a.getSelectedKey()===b.getSelectedKey()){sap.m.MessageBox.alert(t._oTextsModel.getResourceBundle().getText("SAME_MEASURE_CHOSEN_FOR_BOTH_AXES"));jQuery.sap.log.error("Same measure chosen for both axes")}else{for(var i=0;i<t.chartMeasures.length;i++){if(t.chartMeasures[i].name===a.getSelectedKey()){t.chartMeasures[i].axis=1}else if(t.chartMeasures[i].name===b.getSelectedKey()){t.chartMeasures[i].axis=2}}var d=this.getMeasuresByAxis(this.chartMeasures);sap.ui.core.Fragment.byId("dualAxisConfig","stack1MsrsLabel").setText(d.axis1.nameArr.join(","));sap.ui.core.Fragment.byId("dualAxisConfig","stack2MsrsLabel").setText(d.axis2.nameArr.join(","))}},setStackMsrs_edit:function(){var t=this;var a=sap.ui.getCore().byId(sap.ui.core.Fragment.createId("editDialog","AxisMsr1_edit"));var b=sap.ui.getCore().byId(sap.ui.core.Fragment.createId("editDialog","AxisMsr2_edit"));if(a.getSelectedKey()===b.getSelectedKey()){sap.m.MessageBox.alert(t._oTextsModel.getResourceBundle().getText("SAME_MEASURE_CHOSEN_FOR_BOTH_AXES"));jQuery.sap.log.error("Same measure chosen for both axes")}else{for(var i=0;i<t.chartMeasures.length;i++){if(t.chartMeasures[i].name===a.getSelectedKey()){t.chartMeasures[i].axis=1}else if(t.chartMeasures[i].name===b.getSelectedKey()){t.chartMeasures[i].axis=2}}var d=this.getMeasuresByAxis(this.chartMeasures);sap.ui.core.Fragment.byId("editDialog","stack1MsrsLabel_edit").setText(d.axis1.nameArr.join(","));sap.ui.core.Fragment.byId("editDialog","stack2MsrsLabel_edit").setText(d.axis2.nameArr.join(","))}},formatAxisToBool:function(a){if(a===1)return true;else return false},openMsrDialogForStack1:function(){var t=this;if(!this._msrDialogForStack1){this._msrDialogForStack1=sap.ui.xmlfragment("msrDialogForStack1","sap.suite.ui.smartbusiness.designtime.drilldown.view.msrDialogForStack1",this)}var S=new sap.ui.model.json.JSONModel();S.setData({DATA:t.chartMeasures});this._msrDialogForStack1.setModel(S);this._msrDialogForStack1.open()},onSearchInStack1SelectDialog:function(e){var v=e.getParameter("value");var f=new sap.ui.model.Filter("name",sap.ui.model.FilterOperator.Contains,v);var b=e.getSource().getBinding("items");b.filter([f])},onStack1SelectDialogOK:function(e){var t=this;var c=e.getParameter("selectedItems");if(c.length){for(var i=0;i<t.chartMeasures.length;i++){t.chartMeasures[i].axis=2;for(var j=0;j<c.length;j++){if(t.chartMeasures[i].name===c[j].getTitle()){t.chartMeasures[i].axis=1;break}}}e.getSource().getBinding("items").filter([]);var d=this.getMeasuresByAxis(this.chartMeasures);sap.ui.core.Fragment.byId("dualAxisConfig","stack1MsrsLabel").setText(d.axis1.nameArr.join(","));sap.ui.core.Fragment.byId("dualAxisConfig","stack2MsrsLabel").setText(d.axis2.nameArr.join(","));if(d.axis1.nameArr.length){sap.ui.core.Fragment.byId("dualAxisConfig","AxisMsr1").setSelectedKey(d.axis1.nameArr[0])};if(d.axis2.nameArr.length){sap.ui.core.Fragment.byId("dualAxisConfig","AxisMsr2").setSelectedKey(d.axis2.nameArr[0])};sap.ui.core.Fragment.byId("editDialog","stack1MsrsLabel_edit").setText(d.axis1.nameArr.join(","));sap.ui.core.Fragment.byId("editDialog","stack2MsrsLabel_edit").setText(d.axis2.nameArr.join(","));if(d.axis1.nameArr.length){sap.ui.core.Fragment.byId("editDialog","AxisMsr1_edit").setSelectedKey(d.axis1.nameArr[0])};if(d.axis2.nameArr.length){sap.ui.core.Fragment.byId("editDialog","AxisMsr2_edit").setSelectedKey(d.axis2.nameArr[0])}}else{sap.suite.smartbusiness.utils.showErrorMessage(t._oTextsModel.getResourceBundle().getText("SELECT_MEASURE_FOR_AXIS",1))}},onStack1SelectDialogCancel:function(){},onDataModeChange:function(){this.refreshChart()},onIsAbsoluteChange:function(){var v=((this.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","isAbsolute"))).getSelectedKey()).toUpperCase();if(v==="PERCENTAGE")this.setStacking(true,"M",this._oModel.getData().items);this.refreshChart()},onSemanticColorOptionChange:function(){this.refreshChart();if(this.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","semanticColors")).getSelectedKey()=="AUTO_SEMANTIC"){var f=[];var a={"type":(new sap.ui.model.Filter("TYPE",sap.ui.model.FilterOperator.EQ,"MEASURE")),"selected":(new sap.ui.model.Filter("SELECTED",sap.ui.model.FilterOperator.EQ,true)),};for(var i in a){f.push(a[i])}var s=sap.ui.getCore().byId(sap.ui.core.Fragment.createId("thresholdDialog","thresholdMeasure"));var b=s.getItems()?s.getItems():[];if(b.length&&s.getBinding('items')){s.getBinding('items').filter(f)}if(this._oModel.getData().THRESHOLD_MEASURE)s.setSelectedKey(this._oModel.getData().THRESHOLD_MEASURE);this.addThresholdMeasureDialog.open()}},onThresholdMeasureAdded:function(){this._oModel.getData().THRESHOLD_MEASURE=sap.ui.getCore().byId(sap.ui.core.Fragment.createId("thresholdDialog","thresholdMeasure")).getSelectedKey();this.copyConfigSnapshot();this.refreshChart();this.addThresholdMeasureDialog.close()},onThresholdMeasureCancel:function(){this.addThresholdMeasureDialog.close()},getLAISOfromSPRAS:function(k){var a=this.getView().getModel('SB_DDACONFIG').getData().ALL_LANGUAGES;for(var i=0;i<a.length;++i){if(a[i]["SPRAS"]==k)return a[i]["LAISO"]}},getIndexOfDuplicate:function(d,l){for(var i=0;i<d.length;++i){if(d[i]["SAP_LANGUAGE_KEY"]==l)return i}return-1},openAdditionalLanguagesDialog:function(){var a=this;this.AdditionalLanguagesDialog.setModel(this._oTextsModel,"i18n");this.copyConfigSnapshot();sap.ui.core.Fragment.byId("additionalLanguageDialog","newTitle").setValue("");var A=sap.ui.core.Fragment.byId("additionalLanguageDialog","ALTable");A.bindAggregation("items","SB_DDACONFIG>/ADDITIONAL_LANGUAGE_TITLES",new sap.m.ColumnListItem({cells:[new sap.m.Label({text:"{SB_DDACONFIG>TEXT}"}),new sap.m.Label({text:{path:"SB_DDACONFIG>SAP_LANGUAGE_KEY",formatter:function(s){return a.getLAISOfromSPRAS(s)}}}),new sap.ui.core.Icon({src:"sap-icon://decline",press:this.deleteEntry})],visible:{path:"SB_DDACONFIG>SAP_LANGUAGE_KEY",formatter:function(s){return s!=a._oModel.getData()["CURRENT_LANGUAGE"]}}}));this.AdditionalLanguagesDialog.open();return},closeAdditionalLanguagesDialog_OK:function(e){this.copyConfigSnapshot();this.AdditionalLanguagesDialog.close();return},closeAdditionalLanguagesDialog_Cancel:function(e){this.restorePrevConfig();this.AdditionalLanguagesDialog.close();return},deleteEntry:function(e){var b=e.getSource().getParent().getBindingContextPath();var i=parseInt(b.split("/").pop());var A=sap.ui.core.Fragment.byId("additionalLanguageDialog","ALTable");A.getModel("SB_DDACONFIG").getData()["ADDITIONAL_LANGUAGE_TITLES"].splice(i,1);A.getModel("SB_DDACONFIG").refresh();return},addEntry:function(){var n=sap.ui.core.Fragment.byId("additionalLanguageDialog","newTitle").getValue();var a=sap.ui.core.Fragment.byId("additionalLanguageDialog","newTitleLanguage").getSelectedKey();if(n&&a){}else return;var A=sap.ui.core.Fragment.byId("additionalLanguageDialog","ALTable");var t=A.getModel("SB_DDACONFIG").getData();var b={EVALUATION_ID:this.DDA_MODEL.getConfigurator().evaluationId,CONFIGURATION_ID:this._oModel.getData().ID,SAP_LANGUAGE_KEY:a,TEXT:n,IS_ACTIVE:this._oModel.getData()["IS_ACTIVE"]||1};var i;if((i=this.getIndexOfDuplicate(t["ADDITIONAL_LANGUAGE_TITLES"],a))==-1)t["ADDITIONAL_LANGUAGE_TITLES"].push(b);else{t["ADDITIONAL_LANGUAGE_TITLES"].splice(i,1);t["ADDITIONAL_LANGUAGE_TITLES"].push(b)}A.getModel("SB_DDACONFIG").refresh();return},formatName:function(a,b){return a+" "+b},refreshChart:function(){var c=this;this.canSave=false;var b=this.getView().byId("chartToolbar_config").getToolBar().getContentRight();if(b){if(b[0]&&(!(b[0].getVisible()))){b[0].setVisible(true)}if(b[1]&&(!(b[1].getVisible()))){b[1].setVisible(true)}if(b[3]&&(!(b[3].getVisible()))){b[3].setVisible(true)}if(b[0])b[0].firePress()}this.oChartDataModel=new sap.ui.model.json.JSONModel();this.oChartData=[];this.dda_chart=this.getView().byId("oChartRef");this.dda_chart.setStackedChartWidthEnhancer(false);this.dda_table=this.getView().byId("oChartTable");var t=this._oModel.getData();this.dda_config={};this.dda_config.chartConfig={mode:t.DATA_MODE||"DUMMY",title:"",dataLimit:t.DATA_LIMIT||null,dataLimitations:t.DATA_LIMITATIONS||false,type:(t.CHART_TYPE).toUpperCase()||"BAR",axis:t.AXIS_TYPE||"SINGLE",value:t.VALUE_TYPE||"ABSOLUTE",colorScheme:t.COLOR_SCHEME||"NONE",thresholdMeasure:t.THRESHOLD_MEASURE||""};this.dda_config.columnsConfig=[];for(var i=0;i<t.items.length;i++){this.dda_config.columnsConfig.push({name:t.items[i].NAME,type:t.items[i].TYPE,selected:t.items[i].SELECTED||false,visibility:t.items[i].VISIBILITY||"BOTH",sortOrder:t.items[i].SORT_ORDER||"NONE",sortBy:t.items[i].SORT_BY||"",axis:t.items[i].AXIS||2,stacking:t.items[i].STACKING||0,color:t.COLOR_SCHEME=="MANUAL_NON_SEMANTIC"?t.items[i].COLOR1:t.COLOR_SCHEME=="MANUAL_SEMANTIC"?t.items[i].COLOR2:""})}this.oColumns=[];this.oDimensions=[];this.oMeasures=[];this.dimNameArray=[];this.msrNameArray=[];this.chartDimensions=[];this.chartDimNames=[];this.chartMeasures=[];this.chartMsrNames=[];this.tableDimensions=[];this.tableDimNames=[];this.tableMeasures=[];this.tableMsrNames=[];for(var i=0;i<this.dda_config.columnsConfig.length;i++){if(this.dda_config.columnsConfig[i].selected){this.oColumns.push(this.dda_config.columnsConfig[i]);if((this.dda_config.columnsConfig[i].type).toUpperCase()==="DIMENSION"){this.oDimensions.push(this.dda_config.columnsConfig[i]);this.dimNameArray.push(this.dda_config.columnsConfig[i].name);if(((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="CHART")||((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="BOTH")){this.chartDimensions.push(this.dda_config.columnsConfig[i]);this.chartDimNames.push(this.dda_config.columnsConfig[i].name)}if(((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="TABLE")||((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="BOTH")){this.tableDimensions.push(this.dda_config.columnsConfig[i]);this.tableDimNames.push(this.dda_config.columnsConfig[i].name)}}else if((this.dda_config.columnsConfig[i].type).toUpperCase()==="MEASURE"){this.oMeasures.push(this.dda_config.columnsConfig[i]);this.msrNameArray.push(this.dda_config.columnsConfig[i].name);if(((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="CHART")||((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="BOTH")){this.chartMeasures.push(this.dda_config.columnsConfig[i]);this.chartMsrNames.push(this.dda_config.columnsConfig[i].name)}if(((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="TABLE")||((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="BOTH")){this.tableMeasures.push(this.dda_config.columnsConfig[i]);this.tableMsrNames.push(this.dda_config.columnsConfig[i].name)}}}}if((!(this.chartDimensions.length))||(!(this.chartMeasures.length))){this.dda_chart.setDataset(new sap.viz.core.FlattenedDataset({}));return}this.stacking=this.getStacking(this.chartMeasures,this.chartDimensions);this.isStackMsr=false;this.isStackDim=false;if(this.stacking.isEnabled&&(this.stacking.type=="M"))this.isStackMsr=true;else if(this.stacking.isEnabled&&(this.stacking.type=="D"))this.isStackDim=true;this.sapCaChartType=this.getSapCaChartType();this.dda_chart.setAdvancedChartSettings({plotArea:{animation:{dataLoading:false,dataUpdating:false,resizing:false}},legend:{title:{visible:false}}});if((this.dda_config.chartConfig.mode).toUpperCase()==="DUMMY"){this.oChartData=this.getDummyDataForChart(this.dimNameArray,this.msrNameArray);this.oChartDataModel.setData({businessData:c.oChartData})}else if((this.dda_config.chartConfig.mode).toUpperCase()==="RUNTIME"){this.getRuntimeChartData(this.dimNameArray,this.msrNameArray,this.oDimensions,this.oMeasures)}try{var p=sap.suite.smartbusiness.odata.properties(this._oModel.getData().QUERY_SERVICE_URI,this._oModel.getData().QUERY_ENTITY_SET)}catch(e){jQuery.sap.log.error("Failed to instantiate the odata model");throw e}this.column_labels_mapping=p.getLabelMappingObject();this.dimension_text_property_mapping=p.getTextPropertyMappingObject();this.measure_unit_property_mapping=p.getUnitPropertyMappingObject();if((this.sapCaChartType).toUpperCase()==="TABLE"){this.updateTable(this.tableDimensions,this.tableMeasures);if(b){if(b[0]){b[0].setVisible(false)}if(b[1]){b[1].setVisible(true)}if(b[3]){b[3].setVisible(false)}if(b[1]){b[1].firePress()}}this.canSave=true;return}if((((this.dda_config.chartConfig.type).toUpperCase()=="BAR")&&(this.dda_config.chartConfig.axis=="DUAL"))||(((this.dda_config.chartConfig.type).toUpperCase()=="COLUMN")&&(this.dda_config.chartConfig.axis=="DUAL"))){if(this.chartMeasures.length<2){sap.m.MessageBox.alert(c._oTextsModel.getResourceBundle().getText("DUAL_AXIS_CHART_MIN_MEASURE"),{onClose:function(){if(c._config)c.restorePrevConfig();else c.restoreFromConfigMasterSnapShot();c.onChartTypeChange();c.refreshChart()}});return}}if((((this.dda_config.chartConfig.type).toUpperCase()=="BAR")&&(this.dda_config.chartConfig.axis=="DUAL"))||(((this.dda_config.chartConfig.type).toUpperCase()=="COLUMN")&&(this.dda_config.chartConfig.axis=="DUAL"))){var a=false;var d=false;for(var i=0;i<this.chartMeasures.length;i++){if(this.chartMeasures[i].axis==1)a=true;else if(this.chartMeasures[i].axis==2)d=true}if(!(a)||!(d)){sap.m.MessageBox.alert(c._oTextsModel.getResourceBundle().getText("SELECT_MEASURE_FOR_AXIS",(a?2:1)),{onClose:function(){if(c._config)c.restorePrevConfig();else c.restoreFromConfigMasterSnapShot();c.onChartTypeChange();c.refreshChart()}});return}}if(((this.dda_config.chartConfig.type).toUpperCase()==="BUBBLE")&&(this.chartMeasures.length<3)){sap.m.MessageBox.alert(c._oTextsModel.getResourceBundle().getText("BUBBLE_CHART_MEASURE_COUNT"),{onClose:function(){if(c._config&&(((c._config.CHART_TYPE).toUpperCase()!="BUBBLE")||(c.getSelectedMeasuresCount(c._config.COLUMNS)>=3)))c.restorePrevConfig();else c.restoreFromConfigMasterSnapShot();c.onChartTypeChange();c.refreshChart()}});return}if((this.dda_config.chartConfig.type).toUpperCase()==="BUBBLE"){this.oDataset=this.create_Dataset(this.chartDimensions,this.chartMeasures);this.dda_chart.setDataset(this.oDataset)}this.dda_chart.setChartType(this.sapCaChartType);this.oDataset=this.create_Dataset(this.chartDimensions,this.chartMeasures);var f=this.dda_config.chartConfig.type;var g=this.dda_config.chartConfig.axis;var v=this.dda_config.chartConfig.value;var l=new sap.ui.core.Locale(sap.ui.getCore().getConfiguration().getLanguage());var h=sap.ca.ui.model.format.NumberFormat.getInstance({},l);if((f=='BAR')&&(v=="ABSOLUTE")){this.dda_chart.setXAxisLabelFormatter(this.formatChartNumbers.bind(this));this.dda_chart.setYAxisLabelFormatter(this.pseudoChartFormatter);if(g=='DUAL'){this.dda_chart.setXAxis2LabelFormatter(this.formatChartNumbers.bind(this))}}else if(f=='BUBBLE'){this.dda_chart.setXAxisLabelFormatter(this.formatChartNumbers.bind(this));this.dda_chart.setYAxisLabelFormatter(this.formatChartNumbers.bind(this))}else if(((f=='BAR')||(f=='COLUMN'))&&(v=='PERCENTAGE')){if(f=='BAR'){this.dda_chart.setXAxisLabelFormatter(function(r){return h.format_percentage(r)});this.dda_chart.setYAxisLabelFormatter(this.pseudoChartFormatter);if(g=='DUAL'){this.dda_chart.setXAxis2LabelFormatter(function(r){return h.format_percentage(r)})}}else{this.dda_chart.setYAxisLabelFormatter(function(r){return h.format_percentage(r)});this.dda_chart.setXAxisLabelFormatter(this.pseudoChartFormatter);if(g=='DUAL'){this.dda_chart.setYAxis2LabelFormatter(function(r){return h.format_percentage(r)})}}}else{this.dda_chart.setYAxisLabelFormatter(this.formatChartNumbers.bind(this));this.dda_chart.setXAxisLabelFormatter(this.pseudoChartFormatter);if((f=='COLUMN')&&(g=='DUAL')){this.dda_chart.setYAxis2LabelFormatter(this.formatChartNumbers.bind(this))}}this.dda_chart.setDataLabelFormatter([[this.formatChartNumbers.bind(this)],[this.formatChartNumbers.bind(this)],[this.formatChartNumbers.bind(this)]]);var j=[[],[],[]];for(var k=0;k<this.chartMsrNames.length;k++){j[0].push(this.getChartNumberFormatter(true));j[1].push(this.getChartNumberFormatter(true));j[2].push(this.getChartNumberFormatter(true))}this.dda_chart.setPopoverFormatter(j);if(((f=='BAR')||(f=='COLUMN'))&&(v=='PERCENTAGE')){var j=[[],[],[]];for(var k=0;k<this.chartMsrNames.length;k++){j[0].push(c.getChartPercentFormatter(true));j[1].push(c.getChartPercentFormatter(true))}this.dda_chart.setPopoverFormatter(j)}if(((this.dda_config.chartConfig.mode).toUpperCase()==="RUNTIME")&&(this.EVALUATION.getScaling()==-2)&&!(((f=='BAR')||(f=='COLUMN'))&&(v=='PERCENTAGE'))){this.addPercentToChart(this.chartMsrNames)}this.dda_chart.setDataset(this.oDataset);this.dda_chart.setModel(this.oChartDataModel);this.showChartLegendIfApplicable(this.chartDimNames,this.chartMsrNames);if((this.dda_config.chartConfig.type=="BAR")||(this.dda_config.chartConfig.type=="COLUMN")||(this.dda_config.chartConfig.type=="COMBINATION")||(this.dda_config.chartConfig.type=="LINE")){if((this.dda_config.chartConfig.colorScheme).toUpperCase()==="AUTO_SEMANTIC"){var m=this.dda_config.chartConfig.thresholdMeasure||"";var n=[];var o=-1;for(var i=0;i<this.chartMeasures.length;i++){n.push({color:sap.ca.ui.charts.ChartSemanticColor.GoodLight});if(this.chartMeasures[i].name===m)o=i}if(o>=0)n[o].color=sap.ca.ui.charts.ChartSemanticColor.Neutral;this.applyCustomColoring(this.dda_chart,this.dda_config.chartConfig.colorScheme,n,m,this.DDA_MODEL.EVALUATION_DATA.GOAL_TYPE)}else if(((this.dda_config.chartConfig.colorScheme).toUpperCase()==="MANUAL_SEMANTIC")||((this.dda_config.chartConfig.colorScheme).toUpperCase()==="MANUAL_NON_SEMANTIC")){this.applyCustomColoring(this.dda_chart,this.dda_config.chartConfig.colorScheme,this.chartMeasures)}}this.updateTable(this.tableDimensions,this.tableMeasures);this.canSave=true;this.copyConfigSnapshot()},getSapCaChartType:function(){var s=sap.ca.ui.charts.ChartType.Bar;var c=this.dda_config.chartConfig.type;var a=this.dda_config.chartConfig.axis;var v=this.dda_config.chartConfig.value;var b=(this.isStackMsr||(this.isStackDim&&(this.chartDimensions.length>1)))?true:false;switch(c){case"BAR":if(a==="SINGLE"){if(v==="ABSOLUTE"){if(b){s=sap.ca.ui.charts.ChartType.StackedBar}else{s=sap.ca.ui.charts.ChartType.Bar}}else if(v==="PERCENTAGE"){s=sap.ca.ui.charts.ChartType.StackedBar100}}else if(a==="DUAL"){if(v==="ABSOLUTE"){s=sap.ca.ui.charts.ChartType.DualStackedBar}else if(v==="PERCENTAGE"){s=sap.ca.ui.charts.ChartType.DualStackedBar100}}break;case"COLUMN":if(a==="SINGLE"){if(v==="ABSOLUTE"){if(b){s=sap.ca.ui.charts.ChartType.StackedColumn}else{s=sap.ca.ui.charts.ChartType.Column}}else if(v==="PERCENTAGE"){s=sap.ca.ui.charts.ChartType.StackedColumn100}}else if(a==="DUAL"){if(v==="ABSOLUTE"){s=sap.ca.ui.charts.ChartType.DualStackedColumn}else if(v==="PERCENTAGE"){s=sap.ca.ui.charts.ChartType.DualStackedColumn100}}break;case"LINE":s=sap.ca.ui.charts.ChartType.Line;break;case"COMBINATION":s=sap.ca.ui.charts.ChartType.Combination;break;case"BUBBLE":s=sap.ca.ui.charts.ChartType.Bubble;break;case"TABLE":s="TABLE";break;default:s=sap.ca.ui.charts.ChartType.Bar}return s},showChartLegendIfApplicable:function(d,m){var t=this;var o=this.getView().byId("chartToolbar_config");var c=this.dda_config.chartConfig.type;var i=(((c=="BAR")||(c=="COLUMN"))&&(this.isStackDim)&&(this.getDimensionToBeStacked(t.chartDimensions))&&(d.length>1))?true:false;if((m.length>1)||(i)){o.setShowLegend(true)}else{o.setShowLegend(false)}},getStacking:function(m,d){var s={};s.isEnabled=false;s.type="none";for(var i=0;i<m.length;i++){if(m[i].stacking===1){s.isEnabled=true;s.type="M"}}if(!(s.isEnabled)){for(var i=0;i<d.length;i++){if(d[i].stacking===1){s.isEnabled=true;s.type="D"}}}return s},setStacking:function(a,t,c){var b=this;if(a){if(t=="M"){for(var i=0;i<c.length;i++){if((c[i].TYPE).toUpperCase()==="MEASURE"){c[i].STACKING=1}else if((c[i].TYPE).toUpperCase()==="DIMENSION"){c[i].STACKING=0}}}else if(t=="D"){for(var i=0;i<c.length;i++){if((c[i].TYPE).toUpperCase()==="MEASURE"){c[i].STACKING=0}else if((c[i].TYPE).toUpperCase()==="DIMENSION"){c[i].STACKING=1}}}}else{for(var i=0;i<c.length;i++){c[i].STACKING=0}}},getDimensionToBeStacked:function(d){var D=null;for(var i=0;i<d.length;i++){if(d[i].axis===2){D=d[i];break}}return D},setDimensionToBeStacked:function(c,s){if(s){for(var i=0;i<c.length;i++){if((c[i].TYPE).toUpperCase()==="DIMENSION"){c[i].AXIS=1;if(c[i].NAME===s){c[i].AXIS=2}}}}},updateColumnProperty:function(c,n,p,v){for(var i=0;i<c.length;i++){if(c[i].NAME===n){(c[i])[p]=v;break}}},getMeasuresByAxis:function(c){var d={};d.axis1={};d.axis1.objArr=[];d.axis1.nameArr=[];d.axis2={};d.axis2.objArr=[];d.axis2.nameArr=[];for(var i=0;i<c.length;i++){if(c[i].axis===1){d.axis1.objArr.push(c[i]);d.axis1.nameArr.push(c[i].name)}else if(c[i].axis===2){d.axis2.objArr.push(c[i]);d.axis2.nameArr.push(c[i].name)}}return d},getAxisOfMsr:function(m){var a=2;for(var i=0;i<this.chartMeasures.length;i++){if((this.chartMeasures[i]).name===m){a=(this.chartMeasures[i]).axis;break}}return a},getSelectedMeasuresCount:function(m){var c=0;for(var i=0;i<m.length;i++){if((m[i].TYPE).toUpperCase()=="MEASURE"&&(m[i].SELECTED))++c}return c},create_Dataset:function(d,m){var c=this;var a=this.dda_config.chartConfig.type||"BAR";var b=this.dda_config.chartConfig.axis||"SINGLE";var v=this.dda_config.chartConfig.value||"ABSOLUTE";var s=this.isStackMsr;var e=this.getDimensionToBeStacked(d);var f=new sap.viz.core.FlattenedDataset({data:{path:"/businessData"}});for(var i=0;i<d.length;i++){var g=((this.dda_config.chartConfig.mode).toUpperCase()==="RUNTIME")?this.dimension_text_property_mapping[d[i].name]:d[i].name;var A=1;if(((a=="BAR")||(a=="COLUMN"))&&(this.isStackDim)&&(e)&&(g===e.name)&&(d.length>1)){A=2;this.dda_chart.setStackedChartWidthEnhancer(true)}var h=new sap.viz.ui5.data.DimensionDefinition({axis:A,value:"{"+g+"}",name:this.column_labels_mapping[d[i].name]||d[i].name});f.addDimension(h)}if((a=="LINE")||(a=="COMBINATION")||((a=="BAR")&&(b=="SINGLE"))||((a=="COLUMN")&&(b=="SINGLE"))){for(var i=0;i<m.length;i++){var g=m[i].name;var j=new sap.viz.ui5.data.MeasureDefinition({name:this.column_labels_mapping[g]||g,value:"{"+g+"}"});f.addMeasure(j)}}else if(a=="BUBBLE"){for(var i=0;i<3;i++){var g=m[i].name;var j=new sap.viz.ui5.data.MeasureDefinition({group:i+1,name:this.column_labels_mapping[g]||g,value:"{"+g+"}",});f.addMeasure(j)}}else if(((a=="BAR")&&(b=="DUAL"))||((a=="COLUMN")&&(b=="DUAL"))){for(var i=0;i<m.length;i++){var g=m[i].name;var k=(m[i].axis==1||m[i].axis==2)?m[i].axis:2;var j=new sap.viz.ui5.data.MeasureDefinition({group:k,name:this.column_labels_mapping[g]||g,value:"{"+g+"}"});f.addMeasure(j)}}return f},_getValueState:function(a,t){if(!this.EVALUATION.isTargetKpi()){if(a<t){return this.EVALUATION.isMaximizingKpi()?sap.ui.core.ValueState.Error:sap.ui.core.ValueState.Success}else if(a==t){return sap.ui.core.ValueState.None}else{return this.EVALUATION.isMaximizingKpi()?sap.ui.core.ValueState.Success:sap.ui.core.ValueState.Error}}else{return sap.ui.core.ValueState.None}},_getTableCellFormatter:function(o,i,a){var t=this;var f;var c=this.dda_config.chartConfig.type;var v=this.dda_config.chartConfig.value;var b=this.dda_config.chartConfig.axis;if(i){if(c.toUpperCase()=="TABLE"){if(t._isEvaluationThresholdMeasure(o))f=this.getChartPercentFormatter(true);else f=this.getChartNumberFormatter(true)}else if((b=='DUAL')&&(v=="ABSOLUTE")&&(c=='BAR'||c=='COLUMN')){if(a[(t.getAxisOfMsr(o))-1])f=this.getChartPercentFormatter(true);else f=this.getChartNumberFormatter(true)}else{f=this.getChartPercentFormatter(true)}}else f=this.getChartNumberFormatter(true);return f},_getTableCell:function(o,t,i,a){var b=this;if(t&&(o!==t)){return new sap.m.ObjectNumber({number:{path:o,formatter:b._getTableCellFormatter(o,i,a)},state:{parts:[{path:o},{path:t}],formatter:function(m,c){try{m=window.parseFloat(m);c=window.parseFloat(c);return b._getValueState(m,c)}catch(e){return sap.ui.core.ValueState.None}}}})}else{return new sap.m.Label({text:{path:o,formatter:b._getTableCellFormatter(o,i,a)}})}},updateTable:function(d,m){this.dda_table.destroyColumns();this.dda_table.destroyItems();for(var i=0;i<d.length;i++){var v=d[i].name;var L=new sap.m.Label({text:this.column_labels_mapping[v]||v});var c=new sap.m.Column({hAlign:"Left",header:L,minScreenWidth:"Tablet",demandPopin:true,});this.dda_table.addColumn(c)}for(var i=0;i<m.length;i++){var v=m[i].name;var L=new sap.m.Label({text:this.column_labels_mapping[v]||v});var c=new sap.m.Column({hAlign:"Right",header:L,minScreenWidth:"Tablet",demandPopin:true,});this.dda_table.addColumn(c)}var t=new sap.m.ColumnListItem({unread:false,});for(var i=0;i<d.length;i++){var v=((this.dda_config.chartConfig.mode).toUpperCase()==="RUNTIME")?this.dimension_text_property_mapping[d[i].name]:d[i].name;var o=new sap.m.Label({text:"{"+v+"}"});t.addCell(o)}var a=this._oModel.getData()["THRESHOLD_MEASURE"];var b=false;var e=this.dda_config.chartConfig.type;var f=this.dda_config.chartConfig.value;var g=this.dda_config.chartConfig.axis;if((this.sapCaChartType).toUpperCase()==="TABLE")var M=this.tableMsrNames;else var M=this.chartMsrNames;if(((this.dda_config.chartConfig.mode).toUpperCase()==="RUNTIME")&&(this.EVALUATION.getScaling()==-2)&&this.getIsPercentScaled(M)&&!(((e=='BAR')||(e=='COLUMN'))&&(f=='PERCENTAGE'))){b=true}var h=[];if(b){if((g=='DUAL')&&(f=="ABSOLUTE")&&(e=='BAR'||e=='COLUMN')){var j=this.getMeasuresByAxis(this.chartMeasures);h.push(this.getIsPercentScaled(j.axis1.nameArr));h.push(this.getIsPercentScaled(j.axis2.nameArr))}}for(var i=0;i<m.length;i++){var v=m[i].name;if(this._oModel.getData()["COLOR_SCHEME"]=="AUTO_SEMANTIC")var o=this._getTableCell(v,a,b,h);else var o=this._getTableCell(v,v,b,h);t.addCell(o)}this.dda_table.setModel(this.oChartDataModel);this.dda_table.bindAggregation("items","/businessData",t)},applyCustomColoring:function(c,a,b,t,i){var C=this;if((a).toUpperCase()==="AUTO_SEMANTIC"){if(((i=="MA")||(i=="MI"))&&t){C.setCustomColors(c,b,a);c.setChartSemanticColorFormatter(function(o){var d=c.getModel().getData().businessData;var e=o.ctx.path.dii_a1;var f=d[e];var r=f[t];if(r!=null&&typeof r!='undefined'){if(o.val>r){if(i=="MA")return sap.ca.ui.charts.ChartSemanticColor.GoodLight;else if(i=="MI")return sap.ca.ui.charts.ChartSemanticColor.BadLight}else if(o.val<r){if(i=="MA")return sap.ca.ui.charts.ChartSemanticColor.BadLight;else if(i=="MI")return sap.ca.ui.charts.ChartSemanticColor.GoodLight}else{return sap.ca.ui.charts.ChartSemanticColor.Neutral}}else{jQuery.sap.log.error("Threshold Measure:'"+t+"' not in Dataset. Error Applying Semantic Color");return sap.ca.ui.charts.ChartSemanticColor.NeutralLight}})}else{jQuery.sap.log.error("Threshold Measure not available or Goal type is RA . Error Applying Semantic Color")}}else if(((a).toUpperCase()==="MANUAL_SEMANTIC")||((a).toUpperCase()==="MANUAL_NON_SEMANTIC")){C.setCustomColors(c,b,a)}},setCustomColors:function(c,m,a){var d=c.getDataset();var b=d.getMeasures();var e="";if((a).toUpperCase()==="AUTO_SEMANTIC"||(a).toUpperCase()==="MANUAL_SEMANTIC")e=sap.ca.ui.charts.ChartSemanticColor.Neutral;for(var i=0;i<b.length;i++){b[i].addCustomData(new sap.ui.core.CustomData({key:"fillColor",value:m[i].color||e}))}},set_percentCharts_uom:function(){var c=this;var a=this.dda_config.chartConfig.type;var b=this.dda_config.chartConfig.axis;var v=this.dda_config.chartConfig.value;var m=[];for(var i=0;i<this.chartMsrNames.length;i++){m.push(this.column_labels_mapping[this.chartMsrNames[i]]||this.chartMsrNames[i])}var d=this.getMeasuresByAxis(this.chartMeasures);var e=[],f=[];for(var i=0;i<d.axis1.nameArr.length;i++){e.push(this.column_labels_mapping[d.axis1.nameArr[i]]||d.axis1.nameArr[i])}for(var i=0;i<d.axis2.nameArr.length;i++){f.push(this.column_labels_mapping[d.axis2.nameArr[i]]||d.axis2.nameArr[i])}var g=(b=='DUAL')?e.join(" & "):m.join(" & ");var C={};if(this.dda_chart)C=this.dda_chart.getAdvancedChartSettings()?this.dda_chart.getAdvancedChartSettings():{};if(((a=='BAR')||(a=="COLUMN"))&&(v=="PERCENTAGE")){if(a=='COLUMN'){C.yAxis={title:{visible:true,text:(g+" ("+(c._oTextsModel.getResourceBundle().getText("IN_PERCENTAGE"))+")")}};if(b=='DUAL'){C.yAxis2={title:{visible:true,text:(f.join(" & ")+" ("+(c._oTextsModel.getResourceBundle().getText("IN_PERCENTAGE"))+")")}}}}else if(a=='BAR'){C.xAxis={title:{visible:true,text:(g+" ("+(c._oTextsModel.getResourceBundle().getText("IN_PERCENTAGE"))+")")}};if(b=='DUAL'){C.xAxis2={title:{visible:true,text:(g+" ("+(c._oTextsModel.getResourceBundle().getText("IN_PERCENTAGE"))+")")}};C.xAxis={title:{visible:true,text:(f.join(" & ")+" ("+(c._oTextsModel.getResourceBundle().getText("IN_PERCENTAGE"))+")")}}}}if(this.dda_chart)this.dda_chart.setAdvancedChartSettings(C)}},formatChartNumbers:function(v){var l=new sap.ui.core.Locale(sap.ui.getCore().getConfiguration().getLanguage());function i(n){return!isNaN(parseFloat(n))&&isFinite(n)}if(i(v)){if(!this.chartFormatter){var d=1;jQuery.sap.require("sap.ca.ui.model.format.NumberFormat");if(d||d==0){this.chartFormatter=sap.ca.ui.model.format.NumberFormat.getInstance({style:'short',shortDecimals:d},l)}else{this.chartFormatter=sap.ca.ui.model.format.NumberFormat.getInstance({style:'short'},l)}}v=this.chartFormatter.format(v)}return v},pseudoChartFormatter:function(v){return v},getRuntimeChartData:function(d,m,a,b){var t=this;var c=this.getView().byId("chartToolbar_config");c.setBusy(true);var D=[];var M=[];d.forEach(function(x){D.push(x)});m.forEach(function(x){M.push(x)});this.COLUMNS_SORT=[];for(var i=0;i<t.oColumns.length;i++){if(t.oColumns[i].sortBy&&t.oColumns[i].sortOrder){if((t.oColumns[i].sortOrder).toUpperCase()=="ASC"||(t.oColumns[i].sortOrder).toUpperCase()=="DESC"){this.COLUMNS_SORT.push({name:t.oColumns[i].sortBy,order:t.oColumns[i].sortOrder});if(t.oColumns[i].sortBy!=t.oColumns[i].name){if((t.oColumns[i].type).toUpperCase()=="DIMENSION"){if((D.indexOf(t.oColumns[i].sortBy))==-1){D.push(t.oColumns[i].sortBy)}}else if((t.oColumns[i].type).toUpperCase()=="MEASURE"){if((M.indexOf(t.oColumns[i].sortBy))==-1){M.push(t.oColumns[i].sortBy)}}}}}}try{var u=sap.suite.smartbusiness.odata.getUri({serviceUri:this._oModel.getData().QUERY_SERVICE_URI,entitySet:this._oModel.getData().QUERY_ENTITY_SET,dimension:D,measure:M,filter:this.DDA_MODEL.EVALUATION_DATA.FILTERS.results,sort:this.COLUMNS_SORT,dataLimit:(((this.dda_config.chartConfig.dataLimitations)&&(this.dda_config.chartConfig.dataLimit>0))?(this.dda_config.chartConfig.dataLimit):null),});u.model.read(u.uri,null,null,true,function(f){if(f.results.length){t.oChartData=f.results;t.oChartDataModel.setData({businessData:t.oChartData})}else{jQuery.sap.log.info("Chart data Table Returned Empty Results");t.oChartData=[];t.oChartDataModel.setData({businessData:t.oChartData})}c.setBusy(false)},function(){jQuery.sap.log.error("Error fetching data : "+u.uri);t.oChartData=[];t.oChartDataModel.setData({businessData:t.oChartData});c.setBusy(false)})}catch(e){jQuery.sap.log.error(e.toString());t.oChartData=[];t.oChartDataModel.setData({businessData:t.oChartData});c.setBusy(false)}},getChartPercentFormatter:function(i){var l=new sap.ui.core.Locale(sap.ui.getCore().getConfiguration().getLanguage());function a(n){return!isNaN(parseFloat(n))&&isFinite(n)}var f={style:i?'standard':'short'};var c=sap.ca.ui.model.format.NumberFormat.getInstance(f,l);return function(s){return a(s)?c.format_percentage(s):s}},getChartNumberFormatter:function(i){var l=new sap.ui.core.Locale(sap.ui.getCore().getConfiguration().getLanguage());function a(n){return!isNaN(parseFloat(n))&&isFinite(n)}var f={style:i?'standard':'short'};var c=sap.ca.ui.model.format.NumberFormat.getInstance(f,l);return function(s){return a(s)?c.format(s):s}},getIsPercentScaled:function(m){if(this.thresholdMeasuresArray&&this.thresholdMeasuresArray.length){var t=this.thresholdMeasuresArray}else{var t=this._getEvaluationThresholdMeasures()}var a=false;if(t&&t.length){for(var i=0;i<m.length;i++){if(t.indexOf(m[i])!=-1){a=true;break}}}return a},_getEvaluationThresholdMeasures:function(){var t=[];t.push(this.EVALUATION.getKpiMeasureName());if(this.EVALUATION.getThresholdValueType()==="MEASURE"){var a=this.EVALUATION.getValues().results;if(a&&a.length){for(var i=0;i<a.length;i++){if((a[i]).COLUMN_NAME&&!((a[i]).FIXED)){t.push((a[i]).COLUMN_NAME)}}}}return t},_isEvaluationThresholdMeasure:function(m){if(this.thresholdMeasuresArray&&this.thresholdMeasuresArray.length){var t=this.thresholdMeasuresArray}else{var t=this._getEvaluationThresholdMeasures()}if(t&&t.length){if(t.indexOf(m)!=-1){return true}}return false},addPercentToChart:function(m){var t=this;var i=this.getIsPercentScaled(m);if(i){if(this.dda_chart){var c=this.dda_config.chartConfig.type;var a=this.dda_config.chartConfig.axis;var v=this.dda_config.chartConfig.value;if(((c=='BAR')||(c=='COLUMN'))&&(v=="ABSOLUTE")&&(a=='DUAL')){var b=this.getMeasuresByAxis(this.chartMeasures);var d=this.getIsPercentScaled(b.axis1.nameArr);var e=this.getIsPercentScaled(b.axis2.nameArr);var l=[[],[]];var f=[[],[],[]];if(d){l[0].push(t.getChartPercentFormatter());for(var k=0;k<b.axis1.nameArr.length;k++){f[0].push(t.getChartPercentFormatter(true))}}else{l[0].push(t.formatChartNumbers.bind(t));for(var k=0;k<b.axis1.nameArr.length;k++){f[0].push(t.getChartNumberFormatter(true))}}if(e){l[1].push(t.getChartPercentFormatter());for(var k=0;k<b.axis2.nameArr.length;k++){f[1].push(t.getChartPercentFormatter(true))}}else{l[1].push(t.formatChartNumbers.bind(t));for(var k=0;k<b.axis2.nameArr.length;k++){f[1].push(t.getChartNumberFormatter(true))}}this.dda_chart.setDataLabelFormatter(l);this.dda_chart.setPopoverFormatter(f);if(c=='BAR'){this.dda_chart.setXAxisLabelFormatter(d?t.getChartPercentFormatter():t.formatChartNumbers.bind(t));this.dda_chart.setYAxisLabelFormatter(t.pseudoChartFormatter);this.dda_chart.setXAxis2LabelFormatter(e?t.getChartPercentFormatter():t.formatChartNumbers.bind(t));this.dda_chart.setYAxis2LabelFormatter(t.pseudoChartFormatter)}else if(c=='COLUMN'){this.dda_chart.setXAxisLabelFormatter(t.pseudoChartFormatter);this.dda_chart.setYAxisLabelFormatter(d?t.getChartPercentFormatter():t.formatChartNumbers.bind(t));this.dda_chart.setXAxis2LabelFormatter(t.pseudoChartFormatter);this.dda_chart.setYAxis2LabelFormatter(e?t.getChartPercentFormatter():t.formatChartNumbers.bind(t))}}else{this.dda_chart.setDataLabelFormatter([[this.getChartPercentFormatter()],[this.getChartPercentFormatter()],[this.getChartPercentFormatter()]]);var f=[[],[],[]];for(var k=0;k<m.length;k++){f[0].push(t.getChartPercentFormatter(true));f[1].push(t.getChartPercentFormatter(true));f[2].push(t.getChartPercentFormatter(true))}this.dda_chart.setPopoverFormatter(f);if((c=='BAR')&&(v=="ABSOLUTE")){this.dda_chart.setXAxisLabelFormatter(t.getChartPercentFormatter());if(a=='DUAL'){this.dda_chart.setXAxis2LabelFormatter(t.getChartPercentFormatter())}}else if(c=='BUBBLE'){this.dda_chart.setXAxisLabelFormatter(t.getChartPercentFormatter());this.dda_chart.setYAxisLabelFormatter(t.getChartPercentFormatter())}else if(((c=='BAR')||(c=='COLUMN'))&&(v=='PERCENTAGE')){}else{this.dda_chart.setYAxisLabelFormatter(t.getChartPercentFormatter());if((c=='COLUMN')&&(a=='DUAL')){this.dda_chart.setYAxis2LabelFormatter(t.getChartPercentFormatter())}}}}}},getDummyDataForChart:function(d,m,M,D){M=M||5;D=D||10;var c=[];var t,a={};for(var i=0;i<d.length;i++){a[d[i]]=[];for(var j=0;j<M;j++){a[d[i]].push(d[i]+"_"+j)}}for(var i=0;i<D;i++){t={};for(var j=0;j<d.length;j++){var b=a[d[j]].length;var p=sap.suite.smartbusiness.utils.getRandomNumber(b);t[d[j]]=a[d[j]][p]}for(var j=0;j<m.length;j++){t[m[j]]=sap.suite.smartbusiness.utils.getRandomNumber(100)}c.push(t)}c=this.sortChartData(c,d);return c},sortChartData:function(c,d){var e=[];c.sort(function(a,b){var i=0;while(i<d.length){if(a[d[i]]>b[d[i]]){return-1}else if(a[d[i]]<b[d[i]]){return 1}i++}});var t={};for(var i=0,k=0;i<c.length;i++){var s="";for(var j=0;j<d.length;j++){s+=c[i][d[j]]}if(!t[s]){t[s]=true;e[k++]=c[i]}}return e},validateChartId:function(e){var c=e?e.getSource():this.getView().getContent()[0].getContent()[0].getMasterPages()[0].getContent()[2].getItems()[1];var a=c.getValue();if(/^[\w\d\.\_]+$/.test(a)){if(this.DDA_MODEL.getConfigurator().findViewById(a)){if(!this._oModel.getData().ID_EDITABLE){c.setValueState(sap.ui.core.ValueState.None);return true}else{c.setValueState(sap.ui.core.ValueState.Error);c.focus();return false}}else{c.setValueState(sap.ui.core.ValueState.None);return true}}else{c.setValueState(sap.ui.core.ValueState.Error);return false}},validateChartName:function(){var c=this.getView().getContent()[0].getContent()[0].getMasterPages()[0].getContent()[2].getItems()[3];var a=c.getValue();if(a){c.setValueState(sap.ui.core.ValueState.None);return true}else{c.setValueState(sap.ui.core.ValueState.Error);c.focus();return false}},validateDataLimit:function(e){var d=e?e.getSource():this.getView().getContent()[0].getContent()[0].getMasterPages()[0].getContent()[2].getItems()[7];var a=d.getValue();if(/^\d+$/gi.test(a)){var p=parseInt(a,10);if(p>0){d.setValueState(sap.ui.core.ValueState.None);return true}}else{d.setValueState(sap.ui.core.ValueState.Error);return false}},onSave:function(){if(this.validateChartId()&&this.validateChartName()&&this.validateDataLimit()){var s=this;if(this.currentViewId==this.DDA_MODEL.NEW_VIEWID){this.oApplicationFacade.__newViewAdded=true;this.oApplicationFacade.createdViewId=this.getView().getModel("SB_DDACONFIG").getData().SELECTED_VIEW}this.busyIndicator.open()&&this.getView().setBusy(true);var m=this.getView().getModel("SB_DDACONFIG").getData();var a=sap.suite.smartbusiness.ddaconfig.DrilldownSaveService;a.saveViewConfiguration(this.evaluationId,m,"update",function(){jQuery.sap.log.info("all calls success");s.busyIndicator.close()&&s.getView().setBusy(false);sap.m.MessageToast.show(s._oTextsModel.getResourceBundle().getText("CHART_CONFIG_SAVE_SUCCESS"));s.oApplicationFacade.__refreshModel=1;window.history.back();s.takeConfigMasterSnapShot()},function(){jQuery.sap.log.error(x+" failed");s.busyIndicator.close()&&s.getView().setBusy(false);sap.suite.smartbusiness.utils.showErrorMessage(s._oTextsModel.getResourceBundle().getText("SAVE_ERROR"))})}},formatMeasureName:function(s){s=this.COLUMN_LABEL_MAPPING[s];if(s==this.DDA_MODEL.EVALUATION_DATA.COLUMN_NAME){s=s+"("+this.getView().getModel("i18n").getProperty("KPI_MEASURE")+")"}return s},formatMeasureNameInList:function(n,t){if(t=="MEASURE")t=this.getView().getModel("i18n").getProperty("MEASURE");if(t=="DIMENSION")t=this.getView().getModel("i18n").getProperty("DIMENSION");if(n==this.DDA_MODEL.EVALUATION_DATA.COLUMN_NAME){t=this.getView().getModel("i18n").getProperty("KPI_MEASURE")}return t},formatType:function(t){if(t=="MEASURE")t=this.getView().getModel("i18n").getProperty("MEASURE");if(t=="DIMENSION")t=this.getView().getModel("i18n").getProperty("DIMENSION");return t},sortDimensionsAndMeasures:function(){var c=this;new sap.suite.ui.smartbusiness.lib.ListPersona({title:this.getView().getModel("i18n").getProperty("CHANGE_ORDER"),view:this.getView(),context:'/items',listItemContext:'LABEL',formatter:jQuery.proxy(this.formatMeasureName,this),namedModel:'SB_DDACONFIG',filter:{property:'SELECTED',value:true},callback:function(){c.refreshChart()}}).start()},onBack:function(){this.restoreFromConfigMasterSnapShot();window.history.back()},onCancel:function(){var s=this;new sap.m.Dialog({icon:"sap-icon://warning2",title:s._oTextsModel.getResourceBundle().getText("WARNING"),state:"Error",type:"Message",content:[new sap.m.Text({text:s._oTextsModel.getResourceBundle().getText("ARE_YOU_SURE")})],beginButton:new sap.m.Button({text:s._oTextsModel.getResourceBundle().getText("OK"),press:function(){s.restoreFromConfigMasterSnapShot();this.getParent().close();window.history.back()}}),endButton:new sap.m.Button({text:s._oTextsModel.getResourceBundle().getText("CANCEL"),press:function(){this.getParent().close()}})}).open()},onExit:function(){this.restoreFromConfigMasterSnapShot()},enableOrDisableSave:function(){var m=this._config.items.filter(function(s){return s.SELECTED});if(this.dda_config.chartConfig.type.toUpperCase()=="TABLE")this.canSave=true;if(m.length&&this.canSave){this.getView().byId("save-btn").setEnabled(true)}else{this.getView().byId("save-btn").setEnabled(false)}}})};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.lib.Chip')){jQuery.sap.declare("sap.suite.ui.smartbusiness.lib.Chip");sap.suite=sap.suite||{};sap.suite.smartbusiness=sap.suite.smartbusiness||{};sap.suite.smartbusiness.chip=(function(){var d=false;var c={"NT":"/sap/bc/ui5_ui5/ui2/ushell/resources/sap/ushell/components/tiles/indicatornumeric/NumericTileChip.xml","CT":"/sap/bc/ui5_ui5/ui2/ushell/resources/sap/ushell/components/tiles/indicatorcontribution/ContributionTileChip.xml","TT":"/sap/bc/ui5_ui5/ui2/ushell/resources/sap/ushell/components/tiles/indicatorArea/AreaChartTileChip.xml","AT":"/sap/bc/ui5_ui5/ui2/ushell/resources/sap/ushell/components/tiles/indicatordeviation/DeviationTileChip.xml"};var g=function(k,t){var u="ATH";try{if(sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService){var l=sap.ushell.Container.getService("UserInfo");if(l&&l.getId){u=l.getId()||"ATH"}}}catch(e){}return k.ID+"_"+u+"_"+t};var a=function(e,t,s,k){return{"tileType":t,"frameType":"OneByOne","navType":0,"semanticObject":s||e.COLUMN_NAME,"semanticAction":k||"analyzeSBKPIDetails","appParameters":{}}};var E=["ID","INDICATOR","INDICATOR_TITLE","INDICATOR_TYPE","GOAL_TYPE","TITLE","SCALING","ODATA_URL","ODATA_ENTITYSET","VIEW_NAME","COLUMN_NAME","OWNER_NAME","VALUES_SOURCE"];var b=function(e){var k=[];e.FILTERS["results"].forEach(function(l){delete l.__metadata;var o={};for(var m in l){if(l.hasOwnProperty(m)){o[m]=l[m]}}k.push(o)});return k};var f=function(e,o){if(o){return o.evaluationValues}else{var v=[];e.VALUES["results"].forEach(function(k){delete k.__metadata;var l={};for(var m in k){if(k.hasOwnProperty(m)){l[m]=k[m]}}v.push(l)});return v}};var _=function(e){var k=[];if(e&&e.length){e.forEach(function(l){var o={};o["NAME"]=l[0];o["OPERATOR"]=l[1];o["VALUE_1"]=l[2];o["VALUE_2"]=l[3];o["TYPE"]="FI";k.push(o)})}return k};var h=function(e){var k={};E.forEach(function(l){k[l]=e[l]});return k};var i=function(u,s){if(sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService){var e=sap.ushell.Container.getService("URLParsing");if(e){u=e.addSystemToServiceUrl(u,s)}}return u};var p=function(e,s,C,k){var l="/sap/hba/r/sb/core/odata/runtime/SMART_BUSINESS.xsodata";l=i(l,s);var O=sap.suite.smartbusiness.odata.getModelByServiceUri(l);O.create("/CHIPS_USER",e,null,function(){C.call()},function(m){k.call(null,m)},false)};var j=function(e,s,C,k){var l="/sap/hba/r/sb/core/logic/__token.xsjs";l=i(l,s);jQuery.ajax({url:l,type:"HEAD",async:false,headers:{"X-CSRF-Token":"Fetch"},success:function(m,n,x){l="/sap/hba/r/sb/core/logic/addToCatalog.xsjs";l=i(l,s);var t=x.getResponseHeader("x-csrf-token");jQuery.ajax({url:l,type:"POST",async:false,data:encodeURIComponent(JSON.stringify(e)),dataType:"json",headers:{"x-csrf-token":t},success:function(m){C.call(null,m)},error:function(o){k.call(null,o)}})},error:function(m){k.call(null,m)}})};return{savePersonalizedTile:function(P){var r={};if(P.evaluationId&&P.tileType){var e=sap.suite.smartbusiness.kpi.getEvaluationById({id:P.evaluationId,cache:true,filters:true,thresholds:true,useRuntimeService:true,sapSystem:P.sapSystem});if(e&&e.ID){var T=Date.now()+"";var C=g(e,T);var M={};M["id"]=C;M["tileType"]=P.tileType;M["url"]=c[P.tileType];M["description"]=P.title||e.TITLE;M["title"]=e.INDICATOR_TITLE;M["catalogId"]="HANA_CATALOG";M["configuration"]={tileConfiguration:{}};var k=a(e,P.tileType,P.semanticObject,P.semanticAction);k["id"]=C;k["dimension"]=P.dimension;var l=JSON.stringify(b(e));var m=f(e,P.evaluationValues);var n=JSON.stringify(h(e));M.configuration.tileConfiguration["TILE_PROPERTIES"]=JSON.stringify(k);M.configuration.tileConfiguration["EVALUATION_VALUES"]=JSON.stringify(m);M.configuration.tileConfiguration["EVALUATION"]=n;M.configuration.tileConfiguration["ADDITIONAL_FILTERS"]=JSON.stringify(_(P.additionalFilters));M.configuration.tileConfiguration["ADDITIONAL_APP_PARAMETERS"]=JSON.stringify(P.additionalAppParameters||{});M.configuration.tileConfiguration["timestamp"]=T;M.configuration["isSufficient"]="0";M["evaluationId"]=e.ID;M["keywords"]=P.keywords||null;var o=JSON.stringify(M.configuration).length;if(o>4096){M.configuration.tileConfiguration["EVALUATION_FILTERS"]=JSON.stringify([]);M.configuration["isSufficient"]="0"}M["configuration"].tileConfiguration=JSON.stringify(M["configuration"].tileConfiguration);M["configuration"]=JSON.stringify(M["configuration"]);j(M,P.sapSystem,function(q){r.status="Success",r.chipId=q.chipId,r.message="Tile Created Successfully"},function(q){r.status="Failed",r.message="Error Creating Tile";r.errorDescription=q})}else{r.status="Failed",r.message="Invalid Evaluation Id : "+P.evaluationId}}else{r.status="Failed",r.message="Mandatory Param evaluationId or TileType is Missing"}return r}}})()};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.tiles.AreaChart')){jQuery.sap.declare("sap.suite.ui.smartbusiness.tiles.AreaChart");sap.suite.ui.smartbusiness.tiles.Generic.extend("sap.suite.ui.smartbusiness.tiles.AreaChart",{metadata:{properties:{kpiValueRequired:{type:"boolean",defaultValue:false},tileType:{type:"string",defaultValue:"TT"}}},renderer:{}});sap.suite.ui.smartbusiness.tiles.AreaChart.prototype.init=function(){sap.suite.ui.smartbusiness.tiles.Generic.prototype.init.apply(this);var b=function(n){return new sap.suite.ui.commons.MicroAreaChartItem({color:"Neutral",points:{path:"/"+n+"/data",template:new sap.suite.ui.commons.MicroAreaChartPoint({x:"{day}",y:"{balance}"})}})};var a=function(n){return new sap.suite.ui.commons.MicroAreaChartLabel({label:"{/"+n+"/label}",color:"{/"+n+"/color}"})};this.setAggregation("_tile",new sap.suite.ui.commons.GenericTile({header:"{/header}",subheader:"{/subheader}",size:this.getSize(),frameType:this.getFrameType(),tileContent:new sap.suite.ui.commons.TileContent({unit:"{/unit}",size:this.getSize(),footer:"{/footerNum}",content:new sap.suite.ui.commons.MicroAreaChart({width:"{/width}",height:"{/height}",size:this.getSize(),target:b("target"),innerMinThreshold:b("innerMinThreshold"),innerMaxThreshold:b("innerMaxThreshold"),minThreshold:b("minThreshold"),maxThreshold:b("maxThreshold"),chart:b("chart"),minXValue:"{/minXValue}",maxXValue:"{/maxXValue}",minYValue:"{/minYValue}",maxYValue:"{/maxYValue}",firstXLabel:a("firstXLabel"),lastXLabel:a("lastXLabel"),firstYLabel:a("firstYLabel"),lastYLabel:a("lastYLabel"),minLabel:a("minLabel"),maxLabel:a("maxLabel"),})}),press:jQuery.proxy(this.tilePressed,this)}));this.jsonModel=new sap.ui.model.json.JSONModel();this.setModel(this.jsonModel)};sap.suite.ui.smartbusiness.tiles.AreaChart.prototype.onBeforeRendering=function(){sap.suite.ui.smartbusiness.tiles.Generic.prototype.onBeforeRendering.apply(this);if(this.getContentOnly()){var b=function(n){return new sap.suite.ui.commons.MicroAreaChartItem({color:"Neutral",points:{path:"/"+n+"/data",template:new sap.suite.ui.commons.MicroAreaChartPoint({x:"{day}",y:"{balance}"})}})};var a=function(n){return new sap.suite.ui.commons.MicroAreaChartLabel({label:"{/"+n+"/label}",color:"{/"+n+"/color}"})};this.setAggregation("_tile",new sap.suite.ui.commons.TileContent({unit:"",size:this.getSize(),footer:"",content:new sap.suite.ui.commons.MicroAreaChart({width:"{/width}",height:"{/height}",size:this.getSize(),target:b("target"),innerMinThreshold:b("innerMinThreshold"),innerMaxThreshold:b("innerMaxThreshold"),minThreshold:b("minThreshold"),maxThreshold:b("maxThreshold"),chart:b("chart"),minXValue:"{/minXValue}",maxXValue:"{/maxXValue}",minYValue:"{/minYValue}",maxYValue:"{/maxYValue}",firstXLabel:a("firstXLabel"),lastXLabel:a("lastXLabel"),firstYLabel:a("firstYLabel"),lastYLabel:a("lastYLabel"),minLabel:a("minLabel"),maxLabel:a("maxLabel"),})}))}};sap.suite.ui.smartbusiness.tiles.AreaChart.prototype.getEvalValueMeasureName=function(c,t,r){var e=c.VALUES.results;for(var i=0;i<e.length;i++){if(e[i].TYPE==t)if(r==="FIXED")return e[i].FIXED;else return e[i].COLUMN_NAME}};sap.suite.ui.smartbusiness.tiles.AreaChart.prototype.doProcess=function(){var t=this;this._fetchDataForAreaChartTile(function(m){var d={};if(true||t.isAssociatedKpi()){d.subheader=this.oConfig.TITLE;d.header=this.oConfig.INDICATOR_TITLE}d=jQuery.extend({},d,m);t.jsonModel.setData(d);t.setDoneState()},this.logError)};sap.suite.ui.smartbusiness.tiles.AreaChart.prototype._fetchDataForAreaChartTile=function(s,e){var t=this;var p={};this.oConfig=this.EVALUATION_DATA;p.serviceUri=this._addSystemAliasToUri(this.oConfig.ODATA_URL,this.getSapSystem());p.entitySet=this.oConfig.ODATA_ENTITYSET;p.measure=this.oConfig.COLUMN_NAME;p.dimension=this.getDimension();if(!this.getDimension()){this.logError("Dimension is Missing : Can't Render Area Chart");return}p.filter=this.getAllFilters();if(this.oConfig.VALUES_SOURCE=="MEASURE"){var f=t.oConfig.COLUMN_NAME;switch(t.oConfig.GOAL_TYPE){case"MI":t.sWarningHigh=t.getEvalValueMeasureName(t.oConfig,"WH","MEASURE");t.sCriticalHigh=t.getEvalValueMeasureName(t.oConfig,"CH","MEASURE");t.sTarget=t.getEvalValueMeasureName(t.oConfig,"TA","MEASURE");t.sTrend=t.getEvalValueMeasureName(t.oConfig,"TC","MEASURE");break;case"MA":t.sWarningLow=t.getEvalValueMeasureName(t.oConfig,"WL","MEASURE");t.sCriticalLow=t.getEvalValueMeasureName(t.oConfig,"CL","MEASURE");t.sTarget=t.getEvalValueMeasureName(t.oConfig,"TA","MEASURE");t.sTrend=t.getEvalValueMeasureName(t.oConfig,"TC","MEASURE");break;case"RA":t.sWarningHigh=t.getEvalValueMeasureName(t.oConfig,"WH","MEASURE");t.sCriticalHigh=t.getEvalValueMeasureName(t.oConfig,"CH","MEASURE");t.sTarget=t.getEvalValueMeasureName(t.oConfig,"TA","MEASURE");t.sTrend=t.getEvalValueMeasureName(t.oConfig,"TC","MEASURE");t.sWarningLow=t.getEvalValueMeasureName(t.oConfig,"WL","MEASURE");t.sCriticalLow=t.getEvalValueMeasureName(t.oConfig,"CL","MEASURE");break}var _=[t.sWarningHigh,t.sCriticalHigh,t.sTarget,t.sTrend,t.sWarningLow,t.sCriticalLow];_.forEach(function(c){if(c){f+=","+c}},this);p.measure=f}var a=sap.suite.smartbusiness.odata.getUri(p);var U=this.UOM_PROPERTY_MAPPING[this.oConfig.COLUMN_NAME];var b="";this.areaChartODataRef=a.model.read(a.uri,null,null,true,function(d){if(d&&d.results&&d.results.length){if(U){b=d.results[0][U]}p.dimension=t.TEXT_PROPERTY_MAPPING[t.getDimension()];var m=t._processDataForAreaChart(d,t.oConfig.VALUES_SOURCE,p.dimension,t.oConfig.COLUMN_NAME);m.unit=b;s.call(t,m)}else{e.call(t,"no Response from QueryServiceUri")}},function(c){if(c&&c.response){jQuery.sap.log.error(c.message+" : "+c.request.requestUri)}})};sap.suite.ui.smartbusiness.tiles.AreaChart.prototype._processDataForAreaChart=function(d,t,c,m){var f=this;var g=f.oConfig.VALUES.results;var h=[];var j=[];var w=[];var k=[];var l=[];var n=[];var o=d.results.length;var s=f.oConfig.SCALING;var p=d.results[0][c];var q,r,u,v,x;var y=d.results[d.results.length-1][c];var z=Number(d.results[0][m]);var A=Number(d.results[d.results.length-1][m]);var B=f.oConfig.GOAL_TYPE;for(i in d.results){d.results[i][c]=Number(i);d.results[i][m]=Number(d.results[i][m]);f.sWarningHigh?d.results[i][f.sWarningHigh]=Number(d.results[i][f.sWarningHigh]):"";f.sCriticalHigh?d.results[i][f.sCriticalHigh]=Number(d.results[i][f.sCriticalHigh]):"";f.sCriticalLow?d.results[i][f.sCriticalLow]=Number(d.results[i][f.sCriticalLow]):"";f.sWarningLow?d.results[i][f.sWarningLow]=Number(d.results[i][f.sWarningLow]):"";f.sTarget?d.results[i][f.sTarget]=Number(d.results[i][f.sTarget]):"";f.sWarningHigh?w.push(d.results[i][f.sWarningHigh]):"";f.sCriticalHigh?k.push(d.results[i][f.sCriticalHigh]):"";f.sCriticalLow?l.push(d.results[i][f.sCriticalLow]):"";f.sWarningLow?n.push(d.results[i][f.sWarningLow]):"";h.push(d.results[i][c]);j.push(d.results[i][m])}try{p=f.formatOdataObjectToString(p);y=f.formatOdataObjectToString(y)}catch(e){f.logError(e)}var C=Math.min.apply(Math,j);var S="";var D=z;if(this.oConfig.SCALING==-2)D*=100;var E=sap.suite.smartbusiness.utils.getLocaleFormattedValue(D,this.oConfig.SCALING);var F=E.toString();if(this.oConfig.SCALING==-2)F+=" %";var G=Math.max.apply(Math,j);D=A;if(this.oConfig.SCALING==-2)D*=100;sap.ui.getCore().byId("m1e1 title");var H=sap.suite.smartbusiness.utils.getLocaleFormattedValue(D,this.oConfig.SCALING);var I=H.toString();if(this.oConfig.SCALING==-2)I+=" %";try{var J=f.formatOdataObjectToString(Math.min.apply(Math,h));var K=f.formatOdataObjectToString(Math.max.apply(Math,h))}catch(e){f.logError(e)}if(t=="MEASURE"){(w.length!=0)?(f.firstwH=w[J])&&(f.lastwH=w[K]):"";(k.length!=0)?(f.firstcH=k[J])&&(f.lastcH=k[K]):"";(l.length!=0)?(f.firstcL=l[J])&&(f.lastcL=l[K]):"";(n.length!=0)?(f.firstwL=n[J])&&(f.lastwL=n[K]):""}var L={width:"100%",height:"100%",unit:f.unit||"",chart:{color:"Neutral",data:d.results},minXValue:J,maxXValue:K,minYValue:C,maxYValue:G,firstXLabel:{label:p+"",color:"Neutral"},lastXLabel:{label:y+"",color:"Neutral"},firstYLabel:{label:F+"",color:"Neutral"},lastYLabel:{label:I+"",color:"Neutral"},minLabel:{},maxLabel:{}};switch(B){case"MA":for(i in g){if(g[i].TYPE=="CL"){L.minThreshold={color:"Error",};var M=new Object();M[c]="";M[m]=Number(g[i].FIXED);f.cl=Number(g[i].FIXED);L.minThreshold.data=(t=="MEASURE")?d.results:[M];q=(t=="MEASURE")?f.sCriticalLow:m}else if(g[i].TYPE=="WL"){L.maxThreshold={color:"Good"};var M=new Object();M[c]="";M[m]=Number(g[i].FIXED);L.maxThreshold.data=(t=="MEASURE")?d.results:[M];r=(t=="MEASURE")?f.sWarningLow:m;f.wl=Number(g[i].FIXED)}else if(g[i].TYPE=="TA"){var M=new Object();M[c]="";M[m]=Number(g[i].FIXED);L.target={color:"Neutral",};L.target.data=(t=="MEASURE")?d.results:[M];x=(t=="MEASURE")?f.sTarget:m}}L.innerMinThreshold={data:[]};L.innerMaxThreshold={data:[]};if(t=="FIXED"){L.firstYLabel.color=z<f.cl?"Error":((f.cl<=z)&&(z<=f.wl))?"Critical":(z>f.wl)?"Good":"Neutral";L.lastYLabel.color=A<f.cl?"Error":((f.cl<=A)&&(A<=f.wl))?"Critical":(A>f.wl)?"Good":"Neutral"}else if(t=="MEASURE"&&f.firstwL&&f.lastwL&&f.firstcL&&f.lastcL){L.firstYLabel.color=z<f.firstcL?"Error":((f.firstcL<=z)&&(z<=f.firstwL))?"Critical":(z>f.firstwL)?"Good":"Neutral";L.lastYLabel.color=A<f.lastcL?"Error":((f.lastcL<=A)&&(A<=f.lastwL))?"Critical":(A>f.lastwL)?"Good":"Neutral"}break;case"MI":for(i in g){if(g[i].TYPE=="CH"){var M=new Object();M[c]="";M[m]=Number(g[i].FIXED);f.ch=Number(g[i].FIXED);L.maxThreshold={color:"Error",};L.maxThreshold.data=(t=="MEASURE")?d.results:[M];r=(t=="MEASURE")?f.sCriticalHigh:m}else if(g[i].TYPE=="WH"){var M=new Object();M[c]="";M[m]=Number(g[i].FIXED);f.wh=Number(g[i].FIXED);L.minThreshold={color:"Good",};L.minThreshold.data=(t=="MEASURE")?d.results:[M];q=(t=="MEASURE")?f.sWarningHigh:m}else if(g[i].TYPE=="TA"){var M=new Object();M[c]="";M[m]=Number(g[i].FIXED);L.target={color:"Neutral",};L.target.data=(t=="MEASURE")?d.results:[M];x=(t=="MEASURE")?f.sTarget:m}}if(t=="FIXED"){L.firstYLabel.color=z>f.ch?"Error":((f.wh<=z)&&(z<=f.ch))?"Critical":(z<f.wh)?"Good":"Neutral";L.lastYLabel.color=A>f.ch?"Error":((f.wh<=A)&&(A<=f.ch))?"Critical":(A<f.wh)?"Good":"Neutral"}else if(t=="MEASURE"&&f.firstwH&&f.lastwH&&f.firstcH&&f.lastcH){L.firstYLabel.color=z>f.firstcH?"Error":((f.firstwH<=z)&&(z<=f.firstcH))?"Critical":(z<f.firstwH)?"Good":"Neutral";L.lastYLabel.color=A>f.lastcH?"Error":((f.lastwH<=A)&&(A<=f.lastcH))?"Critical":(A<f.lastwH)?"Good":"Neutral"}L.innerMaxThreshold={data:[]};L.innerMinThreshold={data:[]};break;case"RA":for(i in g){if(g[i].TYPE=="CH"){var M=new Object();M[c]="";M[m]=Number(g[i].FIXED);f.ch=Number(g[i].FIXED);L.maxThreshold={color:"Error",};L.maxThreshold.data=(t=="MEASURE")?d.results:[M];r=(t=="MEASURE")?f.sCriticalHigh:m}else if(g[i].TYPE=="WH"){var M=new Object();M[c]="";M[m]=Number(g[i].FIXED);f.wh=Number(g[i].FIXED);L.innerMaxThreshold={color:"Good",};L.innerMaxThreshold.data=(t=="MEASURE")?d.results:[M];v=(t=="MEASURE")?f.sWarningHigh:m}else if(g[i].TYPE=="WL"){var M=new Object();M[c]="";M[m]=Number(g[i].FIXED);f.wl=Number(g[i].FIXED);L.innerMinThreshold={color:"Good",};L.innerMinThreshold.data=(t=="MEASURE")?d.results:[M];u=(t=="MEASURE")?f.sWarningLow:m}else if(g[i].TYPE=="CL"){var M=new Object();M[c]="";M[m]=Number(g[i].FIXED);f.cl=Number(g[i].FIXED);L.minThreshold={color:"Error",};L.minThreshold.data=(t=="MEASURE")?d.results:[M];q=(t=="MEASURE")?f.sCriticalLow:m}else if(g[i].TYPE=="TA"){var M=new Object();M[c]="";M[m]=Number(g[i].FIXED);L.target={color:"Neutral",};L.target.data=(t=="MEASURE")?d.results:[M];x=(t=="MEASURE")?f.sTarget:m}}if(t=="FIXED"){L.firstYLabel.color=(z>f.ch||z<f.cl)?"Error":((f.wh<=z)&&(z<=f.ch))||((f.cl<=z)&&(z<=f.wl))?"Critical":((z>=f.wl)&&(z<=f.wh))?"Good":"Neutral";L.lastYLabel.color=(A>f.ch||A<f.cl)?"Error":((f.wh<=A)&&(A<=f.ch))||((f.cl<=A)&&(A<=f.wl))?"Critical":((A>=f.wl)&&(A<=f.wh))?"Good":"Neutral"}else if(t=="MEASURE"&&f.firstwL&&f.lastwL&&f.firstcL&&f.lastcL&&f.firstwH&&f.lastwH&&f.firstcH&&f.lastcH){L.firstYLabel.color=(z>f.firstcH||z<f.firstcL)?"Error":((f.firstwH<=z)&&(z<=f.firstcH))||((f.firstcL<=z)&&(z<=f.firstwL))?"Critical":((z>=f.firstwL)&&(z<=f.firstwH))?"Good":"Neutral";L.lastYLabel.color=(A>f.lastcH||A<f.lastcL)?"Error":((f.lastwH<=A)&&(A<=f.lastcH))||((f.lastcL<=A)&&(A<=f.lastwL))?"Critical":((A>=f.lastwL)&&(A<=f.lastwH))?"Good":"Neutral"}break}var N=function(P,a,b,t){return new sap.suite.ui.commons.MicroAreaChartItem({color:"{/"+P+"/color}",points:{path:"/"+P+"/data",template:new sap.suite.ui.commons.MicroAreaChartPoint({x:"{"+a+"}",y:"{"+b+"}"})}})};var O=null;if(this.getContentOnly()){O=f.getTileControl()}else{O=f.getTileControl().getTileContent()[0].getContent()}O.setTarget(N("target",c,x));O.setInnerMinThreshold(N("innerMinThreshold",c,u));O.setInnerMaxThreshold(N("innerMaxThreshold",c,v));O.setMinThreshold(N("minThreshold",c,q));O.setMaxThreshold(N("maxThreshold",c,r));O.setChart(N("chart",c,m));return L};sap.suite.ui.smartbusiness.tiles.AreaChart.prototype.doDummyProcess=function(){this.jsonModel.setData(this.getDummyDataForAreaChartTile())}};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.tiles.Bullet')){jQuery.sap.declare("sap.suite.ui.smartbusiness.tiles.Bullet");sap.suite.ui.smartbusiness.tiles.Generic.extend("sap.suite.ui.smartbusiness.tiles.Bullet",{metadata:{properties:{kpiValueRequired:{type:"boolean",defaultValue:true},tileType:{type:"string",defaultValue:"AT"}}},renderer:{}});sap.suite.ui.smartbusiness.tiles.Bullet.prototype.init=function(){sap.suite.ui.smartbusiness.tiles.Generic.prototype.init.apply(this);this.setAggregation("_tile",new sap.suite.ui.commons.GenericTile({header:"{/header}",subheader:"{/subheader}",size:this.getSize(),frameType:this.getFrameType(),tileContent:new sap.suite.ui.commons.TileContent({unit:"{/unit}",size:this.getSize(),footer:"{/footerNum}",content:new sap.suite.ui.commons.BulletChart({size:this.getSize(),state:"{/state}",scale:"{/scale}",actual:{value:"{/actual/value}",color:"{/actual/color}"},actualValueLabel:"{/actualValueLabel}",targetValue:"{/targetValue}",targetValueLabel:"{/targetValueLabel}",thresholds:{template:new sap.suite.ui.commons.BulletChartData({value:"{value}",color:"{color}"}),path:"/thresholds"},showActualValue:"{/showActualValue}",showTargetValue:"{/showTargetValue}",})}),press:jQuery.proxy(this.tilePressed,this)}));this.jsonModel=new sap.ui.model.json.JSONModel();this.setModel(this.jsonModel)};sap.suite.ui.smartbusiness.tiles.Bullet.prototype.onBeforeRendering=function(){sap.suite.ui.smartbusiness.tiles.Generic.prototype.onBeforeRendering.apply(this);if(this.getContentOnly()){this.setAggregation("_tile",new sap.suite.ui.commons.BulletChart({size:this.getSize(),state:"{/state}",scale:"{/scale}",actual:{value:"{/actual/value}",color:"{/actual/color}"},actualValueLabel:"{/actualValueLabel}",targetValue:"{/targetValue}",targetValueLabel:"{/targetValueLabel}",thresholds:{template:new sap.suite.ui.commons.BulletChartData({value:"{value}",color:"{color}"}),path:"/thresholds"},showActualValue:"{/showActualValue}",showTargetValue:"{/showTargetValue}",}))}};sap.suite.ui.smartbusiness.tiles.Bullet.prototype.doProcess=function(){var d={};var t=this.getThresholdsObjAndColor(this.KPI_VALUE,this.EVALUATION_DATA.GOAL_TYPE,this.WARNING_LOW_VALUE,this.WARNING_HIGH_VALUE,this.CRITICAL_LOW_VALUE,this.CRITICAL_HIGH_VALUE);var a={value:Number(this.KPI_VALUE),color:t.returnColor};var c=Number(this.KPI_VALUE);if(this.EVALUATION_DATA.SCALING==-2)c*=100;var f=sap.suite.smartbusiness.utils.getLocaleFormattedValue(c,this.EVALUATION_DATA.SCALING);c=Number(this.TARGET_VALUE);if(this.EVALUATION_DATA.SCALING==-2)c*=100;var b=sap.suite.smartbusiness.utils.getLocaleFormattedValue(c,this.EVALUATION_DATA.SCALING);if(true||this.isAssociatedKpi()){d.subheader=this.EVALUATION_DATA.TITLE;d.header=this.EVALUATION_DATA.INDICATOR_TITLE}d.actual=a;d.thresholds=[];d.thresholds=t.arrObj;d.targetValue=Number(this.TARGET_VALUE);d.unit=this.UOM;d.actualValueLabel=f.toString();d.targetValueLabel=b.toString();if(this.EVALUATION_DATA.SCALING==-2){d.actualValueLabel+=" %";d.targetValueLabel+=" %"}this.jsonModel.setData(d);this.setDoneState()};sap.suite.ui.smartbusiness.tiles.Bullet.prototype.doDummyProcess=function(){this.jsonModel.setData(this.getDummyDataForBulletTile());this.setDoneState()};sap.suite.ui.smartbusiness.tiles.Bullet.prototype.getThresholdsObjAndColor=function(k,g,w,a,c,b){var t={};t.arrObj=[];t.returnColor=sap.suite.ui.commons.InfoTileValueColor.Neutral;if(g==="MI"){if(this.hasSomeValue(b,a)){b=window.parseFloat(b);a=window.parseFloat(a);t.arrObj.push({value:b,color:sap.suite.ui.commons.InfoTileValueColor.Error});t.arrObj.push({value:a,color:sap.suite.ui.commons.InfoTileValueColor.Critical});if(k<a){t.returnColor=sap.suite.ui.commons.InfoTileValueColor.Good}else if(k<=b){t.returnColor=sap.suite.ui.commons.InfoTileValueColor.Critical}else{t.returnColor=sap.suite.ui.commons.InfoTileValueColor.Error}}else{jQuery.sap.log.warning("One of the threshold values for Minimizing type KPI is missing")}}else if(g==="MA"){if(this.hasSomeValue(c,w)){c=window.parseFloat(c);w=window.parseFloat(w);t.arrObj.push({value:c,color:sap.suite.ui.commons.InfoTileValueColor.Error});t.arrObj.push({value:w,color:sap.suite.ui.commons.InfoTileValueColor.Critical});if(k<c){t.returnColor=sap.suite.ui.commons.InfoTileValueColor.Error}else if(k<=w){t.returnColor=sap.suite.ui.commons.InfoTileValueColor.Critical}else{t.returnColor=sap.suite.ui.commons.InfoTileValueColor.Good}}else{jQuery.sap.log.warning("One of the threshold values for Maximizing type KPI is missing")}}else{if(this.hasSomeValue(w,a,c,b)){b=window.parseFloat(b);a=window.parseFloat(a);w=window.parseFloat(w);c=window.parseFloat(c);t.arrObj.push({value:b,color:sap.suite.ui.commons.InfoTileValueColor.Error});t.arrObj.push({value:a,color:sap.suite.ui.commons.InfoTileValueColor.Critical});t.arrObj.push({value:w,color:sap.suite.ui.commons.InfoTileValueColor.Critical});t.arrObj.push({value:c,color:sap.suite.ui.commons.InfoTileValueColor.Error});if(k<c||k>b){t.returnColor=sap.suite.ui.commons.InfoTileValueColor.Error}else if((k>=c&&k<=w)||(k>=a&&k<=b)){t.returnColor=sap.suite.ui.commons.InfoTileValueColor.Critical}else{t.returnColor=sap.suite.ui.commons.InfoTileValueColor.Good}}else{jQuery.sap.log.warning("One of the threshold values for Range type KPI is missing")}}return t}};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.tiles.Comparison')){jQuery.sap.declare("sap.suite.ui.smartbusiness.tiles.Comparison");sap.suite.ui.smartbusiness.tiles.Generic.extend("sap.suite.ui.smartbusiness.tiles.Comparison",{metadata:{properties:{kpiValueRequired:{type:"boolean",defaultValue:false},tileType:{type:"string",defaultValue:"CT"}}},renderer:{}});sap.suite.ui.smartbusiness.tiles.Comparison.prototype.init=function(){sap.suite.ui.smartbusiness.tiles.Generic.prototype.init.apply(this);this.setAggregation("_tile",new sap.suite.ui.commons.GenericTile({header:"{/header}",subheader:"{/subheader}",size:this.getSize(),frameType:this.getFrameType(),tileContent:new sap.suite.ui.commons.TileContent({unit:"{/unit}",size:this.getSize(),footer:"{/footerNum}",content:new sap.suite.ui.commons.ComparisonChart({scale:"{/scale}",size:this.getSize(),state:"{/state}",data:{template:new sap.suite.ui.commons.ComparisonData({title:"{title}",value:"{value}",color:"{color}",displayValue:"{displayValue}"}),path:"/data"}})}),press:jQuery.proxy(this.tilePressed,this)}));this.jsonModel=new sap.ui.model.json.JSONModel();this.setModel(this.jsonModel)};sap.suite.ui.smartbusiness.tiles.Comparison.prototype.onBeforeRendering=function(){sap.suite.ui.smartbusiness.tiles.Generic.prototype.onBeforeRendering.apply(this);if(this.getContentOnly()){this.setAggregation("_tile",new sap.suite.ui.commons.ComparisonChart({scale:"{/scale}",size:this.getSize(),state:"{/state}",data:{template:new sap.suite.ui.commons.ComparisonData({title:"{title}",value:"{value}",color:"{color}",displayValue:"{displayValue}"}),path:"/data"}}))}};sap.suite.ui.smartbusiness.tiles.Comparison.prototype.doProcess=function(){var t=this;this._fetchDataForComparisonTile(function(k){var d={};d.data=k.kpiData;if(k.unitPrefix){d.unit=k.unitPrefix}if(true||t.isAssociatedKpi()){d.subheader=this.evaluationApi.getTitle();d.header=this.evaluationApi.getKpiName()}t.jsonModel.setData(d);t.setDoneState()},this.logError)};sap.suite.ui.smartbusiness.tiles.Comparison.prototype._fetchDataForComparisonTile=function(s,e){var _=function(a){var b=[{name:this.EVALUATION_DATA.COLUMN_NAME,order:"desc"}];if(a&&a.SORTING){var c=a.SORTING;if((c.order=='asc'||c.order=='desc')&&(c.by=='M'||c.by=='D')){var r=[];r.push({name:(c.by=='M'?this.evaluationApi.getKpiMeasureName():this.getDimension()),order:c.order});return r}}return b};var t=this;var p={};this.oConfig=this.EVALUATION_DATA;p.serviceUri=this._addSystemAliasToUri(this.evaluationApi.getODataUrl(),this.getSapSystem());p.entitySet=this.evaluationApi.getEntitySet();p.measure=this.evaluationApi.getKpiMeasureName();p.dimension=this.getDimension();p.filter=this.getAllFilters();p.sort=_.apply(this,[this.getTileConfiguration()]);p.dataLimit=3;t.oConfig.FINALVALUE={};p.sortingColumn=this.evaluationApi.getKpiMeasureName();var f=sap.suite.smartbusiness.odata.getUri(p);var u=this.UOM_PROPERTY_MAPPING[this.evaluationApi.getKpiMeasureName()];var d=this.TEXT_PROPERTY_MAPPING;this.comparisionChartODataRef=f.model.read(f.uri,null,null,true,function(a){if(a&&a.results&&a.results.length){if(u){t.oConfig.FINALVALUE.unitPrefix=a.results[0][u]}t.oConfig.FINALVALUE.kpiData=a;p.dimension=d[t.getDimension()];t.oConfig.FINALVALUE.kpiData=t._processDataForComparisonChart(t.oConfig.FINALVALUE.kpiData,p.measure,p.dimension);s.call(t,t.oConfig.FINALVALUE)}else{e.call(t,"no Response from QueryServiceUri")}},function(a){if(a&&a.response){jQuery.sap.log.error(a.message+" : "+a.request.requestUri)}})};sap.suite.ui.smartbusiness.tiles.Comparison.prototype._processDataForComparisonChart=function(d,m,a){var s=this.oConfig.PROPERTIES.semanticMeasure;var f=[];var t;var b=this;for(var i=0;i<d.results.length;i++){var c=d.results[i];var g={};try{g.title=c[a].toString()}catch(e){g.title=""};g.value=Number(c[m]);var h=Number(c[m]);if(this.oConfig.SCALING==-2)h*=100;var t=sap.suite.smartbusiness.utils.getLocaleFormattedValue(h,this.oConfig.SCALING);g.displayValue=t.toString();if(this.oConfig.SCALING==-2)g.displayValue+=" %";if(typeof s==='undefined'){g.color="Neutral"}else{if(this.evaluationApi.isMaximizingKpi()){if(g.value>c[s]){g.color="Good"}else{g.color="Error"}}else if(this.evaluationApi.isMinimizingKpi()){if(g.value<c[s]){g.color="Good"}else{g.color="Error"}}else{g.color="Neutral"}}f.push(g)}return f};sap.suite.ui.smartbusiness.tiles.Comparison.prototype.doDummyProcess=function(){this.jsonModel.setData(this.getDummyDataForComparisonTile())}};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.drilldown.view.S3.controller')){jQuery.sap.declare('sap.suite.ui.smartbusiness.designtime.drilldown.view.S3.controller');sap.ui.getCore().loadLibrary("sap.suite.ui.commons");jQuery.sap.require('sap.ca.scfld.md.controller.BaseDetailController');jQuery.sap.require('sap.ca.scfld.md.controller.BaseDetailController');jQuery.sap.require('sap.m.MessageBox');sap.ca.scfld.md.controller.BaseDetailController.extend("sap.suite.ui.smartbusiness.designtime.drilldown.view.S3",{onInit:function(){this.DDA_MODEL=null;this.evaluationId=null;this.viewId=null;this.ddaFilter=this.byId("ddaFilter");this.initializeTileHeader();this.defineHeaderFooterOptions();this.oRouter.attachRoutePatternMatched(this.onRoutePatternMatched,this);this.busyIndicator=new sap.m.BusyDialog()},tileTypeMapping:{NT:"Numeric",AT:"Bullet",CT:"Comparison",TT:"AreaChart",CM:"MeasureComparison"},headerNumberFormatter:function(s){return s?"12,345.67":""},headerNumberUnitFormatter:function(s){return s?"EUR":""},bindUiToModel:function(){this.DDA_MODEL.bindModel(this.getView(),"SB_DDACONFIG")},initializeTileHeader:function(){var t=this;var a=this.byId("tileContainer");a.bindAggregation("items",{path:"SB_DDACONFIG>/HEADERS_VISIBLE",factory:function(i,b){var c=b.getProperty("VISUALIZATION_TYPE");return new sap.suite.ui.smartbusiness.tiles[t.tileTypeMapping[c]]({evaluationId:t.evaluationId,mode:"DUMMY",header:"{SB_DDACONFIG>TITLE}",subheader:"{SB_DDACONFIG>SUBTITLE}"}).addStyleClass("drilldownKpiTiles")},})},lauchConfigurator:function(){this.oRouter.navTo("configurator",{evaluationId:this.evaluationId,viewId:this.viewId})},onRoutePatternMatched:function(E){var v=this.getView();if(E.getParameter("name")==="detail"){try{if(this.oApplicationFacade.__refreshModel&&this.oApplicationFacade.__refreshModel===1){this.getView().getModel()&&this.getView().getModel().refresh()}var a=E.getParameter("arguments").contextPath;var c=new sap.ui.model.Context(v.getModel(),'/'+a);v.setBindingContext(c);try{this.evaluationId=v.getBindingContext().getObject()["ID"]}catch(e){try{this.evaluationId=a.match(/ID=[^,]+/g)[0].replace(/(ID=')|(')/g,"")}catch(e){this.evaluationId=a.replace(/EVALUATIONS_DDA\('|'\)/g,"")}}var b=E.getParameter("arguments")["evaluationId"];if(b!==this.evaluationId){this.DDA_MODEL=sap.suite.smartbusiness.ddaconfig.Model.getInstance(this.evaluationId,true,this.getView().getModel("i18n"));this.EVALUATION=sap.suite.smartbusiness.kpi.parseEvaluation(this.DDA_MODEL.EVALUATION_DATA);var n=this.DDA_MODEL.NEW_VIEWID;var d=this.DDA_MODEL.getConfigurator().getDefaultViewId();if(d!=null){this.viewId=d;this.DDA_MODEL.setViewId(d)}else{this.viewId=n}this.bindUiToModel();this.ddaFilter.setEvaluationData(this.EVALUATION);this.ddaFilter.setEvaluationId(this.evaluationId);var f=[];this.getView().getModel("SB_DDACONFIG").getProperty("/FILTERS").forEach(function(s){f.push(s.name)});this.ddaFilter.setDimensions(f)}else{this.bindUiToModel();if(this.viewId==n&&this.getView().getModel("SB_DDACONFIG").getProperty("/ID")!=n){}}this.INIT_COUNT_HEADERS=this.getView().getModel("SB_DDACONFIG").getData()["HEADERS"].length;this.INIT_COUNT_FILTERS=this.getView().getModel("SB_DDACONFIG").getData()["FILTERS"].length;this._oTextsModel=this.getView().getModel("i18n");var o=this.getView().byId("chartToolbar");o._oFirstDimensionSelect.bindProperty("selectedKey","SB_DDACONFIG>/ID");this._oModel=this.getView().getModel("SB_DDACONFIG").getData();this.refreshChart();if(this.copyClipboard&&Object.keys(this.copyClipboard)&&Object.keys(this.copyClipboard).length){this.checkEvaluationForPaste()}if(this.getPage().getFooter()){this.checkForCopy()}}catch(e){sap.suite.smartbusiness.utils.showErrorMessage(this.oApplicationFacade.getResourceBundle().getText("FAILED_TO_LOAD_ODATA"),e.message)}}},defineHeaderFooterOptions:function(){var t=this;this.oHeaderFooterOptions={bSuppressBookmarkButton:true,sI18NDetailTitle:"DRILLDOWN_CONFIG_DETAILS",oEditBtn:{sI18nBtnTxt:"CONFIGURE",onBtnPressed:function(e){t.lauchConfigurator()},bEnabled:false,},buttonList:[{sId:"Delete",sI18nBtnTxt:"DELETE",onBtnPressed:function(e){t.onDeleteConfiguration()}},{sId:"Copy",sI18nBtnTxt:"COPY",onBtnPressed:function(e){t.copyEvaluationToClipboard()}},{sId:"Paste",sI18nBtnTxt:"PASTE",onBtnPressed:function(e){t.copyDDAConfiguration()}}]}},getHeaderFooterOptions:function(){return this.oHeaderFooterOptions},refreshChart:function(){var c=this;var b=this.getView().byId("chartToolbar").getToolBar().getContentRight();if(b){if(b[0]&&(!(b[0].getVisible()))){b[0].setVisible(true)}if(b[1]&&(!(b[1].getVisible()))){b[1].setVisible(true)}if(b[3]&&(!(b[3].getVisible()))){b[3].setVisible(true)}if(b[0])b[0].firePress()}this.oChartDataModel=new sap.ui.model.json.JSONModel();this.oChartData=[];this.dda_chart=this.getView().byId("chartRef");this.dda_chart.setStackedChartWidthEnhancer(false);this.dda_table=this.getView().byId("chartTable");var t=this._oModel;this.dda_config={};this.dda_config.chartConfig={mode:t.DATA_MODE||"DUMMY",title:"",dataLimit:t.DATA_LIMIT||null,dataLimitations:t.DATA_LIMITATIONS||false,type:(t.CHART_TYPE).toUpperCase()||"BAR",axis:t.AXIS_TYPE||"SINGLE",value:t.VALUE_TYPE||"ABSOLUTE",colorScheme:t.COLOR_SCHEME||"NONE",thresholdMeasure:t.THRESHOLD_MEASURE||""};this.dda_config.columnsConfig=[];for(var i=0;i<t.COLUMNS.length;i++){this.dda_config.columnsConfig.push({name:t.COLUMNS[i].NAME,type:t.COLUMNS[i].TYPE,visibility:t.COLUMNS[i].VISIBILITY||"BOTH",sortOrder:t.COLUMNS[i].SORT_ORDER||"NONE",sortBy:t.COLUMNS[i].SORT_BY||"",axis:t.COLUMNS[i].AXIS||1,stacking:t.COLUMNS[i].STACKING||0,color:t.COLOR_SCHEME=="MANUAL_NON_SEMANTIC"?t.COLUMNS[i].COLOR1:t.COLOR_SCHEME=="MANUAL_SEMANTIC"?t.COLUMNS[i].COLOR2:""})}this.oColumns=[];this.oDimensions=[];this.oMeasures=[];this.dimNameArray=[];this.msrNameArray=[];this.chartDimensions=[];this.chartDimNames=[];this.chartMeasures=[];this.chartMsrNames=[];this.tableDimensions=[];this.tableDimNames=[];this.tableMeasures=[];this.tableMsrNames=[];for(var i=0;i<this.dda_config.columnsConfig.length;i++){this.oColumns.push(this.dda_config.columnsConfig[i]);if((this.dda_config.columnsConfig[i].type).toUpperCase()==="DIMENSION"){this.oDimensions.push(this.dda_config.columnsConfig[i]);this.dimNameArray.push(this.dda_config.columnsConfig[i].name);if(((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="CHART")||((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="BOTH")){this.chartDimensions.push(this.dda_config.columnsConfig[i]);this.chartDimNames.push(this.dda_config.columnsConfig[i].name)}if(((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="TABLE")||((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="BOTH")){this.tableDimensions.push(this.dda_config.columnsConfig[i]);this.tableDimNames.push(this.dda_config.columnsConfig[i].name)}}else if((this.dda_config.columnsConfig[i].type).toUpperCase()==="MEASURE"){this.oMeasures.push(this.dda_config.columnsConfig[i]);this.msrNameArray.push(this.dda_config.columnsConfig[i].name);if(((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="CHART")||((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="BOTH")){this.chartMeasures.push(this.dda_config.columnsConfig[i]);this.chartMsrNames.push(this.dda_config.columnsConfig[i].name)}if(((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="TABLE")||((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="BOTH")){this.tableMeasures.push(this.dda_config.columnsConfig[i]);this.tableMsrNames.push(this.dda_config.columnsConfig[i].name)}}}if((!(this.chartDimensions.length))||(!(this.chartMeasures.length))){this.dda_chart.setDataset(new sap.viz.core.FlattenedDataset({}));return}this.stacking=this.getStacking(this.chartMeasures,this.chartDimensions);this.isStackMsr=false;this.isStackDim=false;if(this.stacking.isEnabled&&(this.stacking.type=="M"))this.isStackMsr=true;else if(this.stacking.isEnabled&&(this.stacking.type=="D"))this.isStackDim=true;this.sapCaChartType=this.getSapCaChartType();this.dda_chart.setAdvancedChartSettings({plotArea:{animation:{dataLoading:false,dataUpdating:false,resizing:false}},legend:{title:{visible:false}}});if((this.dda_config.chartConfig.mode).toUpperCase()==="DUMMY"){this.oChartData=this.getDummyDataForChart(this.dimNameArray,this.msrNameArray);this.oChartDataModel.setData({businessData:c.oChartData})}else if((this.dda_config.chartConfig.mode).toUpperCase()==="RUNTIME"){this.getRuntimeChartData(this.dimNameArray,this.msrNameArray)}try{var p=sap.suite.smartbusiness.odata.properties(this._oModel.QUERY_SERVICE_URI,this._oModel.QUERY_ENTITY_SET)}catch(e){jQuery.sap.log.error("Failed to instantiate the odata model");throw e}this.column_labels_mapping=p.getLabelMappingObject();this.dimension_text_property_mapping=p.getTextPropertyMappingObject();this.measure_unit_property_mapping=p.getUnitPropertyMappingObject();if((this.sapCaChartType).toUpperCase()==="TABLE"){this.updateTable(this.tableDimensions,this.tableMeasures);if(b){if(b[0]){b[0].setVisible(false)}if(b[1]){b[1].setVisible(true)}if(b[3]){b[3].setVisible(false)}if(b[1]){b[1].firePress()}}return}if((((this.dda_config.chartConfig.type).toUpperCase()=="BAR")&&(this.dda_config.chartConfig.axis=="DUAL"))||(((this.dda_config.chartConfig.type).toUpperCase()=="COLUMN")&&(this.dda_config.chartConfig.axis=="DUAL"))){var a=false;var d=false;for(var i=0;i<this.chartMeasures.length;i++){if(this.chartMeasures[i].axis==1)a=true;else if(this.chartMeasures[i].axis==2)d=true}if(!(a)||!(d)){sap.m.MessageBox.alert(c._oTextsModel.getResourceBundle().getText("SELECT_MEASURE_FOR_AXIS",(a?2:1)));return}}if(((this.dda_config.chartConfig.type).toUpperCase()==="BUBBLE")&&(this.chartMeasures.length<3)){sap.m.MessageBox.alert(c._oTextsModel.getResourceBundle().getText("BUBBLE_CHART_MEASURE_COUNT"));return}this.dda_chart.setChartType(this.sapCaChartType);this.oDataset=this.create_Dataset(this.chartDimensions,this.chartMeasures);var f=this.dda_config.chartConfig.type;var g=this.dda_config.chartConfig.axis;var v=this.dda_config.chartConfig.value;var l=new sap.ui.core.Locale(sap.ui.getCore().getConfiguration().getLanguage());var h=sap.ca.ui.model.format.NumberFormat.getInstance({},l);if((f=='BAR')&&(v=="ABSOLUTE")){this.dda_chart.setXAxisLabelFormatter(this.formatChartNumbers.bind(this));this.dda_chart.setYAxisLabelFormatter(this.pseudoChartFormatter);if(g=='DUAL'){this.dda_chart.setXAxis2LabelFormatter(this.formatChartNumbers.bind(this))}}else if(f=='BUBBLE'){this.dda_chart.setXAxisLabelFormatter(this.formatChartNumbers.bind(this));this.dda_chart.setYAxisLabelFormatter(this.formatChartNumbers.bind(this))}else if(((f=='BAR')||(f=='COLUMN'))&&(v=='PERCENTAGE')){if(f=='BAR'){this.dda_chart.setXAxisLabelFormatter(function(r){return h.format_percentage(r)});this.dda_chart.setYAxisLabelFormatter(this.pseudoChartFormatter);if(g=='DUAL'){this.dda_chart.setXAxis2LabelFormatter(function(r){return h.format_percentage(r)})}}else{this.dda_chart.setYAxisLabelFormatter(function(r){return h.format_percentage(r)});this.dda_chart.setXAxisLabelFormatter(this.pseudoChartFormatter);if(g=='DUAL'){this.dda_chart.setYAxis2LabelFormatter(function(r){return h.format_percentage(r)})}}}else{this.dda_chart.setYAxisLabelFormatter(this.formatChartNumbers.bind(this));this.dda_chart.setXAxisLabelFormatter(this.pseudoChartFormatter);if((f=='COLUMN')&&(g=='DUAL')){this.dda_chart.setYAxis2LabelFormatter(this.formatChartNumbers.bind(this))}}this.dda_chart.setDataLabelFormatter([[this.formatChartNumbers.bind(this)]]);if(((f=='BAR')||(f=='COLUMN'))&&(v=='PERCENTAGE')){var j=[[],[],[]];for(var k=0;k<this.chartMsrNames.length;k++){j[0].push(c.getChartPercentFormatter(true));j[1].push(c.getChartPercentFormatter(true))}this.dda_chart.setPopoverFormatter(j)}this.dda_chart.setDataset(this.oDataset);this.dda_chart.setModel(this.oChartDataModel);this.showChartLegendIfApplicable(this.chartDimNames,this.chartMsrNames);if((this.dda_config.chartConfig.type=="BAR")||(this.dda_config.chartConfig.type=="COLUMN")||(this.dda_config.chartConfig.type=="COMBINATION")||(this.dda_config.chartConfig.type=="LINE")){if((this.dda_config.chartConfig.colorScheme).toUpperCase()==="AUTO_SEMANTIC"){var m=this.dda_config.chartConfig.thresholdMeasure||"";var n=[];var o=-1;for(var i=0;i<this.chartMeasures.length;i++){n.push({color:sap.ca.ui.charts.ChartSemanticColor.GoodLight});if(this.chartMeasures[i].name===m)o=i}if(o>=0)n[o].color=sap.ca.ui.charts.ChartSemanticColor.Neutral;this.applyCustomColoring(this.dda_chart,this.dda_config.chartConfig.colorScheme,n,m,this.DDA_MODEL.EVALUATION_DATA.GOAL_TYPE)}else if(((this.dda_config.chartConfig.colorScheme).toUpperCase()==="MANUAL_SEMANTIC")||((this.dda_config.chartConfig.colorScheme).toUpperCase()==="MANUAL_NON_SEMANTIC")){this.applyCustomColoring(this.dda_chart,this.dda_config.chartConfig.colorScheme,this.chartMeasures)}}this.updateTable(this.tableDimensions,this.tableMeasures)},getSapCaChartType:function(){var s=sap.ca.ui.charts.ChartType.Bar;var c=this.dda_config.chartConfig.type;var a=this.dda_config.chartConfig.axis;var v=this.dda_config.chartConfig.value;var b=(this.isStackMsr||(this.isStackDim&&(this.chartDimensions.length>1)))?true:false;switch(c){case"BAR":if(a==="SINGLE"){if(v==="ABSOLUTE"){if(b){s=sap.ca.ui.charts.ChartType.StackedBar}else{s=sap.ca.ui.charts.ChartType.Bar}}else if(v==="PERCENTAGE"){s=sap.ca.ui.charts.ChartType.StackedBar100}}else if(a==="DUAL"){if(v==="ABSOLUTE"){s=sap.ca.ui.charts.ChartType.DualStackedBar}else if(v==="PERCENTAGE"){s=sap.ca.ui.charts.ChartType.DualStackedBar100}}break;case"COLUMN":if(a==="SINGLE"){if(v==="ABSOLUTE"){if(b){s=sap.ca.ui.charts.ChartType.StackedColumn}else{s=sap.ca.ui.charts.ChartType.Column}}else if(v==="PERCENTAGE"){s=sap.ca.ui.charts.ChartType.StackedColumn100}}else if(a==="DUAL"){if(v==="ABSOLUTE"){s=sap.ca.ui.charts.ChartType.DualStackedColumn}else if(v==="PERCENTAGE"){s=sap.ca.ui.charts.ChartType.DualStackedColumn100}}break;case"LINE":s=sap.ca.ui.charts.ChartType.Line;break;case"COMBINATION":s=sap.ca.ui.charts.ChartType.Combination;break;case"BUBBLE":s=sap.ca.ui.charts.ChartType.Bubble;break;case"TABLE":s="TABLE";break;default:s=sap.ca.ui.charts.ChartType.Bar}return s},showChartLegendIfApplicable:function(d,m){var t=this;var o=this.getView().byId("chartToolbar");var c=this.dda_config.chartConfig.type;var i=(((c=="BAR")||(c=="COLUMN"))&&(this.isisStackDim)&&(this.getDimensionToBeStacked(t.chartDimensions))&&(d.length>1))?true:false;if((m.length>1)||(i)){o.setShowLegend(true)}else{o.setShowLegend(false)}},getChartPercentFormatter:function(i){var l=new sap.ui.core.Locale(sap.ui.getCore().getConfiguration().getLanguage());function a(n){return!isNaN(parseFloat(n))&&isFinite(n)}var f={style:i?'standard':'short'};var c=sap.ca.ui.model.format.NumberFormat.getInstance(f,l);return function(s){return a(s)?c.format_percentage(s):s}},getStacking:function(m,d){var s={};s.isEnabled=false;s.type="none";for(var i=0;i<m.length;i++){if(m[i].stacking===1){s.isEnabled=true;s.type="M"}}if(!(s.isEnabled)){for(var i=0;i<d.length;i++){if(d[i].stacking===1){s.isEnabled=true;s.type="D"}}}return s},setStacking:function(a,t,c){var b=this;if(a){if(t=="M"){for(var i=0;i<c.length;i++){if((c[i].TYPE).toUpperCase()==="MEASURE"){c[i].STACKING=1}else if((c[i].TYPE).toUpperCase()==="DIMENSION"){c[i].STACKING=0}}}else if(t=="D"){for(var i=0;i<c.length;i++){if((c[i].TYPE).toUpperCase()==="MEASURE"){c[i].STACKING=0}else if((c[i].TYPE).toUpperCase()==="DIMENSION"){c[i].STACKING=1}}}}else{for(var i=0;i<c.length;i++){c[i].STACKING=0}}},getDimensionToBeStacked:function(d){var D=null;for(var i=0;i<d.length;i++){if(d[i].axis===2){D=d[i];break}}return D},setDimensionToBeStacked:function(c,s){if(s){for(var i=0;i<c.length;i++){if((c[i].TYPE).toUpperCase()==="DIMENSION"){c[i].AXIS=1;if(c[i].NAME===s){c[i].AXIS=2}}}}},updateColumnProperty:function(c,n,p,v){for(var i=0;i<c.length;i++){if(c[i].NAME===n){(c[i])[p]=v;break}}},getMeasuresByAxis:function(c){var d={};d.axis1={};d.axis1.objArr=[];d.axis1.nameArr=[];d.axis2={};d.axis2.objArr=[];d.axis2.nameArr=[];for(var i=0;i<c.length;i++){if(c[i].axis===1){d.axis1.objArr.push(c[i]);d.axis1.nameArr.push(c[i].name)}else if(c[i].axis===2){d.axis2.objArr.push(c[i]);d.axis2.nameArr.push(c[i].name)}}return d},create_Dataset:function(d,m){var c=this;var a=this.dda_config.chartConfig.type||"BAR";var b=this.dda_config.chartConfig.axis||"SINGLE";var v=this.dda_config.chartConfig.value||"ABSOLUTE";var s=this.isStackMsr;var e=this.getDimensionToBeStacked(d);var f=new sap.viz.core.FlattenedDataset({data:{path:"/businessData"}});for(var i=0;i<d.length;i++){var g=((this.dda_config.chartConfig.mode).toUpperCase()==="RUNTIME")?this.dimension_text_property_mapping[d[i].name]:d[i].name;var A=1;if(((a=="BAR")||(a=="COLUMN"))&&(this.isStackDim)&&(e)&&(g===e.name)&&(d.length>1)){A=2;this.dda_chart.setStackedChartWidthEnhancer(true)}var h=new sap.viz.ui5.data.DimensionDefinition({axis:A,value:"{"+g+"}",name:this.column_labels_mapping[d[i].name]||d[i].name});f.addDimension(h)}if((a=="LINE")||(a=="COMBINATION")||((a=="BAR")&&(b=="SINGLE"))||((a=="COLUMN")&&(b=="SINGLE"))){for(var i=0;i<m.length;i++){var g=m[i].name;var j=new sap.viz.ui5.data.MeasureDefinition({name:this.column_labels_mapping[g]||g,value:"{"+g+"}"});f.addMeasure(j)}}else if(a=="BUBBLE"){for(var i=0;i<3;i++){var g=m[i].name;var j=new sap.viz.ui5.data.MeasureDefinition({group:i+1,name:this.column_labels_mapping[g]||g,value:"{"+g+"}",});f.addMeasure(j)}}else if(((a=="BAR")&&(b=="DUAL"))||((a=="COLUMN")&&(b=="DUAL"))){for(var i=0;i<m.length;i++){var g=m[i].name;var k=(m[i].axis==1||m[i].axis==2)?m[i].axis:2;var j=new sap.viz.ui5.data.MeasureDefinition({group:k,name:this.column_labels_mapping[g]||g,value:"{"+g+"}"});f.addMeasure(j)}}return f},_getValueState:function(a,t){if(!this.EVALUATION.isTargetKpi()){if(a<t){return this.EVALUATION.isMaximizingKpi()?sap.ui.core.ValueState.Error:sap.ui.core.ValueState.Success}else if(a==t){return sap.ui.core.ValueState.None}else{return this.EVALUATION.isMaximizingKpi()?sap.ui.core.ValueState.Success:sap.ui.core.ValueState.Error}}else{return sap.ui.core.ValueState.None}},_getTableCell:function(o,t){var a=this;if(t&&(o!==t)){return new sap.m.ObjectNumber({number:{path:o},state:{parts:[{path:o},{path:t}],formatter:function(m,b){try{m=window.parseFloat(m);b=window.parseFloat(b);return a._getValueState(m,b)}catch(e){return sap.ui.core.ValueState.None}}}})}else{return new sap.m.Label({text:{path:o}})}},updateTable:function(d,m){this.dda_table.destroyColumns();this.dda_table.destroyItems();for(var i=0;i<d.length;i++){var v=d[i].name;var L=new sap.m.Label({text:this.column_labels_mapping[v]||v});var c=new sap.m.Column({hAlign:"Left",header:L,minScreenWidth:"Tablet",demandPopin:true,});this.dda_table.addColumn(c)}for(var i=0;i<m.length;i++){var v=m[i].name;var L=new sap.m.Label({text:this.column_labels_mapping[v]||v});var c=new sap.m.Column({hAlign:"Right",header:L,minScreenWidth:"Tablet",demandPopin:true,});this.dda_table.addColumn(c)}var t=new sap.m.ColumnListItem({unread:false,});for(var i=0;i<d.length;i++){var v=((this.dda_config.chartConfig.mode).toUpperCase()==="RUNTIME")?this.dimension_text_property_mapping[d[i].name]:d[i].name;var o=new sap.m.Label({text:"{"+v+"}"});t.addCell(o)}var a=this._oModel["THRESHOLD_MEASURE"];for(var i=0;i<m.length;i++){var v=m[i].name;if(this._oModel["COLOR_SCHEME"]=="AUTO_SEMANTIC")var o=this._getTableCell(v,a);else var o=this._getTableCell(v,v);t.addCell(o)}this.dda_table.setModel(this.oChartDataModel);this.dda_table.bindAggregation("items","/businessData",t)},applyCustomColoring:function(c,a,b,t,i){var C=this;if((a).toUpperCase()==="AUTO_SEMANTIC"){if(((i=="MA")||(i=="MI"))&&t){C.setCustomColors(c,b,a);c.setChartSemanticColorFormatter(function(o){var d=c.getModel().getData().businessData;var e=o.ctx.path.dii_a1;var f=d[e];var r=f[t];if(r!=null&&typeof r!='undefined'){if(o.val>r){if(i=="MA")return sap.ca.ui.charts.ChartSemanticColor.GoodLight;else if(i=="MI")return sap.ca.ui.charts.ChartSemanticColor.BadLight}else if(o.val<r){if(i=="MA")return sap.ca.ui.charts.ChartSemanticColor.BadLight;else if(i=="MI")return sap.ca.ui.charts.ChartSemanticColor.GoodLight}else{return sap.ca.ui.charts.ChartSemanticColor.Neutral}}else{jQuery.sap.log.error("Threshold Measure:'"+t+"' not in Dataset. Error Applying Semantic Color");return sap.ca.ui.charts.ChartSemanticColor.NeutralLight}})}else{jQuery.sap.log.error("Threshold Measure not available or Goal type is RA . Error Applying Semantic Color")}}else if(((a).toUpperCase()==="MANUAL_SEMANTIC")||((a).toUpperCase()==="MANUAL_NON_SEMANTIC")){C.setCustomColors(c,b,a)}},setCustomColors:function(c,m,a){var d=c.getDataset();var b=d.getMeasures();var e="";if((a).toUpperCase()==="AUTO_SEMANTIC"||(a).toUpperCase()==="MANUAL_SEMANTIC")e=sap.ca.ui.charts.ChartSemanticColor.Neutral;for(var i=0;i<b.length;i++){b[i].addCustomData(new sap.ui.core.CustomData({key:"fillColor",value:m[i].color||e}))}},set_percentCharts_uom:function(){var c=this;var a=this.dda_config.chartConfig.type;var b=this.dda_config.chartConfig.axis;var v=this.dda_config.chartConfig.value;var m=[];for(var i=0;i<this.chartMsrNames.length;i++){m.push(this.column_labels_mapping[this.chartMsrNames[i]]||this.chartMsrNames[i])}var d=this.getMeasuresByAxis(this.chartMeasures);var e=[],f=[];for(var i=0;i<d.axis1.nameArr.length;i++){e.push(this.column_labels_mapping[d.axis1.nameArr[i]]||d.axis1.nameArr[i])}for(var i=0;i<d.axis2.nameArr.length;i++){f.push(this.column_labels_mapping[d.axis2.nameArr[i]]||d.axis2.nameArr[i])}var g=(b=='DUAL')?e.join(" & "):m.join(" & ");var C={};if(this.dda_chart)C=this.dda_chart.getAdvancedChartSettings()?this.dda_chart.getAdvancedChartSettings():{};if(((a=='BAR')||(a=="COLUMN"))&&(v=="PERCENTAGE")){if(a=='COLUMN'){C.yAxis={title:{visible:true,text:(g+" ("+(c._oTextsModel.getResourceBundle().getText("IN_PERCENTAGE"))+")")}};if(b=='DUAL'){C.yAxis2={title:{visible:true,text:(f.join(" & ")+" ("+(c._oTextsModel.getResourceBundle().getText("IN_PERCENTAGE"))+")")}}}}else if(a=='BAR'){C.xAxis={title:{visible:true,text:(g+" ("+(c._oTextsModel.getResourceBundle().getText("IN_PERCENTAGE"))+")")}};if(b=='DUAL'){C.xAxis2={title:{visible:true,text:(g+" ("+(c._oTextsModel.getResourceBundle().getText("IN_PERCENTAGE"))+")")}};C.xAxis={title:{visible:true,text:(f.join(" & ")+" ("+(c._oTextsModel.getResourceBundle().getText("IN_PERCENTAGE"))+")")}}}}if(this.dda_chart)this.dda_chart.setAdvancedChartSettings(C)}},formatChartNumbers:function(v){var l=new sap.ui.core.Locale(sap.ui.getCore().getConfiguration().getLanguage());function i(n){return!isNaN(parseFloat(n))&&isFinite(n)}if(i(v)){if(!this.chartFormatter){var d=1;jQuery.sap.require("sap.ca.ui.model.format.NumberFormat");if(d||d==0){this.chartFormatter=sap.ca.ui.model.format.NumberFormat.getInstance({style:'short',shortDecimals:d},l)}else{this.chartFormatter=sap.ca.ui.model.format.NumberFormat.getInstance({style:'short'},l)}}v=this.chartFormatter.format(v)}return v},pseudoChartFormatter:function(v){return v},getRuntimeChartData:function(d,m){var t=this;var c=this.getView().byId("chartToolbar");c.setBusy(true);this.COLUMNS_SORT=[];for(var i=0;i<t.oColumns.length;i++){if(t.oColumns[i].sortBy&&t.oColumns[i].sortOrder){if((t.oColumns[i].sortOrder).toUpperCase()=="ASC"||(t.oColumns[i].sortOrder).toUpperCase=="DESC"){this.COLUMNS_SORT.push({name:t.oColumns[i].sortBy,order:t.oColumns[i].sortOrder})}}}try{var u=sap.suite.smartbusiness.odata.getUri({serviceUri:this._oModel.QUERY_SERVICE_URI,entitySet:this._oModel.QUERY_ENTITY_SET,dimension:d,measure:m,filter:this.DDA_MODEL.EVALUATION_DATA.FILTERS.results,sort:this.COLUMNS_SORT,dataLimit:(((this.dda_config.chartConfig.dataLimitations)&&(this.dda_config.chartConfig.dataLimit>0))?(this.dda_config.chartConfig.dataLimit):null),});u.model.read(u.uri,null,null,true,function(a){if(a.results.length){t.oChartData=a.results;t.oChartDataModel.setData({businessData:t.oChartData})}else{jQuery.sap.log.info("Chart data Table Returned Empty Results");t.oChartData=[];t.oChartDataModel.setData({businessData:t.oChartData})}c.setBusy(false)},function(){jQuery.sap.log.error("Error fetching data : "+u.uri);t.oChartData=[];t.oChartDataModel.setData({businessData:t.oChartData});c.setBusy(false)})}catch(e){jQuery.sap.log.error(e.toString());t.oChartData=[];t.oChartDataModel.setData({businessData:t.oChartData});c.setBusy(false)}},getDummyDataForChart:function(d,m,M,D){M=M||5;D=D||10;var c=[];var t,a={};for(var i=0;i<d.length;i++){a[d[i]]=[];for(var j=0;j<M;j++){a[d[i]].push(d[i]+"_"+j)}}for(var i=0;i<D;i++){t={};for(var j=0;j<d.length;j++){var b=a[d[j]].length;var p=sap.suite.smartbusiness.utils.getRandomNumber(b);t[d[j]]=a[d[j]][p]}for(var j=0;j<m.length;j++){t[m[j]]=sap.suite.smartbusiness.utils.getRandomNumber(100)}c.push(t)}c=this.sortChartData(c,d);return c},sortChartData:function(c,d){var e=[];c.sort(function(a,b){var i=0;while(i<d.length){if(a[d[i]]>b[d[i]]){return-1}else if(a[d[i]]<b[d[i]]){return 1}i++}});var t={};for(var i=0,k=0;i<c.length;i++){var s="";for(var j=0;j<d.length;j++){s+=c[i][d[j]]}if(!t[s]){t[s]=true;e[k++]=c[i]}}return e},onDeleteConfiguration:function(){var t=this;var s=t;this.confirmDialog=new sap.m.Dialog({icon:"sap-icon://warning2",title:s._oTextsModel.getResourceBundle().getText("WARNING"),state:"Error",type:"Message",content:[new sap.m.Text({text:s._oTextsModel.getResourceBundle().getText("DELETE_ALL_CONFIGURATIONS")})],beginButton:new sap.m.Button({text:s._oTextsModel.getResourceBundle().getText("OK"),press:function(){t.busyIndicator.open()&&t.getView().setBusy(true);s.deleteMaster()}}),endButton:new sap.m.Button({text:s._oTextsModel.getResourceBundle().getText("CANCEL"),press:function(){this.getParent().close()}})});this.confirmDialog.open()},deleteMaster:function(){var t=this;var m=this.getView().getModel("SB_DDACONFIG").getData();this.busyIndicator.open()&&this.getView().setBusy(true);var s=sap.suite.smartbusiness.ddaconfig.DrilldownSaveService;s.saveEvalConfiguration(this.evaluationId,m,"delete",function(){jQuery.sap.log.info("Deleted master configuration for the evaluation");t.busyIndicator.close()&&t.getView().setBusy(false);sap.m.MessageToast.show(t._oTextsModel.getResourceBundle().getText("EVAL_CONFIG_DELETE_SUCCESS"));t.confirmDialog.close();t.DDA_MODEL.removeAllViews();t.DDA_MODEL.setViewId("");t.bindUiToModel();t._oModel=t.DDA_MODEL.getModelDataForDDAConfiguration();t.refreshChart();t.getView().getModel().refresh()},function(e){jQuery.sap.log.error(e+" failed");t.busyIndicator.close()&&t.getView().setBusy(false);sap.suite.smartbusiness.utils.showErrorMessage(t._oTextsModel.getResourceBundle().getText("DELETE_ERROR"))})},onViewSwitch:function(e){var k=e.getParameter("selectedKey");this.viewId=k;this.DDA_MODEL.setViewId(this.viewId);this._oModel=this.DDA_MODEL.getModelDataForDDAConfiguration();this.bindUiToModel();this.refreshChart()},updateHeaderFooterOptions:function(p){this.setBtnEnabled("Paste",p)},checkEvaluationForPaste:function(){var c=this.EVALUATION.evaluationData;var a=this.getView().getModel("SB_DDACONFIG").getData();if((this.copyClipboard.evaluationData.ID==c.ID)||this.checkEvaluationForPaste1()){this.updateHeaderFooterOptions(false)}else{this.updateHeaderFooterOptions(true)}},checkEvaluationForPaste1:function(){var b=this.copyClipboard.masterData;var d={};var f={};if(this.getView().getModel("SB_DDACONFIG").getData().ALL_MEASURES.length){if(this.getView().getModel("SB_DDACONFIG").getData().ALL_MEASURES.length==1){d[this.getView().getModel("SB_DDACONFIG").getData().ALL_MEASURES[0]]="M"}else{d=this.getView().getModel("SB_DDACONFIG").getData().ALL_MEASURES.reduce(function(p,c,i,a){d=d||{};if(i==1){d[a[0]]="M"}d[a[i]]="M";return d})}}if(this.getView().getModel("SB_DDACONFIG").getData().ALL_DIMENSIONS.length){if(this.getView().getModel("SB_DDACONFIG").getData().ALL_DIMENSIONS.length==1){f[this.getView().getModel("SB_DDACONFIG").getData().ALL_DIMENSIONS[0]]="D"}else{f=this.getView().getModel("SB_DDACONFIG").getData().ALL_DIMENSIONS.reduce(function(p,c,i,a){f=f||{};if(i==1){f[a[0]]="D"}f[a[i]]="D";return f})}}var g=null;this.diffHeaders=[];for(var i=0,l=b.FILTERS.length;i<l;i++){delete b.FILTERS[i].__metadata;if(f[b.FILTERS[i].DIMENSION]!="D"){if(g==null){g={}}if(g.DIMENSIONS==undefined){g.DIMENSIONS={}}if(g.DIMENSIONS[b.FILTERS[i].DIMENSION]==undefined){g.DIMENSIONS[b.FILTERS[i].DIMENSION]=[]}b.FILTERS[i].entityType="FILTER";g.DIMENSIONS[b.FILTERS[i].DIMENSION].push(b.FILTERS[i])}}for(var i=0,l=b.CHART.length;i<l;i++){delete b.CHART[i].__metadata;if(b.CHART[i].THRESHOLD_MEASURE){if(d[b.CHART[i].THRESHOLD_MEASURE]!="M"){if(g==null){g={}}if(g.MEASURES==undefined){g.MEASURES={}}if(g.MEASURES[b.CHART[i].THRESHOLD_MEASURE]==undefined){g.MEASURES[b.CHART[i].THRESHOLD_MEASURE]=[]}b.CHART[i].entityType="THRESHOLD_MEASURE";g.MEASURES[b.CHART[i].THRESHOLD_MEASURE].push(b.CHART[i])}}}for(var i=0,l=b.COLUMNS.length;i<l;i++){delete b.COLUMNS[i].__metadata;var h=null;var k=null;if(b.COLUMNS[i].TYPE=="MEASURE"){if((d[b.COLUMNS[i].NAME]!="M")){if(g==null){g={}}if(g.MEASURES==undefined){g.MEASURES={}}if(g.MEASURES[b.COLUMNS[i].NAME]==undefined){g.MEASURES[b.COLUMNS[i].NAME]=[]}b.COLUMNS[i].entityType="MEASURE";g.MEASURES[b.COLUMNS[i].NAME].push(b.COLUMNS[i])}if((d[b.COLUMNS[i].SORT_BY]!="M")){if(g==null){g={}}if(g.MEASURES==undefined){g.MEASURES={}}if(g.MEASURES[b.COLUMNS[i].SORT_BY]==undefined){g.MEASURES[b.COLUMNS[i].SORT_BY]=[]}h=jQuery.extend(true,{},b.COLUMNS[i],{});h.entityType="SORT_BY";g.MEASURES[b.COLUMNS[i].SORT_BY].push(h)}}else if(b.COLUMNS[i].TYPE=="DIMENSION"){if((f[b.COLUMNS[i].NAME]!="D")){if(g==null){g={}}if(g.DIMENSIONS==undefined){g.DIMENSIONS={}}if(g.DIMENSIONS[b.COLUMNS[i].NAME]==undefined){g.DIMENSIONS[b.COLUMNS[i].NAME]=[]}b.COLUMNS[i].entityType="DIMENSION";g.DIMENSIONS[b.COLUMNS[i].NAME].push(b.COLUMNS[i])}if((f[b.COLUMNS[i].SORT_BY]!="D")){if(g==null){g={}}if(g.DIMENSIONS==undefined){g.DIMENSIONS={}}if(g.DIMENSIONS[b.COLUMNS[i].SORT_BY]==undefined){g.DIMENSIONS[b.COLUMNS[i].SORT_BY]=[]}k=jQuery.extend(true,{},b.COLUMNS[i],{});k.entityType="SORT_BY";g.DIMENSIONS[b.COLUMNS[i].SORT_BY].push(k)}}}for(var i=0,l=b.HEADER.length;i<l;i++){if(b.HEADER[i].EVALUATION_ID!==b.HEADER[i].REFERENCE_EVALUATION_ID){this.diffHeaders.push(b.HEADER[i])}else{if((b.HEADER[i].VISUALIZATION_TYPE!="NT")&&(b.HEADER[i].VISUALIZATION_TYPE!="AT")){if((b.HEADER[i].VISUALIZATION_TYPE==="CM")){var n=undefined;try{n=JSON.parse(JSON.parse(b.HEADER[i].CONFIGURATION).MEASURES)}catch(e){throw new Error("Failed to parse multiple measures of Comparison Chart Multiple Measures")}for(var j=0,m=n.length;i<m;i++){if(d[n[j]["name"]]!="M"){b.HEADER[i].entityType="HEADERS";if(g==null){g={}}if(g.MEASURES==undefined){g.MEASURES={}}if(g.MEASURES[n[j]["name"]]==undefined){g.MEASURES[n[j]["name"]]=[]}g.MEASURES[n[j]["name"]].push(b.HEADER[i]);break}}}else{if(f[b.HEADER[i].DIMENSION]!="D"){b.HEADER[i].entityType="HEADERS";if(g==null){g={}}if(g.DIMENSIONS==undefined){g.DIMENSIONS={}}if(g.DIMENSIONS[b.HEADER[i].DIMENSION]==undefined){g.DIMENSIONS[b.HEADER[i].DIMENSION]=[]}g.DIMENSIONS[b.HEADER[i].DIMENSION].push(b.HEADER[i])}}}}}return g},copyEvaluationToClipboard:function(){var t=this;var c=function(){t.copyClipboard={};t.copyClipboard.MasterData=t.getView().getModel("SB_DDACONFIG").getData();t.copyClipboard.masterData=sap.suite.smartbusiness.ddaconfig.MasterData;t.copyClipboard.evaluationData=t.EVALUATION.evaluationData;sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("COPY_DDA_TO_CLIPBOARD",t.EVALUATION.evaluationData.TITLE||(t.EVALUATION.evaluationData.ID+"*")));t.updateHeaderFooterOptions(false)};if(sap.suite.smartbusiness.ddaconfig.MasterData.HEADER&&sap.suite.smartbusiness.ddaconfig.MasterData.HEADER.length){var d=[];for(var i=0,l=sap.suite.smartbusiness.ddaconfig.MasterData.HEADER.length;i<l;i++){if(sap.suite.smartbusiness.ddaconfig.MasterData.HEADER[i].EVALUATION_ID!=sap.suite.smartbusiness.ddaconfig.MasterData.HEADER[i].REFERENCE_EVALUATION_ID){d.push(sap.suite.smartbusiness.ddaconfig.MasterData.HEADER[i])}}if(d&&d.length){t.warnDialog=t.warnDialog||new sap.m.Dialog({icon:"sap-icon://warning2",title:t.oApplicationFacade.getResourceBundle().getText("WARNING"),state:"Warning",type:"Message",content:[new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText("RELATED_KPIS_HEADER_TILES_EXIST_WARN")})],beginButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("CONTINUE"),press:function(){t.warnDialog.close();c()}})});t.warnDialog.open()}else{c()}}else{c()}},copyDDAConfiguration:function(){var t=this;if(this.copyClipboard&&this.copyClipboard.evaluationData){var p={sourceEvaluationId:this.copyClipboard.evaluationData.ID,targetEvaluationId:this.EVALUATION.evaluationData.ID};var c=function(){sap.suite.smartbusiness.utils.create(sap.suite.smartbusiness.utils.serviceUrl("COPY_DDA_CONFIGURATION_SERVICE_URI"),p,null,function(d){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("DDA_COPY_SUCCESS"));t.getView().getModel().refresh();var e={getParameter:function(a){var b={name:"detail",arguments:{contextPath:"EVALUATIONS_DDA('"+t.evaluationId+"')"}};return b[a]}};t.onRoutePatternMatched(e)},function(e){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("DDA_COPY_ERROR"),e.responseText)})};if(sap.suite.smartbusiness&&sap.suite.smartbusiness.ddaconfig&&sap.suite.smartbusiness.ddaconfig&&sap.suite.smartbusiness.ddaconfig.MasterData&&sap.suite.smartbusiness.ddaconfig.MasterData.MASTER&&sap.suite.smartbusiness.ddaconfig.MasterData.MASTER.length){this.warnOverwriteDialog=this.warnOverwriteDialog||new sap.m.Dialog({icon:"sap-icon://warning2",title:t.oApplicationFacade.getResourceBundle().getText("WARNING"),state:"Warning",type:"Message",content:[new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText("DDA_CONFIG_EXISTING_WARN")})],beginButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("CONTINUE"),press:function(){t.warnOverwriteDialog.close();c()}}),endButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("CANCEL"),press:function(){t.warnOverwriteDialog.close()}})});this.warnOverwriteDialog.open()}else{c()}}},checkForCopy:function(){if(sap.suite.smartbusiness.ddaconfig&&sap.suite.smartbusiness.ddaconfig.MasterData&&sap.suite.smartbusiness.ddaconfig.MasterData.MASTER&&sap.suite.smartbusiness.ddaconfig.MasterData.MASTER.length){this.setBtnEnabled("Copy",true)}else{this.setBtnEnabled("Copy",false)}},onAfterRendering:function(){this.setBtnEnabled("Paste",false);this.checkForCopy()}})};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.drilldown.view.configurator.controller')){jQuery.sap.declare('sap.suite.ui.smartbusiness.designtime.drilldown.view.configurator.controller');sap.ui.getCore().loadLibrary("sap.suite.ui.commons");jQuery.sap.require('sap.ca.scfld.md.controller.BaseDetailController');jQuery.sap.require('sap.m.MessageBox');sap.ca.scfld.md.controller.BaseDetailController.extend("sap.suite.ui.smartbusiness.designtime.drilldown.view.configurator",{onInit:function(){this.DDA_MODEL=null;this.evaluationId=null;this.viewId=null;this.ddaFilter=this.byId("ddaFilter");try{if(sap.ui.core.Fragment.byId("addTileDialog","addTileDialog")){sap.ui.core.Fragment.byId("addTileDialog","addTileDialog").destroy()}if(sap.ui.core.Fragment.byId("addRelatedTilesDialog","evaluationTilesList")){sap.ui.core.Fragment.byId("addRelatedTilesDialog","evaluationTilesList").getParent().destroy()}if(sap.ui.core.Fragment.byId("configureTileDialog","multipleMeasureDialog")){sap.ui.core.Fragment.byId("configureTileDialog","multipleMeasureDialog").destroy()}}catch(e){}this._addTileDialog=sap.ui.xmlfragment("addTileDialog","sap.suite.ui.smartbusiness.designtime.drilldown.view.addTileDialog",this);this._addRelatedTilesDialog=sap.ui.xmlfragment("addRelatedTilesDialog","sap.suite.ui.smartbusiness.designtime.drilldown.view.addRelatedTilesDialog",this);this._configureTileDialog=sap.ui.xmlfragment("configureTileDialog","sap.suite.ui.smartbusiness.designtime.drilldown.view.multipleMeasureDialog",this);this.initializeTileHeader();this.initializeAddTileDialog();this.defineHeaderFooterOptions();this.oRouter.attachRoutePatternMatched(this.onRoutePatternMatched,this);this.viewsReordered=false;this.busyIndicator=new sap.m.BusyDialog();var h=this.byId("headerRibbon");this.HeaderRibbonModel=new sap.ui.model.json.JSONModel();h.setModel(this.HeaderRibbonModel);var s=this;window.onbeforeunload=function(){return s._oTextsModel.getResourceBundle().getText("ARE_YOU_SURE")}},leftArrowAction:function(){var t=this;var i,a;var h=t.getView().getModel("SB_DDACONFIG").getData().HEADERS_VISIBLE;var v=t.byId("tileContainer").getAggregation("scrollContainer").getAggregation("content");try{var s=this._getSelectedTile().tile.getBindingContext("SB_DDACONFIG").getObject()}catch(e){s=null}for(i=0;i<h.length;i++){if(h[i]==s){a=h.splice(i,1);h.splice(i-1,0,a[0]);break}}t.getView().getModel("SB_DDACONFIG").setProperty("/HEADERS_VISIBLE",h);t.getView().getModel("SB_DDACONFIG").updateBindings();t._setSelectedTile(t._getSelectedTile().index-1)},rightArrowAction:function(){var t=this;var i,a;var h=t.getView().getModel("SB_DDACONFIG").getData().HEADERS_VISIBLE;var v=t.byId("tileContainer").getAggregation("scrollContainer").getAggregation("content");try{var s=this._getSelectedTile().tile.getBindingContext("SB_DDACONFIG").getObject()}catch(e){s=null}for(i=0;i<h.length;i++){if(h[i]==s){a=h.splice(i,1);h.splice(i+1,0,a[0]);break}}t.getView().getModel("SB_DDACONFIG").setProperty("/HEADERS_VISIBLE",h);t.getView().getModel("SB_DDACONFIG").updateBindings();t._setSelectedTile(t._getSelectedTile().index+1)},selectedTilesFormatter:function(c,a){var b="";var t={NT:"Numeric",CT:"Comparison",AT:"Bullet",TT:"Trend"};a.forEach(function(s){if(s.REFERENCE_EVALUATION_ID==c&&s.visible)b+=t[s.VISUALIZATION_TYPE]+", "});return b?"Selected: "+b.replace(/, $/g,""):""},_cloneObj:function(e){var t;if(e instanceof Array){t=[];for(var i=0;i<e.length;i++){t[i]=this._cloneObj(e[i])}}else if(e instanceof Object){t={};for(var a in e){if(e.hasOwnProperty(a)){t[a]=this._cloneObj(e[a])}}}else{t=e}return t},takeConfigSnapShot:function(){this._configSnapShot=this._cloneObj(this.getView().getModel("SB_DDACONFIG").getData())},restoreFromConfigSnapShot:function(){this.getView().getModel("SB_DDACONFIG").setData(this._configSnapShot)},bindUiToModel:function(){this.DDA_MODEL.bindModel(this.getView(),"SB_DDACONFIG");this.DDA_MODEL.bindModel(this._addTileDialog,"SB_DDACONFIG");this.DDA_MODEL.bindModel(this._addRelatedTilesDialog,"SB_DDACONFIG");this.DDA_MODEL.bindModel(this._configureTileDialog,"SB_DDACONFIG")},onRoutePatternMatched:function(E){var t=this;if(E.getParameter("name")==="configurator"){try{var a=E.getParameter("arguments")["evaluationId"];var v=E.getParameter("arguments")["viewId"];if(t.oApplicationFacade.__newViewAdded&&t.oApplicationFacade.createdViewId){v=t.oApplicationFacade.createdViewId;t.oApplicationFacade.createdViewId=null;t.oApplicationFacade.__newViewAdded=false;window.location.replace(window.location.hash.substring(0,window.location.hash.lastIndexOf("/"))+"/"+v)}t.oApplicationFacade.createdViewId=null;t.oApplicationFacade.__newViewAdded=false;t._setSelectedTile(-1);if(a!==this.evaluationId){this.evaluationId=a;this.DDA_MODEL=sap.suite.smartbusiness.ddaconfig.Model.getInstance(this.evaluationId,true,this.getView().getModel("i18n"));this.EVALUATION=sap.suite.smartbusiness.kpi.parseEvaluation(this.DDA_MODEL.EVALUATION_DATA);var n=this.DDA_MODEL.NEW_VIEWID;if(!v){v=this.DDA_MODEL.getConfigurator().getDefaultViewId()}this._oTextsModel=this.getView().getModel("i18n");this._addTileDialog.setModel(this._oTextsModel,"i18n");this._addRelatedTilesDialog.setModel(this._oTextsModel,"i18n");this._configureTileDialog.setModel(this._oTextsModel,"i18n");if(v!=null){this.viewId=v;this.DDA_MODEL.setViewId(v)}else{this.viewId=n}this.bindUiToModel();this.ddaFilter.setEvaluationData(this.EVALUATION);this.ddaFilter.setEvaluationId(this.evaluationId);var f=[];this.getView().getModel("SB_DDACONFIG").getProperty("/FILTERS").forEach(function(s){f.push(s.name)});this.ddaFilter.setDimensions(f);try{this.ddaFilter.rerender()}catch(e){}}else{if(this.viewId==n&&this.getView().getModel("SB_DDACONFIG").getProperty("/ID")!=n){}}this.INIT_COUNT_HEADERS=function(){h=t.getView().getModel("SB_DDACONFIG").getData()["HEADERS"];var c=0;for(var i=0;i<h.length;++i){if(h[i]["visible"]==true)++c}return c}();this.INIT_COUNT_FILTERS=this.getView().getModel("SB_DDACONFIG").getData()["FILTERS"].length;if(!this.init_filters){this.init_filters=[];this.getView().getModel("SB_DDACONFIG").getData()["FILTERS"].forEach(function(x){t.init_filters.push(x.name)})}this._oModel=this.getView().getModel("SB_DDACONFIG").getData();this.refreshChart();this.fetchAndRenderHeaderRibbon();this.displayAggregate()}catch(e){sap.suite.smartbusiness.utils.showErrorMessage(this.oApplicationFacade.getResourceBundle().getText("FAILED_TO_LOAD_ODATA"),e.message)}}},changeViewOrder:function(){var t=this;new sap.suite.ui.smartbusiness.lib.ListPersona({view:this.getView(),context:'/ALL_VIEWS',listItemContext:'TITLE',namedModel:'SB_DDACONFIG',callback:function(){var c=t.DDA_MODEL.selectedView.getId();t.byId('chartToolbar')._oFirstDimensionSelect.setSelectedItem(t.byId('chartToolbar')._oFirstDimensionSelect.getItemByKey(c));t.viewsReordered=true}}).start()},SaveConfig:function(){var s=this;this.warn_header=false;var m=this.getView().getModel("SB_DDACONFIG").getData();m.CURRENT_FILTERS=this.getView().byId("ddaFilter").getActiveDimensions();var a=sap.suite.smartbusiness.ddaconfig.DrilldownSaveService;if(m.ALL_VIEWS.length>0){this.busyIndicator.open()&&this.getView().setBusy(true);a.saveEvalConfiguration(this.evaluationId,m,"update",function(){jQuery.sap.log.info("all calls success");s.busyIndicator.close()&&s.getView().setBusy(false);sap.m.MessageToast.show(s._oTextsModel.getResourceBundle().getText("EVAL_CONFIG_SAVE_SUCCESS"));s.oRouter.navTo("detail",{"contextPath":"EVALUATIONS_DDA('"+s.evaluationId+"')"});s.oApplicationFacade.__refreshModel=1},function(e){jQuery.sap.log.error(e+" failed");s.busyIndicator.close()&&s.getView().setBusy(false);sap.suite.smartbusiness.utils.showErrorMessage(s._oTextsModel.getResourceBundle().getText("SAVE_ERROR"))})}else{sap.suite.smartbusiness.utils.showErrorMessage(s._oTextsModel.getResourceBundle().getText("SAVE_ERROR_NO_VIEW_CONFIGURED"));jQuery.sap.log.error("No Views Configured. Please configure Views before adding filters/headers")}},defineHeaderFooterOptions:function(){var t=this;this.oHeaderFooterOptions={onBack:function(){var s=t;new sap.m.Dialog({icon:"sap-icon://warning2",title:s._oTextsModel.getResourceBundle().getText("WARNING"),state:"Error",type:"Message",content:[new sap.m.Text({text:s._oTextsModel.getResourceBundle().getText("ARE_YOU_SURE")})],beginButton:new sap.m.Button({text:s._oTextsModel.getResourceBundle().getText("OK"),press:function(){s.evaluationId=null;this.getParent().close();window.history.back()}}),endButton:new sap.m.Button({text:s._oTextsModel.getResourceBundle().getText("CANCEL"),press:function(){this.getParent().close()}})}).open()},sI18NDetailTitle:"SB_GENERIC_DRILLDOWN",bSuppressBookmarkButton:true,buttonList:[{sI18nBtnTxt:"Save",onBtnPressed:function(e){jQuery.sap.log.info("Save button pressed");t.SaveConfig()},},{sId:"Delete",sI18nBtnTxt:"Delete",onBtnPressed:function(e){new sap.m.Dialog({icon:"sap-icon://warning2",title:t._oTextsModel.getResourceBundle().getText("WARNING"),state:"Error",type:"Message",content:[new sap.m.Text({text:t._oTextsModel.getResourceBundle().getText("DELETE_ALL_CONFIGURATIONS")})],beginButton:new sap.m.Button({text:t._oTextsModel.getResourceBundle().getText("OK"),press:function(){this.getParent().close();t.busyIndicator.open()&&t.getView().setBusy(true);t.deleteMaster()}}),endButton:new sap.m.Button({text:t._oTextsModel.getResourceBundle().getText("CANCEL"),press:function(){this.getParent().close()}})}).open()}},{sId:"cancel",sI18nBtnTxt:"Cancel",onBtnPressed:function(e){var s=t;new sap.m.Dialog({icon:"sap-icon://warning2",title:s._oTextsModel.getResourceBundle().getText("WARNING"),state:"Error",type:"Message",content:[new sap.m.Text({text:s._oTextsModel.getResourceBundle().getText("ARE_YOU_SURE")})],beginButton:new sap.m.Button({text:s._oTextsModel.getResourceBundle().getText("OK"),press:function(){this.getParent().close();s.evaluationId=null;window.history.back()}}),endButton:new sap.m.Button({text:s._oTextsModel.getResourceBundle().getText("CANCEL"),press:function(){this.getParent().close()}})}).open()}},]}},getHeaderFooterOptions:function(){return this.oHeaderFooterOptions},onBeforeRendering:function(){},navigateToConfigureChart:function(){var r={evaluationId:this.evaluationId,viewId:this.viewId+""};this.evaluationId=null;this.oRouter.navTo('configureChart',r)},onAddView:function(){var s=this;var c=this.getView().byId("ddaFilter").getActiveDimensions();if(this.warn_header||String(this.init_filters)!=String(c)){new sap.m.Dialog({icon:"sap-icon://warning2",title:s._oTextsModel.getResourceBundle().getText("WARNING"),state:"Error",type:"Message",content:[new sap.m.Text({text:s._oTextsModel.getResourceBundle().getText("ARE_YOU_SURE")})],beginButton:new sap.m.Button({text:s._oTextsModel.getResourceBundle().getText("OK"),press:function(){s.warn_header=false;s.viewId=s.DDA_MODEL.NEW_VIEWID;s.DDA_MODEL.setViewId(s.viewId);s.bindUiToModel();this.getParent().close();s.navigateToConfigureChart()}}),endButton:new sap.m.Button({text:s._oTextsModel.getResourceBundle().getText("CANCEL"),press:function(){this.getParent().close()}})}).open()}else{this.viewId=this.DDA_MODEL.NEW_VIEWID;this.DDA_MODEL.setViewId(this.viewId);this.bindUiToModel();this.navigateToConfigureChart()}},onEditView:function(){var s=this;var c=this.getView().byId("ddaFilter").getActiveDimensions();if(this.warn_header||String(this.init_filters)!=String(c)){new sap.m.Dialog({icon:"sap-icon://warning2",title:s._oTextsModel.getResourceBundle().getText("WARNING"),state:"Error",type:"Message",content:[new sap.m.Text({text:s._oTextsModel.getResourceBundle().getText("ARE_YOU_SURE")})],beginButton:new sap.m.Button({text:s._oTextsModel.getResourceBundle().getText("OK"),press:function(){s.warn_header=false;this.getParent().close();s.navigateToConfigureChart()}}),endButton:new sap.m.Button({text:s._oTextsModel.getResourceBundle().getText("CANCEL"),press:function(){this.getParent().close()}})}).open()}else{this.navigateToConfigureChart()}},tileTypeMapping:{NT:"Numeric",AT:"Bullet",CT:"Comparison",TT:"AreaChart",CM:"MeasureComparison"},_getSelectedTile:function(){var t=this.byId("tileContainer").getItems()||[];return{tile:t[this._selectedTileIndex],index:this._selectedTileIndex}},_setSelectedTile:function(i){this._selectedTileIndex=i;var t=this.byId("tileContainer").getItems()||[];for(j=0;j<t.length;j++){t[j].getTileControl().removeStyleClass("mySelectedStyle")}this.byId("deleteTile").setEnabled(i!=-1);if(i!=-1){t[i].getTileControl().addStyleClass("mySelectedStyle")}this.byId("leftMoveArrow").setEnabled((i!=-1)&&i!=0);this.byId("rightMoveArrow").setEnabled((i!=-1)&&i!=t.length-1)},deleteTile:function(){var t=this;var c=new sap.m.Dialog({title:"Delete",type:"Message",content:[new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText("DELETE_CONFIRMATION")})],beginButton:new sap.m.Button({text:"Ok",press:function(e){c.close();var a=t._getSelectedTile().tile;var v=a.getModel("SB_DDACONFIG").getData().HEADERS_VISIBLE;v.splice(t._getSelectedTile().index,1);t._setSelectedTile(-1);t.refreshTileBindings()}}),endButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("CANCEL"),press:function(){c.close()}})});c.open()},initializeTileHeader:function(){var t=this;var a=this.byId("tileContainer");a.bindAggregation("items",{path:"SB_DDACONFIG>/HEADERS_VISIBLE",factory:function(i,b){var c=b.getProperty("VISUALIZATION_TYPE");return new sap.suite.ui.smartbusiness.tiles[t.tileTypeMapping[c]]({evaluationId:t.evaluationId,mode:"DUMMY",header:"{SB_DDACONFIG>TITLE}",subheader:"{SB_DDACONFIG>SUBTITLE}"}).addStyleClass("drilldownKpiTiles").attachBrowserEvent("click",function(e){var v=this.getParent().getAggregation("content");t._setSelectedTile(v.indexOf(this))})},})},initializeAddTileDialog:function(){var t=this;this._tileEvaluationList=sap.ui.core.Fragment.byId("addRelatedTilesDialog","evaluationTilesList");var a={NT:"NUMBER_TILE",AT:"ACTUAL_VS_TARGET_TILE",CT:"COMPARISON_TILE",TT:"TREND_TILE",CM:"COMPARISON_MM_TILE"};var b=new sap.ui.model.Sorter('SB_DDACONFIG>GROUPING_TITLE',false,function(C){return C.getProperty('GROUPING_TITLE')});var c=new sap.ui.model.Sorter('SB_DDACONFIG>VISUALIZATION_TYPE_INDEX',false);this._tileEvaluationList.bindAggregation("items",{path:"SB_DDACONFIG>/HEADERS",factory:function(i,B){var d=B.getProperty("VISUALIZATION_TYPE");var m=new sap.suite.ui.smartbusiness.tiles[t.tileTypeMapping[d]]({evaluationId:t.evaluationId,mode:"DUMMY",header:"TITLE",subheader:"SUBTITLE",contentOnly:true});var f=new sap.suite.ui.smartbusiness.tiles[t.tileTypeMapping[d]]({evaluationId:t.evaluationId,mode:"DUMMY",header:"TITLE",subheader:"SUBTITLE",contentOnly:true});var g=new sap.m.HBox({justifyContent:"Start",width:"98%",items:[m,new sap.m.Label({text:{path:"SB_DDACONFIG>VISUALIZATION_TYPE",formatter:function(s){return t._oTextsModel.getResourceBundle().getText(a[s])}}})]});return new sap.m.CustomListItem({type:(d=='NT'||d=='AT')?'Active':'Navigation',press:function(){var o=this.getBindingContext('SB_DDACONFIG').getObject();o['visible']=true;if(o.VISUALIZATION_TYPE=='NT'||o.VISUALIZATION_TYPE=='AT'){t.getView().getModel("SB_DDACONFIG").getData().HEADERS_VISIBLE.push(t._cloneObj(o));t.onAddTileOk();t.refreshTileBindings()}else{t._addRelatedTilesDialog.close();try{var h=o.VISUALIZATION_TYPE=='CM'?1:0;t._configureTileDialog.getContent()[h].getItems()[1].removeAllContent();t._configureTileDialog.getContent()[h].getItems()[1].addContent(f)}catch(e){}t._configureTileDialog.bindElement('SB_DDACONFIG>'+this.getBindingContextPath());t._configureTileDialog.open();var I=t.getView().getModel("i18n");var j=new sap.ui.core.Item({key:"_none^",text:I.getResourceBundle().getText("SELECT_NONE"),});if(!sap.ui.core.Fragment.byId("configureTileDialog","measuresForTile3").getItemByKey("_none^"))sap.ui.core.Fragment.byId("configureTileDialog","measuresForTile3").insertItem(j,"0")}},content:[new sap.m.HBox({justifyContent:"SpaceAround",items:[g]})]})},sorter:[b,c]})},onMiniChartConfigureOk:function(){var b=this._configureTileDialog.getBindingContext("SB_DDACONFIG").getObject();b['visible']=true;this.getView().getModel("SB_DDACONFIG").getData().HEADERS_VISIBLE.push(this._cloneObj(b));this.onAddTileOk();this.refreshTileBindings()},showConfigureTileMeasure:function(v){return v!='CT'&&v!='TT'},showConfigureTileDimension:function(v){return v=='CT'||v=='TT'},showConfigureTileSortOrder:function(v){return v=='CT'},showThirdMeasure:function(v){return!!v},refreshTileBindings:function(){try{var t=this.byId("tileContainer");t.getModel("SB_DDACONFIG").refresh()}catch(e){}},_refreshEvaluationsBinding:function(){},onAddTileOk:function(E){this.takeConfigSnapShot();this._setSelectedTile(-1);this.refreshTileBindings();try{this._configureTileDialog.close();this._addRelatedTilesDialog.close()}catch(e){}this._refreshEvaluationsBinding();this.warn_header=true},onAddTileCancel:function(E){this.restoreFromConfigSnapShot();this._setSelectedTile(-1);this.refreshTileBindings();try{this._configureTileDialog.close();this._addRelatedTilesDialog.close()}catch(e){}this._refreshEvaluationsBinding()},_getEvalData:function(i){try{var a=sap.suite.smartbusiness.kpi.getEvaluationById({id:i,cache:true,filters:false,thresholds:false,getDDAEvaluation:true});return a}catch(e){return{}}},createTileMenuForCurrentEvaluation:function(a){var t=this;var b=['NT','AT','CT','TT','CM'];function _(I){try{var k=t._getEvalData(I);return sap.suite.smartbusiness.odata.getAllDimensions(k.ODATA_URL,k.ODATA_ENTITYSET)}catch(e){return[]}}function c(I){try{var k=t._getEvalData(I);return sap.suite.smartbusiness.odata.getAllMeasures(k.ODATA_URL,k.ODATA_ENTITYSET)}catch(e){return[]}}function d(I){return t._getEvalData(I).INDICATOR_TITLE}function f(I){return t._getEvalData(I).TITLE}function g(I){return t._getEvalData(I).INDICATOR}var m=this.getView().getModel("SB_DDACONFIG");var h=c(a);if(!m.getProperty("/HEADER_EVALUATIONID")[a]){m.getProperty("/HEADER_EVALUATIONID")[a]=true;var i=m.getProperty("/HEADERS");for(var j in this.tileTypeMapping){i.push({EVALUATION_ID:this.evaluationId,CONFIGURATION_ID:this.viewId,REFERENCE_EVALUATION_ID:a,VISUALIZATION_TYPE:j,VISUALIZATION_TYPE_INDEX:b.indexOf(j),VISUALIZATION_ORDER:1,ALL_DIMENSIONS:_(a),DIMENSION:_(a)[0]||'',SORT_BY:'',SORT_ORDER:'MD',MEASURE1:h[0],MEASURE2:h[1]||h[0],MEASURE3:h[2]||"",COLOR1:"Good",COLOR2:"Critical",COLOR3:"Error",ALL_MEASURES:h,VISIBILITY:1,visible:false,TITLE:d(a),SUBTITLE:f(a),INDICATOR:g(a)})}}},openEvaluationsDialog:function(){this._addRelatedTilesDialog.open();sap.ui.core.Fragment.byId('addRelatedTilesDialog','showCurrentKpiEvals').firePress()},evaluationGroupTextFormatter:function(c){return{text:c.getProperty("GROUPING_TEXT"),key:c.getProperty("GROUPING_TEXT")}},relatedEvalGroupTextFormatter:function(c){var r=this.getView().getModel("i18n").getResourceBundle();return{text:(r.getText("KPI")+": "+c.getProperty("INDICATOR")),key:c.getProperty("INDICATOR")}},showCurrentKPIEvals:function(){var t=this;var m=this.getView().getModel('SB_DDACONFIG');var r=this.getView().getModel("i18n").getResourceBundle();if(!m.getProperty('/SIBLING_EVALUATIONS').length){var a=sap.suite.smartbusiness.kpi.getSiblingEvaluations({indicator:m.getProperty('/INDICATOR'),id:this.evaluationId,cache:false,filters:false,thresholds:false,getDDAEvaluation:true});a.forEach(function(s){t.createTileMenuForCurrentEvaluation(s.ID)});m.getData().SIBLING_EVALUATIONS=a;m.getData().HEADERS.forEach(function(s){var p=s.REFERENCE_EVALUATION_ID==s.EVALUATION_ID?'('+t._oTextsModel.getResourceBundle().getText('CURRENT_EVALUATION')+')':'';s.GROUPING_TITLE=p+s.TITLE+" "+s.SUBTITLE})}this.takeConfigSnapShot();var b=this._tileEvaluationList.getBinding("items");var c=this.getView().getModel("SB_DDACONFIG").getProperty("/INDICATOR");b.filter(new sap.ui.model.Filter("INDICATOR",sap.ui.model.FilterOperator.EQ,c));m.refresh()},showAssociatedEvals:function(){var t=this;var m=this.getView().getModel('SB_DDACONFIG');if(!m.getProperty('/ASSOCIATED_EVALUATIONS').length){m.getData().ASSOCIATED_EVALUATIONS=sap.suite.smartbusiness.kpi.getAssociatedEvaluations({indicator:m.getProperty('/INDICATOR'),id:this.evaluationId,cache:true});m.getData().ASSOCIATED_EVALUATIONS.forEach(function(s){t.createTileMenuForCurrentEvaluation(s.ID)});m.getData().HEADERS.forEach(function(s){s.GROUPING_TITLE=s.TITLE+" "+s.SUBTITLE})}this.takeConfigSnapShot();var b=this._tileEvaluationList.getBinding("items");var c=this.getView().getModel("SB_DDACONFIG").getProperty("/INDICATOR");b.filter(new sap.ui.model.Filter("INDICATOR",sap.ui.model.FilterOperator.NE,c));m.refresh()},refreshChart:function(){var c=this;var b=this.getView().byId("chartToolbar").getToolBar().getContentRight();if(b){if(b[0]&&(!(b[0].getVisible()))){b[0].setVisible(true)}if(b[1]&&(!(b[1].getVisible()))){b[1].setVisible(true)}if(b[3]&&(!(b[3].getVisible()))){b[3].setVisible(true)}if(b[0])b[0].firePress()}this.oChartDataModel=new sap.ui.model.json.JSONModel();this.oChartData=[];this.dda_chart=this.getView().byId("chartRef");this.dda_chart.setStackedChartWidthEnhancer(false);this.dda_table=this.getView().byId("chartTable");var t=this._oModel;this.dda_config={};this.dda_config.chartConfig={mode:t.DATA_MODE||"DUMMY",title:"",dataLimit:t.DATA_LIMIT||null,dataLimitations:t.DATA_LIMITATIONS||false,type:(t.CHART_TYPE).toUpperCase()||"BAR",axis:t.AXIS_TYPE||"SINGLE",value:t.VALUE_TYPE||"ABSOLUTE",colorScheme:t.COLOR_SCHEME||"NONE",thresholdMeasure:t.THRESHOLD_MEASURE||""};this.dda_config.columnsConfig=[];for(var i=0;i<t.COLUMNS.length;i++){this.dda_config.columnsConfig.push({name:t.COLUMNS[i].NAME,type:t.COLUMNS[i].TYPE,visibility:t.COLUMNS[i].VISIBILITY||"BOTH",sortOrder:t.COLUMNS[i].SORT_ORDER||"NONE",sortBy:t.COLUMNS[i].SORT_BY||"",axis:t.COLUMNS[i].AXIS||1,stacking:t.COLUMNS[i].STACKING||0,color:t.COLOR_SCHEME=="MANUAL_NON_SEMANTIC"?t.COLUMNS[i].COLOR1:t.COLOR_SCHEME=="MANUAL_SEMANTIC"?t.COLUMNS[i].COLOR2:""})}this.oColumns=[];this.oDimensions=[];this.oMeasures=[];this.dimNameArray=[];this.msrNameArray=[];this.chartDimensions=[];this.chartDimNames=[];this.chartMeasures=[];this.chartMsrNames=[];this.tableDimensions=[];this.tableDimNames=[];this.tableMeasures=[];this.tableMsrNames=[];for(var i=0;i<this.dda_config.columnsConfig.length;i++){this.oColumns.push(this.dda_config.columnsConfig[i]);if((this.dda_config.columnsConfig[i].type).toUpperCase()==="DIMENSION"){this.oDimensions.push(this.dda_config.columnsConfig[i]);this.dimNameArray.push(this.dda_config.columnsConfig[i].name);if(((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="CHART")||((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="BOTH")){this.chartDimensions.push(this.dda_config.columnsConfig[i]);this.chartDimNames.push(this.dda_config.columnsConfig[i].name)}if(((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="TABLE")||((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="BOTH")){this.tableDimensions.push(this.dda_config.columnsConfig[i]);this.tableDimNames.push(this.dda_config.columnsConfig[i].name)}}else if((this.dda_config.columnsConfig[i].type).toUpperCase()==="MEASURE"){this.oMeasures.push(this.dda_config.columnsConfig[i]);this.msrNameArray.push(this.dda_config.columnsConfig[i].name);if(((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="CHART")||((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="BOTH")){this.chartMeasures.push(this.dda_config.columnsConfig[i]);this.chartMsrNames.push(this.dda_config.columnsConfig[i].name)}if(((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="TABLE")||((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="BOTH")){this.tableMeasures.push(this.dda_config.columnsConfig[i]);this.tableMsrNames.push(this.dda_config.columnsConfig[i].name)}}}if((!(this.chartDimensions.length))||(!(this.chartMeasures.length))){this.dda_chart.setDataset(new sap.viz.core.FlattenedDataset({}));return}this.stacking=this.getStacking(this.chartMeasures,this.chartDimensions);this.isStackMsr=false;this.isStackDim=false;if(this.stacking.isEnabled&&(this.stacking.type=="M"))this.isStackMsr=true;else if(this.stacking.isEnabled&&(this.stacking.type=="D"))this.isStackDim=true;this.sapCaChartType=this.getSapCaChartType();this.dda_chart.setAdvancedChartSettings({plotArea:{animation:{dataLoading:false,dataUpdating:false,resizing:false}},legend:{title:{visible:false}}});if((this.dda_config.chartConfig.mode).toUpperCase()==="DUMMY"){this.oChartData=this.getDummyDataForChart(this.dimNameArray,this.msrNameArray);this.oChartDataModel.setData({businessData:c.oChartData})}else if((this.dda_config.chartConfig.mode).toUpperCase()==="RUNTIME"){this.getRuntimeChartData(this.dimNameArray,this.msrNameArray)}try{var p=sap.suite.smartbusiness.odata.properties(this._oModel.QUERY_SERVICE_URI,this._oModel.QUERY_ENTITY_SET)}catch(e){jQuery.sap.log.error("Failed to instantiate the odata model");throw e}this.column_labels_mapping=p.getLabelMappingObject();this.dimension_text_property_mapping=p.getTextPropertyMappingObject();this.measure_unit_property_mapping=p.getUnitPropertyMappingObject();if((this.sapCaChartType).toUpperCase()==="TABLE"){this.updateTable(this.tableDimensions,this.tableMeasures);if(b){if(b[0]){b[0].setVisible(false)}if(b[1]){b[1].setVisible(true)}if(b[3]){b[3].setVisible(false)}if(b[1]){b[1].firePress()}}return}if((((this.dda_config.chartConfig.type).toUpperCase()=="BAR")&&(this.dda_config.chartConfig.axis=="DUAL"))||(((this.dda_config.chartConfig.type).toUpperCase()=="COLUMN")&&(this.dda_config.chartConfig.axis=="DUAL"))){var a=false;var d=false;for(var i=0;i<this.chartMeasures.length;i++){if(this.chartMeasures[i].axis==1)a=true;else if(this.chartMeasures[i].axis==2)d=true}if(!(a)||!(d)){sap.m.MessageBox.alert(c._oTextsModel.getResourceBundle().getText("SELECT_MEASURE_FOR_AXIS",(a?2:1)));return}}if(((this.dda_config.chartConfig.type).toUpperCase()==="BUBBLE")&&(this.chartMeasures.length<3)){sap.m.MessageBox.alert(c._oTextsModel.getResourceBundle().getText("BUBBLE_CHART_MEASURE_COUNT"));return}this.dda_chart.setChartType(this.sapCaChartType);this.oDataset=this.create_Dataset(this.chartDimensions,this.chartMeasures);var f=this.dda_config.chartConfig.type;var g=this.dda_config.chartConfig.axis;var v=this.dda_config.chartConfig.value;var l=new sap.ui.core.Locale(sap.ui.getCore().getConfiguration().getLanguage());var h=sap.ca.ui.model.format.NumberFormat.getInstance({},l);if((f=='BAR')&&(v=="ABSOLUTE")){this.dda_chart.setXAxisLabelFormatter(this.formatChartNumbers.bind(this));this.dda_chart.setYAxisLabelFormatter(this.pseudoChartFormatter);if(g=='DUAL'){this.dda_chart.setXAxis2LabelFormatter(this.formatChartNumbers.bind(this))}}else if(f=='BUBBLE'){this.dda_chart.setXAxisLabelFormatter(this.formatChartNumbers.bind(this));this.dda_chart.setYAxisLabelFormatter(this.formatChartNumbers.bind(this))}else if(((f=='BAR')||(f=='COLUMN'))&&(v=='PERCENTAGE')){if(f=='BAR'){this.dda_chart.setXAxisLabelFormatter(function(r){return h.format_percentage(r)});this.dda_chart.setYAxisLabelFormatter(this.pseudoChartFormatter);if(g=='DUAL'){this.dda_chart.setXAxis2LabelFormatter(function(r){return h.format_percentage(r)})}}else{this.dda_chart.setYAxisLabelFormatter(function(r){return h.format_percentage(r)});this.dda_chart.setXAxisLabelFormatter(this.pseudoChartFormatter);if(g=='DUAL'){this.dda_chart.setYAxis2LabelFormatter(function(r){return h.format_percentage(r)})}}}else{this.dda_chart.setYAxisLabelFormatter(this.formatChartNumbers.bind(this));this.dda_chart.setXAxisLabelFormatter(this.pseudoChartFormatter);if((f=='COLUMN')&&(g=='DUAL')){this.dda_chart.setYAxis2LabelFormatter(this.formatChartNumbers.bind(this))}}this.dda_chart.setDataLabelFormatter([[this.formatChartNumbers.bind(this)]]);if(((f=='BAR')||(f=='COLUMN'))&&(v=='PERCENTAGE')){var j=[[],[],[]];for(var k=0;k<this.chartMsrNames.length;k++){j[0].push(c.getChartPercentFormatter(true));j[1].push(c.getChartPercentFormatter(true))}this.dda_chart.setPopoverFormatter(j)}this.dda_chart.setDataset(this.oDataset);this.dda_chart.setModel(this.oChartDataModel);this.showChartLegendIfApplicable(this.chartDimNames,this.chartMsrNames);if((this.dda_config.chartConfig.type=="BAR")||(this.dda_config.chartConfig.type=="COLUMN")||(this.dda_config.chartConfig.type=="COMBINATION")||(this.dda_config.chartConfig.type=="LINE")){if((this.dda_config.chartConfig.colorScheme).toUpperCase()==="AUTO_SEMANTIC"){var m=this.dda_config.chartConfig.thresholdMeasure||"";var n=[];var o=-1;for(var i=0;i<this.chartMeasures.length;i++){n.push({color:sap.ca.ui.charts.ChartSemanticColor.GoodLight});if(this.chartMeasures[i].name===m)o=i}if(o>=0)n[o].color=sap.ca.ui.charts.ChartSemanticColor.Neutral;this.applyCustomColoring(this.dda_chart,this.dda_config.chartConfig.colorScheme,n,m,this.DDA_MODEL.EVALUATION_DATA.GOAL_TYPE)}else if(((this.dda_config.chartConfig.colorScheme).toUpperCase()==="MANUAL_SEMANTIC")||((this.dda_config.chartConfig.colorScheme).toUpperCase()==="MANUAL_NON_SEMANTIC")){this.applyCustomColoring(this.dda_chart,this.dda_config.chartConfig.colorScheme,this.chartMeasures)}}this.updateTable(this.tableDimensions,this.tableMeasures)},getSapCaChartType:function(){var s=sap.ca.ui.charts.ChartType.Bar;var c=this.dda_config.chartConfig.type;var a=this.dda_config.chartConfig.axis;var v=this.dda_config.chartConfig.value;var b=(this.isStackMsr||(this.isStackDim&&(this.chartDimensions.length>1)))?true:false;switch(c){case"BAR":if(a==="SINGLE"){if(v==="ABSOLUTE"){if(b){s=sap.ca.ui.charts.ChartType.StackedBar}else{s=sap.ca.ui.charts.ChartType.Bar}}else if(v==="PERCENTAGE"){s=sap.ca.ui.charts.ChartType.StackedBar100}}else if(a==="DUAL"){if(v==="ABSOLUTE"){s=sap.ca.ui.charts.ChartType.DualStackedBar}else if(v==="PERCENTAGE"){s=sap.ca.ui.charts.ChartType.DualStackedBar100}}break;case"COLUMN":if(a==="SINGLE"){if(v==="ABSOLUTE"){if(b){s=sap.ca.ui.charts.ChartType.StackedColumn}else{s=sap.ca.ui.charts.ChartType.Column}}else if(v==="PERCENTAGE"){s=sap.ca.ui.charts.ChartType.StackedColumn100}}else if(a==="DUAL"){if(v==="ABSOLUTE"){s=sap.ca.ui.charts.ChartType.DualStackedColumn}else if(v==="PERCENTAGE"){s=sap.ca.ui.charts.ChartType.DualStackedColumn100}}break;case"LINE":s=sap.ca.ui.charts.ChartType.Line;break;case"COMBINATION":s=sap.ca.ui.charts.ChartType.Combination;break;case"BUBBLE":s=sap.ca.ui.charts.ChartType.Bubble;break;case"TABLE":s="TABLE";break;default:s=sap.ca.ui.charts.ChartType.Bar}return s},showChartLegendIfApplicable:function(d,m){var t=this;var o=this.getView().byId("chartToolbar");var c=this.dda_config.chartConfig.type;var i=(((c=="BAR")||(c=="COLUMN"))&&(this.isStackDim)&&(this.getDimensionToBeStacked(t.chartDimensions))&&(d.length>1))?true:false;if((m.length>1)||(i)){o.setShowLegend(true)}else{o.setShowLegend(false)}},getChartPercentFormatter:function(i){var l=new sap.ui.core.Locale(sap.ui.getCore().getConfiguration().getLanguage());function a(n){return!isNaN(parseFloat(n))&&isFinite(n)}var f={style:i?'standard':'short'};var c=sap.ca.ui.model.format.NumberFormat.getInstance(f,l);return function(s){return a(s)?c.format_percentage(s):s}},getStacking:function(m,d){var s={};s.isEnabled=false;s.type="none";for(var i=0;i<m.length;i++){if(m[i].stacking===1){s.isEnabled=true;s.type="M"}}if(!(s.isEnabled)){for(var i=0;i<d.length;i++){if(d[i].stacking===1){s.isEnabled=true;s.type="D"}}}return s},setStacking:function(a,t,c){var b=this;if(a){if(t=="M"){for(var i=0;i<c.length;i++){if((c[i].TYPE).toUpperCase()==="MEASURE"){c[i].STACKING=1}else if((c[i].TYPE).toUpperCase()==="DIMENSION"){c[i].STACKING=0}}}else if(t=="D"){for(var i=0;i<c.length;i++){if((c[i].TYPE).toUpperCase()==="MEASURE"){c[i].STACKING=0}else if((c[i].TYPE).toUpperCase()==="DIMENSION"){c[i].STACKING=1}}}}else{for(var i=0;i<c.length;i++){c[i].STACKING=0}}},getDimensionToBeStacked:function(d){var D=null;for(var i=0;i<d.length;i++){if(d[i].axis===2){D=d[i];break}}return D},setDimensionToBeStacked:function(c,s){if(s){for(var i=0;i<c.length;i++){if((c[i].TYPE).toUpperCase()==="DIMENSION"){c[i].AXIS=1;if(c[i].NAME===s){c[i].AXIS=2}}}}},updateColumnProperty:function(c,n,p,v){for(var i=0;i<c.length;i++){if(c[i].NAME===n){(c[i])[p]=v;break}}},getMeasuresByAxis:function(c){var d={};d.axis1={};d.axis1.objArr=[];d.axis1.nameArr=[];d.axis2={};d.axis2.objArr=[];d.axis2.nameArr=[];for(var i=0;i<c.length;i++){if(c[i].axis===1){d.axis1.objArr.push(c[i]);d.axis1.nameArr.push(c[i].name)}else if(c[i].axis===2){d.axis2.objArr.push(c[i]);d.axis2.nameArr.push(c[i].name)}}return d},create_Dataset:function(d,m){var c=this;var a=this.dda_config.chartConfig.type||"BAR";var b=this.dda_config.chartConfig.axis||"SINGLE";var v=this.dda_config.chartConfig.value||"ABSOLUTE";var s=this.isStackMsr;var e=this.getDimensionToBeStacked(d);var f=new sap.viz.core.FlattenedDataset({data:{path:"/businessData"}});for(var i=0;i<d.length;i++){var g=((this.dda_config.chartConfig.mode).toUpperCase()==="RUNTIME")?this.dimension_text_property_mapping[d[i].name]:d[i].name;var A=1;if(((a=="BAR")||(a=="COLUMN"))&&(this.isStackDim)&&(e)&&(g===e.name)&&(d.length>1)){A=2;this.dda_chart.setStackedChartWidthEnhancer(true)}var h=new sap.viz.ui5.data.DimensionDefinition({axis:A,value:"{"+g+"}",name:this.column_labels_mapping[d[i].name]||d[i].name});f.addDimension(h)}if((a=="LINE")||(a=="COMBINATION")||((a=="BAR")&&(b=="SINGLE"))||((a=="COLUMN")&&(b=="SINGLE"))){for(var i=0;i<m.length;i++){var g=m[i].name;var j=new sap.viz.ui5.data.MeasureDefinition({name:this.column_labels_mapping[g]||g,value:"{"+g+"}"});f.addMeasure(j)}}else if(a=="BUBBLE"){for(var i=0;i<3;i++){var g=m[i].name;var j=new sap.viz.ui5.data.MeasureDefinition({group:i+1,name:this.column_labels_mapping[g]||g,value:"{"+g+"}",});f.addMeasure(j)}}else if(((a=="BAR")&&(b=="DUAL"))||((a=="COLUMN")&&(b=="DUAL"))){for(var i=0;i<m.length;i++){var g=m[i].name;var k=(m[i].axis==1||m[i].axis==2)?m[i].axis:2;var j=new sap.viz.ui5.data.MeasureDefinition({group:k,name:this.column_labels_mapping[g]||g,value:"{"+g+"}"});f.addMeasure(j)}}return f},_getValueState:function(a,t){if(!this.EVALUATION.isTargetKpi()){if(a<t){return this.EVALUATION.isMaximizingKpi()?sap.ui.core.ValueState.Error:sap.ui.core.ValueState.Success}else if(a==t){return sap.ui.core.ValueState.None}else{return this.EVALUATION.isMaximizingKpi()?sap.ui.core.ValueState.Success:sap.ui.core.ValueState.Error}}else{return sap.ui.core.ValueState.None}},_getTableCell:function(o,t){var a=this;if(t&&(o!==t)){return new sap.m.ObjectNumber({number:{path:o},state:{parts:[{path:o},{path:t}],formatter:function(m,b){try{m=window.parseFloat(m);b=window.parseFloat(b);return a._getValueState(m,b)}catch(e){return sap.ui.core.ValueState.None}}}})}else{return new sap.m.Label({text:{path:o}})}},updateTable:function(d,m){this.dda_table.destroyColumns();this.dda_table.destroyItems();for(var i=0;i<d.length;i++){var v=d[i].name;var L=new sap.m.Label({text:this.column_labels_mapping[v]||v});var c=new sap.m.Column({hAlign:"Left",header:L,minScreenWidth:"Tablet",demandPopin:true,});this.dda_table.addColumn(c)}for(var i=0;i<m.length;i++){var v=m[i].name;var L=new sap.m.Label({text:this.column_labels_mapping[v]||v});var c=new sap.m.Column({hAlign:"Right",header:L,minScreenWidth:"Tablet",demandPopin:true,});this.dda_table.addColumn(c)}var t=new sap.m.ColumnListItem({unread:false,});for(var i=0;i<d.length;i++){var v=((this.dda_config.chartConfig.mode).toUpperCase()==="RUNTIME")?this.dimension_text_property_mapping[d[i].name]:d[i].name;var o=new sap.m.Label({text:"{"+v+"}"});t.addCell(o)}var a=this._oModel["THRESHOLD_MEASURE"];for(var i=0;i<m.length;i++){var v=m[i].name;if(this._oModel["COLOR_SCHEME"]=="AUTO_SEMANTIC")var o=this._getTableCell(v,a);else var o=this._getTableCell(v,v);t.addCell(o)}this.dda_table.setModel(this.oChartDataModel);this.dda_table.bindAggregation("items","/businessData",t)},applyCustomColoring:function(c,a,b,t,i){var C=this;if((a).toUpperCase()==="AUTO_SEMANTIC"){if(((i=="MA")||(i=="MI"))&&t){C.setCustomColors(c,b,a);c.setChartSemanticColorFormatter(function(o){var d=c.getModel().getData().businessData;var e=o.ctx.path.dii_a1;var f=d[e];var r=f[t];if(r!=null&&typeof r!='undefined'){if(o.val>r){if(i=="MA")return sap.ca.ui.charts.ChartSemanticColor.GoodLight;else if(i=="MI")return sap.ca.ui.charts.ChartSemanticColor.BadLight}else if(o.val<r){if(i=="MA")return sap.ca.ui.charts.ChartSemanticColor.BadLight;else if(i=="MI")return sap.ca.ui.charts.ChartSemanticColor.GoodLight}else{return sap.ca.ui.charts.ChartSemanticColor.Neutral}}else{jQuery.sap.log.error("Threshold Measure:'"+t+"' not in Dataset. Error Applying Semantic Color");return sap.ca.ui.charts.ChartSemanticColor.NeutralLight}})}else{jQuery.sap.log.error("Threshold Measure not available or Goal type is RA . Error Applying Semantic Color")}}else if(((a).toUpperCase()==="MANUAL_SEMANTIC")||((a).toUpperCase()==="MANUAL_NON_SEMANTIC")){C.setCustomColors(c,b,a)}},setCustomColors:function(c,m,a){var d=c.getDataset();var b=d.getMeasures();var e="";if((a).toUpperCase()==="AUTO_SEMANTIC"||(a).toUpperCase()==="MANUAL_SEMANTIC")e=sap.ca.ui.charts.ChartSemanticColor.Neutral;for(var i=0;i<b.length;i++){b[i].addCustomData(new sap.ui.core.CustomData({key:"fillColor",value:m[i].color||e}))}},set_percentCharts_uom:function(){var c=this;var a=this.dda_config.chartConfig.type;var b=this.dda_config.chartConfig.axis;var v=this.dda_config.chartConfig.value;var m=[];for(var i=0;i<this.chartMsrNames.length;i++){m.push(this.column_labels_mapping[this.chartMsrNames[i]]||this.chartMsrNames[i])}var d=this.getMeasuresByAxis(this.chartMeasures);var e=[],f=[];for(var i=0;i<d.axis1.nameArr.length;i++){e.push(this.column_labels_mapping[d.axis1.nameArr[i]]||d.axis1.nameArr[i])}for(var i=0;i<d.axis2.nameArr.length;i++){f.push(this.column_labels_mapping[d.axis2.nameArr[i]]||d.axis2.nameArr[i])}var g=(b=='DUAL')?e.join(" & "):m.join(" & ");var C={};if(this.dda_chart)C=this.dda_chart.getAdvancedChartSettings()?this.dda_chart.getAdvancedChartSettings():{};if(((a=='BAR')||(a=="COLUMN"))&&(v=="PERCENTAGE")){if(a=='COLUMN'){C.yAxis={title:{visible:true,text:(g+" ("+(c._oTextsModel.getResourceBundle().getText("IN_PERCENTAGE"))+")")}};if(b=='DUAL'){C.yAxis2={title:{visible:true,text:(f.join(" & ")+" ("+(c._oTextsModel.getResourceBundle().getText("IN_PERCENTAGE"))+")")}}}}else if(a=='BAR'){C.xAxis={title:{visible:true,text:(g+" ("+(c._oTextsModel.getResourceBundle().getText("IN_PERCENTAGE"))+")")}};if(b=='DUAL'){C.xAxis2={title:{visible:true,text:(g+" ("+(c._oTextsModel.getResourceBundle().getText("IN_PERCENTAGE"))+")")}};C.xAxis={title:{visible:true,text:(f.join(" & ")+" ("+(c._oTextsModel.getResourceBundle().getText("IN_PERCENTAGE"))+")")}}}}if(this.dda_chart)this.dda_chart.setAdvancedChartSettings(C)}},formatChartNumbers:function(v){var l=new sap.ui.core.Locale(sap.ui.getCore().getConfiguration().getLanguage());function i(n){return!isNaN(parseFloat(n))&&isFinite(n)}if(i(v)){if(!this.chartFormatter){var d=1;jQuery.sap.require("sap.ca.ui.model.format.NumberFormat");if(d||d==0){this.chartFormatter=sap.ca.ui.model.format.NumberFormat.getInstance({style:'short',shortDecimals:d},l)}else{this.chartFormatter=sap.ca.ui.model.format.NumberFormat.getInstance({style:'short'},l)}}v=this.chartFormatter.format(v)}return v},pseudoChartFormatter:function(v){return v},getRuntimeChartData:function(d,m){var t=this;var c=this.getView().byId("chartToolbar");c.setBusy(true);this.COLUMNS_SORT=[];for(var i=0;i<t.oColumns.length;i++){if(t.oColumns[i].sortBy&&t.oColumns[i].sortOrder){if((t.oColumns[i].sortOrder).toUpperCase()=="ASC"||(t.oColumns[i].sortOrder).toUpperCase=="DESC"){this.COLUMNS_SORT.push({name:t.oColumns[i].sortBy,order:t.oColumns[i].sortOrder})}}}try{var u=sap.suite.smartbusiness.odata.getUri({serviceUri:this._oModel.QUERY_SERVICE_URI,entitySet:this._oModel.QUERY_ENTITY_SET,dimension:d,measure:m,filter:this.DDA_MODEL.EVALUATION_DATA.FILTERS.results,sort:this.COLUMNS_SORT,dataLimit:(((this.dda_config.chartConfig.dataLimitations)&&(this.dda_config.chartConfig.dataLimit>0))?(this.dda_config.chartConfig.dataLimit):null),});u.model.read(u.uri,null,null,true,function(a){if(a.results.length){t.oChartData=a.results;t.oChartDataModel.setData({businessData:t.oChartData})}else{jQuery.sap.log.info("Chart data Table Returned Empty Results");t.oChartData=[];t.oChartDataModel.setData({businessData:t.oChartData})}c.setBusy(false)},function(){jQuery.sap.log.error("Error fetching data : "+u.uri);t.oChartData=[];t.oChartDataModel.setData({businessData:t.oChartData});c.setBusy(false)})}catch(e){jQuery.sap.log.error(e.toString());t.oChartData=[];t.oChartDataModel.setData({businessData:t.oChartData});c.setBusy(false)}},getDummyDataForChart:function(d,m,M,D){M=M||5;D=D||10;var c=[];var t,a={};for(var i=0;i<d.length;i++){a[d[i]]=[];for(var j=0;j<M;j++){a[d[i]].push(d[i]+"_"+j)}}for(var i=0;i<D;i++){t={};for(var j=0;j<d.length;j++){var b=a[d[j]].length;var p=sap.suite.smartbusiness.utils.getRandomNumber(b);t[d[j]]=a[d[j]][p]}for(var j=0;j<m.length;j++){t[m[j]]=sap.suite.smartbusiness.utils.getRandomNumber(100)}c.push(t)}c=this.sortChartData(c,d);return c},sortChartData:function(c,d){var e=[];c.sort(function(a,b){var i=0;while(i<d.length){if(a[d[i]]>b[d[i]]){return-1}else if(a[d[i]]<b[d[i]]){return 1}i++}});var t={};for(var i=0,k=0;i<c.length;i++){var s="";for(var j=0;j<d.length;j++){s+=c[i][d[j]]}if(!t[s]){t[s]=true;e[k++]=c[i]}}return e},onDeleteView:function(){var t=this;this.warn_header=false;var a=this.getView().getModel("SB_DDACONFIG").getData();var s=sap.suite.smartbusiness.ddaconfig.DrilldownSaveService;if(a.ALL_VIEWS.length>0){this.busyIndicator.open()&&this.getView().setBusy(true);s.saveViewConfiguration(this.evaluationId,a,"delete",function(){jQuery.sap.log.info("view delete success");t.busyIndicator.close()&&t.getView().setBusy(false);sap.m.MessageToast.show(t._oTextsModel.getResourceBundle().getText("CHART_CONFIG_DELETE_SUCCESS"));for(var i=0,b;i<a.ALL_VIEWS.length;i++){if(a.ALL_VIEWS[i].ID==t.viewId){b=i;break}}if(b||(b==0)){a.ALL_VIEWS.splice(b,1)}t.viewId=(a.ALL_VIEWS.length<=0?"":(a.ALL_VIEWS.length==(b)?a.ALL_VIEWS[0].ID:a.ALL_VIEWS[b].ID));t.DDA_MODEL.getConfigurator().removeViewById(a.ID);t.DDA_MODEL.setViewId(t.viewId);t.bindUiToModel();t._oModel=t.DDA_MODEL.getModelDataForDDAConfiguration();t.refreshChart()},function(e){jQuery.sap.log.error(e+" failed");t.busyIndicator.close()&&t.getView().setBusy(false);sap.suite.smartbusiness.utils.showErrorMessage(t._oTextsModel.getResourceBundle().getText("DELETE_ERROR"))})}},onViewSwitch:function(e){var k=e.getParameter("selectedKey");this.viewId=k;this.DDA_MODEL.setViewId(this.viewId);this.bindUiToModel();this._oModel=this.DDA_MODEL.getModelDataForDDAConfiguration();this.refreshChart();window.location.replace(window.location.hash.substring(0,window.location.hash.lastIndexOf("/"))+"/"+this.viewId)},deleteMaster:function(){var t=this;this.warn_header=false;var m=this.getView().getModel("SB_DDACONFIG").getData();var s=sap.suite.smartbusiness.ddaconfig.DrilldownSaveService;this.busyIndicator.open()&&this.getView().setBusy(true);s.saveEvalConfiguration(this.evaluationId,m,"delete",function(){jQuery.sap.log.info("Deleted master configuration for the evaluation");t.busyIndicator.close()&&t.getView().setBusy(false);t.DDA_MODEL.removeAllViews();sap.m.MessageToast.show(t._oTextsModel.getResourceBundle().getText("EVAL_CONFIG_DELETE_SUCCESS"));t.oRouter.navTo("detail",{"contextPath":"EVALUATIONS_DDA('"+t.evaluationId+"')"});t.evaluationId=null;t.oApplicationFacade.__refreshModel=1},function(e){jQuery.sap.log.error(e+" failed");t.busyIndicator.close()&&t.getView().setBusy(false);sap.suite.smartbusiness.utils.showErrorMessage(t._oTextsModel.getResourceBundle().getText("DELETE_ERROR"))})},fetchAndRenderHeaderRibbon:function(f){var s=this;var E=this.DDA_MODEL.EVALUATION_DATA;var p=sap.suite.smartbusiness.odata.properties(E.ODATA_URL,E.ODATA_ENTITYSET);var M=p.getUnitPropertyMappingObject();var u=sap.suite.smartbusiness.odata.getUri({serviceUri:E.ODATA_URL,entitySet:E.ODATA_ENTITYSET,measure:E.COLUMN_NAME,filter:E.FILTERS["results"]});u.model.read(u.uri,null,null,true,function(d){if(d){s.HeaderRibbonModel.setData({data:d.results[0]})}else{jQuery.sap.log.error("Couldn't fetch Aggregate Value. Response was "+d+" for uri : "+u.uri)}});var k=M[E.COLUMN_NAME];var i=this.getView().getModel("i18n");this.byId("aggregate_number").bindProperty("text","/data/"+E.COLUMN_NAME,function(v){if(v==""||v==null){v=i.getResourceBundle().getText("NO_DATA")}return v});if(k){this.byId("aggregate_number_unit").bindProperty("text","/data/"+k,function(v){return v})}},displayAggregate:function(){var i=this.getView().getModel("i18n");if(this.byId("enableAggregate").getSelected()==false){this.byId("enableAggregate").setText(i.getResourceBundle().getText("ENABLE_KPI_AGGREGATE"));this.byId("enableAggregate").invalidate()}else if(this.byId("enableAggregate").getSelected()==true){this.byId("enableAggregate").setText("")}}})};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.drilldown.lib.AllLibrary')){jQuery.sap.declare("sap.suite.ui.smartbusiness.drilldown.lib.AllLibrary");jQuery.sap.require('sap.ca.ui.model.format.NumberFormat');jQuery.sap.require('sap.ca.ui.model.type.Date')};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.drilldown.view.AddToHome.controller')){jQuery.sap.declare('sap.suite.ui.smartbusiness.drilldown.view.AddToHome.controller');jQuery.sap.require('sap.m.MessageBox');sap.ui.controller("sap.suite.ui.smartbusiness.drilldown.view.AddToHome",{onInit:function(){this.drilldownController=this.getView().getViewData();this.evaluationApi=this.drilldownController.EVALUATION;this.thresholds=this.evaluationApi.getThresholds();this.LAYOUT=this.byId("container");this.SAP_SYSTEM=this.drilldownController.SAP_SYSTEM;try{this.LAYOUT_MODEL=new sap.ui.model.json.JSONModel({TITLE:"",CL:this.thresholds.getCriticalLow(),CH:this.thresholds.getCriticalHigh(),WL:this.thresholds.getWarningLow(),WH:this.thresholds.getWarningHigh(),TA:this.thresholds.getTarget(),TC:this.thresholds.getTrend(),RE:this.thresholds.getReference(),MINIMIZING_KPI:this.evaluationApi.isMinimizingKpi(),MAXIMIZING_KPI:this.evaluationApi.isMaximizingKpi(),TARGET_KPI:this.evaluationApi.isTargetKpi()});this.LAYOUT.setModel(this.LAYOUT_MODEL),this.createForm(this.evaluationApi.getThresholdValueType()=="MEASURE")}catch(e){}},createForm:function(i){var _=function(m){return{parts:[{path:m},{path:"/TARGET_KPI"}],formatter:function(M,t){if(M||t){return true}return false}}};var f=null;var n=null;if(!i){f=new sap.ui.layout.form.SimpleForm({content:[new sap.m.Label({text:"{i18n>SUB_TITLE_LABEL}",required:true}),new sap.m.Input({value:"{/TITLE}",id:"subtitleInput"}),new sap.m.Label({text:"{i18n>CRITICAL_HIGH_LABEL}",visible:_("/MINIMIZING_KPI")}),new sap.m.Input({value:"{/CH}",visible:_("/MINIMIZING_KPI"),valueState:sap.ui.core.ValueState.Error,valueStateText:"{i18n>CRITICAL_HIGH_VALUE_HELP}"}),new sap.m.Label({text:"{i18n>WARNING_HIGH_LABEL}",visible:_("/MINIMIZING_KPI")}),new sap.m.Input({value:"{/WH}",visible:_("/MINIMIZING_KPI"),valueState:sap.ui.core.ValueState.Warning,valueStateText:"{i18n>WARNING_HIGH_VALUE_HELP}"}),new sap.m.Label({text:"{i18n>TARGET_LABEL}"}),new sap.m.Input({value:"{/TA}",valueState:sap.ui.core.ValueState.None,valueStateText:"{i18n>TARGET_VALUE_HELP}"}),new sap.m.Label({text:"{i18n>WARNING_LOW_LABEL}",visible:_("/MAXIMIZING_KPI")}),new sap.m.Input({value:"{/WL}",visible:_("/MAXIMIZING_KPI"),valueState:sap.ui.core.ValueState.Warning,valueStateText:"{i18n>WARNING_LOW_VALUE_HELP}"}),new sap.m.Label({text:"{i18n>CRITICAL_LOW_LABEL}",visible:_("/MAXIMIZING_KPI")}),new sap.m.Input({value:"{/CL}",visible:_("/MAXIMIZING_KPI"),valueState:sap.ui.core.ValueState.Error,valueStateText:"{i18n>CRITICAL_LOW_VALUE_HELP}"}),]})}else{f=new sap.ui.layout.form.SimpleForm({content:[new sap.m.Label({text:"{i18n>SUB_TITLE_LABEL}",required:true}),new sap.m.Input({value:"{/TITLE}"}),]});n=new sap.m.Label({text:"{i18n>DYNAMIC_MEASURE_NOT_EDITABLE}"});n.addStyleClass("labelDynamicThresholdNotEditable")}this.LAYOUT.removeAllItems();this.LAYOUT.addItem(f);if(n){this.LAYOUT.addItem(n)}},validate:function(c,C){var m=this.LAYOUT_MODEL.getData();m.TITLE=sap.ui.getCore().byId("subtitleInput").getValue();var o={title:""};if(this.evaluationApi.getThresholdValueType()=="MEASURE"){if(!m.TITLE.trim()){C.call(this,{errorMessage:this.drilldownController.getView().getModel("i18n").getProperty("VALIDATION_ERROR_TITLE_MISSING")})}else{o.title=m.TITLE.trim();c.call(this,o)}}else{if(!m.TITLE.trim()){C.call(this,{errorMessage:this.drilldownController.getView().getModel("i18n").getProperty("VALIDATION_ERROR_TITLE_MISSING")});return}o.title=m.TITLE.trim();o.evaluationValues=[];var t=m.TA?m.TA.trim():null;var a=m.CL?m.CL.trim():null;var b=m.CH?m.CH.trim():null;var W=m.WL?m.WL.trim():null;var d=m.WH?m.WH.trim():null;if(t){o.evaluationValues.push({TYPE:"TA",FIXED:t,ID:this.evaluationApi.getId(),COLUMN_NAME:null,ODATA_PROPERTY:null})}if(a){o.evaluationValues.push({TYPE:"CL",FIXED:a,ID:this.evaluationApi.getId(),COLUMN_NAME:null,ODATA_PROPERTY:null})}if(b){o.evaluationValues.push({TYPE:"CH",FIXED:b,ID:this.evaluationApi.getId(),COLUMN_NAME:null,ODATA_PROPERTY:null})}if(W){o.evaluationValues.push({TYPE:"WL",FIXED:W,ID:this.evaluationApi.getId(),COLUMN_NAME:null,ODATA_PROPERTY:null})}if(d){o.evaluationValues.push({TYPE:"WH",FIXED:d,ID:this.evaluationApi.getId(),COLUMN_NAME:null,ODATA_PROPERTY:null})}if(o.evaluationValues.length==0){o.evaluationValues=null}c.call(this,o)}},_addTileToHomePage:function(c){var b=sap.ushell.Container.getService("Bookmark");var a=null;b.addCatalogTileToGroup(c,a,{baseUrl:"/sap/hba/r/sb/core/odata/runtime/SMART_BUSINESS.xsodata",remoteId:"HANA_CATALOG"}).done(function(){jQuery.sap.log.info("Tile Added to HOME")}).fail(function(e){jQuery.sap.log.error("Failed to add tile to home : "+e)})},_notifyShell:function(c){var s=sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService;if(s){oNotifyShell=s("LaunchPage");if(oNotifyShell&&oNotifyShell.onCatalogTileAdded){oNotifyShell.onCatalogTileAdded(c)}}},publishTile:function(c){this.validate(function(t){var r=sap.suite.smartbusiness.chip.savePersonalizedTile({evaluationId:this.evaluationApi.getId(),tileType:this.drilldownController.TILE_TYPE,dimension:this.drilldownController.DIMENSION,additionalFilters:this.drilldownController.getAdditionFiltersForChipConfiguration(),evaluationValues:t.evaluationValues?t:null,title:t.title,sapSystem:this.SAP_SYSTEM});if(r.status=='Success'){sap.m.MessageToast.show(this.drilldownController.getView().getModel("i18n").getProperty("PERSONALIZED_TILE_CREATED_SUCCESSFULLY"));c.call();this._addTileToHomePage(r.chipId);this._notifyShell(r.chipId)}else{jQuery.sap.log.error(r.message);sap.m.MessageToast.show(this.drilldownController.getView().getModel("i18n").getProperty("PERSONALIZED_TILE_CREATION_FAILED"));c.call()}},function(e){sap.m.MessageBox.show(e.errorMessage,null,this.drilldownController.getView().getModel("i18n").getProperty("VALIDATION_ERROR_HEADER"))})},onAfterRendering:function(){}})};
