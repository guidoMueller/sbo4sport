/*!
 * SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2013 SAP AG. All rights reserved
 */
jQuery.sap.declare("sap.ushell.ui.launchpad.TileContainer");jQuery.sap.require("sap.ushell.library");jQuery.sap.require("sap.ui.core.Control");sap.ui.core.Control.extend("sap.ushell.ui.launchpad.TileContainer",{metadata:{library:"sap.ushell",properties:{"scrollType":{type:"string",group:"Misc",defaultValue:'item'},"animationSpeed":{type:"int",group:"Misc",defaultValue:500},"groupId":{type:"string",group:"Misc",defaultValue:null},"showHeader":{type:"boolean",group:"Misc",defaultValue:true},"showPlaceholder":{type:"boolean",group:"Misc",defaultValue:true},"defaultGroup":{type:"boolean",group:"Misc",defaultValue:false},"headerText":{type:"string",group:"Misc",defaultValue:null},"headerLevel":{type:"sap.m.HeaderLevel",group:"Misc",defaultValue:sap.m.HeaderLevel.H2},"groupHeaderLevel":{type:"sap.m.HeaderLevel",group:"Misc",defaultValue:sap.m.HeaderLevel.H4},"showGroupHeader":{type:"boolean",group:"Misc",defaultValue:true},"visible":{type:"boolean",group:"Misc",defaultValue:true},"sortable":{type:"boolean",group:"Misc",defaultValue:true},"showNoData":{type:"boolean",group:"Misc",defaultValue:false},"noDataText":{type:"string",group:"Misc",defaultValue:null}},aggregations:{"tiles":{type:"sap.ushell.ui.launchpad.Tile",multiple:true,singularName:"tile"},"footerContent":{type:"sap.ui.core.Control",multiple:true,singularName:"footerContent"}},events:{"afterRendering":{},"add":{}}}});sap.ushell.ui.launchpad.TileContainer.M_EVENTS={'afterRendering':'afterRendering','add':'add'};
// Copyright (c) 2013 SAP AG, All Rights Reserved
(function(){"use strict";jQuery.sap.require("sap.ushell.override");sap.ushell.ui.launchpad.TileContainer.prototype.init=function(){jQuery.sap.require("sap.ushell.ui.launchpad.PlusTile");this.oPlusTile=new sap.ushell.ui.launchpad.PlusTile({groupId:this.getGroupId(),press:[this.fireAdd,this]});this.oPlusTile.setParent(this)};sap.ushell.ui.launchpad.TileContainer.prototype.exit=function(){if(this.oPlusTile){this.oPlusTile.destroy()}};sap.ushell.ui.launchpad.TileContainer.prototype.onAfterRendering=function(){this.setVisible();this.fireAfterRendering()};sap.ushell.ui.launchpad.TileContainer.prototype.updateAggregation=sap.ushell.override.updateAggregation;sap.ushell.ui.launchpad.TileContainer.prototype.updateTiles=function(r){var n="tiles";if(this.isTreeBinding(n)){sap.ui.base.ManagedObject.prototype.updateAggregation.apply(this,arguments)}else{jQuery.sap.log.debug("Updating TileContainer. Reason: ",r);switch(r){case"filter":try{this.filterTiles()}catch(e){this.updateAggregation(n)}break;default:this.updateAggregation(n)}}};sap.ushell.ui.launchpad.TileContainer.prototype.handleNoItemsToDisplayMessage=function(i){if(i){this.setNoDataText('');this.$().find(".sapUshellNoFilteredItems").removeAttr("tabindex")}else{if(this.getShowNoData()){if(this.getNoDataText()){this.setNoDataText(this.getNoDataText())}else{this.setNoDataText(sap.ushell.resources.i18n.getText("noFilteredItems"))}this.$().find(".sapUshellNoFilteredItems").attr("tabindex",0)}}};sap.ushell.ui.launchpad.TileContainer.prototype.createMissingElementsInOnScreenElements=function(i,e,a,g,s,b,f,A){var p,n=null,G=null,j=a,S=this.getShowGroupHeader(),c=e.length;for(j=a;j<c;j++){p=e[j].getPath();if(!i.onScreenPathIndexMap[p]){var o;if(g&&s.length>0){n=s[0].fnGroup(e[j]);if(typeof n==="string"){n={key:n}}if(G===null&&j>0){G=s[0].fnGroup(e[j-1])}if(n.key!==G){if(b.groupHeaderFactory){o=b.groupHeaderFactory(n)}if(!i.onScreenHeaders[n.key]){A(n,o);i.onScreenHeaders[n.key]={aItemsRefrenceIndex:this.getTiles().length-1,isVisible:S}}G=n.key}}f(e[j]);i.onScreenPathIndexMap[p]={aItemsRefrenceIndex:this.getTiles().length-1,isVisible:true}}else{throw true}}};sap.ushell.ui.launchpad.TileContainer.prototype.addNewItem=function(e){var n="tiles",a=this.getMetadata().getJSONKeys()[n],b=this.mBindingInfos[n],f=b.factory,c=$.proxy(function(C){var i=this.getId()+"-"+jQuery.sap.uid(),o=f(i,C);o.setBindingContext(C,b.model);this[a._sMutator](o)},this);c(e)};sap.ushell.ui.launchpad.TileContainer.prototype.markVisibleOnScreenElements=function(e,i){var a=0,p,b=e.length;for(a=0;a<b;a++){p=e[a].getPath();if(i.onScreenPathIndexMap[p]){i.onScreenPathIndexMap[p].isVisible=true}else{return a}}return a};sap.ushell.ui.launchpad.TileContainer.prototype.indexOnScreenElements=function(o){var p,i,a={onScreenHeaders:{},onScreenPathIndexMap:{}},b=o.length;for(i=0;i<b;i++){var c=o[i];if(c.getHeaderText){a.onScreenHeaders[c.getHeaderText()]={aItemsRefrenceIndex:i,isVisible:false}}else if(c.getBindingContext()){p=c.getBindingContext().getPath();a.onScreenPathIndexMap[p]={aItemsRefrenceIndex:i,isVisible:false}}}return a};sap.ushell.ui.launchpad.TileContainer.prototype.showHideTilesAndHeaders=function(i,o){var s,n="tiles",a=false,S=this.getShowGroupHeader(),b=this.mBindingInfos[n].binding,e;for(s in i.onScreenPathIndexMap){if(i.onScreenPathIndexMap.hasOwnProperty(s)){e=i.onScreenPathIndexMap[s];var r=o[e.aItemsRefrenceIndex];r.setVisible(e.isVisible);if(e.isVisible){var g=b.aSorters[0].fnGroup(r.getBindingContext());i.onScreenHeaders[g].isVisible=S;a=true}}}for(s in i.onScreenHeaders){if(i.onScreenHeaders.hasOwnProperty(s)){e=i.onScreenHeaders[s];o[e.aItemsRefrenceIndex].setVisible(e.isVisible)}}return a};sap.ushell.ui.launchpad.TileContainer.prototype.filterTiles=function(){var n="tiles",b=this.mBindingInfos[n],B=this.mBindingInfos[n].binding,a=B.getContexts(),i=this.getTiles(),c=false,d;var e=this.indexOnScreenElements(i);d=this.markVisibleOnScreenElements(a,e);if(a[d]&&this.getTiles().length>0){var l=this.getTiles()[this.getTiles().length-1].getBindingContext().getPath();var f=a[d].getPath();var s=l.split('/');var g=f.split('/');var h=s[s.length-1];var j=g[g.length-1];if(parseInt(h)>parseInt(j)){throw true}}this.createMissingElementsInOnScreenElements(e,a,d,B.isGrouped(),B.aSorters,b,this.addNewItem.bind(this),this.addTileGroup.bind(this));i=this.getTiles();c=this.showHideTilesAndHeaders(e,i);this.handleNoItemsToDisplayMessage(c)};sap.ushell.ui.launchpad.TileContainer.prototype.addTileGroup=function(g,h){this.addAggregation("tiles",h||new sap.ushell.ui.launchpad.HeaderTile({headerText:g.text||g.key,headerLevel:g.headerLevel||this.getGroupHeaderLevel(),visible:this.getShowGroupHeader()}).addStyleClass("sapUshellTileContainerHdr"))};sap.ushell.ui.launchpad.TileContainer.prototype.setNoDataText=function(n){this.setProperty("noDataText",n,true);if(this.getShowNoData()){this.$().find(".sapUshellNoFilteredItems").text(n)}return this};sap.ushell.ui.launchpad.TileContainer.prototype.setGroupId=function(v){this.setProperty("groupId",v,true);if(this.oPlusTile){this.oPlusTile.setGroupId(v)}return this};sap.ushell.ui.launchpad.TileContainer.prototype.setHeaderText=function(h){this.setProperty("headerText",h,true);this.$().find(".sapUshellContainerTitle").text(h);return this};sap.ushell.ui.launchpad.TileContainer.prototype.setSortable=function(s){if(s){this.$().find(".ui-sortable").sortable('enable')}else{this.$().find(".ui-sortable").sortable('disable')}return this};sap.ushell.ui.launchpad.TileContainer.prototype.setVisible=function(v){if(!this.groupHasVisibleTiles()&&sap.ui.getCore().byId("shell")&&sap.ui.getCore().byId("shell").getModel()&&!sap.ui.getCore().byId("shell").getModel().getProperty("/personalization")){v=false}this.setProperty("visible",v);return this.toggleStyleClass("sapUshellHidden",!v)};sap.ushell.ui.launchpad.TileContainer.prototype.groupHasVisibleTiles=function(){var p='',t=this.getTiles();if(this.getBindingContext()){p=this.getBindingContext().sPath;t=this.getModel().getProperty(p).tiles}return sap.ushell.utils.groupHasVisibleTiles(t)}}());
