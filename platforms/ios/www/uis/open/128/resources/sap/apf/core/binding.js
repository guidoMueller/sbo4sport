/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
jQuery.sap.declare("sap.apf.core.binding");jQuery.sap.require("sap.apf.core.constants");jQuery.sap.require("sap.apf.core.utils.filter");jQuery.sap.require("sap.apf.core.utils.filterTerm");
sap.apf.core.Binding=function(I,b,f){var t=this;this.type="binding";var n=0;var r=[];var R=[];var c=[];var C;var s;this.oTitle=b.oTitle;this.oLongTitle=b.oLongTitle;var a=b.requiredFilters;this.getFilter=function(){var S=this.getSelectedRepresentation();var m=sap.apf.core.constants.filterMethodTypes;var i=[];if(S.getFilterMethodType()===m.startFilter||S.getFilterMethodType()===m.filter){var F=S.getFilter().getInternalFilter();if(s){return s.getInternalFilter().overwriteWith(F)}else{return F}}if(S.getSelectionAsArray){i=S.getSelectionAsArray()}else{return new sap.apf.core.utils.Filter(I.messageHandler)}if(i===undefined){return sap.apf.core.utils.Filter.createEmptyFilter(I.messageHandler,a)}if(i.length===c.length||i.length===0){return new sap.apf.core.utils.Filter(I.messageHandler)}return sap.apf.core.utils.Filter.createFromArray(I.messageHandler,a,c,i)};this.getRequestOptions=function(){if(jQuery.isFunction(this.getSelectedRepresentation().getRequestOptions)){return this.getSelectedRepresentation().getRequestOptions()}return{}};function d(o){return o.getFilterMethodType()===sap.apf.core.constants.filterMethodTypes.startFilter}this.setFilter=function(F){var o=this.getSelectedRepresentation();s=F;if(d(o)){o.setFilter(s)}};this.setData=function(D){I.messageHandler.check(D!==undefined,"aDataResponse is undefined (binding function setData)");c=D.data;C=D.metadata;this.getSelectedRepresentation().setData(D.data,D.metadata)};this.getRepresentationInfo=function(){var h=jQuery.extend(true,[],R);for(var i=0;i<h.length;i++){delete h[i].id;delete h[i].type;delete h[i].constructor}return h};this.getSelectedRepresentationInfo=function(){I.messageHandler.check(0<=n&&n<R.length,"index in array boundaries");var o=jQuery.extend(true,{},R[n]);delete o.id;delete o.type;delete o.constructor;return o};this.getSelectedRepresentation=function(){I.messageHandler.check(0<=n&&n<r.length,"selectedRepresentation in array boundaries");return r[n]};this.setSelectedRepresentation=function(h){I.messageHandler.check(typeof h==="string","setSelectedRepresentation() - sRepresentationId missing");var o=this.getSelectedRepresentation();var S=j(h,b.representations);var N=k(S);n=S.index;if(c!==undefined&&C!==undefined){N.setData(c,C)}if(N.adoptSelection){N.adoptSelection(o)}function j(h,l){for(var i=0;i<l.length;i++){if(h===l[i].id){return{config:l[i],constructor:f.getConfigurationById(l[i].representationTypeId).constructor,index:i}}}I.messageHandler.check(false,"Representation config not found")}function k(i){if(r[i.index]===undefined){if(i.config.parameter&&i.config.parameter.alternateRepresentationTypeId){i.config.parameter.alternateRepresentationType=f.getConfigurationById(i.config.parameter.alternateRepresentationTypeId)}i.config.parameter.requiredFilters=b.requiredFilters;r[i.index]=I.coreApi.createRepresentation(i.constructor,i.config.parameter);return r[i.index]}else{return r[i.index]}}};this.serialize=function(){return{selectedRepresentation:t.getSelectedRepresentation().serialize(),selectedRepresentationId:t.getSelectedRepresentationInfo().representationId}};this.deserialize=function(S){t.setSelectedRepresentation(S.selectedRepresentationId);t.getSelectedRepresentation().deserialize(S.selectedRepresentation);return t};r[0]=undefined;for(var e in b.representations){var g=b.representations[e].representationTypeId;R[e]=jQuery.extend(true,{},f.getConfigurationById(g));R[e].representationId=b.representations[e].id;R[e].representationLabel=b.representations[e].label}if(R.length>0){this.setSelectedRepresentation(R[0].representationId)}};
