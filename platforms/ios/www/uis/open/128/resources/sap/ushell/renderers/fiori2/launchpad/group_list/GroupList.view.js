//Copyright (c) 2013 SAP AG, All Rights Reserved
(function(){"use strict";jQuery.sap.require("sap.ushell.ui.launchpad.GroupListItem");jQuery.sap.require("sap.ui.core.IconPool");var _=$.ui.sortable.prototype._mouseStop;$.ui.sortable.prototype._mouseStop=function(e,n){if(!e){return}if(this.options.revert){var t=this,a=arguments,c=t.placeholder.offset(),d=$.isFunction(this.options.revert)?this.options.revert.apply(this.element[0],[e,t._uiHash(this)]):this.options.revert,j=jQuery(this.helper);self.reverting=true;if(jQuery(".sapUshellDeleteArea_grouplist_functional").data("groupOver")===true){var g=sap.ui.getCore().byId(jQuery(t.currentItem).attr('id')),r=g.getRemovable(),o=function(){j.data("deleteMe",true);j.animate({top:(jQuery(document).height()-j.height()-10)+"px",left:"0px",opacity:0},!isNaN(d)?d:250,function(){e.scrollToGroup=false;t._clear(e);var E=sap.ui.getCore().getEventBus();E.publish("launchpad",r?"deleteGroup":"resetGroup",{groupId:g.getGroupId()});var C=sap.ui.getCore().byId('groupList').oController;C._getJqAllListItems().not(".sapUshellSortableHelperClone").not(".sapUshellClonedGrouplistItem").css("visibility","");jQuery(".sapUshellDeleteArea_grouplist_functional").data("groupOver",false)})};j.animate({opacity:'hide'});g.bDeletionFlag=true;o()}else if(jQuery(".sapUshellGroupList").data("dropGroup")){var b=jQuery.sap.byId(jQuery(".sapUshellGroupList").data("dropGroup").sId);j.animate({top:b.offset().top+16,left:b.offset().left+48,height:"0px",width:"0px",opacity:0},!isNaN(d)?d:250,function(){jQuery(".sapUshellGroupList").data("dropGroup",null);_.apply(t,a)})}else{_.apply(t,a)}}else{e.scrollToGroup=true;this._clear(e,n)}return false};sap.ui.jsview("sap.ushell.renderers.fiori2.launchpad.group_list.GroupList",{createContent:function(c){var t=this,o=this._getOpenCatalogItem(c),a=this._getAddGroupItem(c),g=this._getGroupListItemTemplate(c),n=undefined,s=sap.ui.getCore().byId("shell"),S=s&&s.getModel();this.oGrouplistDeleteArea=new sap.ushell.ui.launchpad.DeleteArea({type:sap.ushell.ui.launchpad.DeleteAreaType.GroupList,message:sap.ushell.resources.i18n.getText("deleteAreaMsgForGroup"),icon:sap.ui.core.IconPool.getIconURI('delete')});var h=[];if(S&&S.getProperty("/enableHideGroups")){h.push(new sap.ui.model.Filter("isGroupVisible",sap.ui.model.FilterOperator.EQ,true))}this.oGroupList=new sap.m.List("groupListItems",{items:{path:"/groups",template:g,filters:h}}).addStyleClass("sapUshellGroupItemList");jQuery.extend(this.oGroupList,{onsapskipforward:function(){},onsapskipback:function(){}});var C=function(e){var L=e.getSource().oList;if(L[L.length-1].editMode){var i=t.oGroupList.getItems();n=i[i.length-1].getId()}};this._handleTouchStart=function(e,u){var j=jQuery(u);j.attr('startPos',j.index())},this._handleDoubleTap=function(e,u){var i=sap.ui.getCore().byId(u.getAttribute('id'));if(i){i.ondblclick()}},this._handleTouchDrag=function(e,u){jQuery(this.getDomRef()).find(".sapUshellOver").removeClass('sapUshellOver');this.oGrouplistDeleteArea.show()},this.oGroupList.onBeforeRendering=function(){if(t.touchSupport){t.touchSupport.disable();t.touchSupport=null}},this._handleDelete=function(e,i){if(this.oGrouplistDeleteArea.isElementOverDeleteArea(i)){if(this.isOutsideDeleteArea){var G=sap.ui.getCore().byId(i.getAttribute('id'));this.oGrouplistDeleteArea.setDeleteAreaMessage(G);this.oGrouplistDeleteArea.groupOver(true);this.oGrouplistDeleteArea.adjustStyleOnOverIn(true,jQuery(i));this.isOutsideDeleteArea=false}}else{if(!this.isOutsideDeleteArea){this.oGrouplistDeleteArea.groupOver(false);this.oGrouplistDeleteArea.adjustStyleOnOverOut(true,jQuery(i));this.isOutsideDeleteArea=true}}},this.oGroupList.onAfterRendering=function(){c._updateGroupSelection();if(this.getModel().getProperty("/personalization")){if(!sap.ui.Device.system.desktop){t.touchSupport=new sap.ushell.touchSupport({containerSelector:"#groupListPage-scroll .sapUshellGroupItemList",draggableSelector:".sapUshellGroupLI:not(.sapUshellDefaultGroupItem)",rootSelector:"#groupList",wrapperSelector:"#groupListPage-scroll",touchStartCallback:t._handleTouchStart.bind(t),touchEndCallback:c._handleDrop.bind(c),touchDragCallback:t._handleTouchDrag.bind(t),dragAndScrollCallback:t._handleDelete.bind(t),doubleTapCallback:t._handleDoubleTap.bind(t),placeHolderClass:"sapUshellGroupListItem-placeholder",cloneClass:"sapUshellGroupListItem-clone",moveTolerance:1,switchModeDelay:1000,debug:jQuery.sap.debug()}).enable()}else{jQuery.proxy(c.makeSortable,c)()}}if(n){var j=jQuery.sap.byId(n);j.css('opacity',0).slideDown(300).animate({opacity:1},{queue:false,duration:300});n=undefined}this.getBinding("items").detachChange(C);this.getBinding("items").attachChange(C)};this.oGroupList.updateItems=sap.ushell.override.updateAggregatesFactory("items");var l=new sap.m.Button("lastHiddenSidebarTabFocusHelper");l.addEventDelegate({onfocusin:function(){try{if(!sap.ushell.renderers.fiori2.AccessKeysHandler.goToEdgeTile('first')){sap.ui.getCore().byId('actionsBtn').focus()}}catch(e){}}});var f=new sap.m.Button("firstHiddenSidebarTabFocusHelper");f.addEventDelegate({onfocusin:function(){try{var i=sap.ui.getCore().byId('actionsBtn');i.focus()}catch(e){}}});if(sap.ui.getCore().byId("shell")&&sap.ui.getCore().byId("shell").getModel()&&sap.ui.getCore().byId("shell").getModel().getProperty("/personalization")){this.oActionList=new sap.m.List({items:[a,o]});jQuery.extend(this.oActionList,{onsapskipforward:function(){},onsapskipback:function(){}});this.oActionList._navToTabChain=function(){};var b=this.oActionList.onAfterRendering;this.oActionList.onAfterRendering=function(e){b.call(this,e);var i=e.srcControl.getItems()[0]};var d=new sap.m.Bar({id:"groupListFooter",contentMiddle:[this.oActionList,l]});d.addStyleClass("sapUshellPersonalizationOn");this.groupListPage=new sap.m.Page({id:"groupListPage",showHeader:false,showFooter:true,content:[f,this.oGroupList],footer:d,enableScrolling:!!sap.ui.Device.system.desktop});this.groupListPage.addStyleClass("sapUshellPersonalizationOn")}else{this.groupListPage=new sap.m.Page({id:"groupListPage",showHeader:false,showFooter:false,content:[f,this.oGroupList]})}this.addStyleClass("sapUshellGroupList");return[this.groupListPage,this.oGrouplistDeleteArea]},_getOpenCatalogItem:function(){var o=function(){sap.ushell.renderers.fiori2.Navigation.openCatalogByHash({groupContext:null})},O=new sap.m.ActionListItem("openCatalogActionItem",{text:"{i18n>open_catalog}",tooltip:"{i18n>openCatalog_tooltip}",press:o});return O},_getGroupListItemTemplate:function(c){var o=function(e){if(this.getParent().getItems()[0]===this){this.setAllowEditMode(false);if(this.getDefaultGroup()){this.addStyleClass("sapUshellDefaultGroupItem")}}else{this.addStyleClass("sapUshellGroupListItem")}c._bindGroupListItemEvents(e);jQuery(this.getDomRef()).attr("tabindex","0")};return new sap.ushell.ui.launchpad.GroupListItem({index:"{index}",title:"{title}",tooltip:"{title}",defaultGroup:"{isDefaultGroup}",groupId:"{groupId}",editMode:"{editMode}",removable:"{removable}",numberOfTiles:"{tiles/length}",afterRendering:o,isGroupVisible:"{isGroupVisible}",press:[function(e){this._handleGroupListItemPress(e)},c],change:[c.onGroupTitleChange,c],over:[c._handleGroupListItemOver,c],out:[c._handleGroupListItemOut,c],drop:[c._handleGroupListItemDrop,c]})},_getAddGroupItem:function(c){var a=new sap.m.ActionListItem("addGroupActionItem",{text:"{i18n>add_group}",tooltip:"{i18n>add_group_tooltip}",press:[function(){c._handleGroupCreate.apply(c,arguments)},c]});return a},getControllerName:function(){return"sap.ushell.renderers.fiori2.launchpad.group_list.GroupList"}})}());
