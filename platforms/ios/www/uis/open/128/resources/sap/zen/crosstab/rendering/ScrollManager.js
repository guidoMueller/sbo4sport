jQuery.sap.declare("sap.zen.crosstab.rendering.ScrollManager");jQuery.sap.require("sap.zen.crosstab.utils.Measuring");jQuery.sap.require("sap.ui.core.Popup");jQuery.sap.require("sap.ui.core.OpenState");jQuery.sap.require("sap.ui.commons.TextView");jQuery.sap.require("sap.zen.crosstab.TextConstants");jQuery.sap.require("sap.zen.crosstab.utils.Utils");
sap.zen.crosstab.rendering.ScrollManager=function(c,r){"use strict";var C=c.getColumnHeaderArea();var R=c.getRowHeaderArea();var d=c.getDimensionHeaderArea();var D=c.getDataArea();var m=r.getMeasuringHelper();var i=0;var a=0;var h=false;var v=false;var H=0;var V=0;var l=null;var o=null;var L=null;var b=null;var p=new sap.ui.core.Popup();p.setContent(new sap.ui.commons.TextView());p.setDurations(125,500);p.setAutoClose(true);p.getContent().addStyleClass("sapzencrosstab-ScrollPopup");p.getContent().setWrapping(false);var e=(D.getRowCnt()+"").length;var f=(D.getColCnt()+"").length;var g=0;var j=0;var B=false;var k=false;var t=this;this.destroy=function(){p.destroy()};this.setHScrollPos=function(G){a=G};this.setVScrollPos=function(G){i=G};function n(G){c.getPageManager().enableTimeout(true);o=null;var P=null;if(!G){P=l}else{P=G.getParameters()}if(P){var I=c.getHScrollbar();var M=I.getSteps();h=P.newScrollPos===M;a=P.newScrollPos;t.sendClientScrollPosUpdate();var S=P.newScrollPos;if(S!==C.getRenderStartCol()){if(S!==C.getColCnt()){r.beginRendering();r.renderColHeaderArea(S);r.renderDataArea();r.adjustColWidths(C,D);r.adjustRowHeights(R,D);r.adjustRowHeights(d,C);r.finishRendering()}var J=m.getAreaWidth(C);var K=m.getUpperRightScrollDivWidth();var N=J<K;var O=C.getRenderColCnt()+C.getRenderStartCol()===C.getColCnt();if(h||N&&O){if(N&&S>0){r.beginRendering();r.appendLeftCols(C,4);r.appendLeftCols(D,4);r.adjustColWidths(C,D);r.adjustRowHeights(R,D);r.adjustRowHeights(d,C);r.finishRendering()}if(!h&&P.forward){q(0,true)}s(true)}else{s(false)}}else{if(h){s(true)}}if(v){F(true)}if(P.newScrollPos===0){s(false)}}p.close()}this.hScrollHandler=function(G,N){if(!B){if(N){n(G)}else{l=G.getParameters();if(o){clearTimeout(o);o=null;u(l.newScrollPos)}o=setTimeout(n,200,null);a=l.newScrollPos}}else{B=false}};function q(S,G){var I=c.getHScrollbar();var J=I.getScrollPosition();if(G){S=I.getSteps()}if(J!==S){I.setScrollPosition(S);B=true}a=S}function s(S){var G=$('#'+c.getId()+"_lowerRight_scrollDiv");H=S?G[0].scrollWidth:0;t.positionHScrollDiv(G)}this.positionHScrollDiv=function(G){if(!G){G=$('#'+c.getId()+"_lowerRight_scrollDiv")}var U=$('#'+c.getId()+"_upperRight_scrollDiv");G.scrollLeft(H);U.scrollLeft(H)};this.vScrollHandler=function(G,N){if(!k){if(N){z(G)}else{L=G.getParameters();if(b){clearTimeout(b);b=null;x(L.newScrollPos)}b=setTimeout(z,200,null);i=L.newScrollPos}}else{k=false}};this.sendClientScrollPosUpdate=function(){c.getUtils().sendClientScrollPosUpdate(a,h,i,v)};function u(S){var C=c.getColumnHeaderArea();var G=null;var I=[];for(var J=0;J<1;J++){G=C.getCellWithColSpan(J,S,true);if(G){I.push(G.getUnescapedText())}else{I.push("?")}}var K=c.getPropertyBag().getText(sap.zen.crosstab.TextConstants.COL_TEXT_KEY)+" "+sap.zen.crosstab.utils.Utils.padWithZeroes(S+1,f)+"/"+C.getColCnt();if(!j){w(K);j=$('#'+p.getContent().getId()).innerWidth()}K=K+"\n"+I.join("\n");w(K)}function w(G){p.getContent().setProperty("text",G,true);var I=sap.ui.core.Popup.Dock;if(j){p.getContent().setWidth(j+"px")}var J=c.getHScrollbar();var W=m.getRenderSizeDivSize().iWidth-m.getAreaWidth(c.getRowHeaderArea());var P=$("#"+p.getContent().getId()).outerWidth();W=W-P;var K=J.getScrollPosition()/J.getSteps();var X=(W*K)+" ";p.setPosition(I.BeginBottom,I.BeginTop,$('#'+c.getHScrollbar().getId())[0],X+"-20");if(p.getOpenState()===sap.ui.core.OpenState.CLOSED){p.open(-1)}p.getContent().rerender()}function x(S){var R=c.getRowHeaderArea();var G=null;var I=[];for(var J=0;J<1;J++){G=R.getCellWithRowSpan(S,J,true);if(G){I.push(G.getUnescapedText())}else{I.push("?")}}var K=c.getPropertyBag().getText(sap.zen.crosstab.TextConstants.ROW_TEXT_KEY)+" "+sap.zen.crosstab.utils.Utils.padWithZeroes(S+1,e)+"/"+R.getRowCnt();if(!g){y(K);g=$('#'+p.getContent().getId()).innerWidth()}K=K+"\n"+I.join("\n");y(K)}function y(G){p.getContent().setProperty("text",G,true);var I=sap.ui.core.Popup.Dock;var J=c.getVScrollbar();var K=m.getRenderSizeDivSize().iHeight-m.getAreaHeight(c.getColumnHeaderArea());var P=$("#"+p.getContent().getId()).outerHeight();K=K-P;var M=J.getScrollPosition()/J.getSteps();var Y=" "+(K*M);p.setPosition(I.EndTop,I.BeginTop,$('#'+c.getVScrollbar().getId())[0],"-20"+Y);if(g){p.getContent().setWidth(g+"px")}if(p.getOpenState()===sap.ui.core.OpenState.CLOSED){p.open(-1)}p.getContent().rerender()}function z(G){c.getPageManager().enableTimeout(true);b=null;var P=null;if(!G){P=L}else{P=G.getParameters()}if(P){var I=c.getVScrollbar();var M=I.getSteps();v=P.newScrollPos===M;i=P.newScrollPos;t.sendClientScrollPosUpdate();var S=P.newScrollPos;if(S!==R.getRenderStartRow()){if(S!==R.getRowCnt()){r.beginRendering();r.renderRowHeaderArea(S);r.renderDataArea();r.adjustColWidths(d,R);r.adjustColWidths(C,D);r.adjustRowHeights(R,D);r.finishRendering()}var J=m.getAreaHeight(R);var K=m.getLowerScrollDivHeight();var N=J<K;var O=R.getRenderRowCnt()+R.getRenderStartRow()===R.getRowCnt();if(v||N&&O){if(N&&S>0){r.beginRendering();r.appendTopRows(R,2);r.appendTopRows(D,2);r.adjustColWidths(d,R);r.adjustColWidths(C,D);r.adjustRowHeights(R,D);r.finishRendering()}if(!v&&P.forward){E(0,true)}F(true)}else{F(false)}}else{if(v){F(true)}}if(P.newScrollPos===0){F(false)}if(h){s(true)}}p.close();A()}function A(){var G=c.getRenderEngine().getHeaderScrollManager();if(G){G.moveScrollbars()}}function E(S,G){var I=c.getVScrollbar();var J=I.getScrollPosition();if(G){S=I.getSteps()}if(J!==S){I.setScrollPosition(S);k=true}i=S}function F(S){var G=$('#'+c.getId()+"_lowerRight_scrollDiv");V=S?G[0].scrollHeight:0;t.positionVScrollDiv(G)}this.positionVScrollDiv=function(G){if(!G){G=$('#'+c.getId()+"_lowerRight_scrollDiv")}var I=$('#'+c.getId()+"_lowerLeft_scrollDiv");G.scrollTop(V);I.scrollTop(V)};this.moveScrollbars=function(S,G,I,J){var K=c.getHScrollbar();if(K){if(I!==undefined){h=I}else{h=(K.getSteps()<=a)&&(C.getRenderStartCol()+C.getRenderColCnt()>=C.getColCnt())}if(h){q(0,true);s(true)}else{q(a,false)}}var M=c.getVScrollbar();if(M){if(J!==undefined){v=J}else{v=(M.getSteps()<=i)&&(R.getRenderStartRow()+R.getRenderRowCnt()>=R.getRowCnt())}if(v){E(0,true);F(true)}else{E(i,false)}}};this.commandHScrolledToEnd=function(){h=true};this.commandVScrolledToEnd=function(){v=true};this.isVScrolledToEnd=function(){return v};this.isHScrolledToEnd=function(){return h};this.setVScrolledToEnd=function(G){v=G};this.setHScrolledToEnd=function(G){h=G}};
