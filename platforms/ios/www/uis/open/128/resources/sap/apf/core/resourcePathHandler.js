/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
jQuery.sap.declare("sap.apf.core.resourcePathHandler");jQuery.sap.require("sap.apf.core.utils.checkForTimeout");jQuery.sap.require("sap.apf.utils.hashtable");jQuery.sap.require("sap.apf.core.messageHandler");jQuery.sap.require("sap.apf.core.messageDefinition");
sap.apf.core.ResourcePathHandler=function(i){'use strict';var t=this;var c=i.coreApi;var m=i.messageHandler;var h=new sap.apf.utils.Hashtable(m);var C;var p;var s=null;var a="";var b=false;k();function f(u){var F=false;jQuery.ajax({url:u,type:"HEAD",success:function(D,S,J){var M=sap.apf.core.utils.checkForTimeout(J);F=!M},error:function(){F=false},async:false});return F}this.getApplicationConfigurationURL=function(){return a};this.loadConfigFromFilePath=function(F){if(b){return};var u=F;a=F;jQuery.ajax({url:u,dataType:"json",success:n,error:function(J,S,E){var M=m.createMessageObject({code:sap.apf.core.constants.message.code.errorLoadingRessource,rawText:"Error "+E+" when loading the configuration of the resource location: "+u});m.putMessage(M)},async:false});e();d();b=true;function n(D,S,J){var M=sap.apf.core.utils.checkForTimeout(J);if(M){m.putMessage(m.createMessageObject({code:sap.apf.core.constants.message.code.errorStartUp,rawText:"Timeout when loading application configuration from "+F+"."}))}if(!D||!D.applicationConfiguration){m.putMessage(m.createMessageObject({code:sap.apf.core.constants.message.code.errorStartUp,rawText:"The application configuration from "+F+" has no valid format."}));return}if(D.applicationConfiguration.textResourceLocations===undefined){m.putMessage(m.createMessageObject({code:sap.apf.core.constants.message.code.errorStartUp,rawText:"The textResourceLocations is missing in the application configuration from "+F+"."}));return}var A=D.applicationConfiguration;o(A);var T=D.applicationConfiguration.textResourceLocations;p=D.applicationConfiguration.persistence;g(p);if(D.applicationConfiguration.smartBusiness){s=D.applicationConfiguration.smartBusiness;j(s)}var q;var u;for(var P in sap.apf.core.constants.resourceLocation){if(!sap.apf.core.constants.resourceLocation.hasOwnProperty(P)){continue}if(A[P]!==undefined){u=A[P]}else{if(T[P]!==undefined){u=T[P]}else{continue}}if(f(u)){h.setItem(P,u)}else{q=m.createMessageObject({code:sap.apf.core.constants.message.code.wrongRessourcePath,rawText:"The path "+u+" for resource location "+P+"is not valid."});m.putMessage(q)}}}function o(A){C=jQuery.extend(true,{},A);delete C.type;delete C.analyticalConfigurationLocation;delete C.applicationMessageDefinitionLocation;delete C.textResourceLocations;delete C.persistence}};function d(){var u=t.getResourceLocation(sap.apf.core.constants.resourceLocation.analyticalConfigurationLocation);var M;if(u!==""){jQuery.ajax({url:u,dataType:"json",success:n,error:function(J,S,E){M=m.createMessageObject({code:sap.apf.core.constants.message.code.errorLoadingAnalyticalConfig,rawText:"Error "+E+" when loading analytical configuration file"+u});m.putMessage(M)},async:false})}else{M=m.createMessageObject({code:sap.apf.core.constants.message.code.missingAnalyticalConfig,rawText:"No analytical configuration defined in the application configuration"});m.putMessage(M)}function n(D,S,J){var o=sap.apf.core.utils.checkForTimeout(J);if(!o){if(D){c.loadAnalyticalConfiguration(D)}else{m.putMessage(m.createMessageObject({code:sap.apf.core.constants.message.code.errorLoadingAnalyticalConfig,rawText:"Undefined analytical configuration file"+u}))}}else{m.putMessage(m.createMessageObject({code:sap.apf.core.constants.message.code.errorLoadingAnalyticalConfig,rawText:"Timeout error when loading analytical configuration file"+u}))}}}function e(){c.loadMessageConfiguration(sap.apf.core.messageDefinition,true);l(sap.apf.core.constants.resourceLocation.applicationMessageDefinitionLocation,false)}function l(r,R){var u=t.getResourceLocation(r);if(u!==""){jQuery.ajax({url:u,dataType:"json",success:n,error:function(J,S,E){var M=m.createMessageObject({code:sap.apf.core.constants.message.code.errorLoadingAnalyticalConfig,rawText:"Error "+E+" when loading message configuration file"+u});m.putMessage(M)},async:false})}function n(D,S,J){var M;var o=sap.apf.core.utils.checkForTimeout(J);if(!o){if(D.messageConfiguration){c.loadMessageConfiguration(D.messageConfiguration.definitions,R)}}else{M=m.createMessageObject({code:sap.apf.core.constants.message.code.errorLoadingAnalyticalConfig,rawText:"Timeout error when loading message configuration file"+u});m.putMessage(M)}}}function g(o){var M;if(!o||!o.path){M=m.createMessageObject({code:sap.apf.core.constants.message.code.errorInAnalyticalConfig,rawText:"persistence path configuration is missing in the application configuration"});m.putMessage(M)}if(!o.path.service){M=m.createMessageObject({code:sap.apf.core.constants.message.code.errorInAnalyticalConfig,rawText:"service in persistence path configuration is missing"});m.putMessage(M)}if(!o.path.entityType){M=m.createMessageObject({code:sap.apf.core.constants.message.code.errorInAnalyticalConfig,rawText:"entity type in persistence path configuration is missing"});m.putMessage(M)}if(!o.path.type||o.path.type!=="persistenceRequest"){M=m.createMessageObject({code:sap.apf.core.constants.message.code.errorInAnalyticalConfig,rawText:"type in persistence path configuration is not persistenceRequest"});m.putMessage(M)}if(!o.logicalSystem){M=m.createMessageObject({code:sap.apf.core.constants.message.code.errorInAnalyticalConfig,rawText:"logical system configuration is missing in the application configuration"});m.putMessage(M)}if(!o.logicalSystem.service||!o.logicalSystem.entityType){M=m.createMessageObject({code:sap.apf.core.constants.message.code.errorInAnalyticalConfig,rawText:"service or entityType are missing in logical system configuration  in the application configuration"});m.putMessage(M)}}function j(o){var M;if(o.evaluations&&!o.evaluations.service){M=m.createMessageObject({code:sap.apf.core.constants.message.code.errorInAnalyticalConfig,rawText:"service in Smart Business service root configuration is missing"});m.putMessage(M)}if(o.evaluations&&(!o.evaluations.type||o.evaluations.type!=="smartBusinessRequest")){M=m.createMessageObject({code:sap.apf.core.constants.message.code.errorInAnalyticalConfig,rawText:"type in Smart Business configuration is not smartBusinessRequest"});m.putMessage(M)}if(o.evaluations&&!o.evaluations.entityType){M=m.createMessageObject({code:sap.apf.core.constants.message.code.errorInAnalyticalConfig,rawText:"entityType in Smart Business service root configuration is missing"});m.putMessage(M)}}this.getResourceLocation=function(r){return h.getItem(r)};this.getPersistenceConfiguration=function(){m.check(b,"RessourcePathHandler: configuration must be loaded before access to ressources");return p};this.getConfigurationProperties=function(){return C};function k(){var A=c.getUriGenerator().getApfLocation();h.setItem(sap.apf.core.constants.resourceLocation.apfUiTextBundle,A+"resources/i18n/apfUi.properties");h.setItem(sap.apf.core.constants.resourceLocation.applicationMessageDefinitionLocation,"");h.setItem(sap.apf.core.constants.resourceLocation.applicationMessageTextBundle,"");h.setItem(sap.apf.core.constants.resourceLocation.applicationUiTextBundle,"");h.setItem(sap.apf.core.constants.resourceLocation.analyticalConfigurationLocation,"")}};
