jQuery.sap.declare("sap.suite.ui.smartbusiness.tiles.MeasureComparison");jQuery.sap.require("sap.suite.ui.smartbusiness.tiles.Generic");sap.suite.ui.smartbusiness.tiles.Generic.extend("sap.suite.ui.smartbusiness.tiles.MeasureComparison",{metadata:{properties:{kpiValueRequired:{type:"boolean",defaultValue:false},tileType:{type:"string",defaultValue:"CM"}}},renderer:{}});
sap.suite.ui.smartbusiness.tiles.MeasureComparison.prototype.init=function(){sap.suite.ui.smartbusiness.tiles.Generic.prototype.init.apply(this);this._bShowUOM=false;this._bUseFormattedVDMValue=false;this._bShowKpiMeasureUOMInFooter=false;this._bHasKpiMeasure=null;this.setAggregation("_tile",new sap.suite.ui.commons.GenericTile({header:"{/header}",subheader:"{/subheader}",size:this.getSize(),frameType:this.getFrameType(),tileContent:new sap.suite.ui.commons.TileContent({unit:"{/unit}",size:this.getSize(),footer:"{/footerNum}",content:new sap.suite.ui.commons.ComparisonChart({scale:"{/scale}",size:this.getSize(),state:"{/state}",data:{template:new sap.suite.ui.commons.ComparisonData({title:"{title}",value:"{value}",color:"{color}",displayValue:"{displayValue}"}),path:"/data"}})}),press:jQuery.proxy(this.tilePressed,this)}));this.jsonModel=new sap.ui.model.json.JSONModel();this.setModel(this.jsonModel)};
sap.suite.ui.smartbusiness.tiles.MeasureComparison.prototype.onBeforeRendering=function(){sap.suite.ui.smartbusiness.tiles.Generic.prototype.onBeforeRendering.apply(this);if(this.getContentOnly()){this.setAggregation("_tile",new sap.suite.ui.commons.ComparisonChart({scale:"{/scale}",size:this.getSize(),state:"{/state}",data:{template:new sap.suite.ui.commons.ComparisonData({title:"{title}",value:"{value}",color:"{color}",displayValue:"{displayValue}"}),path:"/data"}}))}};
sap.suite.ui.smartbusiness.tiles.MeasureComparison.prototype.doProcess=function(){var t=this;this._fetchDataForMeasureComparisonTile(function(c){var j={};this._processedComparisionData=this._processMeasureComparisionData(c);j.data=this._processedComparisionData;if(true||t.isAssociatedKpi()){j.subheader=this.evaluationApi.getTitle();j.header=this.evaluationApi.getKpiName()}if(this._bShowKpiMeasureUOMInFooter&&this._bHasKpiMeasure){var k=this.UOM_PROPERTY_MAPPING[this.evaluationApi.getKpiMeasureName()];if(k){j.unit=c[k]}}t.jsonModel.setData(j);t.setDoneState()},this.logError)};
sap.suite.ui.smartbusiness.tiles.MeasureComparison.prototype._fetchDataForMeasureComparisonTile=function(s,e){var t=this;var _=function(a){var m=[];if(a&&a.MEASURES&&a.MEASURES.length){var c=a.MEASURES;for(var i=0,l=c.length;i<l;i++){m.push(c[i].name)}}if(m.length){return m}else{throw new Error("No Measures Defined for Measure Comparision Tile")}};var p={};p.serviceUri=this._addSystemAliasToUri(this.evaluationApi.getODataUrl(),this.getSapSystem());p.entitySet=this.evaluationApi.getEntitySet();p.measure=_(this.getTileConfiguration());if(p.measure.indexOf(this.evaluationApi.getKpiMeasureName())>-1){this._bHasKpiMeasure=true}p.filter=this.getAllFilters();var f=sap.suite.smartbusiness.odata.getUri(p);this.comparisionChartODataRef=f.model.read(f.uri,null,null,true,function(d){if(d&&d.results&&d.results.length){s.call(t,d.results[0])}else{e.call(t,"no Response from QueryServiceUri")}},function(a){if(a&&a.response){jQuery.sap.log.error(a.message+" : "+a.request.requestUri)}})};
sap.suite.ui.smartbusiness.tiles.MeasureComparison.prototype._processMeasureComparisionData=function(r){var p=[],f,V,U,m,a,i,b,o;b=this.getTileConfiguration().MEASURES;for(i=0,l=b.length;i<l;i++){o={};a=b[i].name;m=this.LABEL_PROPERTY_MAPPING[a];o["title"]=m;U=this.UOM_PROPERTY_MAPPING[a];V=this.TEXT_PROPERTY_MAPPING[a];if(this._bUseFormattedVDMValue&&V&&(V!=a)){f=r[V]}else{f=sap.suite.smartbusiness.utils.getLocaleFormattedValue(Number(r[a]))}o.value=Number(r[a]);o.displayValue=""+f;if(this._bShowUOM&&U){o.displayValue+=" "+r[U]}o.color=b[i].color;p.push(o)}return p};
sap.suite.ui.smartbusiness.tiles.MeasureComparison.prototype.doDummyProcess=function(){this.jsonModel.setData(this.getDummyDataForMeasureComparisonTile())};
