jQuery.sap.declare("sap.suite.ui.smartbusiness.tiles.AreaChart");jQuery.sap.require("sap.suite.ui.smartbusiness.tiles.Generic");sap.suite.ui.smartbusiness.tiles.Generic.extend("sap.suite.ui.smartbusiness.tiles.AreaChart",{metadata:{properties:{kpiValueRequired:{type:"boolean",defaultValue:false},tileType:{type:"string",defaultValue:"TT"}}},renderer:{}});
sap.suite.ui.smartbusiness.tiles.AreaChart.prototype.init=function(){sap.suite.ui.smartbusiness.tiles.Generic.prototype.init.apply(this);var b=function(n){return new sap.suite.ui.commons.MicroAreaChartItem({color:"Neutral",points:{path:"/"+n+"/data",template:new sap.suite.ui.commons.MicroAreaChartPoint({x:"{day}",y:"{balance}"})}})};var a=function(n){return new sap.suite.ui.commons.MicroAreaChartLabel({label:"{/"+n+"/label}",color:"{/"+n+"/color}"})};this.setAggregation("_tile",new sap.suite.ui.commons.GenericTile({header:"{/header}",subheader:"{/subheader}",size:this.getSize(),frameType:this.getFrameType(),tileContent:new sap.suite.ui.commons.TileContent({unit:"{/unit}",size:this.getSize(),footer:"{/footerNum}",content:new sap.suite.ui.commons.MicroAreaChart({width:"{/width}",height:"{/height}",size:this.getSize(),target:b("target"),innerMinThreshold:b("innerMinThreshold"),innerMaxThreshold:b("innerMaxThreshold"),minThreshold:b("minThreshold"),maxThreshold:b("maxThreshold"),chart:b("chart"),minXValue:"{/minXValue}",maxXValue:"{/maxXValue}",minYValue:"{/minYValue}",maxYValue:"{/maxYValue}",firstXLabel:a("firstXLabel"),lastXLabel:a("lastXLabel"),firstYLabel:a("firstYLabel"),lastYLabel:a("lastYLabel"),minLabel:a("minLabel"),maxLabel:a("maxLabel"),})}),press:jQuery.proxy(this.tilePressed,this)}));this.jsonModel=new sap.ui.model.json.JSONModel();this.setModel(this.jsonModel)};
sap.suite.ui.smartbusiness.tiles.AreaChart.prototype.onBeforeRendering=function(){sap.suite.ui.smartbusiness.tiles.Generic.prototype.onBeforeRendering.apply(this);if(this.getContentOnly()){var b=function(n){return new sap.suite.ui.commons.MicroAreaChartItem({color:"Neutral",points:{path:"/"+n+"/data",template:new sap.suite.ui.commons.MicroAreaChartPoint({x:"{day}",y:"{balance}"})}})};var a=function(n){return new sap.suite.ui.commons.MicroAreaChartLabel({label:"{/"+n+"/label}",color:"{/"+n+"/color}"})};this.setAggregation("_tile",new sap.suite.ui.commons.TileContent({unit:"",size:this.getSize(),footer:"",content:new sap.suite.ui.commons.MicroAreaChart({width:"{/width}",height:"{/height}",size:this.getSize(),target:b("target"),innerMinThreshold:b("innerMinThreshold"),innerMaxThreshold:b("innerMaxThreshold"),minThreshold:b("minThreshold"),maxThreshold:b("maxThreshold"),chart:b("chart"),minXValue:"{/minXValue}",maxXValue:"{/maxXValue}",minYValue:"{/minYValue}",maxYValue:"{/maxYValue}",firstXLabel:a("firstXLabel"),lastXLabel:a("lastXLabel"),firstYLabel:a("firstYLabel"),lastYLabel:a("lastYLabel"),minLabel:a("minLabel"),maxLabel:a("maxLabel"),})}))}};
sap.suite.ui.smartbusiness.tiles.AreaChart.prototype.getEvalValueMeasureName=function(c,t,r){var e=c.VALUES.results;for(var i=0;i<e.length;i++){if(e[i].TYPE==t)if(r==="FIXED")return e[i].FIXED;else return e[i].COLUMN_NAME}};
sap.suite.ui.smartbusiness.tiles.AreaChart.prototype.doProcess=function(){var t=this;this._fetchDataForAreaChartTile(function(m){var d={};if(true||t.isAssociatedKpi()){d.subheader=this.oConfig.TITLE;d.header=this.oConfig.INDICATOR_TITLE}d=jQuery.extend({},d,m);t.jsonModel.setData(d);t.setDoneState()},this.logError)};
sap.suite.ui.smartbusiness.tiles.AreaChart.prototype._fetchDataForAreaChartTile=function(s,e){var t=this;var p={};this.oConfig=this.EVALUATION_DATA;p.serviceUri=this._addSystemAliasToUri(this.oConfig.ODATA_URL,this.getSapSystem());p.entitySet=this.oConfig.ODATA_ENTITYSET;p.measure=this.oConfig.COLUMN_NAME;p.dimension=this.getDimension();if(!this.getDimension()){this.logError("Dimension is Missing : Can't Render Area Chart");return}p.filter=this.getAllFilters();if(this.oConfig.VALUES_SOURCE=="MEASURE"){var f=t.oConfig.COLUMN_NAME;switch(t.oConfig.GOAL_TYPE){case"MI":t.sWarningHigh=t.getEvalValueMeasureName(t.oConfig,"WH","MEASURE");t.sCriticalHigh=t.getEvalValueMeasureName(t.oConfig,"CH","MEASURE");t.sTarget=t.getEvalValueMeasureName(t.oConfig,"TA","MEASURE");t.sTrend=t.getEvalValueMeasureName(t.oConfig,"TC","MEASURE");break;case"MA":t.sWarningLow=t.getEvalValueMeasureName(t.oConfig,"WL","MEASURE");t.sCriticalLow=t.getEvalValueMeasureName(t.oConfig,"CL","MEASURE");t.sTarget=t.getEvalValueMeasureName(t.oConfig,"TA","MEASURE");t.sTrend=t.getEvalValueMeasureName(t.oConfig,"TC","MEASURE");break;case"RA":t.sWarningHigh=t.getEvalValueMeasureName(t.oConfig,"WH","MEASURE");t.sCriticalHigh=t.getEvalValueMeasureName(t.oConfig,"CH","MEASURE");t.sTarget=t.getEvalValueMeasureName(t.oConfig,"TA","MEASURE");t.sTrend=t.getEvalValueMeasureName(t.oConfig,"TC","MEASURE");t.sWarningLow=t.getEvalValueMeasureName(t.oConfig,"WL","MEASURE");t.sCriticalLow=t.getEvalValueMeasureName(t.oConfig,"CL","MEASURE");break}var _=[t.sWarningHigh,t.sCriticalHigh,t.sTarget,t.sTrend,t.sWarningLow,t.sCriticalLow];_.forEach(function(c){if(c){f+=","+c}},this);p.measure=f}var a=sap.suite.smartbusiness.odata.getUri(p);var U=this.UOM_PROPERTY_MAPPING[this.oConfig.COLUMN_NAME];var b="";this.areaChartODataRef=a.model.read(a.uri,null,null,true,function(d){if(d&&d.results&&d.results.length){if(U){b=d.results[0][U]}p.dimension=t.TEXT_PROPERTY_MAPPING[t.getDimension()];var m=t._processDataForAreaChart(d,t.oConfig.VALUES_SOURCE,p.dimension,t.oConfig.COLUMN_NAME);m.unit=b;s.call(t,m)}else{e.call(t,"no Response from QueryServiceUri")}},function(c){if(c&&c.response){jQuery.sap.log.error(c.message+" : "+c.request.requestUri)}})};
sap.suite.ui.smartbusiness.tiles.AreaChart.prototype._processDataForAreaChart=function(d,t,c,m){var f=this;var g=f.oConfig.VALUES.results;var h=[];var j=[];var w=[];var k=[];var l=[];var n=[];var o=d.results.length;var s=f.oConfig.SCALING;var p=d.results[0][c];var q,r,u,v,x;var y=d.results[d.results.length-1][c];var z=Number(d.results[0][m]);var A=Number(d.results[d.results.length-1][m]);var B=f.oConfig.GOAL_TYPE;for(i in d.results){d.results[i][c]=Number(i);d.results[i][m]=Number(d.results[i][m]);f.sWarningHigh?d.results[i][f.sWarningHigh]=Number(d.results[i][f.sWarningHigh]):"";f.sCriticalHigh?d.results[i][f.sCriticalHigh]=Number(d.results[i][f.sCriticalHigh]):"";f.sCriticalLow?d.results[i][f.sCriticalLow]=Number(d.results[i][f.sCriticalLow]):"";f.sWarningLow?d.results[i][f.sWarningLow]=Number(d.results[i][f.sWarningLow]):"";f.sTarget?d.results[i][f.sTarget]=Number(d.results[i][f.sTarget]):"";f.sWarningHigh?w.push(d.results[i][f.sWarningHigh]):"";f.sCriticalHigh?k.push(d.results[i][f.sCriticalHigh]):"";f.sCriticalLow?l.push(d.results[i][f.sCriticalLow]):"";f.sWarningLow?n.push(d.results[i][f.sWarningLow]):"";h.push(d.results[i][c]);j.push(d.results[i][m])}try{p=f.formatOdataObjectToString(p);y=f.formatOdataObjectToString(y)}catch(e){f.logError(e)}var C=Math.min.apply(Math,j);var S="";var D=z;if(this.oConfig.SCALING==-2)D*=100;var E=sap.suite.smartbusiness.utils.getLocaleFormattedValue(D,this.oConfig.SCALING);var F=E.toString();if(this.oConfig.SCALING==-2)F+=" %";var G=Math.max.apply(Math,j);D=A;if(this.oConfig.SCALING==-2)D*=100;sap.ui.getCore().byId("m1e1 title");var H=sap.suite.smartbusiness.utils.getLocaleFormattedValue(D,this.oConfig.SCALING);var I=H.toString();if(this.oConfig.SCALING==-2)I+=" %";try{var J=f.formatOdataObjectToString(Math.min.apply(Math,h));var K=f.formatOdataObjectToString(Math.max.apply(Math,h))}catch(e){f.logError(e)}if(t=="MEASURE"){(w.length!=0)?(f.firstwH=w[J])&&(f.lastwH=w[K]):"";(k.length!=0)?(f.firstcH=k[J])&&(f.lastcH=k[K]):"";(l.length!=0)?(f.firstcL=l[J])&&(f.lastcL=l[K]):"";(n.length!=0)?(f.firstwL=n[J])&&(f.lastwL=n[K]):""}var L={width:"100%",height:"100%",unit:f.unit||"",chart:{color:"Neutral",data:d.results},minXValue:J,maxXValue:K,minYValue:C,maxYValue:G,firstXLabel:{label:p+"",color:"Neutral"},lastXLabel:{label:y+"",color:"Neutral"},firstYLabel:{label:F+"",color:"Neutral"},lastYLabel:{label:I+"",color:"Neutral"},minLabel:{},maxLabel:{}};switch(B){case"MA":for(i in g){if(g[i].TYPE=="CL"){L.minThreshold={color:"Error",};var M=new Object();M[c]="";M[m]=Number(g[i].FIXED);f.cl=Number(g[i].FIXED);L.minThreshold.data=(t=="MEASURE")?d.results:[M];q=(t=="MEASURE")?f.sCriticalLow:m}else if(g[i].TYPE=="WL"){L.maxThreshold={color:"Good"};var M=new Object();M[c]="";M[m]=Number(g[i].FIXED);L.maxThreshold.data=(t=="MEASURE")?d.results:[M];r=(t=="MEASURE")?f.sWarningLow:m;f.wl=Number(g[i].FIXED)}else if(g[i].TYPE=="TA"){var M=new Object();M[c]="";M[m]=Number(g[i].FIXED);L.target={color:"Neutral",};L.target.data=(t=="MEASURE")?d.results:[M];x=(t=="MEASURE")?f.sTarget:m}}L.innerMinThreshold={data:[]};L.innerMaxThreshold={data:[]};if(t=="FIXED"){L.firstYLabel.color=z<f.cl?"Error":((f.cl<=z)&&(z<=f.wl))?"Critical":(z>f.wl)?"Good":"Neutral";L.lastYLabel.color=A<f.cl?"Error":((f.cl<=A)&&(A<=f.wl))?"Critical":(A>f.wl)?"Good":"Neutral"}else if(t=="MEASURE"&&f.firstwL&&f.lastwL&&f.firstcL&&f.lastcL){L.firstYLabel.color=z<f.firstcL?"Error":((f.firstcL<=z)&&(z<=f.firstwL))?"Critical":(z>f.firstwL)?"Good":"Neutral";L.lastYLabel.color=A<f.lastcL?"Error":((f.lastcL<=A)&&(A<=f.lastwL))?"Critical":(A>f.lastwL)?"Good":"Neutral"}break;case"MI":for(i in g){if(g[i].TYPE=="CH"){var M=new Object();M[c]="";M[m]=Number(g[i].FIXED);f.ch=Number(g[i].FIXED);L.maxThreshold={color:"Error",};L.maxThreshold.data=(t=="MEASURE")?d.results:[M];r=(t=="MEASURE")?f.sCriticalHigh:m}else if(g[i].TYPE=="WH"){var M=new Object();M[c]="";M[m]=Number(g[i].FIXED);f.wh=Number(g[i].FIXED);L.minThreshold={color:"Good",};L.minThreshold.data=(t=="MEASURE")?d.results:[M];q=(t=="MEASURE")?f.sWarningHigh:m}else if(g[i].TYPE=="TA"){var M=new Object();M[c]="";M[m]=Number(g[i].FIXED);L.target={color:"Neutral",};L.target.data=(t=="MEASURE")?d.results:[M];x=(t=="MEASURE")?f.sTarget:m}}if(t=="FIXED"){L.firstYLabel.color=z>f.ch?"Error":((f.wh<=z)&&(z<=f.ch))?"Critical":(z<f.wh)?"Good":"Neutral";L.lastYLabel.color=A>f.ch?"Error":((f.wh<=A)&&(A<=f.ch))?"Critical":(A<f.wh)?"Good":"Neutral"}else if(t=="MEASURE"&&f.firstwH&&f.lastwH&&f.firstcH&&f.lastcH){L.firstYLabel.color=z>f.firstcH?"Error":((f.firstwH<=z)&&(z<=f.firstcH))?"Critical":(z<f.firstwH)?"Good":"Neutral";L.lastYLabel.color=A>f.lastcH?"Error":((f.lastwH<=A)&&(A<=f.lastcH))?"Critical":(A<f.lastwH)?"Good":"Neutral"}L.innerMaxThreshold={data:[]};L.innerMinThreshold={data:[]};break;case"RA":for(i in g){if(g[i].TYPE=="CH"){var M=new Object();M[c]="";M[m]=Number(g[i].FIXED);f.ch=Number(g[i].FIXED);L.maxThreshold={color:"Error",};L.maxThreshold.data=(t=="MEASURE")?d.results:[M];r=(t=="MEASURE")?f.sCriticalHigh:m}else if(g[i].TYPE=="WH"){var M=new Object();M[c]="";M[m]=Number(g[i].FIXED);f.wh=Number(g[i].FIXED);L.innerMaxThreshold={color:"Good",};L.innerMaxThreshold.data=(t=="MEASURE")?d.results:[M];v=(t=="MEASURE")?f.sWarningHigh:m}else if(g[i].TYPE=="WL"){var M=new Object();M[c]="";M[m]=Number(g[i].FIXED);f.wl=Number(g[i].FIXED);L.innerMinThreshold={color:"Good",};L.innerMinThreshold.data=(t=="MEASURE")?d.results:[M];u=(t=="MEASURE")?f.sWarningLow:m}else if(g[i].TYPE=="CL"){var M=new Object();M[c]="";M[m]=Number(g[i].FIXED);f.cl=Number(g[i].FIXED);L.minThreshold={color:"Error",};L.minThreshold.data=(t=="MEASURE")?d.results:[M];q=(t=="MEASURE")?f.sCriticalLow:m}else if(g[i].TYPE=="TA"){var M=new Object();M[c]="";M[m]=Number(g[i].FIXED);L.target={color:"Neutral",};L.target.data=(t=="MEASURE")?d.results:[M];x=(t=="MEASURE")?f.sTarget:m}}if(t=="FIXED"){L.firstYLabel.color=(z>f.ch||z<f.cl)?"Error":((f.wh<=z)&&(z<=f.ch))||((f.cl<=z)&&(z<=f.wl))?"Critical":((z>=f.wl)&&(z<=f.wh))?"Good":"Neutral";L.lastYLabel.color=(A>f.ch||A<f.cl)?"Error":((f.wh<=A)&&(A<=f.ch))||((f.cl<=A)&&(A<=f.wl))?"Critical":((A>=f.wl)&&(A<=f.wh))?"Good":"Neutral"}else if(t=="MEASURE"&&f.firstwL&&f.lastwL&&f.firstcL&&f.lastcL&&f.firstwH&&f.lastwH&&f.firstcH&&f.lastcH){L.firstYLabel.color=(z>f.firstcH||z<f.firstcL)?"Error":((f.firstwH<=z)&&(z<=f.firstcH))||((f.firstcL<=z)&&(z<=f.firstwL))?"Critical":((z>=f.firstwL)&&(z<=f.firstwH))?"Good":"Neutral";L.lastYLabel.color=(A>f.lastcH||A<f.lastcL)?"Error":((f.lastwH<=A)&&(A<=f.lastcH))||((f.lastcL<=A)&&(A<=f.lastwL))?"Critical":((A>=f.lastwL)&&(A<=f.lastwH))?"Good":"Neutral"}break}var N=function(P,a,b,t){return new sap.suite.ui.commons.MicroAreaChartItem({color:"{/"+P+"/color}",points:{path:"/"+P+"/data",template:new sap.suite.ui.commons.MicroAreaChartPoint({x:"{"+a+"}",y:"{"+b+"}"})}})};var O=null;if(this.getContentOnly()){O=f.getTileControl()}else{O=f.getTileControl().getTileContent()[0].getContent()}O.setTarget(N("target",c,x));O.setInnerMinThreshold(N("innerMinThreshold",c,u));O.setInnerMaxThreshold(N("innerMaxThreshold",c,v));O.setMinThreshold(N("minThreshold",c,q));O.setMaxThreshold(N("maxThreshold",c,r));O.setChart(N("chart",c,m));return L};
sap.suite.ui.smartbusiness.tiles.AreaChart.prototype.doDummyProcess=function(){this.jsonModel.setData(this.getDummyDataForAreaChartTile())};
