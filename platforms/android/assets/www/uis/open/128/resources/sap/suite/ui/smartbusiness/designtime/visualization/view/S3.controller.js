jQuery.sap.require("sap.ca.scfld.md.controller.BaseDetailController");jQuery.sap.require("sap.m.MessageBox");sap.ca.scfld.md.controller.BaseDetailController.extend("sap.suite.ui.smartbusiness.designtime.visualization.view.S3",{onInit:function(){var t=this;var v=this.getView();this.oRouter.attachRouteMatched(function(e){if(e.getParameter("name")==="detail"){t.selectedTile=undefined;var c=new sap.ui.model.Context(v.getModel(),'/'+e.getParameter("arguments").contextPath);v.setBindingContext(c)}},this);var t=this;this.oHeaderFooterOptions={bSuppressBookmarkButton:{},oEditBtn:{sI18nBtnTxt:t.oApplicationFacade.getResourceBundle().getText("FULLSCREEN_TITLE"),onBtnPressed:function(e){sap.suite.smartbusiness.utils.replaceHash({action:"configureSBKPITile",route:"addTile",context:t.getView().getBindingContext().sPath.substr(1)})},bEnabled:false,},buttonList:[]}},getHeaderFooterOptions:function(){return this.oHeaderFooterOptions},getChipRow:function(i,c){var t=this;var a;var b;var d=JSON.parse(JSON.parse(JSON.parse(c.getObject().configuration).tileConfiguration).TILE_PROPERTIES);var n=new sap.m.Text();if(d.navType=="0"){n.setText(t.oApplicationFacade.getResourceBundle().getText("GENERIC_DRILLDOWN"))}else{n.setText(t.oApplicationFacade.getResourceBundle().getText("OTHER_DRILLDOWN"))}var s=new sap.m.ObjectNumber();if(c.getObject().COUNTER=="1"){if(c.getObject().isActive){s.setNumber(t.oApplicationFacade.getResourceBundle().getText("STATUS_ACTIVE"));s.setState("Success")}else{s.setNumber(t.oApplicationFacade.getResourceBundle().getText("STATUS_NEW"));s.setState("None")}}else{s.setNumber(t.oApplicationFacade.getResourceBundle().getText("STATUS_ACTIVE_DRAFT"));s.setState("Success")}var f;var e;if(Number(d.navType)){e=true}else{e=false}if(c.getProperty("tileType")=="NT")a=new sap.suite.ui.commons.NumericContent({size:"S",value:"0.0",scale:"M",valueColor:"Good",unit:t.oApplicationFacade.getResourceBundle().getText("TILE_CURRENCY"),footer:t.oApplicationFacade.getResourceBundle().getText("ACTUAL")});else if(c.getProperty("tileType")=="CT")a=new sap.suite.ui.commons.ComparisonChart({scale:"M",size:"S",data:[new sap.suite.ui.commons.ComparisonData({title:t.oApplicationFacade.getResourceBundle().getText("VALUE_1"),value:1550}),new sap.suite.ui.commons.ComparisonData({title:t.oApplicationFacade.getResourceBundle().getText("VALUE_2"),value:219.2}),new sap.suite.ui.commons.ComparisonData({title:t.oApplicationFacade.getResourceBundle().getText("VALUE_3"),value:66.46})]});else if(c.getProperty("tileType")=="AT")a=new sap.suite.ui.commons.BulletChart({scale:"M",size:"S",minValue:0,maxvalue:312,targetValue:150,actual:new sap.suite.ui.commons.BulletChartData({value:312,color:"Error"}),thresholds:[new sap.suite.ui.commons.BulletChartData({value:312,color:"Error"}),new sap.suite.ui.commons.BulletChartData({value:200,color:"Critical"})]});else if(c.getProperty("tileType")=="TT")a=new sap.suite.ui.commons.MicroAreaChart({size:"S",width:"130px",height:"59px",minXValue:0,maxXValue:100,minYValue:0,maxYValue:100,firstXLabel:new sap.suite.ui.commons.MicroAreaChartLabel({label:"Jan 1",color:"Neutral"}),lastXLabel:new sap.suite.ui.commons.MicroAreaChartLabel({label:"Jan 31",color:"Neutral"}),firstYLabel:new sap.suite.ui.commons.MicroAreaChartLabel({label:"3 M",color:"Error"}),lastYLabel:new sap.suite.ui.commons.MicroAreaChartLabel({label:"23 M",color:"Good"}),target:new sap.suite.ui.commons.MicroAreaChartItem({points:[new sap.suite.ui.commons.MicroAreaChartPoint({x:0,y:0}),new sap.suite.ui.commons.MicroAreaChartPoint({x:30,y:30}),new sap.suite.ui.commons.MicroAreaChartPoint({x:60,y:40}),new sap.suite.ui.commons.MicroAreaChartPoint({x:100,y:90})]}),innerMinThreshold:new sap.suite.ui.commons.MicroAreaChartItem({color:"Good"}),innerMaxThreshold:new sap.suite.ui.commons.MicroAreaChartItem({color:"Good"}),minThreshold:new sap.suite.ui.commons.MicroAreaChartItem({color:"Error",points:[new sap.suite.ui.commons.MicroAreaChartPoint({x:0,y:0}),new sap.suite.ui.commons.MicroAreaChartPoint({x:30,y:40}),new sap.suite.ui.commons.MicroAreaChartPoint({x:60,y:50}),new sap.suite.ui.commons.MicroAreaChartPoint({x:100,y:100})]}),maxThreshold:new sap.suite.ui.commons.MicroAreaChartItem({color:"Error",points:[new sap.suite.ui.commons.MicroAreaChartPoint({x:0,y:0}),new sap.suite.ui.commons.MicroAreaChartPoint({x:30,y:20}),new sap.suite.ui.commons.MicroAreaChartPoint({x:60,y:30}),new sap.suite.ui.commons.MicroAreaChartPoint({x:100,y:70})]}),chart:new sap.suite.ui.commons.MicroAreaChartItem({points:[new sap.suite.ui.commons.MicroAreaChartPoint({x:0,y:0}),new sap.suite.ui.commons.MicroAreaChartPoint({x:30,y:40}),new sap.suite.ui.commons.MicroAreaChartPoint({x:60,y:50}),new sap.suite.ui.commons.MicroAreaChartPoint({x:100,y:100})]}),});else if(c.getProperty("tileType")=="CM"){a=new sap.suite.ui.commons.ComparisonChart({scale:"M",size:"S",data:[new sap.suite.ui.commons.ComparisonData({title:t.oApplicationFacade.getResourceBundle().getText("MEASURE_1"),value:34,color:"Good"}),new sap.suite.ui.commons.ComparisonData({title:t.oApplicationFacade.getResourceBundle().getText("MEASURE_2"),value:125,color:"Error"}),new sap.suite.ui.commons.ComparisonData({title:t.oApplicationFacade.getResourceBundle().getText("MEASURE_3"),value:97,color:"Critical"})]})}b=new sap.suite.ui.commons.GenericTile({size:"S",header:c.getProperty("title"),subheader:c.getProperty("description"),customData:[new sap.ui.core.CustomData({key:"tileType",value:c.getProperty("tileType")})],tileContent:new sap.suite.ui.commons.TileContent({content:a,size:"S",}),press:function(g){}}).addStyleClass("sbTile");return new sap.m.ColumnListItem({type:"Navigation",press:function(g){var h=this.getBindingContext().sPath;if(this.getBindingContext().getObject().isActive){if(this.getBindingContext().getObject().COUNTER==2){h=h.replace("isActive=1","isActive=0")}}else{h=h.replace("isActive=1","isActive=0")}h=h.replace("/CHIPS_MODELER","CHIPS");sap.suite.smartbusiness.utils.replaceHash({action:"configureSBKPITile",route:"editTile",context:(t.getView().getBindingContext().sPath.substr(1)+"/"+h)})},cells:[b,new sap.ui.layout.VerticalLayout({content:[n,new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText("SEMANTIC_OBJECT")+': '+d.semanticObject,visible:e}),new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText("ACTION")+': '+d.semanticAction,visible:e}),]}).addStyleClass("navigationVLayout"),s,new sap.ui.layout.HorizontalLayout({content:[new sap.ui.core.Icon({src:"sap-icon://edit",size:"22px",press:function(g){var h=this.getBindingContext().sPath;if(this.getBindingContext().getObject().isActive){if(this.getBindingContext().getObject().COUNTER==2){h=h.replace("isActive=1","isActive=0")}}else{h=h.replace("isActive=1","isActive=0")}h=h.replace("/CHIPS_MODELER","CHIPS");sap.suite.smartbusiness.utils.replaceHash({action:"configureSBKPITile",route:"editTile",context:(t.getView().getBindingContext().sPath.substr(1)+"/"+h)})}}),new sap.ui.core.Icon({src:"sap-icon://sys-cancel",size:"22px",press:function(g){t.handleDelete(this)}})]}).addStyleClass("chipActionsHLayout")]})},handleDelete:function(c){var t=this;sap.m.MessageBox.show(t.oApplicationFacade.getResourceBundle().getText("WANT_TO_DELETE_SELECTED_TILE"),"sap-icon://hint",t.oApplicationFacade.getResourceBundle().getText("DELETE"),[sap.m.MessageBox.Action.OK,sap.m.MessageBox.Action.CANCEL],function(e){if(e=="OK"){sap.suite.smartbusiness.utils.remove(sap.suite.smartbusiness.utils.serviceUrl("CHIP_SERVICE_URI"),{id:c.getBindingContext().getObject().id,isActive:c.getBindingContext().getObject().isActive},function(d){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("DELETION_SUCCESSFUL"));t.oApplicationFacade.getODataModel().refresh()},function(a){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("DELETION_FAILED"),a.responseText)})}if(e=="CANCEL"){}})},formatChipsCount:function(c){return this.oApplicationFacade.getResourceBundle().getText("TILES")+" ("+(c||0)+")"},getFooterButtons:function(){var t=this;var b=[{sI18nBtnTxt:t.oApplicationFacade.getResourceBundle().getText("ACTIVATE"),onBtnPressed:function(e){if(t.selectedTile){var d=JSON.parse(JSON.parse(JSON.parse(t.selectedTile.getBindingContext().getObject().configuration).tileConfiguration).TILE_PROPERTIES);var a=JSON.parse(JSON.parse(JSON.parse(t.selectedTile.getBindingContext().getObject().configuration).tileConfiguration).EVALUATION);var c="";if(!(d.semanticObject&&d.semanticAction&&t.selectedTile.getBindingContext().getObject().title&&t.selectedTile.getBindingContext().getObject().description)||(!(d.storyId)&&d.navType==1)||(d.semanticObject.length==(d.semanticObject.split(" ").length-1))||(d.semanticAction.length==(d.semanticAction.split(" ").length-1))){if(!(d.semanticObject)||(d.semanticObject.length==(d.semanticObject.split(" ").length-1))){c+=t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_SEMANTIC_OBJECT")+"\n"}if(!(d.semanticAction)||(d.semanticAction.length==(d.semanticAction.split(" ").length-1))){c+=t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_SEMANTIC_ACTION")+"\n"}if(!(t.selectedTile.getBindingContext().getObject().title)||(t.selectedTile.getBindingContext().getObject().title.length==(t.selectedTile.getBindingContext().getObject().title.split(" ").length-1))){c+=t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_TITLE")+"\n"}if(!(t.selectedTile.getBindingContext().getObject().description)||(t.selectedTile.getBindingContext().getObject().description.length==(t.selectedTile.getBindingContext().getObject().description.split(" ").length-1))){c+=t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_DESCRIPTION")+"\n"}if((!(d.storyId)&&(d.navType==1))){c+=t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_STORY_ID")}sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ACTIVATION_ERROR"),c)}else{if(t.selectedTile.getBindingContext().getObject().tileType=="CM"){if(!(a)||!(a.COLUMN_NAMES)||!(a.COLUMN_NAMES.length)){c+=t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_THREE_MEASURES")}else{for(var i=0,l=a.COLUMN_NAMES.length;i<l;i++){if(!(a.COLUMN_NAMES[i].COLUMN_NAME)||!(a.COLUMN_NAMES[i].semanticColor)){c+=t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_THREE_MEASURES");break}}if((!c)&&(a.COLUMN_NAMES.length==3)){if(a.COLUMN_NAMES[0].COLUMN_NAME==a.COLUMN_NAMES[1].COLUMN_NAME){c+=t.oApplicationFacade.getResourceBundle().getText("ERROR_DUPLICATE_MEASURE_THREE_MEASURES")}else if(a.COLUMN_NAMES[0].COLUMN_NAME==a.COLUMN_NAMES[2].COLUMN_NAME){c+=t.oApplicationFacade.getResourceBundle().getText("ERROR_DUPLICATE_MEASURE_THREE_MEASURES")}else if(a.COLUMN_NAMES[1].COLUMN_NAME==a.COLUMN_NAMES[2].COLUMN_NAME){c+=t.oApplicationFacade.getResourceBundle().getText("ERROR_DUPLICATE_MEASURE_THREE_MEASURES")}}}}if(c){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ACTIVATION_ERROR"),c)}else{sap.suite.smartbusiness.utils.create(sap.suite.smartbusiness.utils.serviceUrl("ACTIVATE_CHIP_SERVICE_URI"),{id:t.selectedTile.getBindingContext().getObject().id},null,function(d){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("ACTIVATION_SUCCESSFUL"));t.oApplicationFacade.getODataModel().refresh();t.selectedTile=undefined;t.updateFooterButtons()},function(f){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ACTIVATION_ERROR"),f.responseText)})}}}else{sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("SELECT_A_TILE_TO_DELETE"))}},},{sI18nBtnTxt:t.oApplicationFacade.getResourceBundle().getText("EDIT")+" "+t.oApplicationFacade.getResourceBundle().getText("STATUS_DRAFT"),onBtnPressed:function(e){if(t.selectedTile){var c=t.selectedTile.getBindingContext().sPath.replace("isActive=1","isActive=0");c=c.replace("/CHIPS_MODELER","CHIPS");t.oRouter.navTo("editTile",{contextPath:t.getView().getBindingContext().sPath.substr(1),chipContextPath:c})}else{sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("SELECT_A_TILE_TO_EDIT"))}},},{sI18nBtnTxt:t.oApplicationFacade.getResourceBundle().getText("EDIT"),onBtnPressed:function(e){if(t.selectedTile){t.oRouter.navTo("editTile",{contextPath:t.getView().getBindingContext().sPath.substr(1),chipContextPath:t.selectedTile.getBindingContext().sPath.replace("/CHIPS_MODELER","CHIPS")})}else{sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("SELECT_A_TILE_TO_EDIT"))}},},{sI18nBtnTxt:t.oApplicationFacade.getResourceBundle().getText("DELETE"),onBtnPressed:function(e){if(t.selectedTile){sap.m.MessageBox.show(t.oApplicationFacade.getResourceBundle().getText("WANT_TO_DELETE_SELECTED_TILE"),"sap-icon://hint",t.oApplicationFacade.getResourceBundle().getText("DELETE"),[sap.m.MessageBox.Action.OK,sap.m.MessageBox.Action.CANCEL],function(e){if(e=="OK"){t.oApplicationFacade.getODataModel().remove(t.selectedTile.getBindingContext().sPath.replace("CHIPS_MODELER","CHIPS"),null,function(d){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("DELETION_SUCCESSFUL"));t.oApplicationFacade.getODataModel().refresh();t.selectedTile=undefined;t.updateFooterButtons()},function(a){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("DELETION_FAILED"),a.response.body)})}if(e=="CANCEL"){}})}else{sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("SELECT_A_TILE_TO_DELETE"))}},}];return b},setSorting:function(k,g){g=g||false;var l=this.getView().byId("tileGrid");if(k=="tileType"){l.getBinding("items").sort([new sap.ui.model.Sorter("tileType",g,null)])}else if(k=="status"){l.getBinding("items").sort([new sap.ui.model.Sorter("isActive",g,null),new sap.ui.model.Sorter("COUNTER",g,null)])}else if(k=="none"){l.getBinding("items").sort([])}},setFiltering:function(i){var f=[];var l=this.getView().byId("tileGrid");var a={"NT":(new sap.ui.model.Filter("tileType",sap.ui.model.FilterOperator.EQ,'NT')),"CT":(new sap.ui.model.Filter("tileType",sap.ui.model.FilterOperator.EQ,'CT')),"AT":(new sap.ui.model.Filter("tileType",sap.ui.model.FilterOperator.EQ,'AT')),"TT":(new sap.ui.model.Filter("tileType",sap.ui.model.FilterOperator.EQ,'TT')),"CM":(new sap.ui.model.Filter("tileType",sap.ui.model.FilterOperator.EQ,'CM')),"new":(new sap.ui.model.Filter("isActive",sap.ui.model.FilterOperator.EQ,0)),"active":(new sap.ui.model.Filter("isActive",sap.ui.model.FilterOperator.EQ,1))};f=sap.suite.smartbusiness.utils.getFilterArray(i,a);if(f.length){l.getBinding("items").filter(new sap.ui.model.Filter(f,true))}else{l.getBinding("items").filter(f)}},handleSortPress:function(){var t=this;this.sortOptionsDialog=this.sortOptionsDialog||new sap.m.ViewSettingsDialog({id:this.createId("sortOptionsDialog"),sortItems:[new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("TILE_TYPE"),key:"tileType"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("STATUS"),key:"status"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("NONE"),key:"none"})],confirm:function(e){if(e.getParameter("sortItem")){t.setSorting(e.getParameter("sortItem").getKey(),e.getParameter("sortDescending"))}}});this.sortOptionsDialog.open()},handleFilterPress:function(){var t=this;this.filterOptionsDialog=this.filterOptionsDialog||new sap.m.ViewSettingsDialog({id:this.createId("filterOptionsDialog"),filterItems:[new sap.m.ViewSettingsFilterItem({text:t.oApplicationFacade.getResourceBundle().getText("TILE_TYPE"),key:"tileType",items:[new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("NUMERIC_TILE"),key:"NT"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("COMPARISON_TILE"),key:"CT"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("TREND_TILE"),key:"AT"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("ACTUAL_VS_TARGET_TILE"),key:"TT"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("COMPARISON_MM_TILE"),key:"CM"})]}),new sap.m.ViewSettingsFilterItem({text:t.oApplicationFacade.getResourceBundle().getText("STATUS"),key:"status",items:[new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("STATUS_NEW"),key:"new"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("STATUS_ACTIVE"),key:"active"})]})],confirm:function(e){var a="";var s=e.getParameter("filterItems");t.setFiltering(e.getParameter("filterItems"));if(s&&s.length){var f={};for(var i=0,l=s.length;i<l;i++){f[s[i].getParent().getKey()]=f[s[i].getParent().getKey()]||"";f[s[i].getParent().getKey()]+=(f[s[i].getParent().getKey()])?(","):"";f[s[i].getParent().getKey()]+=s[i].getText()}for(var b in f){if(f.hasOwnProperty(b)){a+=(a)?" ; ":"";a+=f[b]}}t.byId("filterToolbar").setVisible(true);t.byId("visualizationInfo").setText(a)}else{t.byId("visualizationInfo").setText("");t.byId("filterToolbar").setVisible(false)}}});this.filterOptionsDialog.open()}});
