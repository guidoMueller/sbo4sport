jQuery.sap.require("sap.ca.scfld.md.controller.BaseFullscreenController");sap.ca.scfld.md.controller.BaseFullscreenController.extend("sap.suite.ui.smartbusiness.designtime.visualization.view.S4",{onInit:function(){var t=this;var v=this.getView();this.LUMIRA_SEMANTIC_OBECT="LumiraAnalytics";this.LUMIRA_ACTION="openStory";this.lumiraSemanticObject="LumiraAnalytics";this.lumiraAction="openStory";this.apfSemanticObject="";this.apfAction="";this.APF_SEMANTIC_OBECT="";this.APF_ACTION="";this.sbAction="analyzeSBKPIDetails";if(!(t.oApplicationFacade.currentLogonHanaUser)){this.oApplicationFacade.getODataModel().read("/SESSION_USER",null,null,true,function(d){t.oApplicationFacade.currentLogonHanaUser=(d.results&&d.results.length)?d.results[0].LOGON_USER:null},function(e){t.oApplicationFacade.currentLogonHanaUser=null;sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("YMSG_ERROR_RETRIEVING_DATA"),e.response.body)})}this.oRouter.attachRouteMatched(function(e){if(e.getParameter("name")=="addTile"||e.getParameter("name")=="editTile"){this.oApplicationFacade.getODataModel().read("/LANGUAGE?$select=LAISO,SPRAS",null,null,false,function(d){d=d.results;if(d.length){if(d.length==1){t.languagesObject={LAISO:{},SPRAS:{}};t.languagesObject.LAISO[d[0]["LAISO"]]=d[0]["SPRAS"];t.languagesObject.SPRAS[d[0]["SPRAS"]]=d[0]["LAISO"]}else{t.languagesObject=d.reduce(function(p,c,i,a){t.languagesObject=t.languagesObject||{};t.languagesObject.LAISO=t.languagesObject.LAISO||{};t.languagesObject.SPRAS=t.languagesObject.SPRAS||{};if(i==1){t.languagesObject.LAISO[a[0]["LAISO"]]=a[0]["SPRAS"];t.languagesObject.SPRAS[a[0]["SPRAS"]]=a[0]["LAISO"]}t.languagesObject.LAISO[a[i]["LAISO"]]=a[i]["SPRAS"];t.languagesObject.SPRAS[a[i]["SPRAS"]]=a[i]["LAISO"];return t.languagesObject})}}t.languagesArray=d})}if(e.getParameter("name")=="addTile"){this.getSelectedRadioButton(null,"GDD");this.byId('selectTileType').setSelectedKey('NT');this.selectTile('NT');this.getView().byId('NT').$().css("border","solid 2px "+sap.ui.core.theming.Parameters.get("sapUiHighlight"));this.lumiraSemanticObject="LumiraAnalytics";this.lumiraAction="openStory";this.apfSemanticObject="";this.apfAction="";this.initialAppParameters=[];t.oApplicationFacade.getODataModel().read(e.getParameter("arguments").contextPath+"/TEXTS",null,null,true,function(l){l=l.results;var a=[];var i;for(i=0;i<l.length;i++){if(l[i].LANGUAGE!=t.localLanguage){a.push(l[i])}}var b=[];var i;for(i=0;i<a.length;i++){var c={};c.ADDITIONAL_LANGUAGE_TITLE=a[i].TITLE;c.ADDITIONAL_LANGUAGE_DESCRIPTION=a[i].DESCRIPTION;c.ADDITIONAL_SAP_LANGUAGE_KEY=a[i].LANGUAGE;c.ADDITIONAL_LANGUAGE_KEY=t.languagesObject.SPRAS[c.ADDITIONAL_SAP_LANGUAGE_KEY];b.push(c)}t.oldLanguagePayload=$.extend(true,[],a);t.additionalLanguageLinkModel.setProperty("/ADDITIONAL_LANGUAGE_ARRAY",b);t.additionalLanguageLinkModel.setProperty("/NO_OF_ADDITIONAL_LANGUAGES",t.additionalLanguageLinkModel.getData().ADDITIONAL_LANGUAGE_ARRAY.length);t.byId('additionalLanguageLink').bindProperty("text","additionalLanguageLinkModel>/NO_OF_ADDITIONAL_LANGUAGES",function(V){return t.oApplicationFacade.getResourceBundle().getText("ADDITIONAL_LANGUAGE")+"("+V+")"})},function(a){})}if(e.getParameter("name")==="addTile"||e.getParameter("name")==="editTile"){t.inSufficientAdditionalMeasureAlerted=false;t.inSufficientAdditionalMeasure=false;t.byId("semanticObjectText").setValueState("None");t.byId("selectODD").setValueState("None");t.byId("tileTitle").setValueState("None");t.byId("tileSubtitle").setValueState("None");t.byId("appPropertyName").setValueState("None");t.byId("appPropertyValue").setValueState("None");t.byId("selectStoryId").setValueState("None");this.getSelectedRadioButton(null,"GDD");this.appMode=e.getParameter("name");this.context=new sap.ui.model.Context(v.getModel(),'/'+e.getParameter("arguments").contextPath);v.setBindingContext(this.context);this.tileConfigurationModel=new sap.ui.model.json.JSONModel();this.byId("tileConfigForm").setModel(this.tileConfigurationModel,"tileConfig");this.tileConfigurationModel.setData({});this.appParametersModel=new sap.ui.model.json.JSONModel();this.getView().byId('propertyNameValueBox').setModel(this.appParametersModel,"appParameters");this.additionalLanguageLinkModel=new sap.ui.model.json.JSONModel();this.getView().byId('additionalLanguageLink').setModel(this.additionalLanguageLinkModel,"additionalLanguageLinkModel");t.localLanguage=t.languagesObject.LAISO[sap.ui.getCore().getConfiguration().getLocale().getLanguage().split("-")[0].toUpperCase()];if(this.context.getObject()){this.onAfterContextData(this.context.getObject())}else{this.oApplicationFacade.getODataModel().read("/"+e.getParameter("arguments").contextPath,null,null,true,function(d){t.onAfterContextData(d)},function(a){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("FAILED_TO_READ_CHIP_INFO"),a.response.body)})}t.oApplicationFacade.getODataModel().read(e.getParameter("arguments").contextPath+"/VALUES",null,null,false,function(d){t.evaluationDetails=t.evaluationDetails||{};t.evaluationDetails.VALUES=[];var a={};var o={};for(var i=0,l=d.results.length;i<l;i++){o={};o.TYPE=d.results[i].TYPE;o.FIXED=d.results[i].FIXED;o.COLUMN_NAME=d.results[i].COLUMN_NAME;o.ODATA_PROPERTY=d.results[i].ODATA_PROPERTY;t.evaluationDetails.VALUES.push(o);a[o.TYPE]=o}var m={Measures:[]};if(t.evaluationObj){m={Measures:[{COLUMN_NAME:t.evaluationObj.COLUMN_NAME}]}}i=0;while(a[((i<10)?("0"+i):i)]){m.Measures.push({COLUMN_NAME:a[((i<10)?("0"+i):i)].COLUMN_NAME});i++}if(m.Measures.length<2){t.inSufficientAdditionalMeasure=true}t.customMeasuresModel=new sap.ui.model.json.JSONModel();t.customMeasuresModel.setData(m);var b=jQuery.extend(true,{},m,{});t.customMeasuresModel1=new sap.ui.model.json.JSONModel();t.customMeasuresModel1.setData(b)},function(a){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("YMSG_ERROR_RETRIEVING_DATA"),a.response.body)});t.oApplicationFacade.getODataModel().read(e.getParameter("arguments").contextPath+"/FILTERS",null,null,true,function(d){t.evaluationDetails=t.evaluationDetails||{};t.evaluationDetails.FILTERS=[];var o={};for(var i=0,l=d.results.length;i<l;i++){o={};o.TYPE=d.results[i].TYPE;o.NAME=d.results[i].NAME;o.VALUE_1=d.results[i].VALUE_1;o.OPERATOR=d.results[i].OPERATOR;o.VALUE_2=d.results[i].VALUE_2;t.evaluationDetails.FILTERS.push(o)}},function(a){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("YMSG_ERROR_RETRIEVING_DATA"),a.response.body)})}if(e.getParameter("name")=="editTile"){this.chipContext=new sap.ui.model.Context(v.getModel(),'/'+e.getParameter("arguments").chipContextPath);t.oApplicationFacade.getODataModel().read(e.getParameter("arguments").chipContextPath+"/TEXTS",null,null,true,function(l){l=l.results;var a=[];var i;for(i=0;i<l.length;i++){if(l[i].language!=t.localLanguage){a.push(l[i])}}var b=[];var i;for(i=0;i<a.length;i++){var c={};c.ADDITIONAL_LANGUAGE_TITLE=a[i].title;c.ADDITIONAL_LANGUAGE_DESCRIPTION=a[i].description;c.ADDITIONAL_SAP_LANGUAGE_KEY=a[i].language;c.ADDITIONAL_LANGUAGE_KEY=t.languagesObject.SPRAS[c.ADDITIONAL_SAP_LANGUAGE_KEY];b.push(c)}t.oldLanguagePayload=$.extend(true,[],a);t.additionalLanguageLinkModel.setProperty("/ADDITIONAL_LANGUAGE_ARRAY",b);t.additionalLanguageLinkModel.setProperty("/NO_OF_ADDITIONAL_LANGUAGES",t.additionalLanguageLinkModel.getData().ADDITIONAL_LANGUAGE_ARRAY.length);t.byId('additionalLanguageLink').bindProperty("text","additionalLanguageLinkModel>/NO_OF_ADDITIONAL_LANGUAGES",function(V){return t.oApplicationFacade.getResourceBundle().getText("ADDITIONAL_LANGUAGE")+"("+V+")"})},function(a){});if(this.chipContext.getObject()){this.onAfterChipContextData(this.chipContext.getObject())}else{this.oApplicationFacade.getODataModel().read(e.getParameter("arguments").chipContextPath,null,null,true,function(d){delete d.DDA_CONFIGURATIONS;delete d.EVALUATION_INFO;delete d.TEXTS;delete d.__metadata;t.onAfterChipContextData(d)},function(a){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("FAILED_TO_READ_CHIP_INFO"),a.response.body)})}}},this)},getHeaderFooterOptions:function(){var t=this;this.oHeaderFooterOptions={bSuppressBookmarkButton:{},onBack:function(){t.handleBackAndCancel()},oEditBtn:{sI18nBtnTxt:"SAVE",onBtnPressed:function(e){var c=t.formChipConfiguration();var s=t.publishChip(c);if(s){t.oApplicationFacade.getODataModel().refresh();sap.suite.smartbusiness.utils.replaceHash({action:"configureSBKPITile",route:"detail",context:t.context.sPath.substr(1)})}}},buttonList:[]};return this.oHeaderFooterOptions},getSelectedRadioButton:function(e,c){var b=this.getView().getBindingContext();if((e&&e.mParameters.selected)||c){this.confirmationType=(e)?e.getSource().data("drilldownType"):c;if(this.confirmationType==='GDD'){this.getView().byId('selectNavType').setVisible(false);this.getView().byId('selectStoryId').setVisible(false);this.getView().byId('semanticObjectText').setVisible(false);this.getView().byId('selectODD').setVisible(false);this.getView().byId('propertyNameValueBoxHeader').setVisible(false);this.getView().byId('propertyNameValueBox').setVisible(false);if(this.tileConfigurationModel&&this.tileConfigurationModel.getData()){this.tileConfigurationModel.getData().semanticObject=this.onLoadSemanticObject;this.tileConfigurationModel.getData().action=this.sbAction;this.tileConfigurationModel.getData().navType="0"}}else if(this.confirmationType==='ODD'){this.getView().byId('selectNavType').setVisible(true);this.getView().byId('selectStoryId').setVisible(true);this.getView().byId('selectODD').setVisible(true);this.getView().byId('semanticObjectText').setVisible(true);this.getView().byId('selectODD').setVisible(true);this.getView().byId('propertyNameValueBoxHeader').setVisible(true);this.getView().byId('propertyNameValueBox').setVisible(true);if(this.tileConfigurationModel&&this.tileConfigurationModel.getData()){this.tileConfigurationModel.getData().navType=(Number(this.tileConfigurationModel.getData().navType))?this.tileConfigurationModel.getData().navType:"1"}this.getView().byId('selectNavType').setSelectedKey(this.tileConfigurationModel.getData().navType);this.selectNavType(null,this.tileConfigurationModel.getData().navType)}}},selectTileType:function(e){this.tileConfigurationModel.getData().tileType=e.getSource().getSelectedKey();this.selectTile(e.getSource().getSelectedItem().getKey())},onTileSelect:function(e){this.tileType=e.getSource().data("tileType");this.selectTile(this.tileType);this.getView().byId('selectTileType').setSelectedKey(this.tileType);this.tileConfigurationModel.getData().tileType=this.getView().byId('selectTileType').getSelectedKey()},selectTile:function(k){this.getView().byId('NT').$().css("border","solid 2px "+sap.ui.core.theming.Parameters.get("sapUiWhite"));this.getView().byId('CT').$().css("border","solid 2px "+sap.ui.core.theming.Parameters.get("sapUiWhite"));this.getView().byId('TT').$().css("border","solid 2px "+sap.ui.core.theming.Parameters.get("sapUiWhite"));this.getView().byId('AT').$().css("border","solid 2px "+sap.ui.core.theming.Parameters.get("sapUiWhite"));this.getView().byId('CM').$().css("border","solid 2px "+sap.ui.core.theming.Parameters.get("sapUiWhite"));this.getView().byId(k).$().css("border","solid 2px "+sap.ui.core.theming.Parameters.get("sapUiHighlight"));if(k==="NT"){this.getView().byId('selectDimension').setVisible(false);this.getView().byId('selectSortOrder').setVisible(false);this.getView().byId('measure1Layout').setVisible(false);this.getView().byId('measure2Layout').setVisible(false);this.getView().byId('measure3Layout').setVisible(false)}else if(k==="CT"){this.getView().byId('selectDimension').setVisible(true);this.getView().byId('selectSortOrder').setVisible(true);this.getView().byId('measure1Layout').setVisible(false);this.getView().byId('measure2Layout').setVisible(false);this.getView().byId('measure3Layout').setVisible(false)}else if(k==="TT"){this.getView().byId('selectDimension').setVisible(true);this.getView().byId('selectSortOrder').setVisible(false);this.getView().byId('measure1Layout').setVisible(false);this.getView().byId('measure2Layout').setVisible(false);this.getView().byId('measure3Layout').setVisible(false)}else if(k==="AT"){this.getView().byId('selectDimension').setVisible(false);this.getView().byId('selectSortOrder').setVisible(false);this.getView().byId('measure1Layout').setVisible(false);this.getView().byId('measure2Layout').setVisible(false);this.getView().byId('measure3Layout').setVisible(false)}else if(k==="CM"){if(this.inSufficientAdditionalMeasure&&!(this.inSufficientAdditionalMeasureAlerted)){sap.m.MessageToast.show(this.oApplicationFacade.getResourceBundle().getText("INSUFFICIENT_ADDL_MEASURES"));this.inSufficientAdditionalMeasureAlerted=true}this.getView().byId('selectDimension').setVisible(false);this.getView().byId('selectSortOrder').setVisible(false);this.getView().byId('measure1Layout').setVisible(true);this.getView().byId('measure2Layout').setVisible(true);this.getView().byId('measure3Layout').setVisible(true)}},selectSortOrder:function(e){this.tileConfigurationModel.getData().sortOrder=e.getSource().getSelectedKey()},selectNavType:function(e,k){if(e){k=e.getSource().getSelectedKey()}this.tileConfigurationModel.getData().navType=k;this.byId("selectNavType").setSelectedKey(k);switch(Number(k)){case 1:this.getView().byId("selectStoryId").setVisible(true);this.tileConfigurationModel.getData().semanticObject=this.lumiraSemanticObject;this.getView().byId("semanticObjectText").setValue(this.lumiraSemanticObject);this.tileConfigurationModel.getData().action=this.lumiraAction;this.getView().byId("selectODD").setValue(this.lumiraAction);break;case 2:this.getView().byId("selectStoryId").setVisible(false);this.tileConfigurationModel.getData().semanticObject=this.apfSemanticObject;this.getView().byId("semanticObjectText").setValue(this.apfSemanticObject);this.tileConfigurationModel.getData().action=this.apfAction;this.getView().byId("selectODD").setValue(this.apfAction);break;case 3:this.tileConfigurationModel.getData().semanticObject=this.tempSemanticObject||this.evaluationObj.semanticObject||"";this.getView().byId("semanticObjectText").setValue(this.tileConfigurationModel.getData().semanticObject);this.tileConfigurationModel.getData().action=this.tempAction||this.evaluationObj.action||"";this.getView().byId("selectODD").setValue(this.tileConfigurationModel.getData().action);break;case 4:this.getView().byId("selectStoryId").setVisible(false);this.tileConfigurationModel.getData().semanticObject=this.tempSemanticObject||this.evaluationObj.semanticObject||"";this.getView().byId("semanticObjectText").setValue(this.tempSemanticObject||this.evaluationObj.semanticObject||"");this.tileConfigurationModel.getData().action=this.tempAction||this.evaluationObj.action||"";this.getView().byId("selectODD").setValue(this.tempAction||this.evaluationObj.action||"");break;default:break}},formChipConfiguration:function(){var t=this;var p={};var d=this.tileConfigurationModel.getData();var c=null;var a={};var b={};p.id=d.id||"";this.currentChipId=p.id;p.isActive=0;p.catalogId='HANA_CATALOG';p.title=d.title;p.description=d.description;p.tileType=d.tileType;p.evaluationId=d.evaluationId;p.url=p.url||this.getChipUrl(p.tileType);p.keywords=d.keywords;if(d.changedOn){p.changedOn=d.changedOn}b.id=d.id||"";b.evaluationId=d.evaluationId;b.tileType=d.tileType;if(d.tileType=='CT'){b.dimension=d.dimension||this.byId("selectDimension").getSelectedKey();b.sortOrder=d.sortOrder||this.byId("selectSortOrder").getSelectedKey()}if(d.tileType=='TT'){b.dimension=d.dimension||this.byId("selectDimension").getSelectedKey()}var e=this.getView().getBindingContext().getObject()||this.evaluationObj;b.frameType='OneByOne';if(this.byId("genericDrilldown").getSelected()){b.navType="0";b.semanticObject=(d.semanticObject&&(d.semanticObject.length!=(d.semanticObject.split(" ").length-1)))?d.semanticObject:e.COLUMN_NAME;b.semanticAction=this.sbAction}else{b.navType=d.navType||this.byId("selectNavType").getSelectedKey();if(b.navType=="1"){b.storyId=d.storyId||this.byId("selectStoryId").getValue()}else{delete d.storyId}b.semanticObject=d.semanticObject||this.byId("semanticObjectText").getValue();b.semanticAction=d.action||this.byId("selectODD").getValue()}a.ADDITIONAL_APP_PARAMETERS={};var f=this.byId("propertyNameValueBox").getModel("appParameters").getData();if(f.PROPERTIES&&f.PROPERTIES.length){for(var i=0,l=f.PROPERTIES.length;i<l;i++){a.ADDITIONAL_APP_PARAMETERS[f.PROPERTIES[i].NAME]=f.PROPERTIES[i].VALUE}}a.ADDITIONAL_APP_PARAMETERS=Object.keys(a.ADDITIONAL_APP_PARAMETERS).length?JSON.stringify(a.ADDITIONAL_APP_PARAMETERS):JSON.stringify({});a.TILE_PROPERTIES=JSON.stringify(b);a.EVALUATION_FILTERS=this.evaluationDetails.FILTERS.length?JSON.stringify(this.evaluationDetails.FILTERS):JSON.stringify([]);a.EVALUATION_VALUES=this.evaluationDetails.VALUES.length?JSON.stringify(this.evaluationDetails.VALUES):JSON.stringify([]);this.evaluationDetails.EVALUATION={};this.evaluationDetails.EVALUATION.ID=e.ID;this.evaluationDetails.EVALUATION.INDICATOR=e.INDICATOR;this.evaluationDetails.EVALUATION.INDICATOR_TYPE=e.INDICATOR_TYPE;this.evaluationDetails.EVALUATION.INDICATOR_TITLE=e.INDICATOR_TITLE;this.evaluationDetails.EVALUATION.GOAL_TYPE=e.GOAL_TYPE;this.evaluationDetails.EVALUATION.TITLE=e.TITLE;this.evaluationDetails.EVALUATION.SCALING=e.SCALING;this.evaluationDetails.EVALUATION.ODATA_URL=e.ODATA_URL;this.evaluationDetails.EVALUATION.ODATA_ENTITYSET=e.ODATA_ENTITYSET;this.evaluationDetails.EVALUATION.VIEW_NAME=e.VIEW_NAME;if(d.tileType=='CM'){this.evaluationDetails.EVALUATION.COLUMN_NAMES=[];var g=this.getView().getModel("multiMeasures").getData();if(g&&g.MULTI_MEASURE){g=g.MULTI_MEASURE}this.evaluationCustomMeasureArray=[];for(var i=0,l=g.length;i<l;i++){if(g[i].COLUMN_NAME){this.evaluationDetails.EVALUATION.COLUMN_NAMES.push({COLUMN_NAME:g[i].COLUMN_NAME,semanticColor:g[i].semanticColor});this.evaluationCustomMeasureArray.push({COLUMN_NAME:g[i].COLUMN_NAME,semanticColor:g[i].semanticColor})}else{this.evaluationCustomMeasureArray.push({COLUMN_NAME:null,semanticColor:null})}}}this.evaluationDetails.EVALUATION.COLUMN_NAME=e.COLUMN_NAME;this.evaluationDetails.EVALUATION.OWNER_NAME=e.OWNER_NAME;this.evaluationDetails.EVALUATION.VALUES_SOURCE=e.VALUES_SOURCE;a.EVALUATION=this.evaluationDetails.EVALUATION?JSON.stringify(this.evaluationDetails.EVALUATION):JSON.stringify({});c=JSON.stringify({tileConfiguration:JSON.stringify(a),isSufficient:"1",timeStamp:Date.now().toString()});var h=4050;if(p.id){h=4096}if(c.length>h){a.EVALUATION_FILTERS=JSON.stringify([]);c=JSON.stringify({tileConfiguration:JSON.stringify(a),isSufficient:"0",timeStamp:Date.now().toString()});if(c.length>h){a.EVALUATION_VALUES=JSON.stringify([]);a.EVALUATION_FILTERS=JSON.stringify([]);c=JSON.stringify({tileConfiguration:JSON.stringify(a),isSufficient:"0",timeStamp:Date.now().toString()})}}p.configuration=c;return p},publishChip:function(p){var s=true;var t=this;p.keywords=p.keywords||"";delete p.navType;delete p.semanticObject;delete p.action;this.chipTextPayload=[];var b=[];this.deleteBatch=[];this.createBatch=[];var a=true;var d=this.oApplicationFacade.getODataModel();if(this.appMode=="addTile"){var f=[];if(t.additionalLanguageLinkModel.getData().NO_OF_ADDITIONAL_LANGUAGES){for(var i=0;i<t.additionalLanguageLinkModel.getData().NO_OF_ADDITIONAL_LANGUAGES;i++){var c={};c.title=t.additionalLanguageLinkModel.getData().ADDITIONAL_LANGUAGE_ARRAY[i].ADDITIONAL_LANGUAGE_TITLE;c.description=t.additionalLanguageLinkModel.getData().ADDITIONAL_LANGUAGE_ARRAY[i].ADDITIONAL_LANGUAGE_DESCRIPTION;c.id=p.id;c.language=t.additionalLanguageLinkModel.getData().ADDITIONAL_LANGUAGE_ARRAY[i].ADDITIONAL_SAP_LANGUAGE_KEY;c.isActive=0;t.chipTextPayload.push(c)}}f.push({id:p.id,isActive:p.isActive,CHIP:p,TEXTS:t.chipTextPayload});sap.suite.smartbusiness.utils.create(sap.suite.smartbusiness.utils.serviceUrl("CHIP_SERVICE_URI"),f,null,function(h){s=true;t.currentChipId=JSON.parse(h).response[0].id;sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("TILE_SAVED_SUCCESSFULLY"))},function(h){s=false;sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ERROR_SAVING_TILE"),h.responseText)})}else{if(this.currentContextState){var f=[];if(t.additionalLanguageLinkModel.getData().NO_OF_ADDITIONAL_LANGUAGES){for(var i=0;i<t.additionalLanguageLinkModel.getData().NO_OF_ADDITIONAL_LANGUAGES;i++){var c={};c.title=t.additionalLanguageLinkModel.getData().ADDITIONAL_LANGUAGE_ARRAY[i].ADDITIONAL_LANGUAGE_TITLE;c.description=t.additionalLanguageLinkModel.getData().ADDITIONAL_LANGUAGE_ARRAY[i].ADDITIONAL_LANGUAGE_DESCRIPTION;c.id=p.id;c.language=t.additionalLanguageLinkModel.getData().ADDITIONAL_LANGUAGE_ARRAY[i].ADDITIONAL_SAP_LANGUAGE_KEY;c.isActive=0;t.chipTextPayload.push(c)}}f.push({id:p.id,isActive:p.isActive,CHIP:p,TEXTS:t.chipTextPayload});sap.suite.smartbusiness.utils.create(sap.suite.smartbusiness.utils.serviceUrl("CHIP_SERVICE_URI"),f,null,function(h){s=true;sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("TILE_SAVED_SUCCESSFULLY"))},function(h){s=false;sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ERROR_SAVING_TILE"),h.responseText)})}else{var f=[];if(t.additionalLanguageLinkModel.getData().NO_OF_ADDITIONAL_LANGUAGES){for(var i=0;i<t.additionalLanguageLinkModel.getData().NO_OF_ADDITIONAL_LANGUAGES;i++){var c={};c.title=t.additionalLanguageLinkModel.getData().ADDITIONAL_LANGUAGE_ARRAY[i].ADDITIONAL_LANGUAGE_TITLE;c.description=t.additionalLanguageLinkModel.getData().ADDITIONAL_LANGUAGE_ARRAY[i].ADDITIONAL_LANGUAGE_DESCRIPTION;c.id=p.id;c.language=t.additionalLanguageLinkModel.getData().ADDITIONAL_LANGUAGE_ARRAY[i].ADDITIONAL_SAP_LANGUAGE_KEY;c.isActive=0;t.chipTextPayload.push(c)}}t.languagePayloadForDirtyBitTest=[];for(var i=0;i<t.oldLanguagePayload.length;i++){var e={};e.id=p.id;e.language=t.oldLanguagePayload[i].language;e.isActive=t.oldLanguagePayload[i].isActive;e.description=t.oldLanguagePayload[i].description;e.title=t.oldLanguagePayload[i].title;t.languagePayloadForDirtyBitTest.push(e)}var l=sap.suite.smartbusiness.utils.dirtyBitCheck({oldPayload:t.languagePayloadForDirtyBitTest,newPayload:t.chipTextPayload,objectType:"CHIP_TEXTS"});var g={remove:[],create:[]};if(l){if(l.deletes.length){for(var i=0;i<l.deletes.length;i++){g.remove.push(l.deletes[i])}}if(l.updates.length){for(var i=0;i<l.updates.length;i++){t.createBatch.push(d.createBatchOperation("/CHIP_TEXTS","POST",l.updates[i]));g.create.push(l.updates[i])}}}f.push({id:p.id,isActive:p.isActive,CHIP:{update:p},TEXTS:g});sap.suite.smartbusiness.utils.update(sap.suite.smartbusiness.utils.serviceUrl("CHIP_SERVICE_URI"),f,null,function(h){s=true;sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("TILE_SAVED_SUCCESSFULLY"))},function(h){s=false;sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ERROR_SAVING_TILE"),h.responseText)})}}return s},getChipUrl:function(t){var c={"NT":"/sap/bc/ui5_ui5/ui2/ushell/resources/sap/ushell/components/tiles/indicatornumeric/NumericTileChip.xml","CT":"/sap/bc/ui5_ui5/ui2/ushell/resources/sap/ushell/components/tiles/indicatorcontribution/ContributionTileChip.xml","TT":"/sap/bc/ui5_ui5/ui2/ushell/resources/sap/ushell/components/tiles/indicatorArea/AreaChartTileChip.xml","AT":"/sap/bc/ui5_ui5/ui2/ushell/resources/sap/ushell/components/tiles/indicatordeviation/DeviationTileChip.xml","CM":"/sap/bc/ui5_ui5/ui2/ushell/resources/sap/ushell/components/tiles/indicatorcomparison/ComparisonTileChip.xml"};return c[t]},populateDimension:function(d,e){d=this.validateQueryServiceURI(d)+"";e=e+"";var a=[],b=[],o={};var i;a=sap.suite.smartbusiness.odata.getAllDimensions(d,e);for(i=0;i<a.length;i++){o={};o.dimensionName=a[i];b.push(o)}var m=new sap.ui.model.json.JSONModel();m.setData({dimensions:b});return m},validateQueryServiceURI:function(d){d=jQuery.trim(d);if(!jQuery.sap.startsWith(d,"/")){d="/"+d}if(jQuery.sap.endsWith(d,"/")){d=d.substring(0,d.length-1)}return d},handleDimensionSelectionChange:function(e){this.tileConfigurationModel.getData().dimension=e.getSource().getSelectedItem().getKey()},setGenericDrillDown:function(n){return(n==0)?true:false},setOtherDrillDown:function(n){if(n>0){this.getView().byId('selectODD').setVisible(true)}else{this.getView().byId('selectODD').setVisible(false)}return(n>0)?true:false},onAfterContextData:function(c){var t=this;this.evaluationObj=c;if(this.customMeasuresModel&&this.customMeasuresModel.getData()){var a=this.customMeasuresModel.getData();a.Measures.unshift({COLUMN_NAME:this.evaluationObj.COLUMN_NAME});this.customMeasuresModel.setData(a)}if(this.customMeasuresModel1&&this.customMeasuresModel1.getData()){var b=this.customMeasuresModel1.getData();b.Measures.unshift({COLUMN_NAME:this.evaluationObj.COLUMN_NAME});this.customMeasuresModel1.setData(b)}try{this.oModelForEntity=this.populateDimension(c.ODATA_URL,c.ODATA_ENTITYSET);this.tileConfigurationModel.getData().dimension=this.oModelForEntity.getData().dimensions[0].dimensionName;this.initialData=jQuery.extend(true,{},this.tileConfigurationModel.getData(),{})}catch(e){}finally{if(this.oModelForEntity.getData().dimensions.length){this.getView().byId("selectDimension").setModel(this.oModelForEntity,"populateDimension")}else{sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("UNABLE_TO_FETCH_NAVIG"))}}if(this.appMode=="addTile"){t.selectTile('NT');t.getView().byId('NT').$().css("border","solid 2px "+sap.ui.core.theming.Parameters.get("sapUiHighlight"));t.currentLocaleLanguage=t.languagesObject.LAISO[sap.ui.getCore().getConfiguration().getLanguage().split("-")[0].toUpperCase()];var d="/EVALUATIONS_CHIP_TEXTS?$filter=ID eq '"+c.ID+"' and IS_ACTIVE eq 1";t.oApplicationFacade.getODataModel().read(d,null,null,true,function(f){t.evaluationDetails=t.evaluationDetails||{};t.evaluationDetails.TEXTS=[];var o={};for(var i=0,l=f.results.length;i<l;i++){o={};o.language=f.results[i].LANGUAGE;o.title=f.results[i].TITLE;o.description=f.results[i].DESCRIPTION;t.evaluationDetails.TEXTS.push(o)}},function(e){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("YMSG_ERROR_RETRIEVING_DATA"),e.response.body)});this.updateFooterButtons(null);this.tileConfigurationModel.setData({evaluationId:c.ID,title:c.INDICATOR_TITLE,description:c.TITLE,semanticObject:(c.SEMANTIC_OBJECT||''),action:(c.ACTION||''),storyId:'',tileType:'NT',navType:0});this.initialData=jQuery.extend(true,{},this.tileConfigurationModel.getData(),{});this.tempSemanticObject=c.SEMANTIC_OBJECT||"";this.onLoadSemanticObject=this.tempSemanticObject;this.tempAction=c.ACTION||"";var m=new sap.ui.model.json.JSONModel();m.setData({MULTI_MEASURE:[{COLUMN_NAME:t.evaluationObj.COLUMN_NAME,semanticColor:"Error"},{COLUMN_NAME:"",semanticColor:"Critical"},{COLUMN_NAME:"",semanticColor:"Good"}]});this.getView().setModel(m,"multiMeasures")}},onAfterChipContextData:function(c){var t=this;this.currentContextState=c.isActive;this.currentChipId=c.id;this.updateFooterButtons(c);if(this.appMode=="editTile"){var a=JSON.parse(c.configuration);var b=[];if(JSON.parse(a.tileConfiguration).ADDITIONAL_APP_PARAMETERS){b=JSON.parse(JSON.parse(a.tileConfiguration).ADDITIONAL_APP_PARAMETERS)}var e={};var m={MULTI_MEASURE:[]};if(JSON.parse(a.tileConfiguration).EVALUATION){e=JSON.parse(JSON.parse(a.tileConfiguration).EVALUATION);var d=new sap.ui.model.json.JSONModel();if(e.COLUMN_NAMES&&e.COLUMN_NAMES.length){for(var i=0,l=e.COLUMN_NAMES.length;i<l;i++){m.MULTI_MEASURE.push({COLUMN_NAME:e.COLUMN_NAMES[i].COLUMN_NAME,semanticColor:e.COLUMN_NAMES[i].semanticColor})}if(m.MULTI_MEASURE&&m.MULTI_MEASURE.length==2){m.MULTI_MEASURE.push({COLUMN_NAME:"",semanticColor:"Good"})}d.setData(m);this.getView().setModel(d,"multiMeasures")}else{d.setData({MULTI_MEASURE:[{COLUMN_NAME:t.evaluationObj.COLUMN_NAME,semanticColor:"Error"},{COLUMN_NAME:"",semanticColor:"Critical"},{COLUMN_NAME:"",semanticColor:"Good"}]});this.getView().setModel(d,"multiMeasures")}}var f=JSON.parse(JSON.parse(a.tileConfiguration).TILE_PROPERTIES);c.semanticObject=f.semanticObject;t.onLoadSemanticObject=c.semanticObject;c.action=f.semanticAction;this.tempSemanticObject=c.semanticObject||"";this.tempAction=c.action||"";c.navType=f.navType||"0";c.sortOrder=f.sortOrder||undefined;c.dimension=f.dimension||undefined;if(c.navType.toString()=="1"){this.lumiraSemanticObject=c.semanticObject;this.lumiraAction=c.action;this.apfSemanticObject=this.APF_SEMANTIC_OBECT;this.apfAction=this.APF_ACTION}else if(c.navType.toString()=="2"){this.apfSemanticObject=c.semanticObject;this.apfAction=c.action;this.lumiraSemanticObject=this.LUMIRA_SEMANTIC_OBECT;this.lumiraAction=this.LUMIRA_ACTION}else{this.apfSemanticObject=this.APF_SEMANTIC_OBECT;this.apfAction=this.APF_ACTION;this.lumiraSemanticObject=this.LUMIRA_SEMANTIC_OBECT;this.lumiraAction=this.LUMIRA_ACTION}this.byId('selectTileType').setSelectedKey(c.tileType);this.selectTile(c.tileType);if(Number(c.navType)==1){c.storyId=f.storyId}else{c.storyId=""}this.tileConfigurationModel.setData(c);this.initialData=jQuery.extend(true,{},this.tileConfigurationModel.getData(),{});if(Number(c.navType)){this.byId("selectNavType").setSelectedKey(c.navType);this.getSelectedRadioButton(null,"ODD")}else{this.getSelectedRadioButton(null,"GDD")}var p=[];if(b&&Object.keys(b).length){for(var k in b){if(b.hasOwnProperty(k)){p.push({NAME:k,VALUE:b[k]})}}}this.byId("propertyNameValueBox").getModel("appParameters").setData({PROPERTIES:p});this.initialAppParameters=jQuery.extend(true,[],(this.appParametersModel.getData().PROPERTIES||[]))}},addNewProperty:function(){var t=this;if(this.getView().byId("appPropertyName").getValue()){this.getView().byId("appPropertyName").setValueState("None");if(this.getView().byId("appPropertyValue").getValue()){this.getView().byId("appPropertyValue").setValueState("None");var p=this.getView().byId('propertyNameValueBox').getModel("appParameters");p.getData().PROPERTIES=p.getData().PROPERTIES||[];if(this.checkForDuplicateProperty()){p.getData().PROPERTIES.push({NAME:this.getView().byId("appPropertyName").getValue(),VALUE:this.getView().byId("appPropertyValue").getValue()});p.updateBindings();this.getView().byId("appPropertyName").setValue("");this.getView().byId("appPropertyValue").setValue("")}}else{this.getView().byId("appPropertyValue").setValueState("Error");this.getView().byId("appPropertyValue").setValueStateText(this.oApplicationFacade.getResourceBundle().getText("ENTER_PROPERTY_VALUE"));sap.m.MessageToast.show(this.oApplicationFacade.getResourceBundle().getText("ENTER_PROPERTY_VALUE"))}}else{this.getView().byId("appPropertyName").setValueState("Error");this.getView().byId("appPropertyName").setValueStateText(this.oApplicationFacade.getResourceBundle().getText("ENTER_PROPERTY_NAME"));sap.m.MessageToast.show(this.oApplicationFacade.getResourceBundle().getText("ENTER_PROPERTY_NAME"))}},removeProperty:function(e){var p=e.getSource().getBindingContext("appParameters").getPath();e.getSource().getBindingContext("appParameters").getModel().getData().PROPERTIES.splice(p.substring(p.lastIndexOf("/")+1),1);e.getSource().getBindingContext("appParameters").getModel().updateBindings()},getAllFooterButtons:function(){var t=this;var b=[{sI18nBtnTxt:t.oApplicationFacade.getResourceBundle().getText("DELETE_DRAFT"),onBtnPressed:function(e){sap.m.MessageBox.show(t.oApplicationFacade.getResourceBundle().getText("WANT_TO_DELETE_SELECTED_TILE"),"sap-icon://hint",t.oApplicationFacade.getResourceBundle().getText("DELETE"),[sap.m.MessageBox.Action.OK,sap.m.MessageBox.Action.CANCEL],function(e){if(e=="OK"){sap.suite.smartbusiness.utils.remove(sap.suite.smartbusiness.utils.serviceUrl("CHIP_SERVICE_URI"),{id:t.currentChipId,isActive:t.currentContextState},function(d){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("DELETION_SUCCESSFUL"));t.oApplicationFacade.getODataModel().refresh();sap.suite.smartbusiness.utils.replaceHash({action:"configureSBKPITile",route:"detail",context:t.context.sPath.substr(1)})},function(a){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("DELETION_FAILED"),a.response.body)})}if(e=="CANCEL"){}})},},{sI18nBtnTxt:t.oApplicationFacade.getResourceBundle().getText("SAVE")+' and '+t.oApplicationFacade.getResourceBundle().getText("ACTIVATE"),onBtnPressed:function(e){var d=t.tileConfigurationModel.getData();var a="";var c=null;if((!(d.semanticObject)&&Number(d.navType)!=0)||((d.semanticObject.length==(d.semanticObject.split(" ").length-1))&&Number(d.navType)!=0)||(!(d.action)&&Number(d.navType)!=0)||((d.action.length==(d.action.split(" ").length-1))&&Number(d.navType)!=0)||!(d.title)||!(d.description)||(!(d.storyId)&&Number(d.navType)==1)||((d.storyId.length==(d.storyId.split(" ").length-1))&&Number(d.navType)==1)||(d.title.length==(d.title.split(" ").length-1))||(d.description.length==(d.description.split(" ").length-1))){if(((!(d.semanticObject)||(d.semanticObject.length==(d.semanticObject.split(" ").length-1)))&&(Number(d.navType)!=0))){a+=t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_SEMANTIC_OBJECT")+"\n";t.byId("semanticObjectText").setValueState("Error");t.byId("semanticObjectText").setValueStateText(t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_SEMANTIC_OBJECT"))}if(((!(d.action)||(d.action.length==(d.action.split(" ").length-1)))&&(Number(d.navType)!=0))){a+=t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_SEMANTIC_ACTION")+"\n";t.byId("selectODD").setValueState("Error");t.byId("selectODD").setValueStateText(t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_SEMANTIC_ACTION"))}if(((!(d.storyId)||(d.storyId.length==(d.storyId.split(" ").length-1)))&&(Number(d.navType)==1))){a+=t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_STORY_ID")+"\n";t.byId("selectStoryId").setValueState("Error");t.byId("selectStoryId").setValueStateText(t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_STORY_ID"))}if(!(d.title)||(d.title.length==(d.title.split(" ").length-1))){a+=t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_TITLE")+"\n";t.byId("tileTitle").setValueState("Error");t.byId("tileTitle").setValueStateText(t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_TITLE"))}if(!(d.description)||(d.description.length==(d.description.split(" ").length-1))){a+=t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_DESCRIPTION");t.byId("tileSubtitle").setValueState("Error");t.byId("tileSubtitle").setValueStateText(t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_DESCRIPTION"))}sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ACTIVATION_ERROR"),a)}else{c=t.formChipConfiguration();if(d.tileType=="CM"){var f=JSON.parse(JSON.parse(JSON.parse(c.configuration).tileConfiguration).EVALUATION);if(!(t.evaluationCustomMeasureArray)||!(t.evaluationCustomMeasureArray.length)){a+=t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_THREE_MEASURES")}else{for(var i=0,l=2;i<l;i++){if(!(t.evaluationCustomMeasureArray[i].COLUMN_NAME)||!(t.evaluationCustomMeasureArray[i].semanticColor)){a+=t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_THREE_MEASURES");break}}if((!a)&&(t.evaluationCustomMeasureArray.length==3)){if(t.evaluationCustomMeasureArray[2].COLUMN_NAME&&t.evaluationCustomMeasureArray[2].semanticColor){if(f.COLUMN_NAMES[0].COLUMN_NAME==f.COLUMN_NAMES[1].COLUMN_NAME){a+=t.oApplicationFacade.getResourceBundle().getText("ERROR_DUPLICATE_MEASURE_THREE_MEASURES")}else if(t.evaluationCustomMeasureArray[0].COLUMN_NAME==t.evaluationCustomMeasureArray[2].COLUMN_NAME){a+=t.oApplicationFacade.getResourceBundle().getText("ERROR_DUPLICATE_MEASURE_THREE_MEASURES")}else if(t.evaluationCustomMeasureArray[1].COLUMN_NAME==t.evaluationCustomMeasureArray[2].COLUMN_NAME){a+=t.oApplicationFacade.getResourceBundle().getText("ERROR_DUPLICATE_MEASURE_THREE_MEASURES")}}else{t.evaluationCustomMeasureArray.pop();if(t.evaluationCustomMeasureArray[0].COLUMN_NAME==t.evaluationCustomMeasureArray[1].COLUMN_NAME){a+=t.oApplicationFacade.getResourceBundle().getText("ERROR_DUPLICATE_MEASURE_THREE_MEASURES")}}}}}if(a){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ACTIVATION_ERROR"),a)}else{var s=t.publishChip(c);if(s){sap.suite.smartbusiness.utils.create(sap.suite.smartbusiness.utils.serviceUrl("ACTIVATE_CHIP_SERVICE_URI"),{id:t.currentChipId},null,function(d){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("ACTIVATION_SUCCESSFUL"));t.oApplicationFacade.getODataModel().refresh();sap.suite.smartbusiness.utils.replaceHash({action:"configureSBKPITile",route:"detail",context:t.context.sPath.substr(1)})},function(g){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ACTIVATION_ERROR"),g.responseText)})}}}},},{sI18nBtnTxt:"CONFIG_DRILLDOWN",onBtnPressed:function(e){sap.suite.smartbusiness.utils.appToAppNavigation({action:"configureSBKPIDrilldown",route:"detail",context:("EVALUATIONS_DDA('"+t.getView().getBindingContext().getProperty("ID")+"')")})}},{sI18nBtnTxt:"SAVE_CREATE_NEW",onBtnPressed:function(e){var c=t.formChipConfiguration();var s=t.publishChip(c);if(s){if(t.appMode=="addTile"){var h=hasher||window.hasher;var a=hasher.getHash();sap.suite.smartbusiness.utils.appToAppNavigation({action:"configureSBKPITile"});setTimeout(function(){sap.suite.smartbusiness.utils.hashChange({hash:a})},0)}else{sap.suite.smartbusiness.utils.replaceHash({action:"configureSBKPITile",route:"addTile",context:t.context.sPath.substr(1)})}}}},{sI18nBtnTxt:"CANCEL",onBtnPressed:function(e){t.handleBackAndCancel()}}];return b},updateFooterButtons:function(c){var b=this.getAllFooterButtons();this.oHeaderFooterOptions.buttonList=[];if(c){if((!(c.isActive))&&(this.appMode=="editTile")){this.oHeaderFooterOptions.buttonList.push(b[0])}}for(var i=1,l=b.length;i<l;i++){if(i==2){if(c&&(c.isActive==1)){this.oHeaderFooterOptions.buttonList.push(b[i])}}else{this.oHeaderFooterOptions.buttonList.push(b[i])}}this.setHeaderFooterOptions(this.oHeaderFooterOptions)},checkForDuplicateProperty:function(){var t=this;var p=this.getView().byId('propertyNameValueBox').getModel("appParameters").getData().PROPERTIES;var a=this.getView().byId("appPropertyName").getValue();var v=this.getView().byId("appPropertyValue").getValue();if(!isNaN(Number(a))){this.getView().byId("appPropertyName").setValueState("Error");this.getView().byId("appPropertyName").setValueStateText(t.oApplicationFacade.getResourceBundle().getText("ERROR_PROPERTY_NOT_STRING"));sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("ERROR_PROPERTY_NOT_STRING"));return false}for(var i=0,l=p.length;i<l;i++){if((p[i].NAME==a)){if(p[i].NAME==a){this.getView().byId("appPropertyName").setValueState("Error");this.getView().byId("appPropertyName").setValueStateText(t.oApplicationFacade.getResourceBundle().getText("ERROR_MULTIPLE_VALUES_FOR_PROPERTY"));sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("ERROR_MULTIPLE_VALUES_FOR_PROPERTY"))}return false}}return true},inputNameChange:function(e){var t=this;var p=e.getSource().getValue();var a=Number(e.getSource().getBindingContext("appParameters").sPath[e.getSource().getBindingContext("appParameters").sPath.length-1]);var b=this.getView().byId('propertyNameValueBox').getModel("appParameters").getData().PROPERTIES;for(var i=0,l=b.length;i<l;i++){if(i==a){continue}if(b[i].NAME==p){e.getSource().setValueState("Error");e.getSource().setValueStateText(t.oApplicationFacade.getResourceBundle().getText("ERROR_MULTIPLE_VALUES_FOR_PROPERTY"));sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("ERROR_MULTIPLE_VALUES_FOR_PROPERTY"));return}}e.getSource().setValueState("None")},inputValueChange:function(e){var t=this;var v=e.getSource().getValue();var p=e.getSource().getBindingContext("appParameters").getObject().NAME;var a=Number(e.getSource().getBindingContext("appParameters").sPath[e.getSource().getBindingContext("appParameters").sPath.length-1]);var b=this.getView().byId('propertyNameValueBox').getModel("appParameters").getData().PROPERTIES;for(var i=0,l=b.length;i<l;i++){if(i==a){continue}if(b[i].NAME==p&&b[i].VALUE==v){e.getSource().setValueState("Error");e.getSource().setValueStateText(t.oApplicationFacade.getResourceBundle().getText("ERROR_DUPLICATE_PROPERTY_VALUE"));sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("ERROR_DUPLICATE_PROPERTY_VALUE"))}}},onAfterRendering:function(){var t=this;if(this.appMode=="addTile"){this.getView().byId('NT').$().css("border","solid 2px "+sap.ui.core.theming.Parameters.get("sapUiHighlight"))}this.initialData=jQuery.extend(true,{},this.tileConfigurationModel.getData(),{})},handleSemanticObjectChange:function(e){if(e.getSource().getValue()){e.getSource().setValueState("None")}this.tempSemanticObject=e.getSource().getValue();if(this.tileConfigurationModel.getData().navType.toString()=="2"){this.apfSemanticObject=e.getSource().getValue()}if(this.tileConfigurationModel.getData().navType.toString()=="1"){this.lumiraSemanticObject=e.getSource().getValue()}if(this.tileConfigurationModel.getData().navType.toString()=="0"||this.tileConfigurationModel.getData().navType.toString()=="4"){this.onLoadSemanticObject=e.getSource().getValue()}},setSemanticAction:function(e){if(e.getSource().getValue()){e.getSource().setValueState("None")}this.tempAction=e.getSource().getValue();if(this.tileConfigurationModel.getData().navType.toString()=="2"){this.apfAction=e.getSource().getValue()}if(this.tileConfigurationModel.getData().navType.toString()=="1"){this.lumiraAction=e.getSource().getValue()}},subTitleChange:function(e){if(e.getSource().getValue()){e.getSource().setValueState("None")}},titleChange:function(e){if(e.getSource().getValue()){e.getSource().setValueState("None")}},appPropertyNameChange:function(e){if(e.getSource().getValue()){e.getSource().setValueState("None")}},appPropertyValueChange:function(e){if(e.getSource().getValue()){e.getSource().setValueState("None")}},setStoryId:function(e){if(e.getSource().getValue()){e.getSource().setValueState("None")}},handleStoryIdValueHelp:function(){var t=this;var s=new sap.m.SelectDialog({title:t.oApplicationFacade.getResourceBundle().getText("STORY_ID"),noDataText:t.oApplicationFacade.getResourceBundle().getText("NO_DATA_FOUND"),items:{path:"/Stories",template:new sap.m.StandardListItem({title:"{NAME}",description:"{UUID}"})},confirm:function(e){t.tileConfigurationModel.getData().storyId=e.getParameter("selectedItem").getProperty("description");t.byId("selectStoryId").setValue(t.tileConfigurationModel.getData().storyId)},liveChange:function(e){var a="'"+e.getParameter("value").toLowerCase()+"'";var f=new sap.ui.model.Filter("tolower(NAME)",sap.ui.model.FilterOperator.Contains,a);var F=new sap.ui.model.Filter("tolower(UUID)",sap.ui.model.FilterOperator.Contains,a);var b=e.getSource().getBinding("items");b.filter(new sap.ui.model.Filter([f,F],false))}});s.open();var d=new sap.ui.model.odata.ODataModel("/sap/bi/launchpad/integration/smb.xsodata",true);s.setModel(d);if(this.evaluationObj.VIEW_NAME){s.getBinding("items").filter([new sap.ui.model.Filter("VIEW_NAME","EQ",this.evaluationObj.VIEW_NAME)])}},handleCustomMeasure:function(e){var t=this;var c=e.getSource();this.customMeasuresDialog=new sap.m.SelectDialog({title:t.oApplicationFacade.getResourceBundle().getText("CHOOSE_ADDL_MEASURE"),noDataText:t.oApplicationFacade.getResourceBundle().getText("NO_DATA_FOUND"),items:{path:"additionalMeasures>/Measures",template:new sap.m.StandardListItem({title:"{additionalMeasures>COLUMN_NAME}"})},confirm:function(E){var v=E.getParameter("selectedItem").getProperty("title");c.setValue(v)},liveChange:function(E){var s="'"+E.getParameter("value").toLowerCase()+"'";var f=new sap.ui.model.Filter("tolower(COLUMN_NAME)",sap.ui.model.FilterOperator.Contains,s);var b=E.getSource().getBinding("items");b.filter(new sap.ui.model.Filter([f],false))}});this.customMeasuresDialog.open();this.customMeasuresDialog.setModel(this.customMeasuresModel,"additionalMeasures")},handleCustomMeasure1:function(e){var t=this;var c=e.getSource();this.customMeasuresDialog1=new sap.m.SelectDialog({title:t.oApplicationFacade.getResourceBundle().getText("CHOOSE_ADDL_MEASURE"),noDataText:t.oApplicationFacade.getResourceBundle().getText("NO_DATA_FOUND"),items:{path:"additionalMeasures1>/Measures",template:new sap.m.StandardListItem({title:"{additionalMeasures1>COLUMN_NAME}"})},confirm:function(E){var v=E.getParameter("selectedItem").getProperty("title");c.setValue(v)},liveChange:function(E){var s="'"+E.getParameter("value").toLowerCase()+"'";var f=new sap.ui.model.Filter("tolower(COLUMN_NAME)",sap.ui.model.FilterOperator.Contains,s);var b=E.getSource().getBinding("items");b.filter(new sap.ui.model.Filter([f],false))}});this.customMeasuresDialog1.open();var m=this.customMeasuresModel1.getData();if(m.Measures[0].COLUMN_NAME!==""){m.Measures.unshift({COLUMN_NAME:""})}this.customMeasuresModel1.setData(m);this.customMeasuresDialog1.setModel(this.customMeasuresModel1,"additionalMeasures1")},addAdditionalLanguageDialog:function(){var t=this;this.additionalLanguageListModel=new sap.ui.model.json.JSONModel();this.additionalLanguageListModelData=$.extend(true,{},this.additionalLanguageLinkModel.getData());this.additionalLanguageListModel.setData(t.additionalLanguageListModelData);this.languageTextInput=new sap.m.Input({layoutData:new sap.ui.layout.GridData({span:"L8 M8 S8"})});this.languageDescriptionInput=new sap.m.Input({layoutData:new sap.ui.layout.GridData({span:"L8 M8 S8"})});this.languageKeySelect=new sap.m.Select({layoutData:new sap.ui.layout.GridData({span:"L6 M6 S6"})});this.addedLanguagesList=new sap.m.List({layoutData:new sap.ui.layout.GridData({span:"L5 M5 S5"}),}).setModel(t.additionalLanguageListModel,"additionalLanguageListModel");this.addedLanguagesList.bindItems("additionalLanguageListModel>/ADDITIONAL_LANGUAGE_ARRAY",new sap.m.CustomListItem({content:new sap.ui.layout.Grid({hSpacing:1,vSpacing:0,defaultSpan:"L12 M12 S12",content:[new sap.m.Input({value:"{additionalLanguageListModel>ADDITIONAL_LANGUAGE_TITLE}",design:"Bold",layoutData:new sap.ui.layout.GridData({span:"L12 M12 S12",vAlign:"Middle"}),editable:false}),new sap.m.Input({value:"{additionalLanguageListModel>ADDITIONAL_LANGUAGE_DESCRIPTION}",design:"Bold",layoutData:new sap.ui.layout.GridData({span:"L6 M6 S6",vAlign:"Middle"}),editable:false}),new sap.m.Input({value:"{additionalLanguageListModel>ADDITIONAL_LANGUAGE_KEY}",design:"Bold",layoutData:new sap.ui.layout.GridData({span:"L4 M4 S4"}),editable:false}),new sap.m.Button({icon:"sap-icon://sys-cancel",type:"Transparent",press:function(e){var b=e.getSource().getBindingContext("additionalLanguageListModel").getPath().substr(1);var n=t.addedLanguagesList.getModel("additionalLanguageListModel").getData().ADDITIONAL_LANGUAGE_ARRAY.splice(b,1);t.addedLanguagesList.getModel("additionalLanguageListModel").getData().NO_OF_ADDITIONAL_LANGUAGES=t.addedLanguagesList.getModel("additionalLanguageListModel").getData().ADDITIONAL_LANGUAGE_ARRAY.length;t.addedLanguagesList.getModel("additionalLanguageListModel").updateBindings()},layoutData:new sap.ui.layout.GridData({span:"L2 M2 S2"})})]})}));var a=new sap.m.Dialog({contentHeight:"50%",contentWidth:"25%",title:t.oApplicationFacade.getResourceBundle().getText("ADDITIONAL_LANGUAGE"),content:[new sap.ui.layout.Grid({hSpacing:1,vSpacing:4,defaultSpan:"L12 M12 S12",content:[new sap.ui.layout.form.SimpleForm({editable:true,layout:"ResponsiveGridLayout",content:[new sap.m.Label({text:t.oApplicationFacade.getResourceBundle().getText("TITLE"),textAlign:"Right",layoutData:new sap.ui.layout.GridData({span:"L3 M3 S3",})}),t.languageTextInput,new sap.m.Label({text:t.oApplicationFacade.getResourceBundle().getText("SUB_TITLE"),layoutData:new sap.ui.layout.GridData({span:"L3 M3 S3",})}),t.languageDescriptionInput,new sap.m.Label({text:t.oApplicationFacade.getResourceBundle().getText("LANGUAGE")+":",layoutData:new sap.ui.layout.GridData({span:"L3 M3 S3"})}),t.languageKeySelect,new sap.m.Button({icon:"sap-icon://add",layoutData:new sap.ui.layout.GridData({span:"L2 M2 S2"}),press:function(){if(t.languageTextInput.getValue()||t.languageDescriptionInput.getValue()){for(var i=0;i<t.addedLanguagesList.getModel("additionalLanguageListModel").getData().ADDITIONAL_LANGUAGE_ARRAY.length;i++){if(t.addedLanguagesList.getModel("additionalLanguageListModel").getData().ADDITIONAL_LANGUAGE_ARRAY[i].ADDITIONAL_LANGUAGE_KEY===t.languageKeySelect.getSelectedItem().getText()){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ERROR_LANGUAGE_EXISTS",t.languageKeySelect.getSelectedItem().getText()));return}}var b={"ADDITIONAL_LANGUAGE_TITLE":t.languageTextInput.getValue(),"ADDITIONAL_LANGUAGE_DESCRIPTION":t.languageDescriptionInput.getValue(),"ADDITIONAL_LANGUAGE_KEY":t.languageKeySelect.getSelectedItem().getText(),"ADDITIONAL_SAP_LANGUAGE_KEY":t.languageKeySelect.getSelectedKey()};t.addedLanguagesList.getModel("additionalLanguageListModel").getData().ADDITIONAL_LANGUAGE_ARRAY.push(b);t.addedLanguagesList.getModel("additionalLanguageListModel").getData().NO_OF_ADDITIONAL_LANGUAGES=t.addedLanguagesList.getModel("additionalLanguageListModel").getData().ADDITIONAL_LANGUAGE_ARRAY.length;t.addedLanguagesList.getModel("additionalLanguageListModel").updateBindings();t.languageTextInput.setValue("");t.languageDescriptionInput.setValue("")}}})]})]}).addStyleClass("languageGrid"),t.addedLanguagesList],beginButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("OK"),press:function(){t.additionalLanguageLinkModel.setData(t.additionalLanguageListModel.getData());t.additionalLanguageLinkModel.updateBindings();a.close()}}),endButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("CANCEL"),press:function(){a.close()}})});var d=this.languagesArray;for(var i=0;i<d.length;i++){if((d[i].LAISO).toUpperCase()==(sap.ui.getCore().getConfiguration().getLocale().getLanguage()).toUpperCase()){d.splice(i,1)}}var m=new sap.ui.model.json.JSONModel();m.setData(d);t.languageKeySelect.setModel(m,"otherLanguageKey");t.languageKeySelect.bindItems("otherLanguageKey>/",new sap.ui.core.Item({text:"{otherLanguageKey>LAISO}",key:"{otherLanguageKey>SPRAS}"}));a.open()},handleBackAndCancel:function(){var t=this;var o={};o.oldPayload=t.initialData;o.newPayload=t.tileConfigurationModel.getData();o.objectType="Chips";o=sap.suite.smartbusiness.utils.dirtyBitCheck(o);t.chipTextPayload=[];if(t.additionalLanguageLinkModel.getData().NO_OF_ADDITIONAL_LANGUAGES){for(var i=0;i<t.additionalLanguageLinkModel.getData().NO_OF_ADDITIONAL_LANGUAGES;i++){var c={};c.title=t.additionalLanguageLinkModel.getData().ADDITIONAL_LANGUAGE_ARRAY[i].ADDITIONAL_LANGUAGE_TITLE;c.description=t.additionalLanguageLinkModel.getData().ADDITIONAL_LANGUAGE_ARRAY[i].ADDITIONAL_LANGUAGE_DESCRIPTION;c.language=t.additionalLanguageLinkModel.getData().ADDITIONAL_LANGUAGE_ARRAY[i].ADDITIONAL_SAP_LANGUAGE_KEY;t.chipTextPayload.push(c)}}t.languagePayloadForDirtyBitTest=[];for(var i=0;i<t.oldLanguagePayload.length;i++){var a={};a.language=t.oldLanguagePayload[i].language;a.description=t.oldLanguagePayload[i].description;a.title=t.oldLanguagePayload[i].title;t.languagePayloadForDirtyBitTest.push(a)}var l=sap.suite.smartbusiness.utils.dirtyBitCheck({oldPayload:t.languagePayloadForDirtyBitTest,newPayload:t.chipTextPayload,objectType:"CHIP_TEXTS"});var b=sap.suite.smartbusiness.utils.dirtyBitCheck({oldPayload:t.initialAppParameters,newPayload:t.appParametersModel.getData().PROPERTIES||[],objectType:"APP_PARAMETERS"});if(o.updates.length||l.deletes.length||l.updates.length||b.deletes.length||b.updates.length){var d=new sap.m.Dialog({icon:"sap-icon://warning2",title:t.oApplicationFacade.getResourceBundle().getText("WARNING"),state:"Error",type:"Message",content:[new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText("ON_BACK_WARNING")})],beginButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("CONTINUE"),press:function(){sap.suite.smartbusiness.utils.replaceHash({action:"configureSBKPITile",route:"detail",context:t.context.sPath.substr(1)})}}),endButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("CANCEL"),press:function(){d.close()}})});d.open()}else{sap.suite.smartbusiness.utils.replaceHash({action:"configureSBKPITile",route:"detail",context:t.context.sPath.substr(1)})}}});
