jQuery.sap.require("sap.ca.scfld.md.controller.BaseDetailController");jQuery.sap.includeStyleSheet("../../resources/sap/suite/ui/smartbusiness/designtime/workspace/view/workspaceStyling.css");sap.ca.scfld.md.controller.BaseDetailController.extend("sap.suite.ui.smartbusiness.designtime.workspace.view.S4",{onInit:function(){var t=this;var v=this.getView();this.oRouter.attachRouteMatched(function(e){if(e.getParameter("name")==="evalDetail"){var c=new sap.ui.model.Context(v.getModel(),'/'+(e.getParameter("arguments").contextPath));var a=new sap.ui.model.Context(v.getModel(),'/'+(e.getParameter("arguments").evalPath));this.evalPath=e.getParameter("arguments").evalPath;this.contextPath=e.getParameter("arguments").contextPath;t.context=new sap.ui.model.Context(v.getModel(),'/'+(e.getParameter("arguments").contextPath));t.evalContext=new sap.ui.model.Context(v.getModel(),'/'+(e.getParameter("arguments").evalPath));t.evalPath=e.getParameter("arguments").evalPath;t.contextPath=e.getParameter("arguments").contextPath;if(t.evalContext.getObject()){t.onAfterEvaluationContext(t.context.getObject(),t.evalContext.getObject());v.setBindingContext(a)}else{t.oApplicationFacade.getODataModel().read(("/"+e.getParameter("arguments").evalPath),null,null,true,function(d){t.onAfterEvaluationContext(null,d)})}t.oApplicationFacade.getODataModel().read((t.evalPath+"/FILTERS"),null,null,true,function(F){var o;t.evaluationDetails=t.evaluationDetails||{};t.evaluationDetails.EVALUATION_FILTERS=F.results;o=t.formObjectForInputParametersAndFilters(F);t.modelForFiltersAndIp=new sap.ui.model.json.JSONModel();t.modelForFiltersAndIp.setData(o);t.getView().byId("filterInputParameterTable").setModel(t.modelForFiltersAndIp,"filterInput")},function(b){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("YMSG_ERROR_RETRIEVING_DATA"),b.response.body)});if(t.context.getObject()){this.onAfterIndicatorContext()}else{this.oApplicationFacade.getODataModel().read(this.contextPath,null,null,true,function(d){t.oApplicationFacade.getODataModel().oData[t.contextPath]=d;t.onAfterIndicatorContext()},function(b){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("YMSG_ERROR_RETRIEVING_DATA"),b.response.body)})}}},this)},formObjectForTrendThreshold:function(k,e,a){var o={TA:null,TC:null,RE:null,CL:null,CH:null,WL:null,WH:null};a=(a&&a.results)?a.results:[];for(var i=0,l=a.length;i<l;i++){if((e.VALUES_SOURCE=="FIXED")||(!(e.VALUES_SOURCE))){o[a[i]["TYPE"]]=a[i]["FIXED"]}else if(e.VALUES_SOURCE=="MEASURE"){o[a[i]["TYPE"]]=a[i]["COLUMN_NAME"]}}if(k){o.GOAL_TYPE=k.GOAL_TYPE}else{o.GOAL_TYPE=null}o.VALUES_SOURCE=e.VALUES_SOURCE||"FIXED";return o},formObjectForInputParametersAndFilters:function(l){var o={EVALUATION_FILTERS:[]},f=0,a=0;var i,v='',t={};var b=(l.results&&l.results.length)?l.results[0].NAME:"";for(i=0;i<l.results.length;i++){if(l.results[i].NAME==b&&(l.results[i].OPERATOR=="EQ"||l.results[i].OPERATOR=="GT"||l.results[i].OPERATOR=="LT"||l.results[i].OPERATOR=="NE")){t={};v+=l.results[i].VALUE_1+",";t={"ID":l.results[i].ID,"IS_ACTIVE":l.results[i].IS_ACTIVE,"NAME":l.results[i].NAME,"OPERATOR":l.results[i].OPERATOR,"TYPE":l.results[i].TYPE,"VALUES":v,"VALUE_2":null};b=l.results[i].NAME;f=0}if(l.results[i].NAME!=b&&(l.results[i].OPERATOR=="EQ"||l.results[i].OPERATOR=="GT"||l.results[i].OPERATOR=="LT"||l.results[i].OPERATOR=="NE")){if(t.VALUES){t.VALUES=t.VALUES.substring(0,t.VALUES.length-1);o.EVALUATION_FILTERS.push(t)}v='';v=v+l.results[i].VALUE_1+",";t={"ID":l.results[i].ID,"IS_ACTIVE":l.results[i].IS_ACTIVE,"NAME":l.results[i].NAME,"OPERATOR":l.results[i].OPERATOR,"TYPE":l.results[i].TYPE,"VALUES":v,"VALUE_2":null};b=l.results[i].NAME;f=0}if(l.results[i].OPERATOR=="BT"){if(t.VALUES){t.VALUES=t.VALUES.substring(0,t.VALUES.length-1);o.EVALUATION_FILTERS.push(t);t={}}t={"ID":l.results[i].ID,"IS_ACTIVE":l.results[i].IS_ACTIVE,"NAME":l.results[i].NAME,"OPERATOR":l.results[i].OPERATOR,"TYPE":l.results[i].TYPE,"VALUES":l.results[i].VALUE_1,"VALUE_2":l.results[i].VALUE_2};o.EVALUATION_FILTERS.push(t);f=1;b=l.results[i].NAME;t={}}}if(f==0){t.VALUES=(t.VALUES)?t.VALUES.substring(0,t.VALUES.length-1):t.VALUES;o.EVALUATION_FILTERS.push(t)}return o},formatOwnerName:function(o){var t=this;if(o==null||o==""){return""}else{return sap.suite.smartbusiness.formatters.getBundleText(undefined,"OWNER",o)}},formatGoalType:function(g){var t=this;var a=null;switch(g){case'MA':a=t.oApplicationFacade.getResourceBundle().getText("MAXIMIZING");break;case'MI':a=t.oApplicationFacade.getResourceBundle().getText("MINIMIZING");break;case'RA':a=t.oApplicationFacade.getResourceBundle().getText("RANGE");break;default:a=t.oApplicationFacade.getResourceBundle().getText("NONE")}return a},formatThresholdCriticalHigh:function(g){var t=this;var a=null;if(t.evalContext!=null)g=t.evalContext.getObject().GOAL_TYPE;switch(g){case'MI':a=t.oApplicationFacade.getResourceBundle().getText("CRITICAL");break;case'RA':a=t.oApplicationFacade.getResourceBundle().getText("CRITICAL_HIGH");break;default:a=""}return a},formatThresholdWarningHigh:function(g){var t=this;var a=null;if(t.evalContext!=null)g=t.evalContext.getObject().GOAL_TYPE;switch(g){case'MI':a=t.oApplicationFacade.getResourceBundle().getText("WARNING");break;case'RA':a=t.oApplicationFacade.getResourceBundle().getText("WARNING_HIGH");break;default:a=""}return a},formatThresholdWarningLow:function(g){var t=this;var a=null;if(t.evalContext!=null)g=t.evalContext.getObject().GOAL_TYPE;switch(g){case'MA':a=t.oApplicationFacade.getResourceBundle().getText("WARNING");break;case'RA':a=t.oApplicationFacade.getResourceBundle().getText("WARNING_LOW");break;default:a=""}return a},formatThresholdCriticalLow:function(g){var t=this;var a=null;if(t.evalContext!=null)g=t.evalContext.getObject().GOAL_TYPE;switch(g){case'MA':a=t.oApplicationFacade.getResourceBundle().getText("CRITICAL");break;case'RA':a=t.oApplicationFacade.getResourceBundle().getText("CRITICAL_LOW");break;default:a=""}return a},formatProperties:function(n,v){return((this.getView().byId("properties").getItems().length>1)?(', '+n+' : '+v):(n+' : '+v))},formatOperator:function(o){var t=this;var a=null;switch(o){case'EQ':a=t.oApplicationFacade.getResourceBundle().getText("EQUAL_TO");break;case'GT':a=t.oApplicationFacade.getResourceBundle().getText("GREATER_THAN");break;case'LT':a=t.oApplicationFacade.getResourceBundle().getText("LESS_THAN");break;case'NE':a=t.oApplicationFacade.getResourceBundle().getText("NOT_EQUAL_TO");break;case'BT':a=t.oApplicationFacade.getResourceBundle().getText("BETWEEN");break;case undefined:a=null;break;default:a=t.oApplicationFacade.getResourceBundle().getText("NONE")}return a},formatTypeOfFilter:function(i){var t=this;var p=null;switch(i){case'FI':p=t.oApplicationFacade.getResourceBundle().getText("FILTER");break;case'PA':p=t.oApplicationFacade.getResourceBundle().getText("INPUT_PARAMETER");break;case undefined:operatorTypeText=null;break;default:p=t.oApplicationFacade.getResourceBundle().getText("NONE")}return p},getHeaderFooterOptions:function(){var t=this;this.oHeaderFooterOptions={bSuppressBookmarkButton:{},onBack:function(){var h=window.location.hash.replace("evalDetail","detail");sap.suite.smartbusiness.utils.replaceHash({hash:h.substr(0,h.lastIndexOf("/"))},true)},oUpDownOptions:{sI18NDetailTitle:"ITEM_DETAIL_HEADER",iPosition:0,iCount:0,fSetPosition:function(n){t.oApplicationFacade.evaluationIndex=n;var a=t.oApplicationFacade.evaluationContexts[t.oApplicationFacade.evaluationIndex].substring(1);var v=t.getView();t.oHeaderFooterOptions.oUpDownOptions.iPosition=t.oApplicationFacade.evaluationIndex;t.oHeaderFooterOptions.oUpDownOptions.iCount=t.oApplicationFacade.evaluationContexts.length;t.setHeaderFooterOptions(t.oHeaderFooterOptions);t.getHeaderFooterOptions();sap.suite.smartbusiness.utils.replaceHash({action:"SBWorkspace",route:"evalDetail",context:(t.contextPath+"/"+a)})}},buttonList:t.getAllFooterButtons()};if(t.oApplicationFacade.evaluationIndex&&t.oApplicationFacade.evaluationContexts){t.onAfterAllEvaluationContexts();if(t.bookmark==false){t.updateFooterButtons()}}else{t.oApplicationFacade.evaluationContexts=[];t.oApplicationFacade.getODataModel().read((t.contextPath+"/EVALUATIONS"),null,null,true,function(d){for(var i=0,l=d.results.length;i<l;i++){t.oApplicationFacade.evaluationContexts[i]=("/"+d.results[i].__metadata.uri.split("/")[d.results[i].__metadata.uri.split("/").length-1]);t.oApplicationFacade.getODataModel().oData[t.oApplicationFacade.evaluationContexts[i].substr(1)]=d.results[i];if(t.oApplicationFacade.evaluationContexts[i]==('/'+(t.evalPath))){t.oApplicationFacade.evaluationIndex=i;var e=new sap.ui.model.Context(t.getView().getModel(),'/'+(t.evalPath));t.getView().setBindingContext(e)}}t.onAfterAllEvaluationContexts(t.oApplicationFacade.evaluationIndex,t.oApplicationFacade.evaluationContexts)},function(e){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("YMSG_ERROR_RETRIEVING_DATA"),e.response.body)})}return this.oHeaderFooterOptions},formatEvalStatus:function(s,c){var t=this;var i="";if(c>1){i=(t.oApplicationFacade.getResourceBundle().getText("STATUS_ACTIVE")+","+t.oApplicationFacade.getResourceBundle().getText("STATUS_DRAFT"))}else if(s){i=t.oApplicationFacade.getResourceBundle().getText("STATUS_ACTIVE")}else{i=t.oApplicationFacade.getResourceBundle().getText("STATUS_NEW")}return i},hideShow:function(g){var t=this;if(g=="MA"){t.byId("CHlabel").setVisible(false);t.byId("CHinput").setVisible(false);t.byId("WHlabel").setVisible(false);t.byId("WHinput").setVisible(false);t.byId("WLlabel").setVisible(true);t.byId("WLinput").setVisible(true);t.byId("CLlabel").setVisible(true);t.byId("CLinput").setVisible(true)}else if(g=="MI"){t.byId("WLlabel").setVisible(false);t.byId("WLinput").setVisible(false);t.byId("CLlabel").setVisible(false);t.byId("CLinput").setVisible(false);t.byId("CHlabel").setVisible(true);t.byId("CHinput").setVisible(true);t.byId("WHlabel").setVisible(true);t.byId("WHinput").setVisible(true)}else if(g=="RA"){t.byId("WLlabel").setVisible(true);t.byId("WLinput").setVisible(true);t.byId("CLlabel").setVisible(true);t.byId("CLinput").setVisible(true);t.byId("CHlabel").setVisible(true);t.byId("CHinput").setVisible(true);t.byId("WHlabel").setVisible(true);t.byId("WHinput").setVisible(true)}else if(g==null){t.byId("WLlabel").setVisible(false);t.byId("WLinput").setVisible(false);t.byId("CLlabel").setVisible(false);t.byId("CLinput").setVisible(false);t.byId("CHlabel").setVisible(false);t.byId("CHinput").setVisible(false);t.byId("WHlabel").setVisible(false);t.byId("WHinput").setVisible(false)}},onAfterAllEvaluationContexts:function(){var t=this;t.oHeaderFooterOptions.oUpDownOptions.iPosition=t.oApplicationFacade.evaluationIndex;t.oHeaderFooterOptions.oUpDownOptions.iCount=t.oApplicationFacade.evaluationContexts.length;t.setHeaderFooterOptions(t.oHeaderFooterOptions);t.updateFooterButtons(t.evalContext.getObject())},onAfterIndicatorContext:function(){var t=this},formatFavoriteMark:function(f){return((f)?true:false)},onAfterEvaluationContext:function(i,e){var t=this;t.hideShow(e.GOAL_TYPE);t.byId("goalType").setText(t.formatGoalType(e.GOAL_TYPE));t.oApplicationFacade.getODataModel().read((t.evalPath+"/VALUES"),null,null,true,function(a){var o={};t.evaluationDetails=t.evaluationDetails||{};t.evaluationDetails.EVALUATION_VALUES=a.results;o=t.formObjectForTrendThreshold(i,e,a);t.modelForTarget=new sap.ui.model.json.JSONModel();t.byId("thresholdTrendId").setModel(t.modelForTarget);t.modelForTarget.setData(o)},function(a){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("YMSG_ERROR_RETRIEVING_DATA"),a.response.body)});if(t.oHeaderFooterOptions){t.updateFooterButtons(e)}else{t.bookmark=false}t.evaluationDetails=t.evaluationDetails||{};t.evaluationDetails.EVALUATIONS=e;t.currentEvaluationObj=e},getAllFooterButtons:function(){var t=this;return[{sId:"activateButton",sI18nBtnTxt:"ACTIVATE",onBtnPressed:function(e){var a=t.checkForMandatoryParametersForEvaluation();t.oApplicationFacade.getODataModel().read(("/EVALUATION_TEXTS?$filter=ID eq '"+t.currentEvaluationObj.ID+"' and IS_ACTIVE eq 0 and TITLE ne ''"),null,null,false,function(d){if(!(d&&d.results&&d.results.length)){a.error.push(t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_EVALUATION_TITLE"))}},function(d){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("YMSG_ERROR_RETRIEVING_DATA"),d.response.body)});if(a.error.length){var b="";for(var i=0,l=a.error.length;i<l;i++){b+=b?"\n":"";b+=t.oApplicationFacade.getResourceBundle().getText(a.error[i])}sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ACTIVATE_EV_ERROR"),b)}else{if(a.warning.length){var w="";for(var i=0,l=a.warning.length;i<l;i++){w+=w?"\n":"";w+=t.oApplicationFacade.getResourceBundle().getText(a.warning[i])}var c=new sap.m.Dialog({icon:"sap-icon://warning2",title:t.oApplicationFacade.getResourceBundle().getText("WARNING"),state:"Warning",type:"Message",content:[new sap.m.Text({text:w+"\n\n"+t.oApplicationFacade.getResourceBundle().getText("WARNING_EV_ACTIVATE")})],beginButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("CONTINUE"),press:function(){c.close();t.activateEvaluation()}}),endButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("CANCEL"),press:function(){c.close()}})});c.open()}else{t.activateEvaluation()}}}},{sId:"favouriteToggleButton",sI18nBtnTxt:"ADD_FAVOURITE",onBtnPressed:function(e){var p="/FAVOURITES";var c=t.getView().getBindingContext().getObject();var d=t.oApplicationFacade.getODataModel();var a={ID:c.ID,TYPE:c.ENTITY_TYPE,USER_ID:t.oApplicationFacade.currentLogonHanaUser,MANUAL_ENTRY:1,LAST_WORKED_ON:null};if(c.MANUAL_ENTRY){sap.suite.smartbusiness.utils.remove(sap.suite.smartbusiness.utils.serviceUrl("EVALUATION_FAVOURITE_SERVICE_URI"),a,function(b){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("FAVOURITE_EV_DELETE_SUCCESS"));c.MANUAL_ENTRY=null;t.updateFooterButtons(c);d.refresh();t.setBtnText("favouriteToggleButton",t.oApplicationFacade.getResourceBundle().getText("ADD_FAVOURITE"))},function(b){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("FAVOURITE_EV_DELETE_ERROR"),b.responseText)})}else if(c.MANUAL_ENTRY==0){sap.suite.smartbusiness.utils.update(sap.suite.smartbusiness.utils.serviceUrl("EVALUATION_FAVOURITE_SERVICE_URI"),a,null,function(b){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("FAVOURITE_EV_SUCCESS"));c.MANUAL_ENTRY=1;t.updateFooterButtons(c);d.refresh();t.setBtnText("favouriteToggleButton",t.oApplicationFacade.getResourceBundle().getText("REMOVE_FAVOURITE"))},function(b){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("FAVOURITE_EV_DELETE_ERROR"),b.responseText)})}else if(c.MANUAL_ENTRY==null){sap.suite.smartbusiness.utils.update(sap.suite.smartbusiness.utils.serviceUrl("EVALUATION_FAVOURITE_SERVICE_URI"),a,null,function(b){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("FAVOURITE_EV_SUCCESS"));c.MANUAL_ENTRY=1;t.updateFooterButtons(c);d.refresh();t.setBtnText("favouriteToggleButton",t.oApplicationFacade.getResourceBundle().getText("REMOVE_FAVOURITE"))},function(b){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("FAVOURITE_EV_ERROR"),b.responseText)})}c.MANUAL_ENTRY?e.getSource().setText(t.oApplicationFacade.getResourceBundle().getText("REMOVE_FAVOURITE")):e.getSource().setText(t.oApplicationFacade.getResourceBundle().getText("ADD_FAVOURITE"))}},{sId:"editButton",sI18nBtnTxt:"EDIT",onBtnPressed:function(e){var a=t.getView().getBindingContext().getPath();a=(t.currentEvaluationObj.COUNTER==2)?a.replace("IS_ACTIVE=1","IS_ACTIVE=0"):a;sap.suite.smartbusiness=sap.suite.smartbusiness||{};sap.suite.smartbusiness.modelerAppCache=sap.suite.smartbusiness.modelerAppCache||{};sap.suite.smartbusiness.modelerAppCache.createSBKPIEvaluation=sap.suite.smartbusiness.modelerAppCache.createSBKPIEvaluation||{};sap.suite.smartbusiness.modelerAppCache.createSBKPIEvaluation.appFromWorkspace=true;if(t.getView().getBindingContext().getObject().COUNTER==2){sap.suite.smartbusiness.utils.appToAppNavigation({action:"createSBKPIEvaluation",route:"editEvaluationDraft",context:("/"+t.contextPath.replace("INDICATORS_MODELER","INDICATORS")+a.replace("EVALUATIONS_MODELER","EVALUATIONS"))})}else if(t.getView().getBindingContext().getObject().COUNTER==1){sap.suite.smartbusiness.utils.appToAppNavigation({action:"createSBKPIEvaluation",route:"editEvaluation",context:("/"+t.contextPath.replace("INDICATORS_MODELER","INDICATORS")+a.replace("EVALUATIONS_MODELER","EVALUATIONS"))})}}},{sId:"deleteButton",sI18nBtnTxt:"DELETE_BUTTON_TEXT",onBtnPressed:function(e){if(!(sap.m.MessageBox)){jQuery.sap.require("sap.m.MessageBox")}sap.m.MessageBox.show(t.oApplicationFacade.getResourceBundle().getText("WARNING_SINGLE_EVALUATION_DELETE"),"sap-icon://hint",t.oApplicationFacade.getResourceBundle().getText("DELETE_BUTTON_TEXT"),[sap.m.MessageBox.Action.OK,sap.m.MessageBox.Action.CANCEL],function(e){if(e=="OK"){var O=t.oApplicationFacade.getODataModel();var p=[];p.push({ID:t.getView().getBindingContext().getObject().ID,IS_ACTIVE:t.getView().getBindingContext().getObject().IS_ACTIVE});sap.suite.smartbusiness.utils.remove(sap.suite.smartbusiness.utils.serviceUrl("EVALUATION_SERVICE_URI"),p,function(d){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("DELETE_EV_SUCCESS"));O.refresh();var h=window.location.hash.replace("evalDetail","detail");sap.suite.smartbusiness.utils.replaceHash({hash:h.substr(0,h.lastIndexOf("/"))},true)},function(a){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("DELETE_EV_ERROR"),a.responseText)})}if(e=="CANCEL"){}})}},{sId:"duplicateButton",sI18nBtnTxt:"DUPLICATE",onBtnPressed:function(e){sap.suite.smartbusiness=sap.suite.smartbusiness||{};sap.suite.smartbusiness.modelerAppCache=sap.suite.smartbusiness.modelerAppCache||{};sap.suite.smartbusiness.modelerAppCache.createSBKPIEvaluation=sap.suite.smartbusiness.modelerAppCache.createSBKPIEvaluation||{};sap.suite.smartbusiness.modelerAppCache.createSBKPIEvaluation.appFromWorkspace=true;sap.suite.smartbusiness.utils.appToAppNavigation({action:"createSBKPIEvaluation",route:"duplicateEvaluation",context:("/"+t.contextPath.replace("INDICATORS_MODELER","INDICATORS")+"/"+t.evalPath.replace("EVALUATIONS_MODELER","EVALUATIONS"))})}},{sId:"addTileButton",sI18nBtnTxt:"ADD_TILE",onBtnPressed:function(e){sap.suite.smartbusiness=sap.suite.smartbusiness||{};sap.suite.smartbusiness.modelerAppCache=sap.suite.smartbusiness.modelerAppCache||{};sap.suite.smartbusiness.modelerAppCache.configureSBKPITile=sap.suite.smartbusiness.modelerAppCache.configureSBKPITile||{};sap.suite.smartbusiness.modelerAppCache.configureSBKPITile.appFromWorkspace=true;sap.suite.smartbusiness.utils.appToAppNavigation({action:"configureSBKPITile",route:"detail",context:("EVALUATIONS_CHIP"+t.evalPath.substr(t.evalPath.indexOf("(")))})}},{sId:"drilldownButton",sI18nBtnTxt:"DRILLDOWN_CONFIG",onBtnPressed:function(e){sap.suite.smartbusiness=sap.suite.smartbusiness||{};sap.suite.smartbusiness.modelerAppCache=sap.suite.smartbusiness.modelerAppCache||{};sap.suite.smartbusiness.modelerAppCache.configureSBKPIDrilldown=sap.suite.smartbusiness.modelerAppCache.configureSBKPIDrilldown||{};sap.suite.smartbusiness.modelerAppCache.configureSBKPIDrilldown.appFromWorkspace=true;sap.suite.smartbusiness.utils.appToAppNavigation({action:"configureSBKPIDrilldown",route:"detail",context:("EVALUATIONS_DDA('"+t.evalContext.getProperty("ID")+"')")})}},{sId:"authUsersButton",sI18nBtnTxt:"AUTH_USERS",onBtnPressed:function(e){sap.suite.smartbusiness=sap.suite.smartbusiness||{};sap.suite.smartbusiness.modelerAppCache=sap.suite.smartbusiness.modelerAppCache||{};sap.suite.smartbusiness.modelerAppCache.authorizeSBEvaluation=sap.suite.smartbusiness.modelerAppCache.authorizeSBEvaluation||{};sap.suite.smartbusiness.modelerAppCache.authorizeSBEvaluation.appFromWorkspace=true;sap.suite.smartbusiness.utils.appToAppNavigation({action:"authorizeSBEvaluation",route:"detail",context:(t.evalPath)})}}]},updateFooterButtons:function(e){e=e||this.getView().getModel("evaluation").getData().EVALUATION;var f=this.getAllFooterButtons();this.oHeaderFooterOptions.buttonList=[];if(e.IS_ACTIVE){this.oHeaderFooterOptions.oEditBtn=f[5];this.oHeaderFooterOptions.buttonList.push(f[6]);this.oHeaderFooterOptions.buttonList.push(f[7])}else{this.oHeaderFooterOptions.oEditBtn=f[0]}if(e.MANUAL_ENTRY){f[1].sI18nBtnTxt=this.oApplicationFacade.getResourceBundle().getText("REMOVE_FAVOURITE")}else{f[1].sI18nBtnTxt=this.oApplicationFacade.getResourceBundle().getText("ADD_FAVOURITE")}this.oHeaderFooterOptions.buttonList.push(f[1]);this.oHeaderFooterOptions.buttonList.push(f[4]);if(e.COUNTER==2){f[2].sI18nBtnTxt=this.oApplicationFacade.getResourceBundle().getText("EDIT_DRAFT")}else{f[2].sI18nBtnTxt=this.oApplicationFacade.getResourceBundle().getText("EDIT")}this.oHeaderFooterOptions.buttonList.push(f[2]);this.oHeaderFooterOptions.buttonList.push(f[3]);this.setHeaderFooterOptions(this.oHeaderFooterOptions)},checkForMandatoryParametersForEvaluation:function(){var t=this;var e=t.evalContext.getObject();var a=[];var w=[];var b={};var c=this.evaluationDetails.EVALUATION_FILTERS;var d=this.evaluationDetails.EVALUATION_VALUES;var f=false;e.ODATA_URL?true:a.push("ERROR_ENTER_ODATA_URL");e.ODATA_ENTITYSET?true:a.push("ERROR_ENTER_ENTITY_SET");e.COLUMN_NAME?true:a.push("ERROR_ENTER_MEASURE");if(e.ODATA_URL&&e.ODATA_ENTITYSET){this.oData4SAPAnalyticsModel=new sap.suite.smartbusiness.odata4analytics.Model(new sap.suite.smartbusiness.odata4analytics.Model.ReferenceByURI(e.ODATA_URL),null);this.queryResultObj=this.oData4SAPAnalyticsModel.findQueryResultByName(e.ODATA_ENTITYSET);if(this.queryResultObj.getParameterization()){b=this.queryResultObj.getParameterization().getAllParameters()}for(var i=0,l=d.length;i<l;i++){if(d[i].TYPE=="TA"){f=true}else if(d[i].TYPE&&(d[i].TYPE.toString().search(/^\d\d$/)==0)){if(d[i].COLUMN_NAME==e.COLUMN_NAME){a.push("ADDI_MEASURE_HAS_MAIN_MEASURE")}}}if(!f){w.push("ERROR_ENTER_TARGET")}for(var i=0,l=c.length;i<l;i++){if(c[i].TYPE=='PA'){if(b[c[i].NAME]&&(c[i].VALUE_1)&&(c[i].VALUE_1!=0)){delete b[c[i].NAME]}}}if(Object.keys(b).length){a.push("ERROR_ENTER_ALL_INPUT_PARAMETERS")}}return{error:a,warning:w}},formatFilterValue:function(v){if(!v)return v;var a=v.split(",");pattern=/^[1-9][0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])T([0-1][0-9]|2[0-3])(:[0-5][0-9]){2}[.][0-9]{3}Z$/;if(!pattern.test(a[0]))return v;var d=[];for(var k in a)d.push(new Date(a[k]).toString());return d.join(",")},activateEvaluation:function(){var t=this;var p={};var e="ACTIVE_EVALUATIONS";var P=t.getView().getBindingContext().sPath;var i=t.getView().getBindingContext().getProperty("MANUAL_ENTRY");p.ID=P.substring((P.indexOf("'")+1),P.lastIndexOf("'"));var O=t.oApplicationFacade.getODataModel();sap.suite.smartbusiness.utils.create(sap.suite.smartbusiness.utils.serviceUrl("ACTIVATE_EVALUATION_SERVICE_URI"),p,null,function(d){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("ACTIVATE_EV_SUCCESS"));O.refresh();sap.suite.smartbusiness.utils.replaceHash({hash:window.location.hash.replace("IS_ACTIVE=0","IS_ACTIVE=1")},true);t.byId("evalStatus").setText(t.oApplicationFacade.getResourceBundle().getText("STATUS_ACTIVE"));t.byId("evalStatus").setState(sap.ui.core.ValueState.Success);t.setHeaderFooterOptions(t.oHeaderFooterOptions)},function(a){sap.suite.smartbusiness.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ACTIVATE_EV_ERROR"),a.responseText)})}});
