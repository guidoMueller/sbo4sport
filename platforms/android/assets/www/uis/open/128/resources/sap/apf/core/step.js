/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
jQuery.sap.declare("sap.apf.core.step");jQuery.sap.require("sap.apf.core.utils.filter");(function(){'use strict';sap.apf.core.Step=function(m,s,f){m.check(s!==undefined,"Step: step configuration is missing");m.check(s.categories!==undefined&&s.categories instanceof Array&&s.categories[0].id!==undefined,"No category assigned to step "+s.id+" in analytical configuration",sap.apf.core.constants.message.code.errorCheckConfiguration);m.check(s.binding!==undefined,"No binding assigned to step "+s.id+" in analytical configuration",sap.apf.core.constants.message.code.errorCheckConfiguration);d(s.categories);var b,r,c,C;var a=jQuery.extend(true,{},s);var I=(s.categories[0].id==="initial");delete a.id;delete a.picture;delete a.hoverPicture;delete a.title;delete a.longTitle;delete a.type;delete a.thumbnail;delete a.categories;this.type=s.type;this.title=jQuery.extend(true,{},s.title);this.longTitle=undefined;if(s.longTitle){this.longTitle=jQuery.extend(true,{},s.longTitle)}this.thumbnail=jQuery.extend(true,{},s.thumbnail);this.categories=s.categories;this.isInitialStep=function(){return I};this.getAdditionalConfigurationProperties=function(){return a};this.update=function(F,i){var o=b.getRequestOptions();var j=!F.isEqual(c);var R=!g(C,o);if(r&&(j||R)){r.sendGetInBatch(F,i,o)}else{i({},true)}};this.determineFilter=function(o,k){if(h()&&this.getFilter().toUrlParam()){var l=function(n){var D=[];var t;var F;if(n&&n.type&&n.type==="messageObject"){m.putMessage(n)}else{D=n.data;t=s.filterMapping.target;F=new sap.apf.core.utils.Filter(m);for(var i=0;i<D.length;i++){var p=new sap.apf.core.utils.Filter(m);for(var j=0;j<t.length;j++){p.addAnd(new sap.apf.core.utils.Filter(m,t[j],sap.apf.core.constants.FilterOperators.EQ,D[i][t[j]]))}F.addOr(p)}if(s.filterMapping.keepSource==='true'){F=this.getFilter().addAnd(F)}k(F)}};var R=f.getConfigurationById(s.filterMapping.requestForMappedFilter);R.selectProperties=s.filterMapping.target;var M=o.addAnd(this.getFilter());f.createRequest(R).sendGetInBatch(M,l.bind(this))}else{k(this.getFilter())}};this.setFilter=function(F){return b.setFilter(F)};this.getFilter=function(){return b.getFilter()};this.setData=function(D,F){c=F.copy();C=jQuery.extend({},b.getRequestOptions());b.setData(D)};this.getRepresentationInfo=function(){return b.getRepresentationInfo()};this.getSelectedRepresentationInfo=function(){return b.getSelectedRepresentationInfo()};this.getSelectedRepresentation=function(){return b.getSelectedRepresentation()};this.setSelectedRepresentation=function(R){b.setSelectedRepresentation(R)};this.serialize=function(){return{stepId:s.id,binding:b.serialize()}};this.deserialize=function(S){b.deserialize(S.binding);m.check(s.id,S.stepId,"sap.apf.core.step.deserialize inconsistent serialization data - id "+S.stepId);return this};e();function d(j){var i;var l=j.length;for(i=0;i<l;i++){if(j[i].id!=="initial"){m.check(f.existsConfiguration(j[i].id),"Step "+s.id+" references undefined category "+j[i].id,sap.apf.core.constants.message.code.errorCheckConfiguration)}}}function e(){b=f.createBinding(s.binding);delete a.binding;if(s.request!==undefined&&s.request!==""){r=f.createRequest(s.request);delete a.request}}function g(o,O){var n=0;var i=0;var p;for(p in o){n++}for(p in O){i++}if(n!==i){return false}for(p in o){if(!o.hasOwnProperty(p)){continue}if(typeof o[p]==='object'){if(!g(o[p],O[p])){return false}}else{if(o[p]!==O[p]){return false}}}return true}function h(){if(s.filterMapping){if(s.filterMapping.requestForMappedFilter&&s.filterMapping.target instanceof Array&&s.filterMapping.keepSource){return true}else{m.putMessage(m.createMessageObject({code:"5104"}));return false}}else{return false}}}}());
