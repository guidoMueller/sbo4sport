sap.ui.controller("sap.suite.ui.smartbusiness.designtime.evaluation.view.createEvalTargetThresholdTrendInput",{onBeforeRendering:function(){var t=this;this.parentController=this.getView().getViewData().controller;this.oApplicationFacade=this.parentController.oApplicationFacade;this.oResourceBundle=this.oApplicationFacade.getResourceBundle();this.getView().getModel().getData().VALUES_SOURCE=this.getView().byId("valueTypeSelect").getSelectedKey();if(this.getView().getModel().getData().TREND){this.getView().byId('applyTrendCheckBox').setSelected(true)}else{this.getView().byId('applyTrendCheckBox').setSelected(false)}this.createTrendThresholdLayout()},openMeasureSelectDialog:function(e){var t=this;this.valueType=e.getSource().getCustomData()[0].getKey();var d=this.parentController.getView().getModel().getData().ODATA_URL;var D=this.parentController.getView().getModel().getData().ODATA_ENTITYSET;if(!(d&&D)){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_WRONG_ENTITY_SET"));return}else{var m=this.populateMeasure(d,D);var a=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_MEASURE"),noDataText:t.oResourceBundle.getText("NO_DATA_FOUND"),items:{path:"/measures",template:new sap.m.StandardListItem({title:"{measureName}",})},confirm:function(e){switch(t.valueType){case"REFERENCE_VALUE":t.getView().getModel().setProperty("/REFERENCE_VALUE",e.getParameter("selectedItem").getProperty("title"));break;case"CRITICALHIGH":t.getView().getModel().setProperty("/CRITICALHIGH",e.getParameter("selectedItem").getProperty("title"));break;case"WARNINGHIGH":t.getView().getModel().setProperty("/WARNINGHIGH",e.getParameter("selectedItem").getProperty("title"));break;case"TARGET":t.getView().getModel().setProperty("/TARGET",e.getParameter("selectedItem").getProperty("title"));break;case"WARNINGLOW":t.getView().getModel().setProperty("/WARNINGLOW",e.getParameter("selectedItem").getProperty("title"));break;case"CRITICALLOW":t.getView().getModel().setProperty("/CRITICALLOW",e.getParameter("selectedItem").getProperty("title"));break;case"TREND":t.getView().getModel().setProperty("/TREND",e.getParameter("selectedItem").getProperty("title"));break}},liveChange:function(e){var s=e.getParameter("value");var f=new sap.ui.model.Filter("measureName",sap.ui.model.FilterOperator.Contains,s);var b=e.getSource().getBinding("items");b.filter([f],false)}});a.setModel(m);a.open()}},validateQueryServiceURI:function(d){d=jQuery.trim(d);if(!jQuery.sap.startsWith(d,"/")){d="/"+d}if(jQuery.sap.endsWith(d,"/")){d=d.substring(0,d.length-1)}return d},populateMeasure:function(d,e){d=this.validateQueryServiceURI(d)+"";e=e+"";var m=[],a=[],o={};var i;m=sap.suite.smartbusiness.odata.getAllMeasures(d,e);for(i=0;i<m.length;i++){o={};o.measureName=m[i];a.push(o)}var M=new sap.ui.model.json.JSONModel();M.setData({measures:a});return M},createTrendThresholdLayout:function(){var t=this;var v=this.getView().getModel().getData();if(v){this.createTrendLayout();switch(v.GOAL_TYPE){case"MA":t.createLayoutForMaximizingKPI();this.getView().byId('kpiGoalTypeImage').setSrc("../../resources/sap/suite/ui/smartbusiness/designtime/evaluation/img/Maximizing.png");this.getView().byId('kpiGoalTypeLabel').setText(t.oResourceBundle.getText("KPI_GOAL_TYPE_MAXIMIZING"));this.getView().byId('criticalLowLabel').setText(t.oResourceBundle.getText("CRITICAL"));this.getView().byId('warningLowLabel').setText(t.oResourceBundle.getText("WARNING"));this.getView().byId('criticalHighLabel').setVisible(false);this.getView().byId('warningHighLabel').setVisible(false);this.getView().byId('evaluationCriticalHigh').setVisible(false);this.getView().byId('evaluationWarningHigh').setVisible(false);break;case"MI":t.createLayoutForMinimizingKPI();this.getView().byId('kpiGoalTypeImage').setSrc("../../resources/sap/suite/ui/smartbusiness/designtime/evaluation/img/Minimizing.png");this.getView().byId('kpiGoalTypeLabel').setText(t.oResourceBundle.getText("KPI_GOAL_TYPE_MINIMIZING"));this.getView().byId('criticalHighLabel').setText(t.oResourceBundle.getText("CRITICAL"));this.getView().byId('warningHighLabel').setText(t.oResourceBundle.getText("WARNING"));this.getView().byId('criticalLowLabel').setVisible(false);this.getView().byId('warningLowLabel').setVisible(false);this.getView().byId('evaluationCriticalLow').setVisible(false);this.getView().byId('evaluationWarningLow').setVisible(false);break;case"RA":t.createLayoutForRangeKPI();this.getView().byId('kpiGoalTypeImage').setSrc("../../resources/sap/suite/ui/smartbusiness/designtime/evaluation/img/Range.png");this.getView().byId('criticalLowLabel').setText(t.oResourceBundle.getText("CRITICAL_LOW"));this.getView().byId('warningLowLabel').setText(t.oResourceBundle.getText("WARNING_LOW"));this.getView().byId('criticalHighLabel').setText(t.oResourceBundle.getText("CRITICAL_HIGH"));this.getView().byId('warningHighLabel').setText(t.oResourceBundle.getText("WARNING_HIGH"));this.getView().byId('kpiGoalTypeLabel').setText(t.oResourceBundle.getText("KPI_GOAL_TYPE_RANGE"));break}}},createLayoutForMaximizingKPI:function(){var t=this;switch(this.getView().byId('valueTypeSelect').getSelectedKey()){case"MEASURE":t.getView().byId('evaluationCriticalLow').setShowValueHelp(true);t.getView().byId('evaluationWarningLow').setShowValueHelp(true);t.getView().byId('evaluationTarget').setShowValueHelp(true);t.getView().byId('evaluationReferenceValue').setShowValueHelp(true);break;case"FIXED":t.getView().byId('evaluationCriticalLow').setShowValueHelp(false);t.getView().byId('evaluationWarningLow').setShowValueHelp(false);t.getView().byId('evaluationTarget').setShowValueHelp(false);t.getView().byId('evaluationReferenceValue').setShowValueHelp(false);break}},createLayoutForMinimizingKPI:function(){var t=this;switch(this.getView().byId('valueTypeSelect').getSelectedKey()){case"MEASURE":t.getView().byId('evaluationCriticalHigh').setShowValueHelp(true);t.getView().byId('evaluationWarningHigh').setShowValueHelp(true);t.getView().byId('evaluationTarget').setShowValueHelp(true);t.getView().byId('evaluationReferenceValue').setShowValueHelp(true);break;case"FIXED":t.getView().byId('evaluationCriticalHigh').setShowValueHelp(false);t.getView().byId('evaluationWarningHigh').setShowValueHelp(false);t.getView().byId('evaluationTarget').setShowValueHelp(false);t.getView().byId('evaluationReferenceValue').setShowValueHelp(false);break}},createLayoutForRangeKPI:function(){var t=this;switch(this.getView().byId('valueTypeSelect').getSelectedKey()){case"MEASURE":var m=jQuery.proxy(t.openMeasureSelectDialog,t);t.getView().byId('evaluationCriticalHigh').setShowValueHelp(true);t.getView().byId('evaluationWarningHigh').setShowValueHelp(true);t.getView().byId('evaluationCriticalLow').setShowValueHelp(true);t.getView().byId('evaluationWarningLow').setShowValueHelp(true);t.getView().byId('evaluationTarget').setShowValueHelp(true);t.getView().byId('evaluationReferenceValue').setShowValueHelp(true);break;case"FIXED":t.getView().byId('evaluationCriticalLow').setShowValueHelp(false);t.getView().byId('evaluationWarningLow').setShowValueHelp(false);t.getView().byId('evaluationCriticalHigh').setShowValueHelp(false);t.getView().byId('evaluationWarningHigh').setShowValueHelp(false);t.getView().byId('evaluationTarget').setShowValueHelp(false);t.getView().byId('evaluationReferenceValue').setShowValueHelp(false);break}},createMeasuresDialog:function(){var t=this;var d=this.parentController.getView().getModel().getData().ODATA_URL;var D=this.parentController.getView().getModel().getData().ODATA_ENTITYSET;if(!(d&&D)){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_WRONG_ENTITY_SET"));return}var m=this.populateMeasure(d,D);t.measuresDialog=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_MEASURE"),noDataText:t.oResourceBundle.getText("NO_DATA_FOUND"),multiSelect:true,items:{path:"/measures",template:new sap.m.StandardListItem({title:"{measureName}",})},confirm:function(e){var s=e.getParameter("selectedItems");for(var k in s){t.byId("additionalMeasures").addToken(new sap.m.Token({text:s[k].getTitle()}));t.measuresDialog.removeItem(s[k])}}});t.measuresDialog.setModel(m)},openAdditionalMeasures:function(e){var t=this;if(!t.measuresDialog){t.createMeasuresDialog()}var a=t.measuresDialog.getItems();var b=t.byId("additionalMeasures").getTokens();for(var i=0;i<b.length;i++){for(var j=0;j<a.length;j++){if(b[i].getText()===a[j].getTitle()){t.measuresDialog.removeItem(a[j])}}}t.measuresDialog.open()},multiMeasureTokenChange:function(e){var t=this;if(e.getParameter("type")=="removed"){if(!t.measuresDialog){t.createMeasuresDialog()}var a=e.getParameter("token");var m=[];m=t.measuresDialog.getModel().getData().measures;for(var i=0;i<m.length;i++){if(m[i].measureName===a.getText()){t.measuresDialog.addItem(new sap.m.StandardListItem({title:a.getText(),}))}}}var m=[];m=t.byId("additionalMeasures").getTokens();for(var i=0,l=m.length;i<l;i++){if(m[i].getText()==t.getView().getModel().getData().COLUMN_NAME){t.byId("additionalMeasures").setValueState("Error");return}else{t.byId("additionalMeasures").setValueState("None")}}},multiMeasureChange:function(v){var t=this;var m=[];m=t.byId("additionalMeasures").getValue().split(",");for(var i=0;i<m.length;i++){t.byId("additionalMeasures").setValue("");t.byId("additionalMeasures").addToken(new sap.m.Token({text:m[i]}))}m=t.byId("additionalMeasures").getTokens();if(m.length==0){t.byId("additionalMeasures").setValueState("None")}for(var i=0,l=m.length;i<l;i++){if(m[i].getText()==t.getView().getModel().getData().COLUMN_NAME){t.byId("additionalMeasures").setValueState("Error");return}else{t.byId("additionalMeasures").setValueState("None")}}},applyAdditionalMeasuresCheckBoxSelected:function(){var t=this;if(this.getView().byId('selectAdditionalMeasuresCheckBox').getSelected()){t.getView().byId('additionalMeasures').setVisible(true)}else{var b=new sap.m.Dialog({icon:"sap-icon://warning2",title:t.oResourceBundle.getText("WARNING"),state:"Warning",type:"Message",content:[new sap.m.Text({text:t.oResourceBundle.getText("ON_ADIITIONAL_MEASURES_DESELECT")})],beginButton:new sap.m.Button({text:t.oResourceBundle.getText("CONTINUE"),press:function(){var a=t.getView().byId('additionalMeasures').getTokens();for(var i=0;i<a.length;i++){if(t.measuresDialog){t.measuresDialog.addItem(new sap.m.StandardListItem({title:a[i].getText(),}))}}t.getView().byId('additionalMeasures').removeAllTokens();t.getView().byId('additionalMeasures').setVisible(false);b.close()}}),endButton:new sap.m.Button({text:t.oResourceBundle.getText("CANCEL"),press:function(){t.getView().byId('selectAdditionalMeasuresCheckBox').setSelected(true);b.close()}})});b.open()}},applyTrendCheckBoxSelected:function(){if(this.getView().byId('applyTrendCheckBox').getSelected()){this.getView().getModel().getData().TREND="";this.getView().getModel().updateBindings();this.getView().byId('trendLabel').setVisible(true);this.getView().byId('evaluationTrend').setVisible(true);this.createTrendLayout()}else{this.getView().getModel().getData().TREND="";this.getView().getModel().updateBindings();this.getView().byId('trendLabel').setVisible(false);this.getView().byId('evaluationTrend').setShowValueHelp(false);this.getView().byId('evaluationTrend').setVisible(false)}},createTrendLayout:function(){var t=this;if(this.getView().byId('applyTrendCheckBox').getSelected()){switch((this.getView().byId('valueTypeSelect').getSelectedKey()).toUpperCase()){case"MEASURE":t.getView().byId('evaluationTrend').setShowValueHelp(true);break;case"FIXED":t.getView().byId('evaluationTrend').setShowValueHelp(false);break;default:break}}else{t.getView().byId('trendLabel').setVisible(false);t.getView().byId('evaluationTrend').setShowValueHelp(false);t.getView().byId('evaluationTrend').setVisible(false)}},valueTypeSelectChange:function(){this.getView().getModel().getData().REFERENCE_VALUE="";this.getView().getModel().getData().CRITICALLOW="";this.getView().getModel().getData().WARNINGLOW="";this.getView().getModel().getData().TARGET="";this.getView().getModel().getData().WARNINGHIGH="";this.getView().getModel().getData().CRITICALHIGH="";this.getView().getModel().getData().TREND="";this.getView().getModel().updateBindings();this.createTrendThresholdLayout()}});
