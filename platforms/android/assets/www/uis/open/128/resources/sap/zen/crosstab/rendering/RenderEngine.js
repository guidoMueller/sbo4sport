jQuery.sap.declare("sap.zen.crosstab.rendering.RenderEngine");jQuery.sap.require("sap.zen.crosstab.rendering.ScrollbarRenderer");jQuery.sap.require("sap.zen.crosstab.rendering.ScrollManager");jQuery.sap.require("sap.zen.crosstab.rendering.DomElementProvider");jQuery.sap.require("sap.zen.crosstab.utils.Measuring");jQuery.sap.require("sap.zen.crosstab.rendering.RenderingConstants");jQuery.sap.require("sap.zen.crosstab.rendering.CrossRequestManager");
sap.zen.crosstab.rendering.RenderEngine=function(c){"use strict";var C=c.getColumnHeaderArea();var d=c.getDimensionHeaderArea();var r=c.getRowHeaderArea();var D=c.getDataArea();var R=null;var s=null;var o=null;var t=null;var a=null;var l="";var I=false;var n=[];var b=new sap.zen.crosstab.rendering.DomElementProvider();var m=new sap.zen.crosstab.utils.Measuring(c,b);var e=new sap.zen.crosstab.rendering.CrossRequestManager(c,this);var S=null;var h=null;var f=false;var g=false;var k={bHasHScrollbar:false,bHasVScrollbar:false,bHasHHeaderScrollbar:false};var A=[];var p=true;var q=false;var u=-1;this.isIE8Mode=function(){return f};this.renderResizeOutline=function(){if((c.getWidth()==="auto"&&c.hResize())||(c.getHeight()==="auto"&&c.vResize())){var i=c.getId();var j=i+"_resizeDiv";var j1=i+"_resizeFrame";var k1=0;var l1=0;t=b.getElement(i);if(t&&t[0]){t.css("overflow","hidden");var m1=m.getTableDivBordersAndPadding();k1=m1.borders.iTopBorderWidth;l1=m1.borders.iLeftBorderWidth;o=jQuery.sap.byId(j);o.css("visibility","visible");o.css("top",-k1+"px");o.css("left",-l1+"px");a=jQuery.sap.byId(j1);a.css("width",c.getIntWidth()+"px");a.css("height",c.getIntHeight()+"px");a.css("top",-k1+"px");a.css("left",-l1+"px");a.css("visibility","visible");var n1=t.find("#"+c.getId()+"_hScrollTab");if(n1&&n1.length>0){n1.appendTo(a);n1.css("position","absolute");var o1=c.getPropertyBag().getToolbarHeight();n1.css("bottom",o1+"px");n1.css("left","0px")}var p1=t.find("#"+c.getId()+"_vScrollTab");if(p1&&p1.length>0){p1.appendTo(a);p1.css("position","absolute");p1.css("top","0px");p1.css("right","0px")}if(c.getPropertyBag().hasToolbar()){var q1=t.find("#"+c.getId()+"_toolbar");if(q1&&q1.length>0){q1.appendTo(a);q1.css("position","absolute");q1.css("left","0px");q1.css("bottom","0px")}}}}};this.removeResizeOutline=function(){if(o){o.css("visibility","hidden");o=null}if(t){t.css("overflow","hidden");t=null}if(a){a.css("visibility","hidden");a=null}};this.addAfterFinishRenderingHandler=function(i){if($.inArray(i,A)===-1){A.push(i)}};this.removeAfterFinishRenderingHandler=function(i){var j=$.inArray(i,A);if(j!==-1){A.splice(j,1)}};this.removeAllAfterFinishRenderingHandlers=function(){A=[]};this.renderCell=function(i,j,j1){var k1=i.getCell(j,j1);if(k1){R.renderControl(k1)}return k1};this.renderArea=function(i,j,j1,k1,l1,m1){if(!j){j=0}if(!j1){j1=0}if(!k1){k1=0}if(!l1){l1=0}var n1=j+j1;var o1=k1+l1;var p1=0;var q1=0;for(p1=j;p1<n1;p1++){if(m1){R.write("<tr");R.writeAttribute("class",m1);R.write(">")}else{R.write("<tr>")}for(q1=k1;q1<o1;q1++){this.renderCell(i,p1,q1)}R.write("</tr>")}};this.setDeferredVScrollPosDetermination=function(i){g=i};function v(){f=false;if($.browser.msie){if($.browser.version.substring(0,2)==="8."){f=true}if($.browser.fVersion&&$.browser.fVersion===8){f=true}}}this.beginRendering=function(){v();R=sap.ui.getCore().createRenderManager();d1();t=b.getElement(c.getId());if(!c.getPropertyBag().isDebugMode()){t.css("visibility","hidden")}if(e.hasSavedInfo()){var i=e.getSavedHScrollInfo();if(i){C.setRenderStartCol(i.iPos);e.restoreColWidths()}var j=e.getSavedVScrollInfo();if(j){r.setRenderStartRow(j.iPos)}}};this.finishRendering=function(){this.showLoadingVisualization();var i=0;var j=null;if(R){R.destroy()}R=null;m.reset();c.highlightCells();c.restoreSelection();t=b.getElement(c.getId());t.css("visibility","visible");e.savedInfoHandled();c.restoreFocusOnCell();this.setDivSizeValidity();for(i=0;i<A.length;i++){j=A[i];if(j){j()}}};this.renderDimensionHeaderArea=function(){var i=0;var j=d.getRowCnt();var j1=0;var k1=d.getColCnt();this.renderArea(d,i,j,j1,k1,"sapzencrosstab-HeaderRow");d.setRenderSize(i,j,j1,k1);R.flush(b.getElement(d.getId())[0])};this.renderDataArea=function(){var i=0;var j=0;var j1=0;var k1=0;if(r.hasContent()){i=r.getRenderStartRow();j=r.getRenderRowCnt()}else{i=0;j=D.getRowCnt()}if(C.hasContent()){j1=C.getRenderStartCol();k1=C.getRenderColCnt()}else{j1=0;k1=D.getColCnt()}var l1=w(i,j,j1,k1);var m1=x(i,j,j1,k1);if(l1){y(l1);B(l1,i,j,j1,k1,this)}else if(m1){z(m1);E(m1,i,j,j1,k1,this);R.flush(b.getElement(D.getId())[0])}else{this.renderArea(D,i,j,j1,k1);R.flush(b.getElement(D.getId())[0])}D.setRenderSize(i,j,j1,k1)};function w(i,j,j1,k1){if(j1!==D.getRenderStartCol()||k1!==D.getRenderColCnt()||j!==D.getRenderRowCnt()){return 0}var l1=D.getRenderStartRow()+D.getRenderRowCnt();var m1=i+j;var n1=m1-l1;if(Math.abs(n1)<j){return n1}else{return 0}return 0}function x(i,j,j1,k1){if(i!==D.getRenderStartRow()||j!==D.getRenderRowCnt()||k1!==D.getRenderColCnt()){return 0}var l1=D.getRenderStartCol()+D.getRenderColCnt();var m1=j1+k1;var n1=m1-l1;if(Math.abs(n1)<k1){return n1}else{return 0}return 0}function y(j){var j1=$('#'+D.getId());var k1=j1.clone();var l1=$(k1[0].firstChild);var m1=l1.find('> tr');if(j>0){for(var i=0;i<j;i++){$(m1[i]).remove()}}else{var n1=m1.length;for(var i=n1+j;i<n1;i++){$(m1[i]).remove()}}j1.replaceWith(k1);b.addElement(D.getId(),$("#"+D.getId()))}function z(j1){var k1=$('#'+D.getId());var l1=k1.clone();var m1=$(l1[0].firstChild);var n1=m1.find('> tr');var o1=n1.length;if(j1>0){for(var i=0;i<o1;i++){var p1=$(n1[i]).find("> td");for(var j=0;j<j1;j++){$(p1[j]).remove()}}}else{for(var i=0;i<o1;i++){var p1=$(n1[i]).find("> td");var q1=p1.length-Math.abs(j1)-1;for(var j=p1.length-1;j>q1;j--){$(p1[j]).remove()}}}k1.replaceWith(l1);b.addElement(D.getId(),$("#"+D.getId()))}function B(i,j,j1,k1,l1,m1){var n1=$($('#'+D.getId())[0].firstChild);var o1=n1.html();var p1=Math.abs(i);var q1;if(i>0){R.write(o1);q1=j1+j-i;m1.renderArea(D,q1,p1,k1,l1)}else{q1=j;m1.renderArea(D,q1,p1,k1,l1);R.write(o1)}R.flush(n1[0])}function E(j,j1,k1,l1,m1,n1){var o1=$($('#'+D.getId())[0].firstChild);var p1;var q1=o1.find("> tr");if(j>0){p1=l1+m1-j;for(var i=0;i<q1.length;i++){var r1=$(q1[i]);var s1=r1.html();R.write("<tr>");R.write(s1);for(var t1=p1;t1<l1+m1;t1++){R.renderControl(D.getCell(j1+i,t1))}R.write("</tr>")}}else{p1=l1;for(var i=0;i<q1.length;i++){var r1=$(q1[i]);var s1=r1.html();R.write("<tr>");for(var t1=p1;t1<p1-j;t1++){R.renderControl(D.getCell(j1+i,t1))}R.write(s1);R.write("</tr>")}}}this.renderColHeaderArea=function(i){var j="";var j1=0;var k1=0;var l1=b.getElement(C.getId());var m1=m.getAreaWidth(d);var n1=0;var o1=c.getContentWidth()-m1;var p1=C.getColCnt();var q1=0;var r1=0;var s1,t1;var u1,v1;var w1;var x1=C.getRowCnt();var y1=0;var z1=j1;var A1;var B1=c.getId()+"_ColHeaderRow_";var C1=null;if(!c.getPropertyBag().isDebugMode()){l1.hide()}l1.html("");var D1=false;if(c.getPropertyBag().isPixelScrolling()){C1=K;j1=0;q1=p1}else{C1=J;j1=i;q1=p1-j1;D1=this.isHScrolledToEnd()}while(C1(k1,q1,r1,o1,D1)){j=l1[0].innerHTML;if(!j){G(l1)}z1=j1+k1;y1=0;t1=C.getFinalColWidth(z1);if(!t1){y1++}while(C1(k1,q1,r1,o1,D1)&&t1){k1++;r1+=t1;t1=C.getFinalColWidth(j1+k1);y1++}A1=z1+y1;for(s1=0;s1<x1;s1++){u1=B1+s1;w1=l1.find("#"+u1)[0];v1=w1.innerHTML;R.write("<tr id=\""+u1+"\" class=\"sapzencrosstab-HeaderRow\">");R.write(v1);for(var E1=z1;E1<A1;E1++){var F1=null;if(E1===j1){F1=C.getCellWithColSpan(s1,E1)}else{F1=C.getCell(s1,E1)}if(F1){R.renderControl(F1)}}R.write("</tr>")}R.flush(l1[0]);if(!C.getFinalColWidth(z1)){var G1=l1.outerWidth()-n1;r1+=G1;k1++}n1=l1.outerWidth()}C.setRenderSize(0,C.getRowCnt(),j1,k1);l1.show()};function F(){return(C.getRenderStartCol()>0)}this.appendColumnsAfterResize=function(){var i=b.getElement(C.getId());var j=0;var j1=0;var k1=0;if(C.getRenderStartCol()>0&&C.getRenderStartCol()+C.getRenderColCnt()===C.getColCnt()){var l1=c.getContentWidth()-m.getAreaWidth(d);var m1=i.outerWidth();j=m1;var n1=false;if(!c.getPropertyBag().isDebugMode()){i.hide()}while(m1<=l1&&C.getRenderStartCol()>0){this.appendLeftCols(C,1);this.appendLeftCols(D,1);n1=true;k1=C.getFinalColWidth(C.getRenderStartCol());if(k1){m1+=k1}else{j1=i.outerWidth()-j;m1+=j1}j=i.outerWidth()}i.show();if(n1){this.adjustRowHeights(d,C);this.adjustRowHeights(r,D);this.adjustColWidths(C,D);m.calculateRenderSize(true);this.calculateRenderSizeDivSize();if(!S){S=e.getScrollManager()}S.commandHScrolledToEnd()}}i=b.getElement(C.getId())};function G(i){var j=C.getRowCnt();var j1=0;for(j1=0;j1<j;j1++){R.write("<tr");R.writeAttribute("class","sapzencrosstab-HeaderRow");R.writeAttribute("id",c.getId()+"_ColHeaderRow_"+j1);R.write(">");R.write("</tr>")}R.flush(i[0])}function H(i){var j=i+1;var j1=0;var k1=j1+r.getColCnt();var l1=0;var m1=0;for(l1=i;l1<j;l1++){R.write("<tr");R.writeAttribute("class","sapzencrosstab-HeaderRow");R.write(">");for(m1=j1;m1<k1;m1++){var n1=r.getCellWithRowSpan(l1,m1);if(n1){R.renderControl(n1)}}R.write("</tr>")}}this.isVScrolledToEnd=function(){var i=false;if(S){i=S.isVScrolledToEnd()}return i};this.isHScrolledToEnd=function(){var i=false;if(S){i=S.isHScrolledToEnd()}return i};function J(i,j,j1,k1,l1){return((j1<k1)||l1)&&i<j}function K(i,j){return i<j}this.renderRowHeaderArea=function(i){var j="";var j1=b.getElement(r.getId());var k1=0;var l1=m.getAreaHeight(d);var m1=l1;var n1=c.getContentHeight();var o1=r.getRowCnt();var p1=0;var q1=1;var r1='#'+r.getId();var s1=null;if(!c.getPropertyBag().isDebugMode()){j1.hide()}$($(r1)[0].firstChild).html("");var t1=false;if(c.getPropertyBag().isPixelScrolling()){s1=K;i=0;p1=o1}else{s1=J;p1=o1-i;t1=this.isVScrolledToEnd()}while(s1(k1,p1,m1,n1,t1)){j=$($(r1)[0].firstChild).html()||"";R.write(j);q1=1;if(k1>0){if(c.getPropertyBag().isPixelScrolling()){q1=p1-k1}else{if(k1<p1-2){q1=3}else if(k1<p1-1){q1=2}}this.renderArea(r,i+k1,q1,0,r.getColCnt(),"sapzencrosstab-HeaderRow")}else{H(i)}R.flush(j1[0]);k1+=q1;m1=l1+j1.outerHeight()}j1.show();r.setRenderSize(i,k1,0,r.getColCnt());if(f){M(r)}};function L(r,i,j){var j1=1;var k1=r.getCell(i,j,true);if(!k1){while(!k1&&i>0){i--;j1++;k1=r.getCell(i,j,true)}}return j1}function M(r){var i=r.getRenderStartRow()+r.getRenderRowCnt()-1;var j=r.getRenderStartCol();var j1=j+r.getRenderColCnt()-1;var k1=0;var l1=null;var m1=1;for(k1=j;k1<=j1;k1++){l1=r.getCellWithRowSpan(i,k1);if(l1){m1=L(r,i,k1);l1.setHtmlIE8RowSpan(m1)}}}this.appendRowsAfterResize=function(){var i=b.getElement(r.getId());var j=0;var j1=0;var k1=0;if(r.getRenderStartRow()>0){var l1=c.getContentHeight()-m.getAreaHeight(d);var m1=i.outerHeight();j=m1;var n1=false;if(!c.getPropertyBag().isDebugMode()){i.hide()}while(m1<=l1&&r.getRenderStartRow()>0&&r.getRenderStartRow()+r.getRenderRowCnt()===r.getRowCnt()){this.appendTopRows(r,1);this.appendTopRows(D,1);n1=true;k1=r.getFinalRowHeight(r.getRenderStartRow());if(k1){m1+=k1}else{j1=i.outerHeight()-j;m1+=j1}j=i.outerHeight()}i.show();if(n1){this.adjustRowHeights(r,D);this.adjustColWidths(d,r);this.adjustColWidths(C,D);m.calculateRenderSize(true);this.calculateRenderSizeDivSize();if(!S){S=e.getScrollManager()}S.commandVScrolledToEnd()}}i=b.getElement(r.getId())};this.setUserColWidths=function(i){if(!i.hasContent()||!i.hasUserColWidths()){return}i.calculateColGranularity();var j=i.measureColGranularityCells();i.applyColWidthsToGranularityCells(j);var j1=b.getElement(i.getId());var k1=j1.clone();Q(i,j1,k1,true);j1.replaceWith(k1);j1=$("#"+i.getId());T(i,j1,true);b.addElement(i.getId(),$("#"+i.getId()));i.setColGranularityCalculatedAndMeasured(true)};this.adjustColWidths=function(j,j1){if(!j1.hasContent()||!j.hasContent()){if(!j.hasUserColWidths()&&!j1.hasUserColWidths()){return}}var k1=b.getElement(j.getId());var l1=b.getElement(j1.getId());j.calculateColGranularity();j1.calculateColGranularity();var m1=j.measureColGranularityCells();var n1=j1.measureColGranularityCells();j.setColGranularityCalculatedAndMeasured(false);j1.setColGranularityCalculatedAndMeasured(false);var i=0;var o1;for(i=j.getRenderStartCol();i<m1.length;i++){o1=Math.max(m1[i]||0,n1[i]||0);m1[i]=o1;n1[i]=o1}j.applyColWidthsToGranularityCells(m1,j.hasUserColWidths());j1.applyColWidthsToGranularityCells(n1,j1.hasUserColWidths());var p1=k1.clone();var q1=l1.clone();Q(j,k1,p1);Q(j1,l1,q1);k1.replaceWith(p1);l1.replaceWith(q1);k1=$("#"+j.getId());l1=$("#"+j1.getId());T(j,k1);T(j1,l1);if(j1.isRowHeaderArea()&&c.getNewLinesCnt()>0&&c.getCallValueHelpCommand()){O()}b.addElement(j.getId(),$("#"+j.getId()));b.addElement(j1.getId(),$("#"+j1.getId()))};function N(i,j){var j1=null;var k1=null;var l1=null;var m1=null;var n1=0;var o1=null;var p1=r.getColGranularity();var q1=0;var r1=p1[n1].iWidth;var s1=0;var t1=0;var u1=0;var v1=0;var w1=0;var x1=null;var y1=0;for(n1=0;n1<j;n1++){o1=r.getCell(i,n1);if(o1&&o1.isEntryEnabled()){k1=$('#'+o1.getId());j1=$('#'+o1.getId()+"_cellLayoutDiv");m1=sap.zen.crosstab.utils.Utils.getWidthFromStyle(j1);if(p1&&p1.length>0){r1=p1[n1].iWidth;s1=parseInt(k1.css("padding-left"))||0;t1=parseInt(k1.css("padding-right"))||0;u1=parseInt(k1.css("border-left-width"))||0;v1=parseInt(k1.css("border-right-width"))||0;q1=r1-s1-t1-u1-v1;j1.css("width",q1+"px");w1=$(j1.find("td")[1]).outerWidth();x1=$(j1.find("td")[0]);s1=parseInt(x1.css("padding-left"))||0;t1=parseInt(x1.css("padding-right"))||0;l1=x1.find("#"+o1.getId()+"_contentDiv");y1=q1-s1-t1-w1;l1.css("width",y1+"px")}}}}function O(){var j=r.getRenderColCnt();var j1=r.getRenderRowCnt();var k1=r.getRenderStartRow();var l1=r.getRowCnt();var m1=c.getNewLinesCnt();var n1=0;var i=0;if(c.isNewLinesTop()){if(k1<m1){for(n1=k1;n1<m1;n1++){N(n1,j)}}}else if(c.isNewLinesBottom()){var o1=(k1+j1)-(l1-m1);if(o1>0){var p1=k1+j1-1;for(i=0;i<o1;i++){N(p1,j);p1--}}}}this.adjustRowHeights=function(j,j1){if(!j1.hasContent()||!j.hasContent()){return}var k1=b.getElement(j.getId());var l1=b.getElement(j1.getId());j.calculateRowGranularity();j1.calculateRowGranularity();var m1=j.measureRowGranularityCells();var n1=j1.measureRowGranularityCells();var i=0;var o1;for(i=j.getRenderStartRow();i<m1.length;i++){o1=Math.max(m1[i]||0,n1[i]||0);m1[i]=o1;n1[i]=o1}var p1=j1.isColHeaderArea()?j1.getLevelCells():null;j.applyRowHeightsToGranularityCells(m1,p1);j1.applyRowHeightsToGranularityCells(n1,p1);var q1=k1.clone();var r1=l1.clone();U(j,k1,q1);U(j1,l1,r1);k1.replaceWith(q1);l1.replaceWith(r1);k1=$("#"+j.getId());l1=$("#"+j1.getId());V(j,k1);V(j1,l1);if($.browser.msie){P(j);P(j1)}b.addElement(j.getId(),$("#"+j.getId()));b.addElement(j1.getId(),$("#"+j1.getId()))};function P(i){var j=i.getCellsWithLineBreakTexts();var j1=0;var k1=0;var l1=0;var m1=0;var n1=0;var o1=0;var p1=null;var q1=null;if(j){l1=i.getRenderStartRow();m1=l1+i.getRenderRowCnt()-1;n1=i.getRenderStartCol();o1=n1+i.getRenderColCnt()-1;for(j1=l1;j1<=m1;j1++){for(k1=n1;k1<=o1;k1++){p1=i.getCell(j1,k1);if(p1){p1=j[p1.getId()];if(p1){q1=$('#'+p1.getId()+"_contentDiv");if(q1&&q1.length>0){q1.css("height",q1.outerHeight()+"px")}}}}}}}function Q(j,j1,k1,l1){var i=0;var m1=j.getColGranularity();var n1=null;var o1=null;var p1=null;var q1=null;var r1=0;for(i=0;i<m1.length;i++){n1=m1[i];if(n1){if(l1===true){if(!j.isFixedColWidthSet(n1.iCol)){continue}}o1=j1.find("#"+n1.sId);p1=k1.find("#"+n1.sId);r1=Z(o1,n1.iWidth,j.getCell(n1.iRow,n1.iCol));var s1=sap.ui.getCore().getControl(n1.sId);if(s1.isEntryEnabled()&&j.isRowHeaderArea()){q1=$(p1.find("#"+n1.sId+"_cellLayoutDiv"))}else{q1=$(p1.find("#"+n1.sId+"_contentDiv"))}q1.width(r1)}}}function T(j,j1,k1){var i=0;var l1=j.getColGranularity();var m1=null;var n1=null;var o1=null;var p1=0;var q1={};for(i=0;i<l1.length;i++){m1=l1[i];if(m1){if(k1===true){if(!j.isFixedColWidthSet(m1.iCol)){continue}}n1=j1.find("#"+m1.sId);p1=n1.outerWidth();if(p1>m1.iWidth){if(!o1){o1=j1.clone()}Y(j,j1,o1,m1,q1)}}}if(o1){j1.replaceWith(o1)}}function U(j,j1,k1){var i=0;var l1=j.getRowGranularity();var m1=null;var n1=null;var o1=null;var p1=null;var q1=0;for(i=0;i<l1.length;i++){m1=l1[i];if(m1){n1=j1.find("#"+m1.sId);o1=k1.find("#"+m1.sId);p1=o1.parent();q1=_(n1,m1.iHeight);p1.height(q1)}}}function V(j,j1){var i=0;var k1=j.getRowGranularity();var l1=null;var m1=null;var n1=0;var o1=null;var p1={};for(i=0;i<k1.length;i++){l1=k1[i];if(l1){m1=j1.find("#"+l1.sId);var q1=m1.parent();n1=q1.outerHeight();if(n1>l1.iHeight){if(!o1){o1=j1.clone()}X(j,j1,o1,l1,p1)}}}if(o1){j1.replaceWith(o1)}}function W(i,j){var j1=0;if(f){var k1=i.find("table");if(k1===null||k1.length===0){j1=a1(i,j)}}else{j1=a1(i,j)}return j1}function X(j,j1,k1,l1,m1){var n1=j.getRenderStartCol()+j.getRenderColCnt();var o1=0;var p1=null;var q1=0;var i=0;var r1=j.getCalculatedRowHeights();var s1=null;var t1=null;var u1=null;var v1=0;var w1=0;for(o1=j.getRenderStartCol();o1<n1;o1++){p1=j.getCellWithColSpan(l1.iRow,o1);if(!p1&&o1<l1.iCol){p1=j.getCellWithRowSpan(l1.iRow,o1);if(p1){if(!m1[p1.getId()]){m1[p1.getId()]=p1}else{p1=null}}}if(p1){t1=j1.find("#"+p1.getId());u1=k1.find("#"+p1.getId());if(t1.length>0){q1=0;w1=f?p1.getHtmlIE8RowSpan():p1.getEffectiveRowSpan();for(i=0;i<w1;i++){q1+=r1[l1.iRow+i]||0}v1=W(t1,q1);s1=$(u1.find("#"+p1.getId()+"_contentDiv"));s1.css("line-height",v1+"px")}}}}function Y(j,j1,k1,l1,m1){var n1=0;var o1=null;var p1=null;var q1=null;var r1=null;var s1=0;var t1=0;var i=0;var u1=j.getCalculatedColWidths();var v1;var w1=j.getRenderStartRow()+j.getRenderRowCnt();for(n1=j.getRenderStartRow();n1<w1;n1++){o1=j.getCellWithRowSpan(n1,l1.iCol);if(!o1&&n1<l1.iRow){o1=j.getCellWithColSpan(n1,l1.iCol);if(o1){if(!m1[o1.getId()]){m1[o1.getId()]=o1}else{o1=null}}}if(o1){p1=j1.find("#"+o1.getId());q1=k1.find("#"+o1.getId());if(p1.length>0){t1=0;v1=o1.getEffectiveColSpan();for(i=0;i<v1;i++){t1+=u1[l1.iCol+i]||0}s1=Z(p1,t1,o1);if(o1.isEntryEnabled()&&j.isRowHeaderArea()){r1=$(q1.find("#"+o1.sId+"_cellLayoutDiv"))}else{r1=$(q1.find("#"+o1.getId()+"_contentDiv"))}r1.width(s1)}}}}function Z(i,j,j1){var k1=parseInt(i.css("padding-left"))||0;var l1=parseInt(i.css("padding-right"))||0;var m1=parseInt(i.css("border-left-width"))||0;var n1=parseInt(i.css("border-right-width"))||0;var o1=0;var p1=0;if(j1!==null&&j1.isEntryEnabled()){if(j1.isEntryEnabled()&&j1.getArea().isRowHeaderArea()){var q1=$(i.find("#"+j1.getId()+"_cellLayoutDiv"))}else{var q1=i.find('#'+j1.getId()+"_contentDiv")}o1=parseInt(q1.css("border-left-width"))||0;p1=parseInt(q1.css("border-right-width"))||0}var r1=Math.max(1,j-k1-l1-m1-n1-o1-p1);return r1}function _(i,j){var j1=$(i).parent();var k1=parseInt(j1.css("border-top-width"),10)||0;var l1=parseInt(j1.css("border-bottom-width"),10)||0;var m1=j+k1+l1;return m1}function a1(i,j){var j1=parseInt(i.css("padding-top"))||0;var k1=parseInt(i.css("padding-bottom"))||0;var l1=parseInt(i.css("border-top-width"))||0;var m1=parseInt(i.css("border-bottom-width"))||0;var n1=j-j1-k1-l1-m1;return n1}this.determineHeaderScrollbarVisible=function(){if(k){var i=0;var j=null;var j1=null;var k1=false;if(d.getColCnt()>0){i=m.getAreaSize(d).iWidth;j1=$('#'+c.getId()+"_dimHeaderArea_container");j=$('#'+c.getId()+"_upperLeft_scrollDiv")}if(i===0){if(r.getColCnt()>0){i=m.getAreaSize(r).iWidth;j1=$('#'+c.getId()+"_rowHeaderArea_container");j=$('#'+c.getId()+"_lowerLeft_scrollDiv")}}if(i>0){k1=(j1.outerWidth()>j.outerWidth())}k.bHasHHeaderScrollbar=k1}};this.determineScrollbarsVisible=function(){k={};var i=m.getAreaSize(d);var j=m.calculateRenderSize();var j1=m.getRenderSizeDivSize(c);var k1=c.getContentWidth();var l1=c.getContentHeight();var m1=m.getBrowserScrollbarWidth();var n1=null;var o1=D.getRenderColCnt()===D.getColCnt();var p1=D.getRenderRowCnt()===D.getRowCnt();k.bHasHScrollbar=((j.iWidth>k1||!o1)&&j1.iWidth>i.iWidth);k.bHasVScrollbar=((j.iHeight>l1||!p1)&&j1.iHeight>i.iHeight);if(k.bHasHScrollbar&&!k.bHasVScrollbar){n1=m.getRenderSizeDivBorders();if(l1<=j.iHeight+m1+n1.borders.iBottomBorderWidth+n1.borders.iTopBorderWidth){k.bHasVScrollbar=true}}else if(!k.bHasHScrollbar&&k.bHasVScrollbar){n1=m.getRenderSizeDivBorders();if(k1<=j.iWidth+m1+n1.borders.iRightBorderWidth+n1.borders.iLeftBorderWidth){k.bHasHScrollbar=true}}this.determineHeaderScrollbarVisible()};this.setAdjustFrameDivs=function(i){p=i};this.removeOuterDivBorders=function(){var i=$(jQuery.sap.byId(c.getId()+"_renderSizeDiv"));i.css("border-bottom-width","");i.css("border-top-width","");i.css("border-left-width","");i.css("border-right-width","")};this.setDivSizeValidity=function(){q=!c.getRowHeaderArea().hasLoadingPages()&&!c.getColumnHeaderArea().hasLoadingPages()};this.calculateRenderSizeDivSize=function(){if(p||!q){var i=m.calculateRenderSize(true);var j=$(jQuery.sap.byId(c.getId()+"_renderSizeDiv"));var j1=m.getRenderSizeDivBorders(j);if(u!==-1){j1.borders.iBottomBorderWidth=u}var k1=c.getContentWidth()-j1.borders.iLeftBorderWidth-j1.borders.iRightBorderWidth;var l1=i.iWidth;j.width(Math.min(k1,l1)+"px");var m1=c.getContentHeight()-j1.borders.iBottomBorderWidth-j1.borders.iTopBorderWidth;var n1=i.iHeight;j.height(Math.min(m1,n1)+"px")}};this.adjustRenderSizeDivSize=function(){if(p||!q){var i=$(jQuery.sap.byId(c.getId()+"_renderSizeDiv"));var j=m.getRenderSizeDivBorders(i);if(u!==-1){j.borders.iBottomBorderWidth=u}var j1=m.getRenderSizeDivSize().iHeight;if(u!==-1){j1+=u}var k1=m.getRenderSizeDivSize().iWidth;var l1=c.getContentHeight();if(k.bHasHScrollbar||k.bHasHHeaderScrollbar){l1-=m.getBrowserScrollbarWidth()}if(c.getRenderMode()===sap.zen.crosstab.rendering.RenderingConstants.RENDERMODE_COMPACT){var m1=(k.bHasHScrollbar||k.bHasHHeaderScrollbar)?m.getBrowserScrollbarWidth():0;var n1=c.getPropertyBag().getToolbarHeight();var o1=j1+m1+j.borders.iBottomBorderWidth+j.borders.iTopBorderWidth+n1;var p1=l1+m1+n1;if(p1>=o1){l1=o1;var t=b.getElement(c.getId());t.css("height",l1+"px");if(u===-1){u=parseInt(i.css("border-bottom-width"),10)}i.css("border-bottom-width","0px")}}if(j1>=l1){if(u===-1){u=parseInt(i.css("border-bottom-width"),10)}i.css("border-bottom-width","0px")}var q1=Math.min(j1,l1);i.css("height",q1);var r1=c.getContentWidth();if(k.bHasVScrollbar){r1-=m.getBrowserScrollbarWidth()}if(c.getRenderMode()===sap.zen.crosstab.rendering.RenderingConstants.RENDERMODE_COMPACT){var s1=k.bHasVScrollbar?m.getBrowserScrollbarWidth():0;var t1=k1+s1+j.borders.iLeftBorderWidth+j.borders.iRightBorderWidth;var u1=r1+s1;if(u1>=t1){r1=t1;var t=b.getElement(c.getId());t.css("width",r1+"px");i.css("border-right-width","0px")}}if(k1>=r1){i.css("border-right-width","0px")}var v1=Math.min(k1,r1);i.css("width",v1)}};this.renderScrollbars=function(){this.determineScrollbarsVisible();if(k.bHasHScrollbar||k.bHasVScrollbar||k.bHasHHeaderScrollbar){if(!S){S=e.getScrollManager()}if(k.bHasHHeaderScrollbar){h=e.getHeaderScrollManager()}if(s){s.destroy();s=null}s=new sap.zen.crosstab.rendering.ScrollbarRenderer(c,R,m,b);s.renderScrollbars(k);s.attachHandlers(S.hScrollHandler,S.vScrollHandler,k.bHasHHeaderScrollbar?h.hScrollHandler:null);b1()}else{S=null}};function b1(){var i=0;for(i=0;i<n.length;i++){n[i]()}}this.setScrollbarSteps=function(){if(s){s.setScrollbarSteps()}};this.adjustScrollDivSizes=function(){var i=jQuery.sap.byId(c.getId()+"_lowerLeft");var j=i.outerWidth();var j1=m.getRenderSizeDivSize();var k1=(j1.iWidth-j)+"px";var l1=jQuery.sap.byId(c.getId()+"_lowerRight_scrollDiv");l1.width(k1);var m1=jQuery.sap.byId(c.getId()+"_upperRight_scrollDiv");m1.width(k1);var n1=jQuery.sap.byId(c.getId()+"_upperLeft");var o1=n1.outerHeight();if(!o1){var p1=jQuery.sap.byId(c.getId()+"_upperRight");o1=p1.outerHeight()}var q1=(j1.iHeight-o1)+"px";l1.height(q1);var r1=jQuery.sap.byId(c.getId()+"_lowerLeft_scrollDiv");r1.height(q1)};this.appendLeftCols=function(i,j){var j1=Math.max(0,i.getRenderStartCol()-j);var k1=Math.max(0,i.getRenderStartCol()-1);var l1=j;if(j1===k1){l1=1}var m1=i.getRenderStartRow();var n1=m1+i.getRenderRowCnt()-1;var o1=null;var p1=0;var q1=0;var r1=0;var s1=$('#'+i.getId());var t1=s1.children("tbody");if(t1.length===0){s1.append("<tbody></tbody>");t1=s1.children("tbody");for(r1=m1;r1<=n1;r1++){t1.append("<tr/>")}}var u1=t1.children("tr");for(r1=m1;r1<=n1;r1++){var v1=u1[p1];q1=0;for(var w1=j1;w1<=k1;w1++){if(q1===0){o1=i.getCellWithColSpan(r1,w1)}else{o1=i.getCell(r1,w1)}if(o1){var x1=o1.getColSpan();if(x1>1){var y1=o1.getEffectiveColSpan();var z1=Math.min(l1,(i.getRenderStartCol()-j1));var A1=y1-(z1-q1);if(A1>0){var B1=$(v1).find("> :first-child");B1.remove()}}R.renderControl(o1)}q1++}var C1=$($(u1[p1])).html();R.write(C1);R.flush(v1);p1++}var D1=i.getRenderColCnt();var E1=k1-j1+1;i.setRenderColCnt(D1+E1);i.setRenderStartCol(j1)};this.appendTopRows=function(j1,k1){var l1=Math.max(0,j1.getRenderStartRow()-k1);var m1=Math.max(0,j1.getRenderStartRow()-1);var n1=k1;if(l1===m1){n1=1}var o1=j1.getRenderStartCol();var p1=o1+j1.getRenderColCnt()-1;var q1=$('#'+j1.getId());var r1=q1.children("tbody");if(r1.length===0){q1.append("<tbody/>");r1=q1.children("tbody")}var s1=r1.html();var t1=[];var u1=0;var v1=0;var w1=null;if(!c.getPropertyBag().isDebugMode()){r1.hide()}for(var x1=l1;x1<=m1;x1++){v1=0;R.write("<tr");R.writeAttribute("class","sapzencrosstab-HeaderRow");R.write(">");for(var y1=o1;y1<=p1;y1++){w1=null;if(u1===0){w1=j1.getCellWithRowSpan(x1,y1)}else{w1=j1.getCell(x1,y1)}if(w1){var z1=w1.getRowSpan();if(z1>1){var A1=w1.getEffectiveRowSpan();var B1=A1-(n1-u1);if(B1>0){t1.push(y1)}}R.renderControl(w1)}v1++}R.write("</tr>");u1++}var C1=[];if(t1.length>0){var D1=$('#'+j1.getId()).children("tbody").children("tr");var E1=$(D1[0]);var i=0;for(i=0;i<t1.length;i++){var w1=E1.find("> :nth-child("+(t1[i]+1)+")");if(w1.length>0){var F1=w1.attr('id');C1.push(F1)}}for(var j=0;j<C1.length;j++){var G1=E1.find("#"+C1[j]);G1.remove()}R.write("<tr");R.writeAttribute("class","sapzencrosstab-HeaderRow");R.write(">");R.write(E1.html()+"</tr>");for(i=1;i<D1.length;i++){R.write("<tr");R.writeAttribute("class","sapzencrosstab-HeaderRow");R.write(">");R.write($(D1[i]).html()+"</tr>")}}else{R.write(s1)}j1.setRenderStartRow(l1);j1.setRenderRowCnt(j1.getRenderRowCnt()+m1-l1+1);R.flush(r1[0]);r1.show()};function c1(i,j,j1){var k1=0;var l1=j.getScrollPosition();var m1={};m1.parameters={};m1.oSource=j;m1.parameters.oldScrollPos=l1;if(c.getPropertyBag().isPixelScrolling()||j1){k1=Math.max(0,Math.min(i,parseInt(j.getContentSize(),10)));m1.parameters.action="Drag"}else{k1=Math.max(0,Math.min(i,j.getSteps()));m1.parameters.action="STEP"}m1.getParameters=function(){return this.parameters};m1.parameters.newScrollPos=k1;m1.parameters.forward=(k1-l1)>0;return m1}this.scrollHorizontal=function(i){if(c.getHScrollbar()){var j=c1(i,c.getHScrollbar());c.getHScrollbar().setScrollPosition(j.getParameters().newScrollPos);S.hScrollHandler(j,true)}};this.scrollVertical=function(i,j){if(c.getVScrollbar()){var j1=c1(i,c.getVScrollbar());c.getVScrollbar().setScrollPosition(j1.getParameters().newScrollPos);var k1=false;if(!j){k1=true}S.vScrollHandler(j1,k1)}};this.scrollHeaderHorizontal=function(i){var j=c.getHorizontalHeaderScrollbar();if(j){var j1=c1(i,j,true);j.setScrollPosition(j1.getParameters().newScrollPos);h.hScrollHandler(j1)}};this.getMeasuringHelper=function(){return m};this.reset=function(){e.reset();S=null;m.reset();if(s){s.destroy();s=null}n=[];q=false;u=-1};this.adjustScrollPositions=function(i){if(k.bHasHScrollbar||k.bHasVScrollbar){if(g&&c.getPropertyBag().isPixelScrolling()){var j=0;var j1=e.getSavedVScrollInfo();if(j1){var D=c.getDataArea();var k1=m.getAreaHeight(D);var l1=D.getRowCnt();var m1=Math.round(k1/l1);j=j1.iPos*m1}S.setVScrollPos(j)}var n1=undefined;var o1=undefined;if(e){if(e.hasSavedInfo()){var p1=e.getSavedHScrollInfo();if(p1){n1=p1.bScrolledToEnd}p1=e.getSavedVScrollInfo();if(p1){o1=p1.bScrolledToEnd}}}S.moveScrollbars(k,i,n1,o1);g=false}if(c.isHeaderHScrolling()===true){if(e&&e.hasSavedInfo()===true){h.setHScrollData(e.getHeaderScrollData());h.moveScrollbars()}}};this.hasCrosstabSizeChanged=function(){return m.hasCrosstabSizeChanged(true)};this.getTableDivValues=function(){return m.getTableDivBordersAndPadding()};function d1(){var t=c.getTableDiv();var i=C.getId();var j=r.getId();var j1=d.getId();var k1=D.getId();b.addElement(c.getId(),t);b.addElement(i,t.find("#"+i));b.addElement(j,t.find("#"+j));b.addElement(j1,t.find("#"+j1));b.addElement(k1,t.find("#"+k1))}this.showLoadingIndicator=function(){if(!l&&!I){l=setTimeout(e1,300)}else if(I){e1()}};function e1(){I=true;var t=b.getElement(c.getId());t.addClass("sapzencrosstab-TableDivLoading");var i=t.find("#"+c.getId()+"_loadingAnimationDiv");var j=parseInt(i.css("width"),10);var j1=parseInt(i.css("height"),10);var k1=m.getRenderSizeDivSize(c);var l1=k1.iWidth/2-j/2;var m1=k1.iHeight/2-j1/2;i.css("top",m1+"px");i.css("left",l1+"px");i.css("visibility","visible")}function f1(){if(l){clearTimeout(l);l=""}}this.hideLoadingIndicator=function(){f1();var t=b.getElement(c.getId());t.removeClass("sapzencrosstab-TableDivLoading");var i=t.find("#"+c.getId()+"_loadingAnimationDiv");if(i&&i[0]){i.css("visibility","hidden")}I=false};this.showLoadingVisualization=function(){if(D.hasLoadingPages()){this.showLoadingIndicator()}else{this.hideLoadingIndicator()}};this.moveScrollDivs=function(){if(S){if(k){if(k.bHasHScrollbar){S.positionHScrollDiv()}if(k.bHasVScrollbar){S.positionVScrollDiv()}}}};this.getCrossRequestManager=function(){return e};this.registerNewScrollbarsNotification=function(i){if($.inArray(i,n)===-1){n.push(i)}};this.checkScrollbarSize=function(){if(k.bHasVScrollbar){var i=$('#'+c.getId()+'_upperRightPad');var j=null;if(c.hasDimensionHeaderArea()){j=$('#'+c.getId()+'_upperLeft_scrollDiv')}else if(c.hasColHeaderArea()){j=$('#'+c.getId()+'_upperRight_scrollDiv')}if(i!==null&&i.length>0&&j!==null&&j.length>0){var j1=j.outerHeight();if(j1!==i.outerHeight()){if(s){s.adjustVScrollbarHeight(j1)}}}}if(k.bHasHScrollbar){var k1=$('#'+c.getId()+'_lowerLeftPad');var l1;if(c.hasRowHeaderArea()){l1=$('#'+c.getId()+'_lowerLeft_scrollDiv')}else{l1=$('#'+c.getId()+'_upperLeft_scrollDiv')}var m1=l1.outerWidth();if(m1!==k1.outerWidth()){if(s){s.adjustHScrollbarWidth(m1)}}}};this.updateRenderingOfInputCellAfterCheck=function(i){var j=$('#'+i.getId());if(j.length>0){var j1=sap.zen.crosstab.CellStyleHandler.getCompleteStyleName(sap.zen.crosstab.rendering.RenderingConstants.STYLE_INVALID_VALUE,i.getCellType());if(i.hasStyle(sap.zen.crosstab.rendering.RenderingConstants.STYLE_INVALID_VALUE)===true){j.addClass(j1)}else{j.removeClass(j1)}var k1=j.find("#"+i.getId()+"_contentDiv");k1.html(i.getText())}};this.updateHeaderScrollbarSizes=function(){if(s){s.setHorizontalHeaderScrollbarSteps();s.adjustHorizontalHeaderScrollbarContainerSize()}};function g1(i,j){var j1=$('#'+c.getId()+i);if(j1.length>0){if(j===true){j1.find("tbody>tr[class=sapzencrosstab-HeaderRow]>td:last-child").addClass("sapzencrosstab-removeRightBorder")}else{j1.find("tbody>tr[class=sapzencrosstab-HeaderRow]>td:last-child").removeClass("sapzencrosstab-removeRightBorder")}}}function h1(j,i){if(j&&j.length>0){j.addClass("sapzencrosstab-lowerScrollHeaderSeparator")}if(i&&i.length>0){i.addClass("sapzencrosstab-upperScrollHeaderSeparator")}g1("_rowHeaderArea",true);g1("_dimHeaderArea",true)}function i1(j,i){if(j&&j.length>0){j.removeClass("sapzencrosstab-lowerScrollHeaderSeparator")}if(i&&i.length>0){i.removeClass("sapzencrosstab-upperScrollHeaderSeparator")}g1("_rowHeaderArea",false);g1("_dimHeaderArea",false)}this.forceHeaderWidth=function(){var j=null;var i=null;var j1=0;var k1=0;var l1=0;if(c.hasRowHeaderArea()===false&&c.hasDimensionHeaderArea()===false){return}var m1=c.getPropertyBag().getMaxHeaderWidth();if(!isNaN(m1)&&m1>0){if(c.hasRowHeaderArea()){j=$('#'+c.getId()+'_lowerLeft_scrollDiv');j1=j.outerWidth()}if(c.hasDimensionHeaderArea()){i=$('#'+c.getId()+'_upperLeft_scrollDiv');k1=i.outerWidth()}l1=Math.max(j1,k1);if(l1>m1){j.css("width",m1);i.css("width",m1);c.setHeaderHScrolling(true)}else{if(c.isHeaderHScrolling()===true){c.setHeaderHScrolling(false);c.getUtils().sendClientScrollPosUpdate(0,undefined,undefined,undefined,true)}}if(c.isHeaderHScrolling()){h1(j,i)}else{i1(j,i)}}else{c.setHeaderHScrolling(false);c.setHorizontalHeaderScrollbar(null)}};this.getHeaderScrollManager=function(){return h}};
