jQuery.sap.require("sap.ca.scfld.md.controller.BaseFullscreenController");jQuery.sap.includeStyleSheet("../../resources/sap/suite/ui/smartbusiness/designtime/kpi/view/KpiParametersCss.css");sap.ca.scfld.md.controller.BaseFullscreenController.extend("sap.suite.ui.smartbusiness.designtime.kpi.view.S1",{onInit:function(){var t=this;this.kpiCreateModel=new sap.ui.model.json.JSONModel();this.oDataModel=this.oApplicationFacade.getODataModel();this.viewData={};this.oResourceBundle=this.oApplicationFacade.getResourceBundle();this.oDataModel.read("/LANGUAGE?$filter=LAISO eq '"+(sap.ui.getCore().getConfiguration().getLocale().getLanguage()).toUpperCase()+"'",null,null,false,function(a){t.localLanguage=a.results[0].SPRAS});var o={bSuppressBookmarkButton:{},onBack:function(){t.cancel()},oEditBtn:{sI18nBtnTxt:"SAVE",onBtnPressed:function(e){t.save()}},buttonList:[{sI18nBtnTxt:"SAVE_ACTIVATE",onBtnPressed:function(e){t.saveAndActivate()}},{sI18nBtnTxt:"SAVE_CREATE_NEW",onBtnPressed:function(e){t.saveAndCreateNew()}},{sI18nBtnTxt:"ACTIVATE_ADD_EVAL",onBtnPressed:function(e){t.activateAndAddEvaluation()}},{sI18nBtnTxt:"CANCEL",onBtnPressed:function(e){t.cancel()}}]};var c={bSuppressBookmarkButton:{},sI18NFullscreenTitle:"FULLSCREEN_EDIT_TITLE",onBack:function(){t.cancel()},oEditBtn:{sI18nBtnTxt:"SAVE",onBtnPressed:function(e){t.save()}},buttonList:[{sI18nBtnTxt:"SAVE_ACTIVATE",onBtnPressed:function(e){t.saveAndActivate()}},{sI18nBtnTxt:"SAVE_CREATE_NEW",onBtnPressed:function(e){t.saveAndCreateNew()}},{sI18nBtnTxt:"ACTIVATE_ADD_EVAL",onBtnPressed:function(e){t.activateAndAddEvaluation()}},{sI18nBtnTxt:"CANCEL",onBtnPressed:function(e){t.cancel()}}]};var d={bSuppressBookmarkButton:{},sI18NFullscreenTitle:"FULLSCREEN_EDIT_TITLE",onBack:function(){t.cancel()},oEditBtn:{sI18nBtnTxt:"SAVE",onBtnPressed:function(e){t.save()}},buttonList:[{sI18nBtnTxt:"SAVE_ACTIVATE",onBtnPressed:function(e){t.saveAndActivate()}},{sI18nBtnTxt:"DELETE_DRAFT",onBtnPressed:function(e){t.deleteDraft()}},{sI18nBtnTxt:"CANCEL",onBtnPressed:function(e){t.cancel()}}]};this.setHeaderFooterOptions(o);this.oRouter.attachRouteMatched(function(f){t.route=f.getParameter("name");if(f.getParameter("name")=="editKpi"){t.context=new sap.ui.model.Context(t.getView().getModel(),'/'+(f.getParameter("arguments").contextPath));var g=(/ID=\'.*\'/).exec(f.getParameter("arguments").contextPath)[0];var k=g.slice(g.indexOf("'")+1,g.lastIndexOf("'"));var h=(/IS_ACTIVE=.*/).exec(f.getParameter("arguments").contextPath)[0];var j=h.slice(h.indexOf("=")+1,h.lastIndexOf(")"));t.viewData={mode:"EDIT",ID:k,IS_ACTIVE:parseInt(j)};if(t.viewData.IS_ACTIVE==1){t.viewData.IS_DRAFT=true}t.setHeaderFooterOptions(c);t._oControlStore.oTitle.setText(t.oResourceBundle.getText("FULLSCREEN_DYN_TITLE","Edit"));try{if(sap.ushell.services.AppConfiguration&&sap.ushell.services.AppConfiguration.setWindowTitle){sap.ushell.services.AppConfiguration.setWindowTitle(t.oResourceBundle.getText("FULLSCREEN_EDIT_TITLE"))}}catch(e){jQuery.sap.log.error("Error Setting Window Page Title : "+t.oResourceBundle.getText("FULLSCREEN_EDIT_TITLE"))}}else if(f.getParameter("name")=="editDraftKpi"){t.context=new sap.ui.model.Context(t.getView().getModel(),'/'+(f.getParameter("arguments").contextPath));var g=(/ID=\'.*\'/).exec(f.getParameter("arguments").contextPath)[0];var k=g.slice(g.indexOf("'")+1,g.lastIndexOf("'"));var h=(/IS_ACTIVE=.*/).exec(f.getParameter("arguments").contextPath)[0];var j=h.slice(h.indexOf("=")+1,h.lastIndexOf(")"));t.viewData={mode:"EDIT",ID:k,IS_ACTIVE:parseInt(j),IS_DRAFT:true};t.setHeaderFooterOptions(d);t._oControlStore.oTitle.setText(t.oResourceBundle.getText("FULLSCREEN_DYN_TITLE","Edit"));try{if(sap.ushell.services.AppConfiguration&&sap.ushell.services.AppConfiguration.setWindowTitle){sap.ushell.services.AppConfiguration.setWindowTitle(t.oResourceBundle.getText("FULLSCREEN_EDIT_TITLE"))}}catch(e){jQuery.sap.log.error("Error Setting Window Page Title : "+t.oResourceBundle.getText("FULLSCREEN_EDIT_TITLE"))}}else if(f.getParameter("name")=="duplicateKpi"){t.context=new sap.ui.model.Context(t.getView().getModel(),'/'+(f.getParameter("arguments").contextPath));var g=(/ID=\'.*\'/).exec(f.getParameter("arguments").contextPath)[0];var k=g.slice(g.indexOf("'")+1,g.lastIndexOf("'"));var h=(/IS_ACTIVE=.*/).exec(f.getParameter("arguments").contextPath)[0];var j=h.slice(h.indexOf("=")+1,h.lastIndexOf(")"));t.viewData={mode:"DUPLICATE",ID:k,IS_ACTIVE:parseInt(j)};t._oControlStore.oTitle.setText(t.oResourceBundle.getText("FULLSCREEN_DYN_TITLE","Duplicate"))}else{t.viewData={mode:"CREATE",};t._oControlStore.oTitle.setText(t.oResourceBundle.getText("FULLSCREEN_DYN_TITLE","Create"))}if(t.viewData.mode=="CREATE"){var l={};l.MODE="CREATE";l.TYPE="KPI";l.KPITYPE=true;l.OPITYPE=false;l.NO_OF_ADDITIONAL_LANGUAGES=0;l.ADDITIONAL_LANGUAGE_ARRAY=[];l.GOAL_TYPE="MA";t.kpiModelDataForDirtyBitCheck=$.extend(true,{},l);t.kpiCreateModel.setData(l);t.getView().setModel(t.kpiCreateModel)}else if(t.viewData.mode=="EDIT"||t.viewData.mode=="DUPLICATE"){t.oDataModel.read("/INDICATORS(ID='"+t.viewData.ID+"',IS_ACTIVE="+t.viewData.IS_ACTIVE+")",null,null,false,function(a){t.indicatorPayloadForDirtyBitTest=$.extend(true,{},a);a.MODE=t.viewData.mode;if(a.TYPE=="KPI"){a.KPITYPE=true;a.OPITYPE=false}else if(a.TYPE=="OPI"){a.KPITYPE=false;a.OPITYPE=true}t.oDataModel.read("/TAGS?$filter=ID eq '"+a.ID+"' and IS_ACTIVE eq "+a.IS_ACTIVE+" and TYPE eq 'IN'",null,null,false,function(b){b=b.results;var n=[];var i;for(i=0;i<b.length;i++){n.push(b[i].TAG)}a.TAGS=n;a.TAG=a.TAGS.toString(",");t.OLD_TAGS=n},function(b){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_FETCHING_TAGS"))});t.oDataModel.read("/PROPERTIES?$filter=ID eq '"+a.ID+"' and IS_ACTIVE eq "+a.IS_ACTIVE+" and TYPE eq 'IN'",null,null,false,function(p){p=p.results;var b=[];var i;for(i=0;i<p.length;i++){var n={};n.NAME=p[i].NAME,n.VALUE=p[i].VALUE;b.push(n)}a.PROPERTIES=b;t.OLD_PROPERTIES=$.extend(true,[],b)},function(b){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_FETCHING_PROPERTIES"))});t.oDataModel.read("/INDICATOR_TEXTS?$filter=ID eq '"+a.ID+"' and IS_ACTIVE eq "+a.IS_ACTIVE,null,null,false,function(b){b=b.results;var n=[];var i;for(i=0;i<b.length;i++){if(b[i].LANGUAGE!=t.localLanguage){n.push(b[i])}}var p=[];var i;for(i=0;i<n.length;i++){var q={};q.ADDITIONAL_LANGUAGE_TITLE=n[i].TITLE;q.ADDITIONAL_LANGUAGE_DESCRIPTION=n[i].DESCRIPTION;q.ADDITIONAL_LANGUAGE_SPRAS_KEY=n[i].LANGUAGE;t.oDataModel.read("/LANGUAGE?$filter=SPRAS eq '"+n[i].LANGUAGE+"'",null,null,false,function(r){q.ADDITIONAL_LANGUAGE_KEY=r.results[0].LAISO});p.push(q)}a.ADDITIONAL_LANGUAGE_ARRAY=p;a.NO_OF_ADDITIONAL_LANGUAGES=a.ADDITIONAL_LANGUAGE_ARRAY.length;t.OLD_ADDITIONAL_LANGUAGE_ARRAY=p},function(b){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_FETCHING_ADDITIONAL_LANGUAGES"))});t.kpiCreateModel.setData(a);t.getView().setModel(t.kpiCreateModel);if(a.MODE=="EDIT"){t.getView().byId("kpiId").setEditable(false)}},function(a){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("YMSG_ERROR_RETRIEVING_DATA"))})}var m=t.getView().byId('kpiParameterInputForm');m.addContent(new sap.m.Label({text:t.oResourceBundle.getText("PROPERTY_NAME_VALUE")}));if(t.viewData.mode==="EDIT"||t.viewData.mode==="DUPLICATE"){t.byId("odataServiceInput").fireChange()}t.getView().byId("propertyNameValueBox").bindAggregation("items","/PROPERTIES",function(a,b){return new sap.ui.layout.Grid({content:[new sap.m.Input({value:"{NAME}",layoutData:new sap.ui.layout.GridData({span:"L4 M4 S4"})}),new sap.m.Input({value:"{VALUE}",layoutData:new sap.ui.layout.GridData({span:"L4 M4 S4"})}),new sap.m.Button({icon:"sap-icon://sys-cancel",type:"Transparent",layoutData:new sap.ui.layout.GridData({span:"L2 M2 S2"}),press:function(f){t.removeProperty(f)}})],defaultSpan:"L12 M12 S12"}).addStyleClass("propertyEntryGrid")})})},save:function(){var s=this.saveKpiDetails();if(s){if(this.viewData.IS_DRAFT){sap.suite.smartbusiness.utils.appToAppNavigation({action:"SBWorkspace",route:"detail",context:"INDICATORS_MODELER(ID='"+this.getView().getModel().getData().ID+"',IS_ACTIVE=1)"})}else{sap.suite.smartbusiness.utils.appToAppNavigation({action:"SBWorkspace",route:"detail",context:"INDICATORS_MODELER(ID='"+this.getView().getModel().getData().ID+"',IS_ACTIVE=0)"})}}},activateAndAddEvaluation:function(){var t=this;var s=false;var a=false;if(!(this.getView().getModel().getData().TITLE)){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_INDICATOR_TITLE"));s=false;a=false}else{s=this.saveKpiDetails();if(s){var p={ID:this.getView().getModel().getData().ID};sap.suite.smartbusiness.utils.create(sap.suite.smartbusiness.utils.serviceUrl('ACTIVATE_INDICATOR_SERVICE_URI'),p,null,function(d){if(t.getView().getModel().getData().TYPE=="KPI"){sap.m.MessageToast.show(t.oResourceBundle.getText("ACTIVATE_KPI_SUCCESS"))}else{sap.m.MessageToast.show(t.oResourceBundle.getText("ACTIVATE_OPI_SUCCESS"))}a=true},function(e){if(t.getView().getModel().getData().TYPE=="KPI"){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ACTIVATE_KPI_ERROR"))}else{sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ACTIVATE_OPI_ERROR"))}a=false})}}if(a){sap.suite.smartbusiness.utils.appToAppNavigation({action:"createSBKPIEvaluation",route:"addEvaluation",context:"INDICATORS_MODELER(ID='"+this.getView().getModel().getData().ID+"',IS_ACTIVE=1)"})}},saveAndCreateNew:function(){var s=this.saveKpiDetails();if(s){var k={};k.MODE="CREATE";k.NO_OF_ADDITIONAL_LANGUAGES=0;k.ADDITIONAL_LANGUAGE_ARRAY=[];k.GOAL_TYPE="MA";k.KPITYPE=true;k.OPITYPE=false;k.TYPE="KPI";this.kpiCreateModel.setData(k);this.getView().setModel(this.kpiCreateModel);this.getView().getModel().getData().KPITYPE=true;this.getView().getModel().getData().OPITYPE=false;this.getView().getModel().getData().TYPE="KPI";this.getView().byId("KPI").setSelected(true);this.getView().byId("OPI").setSelected(false);this.getView().getModel().updateBindings();this.getView().byId('kpiId').setEditable(true);this.getView().byId('viewInput').fireChange();this.kpiModelDataForDirtyBitCheck=$.extend(true,{},k);sap.suite.smartbusiness.utils.appToAppNavigation({action:"createSBKPI"})}},saveAndActivate:function(){var t=this;var s=false;var a=false;if(!(this.getView().getModel().getData().TITLE)){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_INDICATOR_TITLE"));a=false}else{s=this.saveKpiDetails();if(s){var p={ID:this.getView().getModel().getData().ID};sap.suite.smartbusiness.utils.create(sap.suite.smartbusiness.utils.serviceUrl('ACTIVATE_INDICATOR_SERVICE_URI'),p,null,function(d){if(t.getView().getModel().getData().TYPE=="KPI"){sap.m.MessageToast.show(t.oResourceBundle.getText("ACTIVATE_KPI_SUCCESS"))}else{sap.m.MessageToast.show(t.oResourceBundle.getText("ACTIVATE_OPI_SUCCESS"))}a=true},function(e){if(t.getView().getModel().getData().TYPE=="KPI"){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ACTIVATE_KPI_ERROR"))}else{sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ACTIVATE_OPI_ERROR"))}a=false})}}if(a){sap.suite.smartbusiness.utils.appToAppNavigation({action:"SBWorkspace",route:"detail",context:"INDICATORS_MODELER(ID='"+this.getView().getModel().getData().ID+"',IS_ACTIVE=1)"})}},deleteDraft:function(){var t=this;var b=new sap.m.Dialog({icon:"sap-icon://warning2",title:t.oResourceBundle.getText("WARNING"),state:"Warning",type:"Message",content:[new sap.m.Text({text:t.oResourceBundle.getText("WARNING_DELETE_DRAFT_KPI_OPI")})],beginButton:new sap.m.Button({text:t.oResourceBundle.getText("OK"),press:function(){b.close();t.callDeleteDraft()}}),endButton:new sap.m.Button({text:t.oResourceBundle.getText("CANCEL"),press:function(){b.close()}})});b.open()},callDeleteDraft:function(){var t=this;var p={};p.ID=t.viewData.ID;p.IS_ACTIVE=t.viewData.IS_ACTIVE;sap.suite.smartbusiness.utils.remove(sap.suite.smartbusiness.utils.serviceUrl('INDICATOR_SERVICE_URI'),p,function(d){if(t.getView().getModel().getData().TYPE=="KPI"){sap.m.MessageToast.show(t.oResourceBundle.getText("SUCCESS_KPI_DELETE"))}else{sap.m.MessageToast.show(t.oResourceBundle.getText("SUCCESS_OPI_DELETE"))}sap.suite.smartbusiness.utils.appToAppNavigation({action:"SBWorkspace",route:"detail",context:"INDICATORS_MODELER(ID='"+t.getView().getModel().getData().ID+"',IS_ACTIVE=1)"})},function(e){if(t.getView().getModel().getData().TYPE=="KPI"){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_KPI_DELETE"))}else{sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_OPI_DELETE"))}})},cancel:function(){var t=this;var i=false;var l=false;var a=false;var p=false;if(this.route==="createKpi"){if(t.kpiCreateModel.getData().ADDITIONAL_LANGUAGE_ARRAY&&t.kpiCreateModel.getData().ADDITIONAL_LANGUAGE_ARRAY.length){l=true}if((t.kpiCreateModel.getData().TAGS&&t.kpiCreateModel.getData().TAGS.length)||t.kpiCreateModel.getData().TAG){a=true}if(t.kpiCreateModel.getData().PROPERTIES&&t.kpiCreateModel.getData().PROPERTIES.length){p=true}delete t.kpiModelDataForDirtyBitCheck.ADDITIONAL_LANGUAGE_ARRAY;delete t.kpiModelDataForDirtyBitCheck.TAG;delete t.kpiModelDataForDirtyBitCheck.TAGS;delete t.kpiModelDataForDirtyBitCheck.PROPERTIES;delete t.kpiCreateModel.getData().ADDITIONAL_LANGUAGE_ARRAY;delete t.kpiCreateModel.getData().TAG;delete t.kpiCreateModel.getData().TAGS;delete t.kpiCreateModel.getData().PROPERTIES;var b=sap.suite.smartbusiness.utils.dirtyBitCheck({oldPayload:t.kpiModelDataForDirtyBitCheck,newPayload:t.kpiCreateModel.getData(),objectType:"INDICATORS"});if(b&&b.updates.length){i=true}if(i||l||a||p){var c=new sap.m.Dialog({icon:"sap-icon://warning2",title:t.oResourceBundle.getText("WARNING"),state:"Warning",type:"Message",content:[new sap.m.Text({text:t.oResourceBundle.getText("WARNING_UNSAVED_MESSAGE")})],beginButton:new sap.m.Button({text:t.oResourceBundle.getText("CONTINUE"),press:function(){c.close();window.history.back()}}),endButton:new sap.m.Button({text:t.oResourceBundle.getText("CANCEL"),press:function(){c.close()}})});c.open()}else{window.history.back()}}else{var d=t.getIndicatorChanges();var e=t.getTagChanges();var f=t.getPropertiesChanges();var g=t.getLanguageChanges();if(d&&(d.updates.length)){i=true}if(g&&(g.updates.length||g.deletes.length)){l=true}if(e&&(e.updates.length||e.deletes.length)){a=true}if(f&&(f.updates.length||f.deletes.length)){p=true}if(i||l||a||p){var c=new sap.m.Dialog({icon:"sap-icon://warning2",title:t.oResourceBundle.getText("WARNING"),state:"Warning",type:"Message",content:[new sap.m.Text({text:t.oResourceBundle.getText("WARNING_UNSAVED_MESSAGE")})],beginButton:new sap.m.Button({text:t.oResourceBundle.getText("CONTINUE"),press:function(){c.close();if(sap.suite.smartbusiness.modelerAppCache&&sap.suite.smartbusiness.modelerAppCache.createSBKPI&&sap.suite.smartbusiness.modelerAppCache.createSBKPI.appFromWorkspace){if(t.context){if(t.route=="editKpi"||t.route=="duplicateKpi"){sap.suite.smartbusiness.utils.appToAppNavigation({action:"SBWorkspace",route:"detail",context:t.context.sPath.substr(1).replace("INDICATORS","INDICATORS_MODELER")})}else if(t.route=="editDraftKpi"){sap.suite.smartbusiness.utils.appToAppNavigation({action:"SBWorkspace",route:"detail",context:t.context.sPath.substr(1).replace("INDICATORS","INDICATORS_MODELER").replace("IS_ACTIVE=0","IS_ACTIVE=1")})}}else{sap.suite.smartbusiness.utils.appToAppNavigation({action:"SBWorkspace"})}}else{sap.suite.smartbusiness.utils.appToAppNavigation({})}}}),endButton:new sap.m.Button({text:t.oResourceBundle.getText("CANCEL"),press:function(){c.close()}})});c.open()}else{if(sap.suite.smartbusiness.modelerAppCache&&sap.suite.smartbusiness.modelerAppCache.createSBKPI&&sap.suite.smartbusiness.modelerAppCache.createSBKPI.appFromWorkspace){if(t.context){if(t.route=="editKpi"||t.route=="duplicateKpi"){sap.suite.smartbusiness.utils.appToAppNavigation({action:"SBWorkspace",route:"detail",context:t.context.sPath.substr(1).replace("INDICATORS","INDICATORS_MODELER")})}else if(t.route=="editDraftKpi"){sap.suite.smartbusiness.utils.appToAppNavigation({action:"SBWorkspace",route:"detail",context:t.context.sPath.substr(1).replace("INDICATORS","INDICATORS_MODELER").replace("IS_ACTIVE=0","IS_ACTIVE=1")})}}else{sap.suite.smartbusiness.utils.appToAppNavigation({action:"SBWorkspace"})}}else{sap.suite.smartbusiness.utils.appToAppNavigation({})}}}},saveKpiDetails:function(){var t=this;var k=this.kpiCreateModel.getData();var s=true;var a={"ID":k.ID||"","IS_ACTIVE":0,"INDICATOR":{"DESCRIPTION":k.DESCRIPTION||"","GOAL_TYPE":k.GOAL_TYPE||"","TITLE":k.TITLE||"","TYPE":k.TYPE||"","OWNER_E_MAIL":k.OWNER_E_MAIL||"","OWNER_ID":k.OWNER_ID||"","OWNER_NAME":k.OWNER_NAME||"","COLUMN_NAME":k.COLUMN_NAME||"","DATA_SPECIFICATION":k.DATA_SPECIFICATION||"","ODATA_URL":k.ODATA_URL||"","ODATA_ENTITYSET":k.ODATA_ENTITYSET||"","VIEW_NAME":k.VIEW_NAME||"","ENTITY_TYPE":"","SEMANTIC_OBJECT":k.SEMANTIC_OBJECT||"","ACTION":k.ACTION||""}};if(a.ID==""){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_INDICATOR_ID"));s=false;return}if(!(s)||t.byId("kpiId").getValueState()==="Error"){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_VALID_KPI_ID"));s=false;return}if(t.byId("kpiOwnerEmail").getValueState()==="Error"){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_VALID_KPI_EMAIL"));s=false;return}else{if(this.viewData.mode=="DUPLICATE"){if(!this.validateKpiId()){return}}if(t.viewData.mode=="CREATE"||t.viewData.mode=="DUPLICATE"||(t.viewData.mode=="EDIT"&&this.viewData.IS_ACTIVE==1)){a.TEXTS=[];a.TAGS=[];a.PROPERTIES=[];var l=t.insertLanguagePayload();var p=t.insertPropertiesPayload();var b=t.insertTagPayload();if(l.length){a.TEXTS=l}if(p.length){a.PROPERTIES=p}if(b.length){a.TAGS=b}sap.suite.smartbusiness.utils.create(sap.suite.smartbusiness.utils.serviceUrl('INDICATOR_SERVICE_URI'),a,null,function(n){if(t.getView().getModel().getData().TYPE=="KPI"){sap.m.MessageToast.show(t.oResourceBundle.getText("SUCCESS_KPI_SAVE"))}else{sap.m.MessageToast.show(t.oResourceBundle.getText("SUCCESS_OPI_SAVE"))}s=true},function(n){if(t.getView().getModel().getData().TYPE=="KPI"){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_KPI_SAVE"))}else{sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_OPI_SAVE"))}s=false})}else if(t.viewData.mode=="EDIT"){a.TEXTS={};a.TAGS={};a.PROPERTIES={};var c=false;var d=false;var e=false;var f=false;var g=t.getIndicatorChanges();if(g){if(g.updates.length){c=true;a.INDICATOR={};for(var i=0;i<g.updates.length;i++){a.INDICATOR.update=g.updates[i]}}}var h=t.getLanguageChanges();if(h){if(h.deletes.length){d=true;for(var i=0;i<h.deletes.length;i++){a.TEXTS.remove=h.deletes}}if(h.updates.length){d=true;for(var i=0;i<h.updates.length;i++){a.TEXTS.create=h.updates}}}var j=t.getTagChanges();if(j){if(j.deletes.length){e=true;for(var i=0;i<j.deletes.length;i++){a.TAGS.remove=j.deletes}}if(j.updates.length){e=true;for(var i=0;i<j.updates.length;i++){a.TAGS.create=j.updates}}}var m=t.getPropertiesChanges();if(m){if(m.deletes.length){f=true;for(var i=0;i<m.deletes.length;i++){a.PROPERTIES.remove=m.deletes}}if(m.updates.length){f=true;for(var i=0;i<m.updates.length;i++){a.PROPERTIES.create=m.updates}}}if(c||e||f||d){sap.suite.smartbusiness.utils.update(sap.suite.smartbusiness.utils.serviceUrl('INDICATOR_SERVICE_URI'),a,null,function(n){if(t.getView().getModel().getData().TYPE=="KPI"){sap.m.MessageToast.show(t.oResourceBundle.getText("SUCCESS_KPI_SAVE"))}else{sap.m.MessageToast.show(t.oResourceBundle.getText("SUCCESS_OPI_SAVE"))}s=true},function(n){if(t.getView().getModel().getData().TYPE=="KPI"){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_KPI_SAVE"))}else{sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_OPI_SAVE"))}s=false})}}}return s},getIndicatorChanges:function(){var o=this.indicatorPayloadForDirtyBitTest;var n=this.kpiCreateModel.getData();var a={"DESCRIPTION":o.DESCRIPTION||"","GOAL_TYPE":o.GOAL_TYPE||"","TITLE":o.TITLE||"","TYPE":o.TYPE||"","OWNER_E_MAIL":o.OWNER_E_MAIL||"","OWNER_ID":o.OWNER_ID||"","OWNER_NAME":o.OWNER_NAME||"","COLUMN_NAME":o.COLUMN_NAME||"","DATA_SPECIFICATION":o.DATA_SPECIFICATION||"","ODATA_URL":o.ODATA_URL||"","ODATA_ENTITYSET":o.ODATA_ENTITYSET||"","VIEW_NAME":o.VIEW_NAME||"","ENTITY_TYPE":"","SEMANTIC_OBJECT":o.SEMANTIC_OBJECT||"","ACTION":o.ACTION||""};var b={"DESCRIPTION":n.DESCRIPTION||"","GOAL_TYPE":n.GOAL_TYPE||"","TITLE":n.TITLE||"","TYPE":n.TYPE||"","OWNER_E_MAIL":n.OWNER_E_MAIL||"","OWNER_ID":n.OWNER_ID||"","OWNER_NAME":n.OWNER_NAME||"","COLUMN_NAME":n.COLUMN_NAME||"","DATA_SPECIFICATION":n.DATA_SPECIFICATION||"","ODATA_URL":n.ODATA_URL||"","ODATA_ENTITYSET":n.ODATA_ENTITYSET||"","VIEW_NAME":n.VIEW_NAME||"","ENTITY_TYPE":"","SEMANTIC_OBJECT":n.SEMANTIC_OBJECT||"","ACTION":n.ACTION||""};var i=sap.suite.smartbusiness.utils.dirtyBitCheck({oldPayload:a,newPayload:b,objectType:"INDICATORS"});return i},getLanguageChanges:function(){var t=this;this.languagePayloadForDirtyBitTest=[];var n=this.insertLanguagePayload();for(var i=0;i<this.OLD_ADDITIONAL_LANGUAGE_ARRAY.length;i++){var l={};l.LANGUAGE=this.OLD_ADDITIONAL_LANGUAGE_ARRAY[i].ADDITIONAL_LANGUAGE_SPRAS_KEY;l.TITLE=this.OLD_ADDITIONAL_LANGUAGE_ARRAY[i].ADDITIONAL_LANGUAGE_TITLE;l.DESCRIPTION=this.OLD_ADDITIONAL_LANGUAGE_ARRAY[i].ADDITIONAL_LANGUAGE_DESCRIPTION;this.languagePayloadForDirtyBitTest.push(l)}var a=sap.suite.smartbusiness.utils.dirtyBitCheck({oldPayload:t.languagePayloadForDirtyBitTest,newPayload:n,objectType:"INDICATOR_TEXTS"});return a},getTagChanges:function(){var t=this;this.tagPayloadForDirtyBitTest=[];var n=this.insertTagPayload();var o=[];for(var i=0;i<t.OLD_TAGS.length;i++){var a={};a.TAG=t.OLD_TAGS[i];a.TYPE="IN";this.tagPayloadForDirtyBitTest.push(a)}var b=sap.suite.smartbusiness.utils.dirtyBitCheck({oldPayload:t.tagPayloadForDirtyBitTest,newPayload:n,objectType:"TAGS"});return b},getPropertiesChanges:function(){var t=this;this.propertiesPayloadForDirtyBitTest=[];var n=this.insertPropertiesPayload();for(var i=0;i<this.OLD_PROPERTIES.length;i++){var p={};p.TYPE="IN";p.NAME=t.OLD_PROPERTIES[i].NAME;p.VALUE=t.OLD_PROPERTIES[i].VALUE;this.propertiesPayloadForDirtyBitTest.push(p)}var a=sap.suite.smartbusiness.utils.dirtyBitCheck({oldPayload:t.propertiesPayloadForDirtyBitTest,newPayload:n,objectType:"PROPERTIES"});return a},insertLanguagePayload:function(){var k=this.kpiCreateModel.getData();var l={};var a=[];if(k.NO_OF_ADDITIONAL_LANGUAGES>0){var i;for(i=0;i<k.NO_OF_ADDITIONAL_LANGUAGES;i++){l={};l.LANGUAGE=k.ADDITIONAL_LANGUAGE_ARRAY[i].ADDITIONAL_LANGUAGE_SPRAS_KEY;l.TITLE=k.ADDITIONAL_LANGUAGE_ARRAY[i].ADDITIONAL_LANGUAGE_TITLE;l.DESCRIPTION=k.ADDITIONAL_LANGUAGE_ARRAY[i].ADDITIONAL_LANGUAGE_DESCRIPTION;a.push(l)}}return a},insertTagPayload:function(){var k=this.kpiCreateModel.getData();var t={};var a=[];if(k.TAG){var b=k.TAG.split(",");var i;for(i=0;i<b.length;i++){t={};t.TYPE="IN";t.TAG=b[i];a.push(t)}}return a},insertPropertiesPayload:function(){var k=this.kpiCreateModel.getData();var p={};var a=[];if(k.PROPERTIES){var i;for(i=0;i<k.PROPERTIES.length;i++){p={};p.TYPE="IN";p.NAME=k.PROPERTIES[i].NAME;p.VALUE=k.PROPERTIES[i].VALUE;a.push(p)}}return a},addAdditionalLanguageDialog:function(){var t=this;this.additionalLanguageListModel=new sap.ui.model.json.JSONModel();this.additionalLanguageListModelData=$.extend([],t.getView().getModel().getData().ADDITIONAL_LANGUAGE_ARRAY);this.getView().getModel().getData().NO_OF_ADDITIONAL_LANGUAGES=this.additionalLanguageListModelData.length;this.additionalLanguageListModel.setData(this.additionalLanguageListModelData);this.languageTextInput=new sap.m.Input({layoutData:new sap.ui.layout.GridData({span:"L8 M8 S8"})});this.languageDescriptionInput=new sap.m.TextArea({layoutData:new sap.ui.layout.GridData({span:"L8 M8 S8"})});this.languageKeySelect=new sap.m.Select({layoutData:new sap.ui.layout.GridData({span:"L6 M6 S6"})});this.addedLanguagesList=new sap.m.List({layoutData:new sap.ui.layout.GridData({span:"L5 M5 S5"}),});this.addedLanguagesList.bindItems("additionalLanguageListModel>/",new sap.m.CustomListItem({content:new sap.ui.layout.Grid({hSpacing:1,vSpacing:0,defaultSpan:"L12 M12 S12",content:[new sap.m.Input({value:"{additionalLanguageListModel>ADDITIONAL_LANGUAGE_TITLE}",design:"Bold",layoutData:new sap.ui.layout.GridData({span:"L12 M12 S12",vAlign:"Middle"}),editable:false}),new sap.m.Input({value:"{additionalLanguageListModel>ADDITIONAL_LANGUAGE_DESCRIPTION}",design:"Bold",layoutData:new sap.ui.layout.GridData({span:"L6 M6 S6",vAlign:"Middle"}),editable:false}),new sap.m.Input({value:"{additionalLanguageListModel>ADDITIONAL_LANGUAGE_KEY}",design:"Bold",layoutData:new sap.ui.layout.GridData({span:"L4 M4 S4"}),editable:false}),new sap.m.Button({icon:"sap-icon://sys-cancel",type:"Transparent",press:function(e){var d=e.getSource().getBindingContext("additionalLanguageListModel").getPath().substr(1);var n=t.addedLanguagesList.getModel("additionalLanguageListModel").getData().splice(d,1);t.addedLanguagesList.getModel("additionalLanguageListModel").updateBindings()},layoutData:new sap.ui.layout.GridData({span:"L2 M2 S2"})})]})}));this.addedLanguagesList.setModel(t.additionalLanguageListModel,"additionalLanguageListModel");var a=new sap.m.Dialog({contentHeight:"50%",contentWidth:"25%",title:t.oResourceBundle.getText("ADDITIONAL_LANGUAGE"),content:[new sap.ui.layout.Grid({hSpacing:1,vSpacing:4,defaultSpan:"L12 M12 S12",content:[new sap.ui.layout.form.SimpleForm({editable:true,layout:"ResponsiveGridLayout",content:[new sap.m.Label({text:t.oResourceBundle.getText("TITLE"),textAlign:"Right",layoutData:new sap.ui.layout.GridData({span:"L3 M3 S3",})}),t.languageTextInput,new sap.m.Label({text:t.oResourceBundle.getText("DESCRIPTION"),layoutData:new sap.ui.layout.GridData({span:"L3 M3 S3",})}),t.languageDescriptionInput,new sap.m.Label({text:t.oResourceBundle.getText("LANGUAGE")+":",layoutData:new sap.ui.layout.GridData({span:"L3 M3 S3"})}),t.languageKeySelect,new sap.m.Button({icon:"sap-icon://add",layoutData:new sap.ui.layout.GridData({span:"L2 M2 S2"}),press:function(){if(t.languageTextInput.getValue()||t.languageDescriptionInput.getValue()){for(var i=0;i<t.addedLanguagesList.getModel("additionalLanguageListModel").getData().length;i++){if(t.addedLanguagesList.getModel("additionalLanguageListModel").getData()[i].ADDITIONAL_LANGUAGE_KEY===t.languageKeySelect.getSelectedItem().getText()){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_LANGUAGE_EXISTS",t.languageKeySelect.getSelectedItem().getText()));return}}var b={"ADDITIONAL_LANGUAGE_TITLE":t.languageTextInput.getValue(),"ADDITIONAL_LANGUAGE_DESCRIPTION":t.languageDescriptionInput.getValue(),"ADDITIONAL_LANGUAGE_KEY":t.languageKeySelect.getSelectedItem().getText(),"ADDITIONAL_LANGUAGE_SPRAS_KEY":t.languageKeySelect.getSelectedItem().getKey()};t.addedLanguagesList.getModel("additionalLanguageListModel").getData().push(b);t.addedLanguagesList.getModel("additionalLanguageListModel").updateBindings();t.languageTextInput.setValue("");t.languageDescriptionInput.setValue("")}}})]})]}).addStyleClass("languageGrid"),t.addedLanguagesList],beginButton:new sap.m.Button({text:t.oResourceBundle.getText("OK"),press:function(){a.close();t.getView().getModel().getData().ADDITIONAL_LANGUAGE_ARRAY=t.addedLanguagesList.getModel("additionalLanguageListModel").getData();t.getView().getModel().getData().NO_OF_ADDITIONAL_LANGUAGES=t.getView().getModel().getData().ADDITIONAL_LANGUAGE_ARRAY.length;t.getView().getModel().updateBindings()}}),endButton:new sap.m.Button({text:t.oResourceBundle.getText("CANCEL"),press:function(){a.close()}})});this.oDataModel.read("/LANGUAGE?$select=LAISO,SPRAS",null,null,false,function(d){d=d.results;var i;for(var i=0;i<d.length;i++){if((d[i].LAISO).toUpperCase()==(sap.ui.getCore().getConfiguration().getLocale().getLanguage()).toUpperCase()){d.splice(i,1)}}var m=new sap.ui.model.json.JSONModel();m.setData(d);t.languageKeySelect.setModel(m,"otherLanguageKey");t.languageKeySelect.bindItems("otherLanguageKey>/",new sap.ui.core.Item({text:"{otherLanguageKey>LAISO}",key:"{otherLanguageKey>SPRAS}"}))});a.open()},addNewProperty:function(){var t=this;if(this.getView().byId("kpiPropertyName").getValue()){this.getView().byId("kpiPropertyName").setValueState("None");if(this.getView().byId("kpiPropertyValue").getValue()){this.getView().byId("kpiPropertyValue").setValueState("None");var p=this.getView().byId('propertyNameValueBox').getModel();p.getData().PROPERTIES=p.getData().PROPERTIES||[];for(var i=0;i<p.getData().PROPERTIES.length;i++){if((p.getData().PROPERTIES[i].NAME===this.getView().byId("kpiPropertyName").getValue())&&(p.getData().PROPERTIES[i].VALUE===this.getView().byId("kpiPropertyValue").getValue())){sap.suite.smartbusiness.utils.showErrorMessage(this.oResourceBundle.getText("ERROR_PROPERTY_VALUE_PAIR_EXISTS"));return}}p.getData().PROPERTIES.push({NAME:this.getView().byId("kpiPropertyName").getValue(),VALUE:this.getView().byId("kpiPropertyValue").getValue()});p.updateBindings();this.getView().byId("kpiPropertyName").setValue("");this.getView().byId("kpiPropertyValue").setValue("")}else{this.getView().byId("kpiPropertyValue").setValueState("Error");sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ENTER_PROPERTY_VALUE"))}}else{this.getView().byId("kpiPropertyName").setValueState("Error");sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ENTER_PROPERTY_NAME"))}},removeProperty:function(e){var p=e.getSource().getBindingContext().getPath();e.getSource().getBindingContext().getModel().getData().PROPERTIES.splice(p.substring(p.lastIndexOf("/")+1),1);e.getSource().getBindingContext().getModel().updateBindings()},kpiOpiRadioButtonChange:function(e){if(this.getView().byId('KPI').getSelected()==true){this.getView().getModel().getData().TYPE="KPI";this.getView().getModel().getData().KPITYPE=true;this.getView().getModel().getData().OPITYPE=false}else{this.getView().getModel().getData().TYPE="OPI";this.getView().getModel().getData().KPITYPE=false;this.getView().getModel().getData().OPITYPE=true}if(this.getView().byId('OPI').getSelected()==true){this.getView().getModel().getData().TYPE="OPI";this.getView().getModel().getData().KPITYPE=false;this.getView().getModel().getData().OPITYPE=true}else{this.getView().getModel().getData().TYPE="KPI";this.getView().getModel().getData().KPITYPE=true;this.getView().getModel().getData().OPITYPE=false}},validateKpiId:function(){var k=this.getView().byId('kpiId');var t=this;var s=false;var a=k.getValue();if(a){if(!(/^[a-zA-Z0-9.]*$/.test(a))){k.setValueState("Error");s=false}else{k.setValueState("None");this.oDataModel.read("/INDICATORS?$filter=ID eq '"+a+"'",null,null,false,function(i){if(i.results[0]){k.setValueState("Error");sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ID_ALREADY_EXISTS"));s=false}else{k.setValueState("None");s=true}},function(){k.setValueState("None");s=true})}}return s},formatAdditionalLanguageLink:function(v){return this.oApplicationFacade.getResourceBundle().getText("ADDITIONAL_LANGUAGE")+"("+v+")"},formatSemanticActionLabel:function(v){return v+"/"+this.oApplicationFacade.getResourceBundle().getText("ACTION")},validateEmailAddress:function(){var k=this.getView().byId('kpiOwnerEmail');var a=k.getValue();if(a){if(!(/^\w+[\w-\.]*\@\w+((-\w+)|(\w*))\.[a-z]/.test(a))){k.setValueState("Error")}else{k.setValueState("None")}}else{k.setValueState("None")}},populateRelevantEntitySet:function(d){var t=this;var m=this.getView().getModel().getData();var o=m.ODATA_URL.substr(0,m.ODATA_URL.lastIndexOf("/"));o=o.replace(/\//g,'.').replace(".","");var b=m.ODATA_URL.substr(m.ODATA_URL.lastIndexOf("/")+1);b=b.split(".")[0];var e="/ODATA_FOR_ENTITY(P_PACKAGE='"+m.VIEW_NAME.split("/")[0]+"',P_OBJECT='"+m.VIEW_NAME.split("/")[1]+"')/Results?$filter=PACKAGE eq '"+o+"' and OBJECT eq '"+b+"'";this.oApplicationFacade.getODataModel().read(e,null,null,false,function(c){if(c.results&&c.results.length){var f=c.results[0].CDATA_STR;d.open();if(f){var g=f.split("\n");for(var i=0,l=g.length;i<l;i++){if(g[i].indexOf("//")!=-1){g[i]=g[i].substr(0,g[i].indexOf("//"))}}f=g.join("\n");while(f.indexOf("/*")!=-1){var s=f.indexOf("/*");var h=f.indexOf("*/");h=(h==-1)?f.length:(h-2);f=f.substr(0,s)+f.substr(h)}}var j=[];var M=new sap.ui.model.json.JSONModel();var a=f.split(m.VIEW_NAME.split("/")[0]+'::'+m.VIEW_NAME.split("/")[1]);if(a.length==1){a=f.split(m.VIEW_NAME.split("/")[0]+'/'+m.VIEW_NAME.split("/")[1])}if(a.length==1){M=t.populateEntitySet(t.getView().byId("odataServiceInput").getValue());d.setModel(M);return}for(var i=1,l=a.length;i<l;i++){var k={};k.entityName=a[i].split('"')[2];j.push(k)}M.setData({entitySet:j});d.setModel(M);return}},function(a){})},handleHanaViewValueHelp:function(){var t=this;var h=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_VIEW"),noDataText:t.oResourceBundle.getText("NO_DATA_FOUND"),items:{path:"/HANA_VIEWS",template:new sap.m.StandardListItem({title:{parts:[{path:"OBJECT",type:new sap.ui.model.type.String()},{path:"PACKAGE",type:new sap.ui.model.type.String()},{path:"SUFFIX",type:new sap.ui.model.type.String()}],formatter:function(o,p,s){if(s.indexOf("view")!=-1)return p+"/"+o;else return p+"::"+o}},description:"{SUFFIX}"})},confirm:function(e){t.getView().getModel().setProperty("/VIEW_NAME",e.getParameter("selectedItem").getProperty("title"));t.byId("viewInput").fireChange()},liveChange:function(e){var s="'"+e.getParameter("value").toLowerCase()+"'";var f=new sap.ui.model.Filter("tolower(PACKAGE)",sap.ui.model.FilterOperator.Contains,s);var F=new sap.ui.model.Filter("tolower(OBJECT)",sap.ui.model.FilterOperator.Contains,s);var b=e.getSource().getBinding("items");b.filter(new sap.ui.model.Filter([f,F],false))}});h.setModel(this.oDataModel);h.open()},handleHanaViewInputChange:function(){this.getView().getModel().getData().ODATA_URL="";this.getView().getModel().getData().ODATA_ENTITYSET="";this.getView().getModel().getData().COLUMN_NAME="";this.getView().getModel().updateBindings()},handleOdataServiceValueHelp:function(){var t=this;if(!t.byId("viewInput").getValue()){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_HANA_VIEW"))}else{var a=t.getView().getModel().getProperty("/VIEW_NAME");a=(a.indexOf("/")!=-1?a.split("/"):a.split("::"));var h=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_ODATA_SERVICE"),noDataText:t.oResourceBundle.getText("NO_DATA_FOUND"),items:{path:"/ODATA_FOR_ENTITY(P_PACKAGE='"+a[0]+"',P_OBJECT='"+a[1]+"')/Results",template:new sap.m.StandardListItem({title:{parts:[{path:"PACKAGE",type:new sap.ui.model.type.String()},{path:"OBJECT",type:new sap.ui.model.type.String()}],formatter:function(o,p,s){o=o.replace(/\./g,'/');return"/"+o+"/"+p+".xsodata"}},})},confirm:function(e){t.getView().getModel().setProperty("/ODATA_URL",e.getParameter("selectedItem").getProperty("title"))},liveChange:function(e){var s="'"+e.getParameter("value").toLowerCase()+"'";var f=new sap.ui.model.Filter("tolower(PACKAGE)",sap.ui.model.FilterOperator.Contains,s);var F=new sap.ui.model.Filter("tolower(OBJECT)",sap.ui.model.FilterOperator.Contains,s);var b=e.getSource().getBinding("items");b.filter(new sap.ui.model.Filter([f,F],false))}});h.setModel(t.oDataModel);h.open()}},handleEntitySetValueHelp:function(){var t=this;if(!t.byId("odataServiceInput").getValue()){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_ODATA_SERVICE_URL"))}else{var t=this;t.oModelForEntity;var h=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_ENTITY_SET"),noDataText:t.oResourceBundle.getText("NO_DATA_FOUND"),items:{path:"/entitySet",template:new sap.m.StandardListItem({title:{parts:[{path:"entityName",type:new sap.ui.model.type.String()}],formatter:function(o,s){return o}},})},confirm:function(E){t.getView().getModel().setProperty("/ODATA_ENTITYSET",E.getParameter("selectedItem").getProperty("title"))},liveChange:function(E){var s="'"+E.getParameter("value").toLowerCase()+"'";var f=new sap.ui.model.Filter("tolower(entityName)",sap.ui.model.FilterOperator.Contains,s);var b=E.getSource().getBinding("items");b.filter(new sap.ui.model.Filter([f],false))}});try{if(t.getView().getModel().getData().VIEW_NAME){t.populateRelevantEntitySet(h)}else{t.oModelForEntity=t.populateEntitySet(t.getView().byId("odataServiceInput").getValue());h.setModel(t.oModelForEntity);h.open()}}catch(e){}}},handleMeasureValueHelp:function(){var t=this;if(!t.byId("entitySetInput").getValue()){sap.suite.smartbusiness.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_ENTITY_SET"))}else{try{t.oModelForMeasure=t.populateMeasure(t.getView().getModel().getProperty("/ODATA_URL"),t.getView().getModel().getProperty("/ODATA_ENTITYSET"))}catch(e){}var h=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_MEASURE"),noDataText:t.oResourceBundle.getText("NO_DATA_FOUND"),items:{path:"/measures",template:new sap.m.StandardListItem({title:{parts:[{path:"measureName",type:new sap.ui.model.type.String()}],formatter:function(o,s){return o}},})},confirm:function(E){t.getView().getModel().setProperty("/COLUMN_NAME",E.getParameter("selectedItem").getProperty("title"))},liveChange:function(E){var s="'"+E.getParameter("value").toLowerCase()+"'";var f=new sap.ui.model.Filter("tolower(measureName)",sap.ui.model.FilterOperator.Contains,s);var b=E.getSource().getBinding("items");b.filter(new sap.ui.model.Filter([f],false))}});h.setModel(t.oModelForMeasure);h.open()}},handleChangeAdditionalInfo:function(e){var t=this;t.getView().getModel().setProperty("info",t.getView().byId("additionalInfoId"))},populateEntitySet:function(d){var c=this;var m=new sap.ui.model.json.JSONModel();var r=[],e=[],o={};var i;r=sap.suite.smartbusiness.odata.getAllEntitySet(d);for(i=0;i<r.length;i++){o={};o.entityName=r[i];e.push(o)}m.setData({entitySet:e});return m},validateQueryServiceURI:function(d){d=jQuery.trim(d);if(!jQuery.sap.startsWith(d,"/")){d="/"+d}if(jQuery.sap.endsWith(d,"/")){d=d.substring(0,d.length-1)}return d},populateMeasure:function(d,e){d=this.validateQueryServiceURI(d)+"";e=e+"";var m=[],a=[],o={};var i;m=sap.suite.smartbusiness.odata.getAllMeasures(d,e);for(i=0;i<m.length;i++){o={};o.measureName=m[i];a.push(o)}var M=new sap.ui.model.json.JSONModel();M.setData({measures:a});return M},onODataServiceLoad:function(){var t=this;setTimeout(function(){t.getView().getModel().setProperty("/ODATA_URL",t.getView().byId("odataServiceSelect").getSelectedItem().getText());t.getView().byId("odataServiceSelect").fireChange()},0);this.oDataModel.detachRequestCompleted(t.onODataServiceLoad,t)},onEntitySetServiceLoad:function(){var t=this;setTimeout(function(){t.getView().getModel().setProperty("/ODATA_ENTITYSET",t.getView().byId("entitySetSelect").getSelectedItem().getText());t.getView().byId("entitySetSelect").fireChange()},0)},onMeasureServiceLoad:function(){var t=this;setTimeout(function(){t.getView().getModel().setProperty("/COLUMN_NAME",t.getView().byId("valueMeasureSelect").getSelectedItem().getText());t.getView().byId("valueMeasureSelect").fireChange()},0)},onExit:function(){var h=hasher||window.hasher;if(!(h.getHash())){sap.suite.smartbusiness.utils.backToHome()}if(sap.suite.smartbusiness.modelerAppCache&&sap.suite.smartbusiness.modelerAppCache.createSBKPI&&sap.suite.smartbusiness.modelerAppCache.createSBKPI.appFromWorkspace){delete sap.suite.smartbusiness.modelerAppCache.createSBKPI.appFromWorkspace}}});
