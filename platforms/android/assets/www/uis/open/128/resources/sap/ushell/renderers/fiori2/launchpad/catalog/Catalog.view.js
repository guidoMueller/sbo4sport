//Copyright (c) 2013 SAP AG, All Rights Reserved
(function(){"use strict";jQuery.sap.require("sap.ui.core.IconPool");jQuery.sap.require("sap.ushell.ui.launchpad.Tile");jQuery.sap.require("sap.ushell.ui.launchpad.TileContainer");jQuery.sap.require("sap.ushell.ui.launchpad.Panel");jQuery.sap.require("sap.ushell.ui.launchpad.CatalogListItem");sap.ui.jsview("sap.ushell.renderers.fiori2.launchpad.catalog.Catalog",{createContent:function(c){var t=sap.ushell.resources.i18n,a=this,V=undefined;function i(v){return!v}function b(L){return((L!==null)&&(L==="1x2"||L==="2x2"))||false}function d(s){return((s!==null)&&(s==="2x2"||s==="2x1"))||false}function f(v){if(sap.ui.Device.system.phone){return false}return i(v)}function g(v){return parseInt(v,10)||0}function h(G){var e=(G&&G.length>0)?"accept":"add";return sap.ui.core.IconPool.getIconURI(e)}function j(v){return(v&&v>0)?v+((v>1&&(" "+t.getText("tiles")))||(" "+t.getText("tile"))):t.getText("no_tiles")}var B=new sap.m.Button({icon:{path:"associatedGroups",formatter:h},tooltip:{parts:["i18n>addTileToGroup","i18n>addAssociatedTileToGroup","associatedGroups"],formatter:function(A,s,G){return G&&G.length?s:A}},press:[c.onTileFooterClick,c]}),T=new sap.ushell.ui.launchpad.Tile({afterRendering:[c.onTileAfterRendering,c],tileViews:{path:"content",factory:function(I,e){return e.getObject()}},footItems:[B],"long":{path:"size",formatter:b},"tall":{path:"size",formatter:d},index:{path:"id",formatter:g}}),k=new sap.ushell.ui.launchpad.TileContainer("catalogTiles",{showHeader:false,showPlaceholder:false,showGroupHeader:"{/showCatalogHeaders}",groupHeaderLevel:sap.m.HeaderLevel.H3,showNoData:true,tiles:{path:"/catalogTiles",template:T,sorter:new sap.ui.model.Sorter("catalogIndex",false,function(e){return(e&&e.getProperty("catalog"))||""})},afterRendering:function(e){var q=jQuery(e.getSource());if(this.getTiles().length||this.getModel().getProperty('/catalogTiles/length')){setTimeout(function(){sap.ui.getCore().byId("catalogSearch").setEnabled(true)});sap.ui.getCore().getEventBus().publish("launchpad","contentRendered");if(!sap.ui.Device.os.ios){sap.ui.getCore().getEventBus().publish("launchpad","contentRefresh")}}jQuery.sap.byId("catalogTilesPage").find("label").parent().attr("tabindex","0");jQuery.sap.byId("catalogTiles").removeAttr("tabindex",0)}});var l=new sap.m.Button('hiddenCatalogTabFocusHelper');l.addEventDelegate({onfocusin:function(){try{var s=sap.ui.getCore().byId('homeBtn').focus()}catch(e){}}});B.constructor.prototype.setIcon=function(v){this.setProperty("icon",v,true);if(v&&this._image&&this._image.setSrc){this._image.setSrc(v)}return this};var F=new sap.ui.model.Filter("numIntentSupportedTiles",sap.ui.model.FilterOperator.NE,0);var C=new sap.m.Select("catalogSelect",{name:"Browse",tooltip:"{i18n>catalogSelect_tooltip}",items:{path:"/catalogs",template:new sap.ui.core.ListItem({text:"{title}"}),filters:[F]},change:[c.onCategoryFilter,c]});var o=C.onAfterRendering;C.onAfterRendering=function(){o.apply(this,arguments);jQuery.sap.byId("catalogSelect").attr("tabindex",0)};var m=C._onAfterRenderingPopover;C._onAfterRenderingPopover=function(){if(this._oPopover){this._oPopover.setFollowOf(false)}if(m){m.apply(this,arguments)}};var n=new sap.m.SearchField("catalogSearch",{tooltip:"{i18n>catalogSearch_tooltip}",enabled:false,value:{path:"/catalogSearchFilter"},placeholder:"{i18n>search_catalog}",liveChange:[c.onLiveFilter,c]});var p=n.onAfterRendering;n.onAfterRendering=function(){p.apply(this,arguments);jQuery.sap.byId("catalogSearch").find("input").attr("tabindex",0)};var D=new sap.m.Page("catalogTilesPage",{showHeader:true,showFooter:false,showNavButton:true,title:"{i18n>tile_catalog}",content:[new sap.ushell.ui.launchpad.Panel({translucent:true,headerText:"",headerLevel:sap.m.HeaderLevel.H2,headerBar:new sap.m.Bar("catalogHeader",{translucent:true,tooltip:"{i18n>tile_catalog_header_tooltip}",contentLeft:[C],contentRight:[n]}).addStyleClass("sapUshellCatalogMain"),content:[k,l]})],navButtonPress:[c.onNavButtonPress,c]}).addStyleClass("sapUshellCatalog");return D},getControllerName:function(){return"sap.ushell.renderers.fiori2.launchpad.catalog.Catalog"}})}());
